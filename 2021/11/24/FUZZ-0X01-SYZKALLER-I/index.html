

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/avatar.png">
  <link rel="icon" href="/img/avatar.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="arttnba3">
  <meta name="keywords" content="">
  
    <meta name="description" content="å°è¯•éå†æ‰€æœ‰çš„ä¸–ç•Œçº¿">
<meta property="og:type" content="article">
<meta property="og:title" content="ã€FUZZ.0x01ã€‘syzkaller - Iï¼šä½¿ç”¨ syzkaller è¿›è¡Œæ¼æ´æŒ–æ˜">
<meta property="og:url" content="http://blog.arttnba3.cn/2021/11/24/FUZZ-0X01-SYZKALLER-I/index.html">
<meta property="og:site_name" content="arttnba3&#39;s blog">
<meta property="og:description" content="å°è¯•éå†æ‰€æœ‰çš„ä¸–ç•Œçº¿">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://i.loli.net/2021/11/11/LxNvdhpEX2sBjYc.png">
<meta property="article:published_time" content="2021-11-23T19:09:11.000Z">
<meta property="article:modified_time" content="2022-08-18T17:47:02.660Z">
<meta property="article:author" content="arttnba3">
<meta property="article:tag" content="Pwn">
<meta property="article:tag" content="Linux">
<meta property="article:tag" content="Linux Kernel">
<meta property="article:tag" content="æ¼æ´æŒ–æ˜">
<meta property="article:tag" content="syzkaller">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://i.loli.net/2021/11/11/LxNvdhpEX2sBjYc.png">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>ã€FUZZ.0x01ã€‘syzkaller - Iï¼šä½¿ç”¨ syzkaller è¿›è¡Œæ¼æ´æŒ–æ˜ - arttnba3&#39;s blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- ä¸»é¢˜ä¾èµ–çš„å›¾æ ‡åº“ï¼Œä¸è¦è‡ªè¡Œä¿®æ”¹ -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"blog.arttnba3.cn","root":"/","version":"1.9.2","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":"Â§"},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 6.2.0"><link rel="alternate" href="/atom.xml" title="arttnba3's blog" type="application/atom+xml">
</head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 80vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>arttnba3&#39;s blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                é¦–é¡µ
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                å½’æ¡£
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                åˆ†ç±»
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                æ ‡ç­¾
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                å…³äº
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                å‹é“¾
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/atom.xml">
                <i class="iconfont icon-rss"></i>
                rss
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('https://i.loli.net/2021/11/12/BnYuNbO2MdiEw5V.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="ã€FUZZ.0x01ã€‘syzkaller - Iï¼šä½¿ç”¨ syzkaller è¿›è¡Œæ¼æ´æŒ–æ˜"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2021-11-24 03:09" pubdate>
          2021å¹´11æœˆ24æ—¥ å‡Œæ™¨
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          21k å­—
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          179 åˆ†é’Ÿ
        
      </span>
    

    
    
      
        <span id="busuanzi_container_page_pv" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="busuanzi_value_page_pv"></span> æ¬¡
        </span>
        
      
    
  </div>


        
      </div>

      
        <div class="scroll-down-bar">
          <i class="iconfont icon-arrowdown"></i>
        </div>
      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">ã€FUZZ.0x01ã€‘syzkaller - Iï¼šä½¿ç”¨ syzkaller è¿›è¡Œæ¼æ´æŒ–æ˜</h1>
            
              <p class="note note-info">
                
                  
                    æœ¬æ–‡æœ€åæ›´æ–°äºï¼š2022å¹´8æœˆ19æ—¥ å‡Œæ™¨
                  
                
              </p>
            
            
              <div class="markdown-body">
                
                <p>å°è¯•éå†æ‰€æœ‰çš„ä¸–ç•Œçº¿</p>
<span id="more"></span>

<h1 id="0x00-ä¸€åˆ‡å¼€å§‹ä¹‹å‰"><a href="#0x00-ä¸€åˆ‡å¼€å§‹ä¹‹å‰" class="headerlink" title="0x00.ä¸€åˆ‡å¼€å§‹ä¹‹å‰"></a>0x00.ä¸€åˆ‡å¼€å§‹ä¹‹å‰</h1><p>syzkaller æ˜¯ç”± Google å¼€å‘çš„ä¸€ä¸ªååˆ†å¼ºå¤§çš„é’ˆå¯¹å†…æ ¸çš„ fuzzerï¼Œè‡ªå…¶é¢ä¸–ä»¥æ¥å·²ç»å¸®åŠ©å…¨ä¸–ç•Œçš„å†…æ ¸å®‰å…¨ç ”ç©¶å‘˜å‘ç°äº†æ•°é‡æƒŠäººçš„å†…æ ¸æ¼æ´</p>
<p>æœ¬ç¯‡æ–‡ç« ä¸­ç¬”è€…å°†ç®€è¿° syzkaller çš„ä½¿ç”¨æ–¹æ³•</p>
<h1 id="0x01-ç¯å¢ƒé…ç½®"><a href="#0x01-ç¯å¢ƒé…ç½®" class="headerlink" title="0x01.ç¯å¢ƒé…ç½®"></a>0x01.ç¯å¢ƒé…ç½®</h1><blockquote>
<p>è¿™é‡Œå‚ç…§å®˜æ–¹æ–‡æ¡£è¿›è¡Œé…ç½®ï¼š <a target="_blank" rel="noopener" href="https://github.com/google/syzkaller">https://github.com/google/syzkaller</a></p>
<p>ç¬”è€…æœ¬åœ°ç¯å¢ƒï¼šUbuntu 21.04</p>
</blockquote>
<p><strong>åœ¨å®‰è£…ä¹‹å‰è¯·ç¡®ä¿ä½ çš„ç”µè„‘å…·æœ‰è¶³å¤Ÿçš„è¿è¡Œå†…å­˜ä¸å­˜å‚¨ç©ºé—´ï¼</strong>ï¼ˆç¬”è€…çš„2Gé˜¿é‡Œäº‘å­¦ç”Ÿæœºå°±è¢«æç‚¸äº†</p>
<p>è¦ä½¿ç”¨ syzkaller è¿›è¡Œæ¼æ´æŒ–æ˜ï¼Œæˆ‘ä»¬éœ€è¦ï¼š</p>
<ul>
<li><code>Go compiler and syzkaller itself</code></li>
<li><code>C compiler with coverage support</code></li>
<li><code>Linux kernel with coverage additions</code></li>
<li><code>Virtual machine or a physical device</code></li>
</ul>
<h2 id="å®‰è£…ä¾èµ–"><a href="#å®‰è£…ä¾èµ–" class="headerlink" title="å®‰è£…ä¾èµ–"></a>å®‰è£…ä¾èµ–</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo apt update</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo apt install make gcc flex bison libncurses-dev libelf-dev libssl-dev clang clang-format</span><br></code></pre></td></tr></table></figure>

<h2 id="é…ç½®-golang-ç¯å¢ƒ"><a href="#é…ç½®-golang-ç¯å¢ƒ" class="headerlink" title="é…ç½® golang ç¯å¢ƒ"></a>é…ç½® golang ç¯å¢ƒ</h2><p>é¦–å…ˆé…ç½® golang ç¯å¢ƒï¼Œå¯ä»¥å‚ç…§<a target="_blank" rel="noopener" href="https://golang.org/doc/install">å®˜æ–¹æ–‡æ¡£</a>ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">wget https://dl.google.com/go/go1.14.2.linux-amd64.tar.gz</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">tar -xf go1.14.2.linux-amd64.tar.gz</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">mv</span> go goroot</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">mkdir</span> gopath</span><br></code></pre></td></tr></table></figure>

<p>åœ¨ <code>/etc/profile</code> ä¸­å†™å…¥å¦‚ä¸‹é…ç½®ï¼Œé‡å¯ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ <code>YourGoPath</code><strong>åº”å½“æ›¿æ¢ä¸ºä½ å®é™…å­˜æ”¾ go çš„è·¯å¾„</strong>ï¼Œåœ¨ä¸Šä¸€æ­¥çš„ç»ˆç«¯ä¸­è¾“å…¥ <code>pwd</code> åå°†å…¶å€¼æ›¿æ¢åˆ°ä¸‹æ–¹</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">export</span> GOPATH=YourGoPath/gopath<br><span class="hljs-built_in">export</span> GOROOT=YourGoPath/goroot<br><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$GOPATH</span>/bin:<span class="hljs-variable">$PATH</span><br><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$GOROOT</span>/bin:<span class="hljs-variable">$PATH</span><br></code></pre></td></tr></table></figure>

<h2 id="ç¼–è¯‘-syzkaller"><a href="#ç¼–è¯‘-syzkaller" class="headerlink" title="ç¼–è¯‘ syzkaller"></a>ç¼–è¯‘ syzkaller</h2><p>å®‰è£… syzkaller æœ¬ä½“</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">go get -u -d github.com/google/syzkaller/prog</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">cd</span> gopath/src/github.com/google/syzkaller/</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">make</span><br></code></pre></td></tr></table></figure>

<h2 id="ç¼–è¯‘ç›®æ ‡å†…æ ¸"><a href="#ç¼–è¯‘ç›®æ ‡å†…æ ¸" class="headerlink" title="ç¼–è¯‘ç›®æ ‡å†…æ ¸"></a>ç¼–è¯‘ç›®æ ‡å†…æ ¸</h2><p>ä»é•œåƒç«™éšä¾¿æ‹‰ä¸€ä¸ªç‰ˆæœ¬çš„æºç è¿‡æ¥å°±è¡Œï¼Œç¬”è€…è¿™é‡Œæ‹‰äº†ä¸€ä¸ª 5.11 ç‰ˆæœ¬çš„å†…æ ¸</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">wget https://mirrors.tuna.tsinghua.edu.cn/kernel/v5.x/linux-5.11.tar.gz</span><br></code></pre></td></tr></table></figure>

<p>è§£å‹</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">tar -zxvf linux-5.11.tar.gz</span> <br></code></pre></td></tr></table></figure>

<p>ç„¶åæ‰§è¡Œä¸‹é¢è¿™ä¸¤æ¡æŒ‡ä»¤</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">make CC=<span class="hljs-string">&quot;/usr/bin/gcc&quot;</span> defconfig</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">make CC=<span class="hljs-string">&quot;/usr/bin/gcc&quot;</span> kvm_guest.config</span><br></code></pre></td></tr></table></figure>

<p>å¯¹äºè€ç‰ˆæœ¬å†…æ ¸ï¼Œåº”å½“ä¸ºï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">make CC=<span class="hljs-string">&quot;/usr/bin/gcc&quot;</span> defconfig</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">make CC=<span class="hljs-string">&quot;/usr/bin/gcc&quot;</span> kvmconfig</span><br></code></pre></td></tr></table></figure>

<p>æ¥ä¸‹æ¥ç¼–è¾‘ <code>.config</code> æ–‡ä»¶ï¼Œåœ¨å…¶æœ«å°¾æ·»åŠ å¦‚ä¸‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">CONFIG_KCOV=y<br>CONFIG_DEBUG_INFO=y<br>CONFIG_KASAN=y<br>CONFIG_KASAN_INLINE=y<br>CONFIG_CONFIGFS_FS=y<br>CONFIG_SECURITYFS=y<br></code></pre></td></tr></table></figure>

<p>æ¥ä¸‹æ¥å¼€å§‹ç¼–è¯‘å†…æ ¸ï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥ç®€å•å¼€ä¸€å±€ä½ å–œæ¬¢çš„æ¸¸æˆæ…¢æ…¢ç­‰å¾…ï¼ˆç¬‘ï¼‰</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">make CC=<span class="hljs-string">&quot;/usr/bin/gcc&quot;</span> olddefconfig</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">make CC=<span class="hljs-string">&quot;/usr/bin/gcc&quot;</span> -j64</span><br></code></pre></td></tr></table></figure>

<p>è¿™é‡Œç¬”è€…è¿˜é‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œ**ç¬”è€…çš„ gcc ç‰ˆæœ¬å¤ªé«˜äº†â€¦**äºæ˜¯ç¼–è¯‘çš„æ—¶å€™åˆå‡ºç°äº†è¿™ä¸ªé”™è¯¯ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">cc1: error: â€˜-fcf-protectionâ€™ is not compatible with this target<br></code></pre></td></tr></table></figure>

<p><strong>åˆ‡æ¢å›å®˜æ–¹æ¨èçš„ gcc8 åé‡æ–°è¿›è¡Œç¼–è¯‘</strong></p>
<blockquote>
<p>ç¬”è€…<del>å‘ç”Ÿæ´»å¦¥åäº†ï¼Œ</del>æš‚æ—¶æ²¡æ‰¾åˆ°é«˜ç‰ˆæœ¬ gcc åœ¨è¿™ä¸ªé…ç½®ä¸‹èƒ½å¤ŸæˆåŠŸç¼–è¯‘çš„æ–¹æ³•</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo apt-get install gcc-8 gcc-8-multilib</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo apt-get install g++-8 g++-8-multilib</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo update-alternatives --install /usr/bin/gcc gcc  /usr/bin/gcc-8 1</span><br></code></pre></td></tr></table></figure>

<p>å‡ºç°ä¸‹é¢è¿™è¡Œå°±æ ‡å¿—ç€ç¼–è¯‘å®Œæˆ</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">Kernel: arch/x86/boot/bzImage is ready  (#1)<br></code></pre></td></tr></table></figure>

<p>ç¼–è¯‘å‡ºæ¥çš„ bzImage åœ¨ <code>arch/x86/boot/bzImage</code>ï¼Œvmlinux åˆ™å°±åœ¨æºç æ ¹ç›®å½•ä¸‹ï¼Œè¿™ä¸¤ä¸ªæ–‡ä»¶å‰è€…æ˜¯å‹ç¼©åçš„å†…æ ¸åè€…æ˜¯åŸå§‹å†…æ ¸æ–‡ä»¶</p>
<h2 id="é…ç½®-ext4-ç¡¬ç›˜é•œåƒæ–‡ä»¶"><a href="#é…ç½®-ext4-ç¡¬ç›˜é•œåƒæ–‡ä»¶" class="headerlink" title="é…ç½® ext4 ç¡¬ç›˜é•œåƒæ–‡ä»¶"></a>é…ç½® ext4 ç¡¬ç›˜é•œåƒæ–‡ä»¶</h2><p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ <code>debootstrap</code> æ¥åˆ›å»ºext4ç¡¬ç›˜é•œåƒ</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo apt-get install debootstrap</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">mkdir</span> image</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">cd</span> image</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">wget https://raw.githubusercontent.com/google/syzkaller/master/tools/create-image.sh -O create-image.sh</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">chmod</span> +x create-image.sh</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">./create-image.sh</span><br></code></pre></td></tr></table></figure>

<blockquote>
<p>wget çš„è¿™ä¸€æ­¥<strong>éœ€è¦ç¿»å¢™</strong>ï¼ˆ<code>raw.githubusercontent.com</code> åœ¨å›½å†…ä¼¼ä¹æ˜¯è¢«å¢™äº†ï¼Œæ€»ä¹‹ç¬”è€…è®°å¿†é‡Œä»æ²¡æˆåŠŸåœ¨ä¸ç¿»å¢™çš„æƒ…å†µä¸‹æˆåŠŸä¸Šå»è¿‡ï¼‰ï¼Œè‹¥å«Œéº»çƒ¦å¯ä»¥ç›´æ¥ copy <a href="/download/create-image.sh">ç¬”è€…å·²ç»ä¸‹å¥½çš„</a></p>
</blockquote>
<p>è¿™ä¸€æ­¥ä¸çŸ¥é“æ˜¯å› ä¸ºç½‘ç»œåŸå› è¿˜æ˜¯åˆ«çš„åŸå› <strong>æ€»è€Œè¨€ä¹‹éå¸¸çš„æ…¢</strong>ï¼ˆæ¯”ä¸Šé¢ç¼–è¯‘å†…æ ¸è€—æ—¶è¿˜é•¿ï¼‰ï¼Œå®Œæˆä¹‹åå¦‚ä¸‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">ll</span><br>total 554772<br>drwxrwxr-x  3 arttnba3 arttnba3       4096 Nov 12 03:02 ./<br>drwxrwxr-x  7 arttnba3 arttnba3       4096 Nov 12 00:53 ../<br>drwxr-xr-x 21 root     root           4096 Nov 12 02:58 chroot/<br>-rwxrwxr-x  1 arttnba3 arttnba3       6360 Nov 11 23:25 create-image.sh*<br>-rw-------  1 arttnba3 arttnba3       2602 Nov 12 03:02 stretch.id_rsa<br>-rw-r--r--  1 arttnba3 arttnba3        569 Nov 12 03:02 stretch.id_rsa.pub<br>-rw-rw-r--  1 arttnba3 arttnba3 2147483648 Nov 12 03:02 stretch.img<br></code></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥åœ¨æ–‡ä»¶ç›®å½•ä¸‹æ‰¾åˆ°ä¸€ä¸ªåä¸º <code>stretch.img</code> çš„æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶å°±æ˜¯æ„å»ºå¥½çš„ç£ç›˜é•œåƒæ–‡ä»¶</p>
<h2 id="å®‰è£…-qemu"><a href="#å®‰è£…-qemu" class="headerlink" title="å®‰è£… qemu"></a>å®‰è£… qemu</h2><p>è¿™ä¸€æ­¥è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯å¦‚æœä½ å’Œç¬”è€…ä¸€æ ·åœ¨ VMware ä¸Šä½¿ç”¨ Linux åˆ™åº”å½“åœ¨è®¾ç½®ä¸­æŠŠ <code>è™šæ‹ŸåŒ– Intel VT-x/EPT æˆ– AMD-V/RVI(V)</code> æ‰“å¼€</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo apt install qemu-system-x86</span><br></code></pre></td></tr></table></figure>

<p>å®Œæˆè¿™ä¸€åˆ‡ä¹‹åçœ‹çœ‹å†…æ ¸æ˜¯å¦èƒ½å¤Ÿè¢«æˆåŠŸå¯åŠ¨ï¼Œå¯åŠ¨è„šæœ¬å¦‚ä¸‹ï¼ˆåˆ«å¿˜äº†æ›¿æ¢å†…æ ¸é•œåƒä¸ç¡¬ç›˜é•œåƒçš„è·¯å¾„ï¼‰ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span><br>qemu-system-x86_64 \<br>	-m 2G \<br>	-smp 2 \<br>	-kernel ./bzImage \<br>	-append <span class="hljs-string">&quot;console=ttyS0 root=/dev/sda earlyprintk=serial net.ifnames=0&quot;</span> \<br>	-drive file=./stretch.img,format=raw \<br>	-net user,host=10.0.2.10,hostfwd=tcp:127.0.0.1:10021-:22 \<br>	-net nic,model=e1000 \<br>	-enable-kvm \<br>	-nographic \<br>	-pidfile vm.pid \<br>	2&gt;&amp;1 | <span class="hljs-built_in">tee</span> vm.log<br></code></pre></td></tr></table></figure>

<p>é»˜è®¤ root è´¦æˆ·æ— å¯†ç ï¼ŒæˆåŠŸç™»å…¥</p>
<p><img src="https://i.loli.net/2021/11/12/v5sQXyulgK92Mq1.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p>å‰é¢åœ¨é…ç½®ç¡¬ç›˜é•œåƒæ–‡ä»¶æ—¶è¿˜ç»™æˆ‘ä»¬æä¾›äº† ssh keyï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨ ssh æ¥ç›´æ¥è¿æ¥è‡³è™šæ‹Ÿæœºï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">ssh -i ./stretch.id_rsa -p 10021 -o <span class="hljs-string">&quot;StrictHostKeyChecking no&quot;</span> root@localhost</span><br></code></pre></td></tr></table></figure>

<p>è‡³æ­¤ï¼Œéœ€è¦çš„ç¯å¢ƒå°±éƒ½é…ç½®å®Œæˆäº†</p>
<h1 id="0x02-å¼€å§‹ä½¿ç”¨-syzkaller"><a href="#0x02-å¼€å§‹ä½¿ç”¨-syzkaller" class="headerlink" title="0x02.å¼€å§‹ä½¿ç”¨ syzkaller"></a>0x02.å¼€å§‹ä½¿ç”¨ syzkaller</h1><h2 id="PRE-å·¥ä½œåŸç†"><a href="#PRE-å·¥ä½œåŸç†" class="headerlink" title="PRE.å·¥ä½œåŸç†"></a><em>PRE.å·¥ä½œåŸç†</em></h2><p>å¯¹äº syzkaller çš„æ¶æ„ï¼Œå®˜æ–¹ç»™å‡ºäº†è¿™æ ·çš„ä¸€å¼  Overview</p>
<p><img src="https://i.loli.net/2021/11/11/LxNvdhpEX2sBjYc.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<ul>
<li><p><code>syz-manager</code> ï¼šsyzkaller çš„æ§åˆ¶ä¸­æ¢ï¼Œå…¶ä¼šå¯åŠ¨å¤šä¸ª VM å®ä¾‹ï¼ˆå¦‚å›¾æ‰€ç¤ºçš„ä¸€ä¸ªé»„è‰²å¡ç‰‡å°±æ˜¯ä¸€ä¸ªå®ä¾‹ï¼‰å¹¶è¿›è¡Œç›‘è§†ï¼ŒåŒæ—¶é€šè¿‡ RPC æ¥å¯åŠ¨ <code>syz-fuzzer</code></p>
</li>
<li><p><code>syz-fuzzer</code> ï¼šè´Ÿè´£å¼•å¯¼æ•´ä¸ª fuzz çš„è¿‡ç¨‹ï¼š</p>
<ul>
<li>ç”Ÿæˆ input</li>
<li>å¯åŠ¨ <code>syz-executor</code> è¿›ç¨‹è¿›è¡Œ fuzz</li>
<li>ä»è¢« fuzz çš„ kernel çš„ <code>/sys/kernel/debug/kcov</code> è·å¾—è¦†ç›–ï¼ˆcoverageï¼‰çš„ç›¸å…³ä¿¡æ¯</li>
<li>é€šè¿‡ RPC å°†æ–°çš„è¦†ç›–å›é€åˆ° <code>syz-manager</code></li>
</ul>
</li>
<li><p><code>syz-executor</code>ï¼šè´Ÿè´£<strong>æ‰§è¡Œå•ä¸ªè¾“å…¥</strong>â€”â€”ä» <code>syz-fuzzer</code> å¤„æ¥å— input å¹¶æ‰§è¡Œï¼Œæœ€åå›é€ç»“æœ</p>
</li>
</ul>
<h2 id="é…ç½®æ–‡ä»¶ï¼ˆfor-testï¼‰"><a href="#é…ç½®æ–‡ä»¶ï¼ˆfor-testï¼‰" class="headerlink" title="é…ç½®æ–‡ä»¶ï¼ˆfor testï¼‰"></a>é…ç½®æ–‡ä»¶ï¼ˆfor testï¼‰</h2><p>æˆ‘ä»¬éœ€è¦ä¸º syzkaller ç¼–å†™é¢å¤–çš„é…ç½®æ–‡ä»¶ï¼Œä¸€ä¸ªç®€å•çš„ä¾‹å­å¦‚ä¸‹ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„æ›¿æ¢ä¸ºä½ è‡ªå·±çš„è·¯å¾„ï¼ŒåŒ…æ‹¬ <code>workdir</code> æ–‡ä»¶å¤¹ä½ åº”å½“æ‰‹åŠ¨ mkdir ä¸€ä¸ªï¼š</p>
<blockquote>
<p>config.cfg</p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;target&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;linux/amd64&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;http&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;127.0.0.1:56741&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;workdir&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;/home/arttnba3/Documents/golang/gopath/src/github.com/google/syzkaller/workdir&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;kernel_obj&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;/home/arttnba3/Desktop/kernel/linux-5.11&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;image&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;/home/arttnba3/Desktop/kernel/image/stretch.img&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;sshkey&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;/home/arttnba3/Desktop/kernel/image/stretch.id_rsa&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;syzkaller&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;/home/arttnba3/Documents/golang/gopath/src/github.com/google/syzkaller&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;procs&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">8</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;qemu&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;vm&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;count&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">4</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;kernel&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;/home/arttnba3/Desktop/kernel/syzkaller/bzImage&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;cpu&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;mem&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2048</span><br>        <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<h2 id="å¯åŠ¨-syzkaller"><a href="#å¯åŠ¨-syzkaller" class="headerlink" title="å¯åŠ¨ syzkaller"></a>å¯åŠ¨ syzkaller</h2><p>åœ¨ syzkaller ç›®å½•ä¸‹è¾“å…¥å¦‚ä¸‹å‘½ä»¤å¯åŠ¨ syzkallerï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">./bin/syz-manager -config=config.cfg</span><br></code></pre></td></tr></table></figure>

<p>æˆåŠŸå¯åŠ¨åæˆ‘ä»¬å¯ä»¥é€šè¿‡è®¿é—® <code>localhost:56741</code> æ¥è·å– syzkaller çš„çŠ¶æ€ï¼Œæ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://i.loli.net/2021/11/12/BnYuNbO2MdiEw5V.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<h3 id="å¯èƒ½ä¼šé‡åˆ°çš„é—®é¢˜"><a href="#å¯èƒ½ä¼šé‡åˆ°çš„é—®é¢˜" class="headerlink" title="*å¯èƒ½ä¼šé‡åˆ°çš„é—®é¢˜"></a><em>*å¯èƒ½ä¼šé‡åˆ°çš„é—®é¢˜</em></h3><h4 id="æ— æ³•å¯åŠ¨-vm-instance"><a href="#æ— æ³•å¯åŠ¨-vm-instance" class="headerlink" title="æ— æ³•å¯åŠ¨ vm instance"></a>æ— æ³•å¯åŠ¨ vm instance</h4><p>æœ‰å¯èƒ½ä¼šé‡åˆ°æ— æ³•å¯åŠ¨ vm instance çš„é—®é¢˜ï¼ŒæŠ¥é”™å½¢å¼å¤§è‡´å¦‚ä¸‹ï¼š</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs llvm">qemu-system-<span class="hljs-keyword">x</span><span class="hljs-number">86</span>_<span class="hljs-number">64</span>: error: failed <span class="hljs-keyword">to</span> set MSR <span class="hljs-number">0x48f</span> <span class="hljs-keyword">to</span> <span class="hljs-number">0x7fffff00036dfb</span><br>qemu-system-<span class="hljs-keyword">x</span><span class="hljs-number">86</span>_<span class="hljs-number">64</span>: ../../<span class="hljs-keyword">target</span>/<span class="hljs-type">i386</span>/kvm/kvm.<span class="hljs-keyword">c</span>:<span class="hljs-number">2753</span>: kvm_buf_set_msrs: Assertion `<span class="hljs-keyword">ret</span> <span class="hljs-operator">=</span><span class="hljs-operator">=</span> cpu-&gt;kvm_msr_buf-&gt;nmsrs&#x27; failed.<br></code></pre></td></tr></table></figure>

<p>æŒ‰ç…§å®˜æ–¹ç»™å‡ºçš„è§£å†³åŠæ³•æ˜¯åœ¨ qemu çš„å¯åŠ¨å‚æ•°ä¸­å»æ‰ <code>-cpu host,migratable=off</code>ï¼Œæˆ‘ä»¬éœ€è¦åœ¨é…ç½®æ–‡ä»¶çš„ <code>vm</code> é¡¹ä¸­æ·»åŠ  <code>qemu-args</code>é¡¹ï¼Œå€¼ä¸º <code>-enable-kvm</code>ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>	<span class="hljs-attr">&quot;target&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;linux/amd64&quot;</span><span class="hljs-punctuation">,</span><br>	<span class="hljs-attr">&quot;http&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;127.0.0.1:56741&quot;</span><span class="hljs-punctuation">,</span><br>	<span class="hljs-attr">&quot;workdir&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;/home/arttnba3/Documents/golang/gopath/src/github.com/google/syzkaller/workdir&quot;</span><span class="hljs-punctuation">,</span><br>	<span class="hljs-attr">&quot;kernel_obj&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;/home/arttnba3/Desktop/kernel/linux-5.11&quot;</span><span class="hljs-punctuation">,</span><br>	<span class="hljs-attr">&quot;image&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;/home/arttnba3/Desktop/kernel/image/stretch.img&quot;</span><span class="hljs-punctuation">,</span><br>	<span class="hljs-attr">&quot;sshkey&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;/home/arttnba3/Desktop/kernel/image/stretch.id_rsa&quot;</span><span class="hljs-punctuation">,</span><br>	<span class="hljs-attr">&quot;syzkaller&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;/home/arttnba3/Documents/golang/gopath/src/github.com/google/syzkaller&quot;</span><span class="hljs-punctuation">,</span><br>	<span class="hljs-attr">&quot;procs&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">8</span><span class="hljs-punctuation">,</span><br>	<span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;qemu&quot;</span><span class="hljs-punctuation">,</span><br>	<span class="hljs-attr">&quot;vm&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>		<span class="hljs-attr">&quot;count&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">4</span><span class="hljs-punctuation">,</span><br>		<span class="hljs-attr">&quot;kernel&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;/home/arttnba3/Desktop/kernel/syzkaller/bzImage&quot;</span><span class="hljs-punctuation">,</span><br>		<span class="hljs-attr">&quot;cpu&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span><br>		<span class="hljs-attr">&quot;mem&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2048</span><span class="hljs-punctuation">,</span><br>		<span class="hljs-attr">&quot;qemu_args&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;-enable-kvm&quot;</span><br>	<span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<h4 id="ç½‘ç»œè®¾å¤‡é—®é¢˜"><a href="#ç½‘ç»œè®¾å¤‡é—®é¢˜" class="headerlink" title="ç½‘ç»œè®¾å¤‡é—®é¢˜"></a>ç½‘ç»œè®¾å¤‡é—®é¢˜</h4><p>åœ¨ syzkaller æŒ–æ˜è¿‡ç¨‹ä¸­å¯èƒ½å‡ºç°å¦‚ä¸‹æŠ¥é”™ä¿¡æ¯ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">[FAILED] Failed to start Raise network interfaces.<br></code></pre></td></tr></table></figure>

<p>è™½ç„¶ä¼¼ä¹è¿˜æ˜¯èƒ½æ­£å¸¸å¯åŠ¨çš„</p>
<h2 id="crash-åˆ†æ"><a href="#crash-åˆ†æ" class="headerlink" title="crash åˆ†æ"></a>crash åˆ†æ</h2><p>ç¬”è€…æœ¬æ¥æƒ³å†™ä¸€ä¸ªæœ‰æ¼æ´ç‚¹å†…æ ¸æ¨¡å—æ¥äººä¸ºåˆ¶é€  crashï¼Œä¸è¿‡ç°åœ¨åˆšå¼€æŒ–æ²¡å‡ åˆ†é’Ÿå°±å‡ºäº†ä¸€ä¸ª crashï¼Œç”±äºç”¨çš„æ˜¯ 5.11 ç‰ˆæœ¬çš„å†…æ ¸ï¼Œå·²ç»ä¸ç®—å¤ªæ–°äº†ï¼Œç¬”è€…è®¤ä¸ºåº”è¯¥æ˜¯æŒ–åˆ°äº†ç°æœ‰çš„ CVEï¼Œé€šè¿‡ Google ç¬”è€…ä¹Ÿæ‰¾åˆ°äº†ä¸€ä¸ª<a target="_blank" rel="noopener" href="https://syzkaller.appspot.com/bug?id=ad240ff5c32ca4f3406dc3acca519370693bb47c">åŸºæœ¬ä¸Šæ˜¯ä¸€æ ·çš„ crash</a>ï¼Œä¸è¿‡æˆ‘ä»¬è¿˜æ˜¯æ¥ç®€å•åˆ†æä¸€ä¸‹</p>
<p><img src="https://i.loli.net/2021/11/12/7EHYatBoG6KFxqR.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p>åœ¨ Description é¡¹ä¸­è¯´æ˜äº† crash çš„ç®€è¦ä¿¡æ¯ï¼Œç‚¹å¼€åˆ†ä¸ºä¸¤é¡¹ï¼š<code>log</code> å’Œ <code>report</code></p>
<p><img src="https://i.loli.net/2021/11/12/Q6dBoPOHm7sRtgI.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p>log ä¸­ç»™å‡ºçš„æ˜¯ fuzz çš„æµç¨‹ï¼ŒåŒ…æ‹¬è¿è¡Œçš„ç³»ç»Ÿè°ƒç”¨ã€è¾“å…¥å‚æ•°ç­‰ä¸€ç³»åˆ—ä¿¡æ¯ï¼Œå› ä¸ºæ˜¯è‡ªåŠ¨ç”Ÿæˆçš„æ‰€ä»¥ä¸€èˆ¬ä¸ä¼šç‰¹åˆ«å¥½çœ‹</p>
<p><img src="https://i.loli.net/2021/11/12/ANwKC67iRQL2ZHt.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p>report ä¸­ç»™å‡ºçš„åˆ™æ˜¯ kernel ç›¸å…³ä¿¡æ¯ï¼Œä¾‹å¦‚è°ƒç”¨æ ˆå›æº¯ç­‰</p>
<p><img src="https://i.loli.net/2021/11/12/UvNkQe7ElAHSKm6.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p>æ¯”è¾ƒå¯æƒœçš„æ˜¯è¿™ä¸ª crash <strong>æ²¡æ³•é‡ç°</strong>ï¼Œåœ¨ä¸€ä¸ª crash åˆšåˆšç”Ÿæˆæ—¶ syzkaller ä¼šå°è¯•è¿›è¡Œé‡ç°ï¼Œæ­¤æ—¶ report çš„çŠ¶æ€ä¼šæ˜¾ç¤ºä¸º <code>reproducing</code>ï¼Œè‹¥æˆåŠŸäº†åˆ™ä¼šæ˜¾ç¤ºå¯¹åº”çš„ç»“æœï¼Œå“ç›¸æ¯”è¾ƒå¥½çš„ä¸€ç§ report å°±æ˜¯ <code>has C repo</code>ï¼šæœ‰äº§ç”Ÿè¯¥ crash çš„ C ä»£ç </p>
<p><img src="https://i.loli.net/2021/11/12/l47kcaVMS9wH6u5.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<h1 id="0x03-ä½¿ç”¨-syzlang-ç¼–å†™æè¿°æ–‡ä»¶è¿›è¡Œ-fuzz"><a href="#0x03-ä½¿ç”¨-syzlang-ç¼–å†™æè¿°æ–‡ä»¶è¿›è¡Œ-fuzz" class="headerlink" title="0x03.ä½¿ç”¨ syzlang ç¼–å†™æè¿°æ–‡ä»¶è¿›è¡Œ fuzz"></a>0x03.ä½¿ç”¨ syzlang ç¼–å†™æè¿°æ–‡ä»¶è¿›è¡Œ fuzz</h1><p>ç›´æ¥å°±è¿™æ ·æŒ‚ç€è‚¯å®šä¸èƒ½ç›´æ¥å°±æŠŠæ´æŒ–å‡ºæ¥<del>è™½ç„¶ç¬”è€…å‰é¢æ²¡æŒ‚ä¸€ä¼šå°±å‡ºäº†ä¸€ä¸ªcrash</del>ï¼Œå› æ­¤æ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦äººå·¥é…ç½®ç³»ç»Ÿè°ƒç”¨æ¨¡æ¿ï¼Œä»¥<strong>æœ‰é’ˆå¯¹æ€§åœ°</strong>è¿›è¡Œæ¼æ´æŒ–æ˜</p>
<p>syzkaller ä½¿ç”¨å®ƒè‡ªå·±çš„å£°æ˜å¼è¯­è¨€ï¼ˆSyscall Description Languageï¼Œaka <code>syzlang</code>ï¼ˆè¯»ä½œ <code>[siËzËˆlÃ¦Å‹g]</code>ï¼Œ<del>ç¬”è€…ä»¥å‰ä¸€ç›´è¯»ä½œ [saiËzËˆlÃ¦Å‹g]â€¦</del>ï¼‰ï¼‰æ¥æè¿°ç³»ç»Ÿè°ƒç”¨æ¨¡æ¿ï¼Œåœ¨å®‰è£…ç›®å½•ä¸‹çš„ <code>docs/syscall_descriptions.md</code> ä¸ <code>docs/syscall_descriptions_syntax.md</code> ä¸­æœ‰ç€ç›¸å…³çš„è¯´æ˜ï¼Œåœ¨ç¬”è€…çœ‹æ¥æ˜¯ç±»ä¼¼ C çš„ä¸€é—¨æè¿°è¯­è¨€</p>
<p>æˆ‘ä»¬éœ€è¦ä½¿ç”¨ syzlang æ¥ç¼–å†™ç‰¹å®šçš„ç³»ç»Ÿè°ƒç”¨æè¿°æ–‡ä»¶ï¼ˆä¹Ÿå«è§„åˆ™æ–‡ä»¶ï¼Œåæ–‡ä¸­è¿™ä¸¤ä¸ªè¯æŒ‡çš„æ˜¯åŒä¸€ä¸ªä¸œè¥¿ï¼‰ï¼Œsyzkaller ä¼šæ ¹æ®æˆ‘ä»¬çš„æè¿°æ–‡ä»¶æœ‰é’ˆå¯¹æ€§åœ°è¿›è¡Œ fuzz</p>
<p><a target="_blank" rel="noopener" href="https://github.com/google/syzkaller/blob/master/sys/linux/sys.txt">è¿™æ˜¯ Google ç»™å‡ºçš„ä¸€ä¸ªä¾‹å­</a></p>
<blockquote>
<p>ç¬”è€…çœ‹ç€ä¹Ÿæ˜¯æ¯”è¾ƒå¤´å¤§çš„â€¦è¿˜æ˜¯æ…¢æ…¢æ¥å§â€¦</p>
<p>ä»¥ä¸‹ä¸»è¦æ˜¯ç¿»è¯‘è°·æ­Œå®˜æ–¹çš„æ–‡æ¡£ï¼ˆ<del>è°å«å›½å†…æ²¡æœ‰ä¸­æ–‡æ–‡æ¡£å‘¢</del>ï¼‰ï¼Œå¤–åŠ ä¸€äº›ç¬”è€…è‡ªå·±æœ¬äººçš„ç†è§£ä»¥åŠè¡¥å……è¯´æ˜</p>
</blockquote>
<h2 id="syzlang-è¯­æ³•"><a href="#syzlang-è¯­æ³•" class="headerlink" title="syzlang è¯­æ³•"></a>syzlang è¯­æ³•</h2><p>syzlang çš„è¯­æ³•ç»“æ„å¦‚ä¸‹ï¼Œ<del>çœ‹å®Œä½ ä¹Ÿèƒ½å¿«é€Ÿä¸Šæ‰‹ï¼</del>ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs syzlang">syscallname &quot;(&quot; [arg [&quot;,&quot; arg]*] &quot;)&quot; [type] [&quot;(&quot; attribute* &quot;)&quot;]<br>arg = argname type<br>argname = identifier<br>type = typename [ &quot;[&quot; type-options &quot;]&quot; ]<br>typename = &quot;const&quot; | &quot;intN&quot; | &quot;intptr&quot; | &quot;flags&quot; | &quot;array&quot; | &quot;ptr&quot; |<br>	   &quot;string&quot; | &quot;strconst&quot; | &quot;filename&quot; | &quot;glob&quot; | &quot;len&quot; |<br>	   &quot;bytesize&quot; | &quot;bytesizeN&quot; | &quot;bitsize&quot; | &quot;vma&quot; | &quot;proc&quot;<br>type-options = [type-opt [&quot;,&quot; type-opt]]<br></code></pre></td></tr></table></figure>

<blockquote>
<p>è¿™ä¸ªæ—¶å€™ä½ éœ€è¦æŠŠè‡ªå·±å½“ä½œä¸€ä¸ª scanner + parserï¼ˆå¤§é›¾</p>
<p><del>æ­£åˆ™è¡¨è¾¾å¼ç›¸ä¿¡å¤§å®¶åº”è¯¥éƒ½å­¦è¿‡ï¼Œå“ªæ€•æ²¡å­¦è¿‡ç¼–è¯‘åŸç†è¯¾ä¸Šä½ æ€»ä¼šå­¦åˆ°çš„ï¼Œé‚£ä¹ˆæŒ‰ç…§æ­£åˆ™æ¥çœ‹çš„è¯å…¶å®è¿™ä¸ªè¯­æ³•ç»“æ„å¹¶ä¸éš¾è§£æ</del>ï¼ˆ</p>
</blockquote>
<p>ä»¥ä¸‹æ˜¯å¯¹å…¶ä¸­çš„ä¸€äº›ç¬¦å·è¯´æ˜ï¼Œ<strong>ä¸æ˜¯ syzlang å®é™…è¯­æ³•å†…å®¹</strong>ï¼š</p>
<ul>
<li>åŒå¼•å· <code>&quot;&quot; </code>è¡¨ç¤ºè¿™ä¸ªç¬¦å·å†…çš„ä¸œè¥¿è¡¨ç¤º<strong>è¦æŒ‰å…¶åŸæ ·è¿›è¡ŒåŒ¹é…</strong>ï¼Œä¸¢å¼ƒåŒå¼•å·</li>
<li>æˆ–ç¬¦å· <code>|</code> è¡¨ç¤ºå€¼å¯ä»¥å–å·¦è¾¹ä¹Ÿå¯ä»¥å–å³è¾¹</li>
<li>ç­‰äºå· <code>=</code> è¡¨ç¤ºå·¦è¾¹çš„è¡¨è¾¾å¼åº”å½“ä¸ºå³è¾¹çš„å½¢å¼</li>
<li>ä¸­æ‹¬å· <code>[]</code> è¡¨ç¤ºä¸€ä¸ª<strong>å¯é€‰è¡¨è¾¾å¼</strong>ï¼Œå–å…¶å†…çš„å€¼å¹¶ä¸¢å¼ƒä¸­æ‹¬å·</li>
<li>æ˜Ÿå· <code>*</code> è¡¨ç¤º<strong>é—­åŒ…</strong>ï¼Œå³ 0 æ¬¡æˆ–å¤šæ¬¡çš„è‡ªæˆ‘è¿æ¥  <del>ä»€ä¹ˆï¼Ÿä½ è¿˜æ²¡å­¦è¿‡ç¦»æ•£æ•°å­¦</del></li>
</ul>
<p>è¿™æ˜¯è°·æ­Œå®˜æ–¹ç»™å‡ºçš„ä¸€ä¸ªä¾‹å­ï¼š</p>
<blockquote>
<p><code>syzkaller</code> uses declarative description of syscall interfaces to manipulate programs (sequences of syscalls). Below you can see (hopefully self-explanatory) excerpt from the descriptions:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs syzlang">open(file filename, flags flags[open_flags], mode flags[open_mode]) fd<br>read(fd fd, buf buffer[out], count len[buf])<br>close(fd fd)<br>open_mode = S_IRUSR, S_IWUSR, S_IXUSR, S_IRGRP, S_IWGRP, S_IXGRP, S_IROTH, S_IWOTH, S_IXOTH<br></code></pre></td></tr></table></figure>

<p><del>æ–¯å¯†ğŸ¦„èµ›ï¼ŒğŸ‘´æ²¡æ³•åšåˆ° self-explanatory</del></p>
</blockquote>
<h3 id="O-æ³¨é‡Šä¸æ–‡ä»¶åŒ…å«"><a href="#O-æ³¨é‡Šä¸æ–‡ä»¶åŒ…å«" class="headerlink" title="O.æ³¨é‡Šä¸æ–‡ä»¶åŒ…å«"></a>O.æ³¨é‡Šä¸æ–‡ä»¶åŒ…å«</h3><p>syzlang ä¸­çš„æ³¨é‡Šä¸ shell è„šæœ¬æ³¨é‡Šå½¢å¼ç›¸åŒï¼Œä¸ºä»¥ <code>#</code> å¼€å¤´çš„å•è¡Œæ³¨é‡Š</p>
<p>è¿™æ˜¯ä¸€ä¸ªğŸŒ°ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs syzlang"># this is a useful sentence! do not delete it!<br></code></pre></td></tr></table></figure>

<p>åœ¨ syzlang ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é¢å¤–å¼•å…¥<strong>å†…æ ¸æºç æ–‡ä»¶</strong>ä½œä¸ºå‚æ•°ã€ç³»ç»Ÿè°ƒç”¨â€¦ç­‰ç­‰ä¸€ç³»åˆ—çš„è¡¥å……ï¼Œå½¢å¼ä¸ C è¯­è¨€çš„ include è¯­å¥å¤§è‡´ç›¸åŒï¼Œä¸è¿‡**æ²¡æœ‰äº†å¼€å¤´çš„â€#â€**ï¼ˆå› ä¸º # å¼€å¤´æ˜¯æ³¨é‡Šï¼‰</p>
<p>è¿™æ˜¯ä¸€ä¸ªğŸŒ°ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs syzlang">include &lt;linux/fs.h&gt;<br></code></pre></td></tr></table></figure>

<h3 id="I-å‚æ•°ï¼ˆargï¼‰ä¸å‚æ•°åï¼ˆargnameï¼‰"><a href="#I-å‚æ•°ï¼ˆargï¼‰ä¸å‚æ•°åï¼ˆargnameï¼‰" class="headerlink" title="I.å‚æ•°ï¼ˆargï¼‰ä¸å‚æ•°åï¼ˆargnameï¼‰"></a>I.å‚æ•°ï¼ˆargï¼‰ä¸å‚æ•°åï¼ˆargnameï¼‰</h3><p>æˆ‘ä»¬è¾“å…¥ç»™ç³»ç»Ÿè°ƒç”¨æ¨¡æ¿çš„ <code>å‚æ•° ï¼ˆargï¼‰</code> åº”å½“ä¸ºå¦‚ä¸‹å½¢å¼ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs syzlang">arg = argname type<br></code></pre></td></tr></table></figure>

<p>å³ä¸€ä¸ªå‚æ•°ç”± <code>å‚æ•°å ï¼ˆargnameï¼‰  </code> ä¸ <code>ç±»å‹ï¼ˆtypeï¼‰</code> ç»„æˆ</p>
<p>å…¶ä¸­ï¼Œå‚æ•°åä¾¿æ˜¯ <code>æ ‡è¯†ç¬¦ï¼ˆidentifierï¼‰</code></p>
<h4 id="example"><a href="#example" class="headerlink" title="example"></a>example</h4><p>è¿™ä¹ˆè®²æœ‰äº›ç©ºæ³›ï¼Œæˆ‘ä»¬æ¥ç®€å•çœ‹ä¸€ä¸ªä¾‹å­ï¼Œåœ¨ Linux ä¸­ç³»ç»Ÿè°ƒç”¨ <code>read</code> çš„å£°æ˜ï¼ˆå…¶å®æ˜¯å®šä¹‰ï¼‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">SYSCALL_DEFINE3(read, <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>, fd, <span class="hljs-type">char</span> __user *, buf, <span class="hljs-type">size_t</span>, count)<br></code></pre></td></tr></table></figure>

<p>å½“æˆ‘ä»¬ä½¿ç”¨ libc çš„ wrapper è¿›è¡Œ read ç³»ç»Ÿè°ƒç”¨æ—¶ï¼Œå½¢å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> 	my_file_fd = open(<span class="hljs-string">&quot;/dev/a3dev&quot;</span>, O_RDONLY);<br><span class="hljs-type">char</span> 			my_buf[<span class="hljs-number">114514</span>];<br><span class="hljs-type">size_t</span>			my_count = <span class="hljs-number">114514</span>;<br>read(my_file_fd, my_buf, my_count);<br></code></pre></td></tr></table></figure>

<p>åœ¨è¿™ä¸ªä¾‹å­å½“ä¸­ï¼Œ<code>fdã€bufã€count</code> ä¾¿æ˜¯ <strong>argname</strong>ï¼Œ<code>my_file_fdã€my_bufã€my_count</code> ä¾¿æ˜¯ <strong>type</strong></p>
<p>é‚£ä¹ˆï¼Œåœ¨æˆ‘ä»¬ä½¿ç”¨ syzlang ç¼–å†™ç³»ç»Ÿè°ƒç”¨æ¨¡æ¿æ—¶ï¼Œä¾‹å¦‚ read çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œæˆ‘ä»¬åº”è¯¥å†™æˆä¸‹é¢è¿™ä¸ªæ ·å­ï¼ˆå‡è®¾ my_file_fd å·²å®šä¹‰ä¸ºä¸€ä¸ª <code>resources</code>ï¼ˆåé¢ä¼šè®²ï¼‰ï¼‰ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs syzlang">fd my_file_fd<br></code></pre></td></tr></table></figure>

<h3 id="II-ç±»å‹ï¼ˆtypeï¼‰"><a href="#II-ç±»å‹ï¼ˆtypeï¼‰" class="headerlink" title="II.ç±»å‹ï¼ˆtypeï¼‰"></a>II.ç±»å‹ï¼ˆtypeï¼‰</h3><blockquote>
<p>å…¶å®è¿™ä¹ˆç¿»è¯‘ç¬”è€…è§‰å¾—å¥½åƒä¸å¤§å‡†ç¡®ï¼Œä¸è¿‡ç¬”è€…è‹±æ–‡ä¸å¤§è¡Œæ‰€ä»¥è¿™é‡Œæš‚ä¸”ç›´è¯‘â€¦</p>
</blockquote>
<p>å‰é¢æˆ‘ä»¬è®²åˆ°ä¸€ä¸ª <code>arg</code> ç”± ä¸€ä¸ª <code>argname </code>ä¸ <code>type</code> ç»„æˆï¼Œargname æˆ‘ä»¬å·²ç»è®²äº†ï¼Œç°åœ¨æˆ‘ä»¬æ¥è®² type</p>
<p>type çš„å®šä¹‰åŒæ ·ç”±ä¸¤éƒ¨åˆ†ç»„æˆâ€”â€”<code>ç±»å‹åï¼ˆtypenameï¼‰</code> ä¸ <code>ç±»å‹é€‰é¡¹ï¼ˆtype-optionsï¼‰</code>ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs syzlang">type = typename [ &quot;[&quot; type-options &quot;]&quot; ]<br></code></pre></td></tr></table></figure>

<h4 id="ç±»å‹åï¼ˆtypenameï¼‰"><a href="#ç±»å‹åï¼ˆtypenameï¼‰" class="headerlink" title="ç±»å‹åï¼ˆtypenameï¼‰"></a>ç±»å‹åï¼ˆtypenameï¼‰</h4><p>å³è¯¥ type çš„ç±»å‹ï¼Œä¾‹å¦‚ C å½“ä¸­çš„intã€charã€void ç­‰ç­‰</p>
<p>å¸¸è§„é€‰é¡¹åŒ…æ‹¬ï¼š</p>
<ul>
<li><strong>opt</strong>ï¼šè¿™æ˜¯ä¸€ä¸ªå¯é€‰å‚æ•°ï¼ˆä¾‹å¦‚ mmap çš„ fdï¼‰</li>
</ul>
<p>å…¶ä½™ type-options æ˜¯åŸºäºç‰¹å®š type çš„ï¼Œå¦‚ä¸‹ï¼š</p>
<ul>
<li><p><strong>const</strong>ï¼šæ•´å‹å¸¸æ•°</p>
<ul>
<li>ç±»å‹é€‰é¡¹ï¼š<ul>
<li>å€¼ï¼ˆvalueï¼‰ï¼šä¾‹å¦‚ <code>0</code></li>
<li>åŸºç¡€ç±»å‹ï¼ˆunderlying typeï¼‰ï¼š<code>intN</code> æˆ– <code>intptr</code> ä¹‹ä¸€</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>intN</strong> æˆ– <strong>intptr</strong>ï¼šä¸€ä¸ªæœ‰ç€ç‰¹æ®Šå«ä¹‰çš„æ•´å‹ï¼Œä¸‹æ–‡ä¼šè¿›è¡Œè¯¦ç»†è¯´æ˜</p>
<ul>
<li>ç±»å‹é€‰é¡¹ï¼š<ul>
<li>å¯é€‰èŒƒå›´åŒºé—´ï¼šä¾‹å¦‚ <code>&quot;1:100&quot;</code> è¡¨ç¤ºå–å€¼å€¼çš„åŒºé—´ä¸º <code>[1, 100]</code></li>
<li>å¯é€‰å‚æ•°</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>flags</strong>ï¼šå€¼çš„é›†åˆ</p>
<ul>
<li>ç±»å‹é€‰é¡¹ï¼š<ul>
<li>å¯¹ flags æè¿°çš„å¼•ç”¨</li>
<li>åŸºç¡€æ•´å‹ç±»å‹ï¼šä¾‹å¦‚ <code>int32</code></li>
</ul>
</li>
</ul>
</li>
<li><p><strong>array</strong>ï¼šä¸€ä¸ªå¯å˜é•¿&#x2F;å›ºå®šé•¿åº¦çš„æ•°ç»„</p>
<ul>
<li>ç±»å‹é€‰é¡¹ï¼š<ul>
<li>å…ƒç´ çš„ type</li>
<li>å¯é€‰é•¿åº¦åŒºé—´ï¼šä¾‹å¦‚å›ºå®šé•¿åº¦ <code>&quot;5&quot;</code> æˆ–è€…é•¿åº¦èŒƒå›´ <code>&quot;5:10&quot;</code>ï¼ˆåŒ…æ‹¬è¾¹ç•Œï¼‰</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>ptr</strong> æˆ– <strong>ptr64</strong>ï¼šæŒ‡å‘ä¸€ä¸ªå¯¹è±¡çš„æŒ‡é’ˆ</p>
<ul>
<li>ç±»å‹é€‰é¡¹ï¼š<ul>
<li>æ–¹å‘ï¼š<code>in</code> æˆ– <code>out</code> æˆ– <code>inout</code></li>
<li>å¯¹è±¡çš„ type</li>
</ul>
</li>
<li>æ— è®ºå¯¹è±¡æŒ‡é’ˆå¤§å°å¦‚ä½•ï¼Œptr64 æ°¸è¿œä¸º 8 å­—èŠ‚</li>
</ul>
</li>
<li><p><strong>string</strong>ï¼šä¸€å—æœ‰ç€ 0 ç»ˆæ­¢ç¬¦çš„å†…å­˜ç¼“å†²åŒº</p>
<ul>
<li>ç±»å‹é€‰é¡¹ï¼š<ul>
<li>å¸¸é‡å­—ç¬¦ä¸²&#x2F;å¯¹å­—ç¬¦ä¸²çš„å¼•ç”¨<ul>
<li>å‰è€…ï¼šä¾‹å¦‚ <code>&quot;foo&quot;</code>ä½œä¸ºå¸¸è§„å­—ç¬¦ä¸²è¿›è¡Œè§£æï¼Œæˆ–è€…`deadbeef`ä½œä¸º4ä¸ª 16 è¿›åˆ¶å­—èŠ‚è¿›è¡Œè§£æ</li>
<li>åè€…ï¼šè‹¥æ˜¯ç‰¹æ®Šç±»å‹ <code>filename</code> åˆ™ä¼š<strong>ç”Ÿæˆ</strong>æ–‡ä»¶å</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>stringnoz</strong>ï¼šä¸€å—<strong>æ²¡æœ‰</strong> 0 ç»ˆæ­¢ç¬¦çš„å†…å­˜ç¼“å†²åŒº</p>
<ul>
<li>ç±»å‹é€‰é¡¹ï¼šï¼ˆåŒ <code>string</code>)</li>
</ul>
</li>
<li><p><strong>glob</strong>ï¼šåŒ¹é…ç›®æ ‡æ–‡ä»¶çš„ globï¼ˆï¼Ÿï¼‰æ¨¡å¼</p>
<ul>
<li>ç±»å‹é€‰é¡¹ï¼š<ul>
<li>ç”¨å¼•å·åŒ…è£¹ç€çš„æ¨¡å¼å­—ç¬¦ä¸²ï¼šä¾‹å¦‚ <code>&quot;/sys/&quot;</code> æˆ– <code>&quot;/sys/**/*/&quot;</code>ï¼Œå…·ä½“ç”¨æ³•å‚è§<a target="_blank" rel="noopener" href="https://pkg.go.dev/path/filepath#Match">https://pkg.go.dev/path/filepath#Match</a></li>
</ul>
</li>
</ul>
</li>
<li><p><strong>fmt</strong>ï¼šä¸€ä¸ªè¡¨ç¤ºä¸€ä¸ªæ•´æ•°çš„å­—ç¬¦ä¸²</p>
<ul>
<li>ç±»å‹é€‰é¡¹ï¼š<ul>
<li>æ ¼å¼ä¸å€¼ï¼šå‰è€…å¯å–å€¼ä¸º <code>dec</code>æˆ–  <code>hex</code> æˆ– <code>oct</code>ï¼›åè€…å¯ä»¥æ˜¯ä¸€ä¸ª resourceã€intã€flagsã€const æˆ– proc</li>
</ul>
</li>
<li>æœ€ç»ˆçš„ç»“æœé€šå¸¸æ˜¯å›ºå®šå°ºå¯¸çš„</li>
</ul>
</li>
<li><p><strong>len</strong>ï¼šå¦ä¸€ä¸ª <code> å­—æ®µ</code> çš„é•¿åº¦ï¼ˆå¯¹äº array è€Œè¨€ä¸ºå…ƒç´ çš„æ•°é‡ï¼‰</p>
<ul>
<li>ç±»å‹é€‰é¡¹ï¼š<ul>
<li>å¯¹è±¡çš„ argname</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>bytesize</strong>ï¼šä¸ len ç±»ä¼¼ï¼Œä¸è¿‡å•ä½æ˜¯<strong>å­—èŠ‚</strong></p>
<ul>
<li>ç±»å‹é€‰é¡¹ï¼š<ul>
<li>å¯¹è±¡çš„ argname</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>bitsize</strong>ï¼šä¸ len ç±»å‹ï¼Œä¸è¿‡å•ä½æ˜¯<strong>æ¯”ç‰¹ä½</strong></p>
<ul>
<li>ç±»å‹é€‰é¡¹ï¼š<ul>
<li>å¯¹è±¡çš„ argname</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>offsetof</strong>ï¼šä¸€ä¸ª <code>å­—æ®µ</code> åœ¨å…¶ parent struct  ä¸­çš„åç§»ï¼ˆç¬”è€…æ€ä¹ˆè¯‘éƒ½æ²¡é‚£æ„Ÿè§‰ï¼Œæ•…ä¿ç•™åŸè¯ï¼‰</p>
<ul>
<li>ç±»å‹é€‰é¡¹ï¼š<ul>
<li><code>å­—æ®µ</code></li>
</ul>
</li>
</ul>
</li>
<li><p><strong>vma</strong> æˆ– <strong>vma64</strong>ï¼šæŒ‡å‘ä¸€ç»„é¡µçš„æŒ‡é’ˆï¼ˆç”¨ä½œ mmap&#x2F;munmap&#x2F;mremap&#x2F;madvise çš„è¾“å…¥ï¼‰</p>
<ul>
<li>ç±»å‹é€‰é¡¹ï¼š<ul>
<li>ï¼ˆå¯é€‰ï¼‰é¡µçš„æ•°é‡æˆ–é¡µçš„èŒƒå›´ï¼šå‰è€…ä¾‹å¦‚ <code>vma[7]</code>ï¼Œåè€…ä¾‹å¦‚ <code>vma[2-4]</code></li>
</ul>
</li>
<li>vma64 çš„é•¿åº¦æ’ä¸º 8 å­—èŠ‚</li>
</ul>
</li>
<li><p><strong>proc</strong>ï¼šå•ä¸ªè¿›ç¨‹çš„æ•´å‹ï¼ˆè¯¦è§ä¸‹é¢çš„æè¿°ï¼‰</p>
<ul>
<li>ç±»å‹é€‰é¡¹ï¼š<ul>
<li>å€¼çš„åŒºé—´çš„èµ·å§‹</li>
<li>æ¯ä¸ªè¿›ç¨‹çš„å€¼çš„æ•°é‡</li>
<li>åŸºç¡€ç±»å‹</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>text</strong>ï¼šç‰¹å®š type çš„æœºå™¨ç </p>
<ul>
<li>ç±»å‹é€‰é¡¹ï¼š<ul>
<li>ä»£ç ç±»å‹ï¼š<code>x86_real</code>, <code>x86_16</code>, <code>x86_32</code>, <code>x86_64</code>, <code>arm64</code></li>
</ul>
</li>
</ul>
</li>
<li><p><strong>void</strong>ï¼štype with static size 0ï¼ˆè‡ªå·±ä½“ä¼šï¼Œæ€ä¹ˆè¯‘éƒ½æ²¡é‚£ç§æ„Ÿè§‰â€¦ï¼‰</p>
<ul>
<li>é€šå¸¸åœ¨æ¨¡æ¿ä»¥åŠå¯å˜é•¿ï¼ˆvarlenï¼‰è”åˆä½“ä¸­ä½¿ç”¨ï¼Œ<strong>ä¸èƒ½ç”¨ä½œç³»ç»Ÿè°ƒç”¨çš„å‚æ•°</strong></li>
</ul>
</li>
</ul>
<p>åœ¨ <code>ç»“æ„ä½“/è”åˆä½“/æŒ‡é’ˆ</code> ä¸­ä½¿ç”¨æ—¶ï¼Œ<code>flags/len/flags</code> çš„æ„æˆä¸­å°¾éƒ¨è¿˜å¯ä»¥è·Ÿç€ type type-options</p>
<blockquote>
<p><del>å”‰å‘€ä½ è¯´äº†è¿™ä¹ˆå¤šè°å¬å¾—æ‡‚å•Šï¼Œè¿˜æ˜¯å¿«æŠŠğŸŒ°æ¬ä¸Šæ¥å§</del></p>
</blockquote>
<h5 id="å…³äº-flags-çš„è¡¥å……è¯´æ˜"><a href="#å…³äº-flags-çš„è¡¥å……è¯´æ˜" class="headerlink" title="å…³äº flags çš„è¡¥å……è¯´æ˜"></a>å…³äº <em>flags</em> çš„è¡¥å……è¯´æ˜</h5><p>flags é€šå¸¸å…·æœ‰å¦‚ä¸‹å½¢å¼ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs syzlang">flagname = const [&quot;,&quot; const]*<br></code></pre></td></tr></table></figure>

<p>è¿™æ˜¯ä¸€ä¸ªğŸŒ°ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs syzlang">my_flags = 1,2,3,4,5,6,7,8,9,0<br></code></pre></td></tr></table></figure>

<p>å¯¹äº string ç±»å‹çš„ flagï¼Œå…¶åº”å½“å…·æœ‰å¦‚ä¸‹å½¢å¼ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs syzlang">flagname = &quot;\&quot;&quot; literal &quot;\&quot;&quot; [&quot;,&quot; &quot;\&quot;&quot; literal &quot;\&quot;&quot;]*<br></code></pre></td></tr></table></figure>

<p>è¿™æ˜¯ä¸€ä¸ªğŸŒ°ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs syzlang">my_str_flags = &quot;arttnba3&quot;, &quot;arttnba4&quot;, &quot;arttnba5&quot;<br></code></pre></td></tr></table></figure>

<h4 id="ç±»å‹é€‰é¡¹ï¼ˆtype-optionsï¼‰"><a href="#ç±»å‹é€‰é¡¹ï¼ˆtype-optionsï¼‰" class="headerlink" title="ç±»å‹é€‰é¡¹ï¼ˆtype-optionsï¼‰"></a>ç±»å‹é€‰é¡¹ï¼ˆtype-optionsï¼‰</h4><blockquote>
<p>åœ¨ç±»å‹å½“ä¸­ï¼Œç±»å‹é€‰é¡¹å…¶å®ä¹Ÿæ˜¯å¯é€‰é¡¹ï¼ˆ<del>åˆæè¿™ç»•å£ä»¤äº†</del>ï¼‰</p>
</blockquote>
<p>type-options åœ¨ç¬”è€…çš„ç†è§£ä¸­ä¸º<strong>å¯¹ä¸€ä¸ªç‰¹å®š type çš„è¡¥å……è¯´æ˜</strong>ï¼Œå…¶åº”å½“å…·æœ‰å¦‚ä¸‹å½¢å¼ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs syzlang">type-options = [type-opt [&quot;,&quot; type-opt]]<br></code></pre></td></tr></table></figure>

<p>æˆ‘ä»¬ä¸éš¾çœ‹å‡º type-options åœ¨ syzlang ä¸­ä¸º<strong>å¯é€‰é¡¹</strong>ï¼ŒåŒæ ·åœ°ï¼Œå¯¹äºä¸€ä¸ª type å…¶å¯ä»¥æœ‰å¤šä¸ª type-options</p>
<p>æŸ¥çœ‹å‰é¢ type çš„å½¢å¼è¯´æ˜å¯çŸ¥ï¼Œåœ¨ä½¿ç”¨ç±»å‹é€‰é¡¹æ—¶ï¼Œæˆ‘ä»¬åº”å½“ä½¿ç”¨ <code>[]</code> å°†ä¹‹åŒ…è£¹</p>
<p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ğŸŒ°ï¼ˆä½œä¸ºç³»ç»Ÿè°ƒç”¨å‚æ•°è¾“å…¥ï¼Œè€Œéå•ç‹¬çš„å‚æ•°å®šä¹‰ï¼‰ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs syzlang">flags flags[open_flags]<br></code></pre></td></tr></table></figure>

<p>ä»å·¦å‘å³è§£æï¼šå¯¹äºè¿™ä¸ªç³»ç»Ÿè°ƒç”¨çš„ <code>flags</code> å‚æ•°ï¼Œæˆ‘ä»¬çš„è¾“å…¥æ˜¯ä¸€ä¸ª flags ç±»å‹ï¼Œå…¶ç±»å‹é€‰é¡¹ä¸ºå¯¹ä¸€ä¸ª flags æè¿° <code>open_flags</code> çš„å¼•ç”¨ï¼Œæ„ä¸ºå–å€¼ä¸º open_flags ä¸­ä¹‹ä¸€</p>
<p>å…¶ä¸­ open_flags è¢«å®šä¹‰å¦‚ä¸‹ï¼Œè¿™äº›å€¼é€šè¿‡ include è¯­å¥ä»å†…æ ¸æºæ–‡ä»¶ä¸­è¢«åŒ…å«è¿›æ¥ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs syzlang">open_flags = O_WRONLY, O_RDWR, O_APPEND, FASYNC, O_CLOEXEC, O_CREAT, O_DIRECT, O_DIRECTORY, O_EXCL, O_LARGEFILE, O_NOATIME, O_NOCTTY, O_NOFOLLOW, O_NONBLOCK, O_PATH, O_SYNC, O_TRUNC, __O_TMPFILE<br></code></pre></td></tr></table></figure>

<h3 id="III-ç³»ç»Ÿè°ƒç”¨æ¨¡æ¿"><a href="#III-ç³»ç»Ÿè°ƒç”¨æ¨¡æ¿" class="headerlink" title="III.ç³»ç»Ÿè°ƒç”¨æ¨¡æ¿"></a>III.ç³»ç»Ÿè°ƒç”¨æ¨¡æ¿</h3><p>æˆ‘ä»¬å°†ä¸Šé¢çš„ç»“æœè¿›è¡Œæ•´åˆï¼Œä¸€ä¸ªç³»ç»Ÿè°ƒç”¨çš„å½¢å¼åº”å½“å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs syzlang">syscallname &quot;(&quot; [arg [&quot;,&quot; arg]*] &quot;)&quot; [type] [&quot;(&quot; attribute* &quot;)&quot;]<br></code></pre></td></tr></table></figure>

<p>æ¥ä¸‹æ¥ç¬”è€…é€šè¿‡ä¸€ä¸ªğŸŒ°è¿›è¡Œåˆ†è§£è¯´æ˜</p>
<h4 id="åŸºæœ¬å½¢å¼"><a href="#åŸºæœ¬å½¢å¼" class="headerlink" title="åŸºæœ¬å½¢å¼"></a>åŸºæœ¬å½¢å¼</h4><p>æˆ‘ä»¬å°†å…¶æœ€å°åŒ–ï¼Œæˆ‘ä»¬åº”å½“ä¹¦å†™ä¸ºå¦‚ä¸‹å½¢å¼ï¼Œç±»ä¼¼äºå¸¸è§„çš„ C è¯­è¨€å‡½æ•°è°ƒç”¨ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs syzlang">syscallname(arg)<br></code></pre></td></tr></table></figure>

<p>ä¾‹å¦‚å¯¹äº open è¿™ä¸ªç³»ç»Ÿè°ƒç”¨ï¼Œæˆ‘ä»¬å¯ä»¥å†™æˆè¿™ä¸ªæ ·å­ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs syzlang">open(file ptr[in, filename], flags flags[open_flags], mode flags[open_mode])<br>#...<br>open_flags = O_WRONLY, O_RDWR, O_APPEND, FASYNC, O_CLOEXEC, O_CREAT, O_DIRECT, O_DIRECTORY, O_EXCL, O_LARGEFILE, O_NOATIME, O_NOCTTY, O_NOFOLLOW, O_NONBLOCK, O_PATH, O_SYNC, O_TRUNC, __O_TMPFILE<br>open_mode = S_IRUSR, S_IWUSR, S_IXUSR, S_IRGRP, S_IWGRP, S_IXGRP, S_IROTH, S_IWOTH, S_IXOTH<br></code></pre></td></tr></table></figure>

<p>å¯¹äº open ç³»ç»Ÿè°ƒç”¨çš„ä¸‰ä¸ªå‚æ•°ï¼Œæˆ‘ä»¬ç»™äº†è¿™æ ·çš„è¾“å…¥ï¼š</p>
<ul>
<li>file å‚æ•°ï¼šä¸€ä¸ª<strong>æŒ‡é’ˆ</strong>ç±»å‹ï¼Œå…¶ type-opetions çš„ç¬¬ä¸€ä¸ªä¸º <code>in</code>ï¼Œæ„ä¸ºç”±è¯¥æŒ‡é’ˆæŒ‡å‘ç‰¹å®šå¯¹è±¡ï¼Œç¬¬äºŒä¸ªä¸º <code>filename</code>ï¼Œä¸º<strong>ç‰¹æ®Šçš„ string å¯¹è±¡</strong>ï¼Œå¯¹äº filenameï¼Œsyzlang ä¼šè¿›è¡Œæ–‡ä»¶ç”Ÿæˆï¼Œå°†æ–‡ä»¶åä½œä¸ºè¾“å…¥</li>
<li>flags å‚æ•°ï¼šä¸€ä¸ª <strong>flags</strong> ç±»å‹ï¼Œå…¶ type-options ä¸º <code>open_flags</code> ï¼Œæ„ä¸ºä»æˆ‘ä»¬å®šä¹‰çš„ flagsâ€”â€”<code>open_flags</code> ä¸­å–å€¼</li>
<li>mode å‚æ•°ï¼šä¸€ä¸ª <strong>flags</strong> ç±»å‹ï¼Œå…¶ type-options ä¸º <code>open_mode</code> ï¼Œæ„ä¸ºä»æˆ‘ä»¬å®šä¹‰çš„ flagsâ€”â€”<code>open_mode</code> ä¸­å–å€¼</li>
</ul>
<h4 id="è¿”å›å€¼"><a href="#è¿”å›å€¼" class="headerlink" title="è¿”å›å€¼"></a>è¿”å›å€¼</h4><p>æ¥ä¸‹æ¥æˆ‘ä»¬å†ç»§ç»­æ·±å…¥ï¼Œç³»ç»Ÿè°ƒç”¨é€šå¸¸éƒ½æœ‰è¿”å›å€¼ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©æ¥æ”¶ä¹Ÿå¯ä»¥é€‰æ‹©å¿½è§†ï¼Œè‹¥æ˜¯æˆ‘ä»¬éœ€è¦è¿›è¡Œæ¥æ”¶ï¼Œåˆ™åº”å½“åœ¨ç³»ç»Ÿè°ƒç”¨çš„æœ«å°¾æ·»åŠ  type ï¼Œä¾‹å¦‚ open è¿™ä¸ªç³»ç»Ÿè°ƒç”¨ä¼šè¿”å›ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œæˆ‘ä»¬ç°åœ¨æƒ³å°†å…¶è¿”å›çš„æ–‡ä»¶æè¿°ç¬¦å­˜åˆ°ä¸€ä¸ªå˜é‡æ¯”å¦‚è¯´ <code>a3fd</code>ï¼ˆå‡å¦‚å·²è¢«å£°æ˜ä¸º _èµ„æº_ï¼ˆä¸‹æ–‡è§£é‡Šï¼‰ï¼‰ å½“ä¸­ï¼Œæˆ‘ä»¬åº”å½“å†™æˆä¸‹é¢è¿™ä¸ªå½¢å¼ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs syzlang">open(file ptr[in, filename], flags flags[open_flags], mode flags[open_mode]) a3fd<br></code></pre></td></tr></table></figure>

<p>é‚£ä¹ˆ open çš„è¿”å›å€¼ä¾¿è¢«å­˜å‚¨åˆ°äº† <code>a3fd</code> è¿™ä¸€ä¸ª type å½“ä¸­ï¼Œæˆ‘ä»¬åœ¨åç»­ä¾¿å¯ä»¥å°† fd ç”¨ä½œå…¶ä»–ç³»ç»Ÿè°ƒç”¨çš„å‚æ•°ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs syzlang">close(fd a3fd)<br></code></pre></td></tr></table></figure>

<h4 id="call-attributes"><a href="#call-attributes" class="headerlink" title="call attributes"></a>call attributes</h4><p>ç³»ç»Ÿè°ƒç”¨æ¨¡æ¿å½“ä¸­è¿˜æœ‰ä¸€ä¸ªå¯é€‰é¡¹æ˜¯ <code>attributes</code>ï¼Œå³è¿™ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨çš„<strong>å±æ€§</strong>ï¼Œå¯ä»¥å–çš„å€¼å¦‚ä¸‹ï¼š</p>
<ul>
<li><code>disabled</code>ï¼šè¯¥ç³»ç»Ÿè°ƒç”¨å°†ä¸ç”¨äº fuzzingï¼›è¿™ä¸ªå±æ€§é€šå¸¸ç”¨äºä¸´æ—¶ç¦ç”¨æŸäº›ç³»ç»Ÿè°ƒç”¨ï¼Œæˆ–è€…ç¦ç”¨ç‰¹å®šçš„å‚æ•°ç»„åˆ</li>
<li><code>timeout[N]</code>ï¼šç³»ç»Ÿè°ƒç”¨åœ¨é»˜è®¤å€¼ä»¥å¤–çš„é¢å¤–çš„è¶…æ—¶æ—¶é—´ï¼Œå•ä½ä¸ºæ¯«ç§’ï¼ˆmsï¼‰</li>
<li><code>prog_timeoout[N]</code>ï¼šè‹¥ä¸€ä¸ªç¨‹åºåŒ…å«äº†è¯¥ç³»ç»Ÿè°ƒç”¨ï¼Œåˆ™è¯¥å±æ€§ä¸ºæ•´ä¸ªç¨‹åºçš„æ‰§è¡Œçš„è¶…æ—¶æ—¶é—´ï¼Œè‹¥å­˜åœ¨å¤šä¸ªå®šä¹‰äº†è¯¥å±æ€§çš„ç³»ç»Ÿè°ƒç”¨åˆ™å–æœ€å¤§å€¼</li>
<li><code>ignore_return</code>ï¼šåœ¨å›é€€åé¦ˆï¼ˆç¬”è€…æ¨æŒ‡çš„æ˜¯ syzkaller çš„ fuzz æœºåˆ¶ä¹‹ä¸€ï¼Œæ ¹æ®è¿”å›å€¼åˆ¤æ–­è·¯å¾„è¦†ç›–ä¹‹ç±»çš„ï¼‰ä¸­å¿½è§†è¿™ä¸ªç³»ç»Ÿè°ƒç”¨çš„è¿”å›å€¼ï¼›ç”¨äºä¸è¿”å›å›ºå®šçš„é”™è¯¯ç ï¼ˆä¾‹å¦‚ -EFAULTï¼‰è€Œæ˜¯è¿”å›å…¶ä»–å€¼çš„ç³»ç»Ÿè°ƒç”¨</li>
<li><code>break_returns</code>ï¼šå¿½ç•¥å›é€€åé¦ˆä¸­ç¨‹åºä¸­æ‰€æœ‰åç»­ç³»ç»Ÿè°ƒç”¨çš„è¿”å›å€¼ï¼ˆæ–‡æ¡£ä¸­è¯´ <code>can&#39;t be trusted</code>ï¼Œç¬”è€…æš‚æ—¶ä¸ç†è§£â€¦ï¼‰</li>
</ul>
<h4 id="å˜ç§ï¼ˆvariantsï¼‰"><a href="#å˜ç§ï¼ˆvariantsï¼‰" class="headerlink" title="å˜ç§ï¼ˆvariantsï¼‰"></a>å˜ç§ï¼ˆvariantsï¼‰</h4><p>å¯¹äºç³»ç»Ÿè°ƒç”¨çš„å˜ç§å½¢å¼ï¼Œæˆ‘ä»¬åº”å½“åœ¨ç³»ç»Ÿè°ƒç”¨ååé¢ä½¿ç”¨ <code>$</code> ç¬¦å·è¿›è¡Œé¢å¤–çš„æŒ‡å®š</p>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªğŸŒ°ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs syzlang">open$dir(file ptr[in, filename], flags flags[open_flags], mode flags[open_mode]) fd_dir<br></code></pre></td></tr></table></figure>

<blockquote>
<p>æŒ‰ç¬”è€…çš„ç†è§£åº”è¯¥æ˜¯ä¸ºå…¶å–ä¸€ä¸ªåˆ«åï¼Ÿæ¯”å¦‚è¯´å¯¹äº syzkaller è€Œè¨€ <code>open$dir</code> å’Œ <code>open$a3dir</code> å°±æ˜¯ä¸¤ä¸ªä¸œè¥¿ï¼Œè€Œè‹¥æ˜¯åœ¨ä¸¤ä¸ªä¸åŒçš„æ–‡ä»¶ä¸­éƒ½å‡ºç°äº† <code>open$dir</code> åˆ™ä¼šåœ¨_é‡ç¼–è¯‘_ï¼ˆä¸‹æ–‡è§£é‡Šï¼‰æ—¶å‘ç”Ÿå†²çª</p>
</blockquote>
<h3 id="IV-æ•´å‹ï¼ˆintegerï¼‰"><a href="#IV-æ•´å‹ï¼ˆintegerï¼‰" class="headerlink" title="IV.æ•´å‹ï¼ˆintegerï¼‰"></a>IV.æ•´å‹ï¼ˆintegerï¼‰</h3><p>æ•´å‹ä¹Ÿæ˜¯ä¸€ç§ typeï¼Œå…¶å¯é€‰é¡¹ä¸º <code>int8</code> ã€<code>int16</code>ã€<code>int32</code>ã€<code>int64</code>ï¼Œè¡¨ç¤ºç›¸åº”å¤§å°çš„æ•´å‹</p>
<p><code>intptr</code> ç”¨ä»¥è¡¨ç¤ºä¸€ä¸ª<strong>æŒ‡é’ˆå¤§å°</strong>çš„æ•´å‹ï¼Œå¯¹åº” C è¯­è¨€ä¸­çš„ <code>long</code></p>
<p>é€šè¿‡æ·»åŠ  <code>be</code> åç¼€è¡¨ç¤ºè¿™ä¸ªæ•´å‹å­˜å‚¨ä¸º<strong>å¤§ç«¯åº</strong></p>
<p>è¿™æ˜¯ä¸€ä¸ªğŸŒ°ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs syzlang">read$eventfd(fd fd_event, val ptr[out, int64], len len[val])<br></code></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥ç”¨è¿™æ ·çš„å½¢å¼æ¥æŒ‡å®š int çš„èŒƒå›´ï¼š<code>int32[0:100]</code>â€”â€”æ„ä¸ºè¯¥æ•´å‹çš„å–å€¼èŒƒå›´ä¸º <code>[0,100]</code></p>
<p>æˆ‘ä»¬è¿˜å¯ä»¥é¢å¤–æŒ‡å®šå–å€¼çš„è·¨åº¦ï¼Œä¾‹å¦‚ <code>int32[1:10, 2]</code> æ„ä¸ºå…¶å–å€¼ä¸º {1, 3, 5, 7, 9}</p>
<p>æˆ‘ä»¬è¿˜å¯ä»¥é¢å¤–æŒ‡å®šä¸€ä¸ªæ•´å‹çš„å–å€¼èŒƒå›´ï¼Œå•ä½ä¸ºæ¯”ç‰¹ä½ï¼Œä¾‹å¦‚ <code>int64:20</code> æ„ä¸ºè¿™ä¸ªæ•´å‹åªå–å…¶ 20 bit çš„å€¼è¿›è¡ŒéšæœºåŒ–</p>
<h3 id="V-ç»“æ„ä½“ã€è”åˆä½“ä¸å…¶æˆå‘˜ï¼ˆå­—æ®µï¼‰"><a href="#V-ç»“æ„ä½“ã€è”åˆä½“ä¸å…¶æˆå‘˜ï¼ˆå­—æ®µï¼‰" class="headerlink" title="V.ç»“æ„ä½“ã€è”åˆä½“ä¸å…¶æˆå‘˜ï¼ˆå­—æ®µï¼‰"></a>V.ç»“æ„ä½“ã€è”åˆä½“ä¸å…¶æˆå‘˜ï¼ˆå­—æ®µï¼‰</h3><p>åœ¨ syzlang ä¸­åŒæ ·å¯ä»¥å®šä¹‰ç»“æ„ä½“&#x2F;è”åˆä½“ï¼Œç»“æ„ä½“&#x2F;è”åˆä½“çš„æˆå‘˜è¢«ç§°ä¹‹ä¸º <code>å­—æ®µ</code>ï¼ˆfieldï¼‰</p>
<h4 id="ç»“æ„ä½“ï¼ˆstructï¼‰"><a href="#ç»“æ„ä½“ï¼ˆstructï¼‰" class="headerlink" title="ç»“æ„ä½“ï¼ˆstructï¼‰"></a>ç»“æ„ä½“ï¼ˆstructï¼‰</h4><p>åœ¨ syzlang ä¸­ï¼Œä¸€ä¸ªç»“æ„ä½“åº”ä¸ºå¦‚ä¸‹å½¢å¼ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs syzlang">structname &quot;&#123;&quot; &quot;\n&quot;<br>	(fieldname type (&quot;(&quot; fieldattribute* &quot;)&quot;)? &quot;\n&quot;)+<br>&quot;&#125;&quot; (&quot;[&quot; attribute* &quot;]&quot;)?<br></code></pre></td></tr></table></figure>

<p>å¯¹äºå­—æ®µè€Œè¨€ï¼Œå…¶å¯ä»¥åœ¨åé¢çš„ <code>()</code> ä¸­æŒ‡å®šå­—æ®µå±æ€§ï¼Œä½†ä¸ type çš„å±æ€§ä¸åŒï¼Œå”¯ä¸€çš„å±æ€§åªæœ‰æ–¹å‘ï¼š <code>in/out/inout</code>ï¼Œå¯¹äºæŒ‡å®šçš„å­—æ®µï¼Œå…¶æ–¹å‘å±æ€§ä¼šè¢«ä¸Šå±‚å±æ€§ç»™è¦†ç›–</p>
<p>åœ¨ç»“æ„ä½“å®šä¹‰çš„å°¾éƒ¨ï¼Œæˆ‘ä»¬å¯ä»¥é¢å¤–æŒ‡å®šä¸€äº›å±æ€§ï¼ˆä½¿ç”¨ <code>[]</code> åŒ…è£¹ï¼‰ï¼Œå¯é€‰å±æ€§æœ‰ï¼š</p>
<ul>
<li><code>packed</code>ï¼šè¯¥ç»“æ„ä½“ä¸åŒå­—æ®µä¹‹é—´æ²¡æœ‰ paddingï¼ˆä¾‹å¦‚ C ä¸­æœ‰ä¸€ä¸ªç»“æ„ä½“ <code>struct T&#123;int a; char b;&#125;;</code>ï¼Œchar ä¸º 1 å­—èŠ‚ï¼Œint ä¸º 4 å­—èŠ‚ï¼Œé‚£ä¹ˆè¯¥ç»“æ„ä½“ä¾¿ä¼šå¯¹ 4 å­—èŠ‚å¯¹é½ï¼Œåœ¨å…¶ä¸¤ä¸ªå­—æ®µä¹‹é—´å°±ä¼šæœ‰ 3 å­—èŠ‚çš„ paddingï¼‰</li>
<li><code>align[N]</code>ï¼šæŒ‡å®šè¯¥ç»“æ„ä½“å¯¹ N å­—èŠ‚å¯¹é½ï¼Œpadding çš„å†…å®¹å¹¶æœªæŒ‡å®šï¼ˆé€šå¸¸ä¸º0ï¼‰</li>
<li><code>size[N]</code>ï¼šç»“æ„ä½“è¢«å¡«å……åˆ°æŒ‡å®šçš„å¤§å° <code>N</code></li>
</ul>
<p>å…¶å®å’Œæˆ‘ä»¬åœ¨ C è¯­è¨€ä¸­å†™ç»“æ„ä½“å·®ä¸å¤šï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªğŸŒ°ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs syzlang">my_struct &#123;<br>	a3f1 	int8						# ä¸€ä¸ªéšæœºçš„ 1 å­—èŠ‚çš„ int<br>	a3f2	const[0xdeadbeef, int32be]	# ä¸€ä¸ªå›ºå®šçš„ 8 å­—èŠ‚çš„ intï¼Œå–å€¼ä¸º 0xdeadbeefï¼Œå¤§ç«¯åº<br>	a3f3	int32[0:100]				# ä¸€ä¸ªéšæœºçš„ 4 å­—èŠ‚çš„ intï¼Œå–å€¼èŒƒå›´ä¸º [0,100]<br>	a3f4	int64:20					# ä¸€ä¸ªéšæœºçš„ 8 å­—èŠ‚çš„ intï¼Œåªå–20ä¸ªæ¯”ç‰¹çš„å€¼ï¼ˆå…¶ä»–bitç½®0ï¼Ÿï¼‰<br>&#125; [packed]<br></code></pre></td></tr></table></figure>

<h4 id="è”åˆä½“ï¼ˆunionï¼‰"><a href="#è”åˆä½“ï¼ˆunionï¼‰" class="headerlink" title="è”åˆä½“ï¼ˆunionï¼‰"></a>è”åˆä½“ï¼ˆunionï¼‰</h4><p>ä¸ç»“æ„ä½“åŸºæœ¬ç›¸åŒï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs syzlang">unionname &quot;[&quot; &quot;\n&quot;<br>	(fieldname type (&quot;(&quot; fieldattribute* &quot;)&quot;)? &quot;\n&quot;)+<br>&quot;]&quot; (&quot;[&quot; attribute* &quot;]&quot;)?<br></code></pre></td></tr></table></figure>

<p>ä¸åŒçš„æ˜¯å…¶å±æ€§çš„å¯é€‰é¡¹ï¼Œæœ‰ï¼š</p>
<ul>
<li><code>varlen</code>ï¼šè”åˆä½“çš„å¤§å°å¯å˜ï¼ˆä¸ºæŒ‡å®šçš„å­—æ®µçš„é•¿åº¦ï¼‰ï¼Œè‹¥æœªæŒ‡å®šåˆ™è¯¥è”åˆä½“å¤§å°ä¸ºå…¶æœ€å¤§å­—æ®µçš„å¤§å°ï¼ˆç±»å‹ C è¯­è¨€ï¼‰</li>
<li><code>size[N]</code>ï¼šè¯¥è”åˆä½“è¢«å¡«å……åˆ°æŒ‡å®šçš„å¤§å° <code>N</code></li>
</ul>
<h3 id="VI-èµ„æºï¼ˆresourcesï¼‰"><a href="#VI-èµ„æºï¼ˆresourcesï¼‰" class="headerlink" title="VI.èµ„æºï¼ˆresourcesï¼‰"></a>VI.èµ„æºï¼ˆresourcesï¼‰</h3><p>èµ„æºï¼ˆresourcesï¼‰ç”¨ä½œé‚£äº›éœ€è¦ä½œä¸ºä¸€ä¸ªç³»ç»Ÿè°ƒç”¨çš„è¾“å‡ºçš„å€¼ä¼ é€’ç»™å¦ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨åšè¾“å…¥çš„å€¼ã€‚</p>
<p>è¿™ä¹ˆè¯´å¯èƒ½æœ‰äº›ç©ºæ³›ï¼Œç¬”è€…æ¥ä¸¾ä¸ªğŸŒ°ï¼Œ <code>close</code> ç³»ç»Ÿè°ƒç”¨æ¥æ”¶ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ä½œä¸ºå‚æ•°ï¼Œè€Œè¿™ä¸ªæ–‡ä»¶æè¿°ç¬¦åº”å½“ä¸ºä½ åœ¨ä¹‹å‰è¿›è¡Œ <code>open </code> æˆ– <code>pipe</code> ç³»ç»Ÿè°ƒç”¨æ—¶è·å¾—çš„è¿”å›å€¼ï¼Œä¸ºäº†è¾¾æˆè¿™ä¸ªç›®çš„ï¼Œæˆ‘ä»¬éœ€è¦å°†æ–‡ä»¶æè¿°ç¬¦ï¼ˆæ¯”å¦‚è¯´å« <code>fd</code>ï¼‰å£°æ˜ä¸ºä¸€ä¸ª<strong>èµ„æº</strong></p>
<p>resources çš„å½¢å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs syzlang">&quot;resource&quot; identifier &quot;[&quot; underlying_type &quot;]&quot; [ &quot;:&quot; const (&quot;,&quot; const)* ]<br></code></pre></td></tr></table></figure>

<p>å…¶ä¸­çš„ <code>underlying_type</code> å¯ä»¥æ˜¯ <code>int8</code>, <code>int16</code>, <code>int32</code>, <code>int64</code>, <code>intptr</code> æˆ–è€…æ˜¯å¦ä¸€ä¸ªèµ„æºï¼ˆå¯ä»¥æ˜¯å…¶å­ç±»ï¼Œæ¯”å¦‚è¯´ä¸€ä¸ª socket ä¾¿æ˜¯ æ–‡ä»¶æè¿°ç¬¦çš„â€œå­ç±»â€ï¼‰</p>
<p>å¸¸é‡é›†åˆå¯ä»¥ä½œä¸ºå¯é€‰å‚æ•°ï¼Œè¡¨ç¤ºè¯¥èµ„æºçš„ç‰¹æ®Šå€¼ï¼ˆæ¯”å¦‚è¯´ 0xdeadbeefï¼‰ï¼Œç‰¹æ®Šå€¼å¶å°”è¢«ç”¨ä½œèµ„æºçš„å€¼ï¼Œè‹¥æœªæŒ‡å®šç‰¹æ®Šå€¼ï¼Œåˆ™ä¼šä½¿ç”¨ç‰¹æ®Šå€¼ <code>0</code></p>
<p>èµ„æºä¹Ÿå¯ä»¥è¢«ç”¨ä½œç±»å‹ï¼ˆtypesï¼‰ï¼Œè¿™æ˜¯å®˜æ–¹ç»™å‡ºçš„ä¸€ä¸ªğŸŒ°ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs syzlang">resource fd[int32]: 0xffffffffffffffff, AT_FDCWD, 1000000<br>resource sock[fd]			# ç»§æ‰¿ fd ç±»å‹<br>resource sock_unix[sock]	# ç»§æ‰¿ sock ç±»å‹<br><br>socket(...) sock<br>accept(fd sock, ...) sock<br>listen(fd sock, backlog int32)<br></code></pre></td></tr></table></figure>

<p>èµ„æº<strong>å¹¶ä¸ä¸€å®šè¦æ˜¯ç³»ç»Ÿè°ƒç”¨çš„è¿”å›å€¼</strong>ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs syzlang">resource my_resource[int32]<br><br>request_producer(..., arg ptr[out, my_resource])<br>request_consumer(..., arg ptr[inout, test_struct])<br><br>test_struct &#123;<br>	...<br>	attr	my_resource<br>&#125;<br></code></pre></td></tr></table></figure>

<p>å¯¹äºæ›´ä¸ºå¤æ‚çš„ç”Ÿäº§è€…&#x2F;æ¶ˆè´¹è€…åœºæ™¯ï¼Œå­—æ®µå±æ€§ä¹Ÿå¯ä»¥è¢«åˆ©ç”¨ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs syzlang">resource my_resource_1[int32]<br>resource my_resource_2[int32]<br><br>request_produce1_consume2(..., arg ptr[inout, test_struct])<br><br>test_struct &#123;<br>	...<br>	field0	my_resource_1	(out)<br>	field1	my_resource_2	(in)<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="VII-ç±»å‹åˆ«åï¼ˆType-Aliasï¼‰"><a href="#VII-ç±»å‹åˆ«åï¼ˆType-Aliasï¼‰" class="headerlink" title="VII.ç±»å‹åˆ«åï¼ˆType Aliasï¼‰"></a>VII.ç±»å‹åˆ«åï¼ˆType Aliasï¼‰</h3><p>ç¬”è€…è®¤ä¸ºå¯ä»¥ç†è§£ä¸º C ä¸­çš„ä¸€ç§ç‰¹æ®Šçš„ typedefï¼Œå…¶æ ¼å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs syzlang">type identifier underlying_type<br></code></pre></td></tr></table></figure>

<p>è¿™ä¹ˆçœ‹å¯èƒ½æœ‰äº›ç©ºæ³›ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªğŸŒ°ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs syzlang">type bool8		int8[0:1]<br>type bool16		int16[0:1]<br>type bool32		int32[0:1]<br>type bool64		int64[0:1]<br>type boolptr	intptr[0:1]<br><br>type fileoff[BASE] BASE<br><br>type filename string[filename]<br><br>type buffer[DIR] ptr[DIR, array[int8]]<br></code></pre></td></tr></table></figure>

<p>åœ¨è¿™ä¸ªä¾‹å­å½“ä¸­æˆ‘ä»¬éœ€è¦ä½¿ç”¨å¸ƒå°”å€¼ï¼Œå…¶å–å€¼åªæœ‰ 0 æˆ– 1 ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å†™æˆ <code>intN[0:1]</code>ï¼Œä½†æ˜¯è‹¥æ˜¯åœ¨æ¯ä¸€ä¸ªéœ€è¦ç”¨åˆ°å¸ƒå°”å€¼çš„åœ°æ–¹éƒ½è¿™ä¹ˆå†™å°±å¤ªéº»çƒ¦äº†ï¼Œä¹Ÿä¸åˆ©äºç†è§£ï¼Œè¿™ä¸ªæ—¶å€™å°±å¯ä»¥ç»™ä»–å®šä¹‰ä¸€ä¸ª<strong>ç±»å‹åˆ«å</strong> <code>boolN</code>ï¼Œç®€å•æ˜“æ‡‚</p>
<h3 id="VIII-ç±»å‹æ¨¡æ¿ï¼ˆType-Templateï¼‰"><a href="#VIII-ç±»å‹æ¨¡æ¿ï¼ˆType-Templateï¼‰" class="headerlink" title="VIII.ç±»å‹æ¨¡æ¿ï¼ˆType Templateï¼‰"></a>VIII.ç±»å‹æ¨¡æ¿ï¼ˆType Templateï¼‰</h3><p>ç±»å‹æ¨¡æ¿åº”å®šä¹‰ä¸ºå¦‚ä¸‹å½¢å¼ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs syzlang">type optional[T] [<br>	val		T<br>	void	void<br>] [varlen]<br></code></pre></td></tr></table></figure>

<p><del>å”‰å‘€è°·æ­Œä½ è¿™ä¹ˆè®²è°èƒ½å¤Ÿçœ‹å¾—æ‡‚å•Šï¼Œè¿˜æ˜¯èµ¶ç´§æŠŠğŸŒ°ç»™æå‡ºæ¥å§</del></p>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ç”¨æ³•ğŸŒ°ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs syzlang">type buffer[DIR] ptr[DIR, array[int8]]<br>type fileoff[BASE] BASE<br>type nlattr[TYPE, PAYLOAD] &#123;<br>	nla_len		len[parent, int16]<br>	nla_type	const[TYPE, int16]<br>	payload		PAYLOAD<br>&#125; [align_4]<br><br>#...<br><br>syscall(a buffer[in], b fileoff[int64], c ptr[in, nlattr[FOO, int32]])<br></code></pre></td></tr></table></figure>

<p><del>ç¬”è€…ä¹Ÿæ²¡çœ‹æ˜ç™½ï¼Œæš‚æ—¶å°±å…ˆä¸è¯¯äººå­å¼Ÿäº†</del></p>
<h3 id="IX-é•¿åº¦ï¼ˆlengthï¼‰"><a href="#IX-é•¿åº¦ï¼ˆlengthï¼‰" class="headerlink" title="IX.é•¿åº¦ï¼ˆlengthï¼‰"></a>IX.é•¿åº¦ï¼ˆlengthï¼‰</h3><p>ä½ å¯ä»¥ä½¿ç”¨å…³é”®å­— <code>len</code>ã€<code>bytesize</code>ã€<code>bitsize</code> æ¥æŒ‡å®šç»“æ„ä½“å½“ä¸­ç‰¹å®šå­—æ®µçš„é•¿åº¦</p>
<p>è‹¥æ˜¯ <code>len</code> çš„å‚æ•°ä¸ºä¸€ä¸ªæŒ‡é’ˆï¼Œåˆ™å…¶å–å€¼ä¸º<strong>æŒ‡é’ˆæ‰€æŒ‡å¯¹è±¡çš„å¤§å°</strong></p>
<p>è‹¥è¦è¡¨ç¤ºä¸€ä¸ª <code>N å­—èŠ‚çš„å­—</code> ä¸­å­—æ®µçš„é•¿åº¦ï¼Œåˆ™åº”å½“ä½¿ç”¨ <code>bytesizeN</code>ï¼Œå…¶ä¸­ N çš„å–å€¼å¯ä»¥ä¸º 1ã€2ã€4ã€8</p>
<h4 id="example-1"><a href="#example-1" class="headerlink" title="example"></a><em>example</em></h4><p>è¿™æ˜¯è°·æ­Œå®˜æ–¹ç»™å‡ºçš„ä¸€ä¸ªğŸŒ°ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs syzlang">write(fd fd, buf ptr[in, array[int8]], count len[buf])<br><br>sock_fprog &#123;<br>	len	len[filter, int16]<br>	filter	ptr[in, array[sock_filter]]<br>&#125;<br></code></pre></td></tr></table></figure>

<p>åœ¨ write ç³»ç»Ÿè°ƒç”¨å½“ä¸­ï¼Œæˆ‘ä»¬ç»™å…¶ count å‚æ•°ä¼ å…¥äº†ä¸€ä¸ªç‰¹æ®Šçš„å‚æ•° <code>len[buf]</code>ï¼Œè¡¨ç¤ºæ­¤å¤„ä¼ å…¥çš„å€¼ä¸ºå‚æ•° buf çš„é•¿åº¦</p>
<p>åœ¨ sock_fprog è¿™ä¸ªç»“æ„ä½“å½“ä¸­ï¼Œæˆ‘ä»¬ç»™å…¶å­—æ®µ len è®¾ç½®çš„å€¼ä¸ºå…¶ filter å­—æ®µçš„é•¿åº¦ï¼Œç±»å‹ä¸º int 16</p>
<p>è‹¥è¦è¡¨ç¤ºçˆ¶ç±»çš„é•¿åº¦ï¼Œå¯ä»¥ä½¿ç”¨ <code>len[parent, intN]</code>ï¼Œè‹¥è¦åœ¨ç»“æ„ä½“äº’ç›¸åµŒå…¥æ—¶è¡¨ç¤ºæ›´é¡¶å±‚çš„çˆ¶ç±»çš„é•¿åº¦ï¼Œå¯ä»¥æŒ‡å®šç‰¹å®šçˆ¶ç±»çš„ç±»å‹åç§°ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªğŸŒ°ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs syzlang">s1 &#123;<br>    f0      len[s2]  # length of s2<br>&#125;<br><br>s2 &#123;<br>    f0      s1<br>    f1      array[int32]<br>    f2      len[parent, int32]<br>&#125;<br><br></code></pre></td></tr></table></figure>

<p>len ä¹Ÿæ”¯æŒæ›´åŠ å¤æ‚çš„è·¯å¾„å¯»å€ï¼Œæ¯”å¦‚è¯´å¦‚æœä½ é—²ç€æ²¡äº‹å¹²ä½ å¯ä»¥å†™æˆè°·æ­Œç»™å‡ºçš„è¿™ä¸ªğŸŒ°é‡Œçš„æ ·å­ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs syzlang">s1 &#123;<br>	a	ptr[in, s2]<br>	b	ptr[in, s3]<br>	c	array[int8]<br>&#125;<br><br>s2 &#123;<br>	d	array[int8]<br>&#125;<br><br>s3 &#123;<br># This refers to the array c in the parent s1.<br>	e	len[s1:c, int32]<br># This refers to the array d in the sibling s2.<br>	f	len[s1:a:d, int32]<br># This refers to the array k in the child s4.<br>	g	len[i:j, int32]<br># This refers to syscall argument l.<br>	h	len[syscall:l, int32]<br>	i	ptr[in, s4]<br>&#125;<br><br>s4 &#123;<br>	j	array[int8]<br>&#125;<br><br>foo(k ptr[in, s1], l ptr[in, array[int8]])<br><br></code></pre></td></tr></table></figure>

<h3 id="X-è¿›ç¨‹ï¼ˆprocï¼‰"><a href="#X-è¿›ç¨‹ï¼ˆprocï¼‰" class="headerlink" title="X.è¿›ç¨‹ï¼ˆprocï¼‰"></a>X.è¿›ç¨‹ï¼ˆprocï¼‰</h3><p>è¿›ç¨‹ <code>proc</code> ç±»å‹å¯ä»¥ç”¨äºè¡¨ç¤ºåˆ†è¿›ç¨‹æ•´å‹å€¼ï¼Œå³ä¸ºæ¯ä¸€ä¸ªæ‰§è¡Œç¨‹åºè®¾ç½®ä¸€ä¸ªå•ç‹¬çš„å€¼çš„èŒƒå›´ï¼Œè¿™æ ·ä»–ä»¬ä¹‹é—´å°±ä¸ä¼šäº’ç›¸å¹²æ‰°ï¼ŒğŸŒ°å¦‚ç«¯å£å·å°±ä¸èƒ½å¤Ÿè¢«å…±äº«ï¼Œè€Œæ˜¯éœ€è¦æ¯ä¸ªè¿›ç¨‹æœ‰ä¸€ä¸ªè‡ªå·±çš„ç«¯å£</p>
<p>è¿™é‡Œä¸¾ä¸€ä¸ªç®€å•çš„ğŸŒ°ï¼Œ <code>proc[20000, 4, int16be]</code> è¡¨ç¤ºä¸ºæ¯ä¸ªè¿›ç¨‹ç”Ÿæˆä¸€ä¸ªå¤§ç«¯åºçš„ int16 çš„å€¼ï¼Œä¸ºæ¯ä¸ªè¿›ç¨‹åˆ†é…å…¶ä¸­çš„ 4 ä¸ªå€¼ï¼Œä» 20000 å¼€å§‹åˆ†é…ï¼Œæ¯”å¦‚è¯´ç¬¬ N ä¸ª executor åˆ†é…åˆ°çš„å€¼èŒƒå›´ä¾¿æ˜¯ <code>[20000 + n * 4, 20000 + (n + 1) * 4)</code></p>
<h3 id="XI-æ•´å‹å¸¸é‡ï¼ˆInteger-Constantsï¼‰"><a href="#XI-æ•´å‹å¸¸é‡ï¼ˆInteger-Constantsï¼‰" class="headerlink" title="XI.æ•´å‹å¸¸é‡ï¼ˆInteger Constantsï¼‰"></a>XI.æ•´å‹å¸¸é‡ï¼ˆInteger Constantsï¼‰</h3><p>æ•´å‹å¸¸é‡å¯ä»¥æŒ‡å®šä¸ºåè¿›åˆ¶ã€<code>0x</code> å¼€å¤´çš„åå…­è¿›åˆ¶ã€ç”¨å•å¼•å· <code>&#39;</code> åŒ…è£¹çš„å­—ç¬¦ï¼Œæˆ–è€…ä»å†…æ ¸å¤´æ–‡ä»¶ä¸­æå–å‡ºæ¥çš„ç”± <code>define</code> å®šä¹‰çš„å¸¸é‡ï¼ˆæ¯”å¦‚è¯´ <code>O_RDONLY</code>ï¼‰</p>
<p>è¿™æ˜¯ä¸€ä¸ªğŸŒ°ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs syzlang">foo(a const[10], b const[-10])<br>foo(a const[0xabcd])<br>foo(a int8[&#x27;a&#x27;:&#x27;z&#x27;])<br>foo(a const[PATH_MAX])<br>foo(a ptr[in, array[int8, MY_PATH_MAX]])<br>define MY_PATH_MAX	PATH_MAX + 2<br></code></pre></td></tr></table></figure>

<h3 id="XII-æ‚é¡¹ï¼ˆMiscï¼‰"><a href="#XII-æ‚é¡¹ï¼ˆMiscï¼‰" class="headerlink" title="XII.æ‚é¡¹ï¼ˆMiscï¼‰"></a>XII.æ‚é¡¹ï¼ˆMiscï¼‰</h3><p>æè¿°æ–‡ä»¶è¿˜åŒ…æ‹¬ç”¨ä»¥è¿›è¡Œå†…æ ¸å¤´æ–‡ä»¶åŒ…å«çš„ <code>include</code> æŒ‡ä»¤ï¼Œç”¨ä»¥åŒ…å«å†…æ ¸å¤´æ–‡ä»¶ç›®å½•çš„ <code>incdir</code> æŒ‡ä»¤ï¼Œä»¥åŠç”¨ä»¥è®¾ç½®å¸¸é‡çš„ <code>define</code> æŒ‡ä»¤</p>
<p>syzkaller executor è¿˜å®šä¹‰äº†ä¸€äº› <a target="_blank" rel="noopener" href="https://github.com/google/syzkaller/blob/master/docs/pseudo_syscalls.md">pseudo system calls</a> ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æè¿°æ–‡ä»¶ä¸­ä½¿ç”¨è¿™äº›ä¼ªç³»ç»Ÿè°ƒç”¨ã€‚è¿™äº›ä¼ªç³»ç»Ÿè°ƒç”¨è¢«æ‰©å±•ä¸º C ä»£ç ï¼Œå¯ä»¥æ‰§è¡Œç”¨æˆ·è‡ªå®šä¹‰çš„ä¸€äº›æ“ä½œï¼Œ<a target="_blank" rel="noopener" href="https://github.com/google/syzkaller/blob/master/executor/common_linux.h">è¿™é‡Œ</a>æ˜¯ä¸€äº›ğŸŒ°</p>
<p>è¦å†™å‡ºä¼˜ç§€çš„æè¿°æ–‡ä»¶ï¼Œ<a target="_blank" rel="noopener" href="https://github.com/google/syzkaller/blob/master/docs/syscall_descriptions.md#tips">è¿™é‡Œ</a>æ˜¯ä¸€äº› tips</p>
<h2 id="ç¼–å†™å¹¶ä½¿ç”¨æè¿°æ–‡ä»¶"><a href="#ç¼–å†™å¹¶ä½¿ç”¨æè¿°æ–‡ä»¶" class="headerlink" title="ç¼–å†™å¹¶ä½¿ç”¨æè¿°æ–‡ä»¶"></a>ç¼–å†™å¹¶ä½¿ç”¨æè¿°æ–‡ä»¶</h2><h3 id="Step-I-ç¼–å†™æè¿°æ–‡ä»¶"><a href="#Step-I-ç¼–å†™æè¿°æ–‡ä»¶" class="headerlink" title="Step I.ç¼–å†™æè¿°æ–‡ä»¶"></a>Step I.ç¼–å†™æè¿°æ–‡ä»¶</h3><p>æˆ‘ä»¬éœ€è¦åœ¨ syzkaller ç›®å½•ä¸‹çš„ <code>syzkaller/sys/linux/</code> è¿™ä¸ªç›®å½•ä¸‹é¢æ–°å»ºæˆ‘ä»¬è‡ªå·±çš„æè¿°æ–‡ä»¶ï¼Œæ¯”å¦‚è¯´ç¬”è€…æ–°å»ºä¸€ä¸ª <code>a3_handsome.txt</code> æ–‡ä»¶å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs syzlang">include &lt;linux/fs.h&gt;<br><br>resource a3fd[int64]<br><br>open$a3proc(file ptr[in, string[&quot;/dev/tty&quot;]], flags flags[a3_open_flags]) a3fd<br>read$a3proc(fd a3fd, buf ptr[in, array[int8]], count len[buf])<br>write$a3proc(fd a3fd, buf ptr[in, array[int8]], count len[buf])<br>close$a3proc(fd a3fd)<br><br>a3_open_flags = O_WRONLY, O_RDWR, O_APPEND, FASYNC, O_CLOEXEC, O_CREAT, O_DIRECT, O_DIRECTORY, O_EXCL, O_LARGEFILE, O_NOATIME, O_NOCTTY, O_NOFOLLOW, O_NONBLOCK, O_PATH, O_SYNC, O_TRUNC, __O_TMPFILE<br></code></pre></td></tr></table></figure>

<blockquote>
<p>éšä¾¿å†™çš„ï¼Œæ²¡æœ‰ä»»ä½•çš„é’ˆå¯¹æ€§è®¾è®¡</p>
</blockquote>
<p>åœ¨è¿™é‡Œå˜ç§åä¸º <code>a3proc</code>ï¼Œå¯ä»¥ç†è§£ä¸ºç¬”è€…è‡ªå·±å–çš„åˆ«åï¼Œè¿™æ˜¯å› ä¸ºè‹¥ä¸åŒçš„æè¿°æ–‡ä»¶ä¸­å­˜åœ¨ç›¸åŒçš„ç³»ç»Ÿè°ƒç”¨åˆ™ç¼–è¯‘æ—¶ä¼šå‘ç”Ÿå†²çª</p>
<h3 id="Step-II-ç¼–è¯‘-syz-extract-ä¸-syz-sysgen"><a href="#Step-II-ç¼–è¯‘-syz-extract-ä¸-syz-sysgen" class="headerlink" title="Step II.ç¼–è¯‘ syz-extract ä¸ syz-sysgen"></a>Step II.ç¼–è¯‘ syz-extract ä¸ syz-sysgen</h3><p>æ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦ç¼–è¯‘ <code>syz-extract</code> ä¸ <code>syz-sysgen</code>ï¼Œä»è€Œåº”ç”¨æˆ‘ä»¬æ–°ç¼–å†™çš„æè¿°æ–‡ä»¶</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">make bin/syz-extract</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">make bin/syz-sysgen	<span class="hljs-comment"># no need for syzkaller in new version</span></span><br></code></pre></td></tr></table></figure>

<ul>
<li>syz-extract ç”¨ä»¥æå–å¼•å…¥çš„å†…æ ¸å¤´æ–‡ä»¶ä¸­çš„ define å¸¸é‡ç­‰ï¼Œç”Ÿæˆ <code>.const</code> æ–‡ä»¶</li>
<li>syz-sysgen ç”¨ä»¥ç»“åˆ <code>.txt</code> æ–‡ä»¶ä¸ <code>.const</code> æ–‡ä»¶è¿›è¡Œè¯­æ³•åˆ†æå’Œè¯­ä¹‰åˆ†æç”Ÿæˆ AST ï¼Œæœ€åç”Ÿæˆ <code>.go</code> æ–‡ä»¶</li>
</ul>
<p>å¯¹äºç‰ˆæœ¬è¾ƒæ–°çš„ syzkaller ï¼Œå…¶åœ¨ç¼–è¯‘æ—¶ä¼šé»˜è®¤ç¼–è¯‘ syz-sysgenï¼Œå› æ­¤æˆ‘ä»¬åªéœ€è¦æ‰‹åŠ¨ç¼–è¯‘ syz-extract å³å¯</p>
<h3 id="Step-III-å¤„ç†æ–°è§„åˆ™æ–‡ä»¶"><a href="#Step-III-å¤„ç†æ–°è§„åˆ™æ–‡ä»¶" class="headerlink" title="Step III.å¤„ç†æ–°è§„åˆ™æ–‡ä»¶"></a>Step III.å¤„ç†æ–°è§„åˆ™æ–‡ä»¶</h3><p>ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å¤„ç†æˆ‘ä»¬åˆšåˆšå†™çš„è§„åˆ™æ–‡ä»¶</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">bin/syz-extract -os linux -<span class="hljs-built_in">arch</span> <span class="hljs-variable">$ARCH</span> -sourcedir <span class="hljs-variable">$KSRC</span> -builddir <span class="hljs-variable">$LINUXBLD</span> &lt;new&gt;.txt</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">bin/syz-sysgen	<span class="hljs-comment"># no need for syzkaller in new version</span></span><br></code></pre></td></tr></table></figure>

<ul>
<li><code>$ARCH</code> åº”ä¸ºä½ çš„ç›®æ ‡æ¶æ„ï¼Œå¯é€‰é¡¹æœ‰ <code>amd64</code>, <code>386</code> <code>arm64</code>, <code>arm</code>, <code>ppc64le</code>, <code>mips64le</code></li>
<li><code>$KSRC</code> åº”ä¸º fuzz çš„å†…æ ¸çš„æºç ç›®å½•</li>
<li><code>$LINUXBLD</code> åº”ä¸ºä½ çš„ç¼–è¯‘ç›®å½•ï¼Œä¸ºå¯é€‰é¡¹ï¼ˆ-builddirï¼‰</li>
<li><code>&lt;new&gt;.txt</code> å°±æ˜¯ä½ åˆšåˆšç¼–å†™çš„è§„åˆ™æ–‡ä»¶çš„æ–‡ä»¶å</li>
</ul>
<p>ä¼šåœ¨ <code>syzkaller/sys/linux</code> ä¸‹ç”Ÿæˆ <code>.const</code> æ–‡ä»¶æå–å‡ºå¸¸é‡ï¼Œåœ¨æ­£å¼ç¼–è¯‘æ—¶ä¼šè¿›è¡Œæ›¿æ¢ï¼Œä¾‹å¦‚ç¬”è€…ä¸Šé¢ç»™å‡ºçš„ä¾‹ç¨‹ç”Ÿæˆçš„ <code>.const</code> æ–‡ä»¶å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs const"># Code generated by syz-sysgen. DO NOT EDIT.<br>arches = amd64<br>FASYNC = amd64:8192<br>O_APPEND = amd64:1024<br>O_CLOEXEC = amd64:524288<br>O_CREAT = amd64:64<br>O_DIRECT = amd64:16384<br>O_DIRECTORY = amd64:65536<br>O_EXCL = amd64:128<br>O_LARGEFILE = amd64:32768<br>O_NOATIME = amd64:262144<br>O_NOCTTY = amd64:256<br>O_NOFOLLOW = amd64:131072<br>O_NONBLOCK = amd64:2048<br>O_PATH = amd64:2097152<br>O_RDWR = amd64:2<br>O_SYNC = amd64:1052672<br>O_TRUNC = amd64:512<br>O_WRONLY = amd64:1<br>__NR_open = amd64:2<br>__NR_read = amd64:0<br>__NR_write = amd64:1<br>__O_TMPFILE = amd64:4194304<br><br></code></pre></td></tr></table></figure>

<h3 id="Step-IV-é‡æ–°ç¼–è¯‘-syzkaller"><a href="#Step-IV-é‡æ–°ç¼–è¯‘-syzkaller" class="headerlink" title="Step IV.é‡æ–°ç¼–è¯‘ syzkaller"></a>Step IV.é‡æ–°ç¼–è¯‘ syzkaller</h3><p>å‘½ä»¤å¦‚ä¸‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">make generate</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">make</span><br></code></pre></td></tr></table></figure>

<h3 id="Step-V-ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œå¯åŠ¨-syzkaller"><a href="#Step-V-ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œå¯åŠ¨-syzkaller" class="headerlink" title="Step V.ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œå¯åŠ¨ syzkaller"></a>Step V.ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œå¯åŠ¨ syzkaller</h3><p>å‰é¢æˆ‘ä»¬å‘½åäº† <code>a3proc</code> ï¼Œå› æ­¤æˆ‘ä»¬è¿˜éœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œ enableï¼Œåœ¨ä½ çš„ <code>.cfg</code> æ–‡ä»¶ä¸­æ·»åŠ è¿™ä¸€é¡¹ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-attr">&quot;enable_syscalls&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>	<span class="hljs-string">&quot;open$a3proc&quot;</span><span class="hljs-punctuation">,</span><br>	<span class="hljs-string">&quot;read$a3proc&quot;</span><span class="hljs-punctuation">,</span><br>	<span class="hljs-string">&quot;write$a3proc&quot;</span><span class="hljs-punctuation">,</span><br>	<span class="hljs-string">&quot;close$a3proc&quot;</span><br><span class="hljs-punctuation">]</span><br></code></pre></td></tr></table></figure>

<p>ä¹‹åæŒ‰æƒ¯ä¾‹å¯åŠ¨å³å¯ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">./bin/syz-manager -config=config.cfg</span><br></code></pre></td></tr></table></figure>

<h2 id="å·¥ä½œåŸç†"><a href="#å·¥ä½œåŸç†" class="headerlink" title="*å·¥ä½œåŸç†"></a><em>*å·¥ä½œåŸç†</em></h2><p>å½“æˆ‘ä»¬ä½¿ç”¨ syzlang ç¼–å†™å¥½æ¨¡æ¿ä¹‹åï¼Œè¿™äº›ç³»ç»Ÿè°ƒç”¨æ¨¡æ¿ä¼šé€šè¿‡ <strong>syz-extract</strong> å’Œ <strong>syz-sysgen</strong> ç¿»è¯‘ä¸º syzkaller èƒ½å¤Ÿè¯»æ‡‚çš„ä»£ç ï¼Œç¬”è€…è¿™é‡Œç®€è¿°ä¸€ä¸‹å…¶åŸç†</p>
<blockquote>
<p>è¿™é‡Œä½ å¯èƒ½éœ€è¦ä¸€ç‚¹ç¼–è¯‘åŸç†çš„çŸ¥è¯†ï¼Œä¸è¿‡ç¬”è€…ç›¸ä¿¡å¤§å®¶ç¼–è¯‘åŸç†åº”å½“éƒ½åŠæ ¼äº†ï¼ˆç¬‘ï¼‰</p>
<blockquote>
<p><del>ä»€ä¹ˆï¼Ÿä½ è¯´ä½ è¿˜æ²¡ä¸Šè¿™é—¨è¯¾</del></p>
<blockquote>
<p><del>ä»€ä¹ˆï¼Ÿç”¨ syzkaller æŒ–æ´åªè¦ä¼šå†™ syzlang å°±è¡Œäº†ï¼Œæ ¹æœ¬ä¸éœ€è¦ç†è§£ä»–çš„åŸç†</del></p>
</blockquote>
</blockquote>
<p>ç®€è¦è€Œè¨€ï¼Œä»æºä»£ç åˆ°å¯æ‰§è¡Œæ–‡ä»¶å¤§æ¦‚æœ‰å¦‚ä¸‹è¿‡ç¨‹ï¼š</p>
<ul>
<li>è¯æ³•åˆ†æï¼ˆlexical analysisï¼‰ï¼šæ‰«æå™¨ï¼ˆscannerï¼Œé€šå¸¸æ˜¯ä¸€ä¸ªæœ‰é™çŠ¶æ€è‡ªåŠ¨æœºï¼‰ä»æºç æ–‡æœ¬ä¸­é€å­—ç¬¦è¯»å…¥ï¼Œè¿‡æ»¤æ‰æ³¨é‡Šï¼Œå°†è¯ç´ æ˜ å°„ä¸ºè¯æ³•å•å…ƒï¼Œç”Ÿæˆç¬¦å·è¡¨ï¼Œå»ºç«‹æ˜ å°„ï¼Œæœ€ç»ˆè¾“å‡ºè¯ç´ åºåˆ—</li>
<li>è¯­æ³•åˆ†æï¼ˆsyntax analysisï¼‰ï¼šè¯­æ³•åˆ†æå™¨ä»è¯æ³•åˆ†æå™¨ä¸­è·å–è¯ç´ åºåˆ—ï¼Œæ„å»ºæ ‘å½¢çš„ä¸­é—´è¡¨ç¤ºï¼šé€šå¸¸æ˜¯æŠ½è±¡è¯­æ³•æ ‘ï¼ˆabstract syntax treeï¼‰ï¼Œæ ‘å½¢ä¸­é—´èŠ‚ç‚¹è¡¨ç¤ºè¿ç®—åˆ†é‡ï¼Œæœ€ç»ˆè¾“å‡ºè¢«ç§°ä¹‹ä¸ºè¯æ³•å•å…ƒæµçš„è¯­æ³•æ ‘</li>
<li>è¯­ä¹‰åˆ†æï¼ˆsemantic analysisï¼‰ï¼šè¯­ä¹‰åˆ†æå™¨ä½¿ç”¨è¯­æ³•æ ‘ä¸ç¬¦å·è¡¨æ£€æŸ¥æºç¨‹åºçš„è¯­ä¹‰ä¸€è‡´æ€§ï¼Œä¾‹å¦‚ä¸€ä¸ªæ•´æ•°å’Œä¸€ä¸ªå­—ç¬¦ä¸²ç›¸åŠ æ˜¯ç¬¦åˆè¯­æ³•è§„åˆ™çš„ï¼Œä½†å¯¹äºå¤§éƒ¨åˆ†è¯­è¨€è€Œè¨€è¿™å¹¶ä¸æ˜¯ä¸€ä¸ªåˆæ³•çš„è¿ç®—ï¼Œå› æ­¤ä¸ç¬¦åˆè¯­ä¹‰è§„åˆ™ï¼ˆ<del>ä»€ä¹ˆï¼Ÿä½ è¯´ä½ ç”¨ JavaScript</del>ï¼‰</li>
<li><em>ä¸­é—´ä»£ç ç”Ÿæˆä¸ä¼˜åŒ–ï¼šä¸­é—´ä»£ç ç”Ÿæˆå™¨é€šè¿‡è¯­ä¹‰åˆ†æçš„ç»“æœç”Ÿæˆå¯¹åº”çš„ä¸­é—´ä»£ç ï¼ˆä¾‹å¦‚ä¸‰åœ°å€ç ï¼‰ï¼Œå¹¶è¿›è¡Œä¸€å®šçš„ä¼˜åŒ–</em></li>
<li><em>ä»£ç ç”Ÿæˆï¼šç”±ä»£ç ç”Ÿæˆå™¨å°†ä¸­é—´ä»£ç è½¬ä¸ºå¯æ‰§è¡Œä»£ç </em></li>
</ul>
</blockquote>
<h3 id="syz-extract"><a href="#syz-extract" class="headerlink" title="syz-extract"></a>syz-extract</h3><p>ç¬¬ä¸€æ­¥æ˜¯ä»å†…æ ¸æºæ–‡ä»¶ä¸­æå–ç¬¦å·å¸¸é‡çš„å€¼ï¼š<code>syz-extract</code> ä¼šæ ¹æ® syzlang æ–‡ä»¶ä»å†…æ ¸æºæ–‡ä»¶ä¸­æå–å‡ºä½¿ç”¨çš„å¯¹åº”çš„å®ã€ç³»ç»Ÿè°ƒç”¨å·ç­‰çš„å€¼ï¼Œç”Ÿæˆ <code>.const</code> æ–‡ä»¶</p>
<h3 id="syz-sysgen"><a href="#syz-sysgen" class="headerlink" title="syz-sysgen"></a>syz-sysgen</h3><p>ç¬¬äºŒæ­¥ä¾¿æ˜¯å°†æè¿°ç¿»è¯‘æˆ Golang ä»£ç ï¼š<code>syz-sysgen</code> é€šè¿‡ syzlang æ–‡ä»¶ä¸ .const æ–‡ä»¶è¿›è¡Œè¯­æ³•åˆ†æä¸è¯­ä¹‰åˆ†æï¼Œç”ŸæˆæŠ½è±¡è¯­æ³•æ ‘ï¼Œæœ€ç»ˆç”Ÿæˆä¾› syzkaller ä½¿ç”¨çš„ golang ä»£ç ï¼Œåˆ†ä¸ºå¦‚ä¸‹å››ä¸ªæ­¥éª¤ï¼š</p>
<ul>
<li><strong>assignSyscallNumbers</strong>ï¼šåˆ†é…ç³»ç»Ÿè°ƒç”¨å·ï¼Œæ£€æµ‹ä¸æ”¯æŒçš„ç³»ç»Ÿè°ƒç”¨å¹¶ä¸¢å¼ƒ</li>
<li><strong>patchConsts</strong>ï¼šå°† AST ä¸­çš„å¸¸é‡æ›¿æ¢ä¸ºå¯¹åº”çš„å€¼</li>
<li><strong>check</strong>ï¼šè¿›è¡Œè¯­ä¹‰åˆ†æ</li>
<li><strong>genSyscalls</strong>ï¼šä» AST ç”Ÿæˆ prog å¯¹è±¡</li>
</ul>
<h1 id="0x04-å®æˆ˜ï¼šç”¨-syzkaller-æŒ–æ˜å‡º-CVE-20"><a href="#0x04-å®æˆ˜ï¼šç”¨-syzkaller-æŒ–æ˜å‡º-CVE-20" class="headerlink" title="0x04.å®æˆ˜ï¼šç”¨ syzkaller æŒ–æ˜å‡º CVE-20??-????"></a><del>0x04.å®æˆ˜ï¼šç”¨ syzkaller æŒ–æ˜å‡º CVE-20??-????</del></h1><p><del>CVE-20??-???? æ˜¯ç”±äº ?? åŸå› é€ æˆçš„å†…æ ¸ç©ºé—´ä¸­çš„ ??ï¼Œç¬”è€…æ¥ä¸‹æ¥å°†å°è¯•ä½¿ç”¨ syzkaller æ¥æŒ–æ˜å‡ºè¯¥æ¼æ´</del></p>
<blockquote>
<p>ğŸ•ŠğŸ•ŠğŸ•Š</p>
</blockquote>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/FUZZ/" class="category-chain-item">FUZZ</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/Pwn/">#Pwn</a>
      
        <a href="/tags/Linux/">#Linux</a>
      
        <a href="/tags/Linux-Kernel/">#Linux Kernel</a>
      
        <a href="/tags/%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98/">#æ¼æ´æŒ–æ˜</a>
      
        <a href="/tags/syzkaller/">#syzkaller</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>ã€FUZZ.0x01ã€‘syzkaller - Iï¼šä½¿ç”¨ syzkaller è¿›è¡Œæ¼æ´æŒ–æ˜</div>
      <div>http://blog.arttnba3.cn/2021/11/24/FUZZ-0X01-SYZKALLER-I/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>ä½œè€…</div>
          <div>arttnba3</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>å‘å¸ƒäº</div>
          <div>2021å¹´11æœˆ24æ—¥</div>
        </div>
      
      
      <div class="license-meta-item">
        <div>è®¸å¯åè®®</div>
        <div>
          
            
            
              <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
              <span class="hint--top hint--rounded" aria-label="BY - ç½²å">
                <i class="iconfont icon-by"></i>
              </span>
              </a>
            
          
        </div>
      </div>
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2021/11/28/OS-0X02-LINUX-KERNEL-MEMORY-5.11-PART-I/" title="ã€OS.0x02ã€‘Linux Kernel å†…å­˜ç®¡ç†æµ…æ I - é¡µã€åŒºã€èŠ‚ç‚¹">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">ã€OS.0x02ã€‘Linux Kernel å†…å­˜ç®¡ç†æµ…æ I - é¡µã€åŒºã€èŠ‚ç‚¹</span>
                        <span class="visible-mobile">ä¸Šä¸€ç¯‡</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2021/10/31/CTF-0X05-TCTF2021_FINAL/" title="ã€CTF.0x05ã€‘TCTF2021-FINAL ä¸¤é“ kernel pwn é¢˜è§£">
                        <span class="hidden-mobile">ã€CTF.0x05ã€‘TCTF2021-FINAL ä¸¤é“ kernel pwn é¢˜è§£</span>
                        <span class="visible-mobile">ä¸‹ä¸€ç¯‡</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  <article id="comments" lazyload>
    
  <div id="valine"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#valine', function() {
      Fluid.utils.createScript('https://lib.baomitu.com/valine/1.4.17/Valine.min.js', function() {
        var options = Object.assign(
          {"appid":"ICj6cPRQWFTNiOttBHlzxnIv-gzGzoHsz","appkey":"tuvJh3xYxPFcW2JB6K26RKP2","path":"window.location.pathname","placeholder":"è¯´ç‚¹ä»€ä¹ˆå‘—ï¼ˆç¬‘ï¼‰","avatar":"retro","meta":["nick","mail","link"],"requiredFields":[],"pageSize":10,"lang":"zh-CN","highlight":false,"recordIP":false,"serverURLs":"","emojiCDN":null,"emojiMaps":null,"enableQQ":false,"appId":"ICj6cPRQWFTNiOttBHlzxnIv-gzGzoHsz","appKey":"tuvJh3xYxPFcW2JB6K26RKP2"},
          {
            el: "#valine",
            path: window.location.pathname
          }
        )
        new Valine(options);
        Fluid.utils.waitElementVisible('#valine .vcontent', () => {
          var imgSelector = '#valine .vcontent img:not(.vemoji)';
          Fluid.plugins.imageCaption(imgSelector);
          Fluid.plugins.fancyBox(imgSelector);
        })
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


  </article>


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;ç›®å½•</p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  


  
  









    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">æœç´¢</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">å…³é”®è¯</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  <!-- ç½‘ç«™è¿è¡Œæ—¶é—´çš„è®¾ç½® -->
  <span id="timeDate">è½½å…¥å¤©æ•°...</span>
  <span id="times">è½½å…¥æ—¶åˆ†ç§’...</span>
  <script>
      var now = new Date();
      function createtime() {
          var grt= new Date("04/20/2020 17:48:48");//æ­¤å¤„ä¿®æ”¹ä½ çš„å»ºç«™æ—¶é—´æˆ–è€…ç½‘ç«™ä¸Šçº¿æ—¶é—´
          now.setTime(now.getTime()+250);
          days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days);
          hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours);
          if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);
          mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;}
          seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
          snum = Math.round(seconds); if(String(snum).length ==1 ){snum = "0" + snum;}
          document.getElementById("timeDate").innerHTML = "arttnba3çš„å°å±‹å·²ç»å®‰å…¨å­˜åœ¨äº† "+dnum+" å¤© ";
          document.getElementById("times").innerHTML = hnum + " å°æ—¶ " + mnum + " åˆ† " + snum + " ç§’";
      }
  setInterval("createtime()",250);
  </script>
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="busuanzi_container_site_pv" style="display: none">
        æ€»è®¿é—®é‡ 
        <span id="busuanzi_value_site_pv"></span>
         æ¬¡
      </span>
    
    
      <span id="busuanzi_container_site_uv" style="display: none">
        æ€»è®¿å®¢æ•° 
        <span id="busuanzi_value_site_uv"></span>
         äºº
      </span>
    
    
  
</div>

  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      headingSelector : CONFIG.toc.headingSelector || 'h1,h2,h3,h4,h5,h6',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      collapseDepth   : CONFIG.toc.collapseDepth || 0,
      scrollSmooth    : true,
      headingsOffset  : -boardTop
    });
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.10/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  
      <script>
        if (!window.MathJax) {
          window.MathJax = {
            tex    : {
              inlineMath: { '[+]': [['$', '$']] }
            },
            loader : {
              load: ['ui/lazy']
            },
            options: {
              renderActions: {
                insertedScript: [200, () => {
                  document.querySelectorAll('mjx-container').forEach(node => {
                    let target = node.parentNode;
                    if (target.nodeName.toLowerCase() === 'li') {
                      target.parentNode.classList.add('has-jax');
                    }
                  });
                }, '', false]
              }
            }
          };
        } else {
          MathJax.startup.document.state(0);
          MathJax.texReset();
          MathJax.typeset();
          MathJax.typesetPromise();
        }
      </script>
    

  <script  src="https://lib.baomitu.com/mathjax/3.2.1/es5/tex-mml-chtml.js" ></script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>





<!-- ä¸»é¢˜çš„å¯åŠ¨é¡¹ï¼Œå°†å®ƒä¿æŒåœ¨æœ€åº•éƒ¨ -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">åšå®¢åœ¨å…è®¸ JavaScript è¿è¡Œçš„ç¯å¢ƒä¸‹æµè§ˆæ•ˆæœæ›´ä½³</div>
  </noscript>
</body>
</html>
